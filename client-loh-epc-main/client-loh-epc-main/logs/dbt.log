[0m11:35:55.159895 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106cae910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106c6c350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106cbe410>]}


============================== 11:35:55.162596 | 17309231-8564-4e1c-aaa0-38baeb70385e ==============================
[0m11:35:55.162596 [info ] [MainThread]: Running with dbt=1.7.1
[0m11:35:55.162989 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt debug', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m11:35:55.163424 [info ] [MainThread]: dbt version: 1.7.1
[0m11:35:55.163625 [info ] [MainThread]: python version: 3.11.0
[0m11:35:55.163810 [info ] [MainThread]: python path: /Library/Frameworks/Python.framework/Versions/3.11/bin/python3.11
[0m11:35:55.163977 [info ] [MainThread]: os info: macOS-14.2.1-arm64-arm-64bit
[0m11:35:55.177603 [debug] [MainThread]: Traceback (most recent call last):
  File "/Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages/dbt/adapters/factory.py", line 58, in load_plugin
    mod: Any = import_module("." + name, "dbt.adapters")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/importlib/__init__.py", line 126, in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<frozen importlib._bootstrap>", line 1206, in _gcd_import
  File "<frozen importlib._bootstrap>", line 1178, in _find_and_load
  File "<frozen importlib._bootstrap>", line 1149, in _find_and_load_unlocked
  File "<frozen importlib._bootstrap>", line 690, in _load_unlocked
  File "<frozen importlib._bootstrap_external>", line 940, in exec_module
  File "<frozen importlib._bootstrap>", line 241, in _call_with_frames_removed
  File "/Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages/dbt/adapters/snowflake/__init__.py", line 2, in <module>
    from dbt.adapters.snowflake.connections import SnowflakeConnectionManager  # noqa
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages/dbt/adapters/snowflake/connections.py", line 19, in <module>
    import snowflake.connector
ModuleNotFoundError: No module named 'snowflake.connector'; 'snowflake' is not a package

[0m11:35:55.177973 [error] [MainThread]: Encountered an error:
No module named 'snowflake.connector'; 'snowflake' is not a package
[0m11:35:55.179100 [error] [MainThread]: Traceback (most recent call last):
  File "/Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages/dbt/cli/requires.py", line 90, in wrapper
    result, success = func(*args, **kwargs)
                      ^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages/dbt/cli/requires.py", line 75, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages/dbt/cli/main.py", line 444, in debug
    results = task.run()
              ^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages/dbt/task/debug.py", line 123, in run
    load_profile_status: SubtaskStatus = self._load_profile()
                                         ^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages/dbt/task/debug.py", line 212, in _load_profile
    profile: Profile = Profile.render(
                       ^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages/dbt/config/profile.py", line 436, in render
    return cls.from_raw_profiles(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages/dbt/config/profile.py", line 401, in from_raw_profiles
    return cls.from_raw_profile_info(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages/dbt/config/profile.py", line 355, in from_raw_profile_info
    credentials: Credentials = cls._credentials_from_profile(
                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages/dbt/config/profile.py", line 165, in _credentials_from_profile
    cls = load_plugin(typename)
          ^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages/dbt/adapters/factory.py", line 212, in load_plugin
    return FACTORY.load_plugin(name)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages/dbt/adapters/factory.py", line 58, in load_plugin
    mod: Any = import_module("." + name, "dbt.adapters")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/importlib/__init__.py", line 126, in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<frozen importlib._bootstrap>", line 1206, in _gcd_import
  File "<frozen importlib._bootstrap>", line 1178, in _find_and_load
  File "<frozen importlib._bootstrap>", line 1149, in _find_and_load_unlocked
  File "<frozen importlib._bootstrap>", line 690, in _load_unlocked
  File "<frozen importlib._bootstrap_external>", line 940, in exec_module
  File "<frozen importlib._bootstrap>", line 241, in _call_with_frames_removed
  File "/Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages/dbt/adapters/snowflake/__init__.py", line 2, in <module>
    from dbt.adapters.snowflake.connections import SnowflakeConnectionManager  # noqa
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages/dbt/adapters/snowflake/connections.py", line 19, in <module>
    import snowflake.connector
ModuleNotFoundError: No module named 'snowflake.connector'; 'snowflake' is not a package

[0m11:35:55.180535 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_wall_clock_time": 0.05128683, "process_user_time": 0.953822, "process_kernel_time": 0.09048, "process_mem_max_rss": "107642880", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m11:35:55.180959 [debug] [MainThread]: Command `dbt debug` failed at 11:35:55.180873 after 0.05 seconds
[0m11:35:55.181192 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102266f10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106d29890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1064ffb90>]}
[0m11:35:55.181427 [debug] [MainThread]: Flushing usage events
[0m11:36:52.256614 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1056f7650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105755e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105756950>]}


============================== 11:36:52.259106 | 16486511-a3b9-4c9f-8e67-362b9aa74044 ==============================
[0m11:36:52.259106 [info ] [MainThread]: Running with dbt=1.7.1
[0m11:36:52.259483 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m11:36:52.273208 [debug] [MainThread]: Traceback (most recent call last):
  File "/Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages/dbt/adapters/factory.py", line 58, in load_plugin
    mod: Any = import_module("." + name, "dbt.adapters")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/importlib/__init__.py", line 126, in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<frozen importlib._bootstrap>", line 1206, in _gcd_import
  File "<frozen importlib._bootstrap>", line 1178, in _find_and_load
  File "<frozen importlib._bootstrap>", line 1149, in _find_and_load_unlocked
  File "<frozen importlib._bootstrap>", line 690, in _load_unlocked
  File "<frozen importlib._bootstrap_external>", line 940, in exec_module
  File "<frozen importlib._bootstrap>", line 241, in _call_with_frames_removed
  File "/Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages/dbt/adapters/snowflake/__init__.py", line 2, in <module>
    from dbt.adapters.snowflake.connections import SnowflakeConnectionManager  # noqa
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages/dbt/adapters/snowflake/connections.py", line 19, in <module>
    import snowflake.connector
ModuleNotFoundError: No module named 'snowflake.connector'; 'snowflake' is not a package

[0m11:36:52.273627 [error] [MainThread]: Encountered an error:
No module named 'snowflake.connector'; 'snowflake' is not a package
[0m11:36:52.276116 [error] [MainThread]: Traceback (most recent call last):
  File "/Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages/dbt/cli/requires.py", line 90, in wrapper
    result, success = func(*args, **kwargs)
                      ^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages/dbt/cli/requires.py", line 75, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages/dbt/cli/requires.py", line 165, in wrapper
    profile = load_profile(flags.PROJECT_DIR, flags.VARS, flags.PROFILE, flags.TARGET, threads)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages/dbt/config/runtime.py", line 70, in load_profile
    profile = Profile.render(
              ^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages/dbt/config/profile.py", line 436, in render
    return cls.from_raw_profiles(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages/dbt/config/profile.py", line 401, in from_raw_profiles
    return cls.from_raw_profile_info(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages/dbt/config/profile.py", line 355, in from_raw_profile_info
    credentials: Credentials = cls._credentials_from_profile(
                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages/dbt/config/profile.py", line 165, in _credentials_from_profile
    cls = load_plugin(typename)
          ^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages/dbt/adapters/factory.py", line 212, in load_plugin
    return FACTORY.load_plugin(name)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages/dbt/adapters/factory.py", line 58, in load_plugin
    mod: Any = import_module("." + name, "dbt.adapters")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/importlib/__init__.py", line 126, in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<frozen importlib._bootstrap>", line 1206, in _gcd_import
  File "<frozen importlib._bootstrap>", line 1178, in _find_and_load
  File "<frozen importlib._bootstrap>", line 1149, in _find_and_load_unlocked
  File "<frozen importlib._bootstrap>", line 690, in _load_unlocked
  File "<frozen importlib._bootstrap_external>", line 940, in exec_module
  File "<frozen importlib._bootstrap>", line 241, in _call_with_frames_removed
  File "/Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages/dbt/adapters/snowflake/__init__.py", line 2, in <module>
    from dbt.adapters.snowflake.connections import SnowflakeConnectionManager  # noqa
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages/dbt/adapters/snowflake/connections.py", line 19, in <module>
    import snowflake.connector
ModuleNotFoundError: No module named 'snowflake.connector'; 'snowflake' is not a package

[0m11:36:52.277489 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.0514485, "process_user_time": 0.947758, "process_kernel_time": 0.088333, "process_mem_max_rss": "105365504", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m11:36:52.277857 [debug] [MainThread]: Command `dbt run` failed at 11:36:52.277767 after 0.05 seconds
[0m11:36:52.278106 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105756550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1057b5e90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105749e50>]}
[0m11:36:52.278344 [debug] [MainThread]: Flushing usage events
[0m11:40:03.175991 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104563a10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104d1de90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104d1e910>]}


============================== 11:40:03.178495 | b02b3930-7023-4f32-9ccc-0d45c3a6438a ==============================
[0m11:40:03.178495 [info ] [MainThread]: Running with dbt=1.7.1
[0m11:40:03.178873 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'version_check': 'True', 'profiles_dir': '/Users/melissabee/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m11:40:03.192966 [debug] [MainThread]: Traceback (most recent call last):
  File "/Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages/dbt/adapters/factory.py", line 58, in load_plugin
    mod: Any = import_module("." + name, "dbt.adapters")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/importlib/__init__.py", line 126, in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<frozen importlib._bootstrap>", line 1206, in _gcd_import
  File "<frozen importlib._bootstrap>", line 1178, in _find_and_load
  File "<frozen importlib._bootstrap>", line 1149, in _find_and_load_unlocked
  File "<frozen importlib._bootstrap>", line 690, in _load_unlocked
  File "<frozen importlib._bootstrap_external>", line 940, in exec_module
  File "<frozen importlib._bootstrap>", line 241, in _call_with_frames_removed
  File "/Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages/dbt/adapters/snowflake/__init__.py", line 2, in <module>
    from dbt.adapters.snowflake.connections import SnowflakeConnectionManager  # noqa
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages/dbt/adapters/snowflake/connections.py", line 19, in <module>
    import snowflake.connector
ModuleNotFoundError: No module named 'snowflake.connector'; 'snowflake' is not a package

[0m11:40:03.193356 [error] [MainThread]: Encountered an error:
No module named 'snowflake.connector'; 'snowflake' is not a package
[0m11:40:03.194741 [error] [MainThread]: Traceback (most recent call last):
  File "/Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages/dbt/cli/requires.py", line 90, in wrapper
    result, success = func(*args, **kwargs)
                      ^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages/dbt/cli/requires.py", line 75, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages/dbt/cli/requires.py", line 165, in wrapper
    profile = load_profile(flags.PROJECT_DIR, flags.VARS, flags.PROFILE, flags.TARGET, threads)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages/dbt/config/runtime.py", line 70, in load_profile
    profile = Profile.render(
              ^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages/dbt/config/profile.py", line 436, in render
    return cls.from_raw_profiles(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages/dbt/config/profile.py", line 401, in from_raw_profiles
    return cls.from_raw_profile_info(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages/dbt/config/profile.py", line 355, in from_raw_profile_info
    credentials: Credentials = cls._credentials_from_profile(
                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages/dbt/config/profile.py", line 165, in _credentials_from_profile
    cls = load_plugin(typename)
          ^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages/dbt/adapters/factory.py", line 212, in load_plugin
    return FACTORY.load_plugin(name)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages/dbt/adapters/factory.py", line 58, in load_plugin
    mod: Any = import_module("." + name, "dbt.adapters")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/importlib/__init__.py", line 126, in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<frozen importlib._bootstrap>", line 1206, in _gcd_import
  File "<frozen importlib._bootstrap>", line 1178, in _find_and_load
  File "<frozen importlib._bootstrap>", line 1149, in _find_and_load_unlocked
  File "<frozen importlib._bootstrap>", line 690, in _load_unlocked
  File "<frozen importlib._bootstrap_external>", line 940, in exec_module
  File "<frozen importlib._bootstrap>", line 241, in _call_with_frames_removed
  File "/Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages/dbt/adapters/snowflake/__init__.py", line 2, in <module>
    from dbt.adapters.snowflake.connections import SnowflakeConnectionManager  # noqa
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages/dbt/adapters/snowflake/connections.py", line 19, in <module>
    import snowflake.connector
ModuleNotFoundError: No module named 'snowflake.connector'; 'snowflake' is not a package

[0m11:40:03.196025 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.056130875, "process_user_time": 0.952886, "process_kernel_time": 0.098697, "process_mem_max_rss": "106840064", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m11:40:03.196372 [debug] [MainThread]: Command `dbt run` failed at 11:40:03.196287 after 0.06 seconds
[0m11:40:03.196610 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1002c6f10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104d1fdd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104d1fe10>]}
[0m11:40:03.196835 [debug] [MainThread]: Flushing usage events
[0m11:42:12.163373 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107c517d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107caf5d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107cb6910>]}


============================== 11:42:12.165775 | 3973f796-55db-49e2-9994-40d9ceff5310 ==============================
[0m11:42:12.165775 [info ] [MainThread]: Running with dbt=1.7.1
[0m11:42:12.166170 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m11:42:12.179775 [debug] [MainThread]: Traceback (most recent call last):
  File "/Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages/dbt/adapters/factory.py", line 58, in load_plugin
    mod: Any = import_module("." + name, "dbt.adapters")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/importlib/__init__.py", line 126, in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<frozen importlib._bootstrap>", line 1206, in _gcd_import
  File "<frozen importlib._bootstrap>", line 1178, in _find_and_load
  File "<frozen importlib._bootstrap>", line 1149, in _find_and_load_unlocked
  File "<frozen importlib._bootstrap>", line 690, in _load_unlocked
  File "<frozen importlib._bootstrap_external>", line 940, in exec_module
  File "<frozen importlib._bootstrap>", line 241, in _call_with_frames_removed
  File "/Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages/dbt/adapters/snowflake/__init__.py", line 2, in <module>
    from dbt.adapters.snowflake.connections import SnowflakeConnectionManager  # noqa
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages/dbt/adapters/snowflake/connections.py", line 19, in <module>
    import snowflake.connector
ModuleNotFoundError: No module named 'snowflake.connector'; 'snowflake' is not a package

[0m11:42:12.180201 [error] [MainThread]: Encountered an error:
No module named 'snowflake.connector'; 'snowflake' is not a package
[0m11:42:12.181553 [error] [MainThread]: Traceback (most recent call last):
  File "/Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages/dbt/cli/requires.py", line 90, in wrapper
    result, success = func(*args, **kwargs)
                      ^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages/dbt/cli/requires.py", line 75, in wrapper
    return func(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages/dbt/cli/requires.py", line 165, in wrapper
    profile = load_profile(flags.PROJECT_DIR, flags.VARS, flags.PROFILE, flags.TARGET, threads)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages/dbt/config/runtime.py", line 70, in load_profile
    profile = Profile.render(
              ^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages/dbt/config/profile.py", line 436, in render
    return cls.from_raw_profiles(
           ^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages/dbt/config/profile.py", line 401, in from_raw_profiles
    return cls.from_raw_profile_info(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages/dbt/config/profile.py", line 355, in from_raw_profile_info
    credentials: Credentials = cls._credentials_from_profile(
                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages/dbt/config/profile.py", line 165, in _credentials_from_profile
    cls = load_plugin(typename)
          ^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages/dbt/adapters/factory.py", line 212, in load_plugin
    return FACTORY.load_plugin(name)
           ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages/dbt/adapters/factory.py", line 58, in load_plugin
    mod: Any = import_module("." + name, "dbt.adapters")
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/importlib/__init__.py", line 126, in import_module
    return _bootstrap._gcd_import(name[level:], package, level)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<frozen importlib._bootstrap>", line 1206, in _gcd_import
  File "<frozen importlib._bootstrap>", line 1178, in _find_and_load
  File "<frozen importlib._bootstrap>", line 1149, in _find_and_load_unlocked
  File "<frozen importlib._bootstrap>", line 690, in _load_unlocked
  File "<frozen importlib._bootstrap_external>", line 940, in exec_module
  File "<frozen importlib._bootstrap>", line 241, in _call_with_frames_removed
  File "/Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages/dbt/adapters/snowflake/__init__.py", line 2, in <module>
    from dbt.adapters.snowflake.connections import SnowflakeConnectionManager  # noqa
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/Library/Frameworks/Python.framework/Versions/3.11/lib/python3.11/site-packages/dbt/adapters/snowflake/connections.py", line 19, in <module>
    import snowflake.connector
ModuleNotFoundError: No module named 'snowflake.connector'; 'snowflake' is not a package

[0m11:42:12.182962 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.05129329, "process_user_time": 0.949876, "process_kernel_time": 0.098159, "process_mem_max_rss": "105316352", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m11:42:12.183352 [debug] [MainThread]: Command `dbt run` failed at 11:42:12.183264 after 0.05 seconds
[0m11:42:12.183580 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107cb67d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102a1af10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107caf190>]}
[0m11:42:12.183802 [debug] [MainThread]: Flushing usage events
[0m11:44:37.024451 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105a1a1d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105a5dcd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105a5e850>]}


============================== 11:44:37.026635 | 66aa066f-e91b-4725-bbf4-4e8bda630187 ==============================
[0m11:44:37.026635 [info ] [MainThread]: Running with dbt=1.7.10
[0m11:44:37.026989 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'debug': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt debug', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m11:44:37.027325 [info ] [MainThread]: dbt version: 1.7.10
[0m11:44:37.027523 [info ] [MainThread]: python version: 3.11.5
[0m11:44:37.027711 [info ] [MainThread]: python path: /Users/melissabee/Documents/GitHub/client-loh-floor-area/venv/bin/python3
[0m11:44:37.027876 [info ] [MainThread]: os info: macOS-14.2.1-arm64-arm-64bit
[0m11:44:37.149955 [info ] [MainThread]: Using profiles dir at /Users/melissabee/.dbt
[0m11:44:37.150274 [info ] [MainThread]: Using profiles.yml file at /Users/melissabee/.dbt/profiles.yml
[0m11:44:37.150451 [info ] [MainThread]: Using dbt_project.yml file at /Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/dbt_project.yml
[0m11:44:37.151730 [info ] [MainThread]: adapter type: snowflake
[0m11:44:37.152047 [info ] [MainThread]: adapter version: 1.7.2
[0m11:44:37.188761 [info ] [MainThread]: Configuration:
[0m11:44:37.189116 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m11:44:37.189289 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m11:44:37.189457 [info ] [MainThread]: Required dependencies:
[0m11:44:37.189679 [debug] [MainThread]: Executing "git --help"
[0m11:44:37.200918 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           [--super-prefix=<path>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m11:44:37.201557 [debug] [MainThread]: STDERR: "b''"
[0m11:44:37.201789 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m11:44:37.201983 [info ] [MainThread]: Connection:
[0m11:44:37.202195 [info ] [MainThread]:   account: xr30261
[0m11:44:37.202346 [info ] [MainThread]:   user: MELBOT
[0m11:44:37.202487 [info ] [MainThread]:   database: ANALYTICS_DEV
[0m11:44:37.202628 [info ] [MainThread]:   warehouse: TRANSFORMING
[0m11:44:37.202764 [info ] [MainThread]:   role: SYSADMIN
[0m11:44:37.202903 [info ] [MainThread]:   schema: dbt_melissa_rm_epc
[0m11:44:37.203046 [info ] [MainThread]:   authenticator: None
[0m11:44:37.203183 [info ] [MainThread]:   private_key_path: None
[0m11:44:37.203321 [info ] [MainThread]:   oauth_client_id: None
[0m11:44:37.203463 [info ] [MainThread]:   query_tag: None
[0m11:44:37.203602 [info ] [MainThread]:   client_session_keep_alive: False
[0m11:44:37.203735 [info ] [MainThread]:   host: None
[0m11:44:37.203870 [info ] [MainThread]:   port: None
[0m11:44:37.204006 [info ] [MainThread]:   proxy_host: None
[0m11:44:37.204139 [info ] [MainThread]:   proxy_port: None
[0m11:44:37.204271 [info ] [MainThread]:   protocol: None
[0m11:44:37.204408 [info ] [MainThread]:   connect_retries: 1
[0m11:44:37.204545 [info ] [MainThread]:   connect_timeout: None
[0m11:44:37.204679 [info ] [MainThread]:   retry_on_database_errors: False
[0m11:44:37.204824 [info ] [MainThread]:   retry_all: False
[0m11:44:37.204957 [info ] [MainThread]:   insecure_mode: False
[0m11:44:37.205103 [info ] [MainThread]:   reuse_connections: None
[0m11:44:37.205346 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m11:44:37.209190 [debug] [MainThread]: Acquiring new snowflake connection 'debug'
[0m11:44:37.210259 [debug] [MainThread]: Using snowflake connection "debug"
[0m11:44:37.210441 [debug] [MainThread]: On debug: select 1 as id
[0m11:44:37.210641 [debug] [MainThread]: Opening a new connection, currently in state init
[0m11:44:38.155258 [debug] [MainThread]: Snowflake adapter: Error running SQL: select 1 as id
[0m11:44:38.155599 [debug] [MainThread]: Snowflake adapter: Rolling back transaction.
[0m11:44:38.155860 [debug] [MainThread]: On debug: No close available on handle
[0m11:44:38.156136 [info ] [MainThread]:   Connection test: [[31mERROR[0m]

[0m11:44:38.156383 [info ] [MainThread]: [31m1 check failed:[0m
[0m11:44:38.156603 [info ] [MainThread]: dbt was unable to connect to the specified database.
The database returned the following error:

  >Database Error
  250001 (08001): Failed to connect to DB. Verify the account name is correct: xr30261.snowflakecomputing.com:443. HTTP 403: Forbidden

Check your database credentials and try again. For more information, visit:
https://docs.getdbt.com/docs/configure-your-profile


[0m11:44:38.157912 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_wall_clock_time": 1.1610994, "process_user_time": 1.179441, "process_kernel_time": 0.130339, "process_mem_max_rss": "129318912", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m11:44:38.158342 [debug] [MainThread]: Command `dbt debug` failed at 11:44:38.158243 after 1.16 seconds
[0m11:44:38.158603 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m11:44:38.158859 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x101616110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106835550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105a5df50>]}
[0m11:44:38.159148 [debug] [MainThread]: Flushing usage events
[0m11:45:30.161794 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10893d9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10895de90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10895ea10>]}


============================== 11:45:30.164170 | 78d588f7-3d91-4f44-9978-cada45857158 ==============================
[0m11:45:30.164170 [info ] [MainThread]: Running with dbt=1.7.10
[0m11:45:30.164531 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'fail_fast': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt debug', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m11:45:30.164878 [info ] [MainThread]: dbt version: 1.7.10
[0m11:45:30.165080 [info ] [MainThread]: python version: 3.11.5
[0m11:45:30.165264 [info ] [MainThread]: python path: /Users/melissabee/Documents/GitHub/client-loh-floor-area/venv/bin/python3
[0m11:45:30.165428 [info ] [MainThread]: os info: macOS-14.2.1-arm64-arm-64bit
[0m11:45:30.289429 [info ] [MainThread]: Using profiles dir at /Users/melissabee/.dbt
[0m11:45:30.289775 [info ] [MainThread]: Using profiles.yml file at /Users/melissabee/.dbt/profiles.yml
[0m11:45:30.289952 [info ] [MainThread]: Using dbt_project.yml file at /Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/dbt_project.yml
[0m11:45:30.290277 [info ] [MainThread]: adapter type: snowflake
[0m11:45:30.290488 [info ] [MainThread]: adapter version: 1.7.2
[0m11:45:30.325261 [info ] [MainThread]: Configuration:
[0m11:45:30.325588 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m11:45:30.325767 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m11:45:30.325927 [info ] [MainThread]: Required dependencies:
[0m11:45:30.326147 [debug] [MainThread]: Executing "git --help"
[0m11:45:30.336628 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           [--super-prefix=<path>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m11:45:30.337252 [debug] [MainThread]: STDERR: "b''"
[0m11:45:30.337491 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m11:45:30.337711 [info ] [MainThread]: Connection:
[0m11:45:30.337955 [info ] [MainThread]:   account: xr30261.west-europe.azure.snowflakecomputing.com
[0m11:45:30.338121 [info ] [MainThread]:   user: MELBOT
[0m11:45:30.338269 [info ] [MainThread]:   database: ANALYTICS_DEV
[0m11:45:30.338413 [info ] [MainThread]:   warehouse: TRANSFORMING
[0m11:45:30.338553 [info ] [MainThread]:   role: SYSADMIN
[0m11:45:30.338696 [info ] [MainThread]:   schema: dbt_melissa_rm_epc
[0m11:45:30.338842 [info ] [MainThread]:   authenticator: None
[0m11:45:30.338985 [info ] [MainThread]:   private_key_path: None
[0m11:45:30.339124 [info ] [MainThread]:   oauth_client_id: None
[0m11:45:30.339286 [info ] [MainThread]:   query_tag: None
[0m11:45:30.339439 [info ] [MainThread]:   client_session_keep_alive: False
[0m11:45:30.339588 [info ] [MainThread]:   host: None
[0m11:45:30.339734 [info ] [MainThread]:   port: None
[0m11:45:30.339900 [info ] [MainThread]:   proxy_host: None
[0m11:45:30.340051 [info ] [MainThread]:   proxy_port: None
[0m11:45:30.340192 [info ] [MainThread]:   protocol: None
[0m11:45:30.340335 [info ] [MainThread]:   connect_retries: 1
[0m11:45:30.340478 [info ] [MainThread]:   connect_timeout: None
[0m11:45:30.340623 [info ] [MainThread]:   retry_on_database_errors: False
[0m11:45:30.340768 [info ] [MainThread]:   retry_all: False
[0m11:45:30.340913 [info ] [MainThread]:   insecure_mode: False
[0m11:45:30.341056 [info ] [MainThread]:   reuse_connections: None
[0m11:45:30.341355 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m11:45:30.345531 [debug] [MainThread]: Acquiring new snowflake connection 'debug'
[0m11:45:30.346671 [debug] [MainThread]: Using snowflake connection "debug"
[0m11:45:30.346926 [debug] [MainThread]: On debug: select 1 as id
[0m11:45:30.347110 [debug] [MainThread]: Opening a new connection, currently in state init
[0m11:45:33.657036 [debug] [MainThread]: Snowflake adapter: Error running SQL: select 1 as id
[0m11:45:33.657459 [debug] [MainThread]: Snowflake adapter: Rolling back transaction.
[0m11:45:33.657814 [debug] [MainThread]: On debug: No close available on handle
[0m11:45:33.658138 [info ] [MainThread]:   Connection test: [[31mERROR[0m]

[0m11:45:33.658452 [info ] [MainThread]: [31m1 check failed:[0m
[0m11:45:33.658742 [info ] [MainThread]: dbt was unable to connect to the specified database.
The database returned the following error:

  >Database Error
  250001: Could not connect to Snowflake backend after 2 attempt(s).Aborting

Check your database credentials and try again. For more information, visit:
https://docs.getdbt.com/docs/configure-your-profile


[0m11:45:33.660328 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_wall_clock_time": 3.5279155, "process_user_time": 1.196283, "process_kernel_time": 0.13413, "process_mem_max_rss": "129564672", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m11:45:33.660833 [debug] [MainThread]: Command `dbt debug` failed at 11:45:33.660721 after 3.53 seconds
[0m11:45:33.661122 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m11:45:33.661409 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10898ec90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10475e110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104899cd0>]}
[0m11:45:33.661735 [debug] [MainThread]: Flushing usage events
[0m11:48:33.453855 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111152910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11115df10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11115ea50>]}


============================== 11:48:33.456455 | 343e2e78-a27d-4c11-b2b1-514763e4e197 ==============================
[0m11:48:33.456455 [info ] [MainThread]: Running with dbt=1.7.10
[0m11:48:33.456827 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'profiles_dir': '/Users/melissabee/.dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt debug', 'send_anonymous_usage_stats': 'True'}
[0m11:48:33.457188 [info ] [MainThread]: dbt version: 1.7.10
[0m11:48:33.457397 [info ] [MainThread]: python version: 3.11.5
[0m11:48:33.457578 [info ] [MainThread]: python path: /Users/melissabee/Documents/GitHub/client-loh-floor-area/venv/bin/python3
[0m11:48:33.457739 [info ] [MainThread]: os info: macOS-14.2.1-arm64-arm-64bit
[0m11:48:33.579591 [info ] [MainThread]: Using profiles dir at /Users/melissabee/.dbt
[0m11:48:33.579921 [info ] [MainThread]: Using profiles.yml file at /Users/melissabee/.dbt/profiles.yml
[0m11:48:33.580092 [info ] [MainThread]: Using dbt_project.yml file at /Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/dbt_project.yml
[0m11:48:33.580429 [info ] [MainThread]: adapter type: snowflake
[0m11:48:33.580629 [info ] [MainThread]: adapter version: 1.7.2
[0m11:48:33.615832 [info ] [MainThread]: Configuration:
[0m11:48:33.616179 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m11:48:33.616410 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m11:48:33.616653 [info ] [MainThread]: Required dependencies:
[0m11:48:33.616897 [debug] [MainThread]: Executing "git --help"
[0m11:48:33.628268 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           [--super-prefix=<path>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m11:48:33.628843 [debug] [MainThread]: STDERR: "b''"
[0m11:48:33.629072 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m11:48:33.629262 [info ] [MainThread]: Connection:
[0m11:48:33.629483 [info ] [MainThread]:   account: xr30261.west-europe.azure.snowflakecomputing.com
[0m11:48:33.629636 [info ] [MainThread]:   user: MELBOT
[0m11:48:33.629779 [info ] [MainThread]:   database: ANALYTICS_DEV
[0m11:48:33.629919 [info ] [MainThread]:   warehouse: TRANSFORMING
[0m11:48:33.630060 [info ] [MainThread]:   role: SYSADMIN
[0m11:48:33.630197 [info ] [MainThread]:   schema: dbt_melissa_rm_epc
[0m11:48:33.630340 [info ] [MainThread]:   authenticator: None
[0m11:48:33.630485 [info ] [MainThread]:   private_key_path: None
[0m11:48:33.630645 [info ] [MainThread]:   oauth_client_id: None
[0m11:48:33.630781 [info ] [MainThread]:   query_tag: None
[0m11:48:33.630926 [info ] [MainThread]:   client_session_keep_alive: False
[0m11:48:33.631063 [info ] [MainThread]:   host: None
[0m11:48:33.631200 [info ] [MainThread]:   port: None
[0m11:48:33.631346 [info ] [MainThread]:   proxy_host: None
[0m11:48:33.631517 [info ] [MainThread]:   proxy_port: None
[0m11:48:33.631663 [info ] [MainThread]:   protocol: None
[0m11:48:33.631808 [info ] [MainThread]:   connect_retries: 1
[0m11:48:33.631960 [info ] [MainThread]:   connect_timeout: None
[0m11:48:33.632120 [info ] [MainThread]:   retry_on_database_errors: False
[0m11:48:33.632275 [info ] [MainThread]:   retry_all: False
[0m11:48:33.632420 [info ] [MainThread]:   insecure_mode: False
[0m11:48:33.632570 [info ] [MainThread]:   reuse_connections: None
[0m11:48:33.632898 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m11:48:33.637345 [debug] [MainThread]: Acquiring new snowflake connection 'debug'
[0m11:48:33.638270 [debug] [MainThread]: Using snowflake connection "debug"
[0m11:48:33.638450 [debug] [MainThread]: On debug: select 1 as id
[0m11:48:33.638611 [debug] [MainThread]: Opening a new connection, currently in state init
[0m11:48:36.900189 [debug] [MainThread]: Snowflake adapter: Error running SQL: select 1 as id
[0m11:48:36.900473 [debug] [MainThread]: Snowflake adapter: Rolling back transaction.
[0m11:48:36.900683 [debug] [MainThread]: On debug: No close available on handle
[0m11:48:36.900896 [info ] [MainThread]:   Connection test: [[31mERROR[0m]

[0m11:48:36.901098 [info ] [MainThread]: [31m1 check failed:[0m
[0m11:48:36.901267 [info ] [MainThread]: dbt was unable to connect to the specified database.
The database returned the following error:

  >Database Error
  250001: Could not connect to Snowflake backend after 2 attempt(s).Aborting

Check your database credentials and try again. For more information, visit:
https://docs.getdbt.com/docs/configure-your-profile


[0m11:48:36.902370 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_wall_clock_time": 3.4783928, "process_user_time": 1.202821, "process_kernel_time": 0.136097, "process_mem_max_rss": "130973696", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m11:48:36.902818 [debug] [MainThread]: Command `dbt debug` failed at 11:48:36.902688 after 3.48 seconds
[0m11:48:36.903081 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m11:48:36.903322 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102f66110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11115e150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11115c910>]}
[0m11:48:36.903581 [debug] [MainThread]: Flushing usage events
[0m11:51:34.242574 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111718450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11175ded0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11175ea10>]}


============================== 11:51:34.245058 | 8f23b983-0c1a-448c-8448-5fae2d50f258 ==============================
[0m11:51:34.245058 [info ] [MainThread]: Running with dbt=1.7.10
[0m11:51:34.245422 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt debug', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m11:51:34.245802 [info ] [MainThread]: dbt version: 1.7.10
[0m11:51:34.245988 [info ] [MainThread]: python version: 3.11.5
[0m11:51:34.246175 [info ] [MainThread]: python path: /Users/melissabee/Documents/GitHub/client-loh-floor-area/venv/bin/python3
[0m11:51:34.246339 [info ] [MainThread]: os info: macOS-14.2.1-arm64-arm-64bit
[0m11:51:34.370575 [info ] [MainThread]: Using profiles dir at /Users/melissabee/.dbt
[0m11:51:34.370892 [info ] [MainThread]: Using profiles.yml file at /Users/melissabee/.dbt/profiles.yml
[0m11:51:34.371068 [info ] [MainThread]: Using dbt_project.yml file at /Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/dbt_project.yml
[0m11:51:34.371348 [info ] [MainThread]: adapter type: snowflake
[0m11:51:34.371505 [info ] [MainThread]: adapter version: 1.7.2
[0m11:51:34.406647 [info ] [MainThread]: Configuration:
[0m11:51:34.406993 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m11:51:34.407171 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m11:51:34.407332 [info ] [MainThread]: Required dependencies:
[0m11:51:34.407546 [debug] [MainThread]: Executing "git --help"
[0m11:51:34.419570 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           [--super-prefix=<path>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m11:51:34.420234 [debug] [MainThread]: STDERR: "b''"
[0m11:51:34.420461 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m11:51:34.420653 [info ] [MainThread]: Connection:
[0m11:51:34.420895 [info ] [MainThread]:   account: xr30261.west-europe.azure.snowflakecomputing.com
[0m11:51:34.421046 [info ] [MainThread]:   user: MELBOT
[0m11:51:34.421203 [info ] [MainThread]:   database: ANALYTICS_DEV
[0m11:51:34.421344 [info ] [MainThread]:   warehouse: TRANSFORMING
[0m11:51:34.421487 [info ] [MainThread]:   role: ACCOUNTADMIN
[0m11:51:34.421625 [info ] [MainThread]:   schema: dbt_melissa_rm_epc
[0m11:51:34.421765 [info ] [MainThread]:   authenticator: None
[0m11:51:34.421905 [info ] [MainThread]:   private_key_path: None
[0m11:51:34.422042 [info ] [MainThread]:   oauth_client_id: None
[0m11:51:34.422178 [info ] [MainThread]:   query_tag: None
[0m11:51:34.422313 [info ] [MainThread]:   client_session_keep_alive: False
[0m11:51:34.422448 [info ] [MainThread]:   host: None
[0m11:51:34.422583 [info ] [MainThread]:   port: None
[0m11:51:34.422719 [info ] [MainThread]:   proxy_host: None
[0m11:51:34.422856 [info ] [MainThread]:   proxy_port: None
[0m11:51:34.422987 [info ] [MainThread]:   protocol: None
[0m11:51:34.423120 [info ] [MainThread]:   connect_retries: 1
[0m11:51:34.423253 [info ] [MainThread]:   connect_timeout: None
[0m11:51:34.423383 [info ] [MainThread]:   retry_on_database_errors: False
[0m11:51:34.423515 [info ] [MainThread]:   retry_all: False
[0m11:51:34.423648 [info ] [MainThread]:   insecure_mode: False
[0m11:51:34.423778 [info ] [MainThread]:   reuse_connections: None
[0m11:51:34.424030 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m11:51:34.427899 [debug] [MainThread]: Acquiring new snowflake connection 'debug'
[0m11:51:34.429010 [debug] [MainThread]: Using snowflake connection "debug"
[0m11:51:34.429221 [debug] [MainThread]: On debug: select 1 as id
[0m11:51:34.429381 [debug] [MainThread]: Opening a new connection, currently in state init
[0m11:51:37.685463 [debug] [MainThread]: Snowflake adapter: Error running SQL: select 1 as id
[0m11:51:37.685785 [debug] [MainThread]: Snowflake adapter: Rolling back transaction.
[0m11:51:37.686049 [debug] [MainThread]: On debug: No close available on handle
[0m11:51:37.686308 [info ] [MainThread]:   Connection test: [[31mERROR[0m]

[0m11:51:37.686547 [info ] [MainThread]: [31m1 check failed:[0m
[0m11:51:37.686761 [info ] [MainThread]: dbt was unable to connect to the specified database.
The database returned the following error:

  >Database Error
  250001: Could not connect to Snowflake backend after 2 attempt(s).Aborting

Check your database credentials and try again. For more information, visit:
https://docs.getdbt.com/docs/configure-your-profile


[0m11:51:37.687983 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_wall_clock_time": 3.4748862, "process_user_time": 1.209448, "process_kernel_time": 0.142423, "process_mem_max_rss": "131203072", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m11:51:37.688370 [debug] [MainThread]: Command `dbt debug` failed at 11:51:37.688280 after 3.48 seconds
[0m11:51:37.688601 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m11:51:37.688828 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11178c550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1034d6110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110fd3ad0>]}
[0m11:51:37.689087 [debug] [MainThread]: Flushing usage events
[0m11:52:15.700707 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a718510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a761950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a7625d0>]}


============================== 11:52:15.702969 | 149085df-d51f-4f60-9fa8-e30a8d4dbac7 ==============================
[0m11:52:15.702969 [info ] [MainThread]: Running with dbt=1.7.10
[0m11:52:15.703321 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt debug', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m11:52:15.703689 [info ] [MainThread]: dbt version: 1.7.10
[0m11:52:15.703886 [info ] [MainThread]: python version: 3.11.5
[0m11:52:15.704064 [info ] [MainThread]: python path: /Users/melissabee/Documents/GitHub/client-loh-floor-area/venv/bin/python3
[0m11:52:15.704220 [info ] [MainThread]: os info: macOS-14.2.1-arm64-arm-64bit
[0m11:52:15.812924 [info ] [MainThread]: Using profiles dir at /Users/melissabee/.dbt
[0m11:52:15.813250 [info ] [MainThread]: Using profiles.yml file at /Users/melissabee/.dbt/profiles.yml
[0m11:52:15.813431 [info ] [MainThread]: Using dbt_project.yml file at /Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/dbt_project.yml
[0m11:52:15.849593 [info ] [MainThread]: Configuration:
[0m11:52:15.849957 [info ] [MainThread]:   profiles.yml file [[31mERROR invalid[0m]
[0m11:52:15.850138 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m11:52:15.850303 [info ] [MainThread]: Required dependencies:
[0m11:52:15.850517 [debug] [MainThread]: Executing "git --help"
[0m11:52:15.861631 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           [--super-prefix=<path>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m11:52:15.862265 [debug] [MainThread]: STDERR: "b''"
[0m11:52:15.862494 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m11:52:15.862718 [info ] [MainThread]: Connection test skipped since no profile was found
[0m11:52:15.862896 [info ] [MainThread]: [31m1 check failed:[0m
[0m11:52:15.863061 [info ] [MainThread]: Profile loading failed for the following reason:
Runtime Error
  Credentials in profile "rightmove_epc", target "dev" invalid: None is not of type 'string'


[0m11:52:15.864277 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_wall_clock_time": 0.19145691, "process_user_time": 1.021263, "process_kernel_time": 0.114237, "process_mem_max_rss": "118095872", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m11:52:15.864654 [debug] [MainThread]: Command `dbt debug` failed at 11:52:15.864577 after 0.19 seconds
[0m11:52:15.864962 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11a711310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104c92110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11b1b2ad0>]}
[0m11:52:15.865232 [debug] [MainThread]: Flushing usage events
[0m11:52:46.067998 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104d1b1d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104d5dc10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104d5ed10>]}


============================== 11:52:46.070654 | 248022ee-864c-4172-99f5-7989412dda46 ==============================
[0m11:52:46.070654 [info ] [MainThread]: Running with dbt=1.7.10
[0m11:52:46.071038 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'profiles_dir': '/Users/melissabee/.dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt debug', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m11:52:46.071437 [info ] [MainThread]: dbt version: 1.7.10
[0m11:52:46.071642 [info ] [MainThread]: python version: 3.11.5
[0m11:52:46.071828 [info ] [MainThread]: python path: /Users/melissabee/Documents/GitHub/client-loh-floor-area/venv/bin/python3
[0m11:52:46.072006 [info ] [MainThread]: os info: macOS-14.2.1-arm64-arm-64bit
[0m11:52:46.075575 [info ] [MainThread]: target not specified in profile 'rightmove_epc', using 'default'
[0m11:52:46.075911 [info ] [MainThread]: Using profiles dir at /Users/melissabee/.dbt
[0m11:52:46.076090 [info ] [MainThread]: Using profiles.yml file at /Users/melissabee/.dbt/profiles.yml
[0m11:52:46.076253 [info ] [MainThread]: Using dbt_project.yml file at /Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/dbt_project.yml
[0m11:52:46.113978 [info ] [MainThread]: Configuration:
[0m11:52:46.114351 [info ] [MainThread]:   profiles.yml file [[31mERROR invalid[0m]
[0m11:52:46.114531 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m11:52:46.114694 [info ] [MainThread]: Required dependencies:
[0m11:52:46.114914 [debug] [MainThread]: Executing "git --help"
[0m11:52:46.125599 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           [--super-prefix=<path>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m11:52:46.126288 [debug] [MainThread]: STDERR: "b''"
[0m11:52:46.126514 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m11:52:46.126716 [info ] [MainThread]: Connection test skipped since no profile was found
[0m11:52:46.126892 [info ] [MainThread]: [31m1 check failed:[0m
[0m11:52:46.127049 [info ] [MainThread]: Profile loading failed for the following reason:
Runtime Error
  The profile 'rightmove_epc' does not have a target named 'default'. The valid target names for this profile are:
   - dev


[0m11:52:46.128159 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_wall_clock_time": 0.08801825, "process_user_time": 0.945173, "process_kernel_time": 0.08742, "process_mem_max_rss": "105676800", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m11:52:46.128516 [debug] [MainThread]: Command `dbt debug` failed at 11:52:46.128442 after 0.09 seconds
[0m11:52:46.128805 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10095a110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104d5cc10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104d5e7d0>]}
[0m11:52:46.129088 [debug] [MainThread]: Flushing usage events
[0m11:53:07.748205 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107354350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10738dfd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107392610>]}


============================== 11:53:07.750632 | 09a8be59-1616-4bc3-bcea-fc0f3f4c12be ==============================
[0m11:53:07.750632 [info ] [MainThread]: Running with dbt=1.7.10
[0m11:53:07.750996 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/Users/melissabee/.dbt', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt debug', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m11:53:07.751359 [info ] [MainThread]: dbt version: 1.7.10
[0m11:53:07.751550 [info ] [MainThread]: python version: 3.11.5
[0m11:53:07.751731 [info ] [MainThread]: python path: /Users/melissabee/Documents/GitHub/client-loh-floor-area/venv/bin/python3
[0m11:53:07.751892 [info ] [MainThread]: os info: macOS-14.2.1-arm64-arm-64bit
[0m11:53:07.876120 [info ] [MainThread]: Using profiles dir at /Users/melissabee/.dbt
[0m11:53:07.876468 [info ] [MainThread]: Using profiles.yml file at /Users/melissabee/.dbt/profiles.yml
[0m11:53:07.876645 [info ] [MainThread]: Using dbt_project.yml file at /Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/dbt_project.yml
[0m11:53:07.876935 [info ] [MainThread]: adapter type: snowflake
[0m11:53:07.877094 [info ] [MainThread]: adapter version: 1.7.2
[0m11:53:07.913062 [info ] [MainThread]: Configuration:
[0m11:53:07.913424 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m11:53:07.913611 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m11:53:07.913789 [info ] [MainThread]: Required dependencies:
[0m11:53:07.914023 [debug] [MainThread]: Executing "git --help"
[0m11:53:07.925267 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           [--super-prefix=<path>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m11:53:07.925908 [debug] [MainThread]: STDERR: "b''"
[0m11:53:07.926113 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m11:53:07.926296 [info ] [MainThread]: Connection:
[0m11:53:07.926527 [info ] [MainThread]:   account: xr30261.west-europe.azure.snowflakecomputing.com
[0m11:53:07.926676 [info ] [MainThread]:   user: MELBOT
[0m11:53:07.926817 [info ] [MainThread]:   database: ANALYTICS_DEV
[0m11:53:07.926987 [info ] [MainThread]:   warehouse: TRANSFORMING
[0m11:53:07.927130 [info ] [MainThread]:   role: SYSADMIN
[0m11:53:07.927269 [info ] [MainThread]:   schema: dbt_melissa_rm_epc
[0m11:53:07.927408 [info ] [MainThread]:   authenticator: None
[0m11:53:07.927549 [info ] [MainThread]:   private_key_path: None
[0m11:53:07.927687 [info ] [MainThread]:   oauth_client_id: None
[0m11:53:07.927823 [info ] [MainThread]:   query_tag: None
[0m11:53:07.927965 [info ] [MainThread]:   client_session_keep_alive: False
[0m11:53:07.928142 [info ] [MainThread]:   host: None
[0m11:53:07.928284 [info ] [MainThread]:   port: None
[0m11:53:07.928422 [info ] [MainThread]:   proxy_host: None
[0m11:53:07.928556 [info ] [MainThread]:   proxy_port: None
[0m11:53:07.928692 [info ] [MainThread]:   protocol: None
[0m11:53:07.928827 [info ] [MainThread]:   connect_retries: 1
[0m11:53:07.928959 [info ] [MainThread]:   connect_timeout: None
[0m11:53:07.929094 [info ] [MainThread]:   retry_on_database_errors: False
[0m11:53:07.929228 [info ] [MainThread]:   retry_all: False
[0m11:53:07.929360 [info ] [MainThread]:   insecure_mode: False
[0m11:53:07.929493 [info ] [MainThread]:   reuse_connections: None
[0m11:53:07.929726 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m11:53:07.933578 [debug] [MainThread]: Acquiring new snowflake connection 'debug'
[0m11:53:07.934727 [debug] [MainThread]: Using snowflake connection "debug"
[0m11:53:07.935028 [debug] [MainThread]: On debug: select 1 as id
[0m11:53:07.935214 [debug] [MainThread]: Opening a new connection, currently in state init
[0m11:53:11.177027 [debug] [MainThread]: Snowflake adapter: Error running SQL: select 1 as id
[0m11:53:11.177397 [debug] [MainThread]: Snowflake adapter: Rolling back transaction.
[0m11:53:11.177666 [debug] [MainThread]: On debug: No close available on handle
[0m11:53:11.177925 [info ] [MainThread]:   Connection test: [[31mERROR[0m]

[0m11:53:11.178149 [info ] [MainThread]: [31m1 check failed:[0m
[0m11:53:11.178363 [info ] [MainThread]: dbt was unable to connect to the specified database.
The database returned the following error:

  >Database Error
  250001: Could not connect to Snowflake backend after 2 attempt(s).Aborting

Check your database credentials and try again. For more information, visit:
https://docs.getdbt.com/docs/configure-your-profile


[0m11:53:11.179572 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_wall_clock_time": 3.4595697, "process_user_time": 1.17996, "process_kernel_time": 0.125863, "process_mem_max_rss": "130695168", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m11:53:11.179975 [debug] [MainThread]: Command `dbt debug` failed at 11:53:11.179884 after 3.46 seconds
[0m11:53:11.180201 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m11:53:11.180448 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10312e110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106dd3210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103269cd0>]}
[0m11:53:11.180730 [debug] [MainThread]: Flushing usage events
[0m11:55:35.721340 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109754550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10978dfd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109799c10>]}


============================== 11:55:35.724386 | 20c7a4e4-3306-4cc9-8f80-981209cf18d3 ==============================
[0m11:55:35.724386 [info ] [MainThread]: Running with dbt=1.7.10
[0m11:55:35.724753 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt debug', 'send_anonymous_usage_stats': 'True'}
[0m11:55:35.725114 [info ] [MainThread]: dbt version: 1.7.10
[0m11:55:35.725306 [info ] [MainThread]: python version: 3.11.5
[0m11:55:35.725488 [info ] [MainThread]: python path: /Users/melissabee/Documents/GitHub/client-loh-floor-area/venv/bin/python3
[0m11:55:35.725648 [info ] [MainThread]: os info: macOS-14.2.1-arm64-arm-64bit
[0m11:55:35.885474 [info ] [MainThread]: Using profiles dir at /Users/melissabee/.dbt
[0m11:55:35.885792 [info ] [MainThread]: Using profiles.yml file at /Users/melissabee/.dbt/profiles.yml
[0m11:55:35.885970 [info ] [MainThread]: Using dbt_project.yml file at /Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/dbt_project.yml
[0m11:55:35.886351 [info ] [MainThread]: adapter type: snowflake
[0m11:55:35.886559 [info ] [MainThread]: adapter version: 1.7.2
[0m11:55:35.923109 [info ] [MainThread]: Configuration:
[0m11:55:35.923440 [info ] [MainThread]:   profiles.yml file [[32mOK found and valid[0m]
[0m11:55:35.923624 [info ] [MainThread]:   dbt_project.yml file [[32mOK found and valid[0m]
[0m11:55:35.923797 [info ] [MainThread]: Required dependencies:
[0m11:55:35.924014 [debug] [MainThread]: Executing "git --help"
[0m11:55:35.938564 [debug] [MainThread]: STDOUT: "b"usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]\n           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]\n           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]\n           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]\n           [--super-prefix=<path>] [--config-env=<name>=<envvar>]\n           <command> [<args>]\n\nThese are common Git commands used in various situations:\n\nstart a working area (see also: git help tutorial)\n   clone     Clone a repository into a new directory\n   init      Create an empty Git repository or reinitialize an existing one\n\nwork on the current change (see also: git help everyday)\n   add       Add file contents to the index\n   mv        Move or rename a file, a directory, or a symlink\n   restore   Restore working tree files\n   rm        Remove files from the working tree and from the index\n\nexamine the history and state (see also: git help revisions)\n   bisect    Use binary search to find the commit that introduced a bug\n   diff      Show changes between commits, commit and working tree, etc\n   grep      Print lines matching a pattern\n   log       Show commit logs\n   show      Show various types of objects\n   status    Show the working tree status\n\ngrow, mark and tweak your common history\n   branch    List, create, or delete branches\n   commit    Record changes to the repository\n   merge     Join two or more development histories together\n   rebase    Reapply commits on top of another base tip\n   reset     Reset current HEAD to the specified state\n   switch    Switch branches\n   tag       Create, list, delete or verify a tag object signed with GPG\n\ncollaborate (see also: git help workflows)\n   fetch     Download objects and refs from another repository\n   pull      Fetch from and integrate with another repository or a local branch\n   push      Update remote refs along with associated objects\n\n'git help -a' and 'git help -g' list available subcommands and some\nconcept guides. See 'git help <command>' or 'git help <concept>'\nto read about a specific subcommand or concept.\nSee 'git help git' for an overview of the system.\n""
[0m11:55:35.939221 [debug] [MainThread]: STDERR: "b''"
[0m11:55:35.939473 [info ] [MainThread]:  - git [[32mOK found[0m]

[0m11:55:35.939669 [info ] [MainThread]: Connection:
[0m11:55:35.939889 [info ] [MainThread]:   account: xr30261.west-europe.azure
[0m11:55:35.940045 [info ] [MainThread]:   user: MELBOT
[0m11:55:35.940193 [info ] [MainThread]:   database: ANALYTICS_DEV
[0m11:55:35.940338 [info ] [MainThread]:   warehouse: TRANSFORMING
[0m11:55:35.940475 [info ] [MainThread]:   role: SYSADMIN
[0m11:55:35.940616 [info ] [MainThread]:   schema: dbt_melissa_rm_epc
[0m11:55:35.940761 [info ] [MainThread]:   authenticator: None
[0m11:55:35.940903 [info ] [MainThread]:   private_key_path: None
[0m11:55:35.941040 [info ] [MainThread]:   oauth_client_id: None
[0m11:55:35.941174 [info ] [MainThread]:   query_tag: None
[0m11:55:35.941315 [info ] [MainThread]:   client_session_keep_alive: False
[0m11:55:35.941451 [info ] [MainThread]:   host: None
[0m11:55:35.941592 [info ] [MainThread]:   port: None
[0m11:55:35.941730 [info ] [MainThread]:   proxy_host: None
[0m11:55:35.941874 [info ] [MainThread]:   proxy_port: None
[0m11:55:35.942007 [info ] [MainThread]:   protocol: None
[0m11:55:35.942145 [info ] [MainThread]:   connect_retries: 1
[0m11:55:35.942280 [info ] [MainThread]:   connect_timeout: None
[0m11:55:35.942416 [info ] [MainThread]:   retry_on_database_errors: False
[0m11:55:35.942550 [info ] [MainThread]:   retry_all: False
[0m11:55:35.942689 [info ] [MainThread]:   insecure_mode: False
[0m11:55:35.942828 [info ] [MainThread]:   reuse_connections: None
[0m11:55:35.943091 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m11:55:35.948383 [debug] [MainThread]: Acquiring new snowflake connection 'debug'
[0m11:55:35.949467 [debug] [MainThread]: Using snowflake connection "debug"
[0m11:55:35.949658 [debug] [MainThread]: On debug: select 1 as id
[0m11:55:35.949827 [debug] [MainThread]: Opening a new connection, currently in state init
[0m11:55:37.694329 [debug] [MainThread]: SQL status: SUCCESS 1 in 2.0 seconds
[0m11:55:37.696458 [debug] [MainThread]: On debug: Close
[0m11:55:38.160397 [info ] [MainThread]:   Connection test: [[32mOK connection ok[0m]

[0m11:55:38.160916 [info ] [MainThread]: [32mAll checks passed![0m
[0m11:55:38.162930 [debug] [MainThread]: Resource report: {"command_name": "debug", "command_success": true, "command_wall_clock_time": 2.4734325, "process_user_time": 1.107153, "process_kernel_time": 0.159704, "process_mem_max_rss": "127270912", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m11:55:38.163337 [debug] [MainThread]: Command `dbt debug` succeeded at 11:55:38.163245 after 2.47 seconds
[0m11:55:38.163565 [debug] [MainThread]: Connection 'debug' was properly closed.
[0m11:55:38.163804 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10979a110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a426810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1090f5690>]}
[0m11:55:38.164168 [debug] [MainThread]: Flushing usage events
[0m11:55:44.864736 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10875b510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108207150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10879ed10>]}


============================== 11:55:44.867484 | 4d1b53d3-3319-4488-b9bf-1f1aebc9cacf ==============================
[0m11:55:44.867484 [info ] [MainThread]: Running with dbt=1.7.10
[0m11:55:44.867867 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m11:55:45.037883 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4d1b53d3-3319-4488-b9bf-1f1aebc9cacf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1082db110>]}
[0m11:55:45.079032 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4d1b53d3-3319-4488-b9bf-1f1aebc9cacf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1082db110>]}
[0m11:55:45.079625 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m11:55:45.090671 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m11:55:45.091284 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m11:55:45.091556 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '4d1b53d3-3319-4488-b9bf-1f1aebc9cacf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1091f7d50>]}
[0m11:55:45.490673 [warn ] [MainThread]: [[33mWARNING[0m]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.rightmove_epc.staging
[0m11:55:45.493779 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4d1b53d3-3319-4488-b9bf-1f1aebc9cacf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109216fd0>]}
[0m11:55:45.500067 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4d1b53d3-3319-4488-b9bf-1f1aebc9cacf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109322190>]}
[0m11:55:45.500415 [info ] [MainThread]: Found 0 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m11:55:45.500642 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4d1b53d3-3319-4488-b9bf-1f1aebc9cacf', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105ccbed0>]}
[0m11:55:45.501407 [info ] [MainThread]: 
[0m11:55:45.501659 [warn ] [MainThread]: Nothing to do. Try checking your model configs and model specification args
[0m11:55:45.501929 [debug] [MainThread]: Command end result
[0m11:55:45.507057 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.6713301, "process_user_time": 1.479146, "process_kernel_time": 0.138256, "process_mem_max_rss": "125190144", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m11:55:45.507400 [debug] [MainThread]: Command `dbt run` succeeded at 11:55:45.507330 after 0.67 seconds
[0m11:55:45.507624 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104906110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104a41cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1048ee710>]}
[0m11:55:45.507854 [debug] [MainThread]: Flushing usage events
[0m12:13:42.593646 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113b34e90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113b5e550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113b5f090>]}


============================== 12:13:42.596620 | dfa026c0-af61-4f2e-8cf1-f4d156899704 ==============================
[0m12:13:42.596620 [info ] [MainThread]: Running with dbt=1.7.10
[0m12:13:42.596996 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m12:13:42.782633 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'dfa026c0-af61-4f2e-8cf1-f4d156899704', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112f54050>]}
[0m12:13:42.823869 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'dfa026c0-af61-4f2e-8cf1-f4d156899704', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113ba9190>]}
[0m12:13:42.824577 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m12:13:42.835166 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m12:13:42.858521 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m12:13:42.858826 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m12:13:42.862430 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'dfa026c0-af61-4f2e-8cf1-f4d156899704', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1147a0650>]}
[0m12:13:42.869658 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'dfa026c0-af61-4f2e-8cf1-f4d156899704', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1148baad0>]}
[0m12:13:42.870027 [info ] [MainThread]: Found 3 models, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m12:13:42.870263 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dfa026c0-af61-4f2e-8cf1-f4d156899704', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11478e750>]}
[0m12:13:42.871374 [info ] [MainThread]: 
[0m12:13:42.871887 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m12:13:42.872612 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m12:13:42.880117 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m12:13:42.880430 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m12:13:42.880622 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:13:43.300631 [debug] [ThreadPool]: SQL status: SUCCESS 45 in 0.0 seconds
[0m12:13:43.304061 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m12:13:43.390584 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now create_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m12:13:43.391687 [debug] [ThreadPool]: Creating schema "database: "ANALYTICS_DEV"
schema: "dbt_melissa_rm_epc"
"
[0m12:13:43.396584 [debug] [ThreadPool]: Using snowflake connection "create_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m12:13:43.396808 [debug] [ThreadPool]: On create_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "create_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
create schema if not exists ANALYTICS_DEV.dbt_melissa_rm_epc
[0m12:13:43.396979 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:13:43.801236 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.0 seconds
[0m12:13:43.802352 [debug] [ThreadPool]: On create_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m12:13:43.905194 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_ANALYTICS_DEV_dbt_melissa_rm_epc, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m12:13:43.913066 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m12:13:43.913394 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m12:13:43.913649 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:13:44.320529 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.0 seconds
[0m12:13:44.322312 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m12:13:44.399785 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dfa026c0-af61-4f2e-8cf1-f4d156899704', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113b2cc50>]}
[0m12:13:44.400718 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m12:13:44.401061 [info ] [MainThread]: 
[0m12:13:44.404422 [debug] [Thread-1 (]: Began running node model.rightmove_epc.stg_epc_certs
[0m12:13:44.405127 [debug] [Thread-2 (]: Began running node model.rightmove_epc.stg_rightmove
[0m12:13:44.405575 [info ] [Thread-1 (]: 1 of 3 START sql view model dbt_melissa_rm_epc.stg_epc_certs ................... [RUN]
[0m12:13:44.405982 [info ] [Thread-2 (]: 2 of 3 START sql view model dbt_melissa_rm_epc.stg_rightmove ................... [RUN]
[0m12:13:44.406580 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.stg_epc_certs)
[0m12:13:44.407194 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.stg_rightmove'
[0m12:13:44.407508 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.stg_epc_certs
[0m12:13:44.407796 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.stg_rightmove
[0m12:13:44.413714 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.stg_epc_certs"
[0m12:13:44.417388 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.stg_rightmove"
[0m12:13:44.418538 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (compile): 12:13:44.414103 => 12:13:44.418340
[0m12:13:44.418854 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (compile): 12:13:44.407987 => 12:13:44.418705
[0m12:13:44.419101 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.stg_rightmove
[0m12:13:44.419334 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.stg_epc_certs
[0m12:13:44.469932 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.stg_rightmove"
[0m12:13:44.471870 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.stg_epc_certs"
[0m12:13:44.473241 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.stg_rightmove"
[0m12:13:44.473803 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.stg_epc_certs"
[0m12:13:44.474111 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_rightmove"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
  
   as (
    with rm as (

    SELECT 
    REPLACE(CONCAT(ADDRESS_1::VARCHAR,ADDRESS_2::VARCHAR),' ') AS ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL 
    FROM 
       ANALYTICS.RIGHTMOVE_PROD.CLEAN_RAW_RIGHTMOVE_DATA 

 
)

SELECT * FROM rm
  );
[0m12:13:44.474435 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_epc_certs"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
  
   as (
    WITH epc_certs as (
    
    select 
    UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    COUNTY,
    LOCAL_AUTHORITY as LOCAL_AUTHORITY_CODE,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    replace(ADDRESS1,' ') AS ADDRESSID
 from  RAW.EPC_TEST_DATA.EPC_CERTIFICATES 

)

SELECT * FROM epc_certs
  );
[0m12:13:44.474692 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m12:13:44.474922 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:13:44.964156 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m12:13:44.984988 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (execute): 12:13:44.470134 => 12:13:44.984793
[0m12:13:44.985370 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: Close
[0m12:13:45.095515 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dfa026c0-af61-4f2e-8cf1-f4d156899704', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114983350>]}
[0m12:13:45.096105 [info ] [Thread-1 (]: 1 of 3 OK created sql view model dbt_melissa_rm_epc.stg_epc_certs .............. [[32mSUCCESS 1[0m in 0.69s]
[0m12:13:45.096521 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.stg_epc_certs
[0m12:13:45.124406 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:13:45.126243 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (execute): 12:13:44.419477 => 12:13:45.126101
[0m12:13:45.126517 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: Close
[0m12:13:45.211616 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dfa026c0-af61-4f2e-8cf1-f4d156899704', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114a53950>]}
[0m12:13:45.212209 [info ] [Thread-2 (]: 2 of 3 OK created sql view model dbt_melissa_rm_epc.stg_rightmove .............. [[32mSUCCESS 1[0m in 0.80s]
[0m12:13:45.212617 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.stg_rightmove
[0m12:13:45.213057 [debug] [Thread-4 (]: Began running node model.rightmove_epc.uprn_match
[0m12:13:45.213424 [info ] [Thread-4 (]: 3 of 3 START sql view model dbt_melissa_rm_epc.uprn_match ...................... [RUN]
[0m12:13:45.213903 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.rightmove_epc.uprn_match'
[0m12:13:45.214130 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.uprn_match
[0m12:13:45.216127 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.uprn_match"
[0m12:13:45.216801 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.uprn_match (compile): 12:13:45.214269 => 12:13:45.216668
[0m12:13:45.217029 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.uprn_match
[0m12:13:45.219506 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.uprn_match"
[0m12:13:45.220431 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.uprn_match"
[0m12:13:45.220694 [debug] [Thread-4 (]: On model.rightmove_epc.uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
  
   as (
    with epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    where uprn is not null

),

rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where uprn is not null
),

final as (

    select * from rm left join epc on r.uprn = epc.uprn
)

select * from final
  );
[0m12:13:45.220938 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m12:13:45.652390 [debug] [Thread-4 (]: Snowflake adapter: Snowflake query id: 01b33edd-0103-9a1f-0000-719506351df6
[0m12:13:45.652775 [debug] [Thread-4 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 19 at position 38
invalid identifier 'R.UPRN'
[0m12:13:45.653190 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.uprn_match (execute): 12:13:45.217167 => 12:13:45.653036
[0m12:13:45.653455 [debug] [Thread-4 (]: On model.rightmove_epc.uprn_match: Close
[0m12:13:45.736528 [debug] [Thread-4 (]: Database Error in model uprn_match (models/matching/uprn_match.sql)
  000904 (42000): SQL compilation error: error line 19 at position 38
  invalid identifier 'R.UPRN'
  compiled Code at target/run/rightmove_epc/models/matching/uprn_match.sql
[0m12:13:45.736902 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dfa026c0-af61-4f2e-8cf1-f4d156899704', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113b2cc50>]}
[0m12:13:45.737237 [error] [Thread-4 (]: 3 of 3 ERROR creating sql view model dbt_melissa_rm_epc.uprn_match ............. [[31mERROR[0m in 0.52s]
[0m12:13:45.737561 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.uprn_match
[0m12:13:45.738585 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:13:45.738783 [debug] [MainThread]: Connection 'model.rightmove_epc.stg_epc_certs' was properly closed.
[0m12:13:45.738942 [debug] [MainThread]: Connection 'model.rightmove_epc.stg_rightmove' was properly closed.
[0m12:13:45.739084 [debug] [MainThread]: Connection 'model.rightmove_epc.uprn_match' was properly closed.
[0m12:13:45.739261 [info ] [MainThread]: 
[0m12:13:45.739439 [info ] [MainThread]: Finished running 3 view models in 0 hours 0 minutes and 2.87 seconds (2.87s).
[0m12:13:45.739871 [debug] [MainThread]: Command end result
[0m12:13:45.744555 [info ] [MainThread]: 
[0m12:13:45.744794 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m12:13:45.744961 [info ] [MainThread]: 
[0m12:13:45.745122 [error] [MainThread]:   Database Error in model uprn_match (models/matching/uprn_match.sql)
  000904 (42000): SQL compilation error: error line 19 at position 38
  invalid identifier 'R.UPRN'
  compiled Code at target/run/rightmove_epc/models/matching/uprn_match.sql
[0m12:13:45.745290 [info ] [MainThread]: 
[0m12:13:45.745462 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
[0m12:13:45.747050 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 3.1864548, "process_user_time": 1.44048, "process_kernel_time": 0.172646, "process_mem_max_rss": "137003008", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m12:13:45.747381 [debug] [MainThread]: Command `dbt run` failed at 12:13:45.747312 after 3.19 seconds
[0m12:13:45.747607 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104e0e110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1128c8d10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f10f10>]}
[0m12:13:45.747815 [debug] [MainThread]: Flushing usage events
[0m12:22:37.888303 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1075187d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1075528d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10755eb90>]}


============================== 12:22:37.891363 | b2fd0f56-dd39-4e92-a59b-a96431d14130 ==============================
[0m12:22:37.891363 [info ] [MainThread]: Running with dbt=1.7.10
[0m12:22:37.891747 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m12:22:38.077859 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b2fd0f56-dd39-4e92-a59b-a96431d14130', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106e54350>]}
[0m12:22:38.118294 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b2fd0f56-dd39-4e92-a59b-a96431d14130', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1075188d0>]}
[0m12:22:38.119202 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m12:22:38.129819 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m12:22:38.152620 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m12:22:38.152897 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m12:22:38.156302 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b2fd0f56-dd39-4e92-a59b-a96431d14130', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108399350>]}
[0m12:22:38.162784 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b2fd0f56-dd39-4e92-a59b-a96431d14130', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1081e9d50>]}
[0m12:22:38.163093 [info ] [MainThread]: Found 4 models, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m12:22:38.163310 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b2fd0f56-dd39-4e92-a59b-a96431d14130', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107eac4d0>]}
[0m12:22:38.164304 [info ] [MainThread]: 
[0m12:22:38.164759 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m12:22:38.165444 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m12:22:38.172706 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m12:22:38.172973 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m12:22:38.173169 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:22:38.811665 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 1.0 seconds
[0m12:22:38.814107 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m12:22:38.937078 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m12:22:38.946946 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m12:22:38.947389 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m12:22:38.947819 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:22:39.433019 [debug] [ThreadPool]: SQL status: SUCCESS 2 in 0.0 seconds
[0m12:22:39.435422 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m12:22:39.531186 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b2fd0f56-dd39-4e92-a59b-a96431d14130', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10818a090>]}
[0m12:22:39.532337 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m12:22:39.532812 [info ] [MainThread]: 
[0m12:22:39.536334 [debug] [Thread-1 (]: Began running node model.rightmove_epc.stg_epc_certs
[0m12:22:39.536815 [debug] [Thread-2 (]: Began running node model.rightmove_epc.stg_rightmove
[0m12:22:39.537361 [info ] [Thread-1 (]: 1 of 4 START sql view model dbt_melissa_rm_epc.stg_epc_certs ................... [RUN]
[0m12:22:39.537878 [info ] [Thread-2 (]: 2 of 4 START sql view model dbt_melissa_rm_epc.stg_rightmove ................... [RUN]
[0m12:22:39.538785 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.stg_epc_certs)
[0m12:22:39.539656 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.stg_rightmove'
[0m12:22:39.540064 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.stg_epc_certs
[0m12:22:39.540409 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.stg_rightmove
[0m12:22:39.545604 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.stg_rightmove"
[0m12:22:39.550658 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.stg_epc_certs"
[0m12:22:39.551409 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (compile): 12:22:39.542830 => 12:22:39.551171
[0m12:22:39.551858 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (compile): 12:22:39.540623 => 12:22:39.551653
[0m12:22:39.552178 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.stg_rightmove
[0m12:22:39.552515 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.stg_epc_certs
[0m12:22:39.572219 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.stg_rightmove"
[0m12:22:39.575402 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.stg_epc_certs"
[0m12:22:39.576419 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.stg_rightmove"
[0m12:22:39.576747 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_rightmove"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
  
   as (
    with rm as (

    SELECT 
    REPLACE(CONCAT(ADDRESS_1::VARCHAR,ADDRESS_2::VARCHAR),' ') AS ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL 
    FROM 
       ANALYTICS.RIGHTMOVE_PROD.CLEAN_RAW_RIGHTMOVE_DATA 

 
)

SELECT * FROM rm
  );
[0m12:22:39.577293 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.stg_epc_certs"
[0m12:22:39.577532 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m12:22:39.577805 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_epc_certs"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
  
   as (
    WITH epc_certs as (
    
    select 
    UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    COUNTY,
    LOCAL_AUTHORITY as LOCAL_AUTHORITY_CODE,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    replace(ADDRESS1,' ') AS ADDRESSID
 from  RAW.EPC_TEST_DATA.EPC_CERTIFICATES 

)

SELECT * FROM epc_certs
  );
[0m12:22:39.610193 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:22:40.162564 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:22:40.184454 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (execute): 12:22:39.572519 => 12:22:40.184262
[0m12:22:40.184838 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: Close
[0m12:22:40.188549 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:22:40.190692 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (execute): 12:22:39.552709 => 12:22:40.190546
[0m12:22:40.190992 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: Close
[0m12:22:40.280307 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b2fd0f56-dd39-4e92-a59b-a96431d14130', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1081c5d50>]}
[0m12:22:40.281049 [info ] [Thread-1 (]: 1 of 4 OK created sql view model dbt_melissa_rm_epc.stg_epc_certs .............. [[32mSUCCESS 1[0m in 0.74s]
[0m12:22:40.282035 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.stg_epc_certs
[0m12:22:40.284418 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b2fd0f56-dd39-4e92-a59b-a96431d14130', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1084e1290>]}
[0m12:22:40.284937 [info ] [Thread-2 (]: 2 of 4 OK created sql view model dbt_melissa_rm_epc.stg_rightmove .............. [[32mSUCCESS 1[0m in 0.75s]
[0m12:22:40.285388 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.stg_rightmove
[0m12:22:40.285913 [debug] [Thread-4 (]: Began running node model.rightmove_epc.uprn_match
[0m12:22:40.286409 [info ] [Thread-4 (]: 3 of 4 START sql view model dbt_melissa_rm_epc.uprn_match ...................... [RUN]
[0m12:22:40.287113 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.rightmove_epc.uprn_match'
[0m12:22:40.287467 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.uprn_match
[0m12:22:40.290273 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.uprn_match"
[0m12:22:40.292042 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.uprn_match (compile): 12:22:40.287718 => 12:22:40.291799
[0m12:22:40.292408 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.uprn_match
[0m12:22:40.295727 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.uprn_match"
[0m12:22:40.297001 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.uprn_match"
[0m12:22:40.297348 [debug] [Thread-4 (]: On model.rightmove_epc.uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
  
   as (
    with epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    where uprn is not null

),

rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where uprn is not null
),

final as (

    select 
    rm.ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    rm.UPRN,
    rm.LOCAL_AUTHORITY_CODE,
    rm.LOCAL_AUTHORITY,
    rm.GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    epc.TOTAL_FLOOR_AREA,
    epc.ADDRESSID as EPC_ADDRESSID,
    CASE WHEN epc.ADDRESSID is null then 'NO ADDRESS' ELSE 'YES' end as MATCH_EPC    
    
     from rm left join epc on rm.uprn = epc.uprn
)

select * from final
  );
[0m12:22:40.297654 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m12:22:40.892980 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:22:40.897894 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.uprn_match (execute): 12:22:40.292594 => 12:22:40.897597
[0m12:22:40.898540 [debug] [Thread-4 (]: On model.rightmove_epc.uprn_match: Close
[0m12:22:40.986072 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b2fd0f56-dd39-4e92-a59b-a96431d14130', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107553590>]}
[0m12:22:40.986920 [info ] [Thread-4 (]: 3 of 4 OK created sql view model dbt_melissa_rm_epc.uprn_match ................. [[32mSUCCESS 1[0m in 0.70s]
[0m12:22:40.987573 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.uprn_match
[0m12:22:40.988351 [debug] [Thread-1 (]: Began running node model.rightmove_epc.no_uprn
[0m12:22:40.988950 [info ] [Thread-1 (]: 4 of 4 START sql view model dbt_melissa_rm_epc.no_uprn ......................... [RUN]
[0m12:22:40.989784 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_epc_certs, now model.rightmove_epc.no_uprn)
[0m12:22:40.990157 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.no_uprn
[0m12:22:40.993147 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.no_uprn"
[0m12:22:40.994000 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.no_uprn (compile): 12:22:40.990375 => 12:22:40.993791
[0m12:22:40.994363 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.no_uprn
[0m12:22:40.997282 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.no_uprn"
[0m12:22:40.998229 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.no_uprn"
[0m12:22:40.998571 [debug] [Thread-1 (]: On model.rightmove_epc.no_uprn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.no_uprn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.no_uprn
  
   as (
    with no_uprn as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'NO'
    
)

SELECT * FROM no_uprn
  );
[0m12:22:40.999045 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:22:41.693690 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:22:41.696241 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.no_uprn (execute): 12:22:40.994574 => 12:22:41.696023
[0m12:22:41.696622 [debug] [Thread-1 (]: On model.rightmove_epc.no_uprn: Close
[0m12:22:41.784237 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b2fd0f56-dd39-4e92-a59b-a96431d14130', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e39810>]}
[0m12:22:41.784931 [info ] [Thread-1 (]: 4 of 4 OK created sql view model dbt_melissa_rm_epc.no_uprn .................... [[32mSUCCESS 1[0m in 0.79s]
[0m12:22:41.785458 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.no_uprn
[0m12:22:41.787110 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:22:41.787458 [debug] [MainThread]: Connection 'model.rightmove_epc.no_uprn' was properly closed.
[0m12:22:41.787737 [debug] [MainThread]: Connection 'model.rightmove_epc.stg_rightmove' was properly closed.
[0m12:22:41.787990 [debug] [MainThread]: Connection 'model.rightmove_epc.uprn_match' was properly closed.
[0m12:22:41.788322 [info ] [MainThread]: 
[0m12:22:41.788628 [info ] [MainThread]: Finished running 4 view models in 0 hours 0 minutes and 3.62 seconds (3.62s).
[0m12:22:41.789453 [debug] [MainThread]: Command end result
[0m12:22:41.796669 [info ] [MainThread]: 
[0m12:22:41.797106 [info ] [MainThread]: [32mCompleted successfully[0m
[0m12:22:41.797376 [info ] [MainThread]: 
[0m12:22:41.797651 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m12:22:41.799932 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.943819, "process_user_time": 1.472722, "process_kernel_time": 0.172898, "process_mem_max_rss": "135938048", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m12:22:41.800454 [debug] [MainThread]: Command `dbt run` succeeded at 12:22:41.800359 after 3.94 seconds
[0m12:22:41.800770 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106ed3750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103366110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10753f110>]}
[0m12:22:41.801060 [debug] [MainThread]: Flushing usage events
[0m12:24:20.433989 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109b02f90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109b5dc10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109b5f150>]}


============================== 12:24:20.437044 | cfca9d66-bdaf-4639-b889-0a6d6dca8ea3 ==============================
[0m12:24:20.437044 [info ] [MainThread]: Running with dbt=1.7.10
[0m12:24:20.437474 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'invocation_command': 'dbt run', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m12:24:20.627171 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'cfca9d66-bdaf-4639-b889-0a6d6dca8ea3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109b372d0>]}
[0m12:24:20.667268 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'cfca9d66-bdaf-4639-b889-0a6d6dca8ea3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109b12090>]}
[0m12:24:20.667910 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m12:24:20.679144 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m12:24:20.701848 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m12:24:20.702176 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m12:24:20.705802 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'cfca9d66-bdaf-4639-b889-0a6d6dca8ea3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109b5cd50>]}
[0m12:24:20.712245 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'cfca9d66-bdaf-4639-b889-0a6d6dca8ea3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b6f6c50>]}
[0m12:24:20.712517 [info ] [MainThread]: Found 4 models, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m12:24:20.712732 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cfca9d66-bdaf-4639-b889-0a6d6dca8ea3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b811610>]}
[0m12:24:20.713734 [info ] [MainThread]: 
[0m12:24:20.714164 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m12:24:20.714884 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m12:24:20.722170 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m12:24:20.722447 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m12:24:20.722644 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:24:21.190148 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 0.0 seconds
[0m12:24:21.195035 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m12:24:21.279295 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m12:24:21.288168 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m12:24:21.288542 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m12:24:21.288835 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:24:21.737020 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.0 seconds
[0m12:24:21.738602 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m12:24:21.860065 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cfca9d66-bdaf-4639-b889-0a6d6dca8ea3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ba2c690>]}
[0m12:24:21.860739 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m12:24:21.860987 [info ] [MainThread]: 
[0m12:24:21.862757 [debug] [Thread-1 (]: Began running node model.rightmove_epc.stg_epc_certs
[0m12:24:21.863026 [debug] [Thread-2 (]: Began running node model.rightmove_epc.stg_rightmove
[0m12:24:21.863359 [info ] [Thread-1 (]: 1 of 4 START sql view model dbt_melissa_rm_epc.stg_epc_certs ................... [RUN]
[0m12:24:21.863650 [info ] [Thread-2 (]: 2 of 4 START sql view model dbt_melissa_rm_epc.stg_rightmove ................... [RUN]
[0m12:24:21.864062 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.stg_epc_certs)
[0m12:24:21.864459 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.stg_rightmove'
[0m12:24:21.864663 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.stg_epc_certs
[0m12:24:21.864849 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.stg_rightmove
[0m12:24:21.868202 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.stg_rightmove"
[0m12:24:21.871711 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.stg_epc_certs"
[0m12:24:21.872283 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (compile): 12:24:21.866354 => 12:24:21.872093
[0m12:24:21.872543 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.stg_rightmove
[0m12:24:21.879253 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (compile): 12:24:21.864971 => 12:24:21.879073
[0m12:24:21.888698 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.stg_rightmove"
[0m12:24:21.888981 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.stg_epc_certs
[0m12:24:21.891839 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.stg_epc_certs"
[0m12:24:21.892619 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.stg_rightmove"
[0m12:24:21.893138 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.stg_epc_certs"
[0m12:24:21.893363 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_rightmove"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
  
   as (
    with rm as (

    SELECT 
    REPLACE(CONCAT(ADDRESS_1::VARCHAR,ADDRESS_2::VARCHAR),' ') AS ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL 
    FROM 
       ANALYTICS.RIGHTMOVE_PROD.CLEAN_RAW_RIGHTMOVE_DATA 

 
)

SELECT * FROM rm
  );
[0m12:24:21.893619 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_epc_certs"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
  
   as (
    WITH epc_certs as (
    
    select 
    UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    COUNTY,
    LOCAL_AUTHORITY as LOCAL_AUTHORITY_CODE,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    replace(ADDRESS1,' ') AS ADDRESSID
 from  RAW.EPC_TEST_DATA.EPC_CERTIFICATES 

)

SELECT * FROM epc_certs
  );
[0m12:24:21.893836 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m12:24:21.894022 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:24:22.659026 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:24:22.675274 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (execute): 12:24:21.872752 => 12:24:22.675109
[0m12:24:22.675616 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: Close
[0m12:24:22.679460 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:24:22.681212 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (execute): 12:24:21.889180 => 12:24:22.681075
[0m12:24:22.681478 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: Close
[0m12:24:22.762710 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cfca9d66-bdaf-4639-b889-0a6d6dca8ea3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b76e290>]}
[0m12:24:22.763745 [info ] [Thread-1 (]: 1 of 4 OK created sql view model dbt_melissa_rm_epc.stg_epc_certs .............. [[32mSUCCESS 1[0m in 0.90s]
[0m12:24:22.764450 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.stg_epc_certs
[0m12:24:22.765782 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cfca9d66-bdaf-4639-b889-0a6d6dca8ea3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b825450>]}
[0m12:24:22.766303 [info ] [Thread-2 (]: 2 of 4 OK created sql view model dbt_melissa_rm_epc.stg_rightmove .............. [[32mSUCCESS 1[0m in 0.90s]
[0m12:24:22.766729 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.stg_rightmove
[0m12:24:22.767240 [debug] [Thread-4 (]: Began running node model.rightmove_epc.uprn_match
[0m12:24:22.767708 [info ] [Thread-4 (]: 3 of 4 START sql view model dbt_melissa_rm_epc.uprn_match ...................... [RUN]
[0m12:24:22.768373 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.rightmove_epc.uprn_match'
[0m12:24:22.768676 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.uprn_match
[0m12:24:22.771086 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.uprn_match"
[0m12:24:22.771782 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.uprn_match (compile): 12:24:22.768841 => 12:24:22.771626
[0m12:24:22.772036 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.uprn_match
[0m12:24:22.774696 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.uprn_match"
[0m12:24:22.775751 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.uprn_match"
[0m12:24:22.776045 [debug] [Thread-4 (]: On model.rightmove_epc.uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
  
   as (
    with epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    where uprn is not null

),

rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where uprn is not null
),

final as (

    select 
    rm.ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    rm.UPRN,
    rm.LOCAL_AUTHORITY_CODE,
    rm.LOCAL_AUTHORITY,
    rm.GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    epc.TOTAL_FLOOR_AREA,
    epc.ADDRESSID as EPC_ADDRESSID,
    CASE WHEN epc.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC    
    
     from rm left join epc on rm.uprn = epc.uprn
)

select * from final
  );
[0m12:24:22.776302 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m12:24:23.465351 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:24:23.469138 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.uprn_match (execute): 12:24:22.772179 => 12:24:23.468855
[0m12:24:23.469687 [debug] [Thread-4 (]: On model.rightmove_epc.uprn_match: Close
[0m12:24:23.564641 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cfca9d66-bdaf-4639-b889-0a6d6dca8ea3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bbe0e90>]}
[0m12:24:23.565518 [info ] [Thread-4 (]: 3 of 4 OK created sql view model dbt_melissa_rm_epc.uprn_match ................. [[32mSUCCESS 1[0m in 0.80s]
[0m12:24:23.566271 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.uprn_match
[0m12:24:23.567257 [debug] [Thread-1 (]: Began running node model.rightmove_epc.no_uprn
[0m12:24:23.567920 [info ] [Thread-1 (]: 4 of 4 START sql view model dbt_melissa_rm_epc.no_uprn ......................... [RUN]
[0m12:24:23.568644 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_epc_certs, now model.rightmove_epc.no_uprn)
[0m12:24:23.569024 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.no_uprn
[0m12:24:23.572510 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.no_uprn"
[0m12:24:23.573499 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.no_uprn (compile): 12:24:23.569253 => 12:24:23.573266
[0m12:24:23.573888 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.no_uprn
[0m12:24:23.576922 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.no_uprn"
[0m12:24:23.578145 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.no_uprn"
[0m12:24:23.578567 [debug] [Thread-1 (]: On model.rightmove_epc.no_uprn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.no_uprn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.no_uprn
  
   as (
    with no_uprn as ( -- rightmove uspn does not match epc

    select 
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    rm.UPRN,
    rm.LOCAL_AUTHORITY_CODE,
    rm.LOCAL_AUTHORITY,
    rm.GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL
     from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'NO'
    
)

SELECT * FROM no_uprn
  );
[0m12:24:23.578919 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:24:24.026715 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b33ee8-0103-9acb-0000-7195063564a2
[0m12:24:24.027434 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 11 at position 4
invalid identifier 'RM.UPRN'
[0m12:24:24.028143 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.no_uprn (execute): 12:24:23.574081 => 12:24:24.027875
[0m12:24:24.028593 [debug] [Thread-1 (]: On model.rightmove_epc.no_uprn: Close
[0m12:24:24.134129 [debug] [Thread-1 (]: Database Error in model no_uprn (models/matching/no_uprn.sql)
  000904 (42000): SQL compilation error: error line 11 at position 4
  invalid identifier 'RM.UPRN'
  compiled Code at target/run/rightmove_epc/models/matching/no_uprn.sql
[0m12:24:24.134717 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cfca9d66-bdaf-4639-b889-0a6d6dca8ea3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b6e08d0>]}
[0m12:24:24.135273 [error] [Thread-1 (]: 4 of 4 ERROR creating sql view model dbt_melissa_rm_epc.no_uprn ................ [[31mERROR[0m in 0.57s]
[0m12:24:24.135818 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.no_uprn
[0m12:24:24.137667 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:24:24.137964 [debug] [MainThread]: Connection 'model.rightmove_epc.no_uprn' was properly closed.
[0m12:24:24.138217 [debug] [MainThread]: Connection 'model.rightmove_epc.stg_rightmove' was properly closed.
[0m12:24:24.138453 [debug] [MainThread]: Connection 'model.rightmove_epc.uprn_match' was properly closed.
[0m12:24:24.138776 [info ] [MainThread]: 
[0m12:24:24.139074 [info ] [MainThread]: Finished running 4 view models in 0 hours 0 minutes and 3.42 seconds (3.42s).
[0m12:24:24.139861 [debug] [MainThread]: Command end result
[0m12:24:24.146557 [info ] [MainThread]: 
[0m12:24:24.147078 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m12:24:24.147392 [info ] [MainThread]: 
[0m12:24:24.147648 [error] [MainThread]:   Database Error in model no_uprn (models/matching/no_uprn.sql)
  000904 (42000): SQL compilation error: error line 11 at position 4
  invalid identifier 'RM.UPRN'
  compiled Code at target/run/rightmove_epc/models/matching/no_uprn.sql
[0m12:24:24.147895 [info ] [MainThread]: 
[0m12:24:24.148134 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=1 SKIP=0 TOTAL=4
[0m12:24:24.150072 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 3.7480075, "process_user_time": 1.453885, "process_kernel_time": 0.17096, "process_mem_max_rss": "136675328", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m12:24:24.150529 [debug] [MainThread]: Command `dbt run` failed at 12:24:24.150434 after 3.75 seconds
[0m12:24:24.150854 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109b08710>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109b5ec10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104baa190>]}
[0m12:24:24.151157 [debug] [MainThread]: Flushing usage events
[0m12:26:53.331500 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106d545d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106d9e450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106d9efd0>]}


============================== 12:26:53.334802 | d64688f2-b036-4f17-84bf-599bee14505e ==============================
[0m12:26:53.334802 [info ] [MainThread]: Running with dbt=1.7.10
[0m12:26:53.335217 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m12:26:53.521854 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd64688f2-b036-4f17-84bf-599bee14505e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107758490>]}
[0m12:26:53.563162 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd64688f2-b036-4f17-84bf-599bee14505e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1077affd0>]}
[0m12:26:53.563992 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m12:26:53.574423 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m12:26:53.597612 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m12:26:53.597905 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m12:26:53.601478 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd64688f2-b036-4f17-84bf-599bee14505e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107aba9d0>]}
[0m12:26:53.607937 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd64688f2-b036-4f17-84bf-599bee14505e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106d93750>]}
[0m12:26:53.608209 [info ] [MainThread]: Found 4 models, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m12:26:53.608427 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd64688f2-b036-4f17-84bf-599bee14505e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107a2d6d0>]}
[0m12:26:53.609399 [info ] [MainThread]: 
[0m12:26:53.609853 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m12:26:53.610518 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m12:26:53.617887 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m12:26:53.618184 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m12:26:53.618368 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:26:54.031141 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 0.0 seconds
[0m12:26:54.033983 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m12:26:54.127658 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m12:26:54.135906 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m12:26:54.136236 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m12:26:54.136498 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:26:54.565887 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.0 seconds
[0m12:26:54.568025 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m12:26:54.650815 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd64688f2-b036-4f17-84bf-599bee14505e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107976d90>]}
[0m12:26:54.651477 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m12:26:54.651726 [info ] [MainThread]: 
[0m12:26:54.654057 [debug] [Thread-1 (]: Began running node model.rightmove_epc.stg_epc_certs
[0m12:26:54.654335 [debug] [Thread-2 (]: Began running node model.rightmove_epc.stg_rightmove
[0m12:26:54.654642 [info ] [Thread-1 (]: 1 of 4 START sql view model dbt_melissa_rm_epc.stg_epc_certs ................... [RUN]
[0m12:26:54.654956 [info ] [Thread-2 (]: 2 of 4 START sql view model dbt_melissa_rm_epc.stg_rightmove ................... [RUN]
[0m12:26:54.655410 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.stg_epc_certs)
[0m12:26:54.655868 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.stg_rightmove'
[0m12:26:54.656098 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.stg_epc_certs
[0m12:26:54.656313 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.stg_rightmove
[0m12:26:54.661400 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.stg_epc_certs"
[0m12:26:54.663222 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.stg_rightmove"
[0m12:26:54.664152 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (compile): 12:26:54.661594 => 12:26:54.663919
[0m12:26:54.664504 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (compile): 12:26:54.656450 => 12:26:54.664308
[0m12:26:54.664808 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.stg_rightmove
[0m12:26:54.665135 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.stg_epc_certs
[0m12:26:54.680948 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.stg_rightmove"
[0m12:26:54.683878 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.stg_epc_certs"
[0m12:26:54.684790 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.stg_rightmove"
[0m12:26:54.685307 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.stg_epc_certs"
[0m12:26:54.685547 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_rightmove"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
  
   as (
    with rm as (

    SELECT 
    TRIM(replace(REPLACE(CONCAT(ADDRESS_1::VARCHAR,ADDRESS_2::VARCHAR),' '),',')) AS ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL 
    FROM 
       ANALYTICS.RIGHTMOVE_PROD.CLEAN_RAW_RIGHTMOVE_DATA 

 
)

SELECT * FROM rm
  );
[0m12:26:54.685797 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_epc_certs"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
  
   as (
    WITH epc_certs as (
    
    select 
    UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    COUNTY,
    LOCAL_AUTHORITY as LOCAL_AUTHORITY_CODE,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    trim(replace(replace(ADDRESS1,' '),',')) AS ADDRESSID
 from  RAW.EPC_TEST_DATA.EPC_CERTIFICATES 

)

SELECT * FROM epc_certs
  );
[0m12:26:54.686015 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m12:26:54.686193 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:26:55.297201 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:26:55.322220 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (execute): 12:26:54.681138 => 12:26:55.322028
[0m12:26:55.323337 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:26:55.323736 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: Close
[0m12:26:55.326018 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (execute): 12:26:54.665347 => 12:26:55.325848
[0m12:26:55.327072 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: Close
[0m12:26:55.424765 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd64688f2-b036-4f17-84bf-599bee14505e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10799fad0>]}
[0m12:26:55.425613 [info ] [Thread-1 (]: 1 of 4 OK created sql view model dbt_melissa_rm_epc.stg_epc_certs .............. [[32mSUCCESS 1[0m in 0.77s]
[0m12:26:55.426281 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.stg_epc_certs
[0m12:26:55.491796 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd64688f2-b036-4f17-84bf-599bee14505e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10773bd90>]}
[0m12:26:55.492528 [info ] [Thread-2 (]: 2 of 4 OK created sql view model dbt_melissa_rm_epc.stg_rightmove .............. [[32mSUCCESS 1[0m in 0.84s]
[0m12:26:55.493115 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.stg_rightmove
[0m12:26:55.493865 [debug] [Thread-4 (]: Began running node model.rightmove_epc.uprn_match
[0m12:26:55.494379 [info ] [Thread-4 (]: 3 of 4 START sql view model dbt_melissa_rm_epc.uprn_match ...................... [RUN]
[0m12:26:55.495077 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.rightmove_epc.uprn_match'
[0m12:26:55.495417 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.uprn_match
[0m12:26:55.498236 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.uprn_match"
[0m12:26:55.498959 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.uprn_match (compile): 12:26:55.495624 => 12:26:55.498783
[0m12:26:55.499273 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.uprn_match
[0m12:26:55.502415 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.uprn_match"
[0m12:26:55.503611 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.uprn_match"
[0m12:26:55.503968 [debug] [Thread-4 (]: On model.rightmove_epc.uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
  
   as (
    with epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    where uprn is not null

),

rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where uprn is not null
),

final as (

    select 
    rm.ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    rm.UPRN,
    rm.LOCAL_AUTHORITY_CODE,
    rm.LOCAL_AUTHORITY,
    rm.GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    epc.TOTAL_FLOOR_AREA,
    epc.ADDRESSID as EPC_ADDRESSID,
    CASE WHEN epc.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC    
    
     from rm left join epc on rm.uprn = epc.uprn
)

select * from final
  );
[0m12:26:55.504306 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m12:26:56.247586 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:26:56.250930 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.uprn_match (execute): 12:26:55.499455 => 12:26:56.250677
[0m12:26:56.251407 [debug] [Thread-4 (]: On model.rightmove_epc.uprn_match: Close
[0m12:26:56.410582 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd64688f2-b036-4f17-84bf-599bee14505e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106550d10>]}
[0m12:26:56.411365 [info ] [Thread-4 (]: 3 of 4 OK created sql view model dbt_melissa_rm_epc.uprn_match ................. [[32mSUCCESS 1[0m in 0.92s]
[0m12:26:56.411980 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.uprn_match
[0m12:26:56.412792 [debug] [Thread-1 (]: Began running node model.rightmove_epc.no_uprn
[0m12:26:56.413371 [info ] [Thread-1 (]: 4 of 4 START sql view model dbt_melissa_rm_epc.no_uprn ......................... [RUN]
[0m12:26:56.414029 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_epc_certs, now model.rightmove_epc.no_uprn)
[0m12:26:56.414359 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.no_uprn
[0m12:26:56.417329 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.no_uprn"
[0m12:26:56.418197 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.no_uprn (compile): 12:26:56.414560 => 12:26:56.417935
[0m12:26:56.418595 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.no_uprn
[0m12:26:56.421391 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.no_uprn"
[0m12:26:56.422421 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.no_uprn"
[0m12:26:56.422757 [debug] [Thread-1 (]: On model.rightmove_epc.no_uprn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.no_uprn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.no_uprn
  
   as (
    with rm_no_match_to_epc  as ( -- rightmove uspn does not match epc

    select 
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL
     from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'NO'
    
)

SELECT * FROM rm_no_match_to_epc
  );
[0m12:26:56.423068 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:26:57.068023 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:26:57.071778 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.no_uprn (execute): 12:26:56.418820 => 12:26:57.071617
[0m12:26:57.072065 [debug] [Thread-1 (]: On model.rightmove_epc.no_uprn: Close
[0m12:26:57.158134 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd64688f2-b036-4f17-84bf-599bee14505e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107af9790>]}
[0m12:26:57.159194 [info ] [Thread-1 (]: 4 of 4 OK created sql view model dbt_melissa_rm_epc.no_uprn .................... [[32mSUCCESS 1[0m in 0.74s]
[0m12:26:57.159994 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.no_uprn
[0m12:26:57.162114 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:26:57.162465 [debug] [MainThread]: Connection 'model.rightmove_epc.no_uprn' was properly closed.
[0m12:26:57.162763 [debug] [MainThread]: Connection 'model.rightmove_epc.stg_rightmove' was properly closed.
[0m12:26:57.163042 [debug] [MainThread]: Connection 'model.rightmove_epc.uprn_match' was properly closed.
[0m12:26:57.163403 [info ] [MainThread]: 
[0m12:26:57.163749 [info ] [MainThread]: Finished running 4 view models in 0 hours 0 minutes and 3.55 seconds (3.55s).
[0m12:26:57.164716 [debug] [MainThread]: Command end result
[0m12:26:57.173768 [info ] [MainThread]: 
[0m12:26:57.174248 [info ] [MainThread]: [32mCompleted successfully[0m
[0m12:26:57.174562 [info ] [MainThread]: 
[0m12:26:57.174869 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m12:26:57.177350 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.8769605, "process_user_time": 1.455929, "process_kernel_time": 0.163236, "process_mem_max_rss": "134709248", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m12:26:57.177923 [debug] [MainThread]: Command `dbt run` succeeded at 12:26:57.177807 after 3.88 seconds
[0m12:26:57.178269 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106dc3290>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106dc3ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10288e190>]}
[0m12:26:57.178600 [debug] [MainThread]: Flushing usage events
[0m12:29:28.166581 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112457690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11243df10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11249aed0>]}


============================== 12:29:28.169356 | 4bdd8a16-9de5-4672-a106-72bf2ed479a0 ==============================
[0m12:29:28.169356 [info ] [MainThread]: Running with dbt=1.7.10
[0m12:29:28.169708 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt run --select rightmove_epc/models/matching/uprn_match.sql', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m12:29:28.353709 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4bdd8a16-9de5-4672-a106-72bf2ed479a0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112473590>]}
[0m12:29:28.394481 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4bdd8a16-9de5-4672-a106-72bf2ed479a0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1124c3f90>]}
[0m12:29:28.395592 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m12:29:28.405901 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m12:29:28.428286 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m12:29:28.428589 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m12:29:28.432003 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4bdd8a16-9de5-4672-a106-72bf2ed479a0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11311da90>]}
[0m12:29:28.438590 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4bdd8a16-9de5-4672-a106-72bf2ed479a0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1133506d0>]}
[0m12:29:28.438892 [info ] [MainThread]: Found 4 models, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m12:29:28.439109 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4bdd8a16-9de5-4672-a106-72bf2ed479a0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1133b5bd0>]}
[0m12:29:28.439651 [warn ] [MainThread]: The selection criterion 'rightmove_epc/models/matching/uprn_match.sql' does not match any nodes
[0m12:29:28.440227 [info ] [MainThread]: 
[0m12:29:28.440410 [warn ] [MainThread]: Nothing to do. Try checking your model configs and model specification args
[0m12:29:28.440681 [debug] [MainThread]: Command end result
[0m12:29:28.446003 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.31034407, "process_user_time": 1.104673, "process_kernel_time": 0.142224, "process_mem_max_rss": "123633664", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m12:29:28.446393 [debug] [MainThread]: Command `dbt run` succeeded at 12:29:28.446318 after 0.31 seconds
[0m12:29:28.446650 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11248e3d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1056ca150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10581dfd0>]}
[0m12:29:28.446870 [debug] [MainThread]: Flushing usage events
[0m12:30:00.428164 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112a56890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112a44290>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112a9a850>]}


============================== 12:30:00.430431 | f13f6306-a46f-4fd3-bcb9-aeb1f497c4ce ==============================
[0m12:30:00.430431 [info ] [MainThread]: Running with dbt=1.7.10
[0m12:30:00.430784 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'profiles_dir': '/Users/melissabee/.dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --select models/matchig/uprn_match.sql', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m12:30:00.592928 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f13f6306-a46f-4fd3-bcb9-aeb1f497c4ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1146b12d0>]}
[0m12:30:00.632579 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f13f6306-a46f-4fd3-bcb9-aeb1f497c4ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1145af8d0>]}
[0m12:30:00.633037 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m12:30:00.642155 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m12:30:00.658807 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m12:30:00.659109 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m12:30:00.662945 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f13f6306-a46f-4fd3-bcb9-aeb1f497c4ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1148a4250>]}
[0m12:30:00.669688 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f13f6306-a46f-4fd3-bcb9-aeb1f497c4ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114761e10>]}
[0m12:30:00.670007 [info ] [MainThread]: Found 4 models, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m12:30:00.670245 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f13f6306-a46f-4fd3-bcb9-aeb1f497c4ce', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112a8f790>]}
[0m12:30:00.670773 [warn ] [MainThread]: The selection criterion 'models/matchig/uprn_match.sql' does not match any nodes
[0m12:30:00.671380 [info ] [MainThread]: 
[0m12:30:00.671573 [warn ] [MainThread]: Nothing to do. Try checking your model configs and model specification args
[0m12:30:00.671856 [debug] [MainThread]: Command end result
[0m12:30:00.676864 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.27642378, "process_user_time": 1.102329, "process_kernel_time": 0.118251, "process_mem_max_rss": "125419520", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m12:30:00.677246 [debug] [MainThread]: Command `dbt run` succeeded at 12:30:00.677173 after 0.28 seconds
[0m12:30:00.677475 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112a9a450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112a44290>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105256150>]}
[0m12:30:00.677681 [debug] [MainThread]: Flushing usage events
[0m12:34:02.375701 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107118150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107151fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10715f050>]}


============================== 12:34:02.378499 | da37be6e-db97-473f-b33f-7c6fa7b789ef ==============================
[0m12:34:02.378499 [info ] [MainThread]: Running with dbt=1.7.10
[0m12:34:02.378846 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run --select models/matching', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m12:34:02.564953 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'da37be6e-db97-473f-b33f-7c6fa7b789ef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107152110>]}
[0m12:34:02.604730 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'da37be6e-db97-473f-b33f-7c6fa7b789ef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1068cb910>]}
[0m12:34:02.605323 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m12:34:02.615490 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m12:34:02.638387 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m12:34:02.638689 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m12:34:02.642130 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'da37be6e-db97-473f-b33f-7c6fa7b789ef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110632610>]}
[0m12:34:02.649174 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'da37be6e-db97-473f-b33f-7c6fa7b789ef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1104dd710>]}
[0m12:34:02.649517 [info ] [MainThread]: Found 4 models, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m12:34:02.649743 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'da37be6e-db97-473f-b33f-7c6fa7b789ef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1105a5e10>]}
[0m12:34:02.650777 [info ] [MainThread]: 
[0m12:34:02.651276 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m12:34:02.651959 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m12:34:02.659560 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m12:34:02.659871 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m12:34:02.660054 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:34:06.228132 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 4.0 seconds
[0m12:34:06.230212 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m12:34:06.355013 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m12:34:06.363166 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m12:34:06.363501 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m12:34:06.363760 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:34:06.805320 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.0 seconds
[0m12:34:06.807269 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m12:34:06.897221 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'da37be6e-db97-473f-b33f-7c6fa7b789ef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10715c090>]}
[0m12:34:06.898196 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m12:34:06.898591 [info ] [MainThread]: 
[0m12:34:06.901915 [debug] [Thread-1 (]: Began running node model.rightmove_epc.uprn_match
[0m12:34:06.902503 [info ] [Thread-1 (]: 1 of 2 START sql view model dbt_melissa_rm_epc.uprn_match ...................... [RUN]
[0m12:34:06.903248 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.uprn_match)
[0m12:34:06.903586 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.uprn_match
[0m12:34:06.910829 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.uprn_match"
[0m12:34:06.911712 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.uprn_match (compile): 12:34:06.903798 => 12:34:06.911455
[0m12:34:06.912045 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.uprn_match
[0m12:34:06.932221 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.uprn_match"
[0m12:34:06.933406 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.uprn_match"
[0m12:34:06.933685 [debug] [Thread-1 (]: On model.rightmove_epc.uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
  
   as (
    with epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    where uprn is not null

),

rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where uprn is not null
),

final as (

    select 
    rm.ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    rm.UPRN,
    rm.LOCAL_AUTHORITY_CODE,
    rm.LOCAL_AUTHORITY,
    rm.GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    epc.UPRN AS EPC_UPRN,
    epc.TOTAL_FLOOR_AREA,
    epc.ADDRESSID as EPC_ADDRESSID,
    CASE WHEN epc.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC    
    
     from rm left join epc on rm.uprn = epc.uprn
)

select * from final
  );
[0m12:34:06.933932 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:34:07.758007 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:34:07.782117 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.uprn_match (execute): 12:34:06.912220 => 12:34:07.781934
[0m12:34:07.782503 [debug] [Thread-1 (]: On model.rightmove_epc.uprn_match: Close
[0m12:34:07.861414 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'da37be6e-db97-473f-b33f-7c6fa7b789ef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1105c3f90>]}
[0m12:34:07.862211 [info ] [Thread-1 (]: 1 of 2 OK created sql view model dbt_melissa_rm_epc.uprn_match ................. [[32mSUCCESS 1[0m in 0.96s]
[0m12:34:07.862845 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.uprn_match
[0m12:34:07.863511 [debug] [Thread-3 (]: Began running node model.rightmove_epc.no_uprn
[0m12:34:07.864208 [info ] [Thread-3 (]: 2 of 2 START sql view model dbt_melissa_rm_epc.no_uprn ......................... [RUN]
[0m12:34:07.865021 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.rightmove_epc.no_uprn'
[0m12:34:07.865386 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.no_uprn
[0m12:34:07.868458 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.no_uprn"
[0m12:34:07.869319 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.no_uprn (compile): 12:34:07.865604 => 12:34:07.869118
[0m12:34:07.869682 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.no_uprn
[0m12:34:07.909085 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.no_uprn"
[0m12:34:07.910058 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.no_uprn"
[0m12:34:07.910296 [debug] [Thread-3 (]: On model.rightmove_epc.no_uprn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.no_uprn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.no_uprn
  
   as (
    with rm_no_match_to_epc  as ( -- rightmove uspn does not match epc

    select 
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL

     from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'NO'
    
),

epc_remove as (

    select ESPN_UPRN,ESPC_ADDRESS_ID from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'YES'  -- 
),

epc_fuzzy_match as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs src
    left join epc_remove rem on src.uspn = rem.EPC_UPRN
    where rem.EPC_UPRN is null
)

SELECT * FROM epc_fuzzy_match
  );
[0m12:34:07.910511 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m12:34:08.554474 [debug] [Thread-3 (]: Snowflake adapter: Snowflake query id: 01b33ef2-0103-9aa3-0000-7195063544c6
[0m12:34:08.554965 [debug] [Thread-3 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 25 at position 11
invalid identifier 'ESPN_UPRN'
[0m12:34:08.555497 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.no_uprn (execute): 12:34:07.869912 => 12:34:08.555304
[0m12:34:08.555842 [debug] [Thread-3 (]: On model.rightmove_epc.no_uprn: Close
[0m12:34:08.638248 [debug] [Thread-3 (]: Database Error in model no_uprn (models/matching/no_uprn.sql)
  000904 (42000): SQL compilation error: error line 25 at position 11
  invalid identifier 'ESPN_UPRN'
  compiled Code at target/run/rightmove_epc/models/matching/no_uprn.sql
[0m12:34:08.638757 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'da37be6e-db97-473f-b33f-7c6fa7b789ef', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1107d9310>]}
[0m12:34:08.639245 [error] [Thread-3 (]: 2 of 2 ERROR creating sql view model dbt_melissa_rm_epc.no_uprn ................ [[31mERROR[0m in 0.77s]
[0m12:34:08.639737 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.no_uprn
[0m12:34:08.641166 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:34:08.641470 [debug] [MainThread]: Connection 'model.rightmove_epc.uprn_match' was properly closed.
[0m12:34:08.641710 [debug] [MainThread]: Connection 'model.rightmove_epc.no_uprn' was properly closed.
[0m12:34:08.641999 [info ] [MainThread]: 
[0m12:34:08.642272 [info ] [MainThread]: Finished running 2 view models in 0 hours 0 minutes and 5.99 seconds (5.99s).
[0m12:34:08.642852 [debug] [MainThread]: Command end result
[0m12:34:08.649479 [info ] [MainThread]: 
[0m12:34:08.649826 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m12:34:08.650062 [info ] [MainThread]: 
[0m12:34:08.650319 [error] [MainThread]:   Database Error in model no_uprn (models/matching/no_uprn.sql)
  000904 (42000): SQL compilation error: error line 25 at position 11
  invalid identifier 'ESPN_UPRN'
  compiled Code at target/run/rightmove_epc/models/matching/no_uprn.sql
[0m12:34:08.650555 [info ] [MainThread]: 
[0m12:34:08.650807 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=0 TOTAL=2
[0m12:34:08.652394 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 6.3068724, "process_user_time": 1.397447, "process_kernel_time": 0.179554, "process_mem_max_rss": "135118848", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m12:34:08.652801 [debug] [MainThread]: Command `dbt run` failed at 12:34:08.652716 after 6.31 seconds
[0m12:34:08.653090 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107187750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1071875d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102efa310>]}
[0m12:34:08.653347 [debug] [MainThread]: Flushing usage events
[0m13:01:12.996882 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112818f90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11285e510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11285f090>]}


============================== 13:01:12.999967 | c1c7ea10-f2c1-4eec-b686-6cfb5a9d31d5 ==============================
[0m13:01:12.999967 [info ] [MainThread]: Running with dbt=1.7.10
[0m13:01:13.000398 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt run --select models', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m13:01:13.191100 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c1c7ea10-f2c1-4eec-b686-6cfb5a9d31d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114e90f50>]}
[0m13:01:13.231966 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c1c7ea10-f2c1-4eec-b686-6cfb5a9d31d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114df6f50>]}
[0m13:01:13.232765 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m13:01:13.242606 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m13:01:13.260861 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m13:01:13.261189 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m13:01:13.264774 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c1c7ea10-f2c1-4eec-b686-6cfb5a9d31d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1150f7550>]}
[0m13:01:13.272278 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c1c7ea10-f2c1-4eec-b686-6cfb5a9d31d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114f88c10>]}
[0m13:01:13.272586 [info ] [MainThread]: Found 6 models, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m13:01:13.272809 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c1c7ea10-f2c1-4eec-b686-6cfb5a9d31d5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114d39610>]}
[0m13:01:13.273218 [warn ] [MainThread]: The selection criterion 'models' does not match any nodes
[0m13:01:13.273823 [info ] [MainThread]: 
[0m13:01:13.274003 [warn ] [MainThread]: Nothing to do. Try checking your model configs and model specification args
[0m13:01:13.274285 [debug] [MainThread]: Command end result
[0m13:01:13.279715 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.3134038, "process_user_time": 1.115843, "process_kernel_time": 0.14929, "process_mem_max_rss": "124059648", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m13:01:13.280127 [debug] [MainThread]: Command `dbt run` succeeded at 13:01:13.280052 after 0.31 seconds
[0m13:01:13.280406 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112886ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1121d3b10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104da2210>]}
[0m13:01:13.280651 [debug] [MainThread]: Flushing usage events
[0m13:01:22.154941 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105218510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105251fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10525ee50>]}


============================== 13:01:22.157694 | 399feb95-bb90-418c-9348-78ff15f63f75 ==============================
[0m13:01:22.157694 [info ] [MainThread]: Running with dbt=1.7.10
[0m13:01:22.158040 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'invocation_command': 'dbt run', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m13:01:22.345634 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '399feb95-bb90-418c-9348-78ff15f63f75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105c29a50>]}
[0m13:01:22.385430 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '399feb95-bb90-418c-9348-78ff15f63f75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1052a8ed0>]}
[0m13:01:22.386431 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m13:01:22.398057 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m13:01:22.415155 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m13:01:22.415446 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m13:01:22.419120 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '399feb95-bb90-418c-9348-78ff15f63f75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1052a1190>]}
[0m13:01:22.425725 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '399feb95-bb90-418c-9348-78ff15f63f75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105c02150>]}
[0m13:01:22.426031 [info ] [MainThread]: Found 6 models, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m13:01:22.426253 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '399feb95-bb90-418c-9348-78ff15f63f75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105e73a10>]}
[0m13:01:22.427582 [info ] [MainThread]: 
[0m13:01:22.428236 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m13:01:22.429090 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m13:01:22.436631 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m13:01:22.436946 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m13:01:22.437120 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:01:22.980408 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 1.0 seconds
[0m13:01:22.982843 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m13:01:23.069707 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m13:01:23.076890 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m13:01:23.077218 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m13:01:23.077481 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:01:23.529002 [debug] [ThreadPool]: SQL status: SUCCESS 4 in 0.0 seconds
[0m13:01:23.530779 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m13:01:23.610837 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '399feb95-bb90-418c-9348-78ff15f63f75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105c5b790>]}
[0m13:01:23.611519 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m13:01:23.611786 [info ] [MainThread]: 
[0m13:01:23.614479 [debug] [Thread-1 (]: Began running node model.rightmove_epc.stg_epc_certs
[0m13:01:23.614792 [debug] [Thread-2 (]: Began running node model.rightmove_epc.stg_rightmove
[0m13:01:23.615289 [info ] [Thread-1 (]: 1 of 6 START sql view model dbt_melissa_rm_epc.stg_epc_certs ................... [RUN]
[0m13:01:23.615788 [info ] [Thread-2 (]: 2 of 6 START sql view model dbt_melissa_rm_epc.stg_rightmove ................... [RUN]
[0m13:01:23.616370 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.stg_epc_certs)
[0m13:01:23.616891 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.stg_rightmove'
[0m13:01:23.617143 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.stg_epc_certs
[0m13:01:23.617373 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.stg_rightmove
[0m13:01:23.622736 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.stg_epc_certs"
[0m13:01:23.624901 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.stg_rightmove"
[0m13:01:23.625903 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (compile): 13:01:23.617519 => 13:01:23.625731
[0m13:01:23.626192 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (compile): 13:01:23.623011 => 13:01:23.626051
[0m13:01:23.626412 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.stg_epc_certs
[0m13:01:23.626620 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.stg_rightmove
[0m13:01:23.642464 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.stg_epc_certs"
[0m13:01:23.645246 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.stg_rightmove"
[0m13:01:23.646093 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.stg_rightmove"
[0m13:01:23.646662 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.stg_epc_certs"
[0m13:01:23.646900 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_rightmove"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
  
   as (
    with rm as (

    SELECT 
    TRIM(replace(REPLACE(CONCAT(ADDRESS_1::VARCHAR,ADDRESS_2::VARCHAR),' '),',')) AS ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL 
    FROM 
       ANALYTICS.RIGHTMOVE_PROD.CLEAN_RAW_RIGHTMOVE_DATA 

 
)

SELECT * FROM rm
  );
[0m13:01:23.647155 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_epc_certs"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
  
   as (
    WITH epc_certs as (
    
    select 
    UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    COUNTY,
    LOCAL_AUTHORITY as LOCAL_AUTHORITY_CODE,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    CASE WHEN UPPER(ADDRESS1) LIKE 'FLAT%' OR 'UNIT%' THEN TRIM(REPLACE(REPLACE(CONCAT(ADDRESS1,ADDRESS2),','),' '))
    ELSE trim(replace(replace(ADDRESS1,' '),',')) END AS ADDRESSID
 from  RAW.EPC_TEST_DATA.EPC_CERTIFICATES 

)

SELECT * FROM epc_certs
  );
[0m13:01:23.647383 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m13:01:23.647567 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:01:24.296758 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:01:24.308382 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (execute): 13:01:23.626752 => 13:01:24.308254
[0m13:01:24.309047 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:01:24.309332 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: Close
[0m13:01:24.310780 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (execute): 13:01:23.642698 => 13:01:24.310672
[0m13:01:24.311489 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: Close
[0m13:01:24.387752 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '399feb95-bb90-418c-9348-78ff15f63f75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105cba690>]}
[0m13:01:24.388230 [info ] [Thread-1 (]: 1 of 6 OK created sql view model dbt_melissa_rm_epc.stg_epc_certs .............. [[32mSUCCESS 1[0m in 0.77s]
[0m13:01:24.388629 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.stg_epc_certs
[0m13:01:24.391312 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '399feb95-bb90-418c-9348-78ff15f63f75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105a3ba90>]}
[0m13:01:24.391674 [info ] [Thread-2 (]: 2 of 6 OK created sql view model dbt_melissa_rm_epc.stg_rightmove .............. [[32mSUCCESS 1[0m in 0.77s]
[0m13:01:24.392031 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.stg_rightmove
[0m13:01:24.392561 [debug] [Thread-4 (]: Began running node model.rightmove_epc.dim_addressid
[0m13:01:24.392817 [debug] [Thread-3 (]: Began running node model.rightmove_epc.dim_uprn
[0m13:01:24.393104 [info ] [Thread-4 (]: 3 of 6 START sql view model dbt_melissa_rm_epc.dim_addressid ................... [RUN]
[0m13:01:24.393374 [debug] [Thread-1 (]: Began running node model.rightmove_epc.uprn_match
[0m13:01:24.393633 [info ] [Thread-3 (]: 4 of 6 START sql view model dbt_melissa_rm_epc.dim_uprn ........................ [RUN]
[0m13:01:24.394123 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_addressid'
[0m13:01:24.394411 [info ] [Thread-1 (]: 5 of 6 START sql view model dbt_melissa_rm_epc.uprn_match ...................... [RUN]
[0m13:01:24.394966 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_uprn'
[0m13:01:24.395305 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.dim_addressid
[0m13:01:24.395754 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_epc_certs, now model.rightmove_epc.uprn_match)
[0m13:01:24.396018 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.dim_uprn
[0m13:01:24.398447 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.dim_addressid"
[0m13:01:24.398868 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.uprn_match
[0m13:01:24.400994 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.dim_uprn"
[0m13:01:24.403173 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.uprn_match"
[0m13:01:24.403947 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_addressid (compile): 13:01:24.396177 => 13:01:24.403705
[0m13:01:24.404268 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.dim_uprn (compile): 13:01:24.399090 => 13:01:24.404108
[0m13:01:24.404765 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.dim_addressid
[0m13:01:24.405131 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.uprn_match (compile): 13:01:24.401413 => 13:01:24.404964
[0m13:01:24.405413 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.dim_uprn
[0m13:01:24.407656 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.dim_addressid"
[0m13:01:24.407983 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.uprn_match
[0m13:01:24.409887 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.dim_uprn"
[0m13:01:24.411800 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.uprn_match"
[0m13:01:24.412592 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.dim_uprn"
[0m13:01:24.413218 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.uprn_match"
[0m13:01:24.413728 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.dim_addressid"
[0m13:01:24.413970 [debug] [Thread-3 (]: On model.rightmove_epc.dim_uprn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_uprn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
  
   as (
    with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where uprn is not null
  );
[0m13:01:24.414227 [debug] [Thread-1 (]: On model.rightmove_epc.uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
  
   as (
    with epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    where uprn is not null

),

rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where uprn is not null
),

final as (

    select 
    rm.ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    rm.UPRN,
    rm.LOCAL_AUTHORITY_CODE,
    rm.LOCAL_AUTHORITY,
    rm.GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    epc.UPRN AS EPC_UPRN,
    epc.TOTAL_FLOOR_AREA,
    epc.ADDRESSID as EPC_ADDRESSID,
    CASE WHEN epc.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC    
    
     from rm left join epc on rm.uprn = epc.uprn
)

select * from final
  );
[0m13:01:24.414458 [debug] [Thread-4 (]: On model.rightmove_epc.dim_addressid: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_addressid"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
  
   as (
    with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where uprn is null
and addressid is not null
  );
[0m13:01:24.414661 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m13:01:24.414832 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:01:24.414999 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m13:01:25.042555 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:01:25.046390 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.dim_uprn (execute): 13:01:24.408126 => 13:01:25.046101
[0m13:01:25.047419 [debug] [Thread-3 (]: On model.rightmove_epc.dim_uprn: Close
[0m13:01:25.048231 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:01:25.052523 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_addressid (execute): 13:01:24.405572 => 13:01:25.052305
[0m13:01:25.053364 [debug] [Thread-4 (]: On model.rightmove_epc.dim_addressid: Close
[0m13:01:25.083106 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:01:25.085906 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.uprn_match (execute): 13:01:24.410120 => 13:01:25.085715
[0m13:01:25.086449 [debug] [Thread-1 (]: On model.rightmove_epc.uprn_match: Close
[0m13:01:25.131774 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '399feb95-bb90-418c-9348-78ff15f63f75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105af6610>]}
[0m13:01:25.132489 [info ] [Thread-3 (]: 4 of 6 OK created sql view model dbt_melissa_rm_epc.dim_uprn ................... [[32mSUCCESS 1[0m in 0.74s]
[0m13:01:25.133119 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.dim_uprn
[0m13:01:25.153638 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '399feb95-bb90-418c-9348-78ff15f63f75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105e949d0>]}
[0m13:01:25.154242 [info ] [Thread-4 (]: 3 of 6 OK created sql view model dbt_melissa_rm_epc.dim_addressid .............. [[32mSUCCESS 1[0m in 0.76s]
[0m13:01:25.154700 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.dim_addressid
[0m13:01:25.171678 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '399feb95-bb90-418c-9348-78ff15f63f75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105e70a50>]}
[0m13:01:25.172304 [info ] [Thread-1 (]: 5 of 6 OK created sql view model dbt_melissa_rm_epc.uprn_match ................. [[32mSUCCESS 1[0m in 0.78s]
[0m13:01:25.172742 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.uprn_match
[0m13:01:25.173475 [debug] [Thread-2 (]: Began running node model.rightmove_epc.no_uprn_match_to_rm
[0m13:01:25.174088 [info ] [Thread-2 (]: 6 of 6 START sql view model dbt_melissa_rm_epc.no_uprn_match_to_rm ............. [RUN]
[0m13:01:25.174652 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_rightmove, now model.rightmove_epc.no_uprn_match_to_rm)
[0m13:01:25.174912 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.no_uprn_match_to_rm
[0m13:01:25.177321 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.no_uprn_match_to_rm"
[0m13:01:25.178045 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.no_uprn_match_to_rm (compile): 13:01:25.175061 => 13:01:25.177887
[0m13:01:25.178307 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.no_uprn_match_to_rm
[0m13:01:25.181992 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.no_uprn_match_to_rm"
[0m13:01:25.183091 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.no_uprn_match_to_rm"
[0m13:01:25.183365 [debug] [Thread-2 (]: On model.rightmove_epc.no_uprn_match_to_rm: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.no_uprn_match_to_rm"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.no_uprn_match_to_rm
  
   as (
    with rm_no_match_to_epc  as ( -- rightmove uspn does not match epc

    select 
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL

     from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'NO'
    
),

epc_remove as (

    select EPC_UPRN,EPC_ADDRESSID from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'YES'  -- 
),

epc_matched as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs src
    left join epc_remove rem on src.UPRN = rem.EPC_UPRN
    
),

epc_fm_prep as (

    select * from epc_matched
    where EPC_UPRN is NULL

    
)


SELECT * FROM epc_fm_prep
WHERE UPRN NOT NULL
  );
[0m13:01:25.183606 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m13:01:25.532964 [debug] [Thread-2 (]: Snowflake adapter: Snowflake query id: 01b33f0d-0103-9acb-0000-719506356592
[0m13:01:25.533448 [debug] [Thread-2 (]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 46 at position 11 unexpected 'NOT'.
[0m13:01:25.533984 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.no_uprn_match_to_rm (execute): 13:01:25.178449 => 13:01:25.533786
[0m13:01:25.534359 [debug] [Thread-2 (]: On model.rightmove_epc.no_uprn_match_to_rm: Close
[0m13:01:25.627951 [debug] [Thread-2 (]: Database Error in model no_uprn_match_to_rm (models/matching/no_uprn_match_to_rm.sql)
  001003 (42000): SQL compilation error:
  syntax error line 46 at position 11 unexpected 'NOT'.
  compiled Code at target/run/rightmove_epc/models/matching/no_uprn_match_to_rm.sql
[0m13:01:25.628482 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '399feb95-bb90-418c-9348-78ff15f63f75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1061ff7d0>]}
[0m13:01:25.628984 [error] [Thread-2 (]: 6 of 6 ERROR creating sql view model dbt_melissa_rm_epc.no_uprn_match_to_rm .... [[31mERROR[0m in 0.45s]
[0m13:01:25.629460 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.no_uprn_match_to_rm
[0m13:01:25.630974 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:01:25.631230 [debug] [MainThread]: Connection 'model.rightmove_epc.uprn_match' was properly closed.
[0m13:01:25.631448 [debug] [MainThread]: Connection 'model.rightmove_epc.no_uprn_match_to_rm' was properly closed.
[0m13:01:25.631654 [debug] [MainThread]: Connection 'model.rightmove_epc.dim_addressid' was properly closed.
[0m13:01:25.631860 [debug] [MainThread]: Connection 'model.rightmove_epc.dim_uprn' was properly closed.
[0m13:01:25.632157 [info ] [MainThread]: 
[0m13:01:25.632410 [info ] [MainThread]: Finished running 6 view models in 0 hours 0 minutes and 3.20 seconds (3.20s).
[0m13:01:25.633273 [debug] [MainThread]: Command end result
[0m13:01:25.639967 [info ] [MainThread]: 
[0m13:01:25.640282 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m13:01:25.640495 [info ] [MainThread]: 
[0m13:01:25.640690 [error] [MainThread]:   Database Error in model no_uprn_match_to_rm (models/matching/no_uprn_match_to_rm.sql)
  001003 (42000): SQL compilation error:
  syntax error line 46 at position 11 unexpected 'NOT'.
  compiled Code at target/run/rightmove_epc/models/matching/no_uprn_match_to_rm.sql
[0m13:01:25.640928 [info ] [MainThread]: 
[0m13:01:25.641212 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=0 TOTAL=6
[0m13:01:25.642999 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 3.5194848, "process_user_time": 1.494725, "process_kernel_time": 0.177282, "process_mem_max_rss": "136642560", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m13:01:25.643457 [debug] [MainThread]: Command `dbt run` failed at 13:01:25.643372 after 3.52 seconds
[0m13:01:25.643741 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100912110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10522eb90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100a14f10>]}
[0m13:01:25.643998 [debug] [MainThread]: Flushing usage events
[0m13:02:22.141335 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10791ad90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1079527d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10795efd0>]}


============================== 13:02:22.144356 | 47f5eee3-3192-426f-908a-6bb1170e3c8b ==============================
[0m13:02:22.144356 [info ] [MainThread]: Running with dbt=1.7.10
[0m13:02:22.144803 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'fail_fast': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'invocation_command': 'dbt run', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m13:02:22.334744 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '47f5eee3-3192-426f-908a-6bb1170e3c8b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107937590>]}
[0m13:02:22.377102 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '47f5eee3-3192-426f-908a-6bb1170e3c8b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107b1d950>]}
[0m13:02:22.378894 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m13:02:22.389548 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m13:02:22.412844 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m13:02:22.413155 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m13:02:22.416756 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '47f5eee3-3192-426f-908a-6bb1170e3c8b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110e82dd0>]}
[0m13:02:22.423336 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '47f5eee3-3192-426f-908a-6bb1170e3c8b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110e333d0>]}
[0m13:02:22.423615 [info ] [MainThread]: Found 6 models, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m13:02:22.423843 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '47f5eee3-3192-426f-908a-6bb1170e3c8b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110d38c10>]}
[0m13:02:22.424981 [info ] [MainThread]: 
[0m13:02:22.425493 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m13:02:22.426467 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m13:02:22.434162 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m13:02:22.434462 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m13:02:22.434647 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:02:22.858893 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 0.0 seconds
[0m13:02:22.861025 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m13:02:22.980461 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m13:02:22.987978 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m13:02:22.988332 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m13:02:22.988594 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:02:23.457059 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m13:02:23.460960 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m13:02:23.540433 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '47f5eee3-3192-426f-908a-6bb1170e3c8b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110abcf10>]}
[0m13:02:23.541388 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m13:02:23.541790 [info ] [MainThread]: 
[0m13:02:23.545114 [debug] [Thread-1 (]: Began running node model.rightmove_epc.stg_epc_certs
[0m13:02:23.545491 [debug] [Thread-2 (]: Began running node model.rightmove_epc.stg_rightmove
[0m13:02:23.545959 [info ] [Thread-1 (]: 1 of 6 START sql view model dbt_melissa_rm_epc.stg_epc_certs ................... [RUN]
[0m13:02:23.546401 [info ] [Thread-2 (]: 2 of 6 START sql view model dbt_melissa_rm_epc.stg_rightmove ................... [RUN]
[0m13:02:23.547056 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.stg_epc_certs)
[0m13:02:23.547836 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.stg_rightmove'
[0m13:02:23.548262 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.stg_epc_certs
[0m13:02:23.548629 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.stg_rightmove
[0m13:02:23.555400 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.stg_epc_certs"
[0m13:02:23.557869 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.stg_rightmove"
[0m13:02:23.558552 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (compile): 13:02:23.548850 => 13:02:23.558373
[0m13:02:23.558878 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (compile): 13:02:23.555736 => 13:02:23.558714
[0m13:02:23.559136 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.stg_epc_certs
[0m13:02:23.559399 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.stg_rightmove
[0m13:02:23.578587 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.stg_epc_certs"
[0m13:02:23.581587 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.stg_rightmove"
[0m13:02:23.582723 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.stg_epc_certs"
[0m13:02:23.583377 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.stg_rightmove"
[0m13:02:23.583692 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_epc_certs"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
  
   as (
    WITH epc_certs as (
    
    select 
    UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    COUNTY,
    LOCAL_AUTHORITY as LOCAL_AUTHORITY_CODE,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    CASE WHEN UPPER(ADDRESS1) LIKE 'FLAT%' OR UPPER(ADDRESS1) LIKE 'UNIT%' THEN TRIM(REPLACE(REPLACE(CONCAT(ADDRESS1,ADDRESS2),','),' '))
    ELSE trim(replace(replace(ADDRESS1,' '),',')) END AS ADDRESSID
 from  RAW.EPC_TEST_DATA.EPC_CERTIFICATES 

)

SELECT * FROM epc_certs
  );
[0m13:02:23.583982 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_rightmove"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
  
   as (
    with rm as (

    SELECT 
    TRIM(replace(REPLACE(CONCAT(ADDRESS_1::VARCHAR,ADDRESS_2::VARCHAR),' '),',')) AS ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL 
    FROM 
       ANALYTICS.RIGHTMOVE_PROD.CLEAN_RAW_RIGHTMOVE_DATA 

 
)

SELECT * FROM rm
  );
[0m13:02:23.584250 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:02:23.584496 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m13:02:24.165859 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:02:24.187442 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (execute): 13:02:23.578794 => 13:02:24.187254
[0m13:02:24.187853 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: Close
[0m13:02:24.189162 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:02:24.191141 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (execute): 13:02:23.559559 => 13:02:24.190995
[0m13:02:24.191713 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: Close
[0m13:02:24.288560 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '47f5eee3-3192-426f-908a-6bb1170e3c8b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110e53350>]}
[0m13:02:24.289653 [info ] [Thread-2 (]: 2 of 6 OK created sql view model dbt_melissa_rm_epc.stg_rightmove .............. [[32mSUCCESS 1[0m in 0.74s]
[0m13:02:24.290348 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.stg_rightmove
[0m13:02:24.291695 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '47f5eee3-3192-426f-908a-6bb1170e3c8b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110a39550>]}
[0m13:02:24.292199 [info ] [Thread-1 (]: 1 of 6 OK created sql view model dbt_melissa_rm_epc.stg_epc_certs .............. [[32mSUCCESS 1[0m in 0.74s]
[0m13:02:24.292662 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.stg_epc_certs
[0m13:02:24.293307 [debug] [Thread-4 (]: Began running node model.rightmove_epc.dim_addressid
[0m13:02:24.293636 [debug] [Thread-3 (]: Began running node model.rightmove_epc.dim_uprn
[0m13:02:24.294013 [info ] [Thread-4 (]: 3 of 6 START sql view model dbt_melissa_rm_epc.dim_addressid ................... [RUN]
[0m13:02:24.294356 [debug] [Thread-2 (]: Began running node model.rightmove_epc.uprn_match
[0m13:02:24.294709 [info ] [Thread-3 (]: 4 of 6 START sql view model dbt_melissa_rm_epc.dim_uprn ........................ [RUN]
[0m13:02:24.295345 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_addressid'
[0m13:02:24.295709 [info ] [Thread-2 (]: 5 of 6 START sql view model dbt_melissa_rm_epc.uprn_match ...................... [RUN]
[0m13:02:24.296304 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_uprn'
[0m13:02:24.296599 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.dim_addressid
[0m13:02:24.297095 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_rightmove, now model.rightmove_epc.uprn_match)
[0m13:02:24.297398 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.dim_uprn
[0m13:02:24.300270 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.dim_addressid"
[0m13:02:24.300642 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.uprn_match
[0m13:02:24.303010 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.dim_uprn"
[0m13:02:24.305832 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.uprn_match"
[0m13:02:24.306542 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_addressid (compile): 13:02:24.297580 => 13:02:24.306285
[0m13:02:24.307130 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.dim_addressid
[0m13:02:24.307590 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.dim_uprn (compile): 13:02:24.300831 => 13:02:24.307424
[0m13:02:24.310136 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.dim_addressid"
[0m13:02:24.310464 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.dim_uprn
[0m13:02:24.310726 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.uprn_match (compile): 13:02:24.303532 => 13:02:24.310601
[0m13:02:24.312885 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.dim_uprn"
[0m13:02:24.313164 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.uprn_match
[0m13:02:24.315308 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.uprn_match"
[0m13:02:24.315939 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.dim_addressid"
[0m13:02:24.316540 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.dim_uprn"
[0m13:02:24.316807 [debug] [Thread-4 (]: On model.rightmove_epc.dim_addressid: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_addressid"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
  
   as (
    with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where uprn is null
and addressid is not null
  );
[0m13:02:24.317109 [debug] [Thread-3 (]: On model.rightmove_epc.dim_uprn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_uprn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
  
   as (
    with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where uprn is not null
  );
[0m13:02:24.317757 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.uprn_match"
[0m13:02:24.317971 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m13:02:24.318194 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m13:02:24.318450 [debug] [Thread-2 (]: On model.rightmove_epc.uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
  
   as (
    with epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    where uprn is not null

),

rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where uprn is not null
),

final as (

    select 
    rm.ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    rm.UPRN,
    rm.LOCAL_AUTHORITY_CODE,
    rm.LOCAL_AUTHORITY,
    rm.GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    epc.UPRN AS EPC_UPRN,
    epc.TOTAL_FLOOR_AREA,
    epc.ADDRESSID as EPC_ADDRESSID,
    CASE WHEN epc.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC    
    
     from rm left join epc on rm.uprn = epc.uprn
)

select * from final
  );
[0m13:02:24.319983 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m13:02:24.841111 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:02:24.843812 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_addressid (execute): 13:02:24.307796 => 13:02:24.843627
[0m13:02:24.844157 [debug] [Thread-4 (]: On model.rightmove_epc.dim_addressid: Close
[0m13:02:24.908933 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:02:24.911831 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.dim_uprn (execute): 13:02:24.310945 => 13:02:24.911615
[0m13:02:24.912255 [debug] [Thread-3 (]: On model.rightmove_epc.dim_uprn: Close
[0m13:02:24.926046 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:02:24.928911 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.uprn_match (execute): 13:02:24.313387 => 13:02:24.928691
[0m13:02:24.929351 [debug] [Thread-2 (]: On model.rightmove_epc.uprn_match: Close
[0m13:02:24.948715 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '47f5eee3-3192-426f-908a-6bb1170e3c8b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110d4fb50>]}
[0m13:02:24.949407 [info ] [Thread-4 (]: 3 of 6 OK created sql view model dbt_melissa_rm_epc.dim_addressid .............. [[32mSUCCESS 1[0m in 0.65s]
[0m13:02:24.950265 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.dim_addressid
[0m13:02:25.004349 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '47f5eee3-3192-426f-908a-6bb1170e3c8b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1110d9dd0>]}
[0m13:02:25.004907 [info ] [Thread-3 (]: 4 of 6 OK created sql view model dbt_melissa_rm_epc.dim_uprn ................... [[32mSUCCESS 1[0m in 0.71s]
[0m13:02:25.005337 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.dim_uprn
[0m13:02:25.037293 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '47f5eee3-3192-426f-908a-6bb1170e3c8b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110a58a50>]}
[0m13:02:25.037829 [info ] [Thread-2 (]: 5 of 6 OK created sql view model dbt_melissa_rm_epc.uprn_match ................. [[32mSUCCESS 1[0m in 0.74s]
[0m13:02:25.038216 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.uprn_match
[0m13:02:25.038745 [debug] [Thread-1 (]: Began running node model.rightmove_epc.no_uprn_match_to_rm
[0m13:02:25.039172 [info ] [Thread-1 (]: 6 of 6 START sql view model dbt_melissa_rm_epc.no_uprn_match_to_rm ............. [RUN]
[0m13:02:25.039694 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_epc_certs, now model.rightmove_epc.no_uprn_match_to_rm)
[0m13:02:25.039971 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.no_uprn_match_to_rm
[0m13:02:25.042191 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.no_uprn_match_to_rm"
[0m13:02:25.042798 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.no_uprn_match_to_rm (compile): 13:02:25.040133 => 13:02:25.042659
[0m13:02:25.043047 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.no_uprn_match_to_rm
[0m13:02:25.046372 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.no_uprn_match_to_rm"
[0m13:02:25.047322 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.no_uprn_match_to_rm"
[0m13:02:25.047579 [debug] [Thread-1 (]: On model.rightmove_epc.no_uprn_match_to_rm: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.no_uprn_match_to_rm"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.no_uprn_match_to_rm
  
   as (
    with rm_no_match_to_epc  as ( -- rightmove uspn does not match epc

    select 
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL

     from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'NO'
    
),

epc_remove as (

    select EPC_UPRN,EPC_ADDRESSID from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'YES'  -- 
),

epc_matched as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs src
    left join epc_remove rem on src.UPRN = rem.EPC_UPRN
    
),

epc_fm_prep as (

    select * from epc_matched
    where EPC_UPRN is NULL

    
)


SELECT * FROM epc_fm_prep
WHERE UPRN NOT NULL
  );
[0m13:02:25.047813 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:02:25.367532 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b33f0e-0103-99eb-0000-7195063527b2
[0m13:02:25.367939 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 46 at position 11 unexpected 'NOT'.
[0m13:02:25.368393 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.no_uprn_match_to_rm (execute): 13:02:25.043191 => 13:02:25.368223
[0m13:02:25.368699 [debug] [Thread-1 (]: On model.rightmove_epc.no_uprn_match_to_rm: Close
[0m13:02:25.464902 [debug] [Thread-1 (]: Database Error in model no_uprn_match_to_rm (models/matching/no_uprn_match_to_rm.sql)
  001003 (42000): SQL compilation error:
  syntax error line 46 at position 11 unexpected 'NOT'.
  compiled Code at target/run/rightmove_epc/models/matching/no_uprn_match_to_rm.sql
[0m13:02:25.465382 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '47f5eee3-3192-426f-908a-6bb1170e3c8b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107901e50>]}
[0m13:02:25.465818 [error] [Thread-1 (]: 6 of 6 ERROR creating sql view model dbt_melissa_rm_epc.no_uprn_match_to_rm .... [[31mERROR[0m in 0.43s]
[0m13:02:25.466242 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.no_uprn_match_to_rm
[0m13:02:25.467513 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:02:25.467778 [debug] [MainThread]: Connection 'model.rightmove_epc.no_uprn_match_to_rm' was properly closed.
[0m13:02:25.467987 [debug] [MainThread]: Connection 'model.rightmove_epc.uprn_match' was properly closed.
[0m13:02:25.468185 [debug] [MainThread]: Connection 'model.rightmove_epc.dim_addressid' was properly closed.
[0m13:02:25.468373 [debug] [MainThread]: Connection 'model.rightmove_epc.dim_uprn' was properly closed.
[0m13:02:25.468644 [info ] [MainThread]: 
[0m13:02:25.468879 [info ] [MainThread]: Finished running 6 view models in 0 hours 0 minutes and 3.04 seconds (3.04s).
[0m13:02:25.469654 [debug] [MainThread]: Command end result
[0m13:02:25.475878 [info ] [MainThread]: 
[0m13:02:25.476173 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m13:02:25.476379 [info ] [MainThread]: 
[0m13:02:25.476576 [error] [MainThread]:   Database Error in model no_uprn_match_to_rm (models/matching/no_uprn_match_to_rm.sql)
  001003 (42000): SQL compilation error:
  syntax error line 46 at position 11 unexpected 'NOT'.
  compiled Code at target/run/rightmove_epc/models/matching/no_uprn_match_to_rm.sql
[0m13:02:25.476784 [info ] [MainThread]: 
[0m13:02:25.477167 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=0 TOTAL=6
[0m13:02:25.479060 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 3.369811, "process_user_time": 1.536805, "process_kernel_time": 0.180094, "process_mem_max_rss": "137805824", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m13:02:25.479514 [debug] [MainThread]: Command `dbt run` failed at 13:02:25.479425 after 3.37 seconds
[0m13:02:25.479815 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102d56110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1055a1950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102e58f10>]}
[0m13:02:25.480081 [debug] [MainThread]: Flushing usage events
[0m13:03:43.850247 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11141a010>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11145e790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11145f310>]}


============================== 13:03:43.853235 | 4c066bff-7a2f-49ef-a245-77f8c5d82532 ==============================
[0m13:03:43.853235 [info ] [MainThread]: Running with dbt=1.7.10
[0m13:03:43.853650 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'version_check': 'True', 'profiles_dir': '/Users/melissabee/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m13:03:44.049281 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4c066bff-7a2f-49ef-a245-77f8c5d82532', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1127fc5d0>]}
[0m13:03:44.091718 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4c066bff-7a2f-49ef-a245-77f8c5d82532', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11292bbd0>]}
[0m13:03:44.092585 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m13:03:44.102373 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m13:03:44.119649 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m13:03:44.119961 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m13:03:44.123702 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4c066bff-7a2f-49ef-a245-77f8c5d82532', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112afb250>]}
[0m13:03:44.130565 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4c066bff-7a2f-49ef-a245-77f8c5d82532', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1129eb590>]}
[0m13:03:44.130867 [info ] [MainThread]: Found 6 models, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m13:03:44.131081 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4c066bff-7a2f-49ef-a245-77f8c5d82532', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11288b2d0>]}
[0m13:03:44.132156 [info ] [MainThread]: 
[0m13:03:44.132598 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m13:03:44.133309 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m13:03:44.140761 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m13:03:44.141067 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m13:03:44.141251 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:03:44.664148 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 1.0 seconds
[0m13:03:44.667197 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m13:03:44.769814 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m13:03:44.779204 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m13:03:44.779647 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m13:03:44.779961 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:03:45.234872 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m13:03:45.236670 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m13:03:45.328314 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4c066bff-7a2f-49ef-a245-77f8c5d82532', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1127bcf50>]}
[0m13:03:45.329194 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m13:03:45.329540 [info ] [MainThread]: 
[0m13:03:45.333101 [debug] [Thread-1 (]: Began running node model.rightmove_epc.stg_epc_certs
[0m13:03:45.333440 [debug] [Thread-2 (]: Began running node model.rightmove_epc.stg_rightmove
[0m13:03:45.333841 [info ] [Thread-1 (]: 1 of 6 START sql view model dbt_melissa_rm_epc.stg_epc_certs ................... [RUN]
[0m13:03:45.334214 [info ] [Thread-2 (]: 2 of 6 START sql view model dbt_melissa_rm_epc.stg_rightmove ................... [RUN]
[0m13:03:45.334780 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.stg_epc_certs)
[0m13:03:45.335348 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.stg_rightmove'
[0m13:03:45.335640 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.stg_epc_certs
[0m13:03:45.335915 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.stg_rightmove
[0m13:03:45.342307 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.stg_epc_certs"
[0m13:03:45.344429 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.stg_rightmove"
[0m13:03:45.345287 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (compile): 13:03:45.336092 => 13:03:45.345020
[0m13:03:45.345665 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (compile): 13:03:45.342551 => 13:03:45.345484
[0m13:03:45.345967 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.stg_epc_certs
[0m13:03:45.346235 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.stg_rightmove
[0m13:03:45.364560 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.stg_epc_certs"
[0m13:03:45.367468 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.stg_rightmove"
[0m13:03:45.368275 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.stg_rightmove"
[0m13:03:45.368535 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_rightmove"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
  
   as (
    with rm as (

    SELECT 
    TRIM(replace(REPLACE(CONCAT(ADDRESS_1::VARCHAR,ADDRESS_2::VARCHAR),' '),',')) AS ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL 
    FROM 
       ANALYTICS.RIGHTMOVE_PROD.CLEAN_RAW_RIGHTMOVE_DATA 

 
)

SELECT * FROM rm
  );
[0m13:03:45.368764 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m13:03:45.369314 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.stg_epc_certs"
[0m13:03:45.404483 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_epc_certs"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
  
   as (
    WITH epc_certs as (
    
    select 
    UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    COUNTY,
    LOCAL_AUTHORITY as LOCAL_AUTHORITY_CODE,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    CASE WHEN (UPPER(ADDRESS1) LIKE 'FLAT%' OR UPPER(ADDRESS1) LIKE 'UNIT%') or UPPER(ADDRESS1) LIKE 'ROOM%' or  THEN TRIM(REPLACE(REPLACE(CONCAT(ADDRESS1,ADDRESS2,ADDRESS3),','),' '))
    ELSE trim(replace(replace(ADDRESS1,' '),',')) END AS ADDRESSID
 from  RAW.EPC_TEST_DATA.EPC_CERTIFICATES 

)

SELECT * FROM epc_certs
  );
[0m13:03:45.404838 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:03:45.719498 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b33f0f-0103-9acb-0000-7195063565e6
[0m13:03:45.719925 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 18 at position 113 unexpected 'THEN'.
[0m13:03:45.720362 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (execute): 13:03:45.346396 => 13:03:45.720206
[0m13:03:45.720669 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: Close
[0m13:03:45.811860 [debug] [Thread-1 (]: Database Error in model stg_epc_certs (models/staging/stg_epc_certs.sql)
  001003 (42000): SQL compilation error:
  syntax error line 18 at position 113 unexpected 'THEN'.
  compiled Code at target/run/rightmove_epc/models/staging/stg_epc_certs.sql
[0m13:03:45.812451 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4c066bff-7a2f-49ef-a245-77f8c5d82532', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112be2a50>]}
[0m13:03:45.812982 [error] [Thread-1 (]: 1 of 6 ERROR creating sql view model dbt_melissa_rm_epc.stg_epc_certs .......... [[31mERROR[0m in 0.48s]
[0m13:03:45.813472 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.stg_epc_certs
[0m13:03:46.046966 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:03:46.062630 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (execute): 13:03:45.364817 => 13:03:46.062483
[0m13:03:46.062914 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: Close
[0m13:03:46.160471 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4c066bff-7a2f-49ef-a245-77f8c5d82532', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112d35510>]}
[0m13:03:46.161109 [info ] [Thread-2 (]: 2 of 6 OK created sql view model dbt_melissa_rm_epc.stg_rightmove .............. [[32mSUCCESS 1[0m in 0.83s]
[0m13:03:46.161601 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.stg_rightmove
[0m13:03:46.162238 [debug] [Thread-4 (]: Began running node model.rightmove_epc.dim_addressid
[0m13:03:46.162548 [debug] [Thread-3 (]: Began running node model.rightmove_epc.dim_uprn
[0m13:03:46.162810 [info ] [Thread-4 (]: 3 of 6 SKIP relation dbt_melissa_rm_epc.dim_addressid .......................... [[33mSKIP[0m]
[0m13:03:46.163132 [debug] [Thread-1 (]: Began running node model.rightmove_epc.uprn_match
[0m13:03:46.163474 [info ] [Thread-3 (]: 4 of 6 SKIP relation dbt_melissa_rm_epc.dim_uprn ............................... [[33mSKIP[0m]
[0m13:03:46.163800 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.dim_addressid
[0m13:03:46.164069 [info ] [Thread-1 (]: 5 of 6 SKIP relation dbt_melissa_rm_epc.uprn_match ............................. [[33mSKIP[0m]
[0m13:03:46.164355 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.dim_uprn
[0m13:03:46.164675 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.uprn_match
[0m13:03:46.165216 [debug] [Thread-2 (]: Began running node model.rightmove_epc.no_uprn_match_to_rm
[0m13:03:46.165575 [info ] [Thread-2 (]: 6 of 6 SKIP relation dbt_melissa_rm_epc.no_uprn_match_to_rm .................... [[33mSKIP[0m]
[0m13:03:46.165890 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.no_uprn_match_to_rm
[0m13:03:46.167100 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:03:46.167346 [debug] [MainThread]: Connection 'model.rightmove_epc.stg_epc_certs' was properly closed.
[0m13:03:46.167551 [debug] [MainThread]: Connection 'model.rightmove_epc.stg_rightmove' was properly closed.
[0m13:03:46.167798 [info ] [MainThread]: 
[0m13:03:46.168034 [info ] [MainThread]: Finished running 6 view models in 0 hours 0 minutes and 2.04 seconds (2.04s).
[0m13:03:46.168600 [debug] [MainThread]: Command end result
[0m13:03:46.174740 [info ] [MainThread]: 
[0m13:03:46.175155 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m13:03:46.175377 [info ] [MainThread]: 
[0m13:03:46.175594 [error] [MainThread]:   Database Error in model stg_epc_certs (models/staging/stg_epc_certs.sql)
  001003 (42000): SQL compilation error:
  syntax error line 18 at position 113 unexpected 'THEN'.
  compiled Code at target/run/rightmove_epc/models/staging/stg_epc_certs.sql
[0m13:03:46.175822 [info ] [MainThread]: 
[0m13:03:46.176032 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=1 SKIP=4 TOTAL=6
[0m13:03:46.178224 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 2.3601377, "process_user_time": 1.383049, "process_kernel_time": 0.165001, "process_mem_max_rss": "135823360", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m13:03:46.178658 [debug] [MainThread]: Command `dbt run` failed at 13:03:46.178573 after 2.36 seconds
[0m13:03:46.178942 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111487490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10303e110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110bf18d0>]}
[0m13:03:46.179203 [debug] [MainThread]: Flushing usage events
[0m13:04:17.520513 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109918ad0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10995e610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10995f190>]}


============================== 13:04:17.523593 | 7998e61b-22d3-4dae-9d4d-1cf9f09f828b ==============================
[0m13:04:17.523593 [info ] [MainThread]: Running with dbt=1.7.10
[0m13:04:17.523967 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'profiles_dir': '/Users/melissabee/.dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m13:04:17.711998 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7998e61b-22d3-4dae-9d4d-1cf9f09f828b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a48e5d0>]}
[0m13:04:17.751581 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7998e61b-22d3-4dae-9d4d-1cf9f09f828b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a52b610>]}
[0m13:04:17.752264 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m13:04:17.762136 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m13:04:17.790379 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m13:04:17.790703 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m13:04:17.794299 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7998e61b-22d3-4dae-9d4d-1cf9f09f828b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a70ea90>]}
[0m13:04:17.800897 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7998e61b-22d3-4dae-9d4d-1cf9f09f828b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a48b550>]}
[0m13:04:17.801197 [info ] [MainThread]: Found 6 models, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m13:04:17.801426 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7998e61b-22d3-4dae-9d4d-1cf9f09f828b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a3caf50>]}
[0m13:04:17.802513 [info ] [MainThread]: 
[0m13:04:17.802965 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m13:04:17.803726 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m13:04:17.811088 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m13:04:17.811388 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m13:04:17.811580 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:04:18.225048 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 0.0 seconds
[0m13:04:18.227618 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m13:04:18.306927 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m13:04:18.316026 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m13:04:18.316446 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m13:04:18.316736 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:04:18.824394 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m13:04:18.829163 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m13:04:18.921508 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7998e61b-22d3-4dae-9d4d-1cf9f09f828b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a503410>]}
[0m13:04:18.922927 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m13:04:18.923349 [info ] [MainThread]: 
[0m13:04:18.928494 [debug] [Thread-1 (]: Began running node model.rightmove_epc.stg_epc_certs
[0m13:04:18.929126 [debug] [Thread-2 (]: Began running node model.rightmove_epc.stg_rightmove
[0m13:04:18.929871 [info ] [Thread-1 (]: 1 of 6 START sql view model dbt_melissa_rm_epc.stg_epc_certs ................... [RUN]
[0m13:04:18.930679 [info ] [Thread-2 (]: 2 of 6 START sql view model dbt_melissa_rm_epc.stg_rightmove ................... [RUN]
[0m13:04:18.931679 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.stg_epc_certs)
[0m13:04:18.932511 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.stg_rightmove'
[0m13:04:18.933059 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.stg_epc_certs
[0m13:04:18.933497 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.stg_rightmove
[0m13:04:18.940717 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.stg_epc_certs"
[0m13:04:18.943519 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.stg_rightmove"
[0m13:04:18.944460 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (compile): 13:04:18.933772 => 13:04:18.944260
[0m13:04:18.944804 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (compile): 13:04:18.941044 => 13:04:18.944635
[0m13:04:18.945046 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.stg_epc_certs
[0m13:04:18.945293 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.stg_rightmove
[0m13:04:18.961375 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.stg_epc_certs"
[0m13:04:18.964625 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.stg_rightmove"
[0m13:04:18.965767 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.stg_epc_certs"
[0m13:04:18.966342 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.stg_rightmove"
[0m13:04:18.966588 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_epc_certs"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
  
   as (
    WITH epc_certs as (
    
    select 
    UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    COUNTY,
    LOCAL_AUTHORITY as LOCAL_AUTHORITY_CODE,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    CASE WHEN (UPPER(ADDRESS1) LIKE 'FLAT%' OR UPPER(ADDRESS1) LIKE 'UNIT%') or UPPER(ADDRESS1) LIKE 'ROOM%' 
    THEN TRIM(REPLACE(REPLACE(CONCAT(ADDRESS1,ADDRESS2,ADDRESS3),','),' '))
    ELSE trim(replace(replace(ADDRESS1,' '),',')) END AS ADDRESSID
 from  RAW.EPC_TEST_DATA.EPC_CERTIFICATES 

)

SELECT * FROM epc_certs
  );
[0m13:04:18.966852 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_rightmove"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
  
   as (
    with rm as (

    SELECT 
    TRIM(replace(REPLACE(CONCAT(ADDRESS_1::VARCHAR,ADDRESS_2::VARCHAR),' '),',')) AS ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL 
    FROM 
       ANALYTICS.RIGHTMOVE_PROD.CLEAN_RAW_RIGHTMOVE_DATA 

 
)

SELECT * FROM rm
  );
[0m13:04:18.967074 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:04:18.967257 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m13:04:19.600754 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:04:19.619855 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (execute): 13:04:18.961638 => 13:04:19.619691
[0m13:04:19.620390 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: Close
[0m13:04:19.620906 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:04:19.623410 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (execute): 13:04:18.945461 => 13:04:19.623263
[0m13:04:19.623982 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: Close
[0m13:04:19.703545 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7998e61b-22d3-4dae-9d4d-1cf9f09f828b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a5c9d90>]}
[0m13:04:19.704191 [info ] [Thread-1 (]: 1 of 6 OK created sql view model dbt_melissa_rm_epc.stg_epc_certs .............. [[32mSUCCESS 1[0m in 0.77s]
[0m13:04:19.704622 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.stg_epc_certs
[0m13:04:20.140313 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7998e61b-22d3-4dae-9d4d-1cf9f09f828b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1099df4d0>]}
[0m13:04:20.140840 [info ] [Thread-2 (]: 2 of 6 OK created sql view model dbt_melissa_rm_epc.stg_rightmove .............. [[32mSUCCESS 1[0m in 1.21s]
[0m13:04:20.141208 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.stg_rightmove
[0m13:04:20.141689 [debug] [Thread-4 (]: Began running node model.rightmove_epc.dim_addressid
[0m13:04:20.141949 [info ] [Thread-4 (]: 3 of 6 START sql view model dbt_melissa_rm_epc.dim_addressid ................... [RUN]
[0m13:04:20.142536 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_addressid'
[0m13:04:20.142831 [debug] [Thread-3 (]: Began running node model.rightmove_epc.dim_uprn
[0m13:04:20.143049 [debug] [Thread-1 (]: Began running node model.rightmove_epc.uprn_match
[0m13:04:20.143259 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.dim_addressid
[0m13:04:20.143531 [info ] [Thread-3 (]: 4 of 6 START sql view model dbt_melissa_rm_epc.dim_uprn ........................ [RUN]
[0m13:04:20.143808 [info ] [Thread-1 (]: 5 of 6 START sql view model dbt_melissa_rm_epc.uprn_match ...................... [RUN]
[0m13:04:20.146240 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.dim_addressid"
[0m13:04:20.147074 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_uprn'
[0m13:04:20.147942 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_epc_certs, now model.rightmove_epc.uprn_match)
[0m13:04:20.148561 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.dim_uprn
[0m13:04:20.149014 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.uprn_match
[0m13:04:20.152384 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.dim_uprn"
[0m13:04:20.154940 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.uprn_match"
[0m13:04:20.155333 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_addressid (compile): 13:04:20.143969 => 13:04:20.155157
[0m13:04:20.155745 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.dim_addressid
[0m13:04:20.157840 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.dim_addressid"
[0m13:04:20.158258 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.dim_uprn (compile): 13:04:20.149291 => 13:04:20.158132
[0m13:04:20.158616 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.dim_uprn
[0m13:04:20.158881 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.uprn_match (compile): 13:04:20.152825 => 13:04:20.158758
[0m13:04:20.159584 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.dim_addressid"
[0m13:04:20.161611 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.dim_uprn"
[0m13:04:20.161919 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.uprn_match
[0m13:04:20.162179 [debug] [Thread-4 (]: On model.rightmove_epc.dim_addressid: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_addressid"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
  
   as (
    with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where uprn is null
and addressid is not null
  );
[0m13:04:20.164386 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.uprn_match"
[0m13:04:20.164727 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m13:04:20.165410 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.dim_uprn"
[0m13:04:20.166435 [debug] [Thread-3 (]: On model.rightmove_epc.dim_uprn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_uprn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
  
   as (
    with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where uprn is not null
  );
[0m13:04:20.166825 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m13:04:20.167602 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.uprn_match"
[0m13:04:20.169005 [debug] [Thread-1 (]: On model.rightmove_epc.uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
  
   as (
    with epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    where uprn is not null

),

rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where uprn is not null
),

final as (

    select 
    rm.ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    rm.UPRN,
    rm.LOCAL_AUTHORITY_CODE,
    rm.LOCAL_AUTHORITY,
    rm.GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    epc.UPRN AS EPC_UPRN,
    epc.TOTAL_FLOOR_AREA,
    epc.ADDRESSID as EPC_ADDRESSID,
    CASE WHEN epc.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC    
    
     from rm left join epc on rm.uprn = epc.uprn
)

select * from final
  );
[0m13:04:20.169338 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:04:20.758751 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:04:20.761518 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.uprn_match (execute): 13:04:20.162545 => 13:04:20.761308
[0m13:04:20.761896 [debug] [Thread-1 (]: On model.rightmove_epc.uprn_match: Close
[0m13:04:20.844682 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7998e61b-22d3-4dae-9d4d-1cf9f09f828b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a53ead0>]}
[0m13:04:20.845310 [info ] [Thread-1 (]: 5 of 6 OK created sql view model dbt_melissa_rm_epc.uprn_match ................. [[32mSUCCESS 1[0m in 0.70s]
[0m13:04:20.845746 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.uprn_match
[0m13:04:20.846160 [debug] [Thread-2 (]: Began running node model.rightmove_epc.no_uprn_match_to_rm
[0m13:04:20.846460 [info ] [Thread-2 (]: 6 of 6 START sql view model dbt_melissa_rm_epc.no_uprn_match_to_rm ............. [RUN]
[0m13:04:20.846940 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_rightmove, now model.rightmove_epc.no_uprn_match_to_rm)
[0m13:04:20.847229 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.no_uprn_match_to_rm
[0m13:04:20.849956 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.no_uprn_match_to_rm"
[0m13:04:20.850621 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.no_uprn_match_to_rm (compile): 13:04:20.847390 => 13:04:20.850472
[0m13:04:20.850889 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.no_uprn_match_to_rm
[0m13:04:20.853371 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.no_uprn_match_to_rm"
[0m13:04:20.854535 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.no_uprn_match_to_rm"
[0m13:04:20.854863 [debug] [Thread-2 (]: On model.rightmove_epc.no_uprn_match_to_rm: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.no_uprn_match_to_rm"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.no_uprn_match_to_rm
  
   as (
    with rm_no_match_to_epc  as ( -- rightmove uspn does not match epc

    select 
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL

     from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'NO'
    
),

epc_remove as (

    select EPC_UPRN,EPC_ADDRESSID from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'YES'  -- 
),

epc_matched as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs src
    left join epc_remove rem on src.UPRN = rem.EPC_UPRN
    
),

epc_fm_prep as (

    select * from epc_matched
    where EPC_UPRN is NULL

    
)


SELECT * FROM epc_fm_prep
WHERE UPRN NOT NULL
  );
[0m13:04:20.856373 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m13:04:20.926301 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:04:20.928304 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.dim_uprn (execute): 13:04:20.159763 => 13:04:20.928162
[0m13:04:20.928603 [debug] [Thread-3 (]: On model.rightmove_epc.dim_uprn: Close
[0m13:04:21.220593 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7998e61b-22d3-4dae-9d4d-1cf9f09f828b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d008090>]}
[0m13:04:21.221492 [info ] [Thread-3 (]: 4 of 6 OK created sql view model dbt_melissa_rm_epc.dim_uprn ................... [[32mSUCCESS 1[0m in 1.07s]
[0m13:04:21.222129 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.dim_uprn
[0m13:04:21.249049 [debug] [Thread-2 (]: Snowflake adapter: Snowflake query id: 01b33f10-0103-9a62-0000-719506353916
[0m13:04:21.249501 [debug] [Thread-2 (]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 46 at position 11 unexpected 'NOT'.
[0m13:04:21.249977 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.no_uprn_match_to_rm (execute): 13:04:20.851039 => 13:04:21.249805
[0m13:04:21.250295 [debug] [Thread-2 (]: On model.rightmove_epc.no_uprn_match_to_rm: Close
[0m13:04:21.333550 [debug] [Thread-2 (]: Database Error in model no_uprn_match_to_rm (models/matching/no_uprn_match_to_rm.sql)
  001003 (42000): SQL compilation error:
  syntax error line 46 at position 11 unexpected 'NOT'.
  compiled Code at target/run/rightmove_epc/models/matching/no_uprn_match_to_rm.sql
[0m13:04:21.334001 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7998e61b-22d3-4dae-9d4d-1cf9f09f828b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a960d90>]}
[0m13:04:21.334412 [error] [Thread-2 (]: 6 of 6 ERROR creating sql view model dbt_melissa_rm_epc.no_uprn_match_to_rm .... [[31mERROR[0m in 0.49s]
[0m13:04:21.334806 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.no_uprn_match_to_rm
[0m13:04:21.791489 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m13:04:21.794186 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_addressid (execute): 13:04:20.155904 => 13:04:21.794010
[0m13:04:21.794517 [debug] [Thread-4 (]: On model.rightmove_epc.dim_addressid: Close
[0m13:04:21.909308 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7998e61b-22d3-4dae-9d4d-1cf9f09f828b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d009210>]}
[0m13:04:21.909877 [info ] [Thread-4 (]: 3 of 6 OK created sql view model dbt_melissa_rm_epc.dim_addressid .............. [[32mSUCCESS 1[0m in 1.77s]
[0m13:04:21.910296 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.dim_addressid
[0m13:04:21.911776 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:04:21.912121 [debug] [MainThread]: Connection 'model.rightmove_epc.uprn_match' was properly closed.
[0m13:04:21.912343 [debug] [MainThread]: Connection 'model.rightmove_epc.no_uprn_match_to_rm' was properly closed.
[0m13:04:21.912545 [debug] [MainThread]: Connection 'model.rightmove_epc.dim_addressid' was properly closed.
[0m13:04:21.912732 [debug] [MainThread]: Connection 'model.rightmove_epc.dim_uprn' was properly closed.
[0m13:04:21.913011 [info ] [MainThread]: 
[0m13:04:21.913255 [info ] [MainThread]: Finished running 6 view models in 0 hours 0 minutes and 4.11 seconds (4.11s).
[0m13:04:21.914086 [debug] [MainThread]: Command end result
[0m13:04:21.920405 [info ] [MainThread]: 
[0m13:04:21.920680 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m13:04:21.920873 [info ] [MainThread]: 
[0m13:04:21.921102 [error] [MainThread]:   Database Error in model no_uprn_match_to_rm (models/matching/no_uprn_match_to_rm.sql)
  001003 (42000): SQL compilation error:
  syntax error line 46 at position 11 unexpected 'NOT'.
  compiled Code at target/run/rightmove_epc/models/matching/no_uprn_match_to_rm.sql
[0m13:04:21.921404 [info ] [MainThread]: 
[0m13:04:21.921635 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=0 TOTAL=6
[0m13:04:21.923529 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 4.434595, "process_user_time": 1.539236, "process_kernel_time": 0.193275, "process_mem_max_rss": "140115968", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m13:04:21.923990 [debug] [MainThread]: Command `dbt run` failed at 13:04:21.923898 after 4.44 seconds
[0m13:04:21.924299 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102c62110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102d64d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102d64f10>]}
[0m13:04:21.924569 [debug] [MainThread]: Flushing usage events
[0m13:05:20.860291 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106d56790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106d9a890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106d9b410>]}


============================== 13:05:20.863286 | 49a316e9-7346-4062-aebd-6b7dbc54e8e7 ==============================
[0m13:05:20.863286 [info ] [MainThread]: Running with dbt=1.7.10
[0m13:05:20.863644 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m13:05:21.053131 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '49a316e9-7346-4062-aebd-6b7dbc54e8e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1078bee90>]}
[0m13:05:21.095266 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '49a316e9-7346-4062-aebd-6b7dbc54e8e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107aa3750>]}
[0m13:05:21.095957 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m13:05:21.106810 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m13:05:21.134715 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m13:05:21.135113 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m13:05:21.139017 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '49a316e9-7346-4062-aebd-6b7dbc54e8e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10789ce90>]}
[0m13:05:21.146154 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '49a316e9-7346-4062-aebd-6b7dbc54e8e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107b27d90>]}
[0m13:05:21.146516 [info ] [MainThread]: Found 6 models, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m13:05:21.146747 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '49a316e9-7346-4062-aebd-6b7dbc54e8e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107aeea10>]}
[0m13:05:21.147934 [info ] [MainThread]: 
[0m13:05:21.148473 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m13:05:21.149287 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m13:05:21.156958 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m13:05:21.157252 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m13:05:21.157435 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:05:21.604741 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 0.0 seconds
[0m13:05:21.606874 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m13:05:21.689137 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m13:05:21.695835 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m13:05:21.696123 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m13:05:21.696350 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:05:22.126359 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 0.0 seconds
[0m13:05:22.128373 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m13:05:22.216854 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '49a316e9-7346-4062-aebd-6b7dbc54e8e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1078ff410>]}
[0m13:05:22.217864 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m13:05:22.218245 [info ] [MainThread]: 
[0m13:05:22.221344 [debug] [Thread-1 (]: Began running node model.rightmove_epc.stg_epc_certs
[0m13:05:22.221733 [debug] [Thread-2 (]: Began running node model.rightmove_epc.stg_rightmove
[0m13:05:22.222202 [info ] [Thread-1 (]: 1 of 6 START sql view model dbt_melissa_rm_epc.stg_epc_certs ................... [RUN]
[0m13:05:22.222633 [info ] [Thread-2 (]: 2 of 6 START sql view model dbt_melissa_rm_epc.stg_rightmove ................... [RUN]
[0m13:05:22.223302 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.stg_epc_certs)
[0m13:05:22.224045 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.stg_rightmove'
[0m13:05:22.224401 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.stg_epc_certs
[0m13:05:22.224728 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.stg_rightmove
[0m13:05:22.231374 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.stg_epc_certs"
[0m13:05:22.233659 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.stg_rightmove"
[0m13:05:22.234354 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (compile): 13:05:22.224934 => 13:05:22.234164
[0m13:05:22.234673 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (compile): 13:05:22.231711 => 13:05:22.234520
[0m13:05:22.234938 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.stg_epc_certs
[0m13:05:22.235194 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.stg_rightmove
[0m13:05:22.253635 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.stg_epc_certs"
[0m13:05:22.256641 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.stg_rightmove"
[0m13:05:22.257519 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.stg_rightmove"
[0m13:05:22.258160 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.stg_epc_certs"
[0m13:05:22.258406 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_rightmove"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
  
   as (
    with rm as (

    SELECT 
    UPPER(TRIM(replace(REPLACE(CONCAT(ADDRESS_1::VARCHAR,ADDRESS_2::VARCHAR),' '),','))) AS ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL 
    FROM 
       ANALYTICS.RIGHTMOVE_PROD.CLEAN_RAW_RIGHTMOVE_DATA 

 
)

SELECT * FROM rm
  );
[0m13:05:22.258684 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_epc_certs"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
  
   as (
    WITH epc_certs as (
    
    select 
    UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    COUNTY,
    LOCAL_AUTHORITY as LOCAL_AUTHORITY_CODE,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    UPPER(CASE WHEN (UPPER(ADDRESS1) LIKE 'FLAT%' OR UPPER(ADDRESS1) LIKE 'UNIT%') or UPPER(ADDRESS1) LIKE 'ROOM%' 
    THEN TRIM(REPLACE(REPLACE(CONCAT(ADDRESS1,ADDRESS2,ADDRESS3),','),' '))
    ELSE trim(replace(replace(ADDRESS1,' '),',')) END) AS ADDRESSID
 from  RAW.EPC_TEST_DATA.EPC_CERTIFICATES 

)

SELECT * FROM epc_certs
  );
[0m13:05:22.258937 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m13:05:22.259142 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:05:22.916920 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:05:22.931641 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (execute): 13:05:22.235349 => 13:05:22.931506
[0m13:05:22.931983 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: Close
[0m13:05:23.021109 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '49a316e9-7346-4062-aebd-6b7dbc54e8e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10782bb90>]}
[0m13:05:23.021701 [info ] [Thread-1 (]: 1 of 6 OK created sql view model dbt_melissa_rm_epc.stg_epc_certs .............. [[32mSUCCESS 1[0m in 0.80s]
[0m13:05:23.022149 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.stg_epc_certs
[0m13:05:23.207553 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:05:23.212317 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (execute): 13:05:22.253905 => 13:05:23.212028
[0m13:05:23.212853 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: Close
[0m13:05:23.310454 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '49a316e9-7346-4062-aebd-6b7dbc54e8e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107838fd0>]}
[0m13:05:23.311441 [info ] [Thread-2 (]: 2 of 6 OK created sql view model dbt_melissa_rm_epc.stg_rightmove .............. [[32mSUCCESS 1[0m in 1.09s]
[0m13:05:23.312238 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.stg_rightmove
[0m13:05:23.313383 [debug] [Thread-4 (]: Began running node model.rightmove_epc.dim_addressid
[0m13:05:23.313968 [debug] [Thread-3 (]: Began running node model.rightmove_epc.dim_uprn
[0m13:05:23.314395 [debug] [Thread-1 (]: Began running node model.rightmove_epc.uprn_match
[0m13:05:23.314846 [info ] [Thread-4 (]: 3 of 6 START sql view model dbt_melissa_rm_epc.dim_addressid ................... [RUN]
[0m13:05:23.315360 [info ] [Thread-3 (]: 4 of 6 START sql view model dbt_melissa_rm_epc.dim_uprn ........................ [RUN]
[0m13:05:23.315832 [info ] [Thread-1 (]: 5 of 6 START sql view model dbt_melissa_rm_epc.uprn_match ...................... [RUN]
[0m13:05:23.316679 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_addressid'
[0m13:05:23.317439 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_uprn'
[0m13:05:23.318099 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_epc_certs, now model.rightmove_epc.uprn_match)
[0m13:05:23.318494 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.dim_addressid
[0m13:05:23.318855 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.dim_uprn
[0m13:05:23.319213 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.uprn_match
[0m13:05:23.322834 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.dim_addressid"
[0m13:05:23.326153 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.dim_uprn"
[0m13:05:23.328857 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.uprn_match"
[0m13:05:23.329957 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_addressid (compile): 13:05:23.319446 => 13:05:23.329675
[0m13:05:23.330370 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.dim_uprn (compile): 13:05:23.323222 => 13:05:23.330204
[0m13:05:23.330792 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.dim_addressid
[0m13:05:23.331215 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.uprn_match (compile): 13:05:23.326502 => 13:05:23.331027
[0m13:05:23.331545 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.dim_uprn
[0m13:05:23.334514 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.dim_addressid"
[0m13:05:23.334864 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.uprn_match
[0m13:05:23.337218 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.dim_uprn"
[0m13:05:23.339980 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.uprn_match"
[0m13:05:23.340931 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.dim_addressid"
[0m13:05:23.341362 [debug] [Thread-4 (]: On model.rightmove_epc.dim_addressid: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_addressid"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
  
   as (
    with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where uprn is null
and addressid is not null
  );
[0m13:05:23.342098 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.dim_uprn"
[0m13:05:23.342447 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m13:05:23.343245 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.uprn_match"
[0m13:05:23.343545 [debug] [Thread-3 (]: On model.rightmove_epc.dim_uprn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_uprn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
  
   as (
    with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where uprn is not null
  );
[0m13:05:23.344677 [debug] [Thread-1 (]: On model.rightmove_epc.uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
  
   as (
    with epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    where uprn is not null

),

rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where uprn is not null
),

final as (

    select 
    rm.ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    rm.UPRN,
    rm.LOCAL_AUTHORITY_CODE,
    rm.LOCAL_AUTHORITY,
    rm.GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    epc.UPRN AS EPC_UPRN,
    epc.TOTAL_FLOOR_AREA,
    epc.ADDRESSID as EPC_ADDRESSID,
    CASE WHEN epc.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC    
    
     from rm left join epc on rm.uprn = epc.uprn
)

select * from final
  );
[0m13:05:23.345085 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m13:05:23.345353 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:05:23.885166 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:05:23.888215 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.dim_uprn (execute): 13:05:23.335058 => 13:05:23.888011
[0m13:05:23.888606 [debug] [Thread-3 (]: On model.rightmove_epc.dim_uprn: Close
[0m13:05:23.890363 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:05:23.892829 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_addressid (execute): 13:05:23.331791 => 13:05:23.892655
[0m13:05:23.893218 [debug] [Thread-4 (]: On model.rightmove_epc.dim_addressid: Close
[0m13:05:23.978003 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '49a316e9-7346-4062-aebd-6b7dbc54e8e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107a5c8d0>]}
[0m13:05:23.978673 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '49a316e9-7346-4062-aebd-6b7dbc54e8e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107b93c10>]}
[0m13:05:23.979201 [info ] [Thread-4 (]: 3 of 6 OK created sql view model dbt_melissa_rm_epc.dim_addressid .............. [[32mSUCCESS 1[0m in 0.66s]
[0m13:05:23.979698 [info ] [Thread-3 (]: 4 of 6 OK created sql view model dbt_melissa_rm_epc.dim_uprn ................... [[32mSUCCESS 1[0m in 0.66s]
[0m13:05:23.980155 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.dim_addressid
[0m13:05:23.980505 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.dim_uprn
[0m13:05:23.995922 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:05:23.998026 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.uprn_match (execute): 13:05:23.337613 => 13:05:23.997868
[0m13:05:23.998339 [debug] [Thread-1 (]: On model.rightmove_epc.uprn_match: Close
[0m13:05:24.079095 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '49a316e9-7346-4062-aebd-6b7dbc54e8e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107a79290>]}
[0m13:05:24.079677 [info ] [Thread-1 (]: 5 of 6 OK created sql view model dbt_melissa_rm_epc.uprn_match ................. [[32mSUCCESS 1[0m in 0.76s]
[0m13:05:24.080090 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.uprn_match
[0m13:05:24.080582 [debug] [Thread-2 (]: Began running node model.rightmove_epc.no_uprn_match_to_rm
[0m13:05:24.081046 [info ] [Thread-2 (]: 6 of 6 START sql view model dbt_melissa_rm_epc.no_uprn_match_to_rm ............. [RUN]
[0m13:05:24.081627 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_rightmove, now model.rightmove_epc.no_uprn_match_to_rm)
[0m13:05:24.081906 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.no_uprn_match_to_rm
[0m13:05:24.084352 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.no_uprn_match_to_rm"
[0m13:05:24.084977 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.no_uprn_match_to_rm (compile): 13:05:24.082082 => 13:05:24.084827
[0m13:05:24.085236 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.no_uprn_match_to_rm
[0m13:05:24.088865 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.no_uprn_match_to_rm"
[0m13:05:24.090020 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.no_uprn_match_to_rm"
[0m13:05:24.090350 [debug] [Thread-2 (]: On model.rightmove_epc.no_uprn_match_to_rm: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.no_uprn_match_to_rm"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.no_uprn_match_to_rm
  
   as (
    with rm_no_match_to_epc  as ( -- rightmove uspn does not match epc

    select 
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL

     from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'NO'
    
),

epc_remove as (

    select EPC_UPRN,EPC_ADDRESSID from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'YES'  -- 
),

epc_matched as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs src
    left join epc_remove rem on src.UPRN = rem.EPC_UPRN
    
),

epc_fm_prep as (

    select * from epc_matched
    where EPC_UPRN is NULL

    
)


SELECT * FROM epc_fm_prep
WHERE UPRN NOT NULL
  );
[0m13:05:24.090628 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m13:05:25.379169 [debug] [Thread-2 (]: Snowflake adapter: Snowflake query id: 01b33f11-0103-9a1f-0000-71950635715a
[0m13:05:25.379660 [debug] [Thread-2 (]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 46 at position 11 unexpected 'NOT'.
[0m13:05:25.380196 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.no_uprn_match_to_rm (execute): 13:05:24.085396 => 13:05:25.380006
[0m13:05:25.380550 [debug] [Thread-2 (]: On model.rightmove_epc.no_uprn_match_to_rm: Close
[0m13:05:25.482293 [debug] [Thread-2 (]: Database Error in model no_uprn_match_to_rm (models/matching/no_uprn_match_to_rm.sql)
  001003 (42000): SQL compilation error:
  syntax error line 46 at position 11 unexpected 'NOT'.
  compiled Code at target/run/rightmove_epc/models/matching/no_uprn_match_to_rm.sql
[0m13:05:25.482889 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '49a316e9-7346-4062-aebd-6b7dbc54e8e7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107d5ac90>]}
[0m13:05:25.483457 [error] [Thread-2 (]: 6 of 6 ERROR creating sql view model dbt_melissa_rm_epc.no_uprn_match_to_rm .... [[31mERROR[0m in 1.40s]
[0m13:05:25.484011 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.no_uprn_match_to_rm
[0m13:05:25.485540 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:05:25.485818 [debug] [MainThread]: Connection 'model.rightmove_epc.uprn_match' was properly closed.
[0m13:05:25.486047 [debug] [MainThread]: Connection 'model.rightmove_epc.no_uprn_match_to_rm' was properly closed.
[0m13:05:25.486262 [debug] [MainThread]: Connection 'model.rightmove_epc.dim_addressid' was properly closed.
[0m13:05:25.486473 [debug] [MainThread]: Connection 'model.rightmove_epc.dim_uprn' was properly closed.
[0m13:05:25.486778 [info ] [MainThread]: 
[0m13:05:25.487039 [info ] [MainThread]: Finished running 6 view models in 0 hours 0 minutes and 4.34 seconds (4.34s).
[0m13:05:25.487919 [debug] [MainThread]: Command end result
[0m13:05:25.495084 [info ] [MainThread]: 
[0m13:05:25.495436 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m13:05:25.495688 [info ] [MainThread]: 
[0m13:05:25.495931 [error] [MainThread]:   Database Error in model no_uprn_match_to_rm (models/matching/no_uprn_match_to_rm.sql)
  001003 (42000): SQL compilation error:
  syntax error line 46 at position 11 unexpected 'NOT'.
  compiled Code at target/run/rightmove_epc/models/matching/no_uprn_match_to_rm.sql
[0m13:05:25.496178 [info ] [MainThread]: 
[0m13:05:25.496457 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=0 TOTAL=6
[0m13:05:25.498291 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 4.6680393, "process_user_time": 1.531314, "process_kernel_time": 0.182854, "process_mem_max_rss": "137592832", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m13:05:25.498693 [debug] [MainThread]: Command `dbt run` failed at 13:05:25.498610 after 4.67 seconds
[0m13:05:25.498972 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106d99fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1014e2110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10161dcd0>]}
[0m13:05:25.499233 [debug] [MainThread]: Flushing usage events
[0m14:08:19.860561 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107818cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10785eb90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107852e90>]}


============================== 14:08:19.863512 | bc2ac9a6-bc66-4ee1-ac33-76936b9825f2 ==============================
[0m14:08:19.863512 [info ] [MainThread]: Running with dbt=1.7.10
[0m14:08:19.863862 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m14:08:20.054896 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'bc2ac9a6-bc66-4ee1-ac33-76936b9825f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106a0fb90>]}
[0m14:08:20.094757 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'bc2ac9a6-bc66-4ee1-ac33-76936b9825f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1078f3010>]}
[0m14:08:20.095437 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m14:08:20.104994 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m14:08:20.124122 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:08:20.124452 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:08:20.128359 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'bc2ac9a6-bc66-4ee1-ac33-76936b9825f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1103fba10>]}
[0m14:08:20.135515 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'bc2ac9a6-bc66-4ee1-ac33-76936b9825f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110374f10>]}
[0m14:08:20.135828 [info ] [MainThread]: Found 8 models, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m14:08:20.136048 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bc2ac9a6-bc66-4ee1-ac33-76936b9825f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107896bd0>]}
[0m14:08:20.137120 [info ] [MainThread]: 
[0m14:08:20.137572 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m14:08:20.138425 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m14:08:20.146223 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m14:08:20.146562 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m14:08:20.146848 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:08:20.990526 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 1.0 seconds
[0m14:08:20.992875 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m14:08:21.093179 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m14:08:21.100581 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m14:08:21.100912 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m14:08:21.101181 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:08:21.613860 [debug] [ThreadPool]: SQL status: SUCCESS 6 in 1.0 seconds
[0m14:08:21.615872 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m14:08:21.721617 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bc2ac9a6-bc66-4ee1-ac33-76936b9825f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107810310>]}
[0m14:08:21.722793 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:08:21.723175 [info ] [MainThread]: 
[0m14:08:21.726738 [debug] [Thread-1 (]: Began running node model.rightmove_epc.stg_epc_certs
[0m14:08:21.727193 [debug] [Thread-2 (]: Began running node model.rightmove_epc.stg_rightmove
[0m14:08:21.727742 [info ] [Thread-1 (]: 1 of 8 START sql view model dbt_melissa_rm_epc.stg_epc_certs ................... [RUN]
[0m14:08:21.728192 [info ] [Thread-2 (]: 2 of 8 START sql view model dbt_melissa_rm_epc.stg_rightmove ................... [RUN]
[0m14:08:21.728892 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.stg_epc_certs)
[0m14:08:21.729565 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.stg_rightmove'
[0m14:08:21.729900 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.stg_epc_certs
[0m14:08:21.730191 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.stg_rightmove
[0m14:08:21.737061 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.stg_epc_certs"
[0m14:08:21.739341 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.stg_rightmove"
[0m14:08:21.740479 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (compile): 14:08:21.737295 => 14:08:21.740269
[0m14:08:21.740851 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (compile): 14:08:21.730377 => 14:08:21.740629
[0m14:08:21.741193 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.stg_rightmove
[0m14:08:21.741481 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.stg_epc_certs
[0m14:08:21.759191 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.stg_rightmove"
[0m14:08:21.762104 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.stg_epc_certs"
[0m14:08:21.763075 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.stg_rightmove"
[0m14:08:21.763716 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.stg_epc_certs"
[0m14:08:21.763977 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_rightmove"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
  
   as (
    with rm as (

    SELECT 
    LISTING_ID,
    UPPER(TRIM(replace(REPLACE(CONCAT(ADDRESS_1::VARCHAR,ADDRESS_2::VARCHAR),' '),','))) AS ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL 
    FROM 
       ANALYTICS.RIGHTMOVE_PROD.CLEAN_RAW_RIGHTMOVE_DATA 

 
)

SELECT * FROM rm
  );
[0m14:08:21.764247 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_epc_certs"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
  
   as (
    WITH epc_certs as (
    
    select 
    UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    COUNTY,
    LOCAL_AUTHORITY as LOCAL_AUTHORITY_CODE,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    UPPER(CASE WHEN (UPPER(ADDRESS1) LIKE 'FLAT%' OR UPPER(ADDRESS1) LIKE 'UNIT%') or UPPER(ADDRESS1) LIKE 'ROOM%' 
    THEN TRIM(REPLACE(REPLACE(CONCAT(ADDRESS1,ADDRESS2,ADDRESS3),','),' '))
    ELSE trim(replace(replace(ADDRESS1,' '),',')) END) AS ADDRESSID
 from  RAW.EPC_TEST_DATA.EPC_CERTIFICATES 

)

SELECT * FROM epc_certs
  );
[0m14:08:21.764491 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m14:08:21.764681 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:08:22.284937 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:08:22.302890 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (execute): 14:08:21.741638 => 14:08:22.302720
[0m14:08:22.303212 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: Close
[0m14:08:22.337410 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:08:22.339748 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (execute): 14:08:21.759453 => 14:08:22.339572
[0m14:08:22.340502 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: Close
[0m14:08:22.430117 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bc2ac9a6-bc66-4ee1-ac33-76936b9825f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110138cd0>]}
[0m14:08:22.430987 [info ] [Thread-2 (]: 2 of 8 OK created sql view model dbt_melissa_rm_epc.stg_rightmove .............. [[32mSUCCESS 1[0m in 0.70s]
[0m14:08:22.431650 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.stg_rightmove
[0m14:08:22.444570 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bc2ac9a6-bc66-4ee1-ac33-76936b9825f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1101eba50>]}
[0m14:08:22.445417 [info ] [Thread-1 (]: 1 of 8 OK created sql view model dbt_melissa_rm_epc.stg_epc_certs .............. [[32mSUCCESS 1[0m in 0.72s]
[0m14:08:22.446123 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.stg_epc_certs
[0m14:08:22.447039 [debug] [Thread-4 (]: Began running node model.rightmove_epc.dim_addressid
[0m14:08:22.447419 [debug] [Thread-3 (]: Began running node model.rightmove_epc.dim_uprn
[0m14:08:22.447783 [debug] [Thread-2 (]: Began running node model.rightmove_epc.uprn_match
[0m14:08:22.448193 [info ] [Thread-4 (]: 3 of 8 START sql view model dbt_melissa_rm_epc.dim_addressid ................... [RUN]
[0m14:08:22.448624 [info ] [Thread-3 (]: 4 of 8 START sql view model dbt_melissa_rm_epc.dim_uprn ........................ [RUN]
[0m14:08:22.449130 [info ] [Thread-2 (]: 5 of 8 START sql view model dbt_melissa_rm_epc.uprn_match ...................... [RUN]
[0m14:08:22.449906 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_addressid'
[0m14:08:22.450537 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_uprn'
[0m14:08:22.451080 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_rightmove, now model.rightmove_epc.uprn_match)
[0m14:08:22.451414 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.dim_addressid
[0m14:08:22.451715 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.dim_uprn
[0m14:08:22.452062 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.uprn_match
[0m14:08:22.455160 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.dim_addressid"
[0m14:08:22.457395 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.dim_uprn"
[0m14:08:22.459755 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.uprn_match"
[0m14:08:22.460612 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_addressid (compile): 14:08:22.452278 => 14:08:22.460463
[0m14:08:22.460891 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.dim_uprn (compile): 14:08:22.455448 => 14:08:22.460753
[0m14:08:22.461124 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.uprn_match (compile): 14:08:22.457623 => 14:08:22.461015
[0m14:08:22.461336 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.dim_addressid
[0m14:08:22.461567 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.dim_uprn
[0m14:08:22.461770 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.uprn_match
[0m14:08:22.464005 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.dim_addressid"
[0m14:08:22.465821 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.dim_uprn"
[0m14:08:22.467722 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.uprn_match"
[0m14:08:22.468614 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.dim_uprn"
[0m14:08:22.468870 [debug] [Thread-3 (]: On model.rightmove_epc.dim_uprn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_uprn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
  
   as (
    with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where uprn is not null
  );
[0m14:08:22.469106 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m14:08:22.470013 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.dim_addressid"
[0m14:08:22.470278 [debug] [Thread-4 (]: On model.rightmove_epc.dim_addressid: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_addressid"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
  
   as (
    with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where uprn is null
and addressid is not null
  );
[0m14:08:22.470514 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m14:08:22.471632 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.uprn_match"
[0m14:08:22.472189 [debug] [Thread-2 (]: On model.rightmove_epc.uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
  
   as (
    with epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    where uprn is not null

),

rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where uprn is not null
),

final as (

    select 
    LISTING_ID,
    rm.ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    rm.UPRN,
    rm.LOCAL_AUTHORITY_CODE,
    rm.LOCAL_AUTHORITY,
    rm.GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    epc.UPRN AS EPC_UPRN,
    epc.TOTAL_FLOOR_AREA,
    epc.ADDRESSID as EPC_ADDRESSID,
    CASE WHEN epc.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC    
    
     from rm left join epc on rm.uprn = epc.uprn
)

select * from final
  );
[0m14:08:22.472421 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m14:08:23.213205 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:08:23.213910 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:08:23.216860 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.uprn_match (execute): 14:08:22.466006 => 14:08:23.216643
[0m14:08:23.217476 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:08:23.220210 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_addressid (execute): 14:08:22.461897 => 14:08:23.220048
[0m14:08:23.220546 [debug] [Thread-2 (]: On model.rightmove_epc.uprn_match: Close
[0m14:08:23.222464 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.dim_uprn (execute): 14:08:22.464162 => 14:08:23.222311
[0m14:08:23.222779 [debug] [Thread-4 (]: On model.rightmove_epc.dim_addressid: Close
[0m14:08:23.223819 [debug] [Thread-3 (]: On model.rightmove_epc.dim_uprn: Close
[0m14:08:23.306889 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bc2ac9a6-bc66-4ee1-ac33-76936b9825f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11068fa10>]}
[0m14:08:23.307479 [info ] [Thread-3 (]: 4 of 8 OK created sql view model dbt_melissa_rm_epc.dim_uprn ................... [[32mSUCCESS 1[0m in 0.86s]
[0m14:08:23.307944 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.dim_uprn
[0m14:08:23.316298 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bc2ac9a6-bc66-4ee1-ac33-76936b9825f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11039fa90>]}
[0m14:08:23.317143 [info ] [Thread-4 (]: 3 of 8 OK created sql view model dbt_melissa_rm_epc.dim_addressid .............. [[32mSUCCESS 1[0m in 0.87s]
[0m14:08:23.317709 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.dim_addressid
[0m14:08:23.318434 [debug] [Thread-1 (]: Began running node model.rightmove_epc.address_match
[0m14:08:23.318818 [debug] [Thread-3 (]: Began running node model.rightmove_epc.address_simularity
[0m14:08:23.319256 [info ] [Thread-1 (]: 6 of 8 START sql view model dbt_melissa_rm_epc.address_match ................... [RUN]
[0m14:08:23.320018 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bc2ac9a6-bc66-4ee1-ac33-76936b9825f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110389950>]}
[0m14:08:23.320465 [info ] [Thread-3 (]: 7 of 8 START sql view model dbt_melissa_rm_epc.address_simularity .............. [RUN]
[0m14:08:23.321009 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_epc_certs, now model.rightmove_epc.address_match)
[0m14:08:23.321435 [info ] [Thread-2 (]: 5 of 8 OK created sql view model dbt_melissa_rm_epc.uprn_match ................. [[32mSUCCESS 1[0m in 0.87s]
[0m14:08:23.321909 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.dim_uprn, now model.rightmove_epc.address_simularity)
[0m14:08:23.322187 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.address_match
[0m14:08:23.322549 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.uprn_match
[0m14:08:23.322796 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.address_simularity
[0m14:08:23.325236 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.address_match"
[0m14:08:23.325845 [debug] [Thread-4 (]: Began running node model.rightmove_epc.no_uprn_match
[0m14:08:23.328527 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.address_simularity"
[0m14:08:23.328981 [info ] [Thread-4 (]: 8 of 8 START sql view model dbt_melissa_rm_epc.no_uprn_match ................... [RUN]
[0m14:08:23.329710 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.dim_addressid, now model.rightmove_epc.no_uprn_match)
[0m14:08:23.329993 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.no_uprn_match
[0m14:08:23.330332 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.address_match (compile): 14:08:23.322954 => 14:08:23.330151
[0m14:08:23.333960 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.no_uprn_match"
[0m14:08:23.334456 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.address_match
[0m14:08:23.334763 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.address_simularity (compile): 14:08:23.326060 => 14:08:23.334623
[0m14:08:23.337084 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.address_match"
[0m14:08:23.337431 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.address_simularity
[0m14:08:23.337744 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.no_uprn_match (compile): 14:08:23.330488 => 14:08:23.337620
[0m14:08:23.339760 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.address_simularity"
[0m14:08:23.340033 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.no_uprn_match
[0m14:08:23.340654 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.address_match"
[0m14:08:23.342659 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.no_uprn_match"
[0m14:08:23.343019 [debug] [Thread-1 (]: On model.rightmove_epc.address_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.address_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NULL
),

epc_address as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
    where datasource = 'EPC'
)


SELECT DISTINCT LISTING_ID, rm.*,
epc_address.addressid
as EPC_ADDRESSID,
CASE WHEN epc_address.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC    

FROM rm
LEFT JOIN epc_address
ON rm.addressid = epc_address.addressid
  );
[0m14:08:23.343677 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.address_simularity"
[0m14:08:23.343926 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:08:23.344497 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.no_uprn_match"
[0m14:08:23.344750 [debug] [Thread-3 (]: On model.rightmove_epc.address_simularity: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.address_simularity"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.address_simularity
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NULL
),

epc_address as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
    where datasource = 'EPC'
)


SELECT rm.*,epc_address.addressid as EPC_ADDRESSID
FROM rm
JOIN epc_address
ON JAROWINKLER_SIMILARITY(rm.addressid, epc_address.addressid) = 1
  );
[0m14:08:23.345562 [debug] [Thread-4 (]: On model.rightmove_epc.no_uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.no_uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.no_uprn_match
  
   as (
    with rm_no_match_to_epc  as ( -- rightmove uspn does not match epc

    select 
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL

     from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'NO'
    
)

select * from rm_no_match_to_epc

/*
epc_remove as (

    select EPC_UPRN,EPC_ADDRESSID from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'YES'  -- 
),

epc_matched as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs src
    left join epc_remove rem on src.UPRN = rem.EPC_UPRN
    
),

epc_fm_prep as (

    select * from epc_matched
    where EPC_UPRN is NULL

    
)


SELECT * FROM epc_fm_prep
WHERE UPRN NOT NULL */
  );
[0m14:08:23.346031 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m14:08:23.346272 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m14:08:23.851551 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b33f50-0103-9a62-0000-719506353cd6
[0m14:08:23.851864 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 002025 (42S21): SQL compilation error:
duplicate column name 'LISTING_ID'
[0m14:08:23.852193 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.address_match (execute): 14:08:23.334988 => 14:08:23.852069
[0m14:08:23.852422 [debug] [Thread-1 (]: On model.rightmove_epc.address_match: Close
[0m14:08:23.940534 [debug] [Thread-1 (]: Database Error in model address_match (models/matching/address_match.sql)
  002025 (42S21): SQL compilation error:
  duplicate column name 'LISTING_ID'
  compiled Code at target/run/rightmove_epc/models/matching/address_match.sql
[0m14:08:23.940979 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bc2ac9a6-bc66-4ee1-ac33-76936b9825f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1105f4610>]}
[0m14:08:23.941391 [error] [Thread-1 (]: 6 of 8 ERROR creating sql view model dbt_melissa_rm_epc.address_match .......... [[31mERROR[0m in 0.62s]
[0m14:08:23.941791 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.address_match
[0m14:08:23.983751 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:08:23.985806 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.address_simularity (execute): 14:08:23.337893 => 14:08:23.985644
[0m14:08:23.986103 [debug] [Thread-3 (]: On model.rightmove_epc.address_simularity: Close
[0m14:08:24.049141 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:08:24.050999 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.no_uprn_match (execute): 14:08:23.340823 => 14:08:24.050847
[0m14:08:24.051278 [debug] [Thread-4 (]: On model.rightmove_epc.no_uprn_match: Close
[0m14:08:24.065360 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bc2ac9a6-bc66-4ee1-ac33-76936b9825f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1078945d0>]}
[0m14:08:24.065879 [info ] [Thread-3 (]: 7 of 8 OK created sql view model dbt_melissa_rm_epc.address_simularity ......... [[32mSUCCESS 1[0m in 0.74s]
[0m14:08:24.066340 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.address_simularity
[0m14:08:24.137937 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bc2ac9a6-bc66-4ee1-ac33-76936b9825f2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111b0cf50>]}
[0m14:08:24.138506 [info ] [Thread-4 (]: 8 of 8 OK created sql view model dbt_melissa_rm_epc.no_uprn_match .............. [[32mSUCCESS 1[0m in 0.81s]
[0m14:08:24.138921 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.no_uprn_match
[0m14:08:24.140240 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:08:24.140511 [debug] [MainThread]: Connection 'model.rightmove_epc.address_match' was properly closed.
[0m14:08:24.140722 [debug] [MainThread]: Connection 'model.rightmove_epc.uprn_match' was properly closed.
[0m14:08:24.140911 [debug] [MainThread]: Connection 'model.rightmove_epc.no_uprn_match' was properly closed.
[0m14:08:24.141098 [debug] [MainThread]: Connection 'model.rightmove_epc.address_simularity' was properly closed.
[0m14:08:24.141357 [info ] [MainThread]: 
[0m14:08:24.141590 [info ] [MainThread]: Finished running 8 view models in 0 hours 0 minutes and 4.00 seconds (4.00s).
[0m14:08:24.142518 [debug] [MainThread]: Command end result
[0m14:08:24.149418 [info ] [MainThread]: 
[0m14:08:24.149928 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m14:08:24.150192 [info ] [MainThread]: 
[0m14:08:24.150424 [error] [MainThread]:   Database Error in model address_match (models/matching/address_match.sql)
  002025 (42S21): SQL compilation error:
  duplicate column name 'LISTING_ID'
  compiled Code at target/run/rightmove_epc/models/matching/address_match.sql
[0m14:08:24.150651 [info ] [MainThread]: 
[0m14:08:24.150862 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=1 SKIP=0 TOTAL=8
[0m14:08:24.152925 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 4.3265634, "process_user_time": 1.590083, "process_kernel_time": 0.20257, "process_mem_max_rss": "136986624", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:08:24.153330 [debug] [MainThread]: Command `dbt run` failed at 14:08:24.153248 after 4.33 seconds
[0m14:08:24.153596 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10787b4d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100a26110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110453050>]}
[0m14:08:24.153841 [debug] [MainThread]: Flushing usage events
[0m14:19:48.921450 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1126d3310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112d5e350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112d5efd0>]}


============================== 14:19:48.925016 | 60847bfc-3cf0-406a-ab84-e5353958cdb4 ==============================
[0m14:19:48.925016 [info ] [MainThread]: Running with dbt=1.7.10
[0m14:19:48.925404 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/Users/melissabee/.dbt', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m14:19:49.116092 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '60847bfc-3cf0-406a-ab84-e5353958cdb4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1137ea910>]}
[0m14:19:49.156674 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '60847bfc-3cf0-406a-ab84-e5353958cdb4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112d105d0>]}
[0m14:19:49.157361 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m14:19:49.167236 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m14:19:49.193887 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:19:49.194190 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:19:49.197964 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '60847bfc-3cf0-406a-ab84-e5353958cdb4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113b288d0>]}
[0m14:19:49.204735 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '60847bfc-3cf0-406a-ab84-e5353958cdb4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113875b50>]}
[0m14:19:49.205019 [info ] [MainThread]: Found 8 models, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m14:19:49.205236 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '60847bfc-3cf0-406a-ab84-e5353958cdb4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107217890>]}
[0m14:19:49.206345 [info ] [MainThread]: 
[0m14:19:49.206791 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m14:19:49.207563 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m14:19:49.214968 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m14:19:49.215237 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m14:19:49.215414 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:19:49.686142 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 0.0 seconds
[0m14:19:49.688712 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m14:19:49.784544 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m14:19:49.792274 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m14:19:49.792602 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m14:19:49.792866 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:19:50.261554 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.0 seconds
[0m14:19:50.263454 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m14:19:50.339751 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '60847bfc-3cf0-406a-ab84-e5353958cdb4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1137a7c50>]}
[0m14:19:50.340374 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:19:50.340612 [info ] [MainThread]: 
[0m14:19:50.343429 [debug] [Thread-1 (]: Began running node model.rightmove_epc.stg_epc_certs
[0m14:19:50.343676 [debug] [Thread-2 (]: Began running node model.rightmove_epc.stg_rightmove
[0m14:19:50.343963 [info ] [Thread-1 (]: 1 of 8 START sql view model dbt_melissa_rm_epc.stg_epc_certs ................... [RUN]
[0m14:19:50.344252 [info ] [Thread-2 (]: 2 of 8 START sql view model dbt_melissa_rm_epc.stg_rightmove ................... [RUN]
[0m14:19:50.344686 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.stg_epc_certs)
[0m14:19:50.345095 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.stg_rightmove'
[0m14:19:50.345305 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.stg_epc_certs
[0m14:19:50.345501 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.stg_rightmove
[0m14:19:50.350259 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.stg_epc_certs"
[0m14:19:50.352156 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.stg_rightmove"
[0m14:19:50.352804 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (compile): 14:19:50.345628 => 14:19:50.352655
[0m14:19:50.353063 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (compile): 14:19:50.350486 => 14:19:50.352930
[0m14:19:50.353281 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.stg_epc_certs
[0m14:19:50.353535 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.stg_rightmove
[0m14:19:50.369288 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.stg_epc_certs"
[0m14:19:50.372193 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.stg_rightmove"
[0m14:19:50.373284 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.stg_epc_certs"
[0m14:19:50.373793 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.stg_rightmove"
[0m14:19:50.374145 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_epc_certs"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
  
   as (
    WITH epc_certs as (
    
    select 
    UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    COUNTY,
    LOCAL_AUTHORITY as LOCAL_AUTHORITY_CODE,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    UPPER(CASE WHEN (UPPER(ADDRESS1) LIKE 'FLAT%' OR UPPER(ADDRESS1) LIKE 'UNIT%') or UPPER(ADDRESS1) LIKE 'ROOM%' 
    THEN TRIM(REPLACE(REPLACE(CONCAT(ADDRESS1,ADDRESS2,ADDRESS3),','),' '))
    ELSE trim(replace(replace(ADDRESS1,' '),',')) END) AS ADDRESSID
 from  RAW.EPC_TEST_DATA.EPC_CERTIFICATES 

)

SELECT * FROM epc_certs
  );
[0m14:19:50.374478 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_rightmove"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
  
   as (
    with rm as (

    SELECT 
    LISTING_ID,
    UPPER(TRIM(replace(REPLACE(CONCAT(ADDRESS_1::VARCHAR,ADDRESS_2::VARCHAR),' '),','))) AS ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL 
    FROM 
       ANALYTICS.RIGHTMOVE_PROD.CLEAN_RAW_RIGHTMOVE_DATA 

 
)

SELECT * FROM rm
  );
[0m14:19:50.374791 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:19:50.375025 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m14:19:50.907928 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:19:50.924414 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (execute): 14:19:50.353700 => 14:19:50.924250
[0m14:19:50.924734 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: Close
[0m14:19:51.006982 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '60847bfc-3cf0-406a-ab84-e5353958cdb4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113693e50>]}
[0m14:19:51.007547 [info ] [Thread-1 (]: 1 of 8 OK created sql view model dbt_melissa_rm_epc.stg_epc_certs .............. [[32mSUCCESS 1[0m in 0.66s]
[0m14:19:51.007980 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.stg_epc_certs
[0m14:19:51.016671 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:19:51.018779 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (execute): 14:19:50.369564 => 14:19:51.018629
[0m14:19:51.019104 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: Close
[0m14:19:51.109970 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '60847bfc-3cf0-406a-ab84-e5353958cdb4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1137b3090>]}
[0m14:19:51.110549 [info ] [Thread-2 (]: 2 of 8 OK created sql view model dbt_melissa_rm_epc.stg_rightmove .............. [[32mSUCCESS 1[0m in 0.76s]
[0m14:19:51.110972 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.stg_rightmove
[0m14:19:51.111571 [debug] [Thread-4 (]: Began running node model.rightmove_epc.dim_addressid
[0m14:19:51.111921 [debug] [Thread-3 (]: Began running node model.rightmove_epc.dim_uprn
[0m14:19:51.112218 [info ] [Thread-4 (]: 3 of 8 START sql view model dbt_melissa_rm_epc.dim_addressid ................... [RUN]
[0m14:19:51.112558 [debug] [Thread-1 (]: Began running node model.rightmove_epc.uprn_match
[0m14:19:51.112880 [info ] [Thread-3 (]: 4 of 8 START sql view model dbt_melissa_rm_epc.dim_uprn ........................ [RUN]
[0m14:19:51.113460 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_addressid'
[0m14:19:51.113771 [info ] [Thread-1 (]: 5 of 8 START sql view model dbt_melissa_rm_epc.uprn_match ...................... [RUN]
[0m14:19:51.114296 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_uprn'
[0m14:19:51.114567 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.dim_addressid
[0m14:19:51.114999 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_epc_certs, now model.rightmove_epc.uprn_match)
[0m14:19:51.115256 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.dim_uprn
[0m14:19:51.117644 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.dim_addressid"
[0m14:19:51.117949 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.uprn_match
[0m14:19:51.119956 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.dim_uprn"
[0m14:19:51.122320 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.uprn_match"
[0m14:19:51.123026 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_addressid (compile): 14:19:51.115416 => 14:19:51.122868
[0m14:19:51.123408 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.dim_addressid
[0m14:19:51.126042 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.dim_addressid"
[0m14:19:51.126456 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.dim_uprn (compile): 14:19:51.118109 => 14:19:51.126226
[0m14:19:51.126859 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.dim_uprn
[0m14:19:51.127100 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.uprn_match (compile): 14:19:51.120332 => 14:19:51.126988
[0m14:19:51.129245 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.dim_uprn"
[0m14:19:51.129922 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.dim_addressid"
[0m14:19:51.130165 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.uprn_match
[0m14:19:51.130471 [debug] [Thread-4 (]: On model.rightmove_epc.dim_addressid: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_addressid"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
  
   as (
    with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource,
    POSTCODE

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where uprn is null
and addressid is not null
  );
[0m14:19:51.132397 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.uprn_match"
[0m14:19:51.132619 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m14:19:51.133174 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.dim_uprn"
[0m14:19:51.133995 [debug] [Thread-3 (]: On model.rightmove_epc.dim_uprn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_uprn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
  
   as (
    with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource,
    POSTCODE

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where uprn is not null
  );
[0m14:19:51.134586 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m14:19:51.135341 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.uprn_match"
[0m14:19:51.136384 [debug] [Thread-1 (]: On model.rightmove_epc.uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
  
   as (
    with epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    where uprn is not null

),

rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where uprn is not null
),

final as (

    select 
    LISTING_ID,
    rm.ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    rm.UPRN,
    rm.LOCAL_AUTHORITY_CODE,
    rm.LOCAL_AUTHORITY,
    rm.GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    epc.UPRN AS EPC_UPRN,
    epc.TOTAL_FLOOR_AREA,
    epc.ADDRESSID as EPC_ADDRESSID,
    CASE WHEN epc.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC    
    
     from rm left join epc on rm.uprn = epc.uprn
)

select * from final
  );
[0m14:19:51.136685 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:19:51.731592 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:19:51.734851 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_addressid (execute): 14:19:51.123692 => 14:19:51.734655
[0m14:19:51.735264 [debug] [Thread-4 (]: On model.rightmove_epc.dim_addressid: Close
[0m14:19:51.795650 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:19:51.796335 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:19:51.798576 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.dim_uprn (execute): 14:19:51.127266 => 14:19:51.798409
[0m14:19:51.800554 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.uprn_match (execute): 14:19:51.130648 => 14:19:51.800400
[0m14:19:51.800874 [debug] [Thread-3 (]: On model.rightmove_epc.dim_uprn: Close
[0m14:19:51.801168 [debug] [Thread-1 (]: On model.rightmove_epc.uprn_match: Close
[0m14:19:51.825406 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '60847bfc-3cf0-406a-ab84-e5353958cdb4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113c601d0>]}
[0m14:19:51.825991 [info ] [Thread-4 (]: 3 of 8 OK created sql view model dbt_melissa_rm_epc.dim_addressid .............. [[32mSUCCESS 1[0m in 0.71s]
[0m14:19:51.826480 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.dim_addressid
[0m14:19:51.827011 [debug] [Thread-2 (]: Began running node model.rightmove_epc.address_match
[0m14:19:51.827357 [debug] [Thread-4 (]: Began running node model.rightmove_epc.address_simularity
[0m14:19:51.827681 [info ] [Thread-2 (]: 6 of 8 START sql view model dbt_melissa_rm_epc.address_match ................... [RUN]
[0m14:19:51.828046 [info ] [Thread-4 (]: 7 of 8 START sql view model dbt_melissa_rm_epc.address_simularity .............. [RUN]
[0m14:19:51.828588 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_rightmove, now model.rightmove_epc.address_match)
[0m14:19:51.829075 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.dim_addressid, now model.rightmove_epc.address_simularity)
[0m14:19:51.829363 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.address_match
[0m14:19:51.829638 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.address_simularity
[0m14:19:51.832554 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.address_match"
[0m14:19:51.836214 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.address_simularity"
[0m14:19:51.838055 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.address_match (compile): 14:19:51.829923 => 14:19:51.837814
[0m14:19:51.838458 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.address_simularity (compile): 14:19:51.832876 => 14:19:51.838222
[0m14:19:51.838906 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.address_match
[0m14:19:51.839498 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.address_simularity
[0m14:19:51.841944 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.address_match"
[0m14:19:51.845258 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.address_simularity"
[0m14:19:51.846378 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.address_match"
[0m14:19:51.846974 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.address_simularity"
[0m14:19:51.847352 [debug] [Thread-2 (]: On model.rightmove_epc.address_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.address_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NULL
),

epc_address as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
    where datasource = 'EPC'
)


SELECT DISTINCT LISTING_ID, rm.*,
epc_address.addressid
as EPC_ADDRESSID,
CASE WHEN epc_address.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC    

FROM rm
LEFT JOIN epc_address
ON rm.addressid = epc_address.addressid
  );
[0m14:19:51.847775 [debug] [Thread-4 (]: On model.rightmove_epc.address_simularity: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.address_simularity"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.address_simularity
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NULL
),

epc_address as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
    where datasource = 'EPC'
)


SELECT rm.*,epc_address.addressid as EPC_ADDRESSID
FROM rm
JOIN epc_address
ON JAROWINKLER_SIMILARITY(rm.addressid, epc_address.addressid) = 1
  );
[0m14:19:51.848194 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m14:19:51.848443 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m14:19:51.884579 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '60847bfc-3cf0-406a-ab84-e5353958cdb4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113de1f90>]}
[0m14:19:51.885038 [info ] [Thread-3 (]: 4 of 8 OK created sql view model dbt_melissa_rm_epc.dim_uprn ................... [[32mSUCCESS 1[0m in 0.77s]
[0m14:19:51.885390 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.dim_uprn
[0m14:19:51.898953 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '60847bfc-3cf0-406a-ab84-e5353958cdb4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1136fc9d0>]}
[0m14:19:51.899406 [info ] [Thread-1 (]: 5 of 8 OK created sql view model dbt_melissa_rm_epc.uprn_match ................. [[32mSUCCESS 1[0m in 0.78s]
[0m14:19:51.899720 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.uprn_match
[0m14:19:51.900158 [debug] [Thread-3 (]: Began running node model.rightmove_epc.no_uprn_match
[0m14:19:51.900604 [info ] [Thread-3 (]: 8 of 8 START sql view model dbt_melissa_rm_epc.no_uprn_match ................... [RUN]
[0m14:19:51.901080 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.dim_uprn, now model.rightmove_epc.no_uprn_match)
[0m14:19:51.901297 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.no_uprn_match
[0m14:19:51.903632 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.no_uprn_match"
[0m14:19:51.904242 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.no_uprn_match (compile): 14:19:51.901426 => 14:19:51.904116
[0m14:19:51.904448 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.no_uprn_match
[0m14:19:51.906311 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.no_uprn_match"
[0m14:19:51.907051 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.no_uprn_match"
[0m14:19:51.907286 [debug] [Thread-3 (]: On model.rightmove_epc.no_uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.no_uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.no_uprn_match
  
   as (
    with rm_no_match_to_epc  as ( -- rightmove uspn does not match epc

    select 
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL

     from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'NO'
    
)

select * from rm_no_match_to_epc

/*
epc_remove as (

    select EPC_UPRN,EPC_ADDRESSID from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'YES'  -- 
),

epc_matched as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs src
    left join epc_remove rem on src.UPRN = rem.EPC_UPRN
    
),

epc_fm_prep as (

    select * from epc_matched
    where EPC_UPRN is NULL

    
)


SELECT * FROM epc_fm_prep
WHERE UPRN NOT NULL */
  );
[0m14:19:51.907512 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m14:19:52.295842 [debug] [Thread-2 (]: Snowflake adapter: Snowflake query id: 01b33f5b-0103-99eb-0000-719506352dd2
[0m14:19:52.296298 [debug] [Thread-2 (]: Snowflake adapter: Snowflake error: 002025 (42S21): SQL compilation error:
duplicate column name 'LISTING_ID'
[0m14:19:52.296816 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.address_match (execute): 14:19:51.839787 => 14:19:52.296620
[0m14:19:52.297139 [debug] [Thread-2 (]: On model.rightmove_epc.address_match: Close
[0m14:19:52.411284 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:19:52.413951 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.address_simularity (execute): 14:19:51.842935 => 14:19:52.413754
[0m14:19:52.415600 [debug] [Thread-4 (]: On model.rightmove_epc.address_simularity: Close
[0m14:19:52.419285 [debug] [Thread-2 (]: Database Error in model address_match (models/matching/address_match.sql)
  002025 (42S21): SQL compilation error:
  duplicate column name 'LISTING_ID'
  compiled Code at target/run/rightmove_epc/models/matching/address_match.sql
[0m14:19:52.419848 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '60847bfc-3cf0-406a-ab84-e5353958cdb4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113baa850>]}
[0m14:19:52.420505 [error] [Thread-2 (]: 6 of 8 ERROR creating sql view model dbt_melissa_rm_epc.address_match .......... [[31mERROR[0m in 0.59s]
[0m14:19:52.421209 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.address_match
[0m14:19:52.423764 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:19:52.425898 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.no_uprn_match (execute): 14:19:51.904573 => 14:19:52.425730
[0m14:19:52.426210 [debug] [Thread-3 (]: On model.rightmove_epc.no_uprn_match: Close
[0m14:19:52.498570 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '60847bfc-3cf0-406a-ab84-e5353958cdb4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113b7bd10>]}
[0m14:19:52.499100 [info ] [Thread-4 (]: 7 of 8 OK created sql view model dbt_melissa_rm_epc.address_simularity ......... [[32mSUCCESS 1[0m in 0.67s]
[0m14:19:52.499514 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.address_simularity
[0m14:19:52.515965 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '60847bfc-3cf0-406a-ab84-e5353958cdb4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113c73f90>]}
[0m14:19:52.516553 [info ] [Thread-3 (]: 8 of 8 OK created sql view model dbt_melissa_rm_epc.no_uprn_match .............. [[32mSUCCESS 1[0m in 0.62s]
[0m14:19:52.516994 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.no_uprn_match
[0m14:19:52.518421 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:19:52.518742 [debug] [MainThread]: Connection 'model.rightmove_epc.uprn_match' was properly closed.
[0m14:19:52.518977 [debug] [MainThread]: Connection 'model.rightmove_epc.address_match' was properly closed.
[0m14:19:52.519180 [debug] [MainThread]: Connection 'model.rightmove_epc.address_simularity' was properly closed.
[0m14:19:52.519367 [debug] [MainThread]: Connection 'model.rightmove_epc.no_uprn_match' was properly closed.
[0m14:19:52.519624 [info ] [MainThread]: 
[0m14:19:52.519849 [info ] [MainThread]: Finished running 8 view models in 0 hours 0 minutes and 3.31 seconds (3.31s).
[0m14:19:52.520675 [debug] [MainThread]: Command end result
[0m14:19:52.527359 [info ] [MainThread]: 
[0m14:19:52.527683 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m14:19:52.527928 [info ] [MainThread]: 
[0m14:19:52.528190 [error] [MainThread]:   Database Error in model address_match (models/matching/address_match.sql)
  002025 (42S21): SQL compilation error:
  duplicate column name 'LISTING_ID'
  compiled Code at target/run/rightmove_epc/models/matching/address_match.sql
[0m14:19:52.528397 [info ] [MainThread]: 
[0m14:19:52.528644 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=1 SKIP=0 TOTAL=8
[0m14:19:52.530782 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 3.6443841, "process_user_time": 1.585706, "process_kernel_time": 0.196286, "process_mem_max_rss": "136609792", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:19:52.531154 [debug] [MainThread]: Command `dbt run` failed at 14:19:52.531079 after 3.64 seconds
[0m14:19:52.531415 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104952110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104952190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104a54f10>]}
[0m14:19:52.531662 [debug] [MainThread]: Flushing usage events
[0m14:24:23.244351 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c652950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c65e210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c65ed90>]}


============================== 14:24:23.247161 | 5e7f4310-aae1-4d17-877c-c2b540a6668e ==============================
[0m14:24:23.247161 [info ] [MainThread]: Running with dbt=1.7.10
[0m14:24:23.247541 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'profiles_dir': '/Users/melissabee/.dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m14:24:23.433973 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5e7f4310-aae1-4d17-877c-c2b540a6668e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11cec9050>]}
[0m14:24:23.473960 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5e7f4310-aae1-4d17-877c-c2b540a6668e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c6a3f10>]}
[0m14:24:23.475628 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m14:24:23.486044 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m14:24:23.518888 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:24:23.519202 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:24:23.523023 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5e7f4310-aae1-4d17-877c-c2b540a6668e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c687250>]}
[0m14:24:23.529802 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5e7f4310-aae1-4d17-877c-c2b540a6668e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11cfa7cd0>]}
[0m14:24:23.530085 [info ] [MainThread]: Found 9 models, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m14:24:23.530301 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5e7f4310-aae1-4d17-877c-c2b540a6668e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11cef4d90>]}
[0m14:24:23.531448 [info ] [MainThread]: 
[0m14:24:23.531896 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m14:24:23.532719 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m14:24:23.540130 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m14:24:23.540427 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m14:24:23.540614 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:24:24.100335 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 1.0 seconds
[0m14:24:24.103754 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m14:24:24.191081 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m14:24:24.200002 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m14:24:24.200396 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m14:24:24.200703 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:24:24.604793 [debug] [ThreadPool]: SQL status: SUCCESS 8 in 0.0 seconds
[0m14:24:24.606868 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m14:24:24.699420 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5e7f4310-aae1-4d17-877c-c2b540a6668e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11ceffd50>]}
[0m14:24:24.700416 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:24:24.700813 [info ] [MainThread]: 
[0m14:24:24.703247 [debug] [Thread-1 (]: Began running node model.rightmove_epc.stg_epc_certs
[0m14:24:24.703631 [debug] [Thread-2 (]: Began running node model.rightmove_epc.stg_rightmove
[0m14:24:24.704097 [info ] [Thread-1 (]: 1 of 9 START sql view model dbt_melissa_rm_epc.stg_epc_certs ................... [RUN]
[0m14:24:24.704530 [info ] [Thread-2 (]: 2 of 9 START sql view model dbt_melissa_rm_epc.stg_rightmove ................... [RUN]
[0m14:24:24.705194 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.stg_epc_certs)
[0m14:24:24.705849 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.stg_rightmove'
[0m14:24:24.706192 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.stg_epc_certs
[0m14:24:24.706520 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.stg_rightmove
[0m14:24:24.713372 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.stg_epc_certs"
[0m14:24:24.715876 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.stg_rightmove"
[0m14:24:24.716741 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (compile): 14:24:24.713673 => 14:24:24.716556
[0m14:24:24.717096 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (compile): 14:24:24.706725 => 14:24:24.716903
[0m14:24:24.717378 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.stg_rightmove
[0m14:24:24.717649 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.stg_epc_certs
[0m14:24:24.738150 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.stg_rightmove"
[0m14:24:24.772039 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.stg_epc_certs"
[0m14:24:24.772954 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.stg_rightmove"
[0m14:24:24.773551 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.stg_epc_certs"
[0m14:24:24.773764 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_rightmove"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
  
   as (
    with rm as (

    SELECT 
    LISTING_ID,
    UPPER(TRIM(replace(REPLACE(CONCAT(ADDRESS_1::VARCHAR,ADDRESS_2::VARCHAR),' '),','))) AS ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL 
    FROM 
       ANALYTICS.RIGHTMOVE_PROD.CLEAN_RAW_RIGHTMOVE_DATA 

 
)

SELECT * FROM rm
  );
[0m14:24:24.774007 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_epc_certs"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
  
   as (
    WITH epc_certs as (
    
    select 
    UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    COUNTY,
    LOCAL_AUTHORITY as LOCAL_AUTHORITY_CODE,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    UPPER(CASE WHEN (UPPER(ADDRESS1) LIKE 'FLAT%' OR UPPER(ADDRESS1) LIKE 'UNIT%') or UPPER(ADDRESS1) LIKE 'ROOM%' 
    THEN TRIM(REPLACE(REPLACE(CONCAT(ADDRESS1,ADDRESS2,ADDRESS3),','),' '))
    ELSE trim(replace(replace(ADDRESS1,' '),',')) END) AS ADDRESSID
 from  RAW.EPC_TEST_DATA.EPC_CERTIFICATES 

)

SELECT * FROM epc_certs
  );
[0m14:24:24.774218 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m14:24:24.774395 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:24:25.370221 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:24:25.384728 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (execute): 14:24:24.717814 => 14:24:25.384576
[0m14:24:25.385042 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: Close
[0m14:24:25.424354 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:24:25.426253 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (execute): 14:24:24.738371 => 14:24:25.426119
[0m14:24:25.426522 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: Close
[0m14:24:25.505370 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5e7f4310-aae1-4d17-877c-c2b540a6668e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11ce380d0>]}
[0m14:24:25.505865 [info ] [Thread-1 (]: 1 of 9 OK created sql view model dbt_melissa_rm_epc.stg_epc_certs .............. [[32mSUCCESS 1[0m in 0.80s]
[0m14:24:25.506195 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.stg_epc_certs
[0m14:24:25.605151 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5e7f4310-aae1-4d17-877c-c2b540a6668e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c687cd0>]}
[0m14:24:25.605653 [info ] [Thread-2 (]: 2 of 9 OK created sql view model dbt_melissa_rm_epc.stg_rightmove .............. [[32mSUCCESS 1[0m in 0.90s]
[0m14:24:25.606013 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.stg_rightmove
[0m14:24:25.606560 [debug] [Thread-4 (]: Began running node model.rightmove_epc.dim_addressid
[0m14:24:25.606837 [debug] [Thread-3 (]: Began running node model.rightmove_epc.dim_uprn
[0m14:24:25.607083 [info ] [Thread-4 (]: 3 of 9 START sql view model dbt_melissa_rm_epc.dim_addressid ................... [RUN]
[0m14:24:25.607328 [debug] [Thread-1 (]: Began running node model.rightmove_epc.uprn_match
[0m14:24:25.607549 [info ] [Thread-3 (]: 4 of 9 START sql view model dbt_melissa_rm_epc.dim_uprn ........................ [RUN]
[0m14:24:25.608052 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_addressid'
[0m14:24:25.608352 [info ] [Thread-1 (]: 5 of 9 START sql view model dbt_melissa_rm_epc.uprn_match ...................... [RUN]
[0m14:24:25.608793 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_uprn'
[0m14:24:25.609015 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.dim_addressid
[0m14:24:25.609373 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_epc_certs, now model.rightmove_epc.uprn_match)
[0m14:24:25.609579 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.dim_uprn
[0m14:24:25.611712 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.dim_addressid"
[0m14:24:25.611938 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.uprn_match
[0m14:24:25.613621 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.dim_uprn"
[0m14:24:25.615581 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.uprn_match"
[0m14:24:25.616125 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_addressid (compile): 14:24:25.609709 => 14:24:25.615980
[0m14:24:25.616355 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.dim_addressid
[0m14:24:25.616615 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.dim_uprn (compile): 14:24:25.612076 => 14:24:25.616472
[0m14:24:25.618921 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.dim_addressid"
[0m14:24:25.619286 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.dim_uprn
[0m14:24:25.621408 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.dim_uprn"
[0m14:24:25.621691 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.uprn_match (compile): 14:24:25.613912 => 14:24:25.621560
[0m14:24:25.622402 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.dim_addressid"
[0m14:24:25.622621 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.uprn_match
[0m14:24:25.622878 [debug] [Thread-4 (]: On model.rightmove_epc.dim_addressid: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_addressid"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
  
   as (
    with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource,
    POSTCODE

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where uprn is null
and addressid is not null
  );
[0m14:24:25.624901 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.uprn_match"
[0m14:24:25.625517 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.dim_uprn"
[0m14:24:25.625782 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m14:24:25.626097 [debug] [Thread-3 (]: On model.rightmove_epc.dim_uprn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_uprn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
  
   as (
    with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource,
    POSTCODE

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where uprn is not null
  );
[0m14:24:25.627178 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.uprn_match"
[0m14:24:25.627398 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m14:24:25.627850 [debug] [Thread-1 (]: On model.rightmove_epc.uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
  
   as (
    with epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    where uprn is not null

),

rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where uprn is not null
),

final as (

    select 
    LISTING_ID,
    rm.ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    rm.UPRN,
    rm.LOCAL_AUTHORITY_CODE,
    rm.LOCAL_AUTHORITY,
    rm.GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    epc.UPRN AS EPC_UPRN,
    epc.TOTAL_FLOOR_AREA,
    epc.ADDRESSID as EPC_ADDRESSID,
    CASE WHEN epc.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC    
    
     from rm left join epc on rm.uprn = epc.uprn
)

select * from final
  );
[0m14:24:25.628361 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:24:26.184208 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:24:26.190078 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_addressid (execute): 14:24:25.616742 => 14:24:26.189705
[0m14:24:26.190742 [debug] [Thread-4 (]: On model.rightmove_epc.dim_addressid: Close
[0m14:24:26.274531 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:24:26.275507 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:24:26.279496 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.uprn_match (execute): 14:24:25.623071 => 14:24:26.279219
[0m14:24:26.282153 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.dim_uprn (execute): 14:24:25.619525 => 14:24:26.281944
[0m14:24:26.282579 [debug] [Thread-1 (]: On model.rightmove_epc.uprn_match: Close
[0m14:24:26.282971 [debug] [Thread-3 (]: On model.rightmove_epc.dim_uprn: Close
[0m14:24:26.295846 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5e7f4310-aae1-4d17-877c-c2b540a6668e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d451bd0>]}
[0m14:24:26.296473 [info ] [Thread-4 (]: 3 of 9 OK created sql view model dbt_melissa_rm_epc.dim_addressid .............. [[32mSUCCESS 1[0m in 0.69s]
[0m14:24:26.297024 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.dim_addressid
[0m14:24:26.297608 [debug] [Thread-2 (]: Began running node model.rightmove_epc.address_match
[0m14:24:26.297988 [debug] [Thread-4 (]: Began running node model.rightmove_epc.address_simularity
[0m14:24:26.298373 [info ] [Thread-2 (]: 6 of 9 START sql view model dbt_melissa_rm_epc.address_match ................... [RUN]
[0m14:24:26.298846 [info ] [Thread-4 (]: 7 of 9 START sql view model dbt_melissa_rm_epc.address_simularity .............. [RUN]
[0m14:24:26.299576 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_rightmove, now model.rightmove_epc.address_match)
[0m14:24:26.300202 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.dim_addressid, now model.rightmove_epc.address_simularity)
[0m14:24:26.300577 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.address_match
[0m14:24:26.301010 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.address_simularity
[0m14:24:26.305583 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.address_match"
[0m14:24:26.308067 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.address_simularity"
[0m14:24:26.309151 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.address_match (compile): 14:24:26.301258 => 14:24:26.308887
[0m14:24:26.309589 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.address_simularity (compile): 14:24:26.305924 => 14:24:26.309349
[0m14:24:26.309947 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.address_match
[0m14:24:26.310291 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.address_simularity
[0m14:24:26.313179 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.address_match"
[0m14:24:26.315544 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.address_simularity"
[0m14:24:26.316836 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.address_match"
[0m14:24:26.317274 [debug] [Thread-2 (]: On model.rightmove_epc.address_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.address_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NULL
),

epc_address as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
    where datasource = 'EPC'
)


SELECT rm.*,
epc_address.addressid
as EPC_ADDRESSID,
CASE WHEN epc_address.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC    

FROM rm
inner JOIN epc_address
ON rm.addressid = epc_address.addressid
and rm.FULL_POSTCODE = epc_address.POSTCODE
  );
[0m14:24:26.317899 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.address_simularity"
[0m14:24:26.318179 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m14:24:26.319046 [debug] [Thread-4 (]: On model.rightmove_epc.address_simularity: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.address_simularity"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.address_simularity
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NULL
),

epc_address as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
    where datasource = 'EPC'
)


SELECT rm.*,epc_address.addressid as EPC_ADDRESSID
FROM rm
JOIN epc_address
ON JAROWINKLER_SIMILARITY(rm.addressid, epc_address.addressid) = 1
  );
[0m14:24:26.320044 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m14:24:26.374274 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5e7f4310-aae1-4d17-877c-c2b540a6668e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11ce38310>]}
[0m14:24:26.374771 [info ] [Thread-3 (]: 4 of 9 OK created sql view model dbt_melissa_rm_epc.dim_uprn ................... [[32mSUCCESS 1[0m in 0.77s]
[0m14:24:26.375117 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.dim_uprn
[0m14:24:26.386131 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5e7f4310-aae1-4d17-877c-c2b540a6668e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d0ab850>]}
[0m14:24:26.386612 [info ] [Thread-1 (]: 5 of 9 OK created sql view model dbt_melissa_rm_epc.uprn_match ................. [[32mSUCCESS 1[0m in 0.78s]
[0m14:24:26.386969 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.uprn_match
[0m14:24:26.387365 [debug] [Thread-3 (]: Began running node model.rightmove_epc.no_uprn_match
[0m14:24:26.387673 [info ] [Thread-3 (]: 8 of 9 START sql view model dbt_melissa_rm_epc.no_uprn_match ................... [RUN]
[0m14:24:26.388104 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.dim_uprn, now model.rightmove_epc.no_uprn_match)
[0m14:24:26.388333 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.no_uprn_match
[0m14:24:26.390725 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.no_uprn_match"
[0m14:24:26.391362 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.no_uprn_match (compile): 14:24:26.388463 => 14:24:26.391232
[0m14:24:26.391590 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.no_uprn_match
[0m14:24:26.393892 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.no_uprn_match"
[0m14:24:26.394740 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.no_uprn_match"
[0m14:24:26.394991 [debug] [Thread-3 (]: On model.rightmove_epc.no_uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.no_uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.no_uprn_match
  
   as (
    with rm_no_match_to_epc  as ( -- rightmove uspn does not match epc

    select 
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL

     from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'NO'
    
)

select * from rm_no_match_to_epc

/*
epc_remove as (

    select EPC_UPRN,EPC_ADDRESSID from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'YES'  -- 
),

epc_matched as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs src
    left join epc_remove rem on src.UPRN = rem.EPC_UPRN
    
),

epc_fm_prep as (

    select * from epc_matched
    where EPC_UPRN is NULL

    
)


SELECT * FROM epc_fm_prep
WHERE UPRN NOT NULL */
  );
[0m14:24:26.395218 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m14:24:26.853999 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:24:26.855960 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.address_match (execute): 14:24:26.310517 => 14:24:26.855804
[0m14:24:26.856258 [debug] [Thread-2 (]: On model.rightmove_epc.address_match: Close
[0m14:24:26.924346 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:24:26.926833 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.address_simularity (execute): 14:24:26.313439 => 14:24:26.926643
[0m14:24:26.927213 [debug] [Thread-4 (]: On model.rightmove_epc.address_simularity: Close
[0m14:24:26.935656 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5e7f4310-aae1-4d17-877c-c2b540a6668e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d432c50>]}
[0m14:24:26.936236 [info ] [Thread-2 (]: 6 of 9 OK created sql view model dbt_melissa_rm_epc.address_match .............. [[32mSUCCESS 1[0m in 0.64s]
[0m14:24:26.936723 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.address_match
[0m14:24:26.988524 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:24:26.990873 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.no_uprn_match (execute): 14:24:26.391727 => 14:24:26.990702
[0m14:24:26.991199 [debug] [Thread-3 (]: On model.rightmove_epc.no_uprn_match: Close
[0m14:24:27.018512 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5e7f4310-aae1-4d17-877c-c2b540a6668e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d464750>]}
[0m14:24:27.019005 [info ] [Thread-4 (]: 7 of 9 OK created sql view model dbt_melissa_rm_epc.address_simularity ......... [[32mSUCCESS 1[0m in 0.72s]
[0m14:24:27.019355 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.address_simularity
[0m14:24:27.106535 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5e7f4310-aae1-4d17-877c-c2b540a6668e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d006310>]}
[0m14:24:27.107100 [info ] [Thread-3 (]: 8 of 9 OK created sql view model dbt_melissa_rm_epc.no_uprn_match .............. [[32mSUCCESS 1[0m in 0.72s]
[0m14:24:27.107504 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.no_uprn_match
[0m14:24:27.108022 [debug] [Thread-1 (]: Began running node model.rightmove_epc.no_matches
[0m14:24:27.108394 [info ] [Thread-1 (]: 9 of 9 START sql view model dbt_melissa_rm_epc.no_matches ...................... [RUN]
[0m14:24:27.108890 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.uprn_match, now model.rightmove_epc.no_matches)
[0m14:24:27.109142 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.no_matches
[0m14:24:27.111243 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.no_matches"
[0m14:24:27.111854 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.no_matches (compile): 14:24:27.109297 => 14:24:27.111722
[0m14:24:27.112100 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.no_matches
[0m14:24:27.114589 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.no_matches"
[0m14:24:27.115311 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.no_matches"
[0m14:24:27.115547 [debug] [Thread-1 (]: On model.rightmove_epc.no_matches: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.no_matches"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.no_matches
  
   as (
    with addr as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
    where MATCH_EPC = 'NO' 
),

uprn as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.no_uprn_match
)

select * from addr
union all
select * from uprn
  );
[0m14:24:27.115771 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:24:27.605439 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b33f60-0103-9acb-0000-719506356c96
[0m14:24:27.605907 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 001789 (42601): SQL compilation error:
invalid number of result columns for set operator input branches, expected 13, got 11 in branch 2
[0m14:24:27.606434 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.no_matches (execute): 14:24:27.112242 => 14:24:27.606241
[0m14:24:27.606795 [debug] [Thread-1 (]: On model.rightmove_epc.no_matches: Close
[0m14:24:27.715664 [debug] [Thread-1 (]: Database Error in model no_matches (models/matching/no_matches.sql)
  001789 (42601): SQL compilation error:
  invalid number of result columns for set operator input branches, expected 13, got 11 in branch 2
  compiled Code at target/run/rightmove_epc/models/matching/no_matches.sql
[0m14:24:27.716201 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5e7f4310-aae1-4d17-877c-c2b540a6668e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11cefe5d0>]}
[0m14:24:27.716742 [error] [Thread-1 (]: 9 of 9 ERROR creating sql view model dbt_melissa_rm_epc.no_matches ............. [[31mERROR[0m in 0.61s]
[0m14:24:27.717282 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.no_matches
[0m14:24:27.718899 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:24:27.719194 [debug] [MainThread]: Connection 'model.rightmove_epc.no_matches' was properly closed.
[0m14:24:27.719432 [debug] [MainThread]: Connection 'model.rightmove_epc.address_match' was properly closed.
[0m14:24:27.719658 [debug] [MainThread]: Connection 'model.rightmove_epc.address_simularity' was properly closed.
[0m14:24:27.719872 [debug] [MainThread]: Connection 'model.rightmove_epc.no_uprn_match' was properly closed.
[0m14:24:27.720151 [info ] [MainThread]: 
[0m14:24:27.720414 [info ] [MainThread]: Finished running 9 view models in 0 hours 0 minutes and 4.19 seconds (4.19s).
[0m14:24:27.721556 [debug] [MainThread]: Command end result
[0m14:24:27.730146 [info ] [MainThread]: 
[0m14:24:27.730484 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m14:24:27.730802 [info ] [MainThread]: 
[0m14:24:27.731051 [error] [MainThread]:   Database Error in model no_matches (models/matching/no_matches.sql)
  001789 (42601): SQL compilation error:
  invalid number of result columns for set operator input branches, expected 13, got 11 in branch 2
  compiled Code at target/run/rightmove_epc/models/matching/no_matches.sql
[0m14:24:27.731293 [info ] [MainThread]: 
[0m14:24:27.731526 [info ] [MainThread]: Done. PASS=8 WARN=0 ERROR=1 SKIP=0 TOTAL=9
[0m14:24:27.733465 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 4.5180397, "process_user_time": 1.638626, "process_kernel_time": 0.197757, "process_mem_max_rss": "139182080", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:24:27.733928 [debug] [MainThread]: Command `dbt run` failed at 14:24:27.733828 after 4.52 seconds
[0m14:24:27.734242 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105114f10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105116250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105012190>]}
[0m14:24:27.734541 [debug] [MainThread]: Flushing usage events
[0m14:25:29.714356 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106c18fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106c61c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106c63010>]}


============================== 14:25:29.717358 | 9a2a9852-bbea-4783-b48e-185248e99311 ==============================
[0m14:25:29.717358 [info ] [MainThread]: Running with dbt=1.7.10
[0m14:25:29.717793 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt run', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m14:25:29.883999 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9a2a9852-bbea-4783-b48e-185248e99311', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107719a90>]}
[0m14:25:29.926632 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9a2a9852-bbea-4783-b48e-185248e99311', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1056b42d0>]}
[0m14:25:29.927717 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m14:25:29.938023 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m14:25:29.957099 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:25:29.957464 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:25:29.961340 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9a2a9852-bbea-4783-b48e-185248e99311', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1077ea150>]}
[0m14:25:29.968597 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9a2a9852-bbea-4783-b48e-185248e99311', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10777a350>]}
[0m14:25:29.968922 [info ] [MainThread]: Found 9 models, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m14:25:29.969134 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9a2a9852-bbea-4783-b48e-185248e99311', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107538b10>]}
[0m14:25:29.970293 [info ] [MainThread]: 
[0m14:25:29.970775 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m14:25:29.971592 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m14:25:29.978926 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m14:25:29.979202 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m14:25:29.979377 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:25:30.568080 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 1.0 seconds
[0m14:25:30.569890 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m14:25:30.663915 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m14:25:30.669901 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m14:25:30.670200 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m14:25:30.670404 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:25:31.269610 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 1.0 seconds
[0m14:25:31.270955 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m14:25:31.398346 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9a2a9852-bbea-4783-b48e-185248e99311', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107895590>]}
[0m14:25:31.399255 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:25:31.399616 [info ] [MainThread]: 
[0m14:25:31.402638 [debug] [Thread-1 (]: Began running node model.rightmove_epc.stg_epc_certs
[0m14:25:31.403062 [debug] [Thread-2 (]: Began running node model.rightmove_epc.stg_rightmove
[0m14:25:31.403434 [info ] [Thread-1 (]: 1 of 9 START sql view model dbt_melissa_rm_epc.stg_epc_certs ................... [RUN]
[0m14:25:31.403901 [info ] [Thread-2 (]: 2 of 9 START sql view model dbt_melissa_rm_epc.stg_rightmove ................... [RUN]
[0m14:25:31.404550 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.stg_epc_certs)
[0m14:25:31.405155 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.stg_rightmove'
[0m14:25:31.405465 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.stg_epc_certs
[0m14:25:31.405764 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.stg_rightmove
[0m14:25:31.412049 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.stg_epc_certs"
[0m14:25:31.414370 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.stg_rightmove"
[0m14:25:31.415096 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (compile): 14:25:31.405953 => 14:25:31.414917
[0m14:25:31.415454 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (compile): 14:25:31.412343 => 14:25:31.415268
[0m14:25:31.415724 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.stg_epc_certs
[0m14:25:31.415995 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.stg_rightmove
[0m14:25:31.434709 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.stg_epc_certs"
[0m14:25:31.469385 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.stg_rightmove"
[0m14:25:31.470331 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.stg_epc_certs"
[0m14:25:31.470576 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_epc_certs"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
  
   as (
    WITH epc_certs as (
    
    select 
    UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    COUNTY,
    LOCAL_AUTHORITY as LOCAL_AUTHORITY_CODE,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    UPPER(CASE WHEN (UPPER(ADDRESS1) LIKE 'FLAT%' OR UPPER(ADDRESS1) LIKE 'UNIT%') or UPPER(ADDRESS1) LIKE 'ROOM%' 
    THEN TRIM(REPLACE(REPLACE(CONCAT(ADDRESS1,ADDRESS2,ADDRESS3),','),' '))
    ELSE trim(replace(replace(ADDRESS1,' '),',')) END) AS ADDRESSID
 from  RAW.EPC_TEST_DATA.EPC_CERTIFICATES 

)

SELECT * FROM epc_certs
  );
[0m14:25:31.471084 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.stg_rightmove"
[0m14:25:31.471256 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:25:31.471463 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_rightmove"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
  
   as (
    with rm as (

    SELECT 
    LISTING_ID,
    UPPER(TRIM(replace(REPLACE(CONCAT(ADDRESS_1::VARCHAR,ADDRESS_2::VARCHAR),' '),','))) AS ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL 
    FROM 
       ANALYTICS.RIGHTMOVE_PROD.CLEAN_RAW_RIGHTMOVE_DATA 

 
)

SELECT * FROM rm
  );
[0m14:25:31.472298 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m14:25:32.004861 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:25:32.017648 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (execute): 14:25:31.434952 => 14:25:32.017507
[0m14:25:32.017961 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: Close
[0m14:25:32.047747 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:25:32.049528 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (execute): 14:25:31.416155 => 14:25:32.049409
[0m14:25:32.049757 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: Close
[0m14:25:32.124179 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9a2a9852-bbea-4783-b48e-185248e99311', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107688890>]}
[0m14:25:32.124700 [info ] [Thread-2 (]: 2 of 9 OK created sql view model dbt_melissa_rm_epc.stg_rightmove .............. [[32mSUCCESS 1[0m in 0.72s]
[0m14:25:32.125046 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.stg_rightmove
[0m14:25:32.172035 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9a2a9852-bbea-4783-b48e-185248e99311', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10779d2d0>]}
[0m14:25:32.172547 [info ] [Thread-1 (]: 1 of 9 OK created sql view model dbt_melissa_rm_epc.stg_epc_certs .............. [[32mSUCCESS 1[0m in 0.77s]
[0m14:25:32.172909 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.stg_epc_certs
[0m14:25:32.173495 [debug] [Thread-4 (]: Began running node model.rightmove_epc.dim_addressid
[0m14:25:32.173799 [debug] [Thread-3 (]: Began running node model.rightmove_epc.dim_uprn
[0m14:25:32.174025 [debug] [Thread-2 (]: Began running node model.rightmove_epc.uprn_match
[0m14:25:32.174326 [info ] [Thread-4 (]: 3 of 9 START sql view model dbt_melissa_rm_epc.dim_addressid ................... [RUN]
[0m14:25:32.174652 [info ] [Thread-3 (]: 4 of 9 START sql view model dbt_melissa_rm_epc.dim_uprn ........................ [RUN]
[0m14:25:32.174971 [info ] [Thread-2 (]: 5 of 9 START sql view model dbt_melissa_rm_epc.uprn_match ...................... [RUN]
[0m14:25:32.175501 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_addressid'
[0m14:25:32.175895 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_uprn'
[0m14:25:32.176218 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_rightmove, now model.rightmove_epc.uprn_match)
[0m14:25:32.176441 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.dim_addressid
[0m14:25:32.176620 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.dim_uprn
[0m14:25:32.176822 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.uprn_match
[0m14:25:32.178878 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.dim_addressid"
[0m14:25:32.180483 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.dim_uprn"
[0m14:25:32.182424 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.uprn_match"
[0m14:25:32.183210 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_addressid (compile): 14:25:32.176936 => 14:25:32.183051
[0m14:25:32.183478 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.dim_uprn (compile): 14:25:32.179061 => 14:25:32.183338
[0m14:25:32.183748 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.dim_addressid
[0m14:25:32.184010 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.uprn_match (compile): 14:25:32.180655 => 14:25:32.183885
[0m14:25:32.184198 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.dim_uprn
[0m14:25:32.186380 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.dim_addressid"
[0m14:25:32.186712 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.uprn_match
[0m14:25:32.188646 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.dim_uprn"
[0m14:25:32.190575 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.uprn_match"
[0m14:25:32.191481 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.dim_addressid"
[0m14:25:32.192033 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.dim_uprn"
[0m14:25:32.192288 [debug] [Thread-4 (]: On model.rightmove_epc.dim_addressid: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_addressid"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
  
   as (
    with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource,
    POSTCODE

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where uprn is null
and addressid is not null
  );
[0m14:25:32.192948 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.uprn_match"
[0m14:25:32.193214 [debug] [Thread-3 (]: On model.rightmove_epc.dim_uprn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_uprn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
  
   as (
    with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource,
    POSTCODE

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where uprn is not null
  );
[0m14:25:32.193459 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m14:25:32.193700 [debug] [Thread-2 (]: On model.rightmove_epc.uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
  
   as (
    with epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    where uprn is not null

),

rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where uprn is not null
),

final as (

    select 
    LISTING_ID,
    rm.ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    rm.UPRN,
    rm.LOCAL_AUTHORITY_CODE,
    rm.LOCAL_AUTHORITY,
    rm.GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    epc.UPRN AS EPC_UPRN,
    epc.TOTAL_FLOOR_AREA,
    epc.ADDRESSID as EPC_ADDRESSID,
    CASE WHEN epc.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC    
    
     from rm left join epc on rm.uprn = epc.uprn
)

select * from final
  );
[0m14:25:32.193922 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m14:25:32.194739 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m14:25:32.865722 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:25:32.868975 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.uprn_match (execute): 14:25:32.188904 => 14:25:32.868716
[0m14:25:32.869427 [debug] [Thread-2 (]: On model.rightmove_epc.uprn_match: Close
[0m14:25:32.947354 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9a2a9852-bbea-4783-b48e-185248e99311', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107b74cd0>]}
[0m14:25:32.948088 [info ] [Thread-2 (]: 5 of 9 OK created sql view model dbt_melissa_rm_epc.uprn_match ................. [[32mSUCCESS 1[0m in 0.77s]
[0m14:25:32.948573 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.uprn_match
[0m14:25:32.949103 [debug] [Thread-1 (]: Began running node model.rightmove_epc.no_uprn_match
[0m14:25:32.949528 [info ] [Thread-1 (]: 6 of 9 START sql view model dbt_melissa_rm_epc.no_uprn_match ................... [RUN]
[0m14:25:32.950190 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_epc_certs, now model.rightmove_epc.no_uprn_match)
[0m14:25:32.950544 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.no_uprn_match
[0m14:25:32.953760 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.no_uprn_match"
[0m14:25:32.954604 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.no_uprn_match (compile): 14:25:32.950750 => 14:25:32.954412
[0m14:25:32.954913 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.no_uprn_match
[0m14:25:32.958563 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.no_uprn_match"
[0m14:25:32.959697 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.no_uprn_match"
[0m14:25:32.960159 [debug] [Thread-1 (]: On model.rightmove_epc.no_uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.no_uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.no_uprn_match
  
   as (
    with rm_no_match_to_epc  as ( -- rightmove uspn does not match epc

    select 
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL

     from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'NO'
    
)

select * from rm_no_match_to_epc

/*
epc_remove as (

    select EPC_UPRN,EPC_ADDRESSID from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'YES'  -- 
),

epc_matched as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs src
    left join epc_remove rem on src.UPRN = rem.EPC_UPRN
    
),

epc_fm_prep as (

    select * from epc_matched
    where EPC_UPRN is NULL

    
)


SELECT * FROM epc_fm_prep
WHERE UPRN NOT NULL */
  );
[0m14:25:32.960492 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:25:33.086316 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:25:33.089921 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_addressid (execute): 14:25:32.184337 => 14:25:33.089781
[0m14:25:33.090240 [debug] [Thread-4 (]: On model.rightmove_epc.dim_addressid: Close
[0m14:25:33.124628 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:25:33.126383 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.dim_uprn (execute): 14:25:32.186865 => 14:25:33.126236
[0m14:25:33.126670 [debug] [Thread-3 (]: On model.rightmove_epc.dim_uprn: Close
[0m14:25:33.165523 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9a2a9852-bbea-4783-b48e-185248e99311', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107b76410>]}
[0m14:25:33.166022 [info ] [Thread-4 (]: 3 of 9 OK created sql view model dbt_melissa_rm_epc.dim_addressid .............. [[32mSUCCESS 1[0m in 0.99s]
[0m14:25:33.166358 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.dim_addressid
[0m14:25:33.166737 [debug] [Thread-2 (]: Began running node model.rightmove_epc.address_match
[0m14:25:33.166996 [debug] [Thread-4 (]: Began running node model.rightmove_epc.address_simularity
[0m14:25:33.167274 [info ] [Thread-2 (]: 7 of 9 START sql view model dbt_melissa_rm_epc.address_match ................... [RUN]
[0m14:25:33.167540 [info ] [Thread-4 (]: 8 of 9 START sql view model dbt_melissa_rm_epc.address_simularity .............. [RUN]
[0m14:25:33.167923 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.uprn_match, now model.rightmove_epc.address_match)
[0m14:25:33.168255 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.dim_addressid, now model.rightmove_epc.address_simularity)
[0m14:25:33.168457 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.address_match
[0m14:25:33.168651 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.address_simularity
[0m14:25:33.170747 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.address_match"
[0m14:25:33.172627 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.address_simularity"
[0m14:25:33.173726 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.address_simularity (compile): 14:25:33.171057 => 14:25:33.173548
[0m14:25:33.174206 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.address_match (compile): 14:25:33.168771 => 14:25:33.173874
[0m14:25:33.174415 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.address_simularity
[0m14:25:33.174629 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.address_match
[0m14:25:33.176590 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.address_simularity"
[0m14:25:33.178483 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.address_match"
[0m14:25:33.179397 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.address_match"
[0m14:25:33.179921 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.address_simularity"
[0m14:25:33.180143 [debug] [Thread-2 (]: On model.rightmove_epc.address_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.address_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NULL
),

epc_address as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
    where datasource = 'EPC'
)


SELECT rm.*,
epc_address.addressid
as EPC_ADDRESSID,
CASE WHEN epc_address.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC    

FROM rm
LEFT JOIN epc_address
ON rm.addressid = epc_address.addressid
and rm.FULL_POSTCODE = epc_address.POSTCODE
  );
[0m14:25:33.180391 [debug] [Thread-4 (]: On model.rightmove_epc.address_simularity: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.address_simularity"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.address_simularity
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NULL
),

epc_address as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
    where datasource = 'EPC'
)


SELECT rm.*,epc_address.addressid as EPC_ADDRESSID
FROM rm
JOIN epc_address
ON JAROWINKLER_SIMILARITY(rm.addressid, epc_address.addressid) = 1
  );
[0m14:25:33.180614 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m14:25:33.180811 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m14:25:33.482041 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9a2a9852-bbea-4783-b48e-185248e99311', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1077015d0>]}
[0m14:25:33.482724 [info ] [Thread-3 (]: 4 of 9 OK created sql view model dbt_melissa_rm_epc.dim_uprn ................... [[32mSUCCESS 1[0m in 1.31s]
[0m14:25:33.483207 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.dim_uprn
[0m14:25:33.851570 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:25:33.854106 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.no_uprn_match (execute): 14:25:32.955087 => 14:25:33.853932
[0m14:25:33.854446 [debug] [Thread-1 (]: On model.rightmove_epc.no_uprn_match: Close
[0m14:25:33.935023 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9a2a9852-bbea-4783-b48e-185248e99311', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107788650>]}
[0m14:25:33.936098 [info ] [Thread-1 (]: 6 of 9 OK created sql view model dbt_melissa_rm_epc.no_uprn_match .............. [[32mSUCCESS 1[0m in 0.98s]
[0m14:25:33.936827 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.no_uprn_match
[0m14:25:33.961324 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:25:33.963578 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.address_match (execute): 14:25:33.176739 => 14:25:33.963421
[0m14:25:33.963879 [debug] [Thread-2 (]: On model.rightmove_epc.address_match: Close
[0m14:25:34.060166 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9a2a9852-bbea-4783-b48e-185248e99311', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1078c9f50>]}
[0m14:25:34.060798 [info ] [Thread-2 (]: 7 of 9 OK created sql view model dbt_melissa_rm_epc.address_match .............. [[32mSUCCESS 1[0m in 0.89s]
[0m14:25:34.061272 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.address_match
[0m14:25:34.061776 [debug] [Thread-3 (]: Began running node model.rightmove_epc.no_matches
[0m14:25:34.062184 [info ] [Thread-3 (]: 9 of 9 START sql view model dbt_melissa_rm_epc.no_matches ...................... [RUN]
[0m14:25:34.062759 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.dim_uprn, now model.rightmove_epc.no_matches)
[0m14:25:34.063069 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.no_matches
[0m14:25:34.065533 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.no_matches"
[0m14:25:34.066161 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.no_matches (compile): 14:25:34.063265 => 14:25:34.066011
[0m14:25:34.066422 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.no_matches
[0m14:25:34.069369 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.no_matches"
[0m14:25:34.070246 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.no_matches"
[0m14:25:34.070541 [debug] [Thread-3 (]: On model.rightmove_epc.no_matches: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.no_matches"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.no_matches
  
   as (
    with addr as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
    where MATCH_EPC = 'NO' 
),

uprn as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.no_uprn_match
)

select * from addr
union all
select * from uprn
  );
[0m14:25:34.070946 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m14:25:34.262317 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:25:34.264822 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.address_simularity (execute): 14:25:33.174758 => 14:25:34.264647
[0m14:25:34.265141 [debug] [Thread-4 (]: On model.rightmove_epc.address_simularity: Close
[0m14:25:34.351175 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9a2a9852-bbea-4783-b48e-185248e99311', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107b63290>]}
[0m14:25:34.352017 [info ] [Thread-4 (]: 8 of 9 OK created sql view model dbt_melissa_rm_epc.address_simularity ......... [[32mSUCCESS 1[0m in 1.18s]
[0m14:25:34.352692 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.address_simularity
[0m14:25:34.648560 [debug] [Thread-3 (]: Snowflake adapter: Snowflake query id: 01b33f61-0103-9aa3-0000-719506354c12
[0m14:25:34.648885 [debug] [Thread-3 (]: Snowflake adapter: Snowflake error: 001789 (42601): SQL compilation error:
invalid number of result columns for set operator input branches, expected 13, got 11 in branch 2
[0m14:25:34.649222 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.no_matches (execute): 14:25:34.066578 => 14:25:34.649101
[0m14:25:34.649445 [debug] [Thread-3 (]: On model.rightmove_epc.no_matches: Close
[0m14:25:34.743207 [debug] [Thread-3 (]: Database Error in model no_matches (models/matching/no_matches.sql)
  001789 (42601): SQL compilation error:
  invalid number of result columns for set operator input branches, expected 13, got 11 in branch 2
  compiled Code at target/run/rightmove_epc/models/matching/no_matches.sql
[0m14:25:34.743613 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9a2a9852-bbea-4783-b48e-185248e99311', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107701590>]}
[0m14:25:34.744034 [error] [Thread-3 (]: 9 of 9 ERROR creating sql view model dbt_melissa_rm_epc.no_matches ............. [[31mERROR[0m in 0.68s]
[0m14:25:34.744401 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.no_matches
[0m14:25:34.745597 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:25:34.745826 [debug] [MainThread]: Connection 'model.rightmove_epc.no_uprn_match' was properly closed.
[0m14:25:34.746000 [debug] [MainThread]: Connection 'model.rightmove_epc.address_match' was properly closed.
[0m14:25:34.746158 [debug] [MainThread]: Connection 'model.rightmove_epc.address_simularity' was properly closed.
[0m14:25:34.746311 [debug] [MainThread]: Connection 'model.rightmove_epc.no_matches' was properly closed.
[0m14:25:34.746524 [info ] [MainThread]: 
[0m14:25:34.746714 [info ] [MainThread]: Finished running 9 view models in 0 hours 0 minutes and 4.78 seconds (4.78s).
[0m14:25:34.747525 [debug] [MainThread]: Command end result
[0m14:25:34.754181 [info ] [MainThread]: 
[0m14:25:34.754478 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m14:25:34.754679 [info ] [MainThread]: 
[0m14:25:34.754864 [error] [MainThread]:   Database Error in model no_matches (models/matching/no_matches.sql)
  001789 (42601): SQL compilation error:
  invalid number of result columns for set operator input branches, expected 13, got 11 in branch 2
  compiled Code at target/run/rightmove_epc/models/matching/no_matches.sql
[0m14:25:34.755095 [info ] [MainThread]: 
[0m14:25:34.755466 [info ] [MainThread]: Done. PASS=8 WARN=0 ERROR=1 SKIP=0 TOTAL=9
[0m14:25:34.757249 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 5.0746455, "process_user_time": 1.609691, "process_kernel_time": 0.178402, "process_mem_max_rss": "139132928", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:25:34.757642 [debug] [MainThread]: Command `dbt run` failed at 14:25:34.757569 after 5.08 seconds
[0m14:25:34.757906 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107700bd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10115e110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10115e190>]}
[0m14:25:34.758139 [debug] [MainThread]: Flushing usage events
[0m14:29:20.590037 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10938f0d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10939a610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10939b150>]}


============================== 14:29:20.593109 | df8c5233-cfd3-4fa7-8bfa-3798d2bfa49d ==============================
[0m14:29:20.593109 [info ] [MainThread]: Running with dbt=1.7.10
[0m14:29:20.593489 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m14:29:20.780216 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'df8c5233-cfd3-4fa7-8bfa-3798d2bfa49d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109373750>]}
[0m14:29:20.820544 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'df8c5233-cfd3-4fa7-8bfa-3798d2bfa49d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109d3bc10>]}
[0m14:29:20.822309 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m14:29:20.832365 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m14:29:20.850909 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:29:20.851273 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:29:20.854988 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'df8c5233-cfd3-4fa7-8bfa-3798d2bfa49d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1093dd250>]}
[0m14:29:20.861899 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'df8c5233-cfd3-4fa7-8bfa-3798d2bfa49d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a0e83d0>]}
[0m14:29:20.862185 [info ] [MainThread]: Found 9 models, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m14:29:20.862401 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'df8c5233-cfd3-4fa7-8bfa-3798d2bfa49d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a0dae90>]}
[0m14:29:20.863518 [info ] [MainThread]: 
[0m14:29:20.863968 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m14:29:20.864724 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m14:29:20.871847 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m14:29:20.872100 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m14:29:20.872271 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:29:21.290297 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 0.0 seconds
[0m14:29:21.293706 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m14:29:21.369090 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m14:29:21.377597 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m14:29:21.377983 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m14:29:21.378273 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:29:21.834702 [debug] [ThreadPool]: SQL status: SUCCESS 9 in 0.0 seconds
[0m14:29:21.836318 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m14:29:21.919805 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'df8c5233-cfd3-4fa7-8bfa-3798d2bfa49d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109df7d90>]}
[0m14:29:21.920772 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:29:21.921180 [info ] [MainThread]: 
[0m14:29:21.924702 [debug] [Thread-1 (]: Began running node model.rightmove_epc.stg_epc_certs
[0m14:29:21.925188 [debug] [Thread-2 (]: Began running node model.rightmove_epc.stg_rightmove
[0m14:29:21.925816 [info ] [Thread-1 (]: 1 of 9 START sql view model dbt_melissa_rm_epc.stg_epc_certs ................... [RUN]
[0m14:29:21.926513 [info ] [Thread-2 (]: 2 of 9 START sql view model dbt_melissa_rm_epc.stg_rightmove ................... [RUN]
[0m14:29:21.927452 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.stg_epc_certs)
[0m14:29:21.928307 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.stg_rightmove'
[0m14:29:21.928800 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.stg_epc_certs
[0m14:29:21.929201 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.stg_rightmove
[0m14:29:21.936159 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.stg_epc_certs"
[0m14:29:21.938764 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.stg_rightmove"
[0m14:29:21.939579 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (compile): 14:29:21.929460 => 14:29:21.939374
[0m14:29:21.939917 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (compile): 14:29:21.936515 => 14:29:21.939758
[0m14:29:21.940175 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.stg_epc_certs
[0m14:29:21.940435 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.stg_rightmove
[0m14:29:21.960480 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.stg_epc_certs"
[0m14:29:21.994485 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.stg_rightmove"
[0m14:29:21.995572 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.stg_epc_certs"
[0m14:29:21.996083 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.stg_rightmove"
[0m14:29:21.996338 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_epc_certs"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
  
   as (
    WITH epc_certs as (
    
    select 
    UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    COUNTY,
    LOCAL_AUTHORITY as LOCAL_AUTHORITY_CODE,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    UPPER(CASE WHEN (UPPER(ADDRESS1) LIKE 'FLAT%' OR UPPER(ADDRESS1) LIKE 'UNIT%') or UPPER(ADDRESS1) LIKE 'ROOM%' 
    THEN TRIM(REPLACE(REPLACE(CONCAT(ADDRESS1,ADDRESS2,ADDRESS3),','),' '))
    ELSE trim(replace(replace(ADDRESS1,' '),',')) END) AS ADDRESSID
 from  RAW.EPC_TEST_DATA.EPC_CERTIFICATES 

)

SELECT * FROM epc_certs
  );
[0m14:29:21.996593 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_rightmove"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
  
   as (
    with rm as (

    SELECT 
    LISTING_ID,
    UPPER(TRIM(replace(REPLACE(CONCAT(ADDRESS_1::VARCHAR,ADDRESS_2::VARCHAR),' '),','))) AS ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL 
    FROM 
       ANALYTICS.RIGHTMOVE_PROD.CLEAN_RAW_RIGHTMOVE_DATA 

 
)

SELECT * FROM rm
  );
[0m14:29:21.996804 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:29:21.996988 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m14:29:22.465355 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m14:29:22.479530 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (execute): 14:29:21.960689 => 14:29:22.479390
[0m14:29:22.479825 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: Close
[0m14:29:22.538151 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:29:22.542094 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (execute): 14:29:21.940592 => 14:29:22.541810
[0m14:29:22.542638 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: Close
[0m14:29:22.553078 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'df8c5233-cfd3-4fa7-8bfa-3798d2bfa49d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a127090>]}
[0m14:29:22.553856 [info ] [Thread-2 (]: 2 of 9 OK created sql view model dbt_melissa_rm_epc.stg_rightmove .............. [[32mSUCCESS 1[0m in 0.63s]
[0m14:29:22.554507 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.stg_rightmove
[0m14:29:22.626996 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'df8c5233-cfd3-4fa7-8bfa-3798d2bfa49d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a36fed0>]}
[0m14:29:22.627733 [info ] [Thread-1 (]: 1 of 9 OK created sql view model dbt_melissa_rm_epc.stg_epc_certs .............. [[32mSUCCESS 1[0m in 0.70s]
[0m14:29:22.628291 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.stg_epc_certs
[0m14:29:22.629008 [debug] [Thread-4 (]: Began running node model.rightmove_epc.dim_addressid
[0m14:29:22.629396 [debug] [Thread-3 (]: Began running node model.rightmove_epc.dim_uprn
[0m14:29:22.629799 [debug] [Thread-2 (]: Began running node model.rightmove_epc.uprn_match
[0m14:29:22.630181 [info ] [Thread-4 (]: 3 of 9 START sql view model dbt_melissa_rm_epc.dim_addressid ................... [RUN]
[0m14:29:22.630615 [info ] [Thread-3 (]: 4 of 9 START sql view model dbt_melissa_rm_epc.dim_uprn ........................ [RUN]
[0m14:29:22.631098 [info ] [Thread-2 (]: 5 of 9 START sql view model dbt_melissa_rm_epc.uprn_match ...................... [RUN]
[0m14:29:22.631793 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_addressid'
[0m14:29:22.632357 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_uprn'
[0m14:29:22.632874 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_rightmove, now model.rightmove_epc.uprn_match)
[0m14:29:22.633181 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.dim_addressid
[0m14:29:22.633463 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.dim_uprn
[0m14:29:22.633725 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.uprn_match
[0m14:29:22.636731 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.dim_addressid"
[0m14:29:22.639017 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.dim_uprn"
[0m14:29:22.641356 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.uprn_match"
[0m14:29:22.642126 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_addressid (compile): 14:29:22.633897 => 14:29:22.641930
[0m14:29:22.642457 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.dim_uprn (compile): 14:29:22.636993 => 14:29:22.642292
[0m14:29:22.642790 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.uprn_match (compile): 14:29:22.639238 => 14:29:22.642619
[0m14:29:22.643052 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.dim_addressid
[0m14:29:22.643315 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.dim_uprn
[0m14:29:22.643560 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.uprn_match
[0m14:29:22.646148 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.dim_addressid"
[0m14:29:22.648283 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.dim_uprn"
[0m14:29:22.650360 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.uprn_match"
[0m14:29:22.651486 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.dim_addressid"
[0m14:29:22.652171 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.dim_uprn"
[0m14:29:22.652498 [debug] [Thread-4 (]: On model.rightmove_epc.dim_addressid: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_addressid"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
  
   as (
    with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource,
    POSTCODE

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where uprn is null
and addressid is not null
  );
[0m14:29:22.653280 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.uprn_match"
[0m14:29:22.653587 [debug] [Thread-3 (]: On model.rightmove_epc.dim_uprn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_uprn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
  
   as (
    with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource,
    POSTCODE

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where uprn is not null
  );
[0m14:29:22.653858 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m14:29:22.654101 [debug] [Thread-2 (]: On model.rightmove_epc.uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
  
   as (
    with epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    where uprn is not null

),

rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where uprn is not null
),

final as (

    select 
    LISTING_ID,
    rm.ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    rm.UPRN,
    rm.LOCAL_AUTHORITY_CODE,
    rm.LOCAL_AUTHORITY,
    rm.GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    epc.UPRN AS EPC_UPRN,
    epc.TOTAL_FLOOR_AREA,
    epc.ADDRESSID as EPC_ADDRESSID,
    CASE WHEN epc.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC    
    
     from rm left join epc on rm.uprn = epc.uprn
)

select * from final
  );
[0m14:29:22.654352 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m14:29:22.655025 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m14:29:23.147667 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m14:29:23.150905 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.uprn_match (execute): 14:29:22.648498 => 14:29:23.150659
[0m14:29:23.151347 [debug] [Thread-2 (]: On model.rightmove_epc.uprn_match: Close
[0m14:29:23.274272 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'df8c5233-cfd3-4fa7-8bfa-3798d2bfa49d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a3cae90>]}
[0m14:29:23.275241 [info ] [Thread-2 (]: 5 of 9 OK created sql view model dbt_melissa_rm_epc.uprn_match ................. [[32mSUCCESS 1[0m in 0.64s]
[0m14:29:23.275995 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.uprn_match
[0m14:29:23.276782 [debug] [Thread-1 (]: Began running node model.rightmove_epc.no_uprn_match
[0m14:29:23.277327 [info ] [Thread-1 (]: 6 of 9 START sql view model dbt_melissa_rm_epc.no_uprn_match ................... [RUN]
[0m14:29:23.278123 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_epc_certs, now model.rightmove_epc.no_uprn_match)
[0m14:29:23.278541 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.no_uprn_match
[0m14:29:23.282593 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.no_uprn_match"
[0m14:29:23.283459 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.no_uprn_match (compile): 14:29:23.278784 => 14:29:23.283263
[0m14:29:23.283793 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.no_uprn_match
[0m14:29:23.288693 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.no_uprn_match"
[0m14:29:23.290165 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.no_uprn_match"
[0m14:29:23.290605 [debug] [Thread-1 (]: On model.rightmove_epc.no_uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.no_uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.no_uprn_match
  
   as (
    with rm_no_match_to_epc  as ( -- rightmove uspn does not match epc

    select 
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL

     from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'NO'
    
)

select * from rm_no_match_to_epc

/*
epc_remove as (

    select EPC_UPRN,EPC_ADDRESSID from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'YES'  -- 
),

epc_matched as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs src
    left join epc_remove rem on src.UPRN = rem.EPC_UPRN
    
),

epc_fm_prep as (

    select * from epc_matched
    where EPC_UPRN is NULL

    
)


SELECT * FROM epc_fm_prep
WHERE UPRN NOT NULL */
  );
[0m14:29:23.290942 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:29:23.292667 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:29:23.295153 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.dim_uprn (execute): 14:29:22.646327 => 14:29:23.294984
[0m14:29:23.295670 [debug] [Thread-3 (]: On model.rightmove_epc.dim_uprn: Close
[0m14:29:23.333727 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:29:23.335417 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_addressid (execute): 14:29:22.643721 => 14:29:23.335296
[0m14:29:23.335651 [debug] [Thread-4 (]: On model.rightmove_epc.dim_addressid: Close
[0m14:29:23.383487 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'df8c5233-cfd3-4fa7-8bfa-3798d2bfa49d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a4f6550>]}
[0m14:29:23.384005 [info ] [Thread-3 (]: 4 of 9 OK created sql view model dbt_melissa_rm_epc.dim_uprn ................... [[32mSUCCESS 1[0m in 0.75s]
[0m14:29:23.384367 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.dim_uprn
[0m14:29:23.494600 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'df8c5233-cfd3-4fa7-8bfa-3798d2bfa49d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a4fe1d0>]}
[0m14:29:23.495297 [info ] [Thread-4 (]: 3 of 9 OK created sql view model dbt_melissa_rm_epc.dim_addressid .............. [[32mSUCCESS 1[0m in 0.86s]
[0m14:29:23.495773 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.dim_addressid
[0m14:29:23.496310 [debug] [Thread-2 (]: Began running node model.rightmove_epc.address_match
[0m14:29:23.496662 [debug] [Thread-3 (]: Began running node model.rightmove_epc.address_simularity
[0m14:29:23.497060 [info ] [Thread-2 (]: 7 of 9 START sql view model dbt_melissa_rm_epc.address_match ................... [RUN]
[0m14:29:23.497444 [info ] [Thread-3 (]: 8 of 9 START sql view model dbt_melissa_rm_epc.address_simularity .............. [RUN]
[0m14:29:23.498046 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.uprn_match, now model.rightmove_epc.address_match)
[0m14:29:23.498569 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.dim_uprn, now model.rightmove_epc.address_simularity)
[0m14:29:23.498890 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.address_match
[0m14:29:23.499199 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.address_simularity
[0m14:29:23.501826 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.address_match"
[0m14:29:23.504763 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.address_simularity"
[0m14:29:23.505596 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.address_match (compile): 14:29:23.499425 => 14:29:23.505382
[0m14:29:23.506001 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.address_match
[0m14:29:23.506399 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.address_simularity (compile): 14:29:23.502135 => 14:29:23.506207
[0m14:29:23.509202 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.address_match"
[0m14:29:23.509592 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.address_simularity
[0m14:29:23.512026 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.address_simularity"
[0m14:29:23.512969 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.address_match"
[0m14:29:23.513341 [debug] [Thread-2 (]: On model.rightmove_epc.address_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.address_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NULL
),

epc_address as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
    where datasource = 'EPC'
)


SELECT rm.*,
epc_address.addressid
as EPC_ADDRESSID,
CASE WHEN epc_address.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC    

FROM rm
LEFT JOIN epc_address
ON rm.addressid = epc_address.addressid
and rm.FULL_POSTCODE = epc_address.POSTCODE
  );
[0m14:29:23.513697 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m14:29:23.514787 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.address_simularity"
[0m14:29:23.515421 [debug] [Thread-3 (]: On model.rightmove_epc.address_simularity: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.address_simularity"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.address_simularity
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NULL
),

epc_address as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
    where datasource = 'EPC'
)


SELECT rm.*,epc_address.addressid as EPC_ADDRESSID
FROM rm
JOIN epc_address
ON JAROWINKLER_SIMILARITY(rm.addressid, epc_address.addressid) = 1
  );
[0m14:29:23.515739 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m14:29:23.815740 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:29:23.819548 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.no_uprn_match (execute): 14:29:23.283991 => 14:29:23.819256
[0m14:29:23.820118 [debug] [Thread-1 (]: On model.rightmove_epc.no_uprn_match: Close
[0m14:29:23.913670 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'df8c5233-cfd3-4fa7-8bfa-3798d2bfa49d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a127310>]}
[0m14:29:23.914708 [info ] [Thread-1 (]: 6 of 9 OK created sql view model dbt_melissa_rm_epc.no_uprn_match .............. [[32mSUCCESS 1[0m in 0.64s]
[0m14:29:23.915525 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.no_uprn_match
[0m14:29:24.014260 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:29:24.016183 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.address_match (execute): 14:29:23.506621 => 14:29:24.016043
[0m14:29:24.016446 [debug] [Thread-2 (]: On model.rightmove_epc.address_match: Close
[0m14:29:24.096885 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'df8c5233-cfd3-4fa7-8bfa-3798d2bfa49d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a4f4490>]}
[0m14:29:24.097494 [info ] [Thread-2 (]: 7 of 9 OK created sql view model dbt_melissa_rm_epc.address_match .............. [[32mSUCCESS 1[0m in 0.60s]
[0m14:29:24.097967 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.address_match
[0m14:29:24.098453 [debug] [Thread-4 (]: Began running node model.rightmove_epc.no_matches
[0m14:29:24.098794 [info ] [Thread-4 (]: 9 of 9 START sql view model dbt_melissa_rm_epc.no_matches ...................... [RUN]
[0m14:29:24.099266 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.dim_addressid, now model.rightmove_epc.no_matches)
[0m14:29:24.099518 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.no_matches
[0m14:29:24.101844 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.no_matches"
[0m14:29:24.102479 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.no_matches (compile): 14:29:24.099671 => 14:29:24.102333
[0m14:29:24.102741 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.no_matches
[0m14:29:24.105564 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.no_matches"
[0m14:29:24.106803 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.no_matches"
[0m14:29:24.107101 [debug] [Thread-4 (]: On model.rightmove_epc.no_matches: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.no_matches"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.no_matches
  
   as (
    with addr as (

    select 
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    '' AS EPC_UPRN,
    EPC_ADDRESSID
    
    from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
    where MATCH_EPC = 'NO' 
),

uprn as (

    select 
    
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN::VARCHAR AS EPC_UPRN,
    EPC_ADDRESSID
    
     from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'NO'
),

final as (

select * from addr
union all
select * from uprn
)

select * from final
  );
[0m14:29:24.107361 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m14:29:24.111095 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:29:24.113291 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.address_simularity (execute): 14:29:23.509958 => 14:29:24.113127
[0m14:29:24.113647 [debug] [Thread-3 (]: On model.rightmove_epc.address_simularity: Close
[0m14:29:24.189076 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'df8c5233-cfd3-4fa7-8bfa-3798d2bfa49d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a1951d0>]}
[0m14:29:24.189581 [info ] [Thread-3 (]: 8 of 9 OK created sql view model dbt_melissa_rm_epc.address_simularity ......... [[32mSUCCESS 1[0m in 0.69s]
[0m14:29:24.189983 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.address_simularity
[0m14:29:24.655837 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:29:24.659342 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.no_matches (execute): 14:29:24.102907 => 14:29:24.659091
[0m14:29:24.659835 [debug] [Thread-4 (]: On model.rightmove_epc.no_matches: Close
[0m14:29:24.746236 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'df8c5233-cfd3-4fa7-8bfa-3798d2bfa49d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a26ae90>]}
[0m14:29:24.747427 [info ] [Thread-4 (]: 9 of 9 OK created sql view model dbt_melissa_rm_epc.no_matches ................. [[32mSUCCESS 1[0m in 0.65s]
[0m14:29:24.748276 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.no_matches
[0m14:29:24.750609 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:29:24.751003 [debug] [MainThread]: Connection 'model.rightmove_epc.no_uprn_match' was properly closed.
[0m14:29:24.751323 [debug] [MainThread]: Connection 'model.rightmove_epc.address_match' was properly closed.
[0m14:29:24.751617 [debug] [MainThread]: Connection 'model.rightmove_epc.no_matches' was properly closed.
[0m14:29:24.751908 [debug] [MainThread]: Connection 'model.rightmove_epc.address_simularity' was properly closed.
[0m14:29:24.752303 [info ] [MainThread]: 
[0m14:29:24.752782 [info ] [MainThread]: Finished running 9 view models in 0 hours 0 minutes and 3.89 seconds (3.89s).
[0m14:29:24.754442 [debug] [MainThread]: Command end result
[0m14:29:24.764258 [info ] [MainThread]: 
[0m14:29:24.764648 [info ] [MainThread]: [32mCompleted successfully[0m
[0m14:29:24.764921 [info ] [MainThread]: 
[0m14:29:24.765186 [info ] [MainThread]: Done. PASS=9 WARN=0 ERROR=0 SKIP=0 TOTAL=9
[0m14:29:24.767409 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.208415, "process_user_time": 1.675257, "process_kernel_time": 0.206924, "process_mem_max_rss": "139509760", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:29:24.767981 [debug] [MainThread]: Command `dbt run` succeeded at 14:29:24.767853 after 4.21 seconds
[0m14:29:24.768313 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a194110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a2b4290>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104d92190>]}
[0m14:29:24.768604 [debug] [MainThread]: Flushing usage events
[0m14:31:21.711493 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x121218f90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12125e7d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12125f310>]}


============================== 14:31:21.715201 | fda06921-363e-424a-8833-80ba1a4c02d6 ==============================
[0m14:31:21.715201 [info ] [MainThread]: Running with dbt=1.7.10
[0m14:31:21.715630 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --select rightmove_epc/models/matching/no_matches.sql', 'send_anonymous_usage_stats': 'True'}
[0m14:31:21.912530 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fda06921-363e-424a-8833-80ba1a4c02d6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x122db1610>]}
[0m14:31:21.953574 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'fda06921-363e-424a-8833-80ba1a4c02d6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x122d33350>]}
[0m14:31:21.954621 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m14:31:21.965071 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m14:31:21.989587 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:31:21.989897 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:31:21.993602 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'fda06921-363e-424a-8833-80ba1a4c02d6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x122e0b8d0>]}
[0m14:31:22.000538 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'fda06921-363e-424a-8833-80ba1a4c02d6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x122e8bd50>]}
[0m14:31:22.000856 [info ] [MainThread]: Found 9 models, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m14:31:22.001080 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fda06921-363e-424a-8833-80ba1a4c02d6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x122e67750>]}
[0m14:31:22.001619 [warn ] [MainThread]: The selection criterion 'rightmove_epc/models/matching/no_matches.sql' does not match any nodes
[0m14:31:22.002222 [info ] [MainThread]: 
[0m14:31:22.002404 [warn ] [MainThread]: Nothing to do. Try checking your model configs and model specification args
[0m14:31:22.002681 [debug] [MainThread]: Command end result
[0m14:31:22.008132 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.3274135, "process_user_time": 1.109909, "process_kernel_time": 0.147702, "process_mem_max_rss": "124469248", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:31:22.008559 [debug] [MainThread]: Command `dbt run` succeeded at 14:31:22.008480 after 0.33 seconds
[0m14:31:22.008824 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x121287150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103686150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1037d9fd0>]}
[0m14:31:22.009033 [debug] [MainThread]: Flushing usage events
[0m14:31:48.280402 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108b56550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108b9a650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108b9b1d0>]}


============================== 14:31:48.283470 | 8756fa46-5b10-4893-a9ab-aeae8366574d ==============================
[0m14:31:48.283470 [info ] [MainThread]: Running with dbt=1.7.10
[0m14:31:48.283869 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'debug': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --select models/matching/no_matches.sql', 'send_anonymous_usage_stats': 'True'}
[0m14:31:48.470387 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8756fa46-5b10-4893-a9ab-aeae8366574d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ab5db10>]}
[0m14:31:48.510933 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8756fa46-5b10-4893-a9ab-aeae8366574d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a9afe50>]}
[0m14:31:48.511981 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m14:31:48.521908 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m14:31:48.547163 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:31:48.547478 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:31:48.551222 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8756fa46-5b10-4893-a9ab-aeae8366574d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108b3d950>]}
[0m14:31:48.558277 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8756fa46-5b10-4893-a9ab-aeae8366574d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ac00f50>]}
[0m14:31:48.558581 [info ] [MainThread]: Found 9 models, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m14:31:48.558813 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8756fa46-5b10-4893-a9ab-aeae8366574d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ac63750>]}
[0m14:31:48.559867 [info ] [MainThread]: 
[0m14:31:48.560299 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m14:31:48.560905 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m14:31:48.568696 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m14:31:48.569055 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m14:31:48.569244 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:31:49.141201 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 1.0 seconds
[0m14:31:49.143446 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m14:31:49.225520 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m14:31:49.234490 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m14:31:49.234939 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m14:31:49.235261 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:31:49.579644 [debug] [ThreadPool]: SQL status: SUCCESS 10 in 0.0 seconds
[0m14:31:49.581545 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m14:31:49.664883 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8756fa46-5b10-4893-a9ab-aeae8366574d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108bc3290>]}
[0m14:31:49.665642 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:31:49.665939 [info ] [MainThread]: 
[0m14:31:49.668791 [debug] [Thread-1 (]: Began running node model.rightmove_epc.no_matches
[0m14:31:49.669182 [info ] [Thread-1 (]: 1 of 1 START sql view model dbt_melissa_rm_epc.no_matches ...................... [RUN]
[0m14:31:49.669722 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.no_matches)
[0m14:31:49.670012 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.no_matches
[0m14:31:49.675995 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.no_matches"
[0m14:31:49.676772 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.no_matches (compile): 14:31:49.670186 => 14:31:49.676592
[0m14:31:49.677070 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.no_matches
[0m14:31:49.696383 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.no_matches"
[0m14:31:49.697568 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.no_matches"
[0m14:31:49.697836 [debug] [Thread-1 (]: On model.rightmove_epc.no_matches: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.no_matches"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.no_matches
  
   as (
    with addr as (

    select 
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    '' AS EPC_UPRN,
    EPC_ADDRESSID
    
    from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
    where MATCH_EPC = 'NO' 
),

uprn as (

    select 
    
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN::VARCHAR AS EPC_UPRN,
    EPC_ADDRESSID
    
     from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'NO'
),

final as (

select 'NO ADDRESS OR UPRN MATCH' AS MATCH_RESULT, * from addr
union all
select 'NO UPRN MATCH' AS MATCH_RESULT, * from uprn
)

select * from final
  );
[0m14:31:49.698066 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:31:50.581510 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:31:50.623870 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.no_matches (execute): 14:31:49.677227 => 14:31:50.623738
[0m14:31:50.624165 [debug] [Thread-1 (]: On model.rightmove_epc.no_matches: Close
[0m14:31:50.728850 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8756fa46-5b10-4893-a9ab-aeae8366574d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ab1fbd0>]}
[0m14:31:50.729384 [info ] [Thread-1 (]: 1 of 1 OK created sql view model dbt_melissa_rm_epc.no_matches ................. [[32mSUCCESS 1[0m in 1.06s]
[0m14:31:50.729776 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.no_matches
[0m14:31:50.730873 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:31:50.731112 [debug] [MainThread]: Connection 'model.rightmove_epc.no_matches' was properly closed.
[0m14:31:50.731331 [info ] [MainThread]: 
[0m14:31:50.731547 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 2.17 seconds (2.17s).
[0m14:31:50.731929 [debug] [MainThread]: Command end result
[0m14:31:50.737089 [info ] [MainThread]: 
[0m14:31:50.737366 [info ] [MainThread]: [32mCompleted successfully[0m
[0m14:31:50.737553 [info ] [MainThread]: 
[0m14:31:50.737744 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m14:31:50.739404 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 2.4972281, "process_user_time": 1.316637, "process_kernel_time": 0.166797, "process_mem_max_rss": "132890624", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:31:50.739768 [debug] [MainThread]: Command `dbt run` succeeded at 14:31:50.739692 after 2.50 seconds
[0m14:31:50.739997 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1034d2150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103625e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103625f90>]}
[0m14:31:50.740220 [debug] [MainThread]: Flushing usage events
[0m15:31:36.036195 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109a02a90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109a5e7d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109a5f310>]}


============================== 15:31:36.039140 | 35087da0-06d7-4028-a1ad-73ed0d966899 ==============================
[0m15:31:36.039140 [info ] [MainThread]: Running with dbt=1.7.10
[0m15:31:36.039511 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/Users/melissabee/.dbt', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt run', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m15:31:36.230585 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '35087da0-06d7-4028-a1ad-73ed0d966899', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a4bd810>]}
[0m15:31:36.270610 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '35087da0-06d7-4028-a1ad-73ed0d966899', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109a37510>]}
[0m15:31:36.271307 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m15:31:36.280715 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m15:31:36.300476 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:31:36.300927 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:31:36.305047 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '35087da0-06d7-4028-a1ad-73ed0d966899', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a793fd0>]}
[0m15:31:36.313091 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '35087da0-06d7-4028-a1ad-73ed0d966899', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a5dcf90>]}
[0m15:31:36.313432 [info ] [MainThread]: Found 9 models, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m15:31:36.313665 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '35087da0-06d7-4028-a1ad-73ed0d966899', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a41b950>]}
[0m15:31:36.314875 [info ] [MainThread]: 
[0m15:31:36.315345 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m15:31:36.316148 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m15:31:36.323488 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m15:31:36.323827 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m15:31:36.324024 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:31:36.829531 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 1.0 seconds
[0m15:31:36.832938 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m15:31:36.976436 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m15:31:36.984382 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m15:31:36.984764 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m15:31:36.985031 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:31:37.457523 [debug] [ThreadPool]: SQL status: SUCCESS 10 in 0.0 seconds
[0m15:31:37.459738 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m15:31:37.541249 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '35087da0-06d7-4028-a1ad-73ed0d966899', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a71b250>]}
[0m15:31:37.542135 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m15:31:37.542489 [info ] [MainThread]: 
[0m15:31:37.544917 [debug] [Thread-1 (]: Began running node model.rightmove_epc.stg_epc_certs
[0m15:31:37.545313 [debug] [Thread-2 (]: Began running node model.rightmove_epc.stg_rightmove
[0m15:31:37.545816 [info ] [Thread-1 (]: 1 of 9 START sql view model dbt_melissa_rm_epc.stg_epc_certs ................... [RUN]
[0m15:31:37.546259 [info ] [Thread-2 (]: 2 of 9 START sql view model dbt_melissa_rm_epc.stg_rightmove ................... [RUN]
[0m15:31:37.546861 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.stg_epc_certs)
[0m15:31:37.547452 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.stg_rightmove'
[0m15:31:37.547754 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.stg_epc_certs
[0m15:31:37.548104 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.stg_rightmove
[0m15:31:37.554778 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.stg_epc_certs"
[0m15:31:37.557179 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.stg_rightmove"
[0m15:31:37.558278 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (compile): 15:31:37.548375 => 15:31:37.558071
[0m15:31:37.558609 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (compile): 15:31:37.555050 => 15:31:37.558445
[0m15:31:37.558900 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.stg_epc_certs
[0m15:31:37.559202 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.stg_rightmove
[0m15:31:37.578362 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.stg_epc_certs"
[0m15:31:37.612732 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.stg_rightmove"
[0m15:31:37.613822 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.stg_epc_certs"
[0m15:31:37.614349 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.stg_rightmove"
[0m15:31:37.614611 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_epc_certs"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
  
   as (
    WITH epc_certs as (
    
    select 
    UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    COUNTY,
    LOCAL_AUTHORITY as LOCAL_AUTHORITY_CODE,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    UPPER(CASE WHEN (UPPER(ADDRESS1) LIKE 'FLAT%' OR UPPER(ADDRESS1) LIKE 'UNIT%') or UPPER(ADDRESS1) LIKE 'ROOM%' 
    THEN TRIM(REPLACE(REPLACE(CONCAT(ADDRESS1,ADDRESS2,ADDRESS3),','),' '))
    ELSE trim(replace(replace(ADDRESS1,' '),',')) END) AS ADDRESSID
 from  RAW.EPC_TEST_DATA.EPC_CERTIFICATES 

)

SELECT * FROM epc_certs
  );
[0m15:31:37.614864 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_rightmove"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
  
   as (
    with rm as (

    SELECT 
    LISTING_ID,
    UPPER(TRIM(replace(REPLACE(CONCAT(ADDRESS_1::VARCHAR,ADDRESS_2::VARCHAR),' '),','))) AS ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL 
    FROM 
       ANALYTICS.RIGHTMOVE_PROD.CLEAN_RAW_RIGHTMOVE_DATA 

 
)

SELECT * FROM rm
  );
[0m15:31:37.615078 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:31:37.615259 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m15:31:38.321660 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m15:31:38.338475 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (execute): 15:31:37.559393 => 15:31:38.338308
[0m15:31:38.338822 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: Close
[0m15:31:38.421842 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '35087da0-06d7-4028-a1ad-73ed0d966899', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108cb6490>]}
[0m15:31:38.422522 [info ] [Thread-1 (]: 1 of 9 OK created sql view model dbt_melissa_rm_epc.stg_epc_certs .............. [[32mSUCCESS 1[0m in 0.88s]
[0m15:31:38.423012 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.stg_epc_certs
[0m15:31:38.440505 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m15:31:38.442746 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (execute): 15:31:37.578553 => 15:31:38.442585
[0m15:31:38.443063 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: Close
[0m15:31:38.534024 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '35087da0-06d7-4028-a1ad-73ed0d966899', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109a96f50>]}
[0m15:31:38.534636 [info ] [Thread-2 (]: 2 of 9 OK created sql view model dbt_melissa_rm_epc.stg_rightmove .............. [[32mSUCCESS 1[0m in 0.99s]
[0m15:31:38.535100 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.stg_rightmove
[0m15:31:38.535755 [debug] [Thread-4 (]: Began running node model.rightmove_epc.dim_addressid
[0m15:31:38.536082 [debug] [Thread-3 (]: Began running node model.rightmove_epc.dim_uprn
[0m15:31:38.536364 [info ] [Thread-4 (]: 3 of 9 START sql view model dbt_melissa_rm_epc.dim_addressid ................... [RUN]
[0m15:31:38.536682 [debug] [Thread-1 (]: Began running node model.rightmove_epc.uprn_match
[0m15:31:38.537041 [info ] [Thread-3 (]: 4 of 9 START sql view model dbt_melissa_rm_epc.dim_uprn ........................ [RUN]
[0m15:31:38.537614 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_addressid'
[0m15:31:38.537927 [info ] [Thread-1 (]: 5 of 9 START sql view model dbt_melissa_rm_epc.uprn_match ...................... [RUN]
[0m15:31:38.538452 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_uprn'
[0m15:31:38.538721 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.dim_addressid
[0m15:31:38.539156 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_epc_certs, now model.rightmove_epc.uprn_match)
[0m15:31:38.539418 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.dim_uprn
[0m15:31:38.541977 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.dim_addressid"
[0m15:31:38.542283 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.uprn_match
[0m15:31:38.544263 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.dim_uprn"
[0m15:31:38.546365 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.uprn_match"
[0m15:31:38.546995 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_addressid (compile): 15:31:38.539575 => 15:31:38.546802
[0m15:31:38.547434 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.dim_uprn (compile): 15:31:38.542450 => 15:31:38.547266
[0m15:31:38.547695 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.dim_addressid
[0m15:31:38.547973 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.uprn_match (compile): 15:31:38.544532 => 15:31:38.547843
[0m15:31:38.548218 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.dim_uprn
[0m15:31:38.550613 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.dim_addressid"
[0m15:31:38.550887 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.uprn_match
[0m15:31:38.552968 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.dim_uprn"
[0m15:31:38.554921 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.uprn_match"
[0m15:31:38.555715 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.dim_addressid"
[0m15:31:38.556036 [debug] [Thread-4 (]: On model.rightmove_epc.dim_addressid: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_addressid"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
  
   as (
    with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource,
    POSTCODE,
    TOTAL_FLOOR_AREA

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE,
    NULL AS TOTAL_FLOOR_AREA
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where uprn is null
and addressid is not null
  );
[0m15:31:38.556341 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m15:31:38.556954 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.dim_uprn"
[0m15:31:38.557598 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.uprn_match"
[0m15:31:38.558480 [debug] [Thread-3 (]: On model.rightmove_epc.dim_uprn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_uprn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
  
   as (
    with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource,
    POSTCODE

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where uprn is not null
  );
[0m15:31:38.558803 [debug] [Thread-1 (]: On model.rightmove_epc.uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
  
   as (
    with epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    where uprn is not null

),

rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where uprn is not null
),

final as (

    select 
    LISTING_ID,
    rm.ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    rm.UPRN,
    rm.LOCAL_AUTHORITY_CODE,
    rm.LOCAL_AUTHORITY,
    rm.GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    epc.UPRN AS EPC_UPRN,
    epc.TOTAL_FLOOR_AREA,
    epc.ADDRESSID as EPC_ADDRESSID,
    CASE WHEN epc.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC    
    
     from rm left join epc on rm.uprn = epc.uprn
)

select * from final
  );
[0m15:31:38.559054 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m15:31:38.559253 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:31:39.098656 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m15:31:39.101835 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.uprn_match (execute): 15:31:38.553189 => 15:31:39.101590
[0m15:31:39.102280 [debug] [Thread-1 (]: On model.rightmove_epc.uprn_match: Close
[0m15:31:39.113060 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m15:31:39.115831 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_addressid (execute): 15:31:38.548369 => 15:31:39.115614
[0m15:31:39.116247 [debug] [Thread-4 (]: On model.rightmove_epc.dim_addressid: Close
[0m15:31:39.198703 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '35087da0-06d7-4028-a1ad-73ed0d966899', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a58cad0>]}
[0m15:31:39.199494 [info ] [Thread-1 (]: 5 of 9 OK created sql view model dbt_melissa_rm_epc.uprn_match ................. [[32mSUCCESS 1[0m in 0.66s]
[0m15:31:39.200133 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.uprn_match
[0m15:31:39.200771 [debug] [Thread-2 (]: Began running node model.rightmove_epc.no_uprn_match
[0m15:31:39.201325 [info ] [Thread-2 (]: 6 of 9 START sql view model dbt_melissa_rm_epc.no_uprn_match ................... [RUN]
[0m15:31:39.202059 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_rightmove, now model.rightmove_epc.no_uprn_match)
[0m15:31:39.202416 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.no_uprn_match
[0m15:31:39.205522 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.no_uprn_match"
[0m15:31:39.206342 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.no_uprn_match (compile): 15:31:39.202626 => 15:31:39.206144
[0m15:31:39.206677 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.no_uprn_match
[0m15:31:39.211506 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.no_uprn_match"
[0m15:31:39.212710 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.no_uprn_match"
[0m15:31:39.213081 [debug] [Thread-2 (]: On model.rightmove_epc.no_uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.no_uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.no_uprn_match
  
   as (
    with rm_no_match_to_epc  as ( -- rightmove uspn does not match epc

    select 
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL

     from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'NO'
    
)

select * from rm_no_match_to_epc

/*
epc_remove as (

    select EPC_UPRN,EPC_ADDRESSID from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'YES'  -- 
),

epc_matched as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs src
    left join epc_remove rem on src.UPRN = rem.EPC_UPRN
    
),

epc_fm_prep as (

    select * from epc_matched
    where EPC_UPRN is NULL

    
)


SELECT * FROM epc_fm_prep
WHERE UPRN NOT NULL */
  );
[0m15:31:39.213441 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m15:31:39.215161 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m15:31:39.217126 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.dim_uprn (execute): 15:31:38.551054 => 15:31:39.216980
[0m15:31:39.217402 [debug] [Thread-3 (]: On model.rightmove_epc.dim_uprn: Close
[0m15:31:39.222798 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '35087da0-06d7-4028-a1ad-73ed0d966899', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a9de690>]}
[0m15:31:39.223265 [info ] [Thread-4 (]: 3 of 9 OK created sql view model dbt_melissa_rm_epc.dim_addressid .............. [[32mSUCCESS 1[0m in 0.69s]
[0m15:31:39.223679 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.dim_addressid
[0m15:31:39.224102 [debug] [Thread-1 (]: Began running node model.rightmove_epc.address_match
[0m15:31:39.224368 [debug] [Thread-4 (]: Began running node model.rightmove_epc.address_simularity
[0m15:31:39.224680 [info ] [Thread-1 (]: 7 of 9 START sql view model dbt_melissa_rm_epc.address_match ................... [RUN]
[0m15:31:39.225050 [info ] [Thread-4 (]: 8 of 9 START sql view model dbt_melissa_rm_epc.address_simularity .............. [RUN]
[0m15:31:39.225597 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.uprn_match, now model.rightmove_epc.address_match)
[0m15:31:39.226052 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.dim_addressid, now model.rightmove_epc.address_simularity)
[0m15:31:39.226317 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.address_match
[0m15:31:39.226574 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.address_simularity
[0m15:31:39.228839 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.address_match"
[0m15:31:39.230741 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.address_simularity"
[0m15:31:39.231371 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.address_simularity (compile): 15:31:39.229013 => 15:31:39.231230
[0m15:31:39.231649 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.address_match (compile): 15:31:39.226733 => 15:31:39.231516
[0m15:31:39.231862 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.address_simularity
[0m15:31:39.232091 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.address_match
[0m15:31:39.234194 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.address_simularity"
[0m15:31:39.236310 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.address_match"
[0m15:31:39.237239 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.address_match"
[0m15:31:39.237478 [debug] [Thread-1 (]: On model.rightmove_epc.address_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.address_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NULL
),

epc_address as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
    where datasource = 'EPC'
)


SELECT rm.*,
epc_address.addressid
as EPC_ADDRESSID,
CASE WHEN epc_address.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC    

FROM rm
LEFT JOIN epc_address
ON rm.addressid = epc_address.addressid
and rm.FULL_POSTCODE = epc_address.POSTCODE
  );
[0m15:31:39.238000 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.address_simularity"
[0m15:31:39.238231 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:31:39.238478 [debug] [Thread-4 (]: On model.rightmove_epc.address_simularity: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.address_simularity"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.address_simularity
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NULL
),

epc_address as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
    where datasource = 'EPC'
)


SELECT rm.*,epc_address.addressid as EPC_ADDRESSID
FROM rm
JOIN epc_address
ON JAROWINKLER_SIMILARITY(rm.addressid, epc_address.addressid) = 1
  );
[0m15:31:39.239068 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m15:31:39.301991 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '35087da0-06d7-4028-a1ad-73ed0d966899', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a7a06d0>]}
[0m15:31:39.302452 [info ] [Thread-3 (]: 4 of 9 OK created sql view model dbt_melissa_rm_epc.dim_uprn ................... [[32mSUCCESS 1[0m in 0.76s]
[0m15:31:39.302775 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.dim_uprn
[0m15:31:39.792563 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m15:31:39.793353 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m15:31:39.793900 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m15:31:39.796231 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.no_uprn_match (execute): 15:31:39.206870 => 15:31:39.796061
[0m15:31:39.798172 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.address_match (execute): 15:31:39.234361 => 15:31:39.798015
[0m15:31:39.799928 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.address_simularity (execute): 15:31:39.232231 => 15:31:39.799791
[0m15:31:39.800220 [debug] [Thread-2 (]: On model.rightmove_epc.no_uprn_match: Close
[0m15:31:39.800479 [debug] [Thread-1 (]: On model.rightmove_epc.address_match: Close
[0m15:31:39.800724 [debug] [Thread-4 (]: On model.rightmove_epc.address_simularity: Close
[0m15:31:39.878626 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '35087da0-06d7-4028-a1ad-73ed0d966899', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a9fe790>]}
[0m15:31:39.879217 [info ] [Thread-4 (]: 8 of 9 OK created sql view model dbt_melissa_rm_epc.address_simularity ......... [[32mSUCCESS 1[0m in 0.65s]
[0m15:31:39.879703 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.address_simularity
[0m15:31:39.888796 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '35087da0-06d7-4028-a1ad-73ed0d966899', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a9cc8d0>]}
[0m15:31:39.889473 [info ] [Thread-1 (]: 7 of 9 OK created sql view model dbt_melissa_rm_epc.address_match .............. [[32mSUCCESS 1[0m in 0.66s]
[0m15:31:39.889959 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.address_match
[0m15:31:39.890506 [debug] [Thread-3 (]: Began running node model.rightmove_epc.no_matches
[0m15:31:39.890955 [info ] [Thread-3 (]: 9 of 9 START sql view model dbt_melissa_rm_epc.no_matches ...................... [RUN]
[0m15:31:39.891559 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.dim_uprn, now model.rightmove_epc.no_matches)
[0m15:31:39.891831 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.no_matches
[0m15:31:39.894771 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.no_matches"
[0m15:31:39.895491 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.no_matches (compile): 15:31:39.891994 => 15:31:39.895328
[0m15:31:39.895763 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.no_matches
[0m15:31:39.898235 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.no_matches"
[0m15:31:39.899850 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.no_matches"
[0m15:31:39.900156 [debug] [Thread-3 (]: On model.rightmove_epc.no_matches: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.no_matches"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.no_matches
  
   as (
    with addr as (

    select 
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    '' AS EPC_UPRN,
    EPC_ADDRESSID
    
    from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
    where MATCH_EPC = 'NO' 
),

uprn as (

    select 
    
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN::VARCHAR AS EPC_UPRN,
    EPC_ADDRESSID
    
     from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'NO'
),

final as (

select 'NO ADDRESS OR UPRN MATCH' AS MATCH_RESULT, * from addr
union all
select 'NO UPRN MATCH' AS MATCH_RESULT, * from uprn
)

select * from final
  );
[0m15:31:39.900724 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '35087da0-06d7-4028-a1ad-73ed0d966899', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ac36850>]}
[0m15:31:39.901019 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m15:31:39.901397 [info ] [Thread-2 (]: 6 of 9 OK created sql view model dbt_melissa_rm_epc.no_uprn_match .............. [[32mSUCCESS 1[0m in 0.70s]
[0m15:31:39.902182 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.no_uprn_match
[0m15:31:40.609689 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m15:31:40.616532 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.no_matches (execute): 15:31:39.895921 => 15:31:40.616307
[0m15:31:40.616985 [debug] [Thread-3 (]: On model.rightmove_epc.no_matches: Close
[0m15:31:40.703193 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '35087da0-06d7-4028-a1ad-73ed0d966899', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ac1c0d0>]}
[0m15:31:40.704175 [info ] [Thread-3 (]: 9 of 9 OK created sql view model dbt_melissa_rm_epc.no_matches ................. [[32mSUCCESS 1[0m in 0.81s]
[0m15:31:40.705015 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.no_matches
[0m15:31:40.707619 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:31:40.708070 [debug] [MainThread]: Connection 'model.rightmove_epc.address_match' was properly closed.
[0m15:31:40.708404 [debug] [MainThread]: Connection 'model.rightmove_epc.no_uprn_match' was properly closed.
[0m15:31:40.708708 [debug] [MainThread]: Connection 'model.rightmove_epc.address_simularity' was properly closed.
[0m15:31:40.709013 [debug] [MainThread]: Connection 'model.rightmove_epc.no_matches' was properly closed.
[0m15:31:40.709413 [info ] [MainThread]: 
[0m15:31:40.709789 [info ] [MainThread]: Finished running 9 view models in 0 hours 0 minutes and 4.39 seconds (4.39s).
[0m15:31:40.711531 [debug] [MainThread]: Command end result
[0m15:31:40.722396 [info ] [MainThread]: 
[0m15:31:40.722816 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:31:40.723098 [info ] [MainThread]: 
[0m15:31:40.723366 [info ] [MainThread]: Done. PASS=9 WARN=0 ERROR=0 SKIP=0 TOTAL=9
[0m15:31:40.725501 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.720117, "process_user_time": 1.63937, "process_kernel_time": 0.192734, "process_mem_max_rss": "137904128", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m15:31:40.726040 [debug] [MainThread]: Command `dbt run` succeeded at 15:31:40.725935 after 4.72 seconds
[0m15:31:40.726372 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105706110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105841cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1056ee710>]}
[0m15:31:40.726697 [debug] [MainThread]: Flushing usage events
[0m15:34:17.645951 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113d530d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113d5e450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113d5efd0>]}


============================== 15:34:17.649336 | 35763348-d140-4b96-9c80-b816d4fd69f6 ==============================
[0m15:34:17.649336 [info ] [MainThread]: Running with dbt=1.7.10
[0m15:34:17.649736 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'fail_fast': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m15:34:17.839485 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '35763348-d140-4b96-9c80-b816d4fd69f6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113da9310>]}
[0m15:34:17.883265 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '35763348-d140-4b96-9c80-b816d4fd69f6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113da9310>]}
[0m15:34:17.884399 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m15:34:17.895184 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m15:34:17.919493 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:34:17.919776 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:34:17.923330 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '35763348-d140-4b96-9c80-b816d4fd69f6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x115385950>]}
[0m15:34:17.930167 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '35763348-d140-4b96-9c80-b816d4fd69f6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1150c5d90>]}
[0m15:34:17.930456 [info ] [MainThread]: Found 10 models, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m15:34:17.930675 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '35763348-d140-4b96-9c80-b816d4fd69f6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11506dc10>]}
[0m15:34:17.931839 [info ] [MainThread]: 
[0m15:34:17.932291 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m15:34:17.933095 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m15:34:17.940396 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m15:34:17.940728 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m15:34:17.940911 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:34:18.451265 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 1.0 seconds
[0m15:34:18.453785 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m15:34:18.546843 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m15:34:18.554521 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m15:34:18.554852 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m15:34:18.555121 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:34:18.960437 [debug] [ThreadPool]: SQL status: SUCCESS 10 in 0.0 seconds
[0m15:34:18.963373 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m15:34:19.053284 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '35763348-d140-4b96-9c80-b816d4fd69f6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x115039550>]}
[0m15:34:19.054219 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m15:34:19.054599 [info ] [MainThread]: 
[0m15:34:19.057770 [debug] [Thread-1 (]: Began running node model.rightmove_epc.stg_epc_certs
[0m15:34:19.058154 [debug] [Thread-2 (]: Began running node model.rightmove_epc.stg_rightmove
[0m15:34:19.058669 [info ] [Thread-1 (]: 1 of 10 START sql view model dbt_melissa_rm_epc.stg_epc_certs .................. [RUN]
[0m15:34:19.059135 [info ] [Thread-2 (]: 2 of 10 START sql view model dbt_melissa_rm_epc.stg_rightmove .................. [RUN]
[0m15:34:19.059810 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.stg_epc_certs)
[0m15:34:19.060471 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.stg_rightmove'
[0m15:34:19.060805 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.stg_epc_certs
[0m15:34:19.061108 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.stg_rightmove
[0m15:34:19.068184 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.stg_epc_certs"
[0m15:34:19.070600 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.stg_rightmove"
[0m15:34:19.071437 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (compile): 15:34:19.061341 => 15:34:19.071244
[0m15:34:19.071850 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (compile): 15:34:19.068478 => 15:34:19.071610
[0m15:34:19.072150 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.stg_epc_certs
[0m15:34:19.072434 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.stg_rightmove
[0m15:34:19.124054 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.stg_epc_certs"
[0m15:34:19.126031 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.stg_rightmove"
[0m15:34:19.126908 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.stg_rightmove"
[0m15:34:19.127156 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_rightmove"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
  
   as (
    with rm as (

    SELECT 
    LISTING_ID,
    UPPER(TRIM(replace(REPLACE(CONCAT(ADDRESS_1::VARCHAR,ADDRESS_2::VARCHAR),' '),','))) AS ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL 
    FROM 
       ANALYTICS.RIGHTMOVE_PROD.CLEAN_RAW_RIGHTMOVE_DATA 

 
)

SELECT * FROM rm
  );
[0m15:34:19.127374 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m15:34:19.127939 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.stg_epc_certs"
[0m15:34:19.128551 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_epc_certs"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
  
   as (
    WITH epc_certs as (
    
    select 
    UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    COUNTY,
    LOCAL_AUTHORITY as LOCAL_AUTHORITY_CODE,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    UPPER(CASE WHEN (UPPER(ADDRESS1) LIKE 'FLAT%' OR UPPER(ADDRESS1) LIKE 'UNIT%') or UPPER(ADDRESS1) LIKE 'ROOM%' 
    THEN TRIM(REPLACE(REPLACE(CONCAT(ADDRESS1,ADDRESS2,ADDRESS3),','),' '))
    ELSE trim(replace(replace(ADDRESS1,' '),',')) END) AS ADDRESSID
 from  RAW.EPC_TEST_DATA.EPC_CERTIFICATES 

)

SELECT * FROM epc_certs
  );
[0m15:34:19.128995 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:34:19.643835 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m15:34:19.659963 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (execute): 15:34:19.072607 => 15:34:19.659808
[0m15:34:19.660284 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: Close
[0m15:34:19.688220 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m15:34:19.690153 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (execute): 15:34:19.124287 => 15:34:19.690014
[0m15:34:19.690522 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: Close
[0m15:34:19.733837 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '35763348-d140-4b96-9c80-b816d4fd69f6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114d38c50>]}
[0m15:34:19.734401 [info ] [Thread-1 (]: 1 of 10 OK created sql view model dbt_melissa_rm_epc.stg_epc_certs ............. [[32mSUCCESS 1[0m in 0.67s]
[0m15:34:19.734804 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.stg_epc_certs
[0m15:34:19.777919 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '35763348-d140-4b96-9c80-b816d4fd69f6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11504dad0>]}
[0m15:34:19.778514 [info ] [Thread-2 (]: 2 of 10 OK created sql view model dbt_melissa_rm_epc.stg_rightmove ............. [[32mSUCCESS 1[0m in 0.72s]
[0m15:34:19.778886 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.stg_rightmove
[0m15:34:19.779473 [debug] [Thread-4 (]: Began running node model.rightmove_epc.dim_addressid
[0m15:34:19.779781 [debug] [Thread-3 (]: Began running node model.rightmove_epc.dim_uprn
[0m15:34:19.780108 [info ] [Thread-4 (]: 3 of 10 START sql view model dbt_melissa_rm_epc.dim_addressid .................. [RUN]
[0m15:34:19.780571 [debug] [Thread-1 (]: Began running node model.rightmove_epc.uprn_match
[0m15:34:19.781118 [info ] [Thread-3 (]: 4 of 10 START sql view model dbt_melissa_rm_epc.dim_uprn ....................... [RUN]
[0m15:34:19.781902 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_addressid'
[0m15:34:19.782254 [info ] [Thread-1 (]: 5 of 10 START sql view model dbt_melissa_rm_epc.uprn_match ..................... [RUN]
[0m15:34:19.782704 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_uprn'
[0m15:34:19.782997 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.dim_addressid
[0m15:34:19.783503 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_epc_certs, now model.rightmove_epc.uprn_match)
[0m15:34:19.783750 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.dim_uprn
[0m15:34:19.785890 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.dim_addressid"
[0m15:34:19.786120 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.uprn_match
[0m15:34:19.787666 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.dim_uprn"
[0m15:34:19.789858 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.uprn_match"
[0m15:34:19.790440 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_addressid (compile): 15:34:19.783892 => 15:34:19.790278
[0m15:34:19.790723 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.dim_addressid
[0m15:34:19.791050 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.dim_uprn (compile): 15:34:19.786276 => 15:34:19.790917
[0m15:34:19.793222 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.dim_addressid"
[0m15:34:19.793485 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.uprn_match (compile): 15:34:19.787938 => 15:34:19.793373
[0m15:34:19.793734 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.dim_uprn
[0m15:34:19.793996 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.uprn_match
[0m15:34:19.795778 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.dim_uprn"
[0m15:34:19.797479 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.uprn_match"
[0m15:34:19.798142 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.dim_addressid"
[0m15:34:19.798518 [debug] [Thread-4 (]: On model.rightmove_epc.dim_addressid: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_addressid"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
  
   as (
    with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource,
    POSTCODE,
    TOTAL_FLOOR_AREA

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE,
    NULL AS TOTAL_FLOOR_AREA -- quick fix for now
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where uprn is null
and addressid is not null
  );
[0m15:34:19.798803 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m15:34:19.799607 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.dim_uprn"
[0m15:34:19.800227 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.uprn_match"
[0m15:34:19.800908 [debug] [Thread-3 (]: On model.rightmove_epc.dim_uprn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_uprn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
  
   as (
    with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource,
    POSTCODE

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where uprn is not null
  );
[0m15:34:19.801208 [debug] [Thread-1 (]: On model.rightmove_epc.uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
  
   as (
    with epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    where uprn is not null

),

rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where uprn is not null
),

final as (

    select 
    LISTING_ID,
    rm.ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    rm.UPRN,
    rm.LOCAL_AUTHORITY_CODE,
    rm.LOCAL_AUTHORITY,
    rm.GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    epc.UPRN AS EPC_UPRN,
    epc.TOTAL_FLOOR_AREA,
    epc.ADDRESSID as EPC_ADDRESSID,
    TOTAL_FLOOR_AREA,
    CASE WHEN epc.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC    
    
     from rm left join epc on rm.uprn = epc.uprn
)

select * from final
  );
[0m15:34:19.801444 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m15:34:19.801654 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:34:20.261885 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b33fa6-0103-9a62-0000-7195063592e2
[0m15:34:20.262261 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 002025 (42S21): SQL compilation error:
duplicate column name 'TOTAL_FLOOR_AREA'
[0m15:34:20.262672 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.uprn_match (execute): 15:34:19.795934 => 15:34:20.262513
[0m15:34:20.262947 [debug] [Thread-1 (]: On model.rightmove_epc.uprn_match: Close
[0m15:34:20.373411 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m15:34:20.375783 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.dim_uprn (execute): 15:34:19.794145 => 15:34:20.375615
[0m15:34:20.377310 [debug] [Thread-3 (]: On model.rightmove_epc.dim_uprn: Close
[0m15:34:20.381501 [debug] [Thread-1 (]: Database Error in model uprn_match (models/matching/uprn_match.sql)
  002025 (42S21): SQL compilation error:
  duplicate column name 'TOTAL_FLOOR_AREA'
  compiled Code at target/run/rightmove_epc/models/matching/uprn_match.sql
[0m15:34:20.382103 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '35763348-d140-4b96-9c80-b816d4fd69f6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1152ea450>]}
[0m15:34:20.382629 [error] [Thread-1 (]: 5 of 10 ERROR creating sql view model dbt_melissa_rm_epc.uprn_match ............ [[31mERROR[0m in 0.60s]
[0m15:34:20.383176 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.uprn_match
[0m15:34:20.383656 [debug] [Thread-2 (]: Began running node model.rightmove_epc.no_uprn_match
[0m15:34:20.383986 [info ] [Thread-2 (]: 6 of 10 SKIP relation dbt_melissa_rm_epc.no_uprn_match ......................... [[33mSKIP[0m]
[0m15:34:20.384295 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.no_uprn_match
[0m15:34:20.395623 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m15:34:20.397684 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_addressid (execute): 15:34:19.791173 => 15:34:20.397538
[0m15:34:20.397970 [debug] [Thread-4 (]: On model.rightmove_epc.dim_addressid: Close
[0m15:34:20.468636 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '35763348-d140-4b96-9c80-b816d4fd69f6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1154ef950>]}
[0m15:34:20.469157 [info ] [Thread-3 (]: 4 of 10 OK created sql view model dbt_melissa_rm_epc.dim_uprn .................. [[32mSUCCESS 1[0m in 0.69s]
[0m15:34:20.469533 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.dim_uprn
[0m15:34:20.471496 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '35763348-d140-4b96-9c80-b816d4fd69f6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114d2b750>]}
[0m15:34:20.471850 [info ] [Thread-4 (]: 3 of 10 OK created sql view model dbt_melissa_rm_epc.dim_addressid ............. [[32mSUCCESS 1[0m in 0.69s]
[0m15:34:20.472187 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.dim_addressid
[0m15:34:20.472672 [debug] [Thread-1 (]: Began running node model.rightmove_epc.address_match
[0m15:34:20.473006 [info ] [Thread-1 (]: 7 of 10 START sql view model dbt_melissa_rm_epc.address_match .................. [RUN]
[0m15:34:20.473297 [debug] [Thread-2 (]: Began running node model.rightmove_epc.address_simularity
[0m15:34:20.473764 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.uprn_match, now model.rightmove_epc.address_match)
[0m15:34:20.474068 [info ] [Thread-2 (]: 8 of 10 START sql view model dbt_melissa_rm_epc.address_simularity ............. [RUN]
[0m15:34:20.474325 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.address_match
[0m15:34:20.474842 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_rightmove, now model.rightmove_epc.address_simularity)
[0m15:34:20.478448 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.address_match"
[0m15:34:20.478686 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.address_simularity
[0m15:34:20.480558 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.address_simularity"
[0m15:34:20.481038 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.address_match (compile): 15:34:20.475007 => 15:34:20.480902
[0m15:34:20.481287 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.address_simularity (compile): 15:34:20.478915 => 15:34:20.481165
[0m15:34:20.481488 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.address_match
[0m15:34:20.481683 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.address_simularity
[0m15:34:20.483815 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.address_match"
[0m15:34:20.485587 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.address_simularity"
[0m15:34:20.486373 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.address_match"
[0m15:34:20.486616 [debug] [Thread-1 (]: On model.rightmove_epc.address_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.address_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NULL
),

epc_address as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
    where datasource = 'EPC'
)


SELECT rm.*,
epc_address.addressid
as EPC_ADDRESSID,
CASE WHEN epc_address.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC    

FROM rm
LEFT JOIN epc_address
ON rm.addressid = epc_address.addressid
and rm.FULL_POSTCODE = epc_address.POSTCODE
  );
[0m15:34:20.487112 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.address_simularity"
[0m15:34:20.487287 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:34:20.487514 [debug] [Thread-2 (]: On model.rightmove_epc.address_simularity: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.address_simularity"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.address_simularity
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NULL
),

epc_address as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
    where datasource = 'EPC'
)


SELECT rm.*,epc_address.addressid as EPC_ADDRESSID
FROM rm
JOIN epc_address
ON JAROWINKLER_SIMILARITY(rm.addressid, epc_address.addressid) = 1
  );
[0m15:34:20.488115 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m15:34:21.079675 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m15:34:21.082871 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.address_match (execute): 15:34:20.481804 => 15:34:21.082601
[0m15:34:21.083300 [debug] [Thread-1 (]: On model.rightmove_epc.address_match: Close
[0m15:34:21.096345 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m15:34:21.098917 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.address_simularity (execute): 15:34:20.483963 => 15:34:21.098708
[0m15:34:21.099301 [debug] [Thread-2 (]: On model.rightmove_epc.address_simularity: Close
[0m15:34:21.164476 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '35763348-d140-4b96-9c80-b816d4fd69f6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1153b4750>]}
[0m15:34:21.165600 [info ] [Thread-1 (]: 7 of 10 OK created sql view model dbt_melissa_rm_epc.address_match ............. [[32mSUCCESS 1[0m in 0.69s]
[0m15:34:21.166430 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.address_match
[0m15:34:21.167433 [debug] [Thread-4 (]: Began running node model.rightmove_epc.all_matches
[0m15:34:21.168103 [debug] [Thread-3 (]: Began running node model.rightmove_epc.no_matches
[0m15:34:21.168898 [info ] [Thread-4 (]: 9 of 10 SKIP relation dbt_melissa_rm_epc.all_matches ........................... [[33mSKIP[0m]
[0m15:34:21.169414 [info ] [Thread-3 (]: 10 of 10 SKIP relation dbt_melissa_rm_epc.no_matches ........................... [[33mSKIP[0m]
[0m15:34:21.169907 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.all_matches
[0m15:34:21.170337 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.no_matches
[0m15:34:21.199222 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '35763348-d140-4b96-9c80-b816d4fd69f6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112444e90>]}
[0m15:34:21.199871 [info ] [Thread-2 (]: 8 of 10 OK created sql view model dbt_melissa_rm_epc.address_simularity ........ [[32mSUCCESS 1[0m in 0.72s]
[0m15:34:21.200335 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.address_simularity
[0m15:34:21.201808 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:34:21.202104 [debug] [MainThread]: Connection 'model.rightmove_epc.address_match' was properly closed.
[0m15:34:21.202344 [debug] [MainThread]: Connection 'model.rightmove_epc.address_simularity' was properly closed.
[0m15:34:21.202561 [debug] [MainThread]: Connection 'model.rightmove_epc.dim_addressid' was properly closed.
[0m15:34:21.202820 [debug] [MainThread]: Connection 'model.rightmove_epc.dim_uprn' was properly closed.
[0m15:34:21.203138 [info ] [MainThread]: 
[0m15:34:21.203401 [info ] [MainThread]: Finished running 10 view models in 0 hours 0 minutes and 3.27 seconds (3.27s).
[0m15:34:21.204411 [debug] [MainThread]: Command end result
[0m15:34:21.211714 [info ] [MainThread]: 
[0m15:34:21.212085 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m15:34:21.212311 [info ] [MainThread]: 
[0m15:34:21.212529 [error] [MainThread]:   Database Error in model uprn_match (models/matching/uprn_match.sql)
  002025 (42S21): SQL compilation error:
  duplicate column name 'TOTAL_FLOOR_AREA'
  compiled Code at target/run/rightmove_epc/models/matching/uprn_match.sql
[0m15:34:21.212762 [info ] [MainThread]: 
[0m15:34:21.212966 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=1 SKIP=3 TOTAL=10
[0m15:34:21.214806 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 3.599578, "process_user_time": 1.550484, "process_kernel_time": 0.187165, "process_mem_max_rss": "138756096", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m15:34:21.215200 [debug] [MainThread]: Command `dbt run` failed at 15:34:21.215112 after 3.60 seconds
[0m15:34:21.215474 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113d03dd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104fe6110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104fe6190>]}
[0m15:34:21.215723 [debug] [MainThread]: Flushing usage events
[0m15:35:48.399590 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1051530d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10515e3d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10515f050>]}


============================== 15:35:48.402514 | a932fb87-ff98-4064-9217-9f35c4d9bcc7 ==============================
[0m15:35:48.402514 [info ] [MainThread]: Running with dbt=1.7.10
[0m15:35:48.402894 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt run', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m15:35:48.585694 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a932fb87-ff98-4064-9217-9f35c4d9bcc7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10515c510>]}
[0m15:35:48.625070 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a932fb87-ff98-4064-9217-9f35c4d9bcc7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105607610>]}
[0m15:35:48.626103 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m15:35:48.635933 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m15:35:48.664079 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:35:48.664382 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:35:48.668054 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a932fb87-ff98-4064-9217-9f35c4d9bcc7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105e1cb50>]}
[0m15:35:48.674853 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a932fb87-ff98-4064-9217-9f35c4d9bcc7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105d7ccd0>]}
[0m15:35:48.675146 [info ] [MainThread]: Found 10 models, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m15:35:48.675370 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a932fb87-ff98-4064-9217-9f35c4d9bcc7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105e17d90>]}
[0m15:35:48.676486 [info ] [MainThread]: 
[0m15:35:48.676931 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m15:35:48.677695 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m15:35:48.684849 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m15:35:48.685129 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m15:35:48.685301 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:35:49.179319 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 0.0 seconds
[0m15:35:49.183556 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m15:35:49.273214 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m15:35:49.283532 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m15:35:49.284076 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m15:35:49.284451 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:35:49.607916 [debug] [ThreadPool]: SQL status: SUCCESS 10 in 0.0 seconds
[0m15:35:49.609794 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m15:35:49.719904 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a932fb87-ff98-4064-9217-9f35c4d9bcc7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105e98090>]}
[0m15:35:49.720820 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m15:35:49.721144 [info ] [MainThread]: 
[0m15:35:49.724169 [debug] [Thread-1 (]: Began running node model.rightmove_epc.stg_epc_certs
[0m15:35:49.724576 [debug] [Thread-2 (]: Began running node model.rightmove_epc.stg_rightmove
[0m15:35:49.725001 [info ] [Thread-1 (]: 1 of 10 START sql view model dbt_melissa_rm_epc.stg_epc_certs .................. [RUN]
[0m15:35:49.725447 [info ] [Thread-2 (]: 2 of 10 START sql view model dbt_melissa_rm_epc.stg_rightmove .................. [RUN]
[0m15:35:49.726100 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.stg_epc_certs)
[0m15:35:49.726644 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.stg_rightmove'
[0m15:35:49.726925 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.stg_epc_certs
[0m15:35:49.727179 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.stg_rightmove
[0m15:35:49.733052 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.stg_epc_certs"
[0m15:35:49.735195 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.stg_rightmove"
[0m15:35:49.735921 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (compile): 15:35:49.727341 => 15:35:49.735760
[0m15:35:49.736208 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (compile): 15:35:49.733268 => 15:35:49.736054
[0m15:35:49.736492 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.stg_epc_certs
[0m15:35:49.736779 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.stg_rightmove
[0m15:35:49.790252 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.stg_epc_certs"
[0m15:35:49.792295 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.stg_rightmove"
[0m15:35:49.793178 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.stg_epc_certs"
[0m15:35:49.793697 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.stg_rightmove"
[0m15:35:49.793957 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_epc_certs"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
  
   as (
    WITH epc_certs as (
    
    select 
    UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    COUNTY,
    LOCAL_AUTHORITY as LOCAL_AUTHORITY_CODE,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    UPPER(CASE WHEN (UPPER(ADDRESS1) LIKE 'FLAT%' OR UPPER(ADDRESS1) LIKE 'UNIT%') or UPPER(ADDRESS1) LIKE 'ROOM%' 
    THEN TRIM(REPLACE(REPLACE(CONCAT(ADDRESS1,ADDRESS2,ADDRESS3),','),' '))
    ELSE trim(replace(replace(ADDRESS1,' '),',')) END) AS ADDRESSID
 from  RAW.EPC_TEST_DATA.EPC_CERTIFICATES 

)

SELECT * FROM epc_certs
  );
[0m15:35:49.794254 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_rightmove"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
  
   as (
    with rm as (

    SELECT 
    LISTING_ID,
    UPPER(TRIM(replace(REPLACE(CONCAT(ADDRESS_1::VARCHAR,ADDRESS_2::VARCHAR),' '),','))) AS ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL 
    FROM 
       ANALYTICS.RIGHTMOVE_PROD.CLEAN_RAW_RIGHTMOVE_DATA 

 
)

SELECT * FROM rm
  );
[0m15:35:49.794505 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:35:49.794726 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m15:35:50.316278 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m15:35:50.339419 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (execute): 15:35:49.736958 => 15:35:50.339245
[0m15:35:50.340061 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: Close
[0m15:35:50.341150 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m15:35:50.342935 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (execute): 15:35:49.790468 => 15:35:50.342801
[0m15:35:50.343414 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: Close
[0m15:35:50.418618 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a932fb87-ff98-4064-9217-9f35c4d9bcc7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105db6dd0>]}
[0m15:35:50.419445 [info ] [Thread-1 (]: 1 of 10 OK created sql view model dbt_melissa_rm_epc.stg_epc_certs ............. [[32mSUCCESS 1[0m in 0.69s]
[0m15:35:50.420014 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.stg_epc_certs
[0m15:35:50.434741 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a932fb87-ff98-4064-9217-9f35c4d9bcc7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105f37390>]}
[0m15:35:50.435328 [info ] [Thread-2 (]: 2 of 10 OK created sql view model dbt_melissa_rm_epc.stg_rightmove ............. [[32mSUCCESS 1[0m in 0.71s]
[0m15:35:50.435767 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.stg_rightmove
[0m15:35:50.436493 [debug] [Thread-4 (]: Began running node model.rightmove_epc.dim_addressid
[0m15:35:50.436868 [debug] [Thread-3 (]: Began running node model.rightmove_epc.dim_uprn
[0m15:35:50.437204 [debug] [Thread-1 (]: Began running node model.rightmove_epc.uprn_match
[0m15:35:50.437681 [info ] [Thread-4 (]: 3 of 10 START sql view model dbt_melissa_rm_epc.dim_addressid .................. [RUN]
[0m15:35:50.438138 [info ] [Thread-3 (]: 4 of 10 START sql view model dbt_melissa_rm_epc.dim_uprn ....................... [RUN]
[0m15:35:50.438499 [info ] [Thread-1 (]: 5 of 10 START sql view model dbt_melissa_rm_epc.uprn_match ..................... [RUN]
[0m15:35:50.439104 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_addressid'
[0m15:35:50.439726 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_uprn'
[0m15:35:50.440209 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_epc_certs, now model.rightmove_epc.uprn_match)
[0m15:35:50.440511 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.dim_addressid
[0m15:35:50.440788 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.dim_uprn
[0m15:35:50.441068 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.uprn_match
[0m15:35:50.443729 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.dim_addressid"
[0m15:35:50.445704 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.dim_uprn"
[0m15:35:50.447509 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.uprn_match"
[0m15:35:50.448157 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.dim_uprn (compile): 15:35:50.444015 => 15:35:50.448009
[0m15:35:50.448447 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.uprn_match (compile): 15:35:50.445884 => 15:35:50.448329
[0m15:35:50.448672 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_addressid (compile): 15:35:50.441260 => 15:35:50.448568
[0m15:35:50.448893 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.dim_uprn
[0m15:35:50.449157 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.uprn_match
[0m15:35:50.449366 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.dim_addressid
[0m15:35:50.451555 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.dim_uprn"
[0m15:35:50.453451 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.uprn_match"
[0m15:35:50.455278 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.dim_addressid"
[0m15:35:50.456303 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.uprn_match"
[0m15:35:50.456848 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.dim_uprn"
[0m15:35:50.457420 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.dim_addressid"
[0m15:35:50.457662 [debug] [Thread-1 (]: On model.rightmove_epc.uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
  
   as (
    with epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    where uprn is not null

),

rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where uprn is not null
),

final as (

    select 
    LISTING_ID,
    rm.ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    rm.UPRN,
    rm.LOCAL_AUTHORITY_CODE,
    rm.LOCAL_AUTHORITY,
    rm.GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    epc.UPRN AS EPC_UPRN,
    epc.TOTAL_FLOOR_AREA,
    epc.ADDRESSID as EPC_ADDRESSID,
    CASE WHEN epc.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC    
    
     from rm left join epc on rm.uprn = epc.uprn
)

select * from final
  );
[0m15:35:50.457919 [debug] [Thread-3 (]: On model.rightmove_epc.dim_uprn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_uprn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
  
   as (
    with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource,
    POSTCODE

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where uprn is not null
  );
[0m15:35:50.458167 [debug] [Thread-4 (]: On model.rightmove_epc.dim_addressid: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_addressid"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
  
   as (
    with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource,
    POSTCODE,
    TOTAL_FLOOR_AREA

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE,
    NULL AS TOTAL_FLOOR_AREA -- quick fix for now
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where uprn is null
and addressid is not null
  );
[0m15:35:50.458379 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:35:50.458556 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m15:35:50.458736 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m15:35:50.977795 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m15:35:50.980555 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_addressid (execute): 15:35:50.453605 => 15:35:50.980347
[0m15:35:50.980946 [debug] [Thread-4 (]: On model.rightmove_epc.dim_addressid: Close
[0m15:35:50.982971 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m15:35:50.986782 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.uprn_match (execute): 15:35:50.451726 => 15:35:50.986616
[0m15:35:50.987215 [debug] [Thread-1 (]: On model.rightmove_epc.uprn_match: Close
[0m15:35:51.067901 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a932fb87-ff98-4064-9217-9f35c4d9bcc7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1062fdfd0>]}
[0m15:35:51.068496 [info ] [Thread-1 (]: 5 of 10 OK created sql view model dbt_melissa_rm_epc.uprn_match ................ [[32mSUCCESS 1[0m in 0.63s]
[0m15:35:51.068967 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.uprn_match
[0m15:35:51.069437 [debug] [Thread-2 (]: Began running node model.rightmove_epc.no_uprn_match
[0m15:35:51.069782 [info ] [Thread-2 (]: 6 of 10 START sql view model dbt_melissa_rm_epc.no_uprn_match .................. [RUN]
[0m15:35:51.070318 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_rightmove, now model.rightmove_epc.no_uprn_match)
[0m15:35:51.070596 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.no_uprn_match
[0m15:35:51.073134 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.no_uprn_match"
[0m15:35:51.074020 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.no_uprn_match (compile): 15:35:51.070767 => 15:35:51.073867
[0m15:35:51.074282 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.no_uprn_match
[0m15:35:51.076872 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.no_uprn_match"
[0m15:35:51.077556 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a932fb87-ff98-4064-9217-9f35c4d9bcc7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1062de050>]}
[0m15:35:51.078018 [info ] [Thread-4 (]: 3 of 10 OK created sql view model dbt_melissa_rm_epc.dim_addressid ............. [[32mSUCCESS 1[0m in 0.64s]
[0m15:35:51.078400 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.dim_addressid
[0m15:35:51.079075 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.no_uprn_match"
[0m15:35:51.079803 [debug] [Thread-2 (]: On model.rightmove_epc.no_uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.no_uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.no_uprn_match
  
   as (
    with rm_no_match_to_epc  as ( -- rightmove uspn does not match epc

    select 
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL

     from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'NO'
    
)

select * from rm_no_match_to_epc

/*
epc_remove as (

    select EPC_UPRN,EPC_ADDRESSID from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'YES'  -- 
),

epc_matched as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs src
    left join epc_remove rem on src.UPRN = rem.EPC_UPRN
    
),

epc_fm_prep as (

    select * from epc_matched
    where EPC_UPRN is NULL

    
)


SELECT * FROM epc_fm_prep
WHERE UPRN NOT NULL */
  );
[0m15:35:51.080118 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m15:35:51.080916 [debug] [Thread-1 (]: Began running node model.rightmove_epc.address_match
[0m15:35:51.081487 [debug] [Thread-4 (]: Began running node model.rightmove_epc.address_simularity
[0m15:35:51.081881 [info ] [Thread-1 (]: 7 of 10 START sql view model dbt_melissa_rm_epc.address_match .................. [RUN]
[0m15:35:51.082242 [info ] [Thread-4 (]: 8 of 10 START sql view model dbt_melissa_rm_epc.address_simularity ............. [RUN]
[0m15:35:51.082749 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.uprn_match, now model.rightmove_epc.address_match)
[0m15:35:51.083176 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.dim_addressid, now model.rightmove_epc.address_simularity)
[0m15:35:51.083423 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.address_match
[0m15:35:51.083656 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.address_simularity
[0m15:35:51.085981 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.address_match"
[0m15:35:51.088021 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.address_simularity"
[0m15:35:51.088935 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.address_simularity (compile): 15:35:51.086299 => 15:35:51.088799
[0m15:35:51.089211 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.address_match (compile): 15:35:51.083819 => 15:35:51.089052
[0m15:35:51.089447 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.address_simularity
[0m15:35:51.089684 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.address_match
[0m15:35:51.091749 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.address_simularity"
[0m15:35:51.093826 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.address_match"
[0m15:35:51.094787 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m15:35:51.095433 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.address_match"
[0m15:35:51.095980 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.address_simularity"
[0m15:35:51.097686 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.dim_uprn (execute): 15:35:50.449511 => 15:35:51.097570
[0m15:35:51.097937 [debug] [Thread-1 (]: On model.rightmove_epc.address_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.address_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NULL
),

epc_address as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
    where datasource = 'EPC'
)


SELECT rm.*,
epc_address.addressid
as EPC_ADDRESSID,
CASE WHEN epc_address.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC ,
TOTAL_FLOOR_AREA  

FROM rm
LEFT JOIN epc_address
ON rm.addressid = epc_address.addressid
and rm.FULL_POSTCODE = epc_address.POSTCODE
  );
[0m15:35:51.098194 [debug] [Thread-4 (]: On model.rightmove_epc.address_simularity: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.address_simularity"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.address_simularity
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NULL
),

epc_address as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
    where datasource = 'EPC'
)


SELECT rm.*,epc_address.addressid as EPC_ADDRESSID
FROM rm
JOIN epc_address
ON JAROWINKLER_SIMILARITY(rm.addressid, epc_address.addressid) = 1
  );
[0m15:35:51.098424 [debug] [Thread-3 (]: On model.rightmove_epc.dim_uprn: Close
[0m15:35:51.098616 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:35:51.098799 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m15:35:51.184533 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a932fb87-ff98-4064-9217-9f35c4d9bcc7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1062b7090>]}
[0m15:35:51.184998 [info ] [Thread-3 (]: 4 of 10 OK created sql view model dbt_melissa_rm_epc.dim_uprn .................. [[32mSUCCESS 1[0m in 0.75s]
[0m15:35:51.185313 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.dim_uprn
[0m15:35:51.592838 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m15:35:51.595560 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.no_uprn_match (execute): 15:35:51.074433 => 15:35:51.595361
[0m15:35:51.595938 [debug] [Thread-2 (]: On model.rightmove_epc.no_uprn_match: Close
[0m15:35:51.600746 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m15:35:51.602947 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.address_simularity (execute): 15:35:51.089840 => 15:35:51.602780
[0m15:35:51.603258 [debug] [Thread-4 (]: On model.rightmove_epc.address_simularity: Close
[0m15:35:51.635575 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m15:35:51.638114 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.address_match (execute): 15:35:51.091979 => 15:35:51.637928
[0m15:35:51.638437 [debug] [Thread-1 (]: On model.rightmove_epc.address_match: Close
[0m15:35:51.668374 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a932fb87-ff98-4064-9217-9f35c4d9bcc7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108908490>]}
[0m15:35:51.668990 [info ] [Thread-2 (]: 6 of 10 OK created sql view model dbt_melissa_rm_epc.no_uprn_match ............. [[32mSUCCESS 1[0m in 0.60s]
[0m15:35:51.669493 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.no_uprn_match
[0m15:35:51.686125 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a932fb87-ff98-4064-9217-9f35c4d9bcc7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105b91d50>]}
[0m15:35:51.686711 [info ] [Thread-4 (]: 8 of 10 OK created sql view model dbt_melissa_rm_epc.address_simularity ........ [[32mSUCCESS 1[0m in 0.60s]
[0m15:35:51.687137 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.address_simularity
[0m15:35:51.726804 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a932fb87-ff98-4064-9217-9f35c4d9bcc7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105f49190>]}
[0m15:35:51.727446 [info ] [Thread-1 (]: 7 of 10 OK created sql view model dbt_melissa_rm_epc.address_match ............. [[32mSUCCESS 1[0m in 0.64s]
[0m15:35:51.727876 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.address_match
[0m15:35:51.728475 [debug] [Thread-3 (]: Began running node model.rightmove_epc.all_matches
[0m15:35:51.728826 [debug] [Thread-2 (]: Began running node model.rightmove_epc.no_matches
[0m15:35:51.729117 [info ] [Thread-3 (]: 9 of 10 START sql view model dbt_melissa_rm_epc.all_matches .................... [RUN]
[0m15:35:51.729461 [info ] [Thread-2 (]: 10 of 10 START sql view model dbt_melissa_rm_epc.no_matches .................... [RUN]
[0m15:35:51.730026 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.dim_uprn, now model.rightmove_epc.all_matches)
[0m15:35:51.730518 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.no_uprn_match, now model.rightmove_epc.no_matches)
[0m15:35:51.730811 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.all_matches
[0m15:35:51.731076 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.no_matches
[0m15:35:51.734894 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.no_matches"
[0m15:35:51.736107 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.all_matches"
[0m15:35:51.736605 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.no_matches (compile): 15:35:51.733031 => 15:35:51.736457
[0m15:35:51.736878 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.no_matches
[0m15:35:51.739327 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.no_matches"
[0m15:35:51.739733 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.all_matches (compile): 15:35:51.731238 => 15:35:51.739577
[0m15:35:51.739999 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.all_matches
[0m15:35:51.740848 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.no_matches"
[0m15:35:51.742977 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.all_matches"
[0m15:35:51.743270 [debug] [Thread-2 (]: On model.rightmove_epc.no_matches: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.no_matches"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.no_matches
  
   as (
    with addr as (

    select 
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    '' AS EPC_UPRN,
    EPC_ADDRESSID
    
    from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
    where MATCH_EPC = 'NO' 
),

uprn as (

    select 
    
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN::VARCHAR AS EPC_UPRN,
    EPC_ADDRESSID
    
     from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'NO'
),

final as (

select 'NO ADDRESS OR UPRN MATCH' AS MATCH_RESULT, * from addr
union all
select 'NO UPRN MATCH' AS MATCH_RESULT, * from uprn
)

select * from final
  );
[0m15:35:51.743572 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m15:35:51.744761 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.all_matches"
[0m15:35:51.745263 [debug] [Thread-3 (]: On model.rightmove_epc.all_matches: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.all_matches"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.all_matches
  
   as (
    with addr as (

    select 
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    '' AS EPC_UPRN,
    EPC_ADDRESSID,
    TOTAL_FLOOR_AREA
    
    from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
    where MATCH_EPC = 'YES' 
),

uprn as (

    select 
    
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN::VARCHAR AS EPC_UPRN,
    EPC_ADDRESSID,
    TOTAL_FLOOR_AREA
     from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'YES'
),

final as (

select 'ADDRESS AND POSTCODE MATCH' AS MATCH_RESULT, * from addr
union all
select 'UPRN MATCH' AS MATCH_RESULT, * from uprn
)

select * from final
  );
[0m15:35:51.745530 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m15:35:52.482198 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m15:35:52.486423 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.no_matches (execute): 15:35:51.737036 => 15:35:52.485927
[0m15:35:52.487357 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m15:35:52.487905 [debug] [Thread-2 (]: On model.rightmove_epc.no_matches: Close
[0m15:35:52.490715 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.all_matches (execute): 15:35:51.741012 => 15:35:52.490486
[0m15:35:52.492167 [debug] [Thread-3 (]: On model.rightmove_epc.all_matches: Close
[0m15:35:52.578376 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a932fb87-ff98-4064-9217-9f35c4d9bcc7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105b3be50>]}
[0m15:35:52.579117 [info ] [Thread-3 (]: 9 of 10 OK created sql view model dbt_melissa_rm_epc.all_matches ............... [[32mSUCCESS 1[0m in 0.85s]
[0m15:35:52.579742 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.all_matches
[0m15:35:52.584024 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a932fb87-ff98-4064-9217-9f35c4d9bcc7', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105f746d0>]}
[0m15:35:52.584630 [info ] [Thread-2 (]: 10 of 10 OK created sql view model dbt_melissa_rm_epc.no_matches ............... [[32mSUCCESS 1[0m in 0.85s]
[0m15:35:52.585207 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.no_matches
[0m15:35:52.587030 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:35:52.587363 [debug] [MainThread]: Connection 'model.rightmove_epc.address_match' was properly closed.
[0m15:35:52.587627 [debug] [MainThread]: Connection 'model.rightmove_epc.no_matches' was properly closed.
[0m15:35:52.587872 [debug] [MainThread]: Connection 'model.rightmove_epc.address_simularity' was properly closed.
[0m15:35:52.588109 [debug] [MainThread]: Connection 'model.rightmove_epc.all_matches' was properly closed.
[0m15:35:52.588431 [info ] [MainThread]: 
[0m15:35:52.588731 [info ] [MainThread]: Finished running 10 view models in 0 hours 0 minutes and 3.91 seconds (3.91s).
[0m15:35:52.590118 [debug] [MainThread]: Command end result
[0m15:35:52.600381 [info ] [MainThread]: 
[0m15:35:52.600761 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:35:52.601006 [info ] [MainThread]: 
[0m15:35:52.601253 [info ] [MainThread]: Done. PASS=10 WARN=0 ERROR=0 SKIP=0 TOTAL=10
[0m15:35:52.603318 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.235298, "process_user_time": 1.67336, "process_kernel_time": 0.200967, "process_mem_max_rss": "138854400", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m15:35:52.603835 [debug] [MainThread]: Command `dbt run` succeeded at 15:35:52.603739 after 4.24 seconds
[0m15:35:52.604149 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100ede110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x101019cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105e53050>]}
[0m15:35:52.604439 [debug] [MainThread]: Flushing usage events
[0m15:47:44.233810 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108e530d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108d1e810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108e5eed0>]}


============================== 15:47:44.236736 | f386c4a3-a73b-4656-ae9a-caa9c8fd745f ==============================
[0m15:47:44.236736 [info ] [MainThread]: Running with dbt=1.7.10
[0m15:47:44.237124 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --select models/staging', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m15:47:44.425805 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f386c4a3-a73b-4656-ae9a-caa9c8fd745f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a11b6d0>]}
[0m15:47:44.467109 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f386c4a3-a73b-4656-ae9a-caa9c8fd745f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109f9d510>]}
[0m15:47:44.467847 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m15:47:44.478137 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m15:47:44.502716 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:47:44.502996 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:47:44.506521 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f386c4a3-a73b-4656-ae9a-caa9c8fd745f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108e5dd10>]}
[0m15:47:44.513239 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f386c4a3-a73b-4656-ae9a-caa9c8fd745f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a1006d0>]}
[0m15:47:44.513525 [info ] [MainThread]: Found 10 models, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m15:47:44.513748 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f386c4a3-a73b-4656-ae9a-caa9c8fd745f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108e877d0>]}
[0m15:47:44.514744 [info ] [MainThread]: 
[0m15:47:44.515179 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m15:47:44.515798 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m15:47:44.523176 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m15:47:44.523481 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m15:47:44.523664 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:47:45.184127 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 1.0 seconds
[0m15:47:45.186028 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m15:47:45.266951 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m15:47:45.273121 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m15:47:45.273414 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m15:47:45.273646 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:47:45.683194 [debug] [ThreadPool]: SQL status: SUCCESS 11 in 0.0 seconds
[0m15:47:45.684615 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m15:47:45.779722 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f386c4a3-a73b-4656-ae9a-caa9c8fd745f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a19dbd0>]}
[0m15:47:45.780577 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m15:47:45.780874 [info ] [MainThread]: 
[0m15:47:45.783736 [debug] [Thread-1 (]: Began running node model.rightmove_epc.stg_epc_certs
[0m15:47:45.784027 [debug] [Thread-2 (]: Began running node model.rightmove_epc.stg_rightmove
[0m15:47:45.784357 [info ] [Thread-1 (]: 1 of 2 START sql view model dbt_melissa_rm_epc.stg_epc_certs ................... [RUN]
[0m15:47:45.784682 [info ] [Thread-2 (]: 2 of 2 START sql view model dbt_melissa_rm_epc.stg_rightmove ................... [RUN]
[0m15:47:45.785195 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.stg_epc_certs)
[0m15:47:45.785683 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.stg_rightmove'
[0m15:47:45.785942 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.stg_epc_certs
[0m15:47:45.786182 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.stg_rightmove
[0m15:47:45.792159 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.stg_epc_certs"
[0m15:47:45.794163 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.stg_rightmove"
[0m15:47:45.794837 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (compile): 15:47:45.786405 => 15:47:45.794674
[0m15:47:45.795132 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (compile): 15:47:45.792371 => 15:47:45.794980
[0m15:47:45.795375 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.stg_epc_certs
[0m15:47:45.795598 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.stg_rightmove
[0m15:47:45.843615 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.stg_epc_certs"
[0m15:47:45.845488 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.stg_rightmove"
[0m15:47:45.846390 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.stg_epc_certs"
[0m15:47:45.846894 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.stg_rightmove"
[0m15:47:45.847132 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_epc_certs"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
  
   as (
    WITH epc_certs as (
    
    select 
    UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    COUNTY,
    LOCAL_AUTHORITY as LOCAL_AUTHORITY_CODE,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    UPPER(CASE WHEN (UPPER(ADDRESS1) LIKE 'FLAT%' OR UPPER(ADDRESS1) LIKE 'UNIT%') or UPPER(ADDRESS1) LIKE 'ROOM%' 
    THEN TRIM(REPLACE(REPLACE(CONCAT(ADDRESS1,ADDRESS2,ADDRESS3),','),' '))
    ELSE trim(replace(replace(ADDRESS1,' '),',')) END) AS ADDRESSID,
    CASE WHEN UPRN is null and addressid is null THEN 1 else 0 end as REMOVE_FROM_RM_MATCH

 from  RAW.EPC_TEST_DATA.EPC_CERTIFICATES 

)

SELECT * FROM epc_certs
  );
[0m15:47:45.847388 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_rightmove"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
  
   as (
    with rm as (

    SELECT 
    LISTING_ID,
    UPPER(TRIM(replace(REPLACE(CONCAT(ADDRESS_1::VARCHAR,ADDRESS_2::VARCHAR),' '),','))) AS ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL 
    FROM 
       ANALYTICS.RIGHTMOVE_PROD.CLEAN_RAW_RIGHTMOVE_DATA 

 
)

SELECT * FROM rm
  );
[0m15:47:45.847601 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:47:45.847781 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m15:47:46.371399 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m15:47:46.394979 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (execute): 15:47:45.843787 => 15:47:46.394777
[0m15:47:46.395391 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: Close
[0m15:47:46.446298 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m15:47:46.448789 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (execute): 15:47:45.795733 => 15:47:46.448609
[0m15:47:46.449119 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: Close
[0m15:47:46.549375 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f386c4a3-a73b-4656-ae9a-caa9c8fd745f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109f2bb10>]}
[0m15:47:46.549885 [info ] [Thread-2 (]: 2 of 2 OK created sql view model dbt_melissa_rm_epc.stg_rightmove .............. [[32mSUCCESS 1[0m in 0.76s]
[0m15:47:46.550228 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.stg_rightmove
[0m15:47:46.561610 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f386c4a3-a73b-4656-ae9a-caa9c8fd745f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a0b2d90>]}
[0m15:47:46.562080 [info ] [Thread-1 (]: 1 of 2 OK created sql view model dbt_melissa_rm_epc.stg_epc_certs .............. [[32mSUCCESS 1[0m in 0.78s]
[0m15:47:46.562414 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.stg_epc_certs
[0m15:47:46.563394 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:47:46.563566 [debug] [MainThread]: Connection 'model.rightmove_epc.stg_epc_certs' was properly closed.
[0m15:47:46.563713 [debug] [MainThread]: Connection 'model.rightmove_epc.stg_rightmove' was properly closed.
[0m15:47:46.563888 [info ] [MainThread]: 
[0m15:47:46.564057 [info ] [MainThread]: Finished running 2 view models in 0 hours 0 minutes and 2.05 seconds (2.05s).
[0m15:47:46.564428 [debug] [MainThread]: Command end result
[0m15:47:46.570693 [info ] [MainThread]: 
[0m15:47:46.570925 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:47:46.571088 [info ] [MainThread]: 
[0m15:47:46.571255 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m15:47:46.573032 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 2.369645, "process_user_time": 1.341907, "process_kernel_time": 0.170073, "process_mem_max_rss": "133283840", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m15:47:46.573373 [debug] [MainThread]: Command `dbt run` succeeded at 15:47:46.573301 after 2.37 seconds
[0m15:47:46.573600 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108e84d50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10322e210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a1e8310>]}
[0m15:47:46.573821 [debug] [MainThread]: Flushing usage events
[0m15:49:28.375371 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108b54ad0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108b9a7d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108b9b350>]}


============================== 15:49:28.378278 | 51b00709-feaa-485e-adec-334c723a72d3 ==============================
[0m15:49:28.378278 [info ] [MainThread]: Running with dbt=1.7.10
[0m15:49:28.378663 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m15:49:28.564419 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '51b00709-feaa-485e-adec-334c723a72d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10968d1d0>]}
[0m15:49:28.606962 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '51b00709-feaa-485e-adec-334c723a72d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1090bc990>]}
[0m15:49:28.608780 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m15:49:28.618887 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m15:49:28.636801 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:49:28.637114 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:49:28.640753 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '51b00709-feaa-485e-adec-334c723a72d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1096e8dd0>]}
[0m15:49:28.647975 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '51b00709-feaa-485e-adec-334c723a72d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109689690>]}
[0m15:49:28.648289 [info ] [MainThread]: Found 10 models, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m15:49:28.648513 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '51b00709-feaa-485e-adec-334c723a72d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1096b1b90>]}
[0m15:49:28.649686 [info ] [MainThread]: 
[0m15:49:28.650133 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m15:49:28.650946 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m15:49:28.658284 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m15:49:28.658573 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m15:49:28.658747 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:49:29.173984 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 1.0 seconds
[0m15:49:29.177509 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m15:49:29.257148 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m15:49:29.265715 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m15:49:29.266099 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m15:49:29.266401 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:49:29.622544 [debug] [ThreadPool]: SQL status: SUCCESS 11 in 0.0 seconds
[0m15:49:29.624761 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m15:49:29.723685 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '51b00709-feaa-485e-adec-334c723a72d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1097ebb90>]}
[0m15:49:29.724753 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m15:49:29.725169 [info ] [MainThread]: 
[0m15:49:29.728540 [debug] [Thread-1 (]: Began running node model.rightmove_epc.stg_epc_certs
[0m15:49:29.729049 [debug] [Thread-2 (]: Began running node model.rightmove_epc.stg_rightmove
[0m15:49:29.729616 [info ] [Thread-1 (]: 1 of 10 START sql view model dbt_melissa_rm_epc.stg_epc_certs .................. [RUN]
[0m15:49:29.730163 [info ] [Thread-2 (]: 2 of 10 START sql view model dbt_melissa_rm_epc.stg_rightmove .................. [RUN]
[0m15:49:29.730954 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.stg_epc_certs)
[0m15:49:29.731585 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.stg_rightmove'
[0m15:49:29.731908 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.stg_epc_certs
[0m15:49:29.732198 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.stg_rightmove
[0m15:49:29.738934 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.stg_epc_certs"
[0m15:49:29.741071 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.stg_rightmove"
[0m15:49:29.741801 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (compile): 15:49:29.732383 => 15:49:29.741621
[0m15:49:29.742115 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.stg_epc_certs
[0m15:49:29.742468 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (compile): 15:49:29.739167 => 15:49:29.742287
[0m15:49:29.795567 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.stg_epc_certs"
[0m15:49:29.795862 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.stg_rightmove
[0m15:49:29.797796 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.stg_rightmove"
[0m15:49:29.798526 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.stg_rightmove"
[0m15:49:29.799150 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.stg_epc_certs"
[0m15:49:29.799379 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_rightmove"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
  
   as (
    with rm as (

    SELECT 
    LISTING_ID,
    UPPER(TRIM(replace(REPLACE(CONCAT(ADDRESS_1::VARCHAR,ADDRESS_2::VARCHAR),' '),','))) AS ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL 
    FROM 
       ANALYTICS.RIGHTMOVE_PROD.CLEAN_RAW_RIGHTMOVE_DATA 

 
)

SELECT * FROM rm
  );
[0m15:49:29.799628 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_epc_certs"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
  
   as (
    WITH epc_certs as (
    
    select 
    UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    COUNTY,
    LOCAL_AUTHORITY as LOCAL_AUTHORITY_CODE,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    UPPER(CASE WHEN (UPPER(ADDRESS1) LIKE 'FLAT%' OR UPPER(ADDRESS1) LIKE 'UNIT%') or UPPER(ADDRESS1) LIKE 'ROOM%' 
    THEN TRIM(REPLACE(REPLACE(CONCAT(ADDRESS1,ADDRESS2,ADDRESS3),','),' '))
    ELSE trim(replace(replace(ADDRESS1,' '),',')) END) AS ADDRESSID,
    CASE WHEN UPRN is null and addressid is null THEN 1 else 0 end as REMOVE_FROM_RM_MATCH

 from  RAW.EPC_TEST_DATA.EPC_CERTIFICATES 

)

SELECT * FROM epc_certs
  );
[0m15:49:29.799846 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m15:49:29.800020 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:49:30.544584 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m15:49:30.545425 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m15:49:30.563310 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (execute): 15:49:29.742621 => 15:49:30.563143
[0m15:49:30.565063 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (execute): 15:49:29.796081 => 15:49:30.564931
[0m15:49:30.565410 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: Close
[0m15:49:30.565727 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: Close
[0m15:49:30.654250 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '51b00709-feaa-485e-adec-334c723a72d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1097cbfd0>]}
[0m15:49:30.654919 [info ] [Thread-1 (]: 1 of 10 OK created sql view model dbt_melissa_rm_epc.stg_epc_certs ............. [[32mSUCCESS 1[0m in 0.92s]
[0m15:49:30.655423 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.stg_epc_certs
[0m15:49:30.686386 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '51b00709-feaa-485e-adec-334c723a72d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10978bc50>]}
[0m15:49:30.687031 [info ] [Thread-2 (]: 2 of 10 OK created sql view model dbt_melissa_rm_epc.stg_rightmove ............. [[32mSUCCESS 1[0m in 0.96s]
[0m15:49:30.687483 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.stg_rightmove
[0m15:49:30.688069 [debug] [Thread-4 (]: Began running node model.rightmove_epc.dim_addressid
[0m15:49:30.688495 [info ] [Thread-4 (]: 3 of 10 START sql view model dbt_melissa_rm_epc.dim_addressid .................. [RUN]
[0m15:49:30.688861 [debug] [Thread-3 (]: Began running node model.rightmove_epc.dim_uprn
[0m15:49:30.689159 [debug] [Thread-1 (]: Began running node model.rightmove_epc.uprn_match
[0m15:49:30.689679 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_addressid'
[0m15:49:30.689982 [info ] [Thread-3 (]: 4 of 10 START sql view model dbt_melissa_rm_epc.dim_uprn ....................... [RUN]
[0m15:49:30.690296 [info ] [Thread-1 (]: 5 of 10 START sql view model dbt_melissa_rm_epc.uprn_match ..................... [RUN]
[0m15:49:30.690588 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.dim_addressid
[0m15:49:30.691094 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_uprn'
[0m15:49:30.691519 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_epc_certs, now model.rightmove_epc.uprn_match)
[0m15:49:30.693909 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.dim_addressid"
[0m15:49:30.694191 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.dim_uprn
[0m15:49:30.694462 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.uprn_match
[0m15:49:30.696897 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.dim_uprn"
[0m15:49:30.699203 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.uprn_match"
[0m15:49:30.699631 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_addressid (compile): 15:49:30.691682 => 15:49:30.699402
[0m15:49:30.700136 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.dim_addressid
[0m15:49:30.702682 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.dim_addressid"
[0m15:49:30.703001 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.dim_uprn (compile): 15:49:30.694832 => 15:49:30.702870
[0m15:49:30.703257 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.uprn_match (compile): 15:49:30.697197 => 15:49:30.703128
[0m15:49:30.703544 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.dim_uprn
[0m15:49:30.703788 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.uprn_match
[0m15:49:30.705757 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.dim_uprn"
[0m15:49:30.706467 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.dim_addressid"
[0m15:49:30.708354 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.uprn_match"
[0m15:49:30.708694 [debug] [Thread-4 (]: On model.rightmove_epc.dim_addressid: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_addressid"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
  
   as (
    with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource,
    POSTCODE,
    TOTAL_FLOOR_AREA

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    where REMOVE_FROM_RM_MATCH = 1

),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE,
    NULL AS TOTAL_FLOOR_AREA -- quick fix for now
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where uprn is null
and addressid is not null
  );
[0m15:49:30.709020 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m15:49:30.709640 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.dim_uprn"
[0m15:49:30.710313 [debug] [Thread-3 (]: On model.rightmove_epc.dim_uprn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_uprn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
  
   as (
    with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource,
    POSTCODE,
    TOTAL_FLOOR_AREA

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    where REMOVE_FROM_RM_MATCH = 1
),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE,
    NULL AS TOTAL_FLOOR_AREA

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where uprn is not null
  );
[0m15:49:30.711182 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.uprn_match"
[0m15:49:30.711394 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m15:49:30.711627 [debug] [Thread-1 (]: On model.rightmove_epc.uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
  
   as (
    with epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    where uprn is not null
    AND REMOVE_FROM_RM_MATCH = 1

),

rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where uprn is not null
),

final as (

    select 
    LISTING_ID,
    rm.ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    rm.UPRN,
    rm.LOCAL_AUTHORITY_CODE,
    rm.LOCAL_AUTHORITY,
    rm.GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    epc.UPRN AS EPC_UPRN,
    epc.TOTAL_FLOOR_AREA,
    epc.ADDRESSID as EPC_ADDRESSID,
    CASE WHEN epc.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC    
    
     from rm left join epc on rm.uprn = epc.uprn
)

select * from final
  );
[0m15:49:30.712089 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:49:31.261445 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m15:49:31.265876 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_addressid (execute): 15:49:30.700402 => 15:49:31.265596
[0m15:49:31.266407 [debug] [Thread-4 (]: On model.rightmove_epc.dim_addressid: Close
[0m15:49:31.286006 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m15:49:31.290187 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.dim_uprn (execute): 15:49:30.703931 => 15:49:31.290012
[0m15:49:31.290519 [debug] [Thread-3 (]: On model.rightmove_epc.dim_uprn: Close
[0m15:49:31.463217 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '51b00709-feaa-485e-adec-334c723a72d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109cd1550>]}
[0m15:49:31.464332 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '51b00709-feaa-485e-adec-334c723a72d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109c36850>]}
[0m15:49:31.465286 [info ] [Thread-3 (]: 4 of 10 OK created sql view model dbt_melissa_rm_epc.dim_uprn .................. [[32mSUCCESS 1[0m in 0.77s]
[0m15:49:31.466225 [info ] [Thread-4 (]: 3 of 10 OK created sql view model dbt_melissa_rm_epc.dim_addressid ............. [[32mSUCCESS 1[0m in 0.77s]
[0m15:49:31.467008 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.dim_uprn
[0m15:49:31.467570 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.dim_addressid
[0m15:49:31.468610 [debug] [Thread-2 (]: Began running node model.rightmove_epc.address_match
[0m15:49:31.469205 [debug] [Thread-3 (]: Began running node model.rightmove_epc.address_simularity
[0m15:49:31.469969 [info ] [Thread-2 (]: 6 of 10 START sql view model dbt_melissa_rm_epc.address_match .................. [RUN]
[0m15:49:31.470693 [info ] [Thread-3 (]: 7 of 10 START sql view model dbt_melissa_rm_epc.address_simularity ............. [RUN]
[0m15:49:31.471805 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_rightmove, now model.rightmove_epc.address_match)
[0m15:49:31.472788 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.dim_uprn, now model.rightmove_epc.address_simularity)
[0m15:49:31.473262 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.address_match
[0m15:49:31.473628 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.address_simularity
[0m15:49:31.476655 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.address_match"
[0m15:49:31.480296 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.address_simularity"
[0m15:49:31.481018 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m15:49:31.483647 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.uprn_match (execute): 15:49:30.706676 => 15:49:31.483469
[0m15:49:31.484120 [debug] [Thread-1 (]: On model.rightmove_epc.uprn_match: Close
[0m15:49:31.484628 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.address_match (compile): 15:49:31.473867 => 15:49:31.484357
[0m15:49:31.485555 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.address_simularity (compile): 15:49:31.477472 => 15:49:31.485355
[0m15:49:31.485907 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.address_match
[0m15:49:31.486442 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.address_simularity
[0m15:49:31.488953 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.address_match"
[0m15:49:31.490721 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.address_simularity"
[0m15:49:31.491883 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.address_match"
[0m15:49:31.492138 [debug] [Thread-2 (]: On model.rightmove_epc.address_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.address_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NULL
),

epc_address as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
    where datasource = 'EPC'
)


SELECT rm.*,
epc_address.addressid
as EPC_ADDRESSID,
CASE WHEN epc_address.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC ,
TOTAL_FLOOR_AREA  

FROM rm
LEFT JOIN epc_address
ON rm.addressid = epc_address.addressid
and rm.FULL_POSTCODE = epc_address.POSTCODE
  );
[0m15:49:31.492642 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.address_simularity"
[0m15:49:31.492850 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m15:49:31.493092 [debug] [Thread-3 (]: On model.rightmove_epc.address_simularity: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.address_simularity"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.address_simularity
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NULL
),

epc_address as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
    where datasource = 'EPC'
)


SELECT rm.*,epc_address.addressid as EPC_ADDRESSID
FROM rm
JOIN epc_address
ON JAROWINKLER_SIMILARITY(rm.addressid, epc_address.addressid) = 1
  );
[0m15:49:31.493699 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m15:49:31.626830 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '51b00709-feaa-485e-adec-334c723a72d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1097034d0>]}
[0m15:49:31.627441 [info ] [Thread-1 (]: 5 of 10 OK created sql view model dbt_melissa_rm_epc.uprn_match ................ [[32mSUCCESS 1[0m in 0.94s]
[0m15:49:31.627913 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.uprn_match
[0m15:49:31.628423 [debug] [Thread-4 (]: Began running node model.rightmove_epc.no_uprn_match
[0m15:49:31.628875 [info ] [Thread-4 (]: 8 of 10 START sql view model dbt_melissa_rm_epc.no_uprn_match .................. [RUN]
[0m15:49:31.629540 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.dim_addressid, now model.rightmove_epc.no_uprn_match)
[0m15:49:31.629889 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.no_uprn_match
[0m15:49:31.632533 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.no_uprn_match"
[0m15:49:31.633191 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.no_uprn_match (compile): 15:49:31.630070 => 15:49:31.633028
[0m15:49:31.633456 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.no_uprn_match
[0m15:49:31.635861 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.no_uprn_match"
[0m15:49:31.636804 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.no_uprn_match"
[0m15:49:31.637124 [debug] [Thread-4 (]: On model.rightmove_epc.no_uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.no_uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.no_uprn_match
  
   as (
    with rm_no_match_to_epc  as ( -- rightmove uspn does not match epc

    select 
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL

     from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'NO'
    
)

select * from rm_no_match_to_epc

/*
epc_remove as (

    select EPC_UPRN,EPC_ADDRESSID from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'YES'  -- 
),

epc_matched as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs src
    left join epc_remove rem on src.UPRN = rem.EPC_UPRN
    
),

epc_fm_prep as (

    select * from epc_matched
    where EPC_UPRN is NULL

    
)


SELECT * FROM epc_fm_prep
WHERE UPRN NOT NULL */
  );
[0m15:49:31.637433 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m15:49:32.062928 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m15:49:32.067763 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.address_simularity (execute): 15:49:31.489177 => 15:49:32.067431
[0m15:49:32.068366 [debug] [Thread-3 (]: On model.rightmove_epc.address_simularity: Close
[0m15:49:32.085220 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m15:49:32.088508 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.address_match (execute): 15:49:31.486660 => 15:49:32.088283
[0m15:49:32.088931 [debug] [Thread-2 (]: On model.rightmove_epc.address_match: Close
[0m15:49:32.094801 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m15:49:32.097617 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.no_uprn_match (execute): 15:49:31.633609 => 15:49:32.097418
[0m15:49:32.097995 [debug] [Thread-4 (]: On model.rightmove_epc.no_uprn_match: Close
[0m15:49:32.160953 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '51b00709-feaa-485e-adec-334c723a72d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109c35ad0>]}
[0m15:49:32.161749 [info ] [Thread-3 (]: 7 of 10 OK created sql view model dbt_melissa_rm_epc.address_simularity ........ [[32mSUCCESS 1[0m in 0.69s]
[0m15:49:32.162396 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.address_simularity
[0m15:49:32.169448 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '51b00709-feaa-485e-adec-334c723a72d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108bdd690>]}
[0m15:49:32.170166 [info ] [Thread-2 (]: 6 of 10 OK created sql view model dbt_melissa_rm_epc.address_match ............. [[32mSUCCESS 1[0m in 0.70s]
[0m15:49:32.170803 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.address_match
[0m15:49:32.171476 [debug] [Thread-1 (]: Began running node model.rightmove_epc.all_matches
[0m15:49:32.171978 [info ] [Thread-1 (]: 9 of 10 START sql view model dbt_melissa_rm_epc.all_matches .................... [RUN]
[0m15:49:32.172378 [debug] [Thread-3 (]: Began running node model.rightmove_epc.no_matches
[0m15:49:32.173005 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.uprn_match, now model.rightmove_epc.all_matches)
[0m15:49:32.173526 [info ] [Thread-3 (]: 10 of 10 START sql view model dbt_melissa_rm_epc.no_matches .................... [RUN]
[0m15:49:32.174116 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.all_matches
[0m15:49:32.174785 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.address_simularity, now model.rightmove_epc.no_matches)
[0m15:49:32.175941 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.no_matches
[0m15:49:32.178927 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.all_matches"
[0m15:49:32.181536 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.no_matches"
[0m15:49:32.182782 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.all_matches (compile): 15:49:32.175022 => 15:49:32.182546
[0m15:49:32.183218 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.no_matches (compile): 15:49:32.179179 => 15:49:32.183010
[0m15:49:32.183514 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.all_matches
[0m15:49:32.183813 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.no_matches
[0m15:49:32.184563 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '51b00709-feaa-485e-adec-334c723a72d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109cca690>]}
[0m15:49:32.187330 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.all_matches"
[0m15:49:32.189682 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.no_matches"
[0m15:49:32.190189 [info ] [Thread-4 (]: 8 of 10 OK created sql view model dbt_melissa_rm_epc.no_uprn_match ............. [[32mSUCCESS 1[0m in 0.56s]
[0m15:49:32.190804 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.no_uprn_match
[0m15:49:32.192069 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.no_matches"
[0m15:49:32.193035 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.all_matches"
[0m15:49:32.193359 [debug] [Thread-3 (]: On model.rightmove_epc.no_matches: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.no_matches"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.no_matches
  
   as (
    with addr as (

    select 
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    '' AS EPC_UPRN,
    EPC_ADDRESSID
    
    from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
    where MATCH_EPC = 'NO' 
),

uprn as (

    select 
    
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN::VARCHAR AS EPC_UPRN,
    EPC_ADDRESSID
    
     from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'NO'
),

final as (

select 'NO ADDRESS OR UPRN MATCH' AS MATCH_RESULT, * from addr
union all
select 'NO UPRN MATCH' AS MATCH_RESULT, * from uprn
)

select * from final
  );
[0m15:49:32.193743 [debug] [Thread-1 (]: On model.rightmove_epc.all_matches: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.all_matches"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.all_matches
  
   as (
    with addr as (

    select 
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    '' AS EPC_UPRN,
    EPC_ADDRESSID,
    TOTAL_FLOOR_AREA
    
    from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
    where MATCH_EPC = 'YES' 
),

uprn as (

    select 
    
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN::VARCHAR AS EPC_UPRN,
    EPC_ADDRESSID,
    TOTAL_FLOOR_AREA
     from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'YES'
),

final as (

select 'ADDRESS AND POSTCODE MATCH' AS MATCH_RESULT, * from addr
union all
select 'UPRN MATCH' AS MATCH_RESULT, * from uprn
)

select * from final
  );
[0m15:49:32.194030 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m15:49:32.194276 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:49:32.772441 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m15:49:32.775523 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.all_matches (execute): 15:49:32.184838 => 15:49:32.775292
[0m15:49:32.775954 [debug] [Thread-1 (]: On model.rightmove_epc.all_matches: Close
[0m15:49:32.866019 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '51b00709-feaa-485e-adec-334c723a72d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b972d90>]}
[0m15:49:32.866804 [info ] [Thread-1 (]: 9 of 10 OK created sql view model dbt_melissa_rm_epc.all_matches ............... [[32mSUCCESS 1[0m in 0.69s]
[0m15:49:32.867407 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.all_matches
[0m15:49:33.039118 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m15:49:33.042070 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.no_matches (execute): 15:49:32.187567 => 15:49:33.041854
[0m15:49:33.042500 [debug] [Thread-3 (]: On model.rightmove_epc.no_matches: Close
[0m15:49:33.131157 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '51b00709-feaa-485e-adec-334c723a72d3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109750fd0>]}
[0m15:49:33.132043 [info ] [Thread-3 (]: 10 of 10 OK created sql view model dbt_melissa_rm_epc.no_matches ............... [[32mSUCCESS 1[0m in 0.96s]
[0m15:49:33.132796 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.no_matches
[0m15:49:33.135021 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:49:33.135507 [debug] [MainThread]: Connection 'model.rightmove_epc.all_matches' was properly closed.
[0m15:49:33.135844 [debug] [MainThread]: Connection 'model.rightmove_epc.address_match' was properly closed.
[0m15:49:33.136146 [debug] [MainThread]: Connection 'model.rightmove_epc.no_uprn_match' was properly closed.
[0m15:49:33.136442 [debug] [MainThread]: Connection 'model.rightmove_epc.no_matches' was properly closed.
[0m15:49:33.136878 [info ] [MainThread]: 
[0m15:49:33.137262 [info ] [MainThread]: Finished running 10 view models in 0 hours 0 minutes and 4.49 seconds (4.49s).
[0m15:49:33.138814 [debug] [MainThread]: Command end result
[0m15:49:33.147479 [info ] [MainThread]: 
[0m15:49:33.147924 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:49:33.148254 [info ] [MainThread]: 
[0m15:49:33.148532 [info ] [MainThread]: Done. PASS=10 WARN=0 ERROR=0 SKIP=0 TOTAL=10
[0m15:49:33.150637 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.806628, "process_user_time": 1.729784, "process_kernel_time": 0.20883, "process_mem_max_rss": "138248192", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m15:49:33.151102 [debug] [MainThread]: Command `dbt run` succeeded at 15:49:33.151002 after 4.81 seconds
[0m15:49:33.151418 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108554090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102a06010>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102c0df90>]}
[0m15:49:33.151723 [debug] [MainThread]: Flushing usage events
[0m10:02:56.993981 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113218a10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11325e550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11325f010>]}


============================== 10:02:56.996249 | fcb285aa-caf5-4630-8078-e78555b652b1 ==============================
[0m10:02:56.996249 [info ] [MainThread]: Running with dbt=1.7.10
[0m10:02:56.996589 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run --select models/staging', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m10:02:57.140286 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fcb285aa-caf5-4630-8078-e78555b652b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113e697d0>]}
[0m10:02:57.176423 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'fcb285aa-caf5-4630-8078-e78555b652b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1132a8910>]}
[0m10:02:57.177273 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m10:02:57.186851 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m10:02:57.205142 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:02:57.205418 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:02:57.208626 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'fcb285aa-caf5-4630-8078-e78555b652b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11325ded0>]}
[0m10:02:57.214738 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'fcb285aa-caf5-4630-8078-e78555b652b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113f60590>]}
[0m10:02:57.215012 [info ] [MainThread]: Found 10 models, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m10:02:57.215225 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fcb285aa-caf5-4630-8078-e78555b652b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113f6acd0>]}
[0m10:02:57.216209 [info ] [MainThread]: 
[0m10:02:57.216606 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m10:02:57.217153 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m10:02:57.223537 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m10:02:57.223786 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m10:02:57.223943 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:02:57.722034 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 0.0 seconds
[0m10:02:57.724487 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m10:02:57.815080 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m10:02:57.822758 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m10:02:57.823121 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m10:02:57.823391 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:02:58.283646 [debug] [ThreadPool]: SQL status: SUCCESS 11 in 0.0 seconds
[0m10:02:58.288257 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m10:02:58.369476 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fcb285aa-caf5-4630-8078-e78555b652b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113bc88d0>]}
[0m10:02:58.370325 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m10:02:58.370635 [info ] [MainThread]: 
[0m10:02:58.373467 [debug] [Thread-1 (]: Began running node model.rightmove_epc.stg_epc_certs
[0m10:02:58.373818 [debug] [Thread-2 (]: Began running node model.rightmove_epc.stg_rightmove
[0m10:02:58.374310 [info ] [Thread-1 (]: 1 of 2 START sql view model dbt_melissa_rm_epc.stg_epc_certs ................... [RUN]
[0m10:02:58.374771 [info ] [Thread-2 (]: 2 of 2 START sql view model dbt_melissa_rm_epc.stg_rightmove ................... [RUN]
[0m10:02:58.375377 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.stg_epc_certs)
[0m10:02:58.375935 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.stg_rightmove'
[0m10:02:58.376264 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.stg_epc_certs
[0m10:02:58.376709 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.stg_rightmove
[0m10:02:58.382820 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.stg_epc_certs"
[0m10:02:58.385037 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.stg_rightmove"
[0m10:02:58.386162 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (compile): 10:02:58.376985 => 10:02:58.385925
[0m10:02:58.386523 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (compile): 10:02:58.383078 => 10:02:58.386335
[0m10:02:58.386828 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.stg_epc_certs
[0m10:02:58.387130 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.stg_rightmove
[0m10:02:58.433779 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.stg_epc_certs"
[0m10:02:58.435438 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.stg_rightmove"
[0m10:02:58.436390 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.stg_epc_certs"
[0m10:02:58.436876 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.stg_rightmove"
[0m10:02:58.437106 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_epc_certs"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
  
   as (
    WITH epc_certs as (
    
    select 
    UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    COUNTY,
    LOCAL_AUTHORITY as LOCAL_AUTHORITY_CODE,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    UPPER(CASE WHEN (UPPER(ADDRESS1) LIKE 'FLAT%' OR UPPER(ADDRESS1) LIKE 'UNIT%') or UPPER(ADDRESS1) LIKE 'ROOM%' 
    THEN TRIM(REPLACE(REPLACE(CONCAT(ADDRESS1,ADDRESS2,ADDRESS3),','),' '))
    ELSE trim(replace(replace(ADDRESS1,' '),',')) END) AS ADDRESSID,
    CASE WHEN UPRN is null and addressid is null THEN 1 else 0 end as REMOVE_FROM_RM_MATCH,
    FLOOR_LEVEL,
    FLAT_TOP_STOREY,
    FLAT_STOREY_COUNT,
    PROPERTY_TYPE
 from  RAW.EPC_TEST_DATA.EPC_CERTIFICATES 

)

SELECT * FROM epc_certs
  );
[0m10:02:58.437348 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_rightmove"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
  
   as (
    with rm as (

    SELECT 
    LISTING_ID,
    UPPER(TRIM(replace(REPLACE(CONCAT(ADDRESS_1::VARCHAR,ADDRESS_2::VARCHAR),' '),','))) AS ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, 
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    STUDENTLET_FLAG,
    COMBINED_PROPERTY_TYPE
    -- property type
    FROM 
       ANALYTICS.RIGHTMOVE_PROD.CLEAN_RAW_RIGHTMOVE_DATA 

 
)

SELECT * FROM rm
  );
[0m10:02:58.437539 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:02:58.437702 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m10:02:58.962124 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m10:02:58.980422 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (execute): 10:02:58.433978 => 10:02:58.980246
[0m10:02:58.980768 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: Close
[0m10:02:59.029857 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m10:02:59.031973 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (execute): 10:02:58.387337 => 10:02:59.031817
[0m10:02:59.032263 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: Close
[0m10:02:59.063350 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fcb285aa-caf5-4630-8078-e78555b652b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113f125d0>]}
[0m10:02:59.064136 [info ] [Thread-2 (]: 2 of 2 OK created sql view model dbt_melissa_rm_epc.stg_rightmove .............. [[32mSUCCESS 1[0m in 0.69s]
[0m10:02:59.064788 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.stg_rightmove
[0m10:02:59.111978 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fcb285aa-caf5-4630-8078-e78555b652b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11325ded0>]}
[0m10:02:59.112659 [info ] [Thread-1 (]: 1 of 2 OK created sql view model dbt_melissa_rm_epc.stg_epc_certs .............. [[32mSUCCESS 1[0m in 0.74s]
[0m10:02:59.113174 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.stg_epc_certs
[0m10:02:59.114940 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:02:59.115268 [debug] [MainThread]: Connection 'model.rightmove_epc.stg_epc_certs' was properly closed.
[0m10:02:59.115524 [debug] [MainThread]: Connection 'model.rightmove_epc.stg_rightmove' was properly closed.
[0m10:02:59.115822 [info ] [MainThread]: 
[0m10:02:59.116109 [info ] [MainThread]: Finished running 2 view models in 0 hours 0 minutes and 1.90 seconds (1.90s).
[0m10:02:59.116667 [debug] [MainThread]: Command end result
[0m10:02:59.123116 [info ] [MainThread]: 
[0m10:02:59.123399 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:02:59.123601 [info ] [MainThread]: 
[0m10:02:59.123819 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m10:02:59.144895 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 2.1761746, "process_user_time": 1.183998, "process_kernel_time": 0.152029, "process_mem_max_rss": "136232960", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m10:02:59.145395 [debug] [MainThread]: Command `dbt run` succeeded at 10:02:59.145301 after 2.18 seconds
[0m10:02:59.145677 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113287e10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10375a0d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103606210>]}
[0m10:02:59.145951 [debug] [MainThread]: Flushing usage events
[0m10:12:23.387841 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108c18650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108c53310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108c5eed0>]}


============================== 10:12:23.390456 | 28a9b992-48c2-40f9-b4d7-eb0184468f35 ==============================
[0m10:12:23.390456 [info ] [MainThread]: Running with dbt=1.7.10
[0m10:12:23.390774 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'version_check': 'True', 'profiles_dir': '/Users/melissabee/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run --select models/staging', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m10:12:23.558679 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '28a9b992-48c2-40f9-b4d7-eb0184468f35', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108c37650>]}
[0m10:12:23.594112 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '28a9b992-48c2-40f9-b4d7-eb0184468f35', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a9a3bd0>]}
[0m10:12:23.594739 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m10:12:23.604338 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m10:12:23.627702 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:12:23.627988 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:12:23.631202 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '28a9b992-48c2-40f9-b4d7-eb0184468f35', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a9a2150>]}
[0m10:12:23.637511 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '28a9b992-48c2-40f9-b4d7-eb0184468f35', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a6fee50>]}
[0m10:12:23.637782 [info ] [MainThread]: Found 10 models, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m10:12:23.637977 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '28a9b992-48c2-40f9-b4d7-eb0184468f35', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108ca9510>]}
[0m10:12:23.638880 [info ] [MainThread]: 
[0m10:12:23.639262 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m10:12:23.639854 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m10:12:23.646053 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m10:12:23.646282 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m10:12:23.646427 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:12:24.349563 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 1.0 seconds
[0m10:12:24.352163 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m10:12:24.436845 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m10:12:24.443832 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m10:12:24.444159 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m10:12:24.444391 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:12:24.773461 [debug] [ThreadPool]: SQL status: SUCCESS 11 in 0.0 seconds
[0m10:12:24.775835 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m10:12:24.860900 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '28a9b992-48c2-40f9-b4d7-eb0184468f35', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a6c9a50>]}
[0m10:12:24.861691 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m10:12:24.862087 [info ] [MainThread]: 
[0m10:12:24.864886 [debug] [Thread-1 (]: Began running node model.rightmove_epc.stg_epc_certs
[0m10:12:24.865218 [debug] [Thread-2 (]: Began running node model.rightmove_epc.stg_rightmove
[0m10:12:24.865625 [info ] [Thread-1 (]: 1 of 2 START sql view model dbt_melissa_rm_epc.stg_epc_certs ................... [RUN]
[0m10:12:24.866049 [info ] [Thread-2 (]: 2 of 2 START sql view model dbt_melissa_rm_epc.stg_rightmove ................... [RUN]
[0m10:12:24.866658 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.stg_epc_certs)
[0m10:12:24.867279 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.stg_rightmove'
[0m10:12:24.867654 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.stg_epc_certs
[0m10:12:24.868035 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.stg_rightmove
[0m10:12:24.874998 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.stg_epc_certs"
[0m10:12:24.877420 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.stg_rightmove"
[0m10:12:24.878227 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (compile): 10:12:24.868245 => 10:12:24.877987
[0m10:12:24.878590 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (compile): 10:12:24.875321 => 10:12:24.878437
[0m10:12:24.878842 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.stg_epc_certs
[0m10:12:24.879116 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.stg_rightmove
[0m10:12:24.931257 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.stg_epc_certs"
[0m10:12:24.933046 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.stg_rightmove"
[0m10:12:24.933886 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.stg_rightmove"
[0m10:12:24.934120 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_rightmove"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
  
   as (
    with rm as (

    SELECT 
    LISTING_ID,
    UPPER(TRIM(replace(REPLACE(CONCAT(ADDRESS_1::VARCHAR,ADDRESS_2::VARCHAR),' '),','))) AS ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, 
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    STUDENTLET_FLAG,
    COMBINED_PROPERTY_TYPE
    -- property type
    FROM 
       ANALYTICS.RIGHTMOVE_PROD.CLEAN_RAW_RIGHTMOVE_DATA 

 
)

SELECT * FROM rm
  );
[0m10:12:24.934695 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.stg_epc_certs"
[0m10:12:24.934871 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m10:12:24.935071 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_epc_certs"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
  
   as (
    WITH epc_certs as (
    
    select 
    UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    COUNTY,
    LOCAL_AUTHORITY as LOCAL_AUTHORITY_CODE,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    UPPER(CASE WHEN (UPPER(ADDRESS1) LIKE 'FLAT%' OR UPPER(ADDRESS1) LIKE 'UNIT%') or UPPER(ADDRESS1) LIKE 'ROOM%' 
    THEN TRIM(REPLACE(REPLACE(CONCAT(ADDRESS),','),' '))
    ELSE trim(replace(replace(ADDRESS1,' '),',')) END) AS ADDRESSID,
    CASE WHEN UPRN is null and addressid is null THEN 1 else 0 end as REMOVE_FROM_RM_MATCH,
    FLOOR_LEVEL,
    FLAT_TOP_STOREY,
    FLAT_STOREY_COUNT,
    PROPERTY_TYPE
 from  RAW.EPC_TEST_DATA.EPC_CERTIFICATES 

)

SELECT * FROM epc_certs
  );
[0m10:12:24.935806 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:12:25.464116 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m10:12:25.481984 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (execute): 10:12:24.879261 => 10:12:25.481816
[0m10:12:25.482588 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m10:12:25.482887 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: Close
[0m10:12:25.484855 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (execute): 10:12:24.931457 => 10:12:25.484724
[0m10:12:25.485760 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: Close
[0m10:12:25.567223 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '28a9b992-48c2-40f9-b4d7-eb0184468f35', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a98a090>]}
[0m10:12:25.567797 [info ] [Thread-2 (]: 2 of 2 OK created sql view model dbt_melissa_rm_epc.stg_rightmove .............. [[32mSUCCESS 1[0m in 0.70s]
[0m10:12:25.568186 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.stg_rightmove
[0m10:12:25.600477 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '28a9b992-48c2-40f9-b4d7-eb0184468f35', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a912710>]}
[0m10:12:25.601041 [info ] [Thread-1 (]: 1 of 2 OK created sql view model dbt_melissa_rm_epc.stg_epc_certs .............. [[32mSUCCESS 1[0m in 0.73s]
[0m10:12:25.601502 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.stg_epc_certs
[0m10:12:25.602808 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:12:25.603080 [debug] [MainThread]: Connection 'model.rightmove_epc.stg_epc_certs' was properly closed.
[0m10:12:25.603294 [debug] [MainThread]: Connection 'model.rightmove_epc.stg_rightmove' was properly closed.
[0m10:12:25.603538 [info ] [MainThread]: 
[0m10:12:25.603778 [info ] [MainThread]: Finished running 2 view models in 0 hours 0 minutes and 1.96 seconds (1.96s).
[0m10:12:25.604276 [debug] [MainThread]: Command end result
[0m10:12:25.610381 [info ] [MainThread]: 
[0m10:12:25.610724 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:12:25.610940 [info ] [MainThread]: 
[0m10:12:25.611159 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m10:12:25.613005 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 2.2547157, "process_user_time": 1.18407, "process_kernel_time": 0.149837, "process_mem_max_rss": "135249920", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m10:12:25.613412 [debug] [MainThread]: Command `dbt run` succeeded at 10:12:25.613330 after 2.26 seconds
[0m10:12:25.613675 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10350e0d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1033ba210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1033d2350>]}
[0m10:12:25.613933 [debug] [MainThread]: Flushing usage events
[0m10:22:16.450772 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10726c310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1072b2a10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1072b3550>]}


============================== 10:22:16.453480 | 6ee09048-1a0d-42ed-821a-3d2275f60b54 ==============================
[0m10:22:16.453480 [info ] [MainThread]: Running with dbt=1.7.10
[0m10:22:16.453810 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt run', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m10:22:16.621201 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6ee09048-1a0d-42ed-821a-3d2275f60b54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107bf1a50>]}
[0m10:22:16.657312 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6ee09048-1a0d-42ed-821a-3d2275f60b54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1072e8b90>]}
[0m10:22:16.657994 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m10:22:16.667431 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m10:22:16.689513 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:22:16.689799 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:22:16.693008 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6ee09048-1a0d-42ed-821a-3d2275f60b54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107d29f90>]}
[0m10:22:16.698986 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6ee09048-1a0d-42ed-821a-3d2275f60b54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107d1ba50>]}
[0m10:22:16.699248 [info ] [MainThread]: Found 11 models, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m10:22:16.699443 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6ee09048-1a0d-42ed-821a-3d2275f60b54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107a019d0>]}
[0m10:22:16.700462 [info ] [MainThread]: 
[0m10:22:16.700868 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m10:22:16.701557 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m10:22:16.708058 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m10:22:16.708321 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m10:22:16.708473 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:22:17.154609 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 0.0 seconds
[0m10:22:17.156600 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m10:22:17.247878 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m10:22:17.255437 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m10:22:17.255841 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m10:22:17.256157 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:22:17.666291 [debug] [ThreadPool]: SQL status: SUCCESS 11 in 0.0 seconds
[0m10:22:17.669011 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m10:22:17.758073 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6ee09048-1a0d-42ed-821a-3d2275f60b54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107f7a6d0>]}
[0m10:22:17.759283 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m10:22:17.759607 [info ] [MainThread]: 
[0m10:22:17.761840 [debug] [Thread-1 (]: Began running node model.rightmove_epc.stg_epc_certs
[0m10:22:17.762228 [debug] [Thread-2 (]: Began running node model.rightmove_epc.stg_rightmove
[0m10:22:17.762667 [info ] [Thread-1 (]: 1 of 10 START sql view model dbt_melissa_rm_epc.stg_epc_certs .................. [RUN]
[0m10:22:17.763088 [info ] [Thread-2 (]: 2 of 10 START sql view model dbt_melissa_rm_epc.stg_rightmove .................. [RUN]
[0m10:22:17.763706 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.stg_epc_certs)
[0m10:22:17.764285 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.stg_rightmove'
[0m10:22:17.764849 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.stg_epc_certs
[0m10:22:17.765376 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.stg_rightmove
[0m10:22:17.773594 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.stg_epc_certs"
[0m10:22:17.776013 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.stg_rightmove"
[0m10:22:17.776861 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (compile): 10:22:17.765688 => 10:22:17.776658
[0m10:22:17.777227 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.stg_epc_certs
[0m10:22:17.777676 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (compile): 10:22:17.773881 => 10:22:17.777426
[0m10:22:17.828897 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.stg_epc_certs"
[0m10:22:17.829180 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.stg_rightmove
[0m10:22:17.830878 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.stg_rightmove"
[0m10:22:17.831635 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.stg_epc_certs"
[0m10:22:17.831876 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_epc_certs"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
  
   as (
    WITH epc_certs as (
    
    select 
    UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    COUNTY,
    LOCAL_AUTHORITY as LOCAL_AUTHORITY_CODE,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    UPPER(CASE WHEN (UPPER(ADDRESS1) LIKE 'FLAT%' OR UPPER(ADDRESS1) LIKE 'UNIT%') or UPPER(ADDRESS1) LIKE 'ROOM%' 
    THEN TRIM(REPLACE(REPLACE(CONCAT(ADDRESS),','),' '))
    ELSE trim(replace(replace(ADDRESS1,' '),',')) END) AS ADDRESSID,
    CASE WHEN UPRN is null and addressid is null THEN 1 else 0 end as REMOVE_FROM_RM_MATCH,
    FLOOR_LEVEL,
    FLAT_TOP_STOREY,
    FLAT_STOREY_COUNT,
    PROPERTY_TYPE
 from  RAW.EPC_TEST_DATA.EPC_CERTIFICATES 

)

SELECT * FROM epc_certs
  );
[0m10:22:17.832369 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.stg_rightmove"
[0m10:22:17.832548 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:22:17.832744 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_rightmove"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
  
   as (
    with rm as (

    SELECT 
    LISTING_ID,
    UPPER(TRIM(replace(REPLACE(CONCAT(ADDRESS_1::VARCHAR,ADDRESS_2::VARCHAR),' '),','))) AS ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, 
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    STUDENTLET_FLAG,
    COMBINED_PROPERTY_TYPE
    -- property type
    FROM 
       ANALYTICS.RIGHTMOVE_PROD.CLEAN_RAW_RIGHTMOVE_DATA 

 
)

SELECT * FROM rm
  );
[0m10:22:17.833266 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m10:22:18.282298 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m10:22:18.302938 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (execute): 10:22:17.777912 => 10:22:18.302766
[0m10:22:18.303356 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: Close
[0m10:22:18.373616 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m10:22:18.375972 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (execute): 10:22:17.829380 => 10:22:18.375793
[0m10:22:18.376302 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: Close
[0m10:22:18.383515 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6ee09048-1a0d-42ed-821a-3d2275f60b54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106deb390>]}
[0m10:22:18.384088 [info ] [Thread-1 (]: 1 of 10 OK created sql view model dbt_melissa_rm_epc.stg_epc_certs ............. [[32mSUCCESS 1[0m in 0.62s]
[0m10:22:18.384571 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.stg_epc_certs
[0m10:22:18.472561 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6ee09048-1a0d-42ed-821a-3d2275f60b54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107cf2790>]}
[0m10:22:18.473404 [info ] [Thread-2 (]: 2 of 10 OK created sql view model dbt_melissa_rm_epc.stg_rightmove ............. [[32mSUCCESS 1[0m in 0.71s]
[0m10:22:18.474044 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.stg_rightmove
[0m10:22:18.474711 [debug] [Thread-4 (]: Began running node model.rightmove_epc.dim_addressid
[0m10:22:18.475093 [debug] [Thread-3 (]: Began running node model.rightmove_epc.dim_uprn
[0m10:22:18.475456 [info ] [Thread-4 (]: 3 of 10 START sql view model dbt_melissa_rm_epc.dim_addressid .................. [RUN]
[0m10:22:18.475822 [debug] [Thread-1 (]: Began running node model.rightmove_epc.uprn_match
[0m10:22:18.476211 [info ] [Thread-3 (]: 4 of 10 START sql view model dbt_melissa_rm_epc.dim_uprn ....................... [RUN]
[0m10:22:18.476926 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_addressid'
[0m10:22:18.477327 [info ] [Thread-1 (]: 5 of 10 START sql view model dbt_melissa_rm_epc.uprn_match ..................... [RUN]
[0m10:22:18.477977 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_uprn'
[0m10:22:18.478312 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.dim_addressid
[0m10:22:18.478855 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_epc_certs, now model.rightmove_epc.uprn_match)
[0m10:22:18.479175 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.dim_uprn
[0m10:22:18.482503 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.dim_addressid"
[0m10:22:18.482899 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.uprn_match
[0m10:22:18.485329 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.dim_uprn"
[0m10:22:18.488480 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.uprn_match"
[0m10:22:18.489247 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_addressid (compile): 10:22:18.479404 => 10:22:18.488998
[0m10:22:18.489623 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.dim_addressid
[0m10:22:18.492310 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.dim_addressid"
[0m10:22:18.492766 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.dim_uprn (compile): 10:22:18.483105 => 10:22:18.492618
[0m10:22:18.493059 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.uprn_match (compile): 10:22:18.485748 => 10:22:18.492909
[0m10:22:18.493372 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.dim_uprn
[0m10:22:18.494368 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.dim_addressid"
[0m10:22:18.494636 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.uprn_match
[0m10:22:18.497014 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.dim_uprn"
[0m10:22:18.497427 [debug] [Thread-4 (]: On model.rightmove_epc.dim_addressid: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_addressid"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE ADDRESS'

with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource,
    POSTCODE

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    where REMOVE_FROM_RM_MATCH = 0
    AND ADDRESSID IS NOT NULL

),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE,
    NULL AS TOTAL_FLOOR_AREA -- quick fix for now
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    WHERE ADDRESSID IS NOT NULL

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where uprn is null
and addressid is not null
  );
[0m10:22:18.499704 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.uprn_match"
[0m10:22:18.500156 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m10:22:18.501169 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.dim_uprn"
[0m10:22:18.502280 [debug] [Thread-3 (]: On model.rightmove_epc.dim_uprn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_uprn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE UPRNS


with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource,
    POSTCODE,
    TOTAL_FLOOR_AREA

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    where REMOVE_FROM_RM_MATCH = 0
    AND UPRN IS NOT NULL
),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE,
    NULL AS TOTAL_FLOOR_AREA

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    WHERE UPRN IS NOT NULL

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where uprn is not null
  );
[0m10:22:18.503195 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.uprn_match"
[0m10:22:18.503567 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m10:22:18.503903 [debug] [Thread-1 (]: On model.rightmove_epc.uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
  
   as (
    with epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    where uprn is not null
    AND REMOVE_FROM_RM_MATCH = 1

),

rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where uprn is not null
),

final as (

    select 
    LISTING_ID,
    rm.ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    rm.UPRN,
    rm.LOCAL_AUTHORITY_CODE,
    rm.LOCAL_AUTHORITY,
    rm.GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    epc.UPRN AS EPC_UPRN,
    epc.TOTAL_FLOOR_AREA,
    epc.ADDRESSID as EPC_ADDRESSID,
    CASE WHEN epc.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC    
    
     from rm left join epc on rm.uprn = epc.uprn
)

select * from final
  );
[0m10:22:18.505138 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:22:18.970306 [debug] [Thread-4 (]: Snowflake adapter: Snowflake query id: 01b3440e-0103-9b67-0000-7195063740e6
[0m10:22:18.970920 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b3440e-0103-9b8b-0000-71950637247a
[0m10:22:18.971335 [debug] [Thread-4 (]: Snowflake adapter: Snowflake error: 001789 (42601): SQL compilation error:
invalid number of result columns for set operator input branches, expected 5, got 6 in branch 2
[0m10:22:18.971702 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 002028 (42601): SQL compilation error:
ambiguous column name 'FLOOR_LEVEL'
[0m10:22:18.972266 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_addressid (execute): 10:22:18.489825 => 10:22:18.972045
[0m10:22:18.972765 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.uprn_match (execute): 10:22:18.497706 => 10:22:18.972578
[0m10:22:18.973130 [debug] [Thread-4 (]: On model.rightmove_epc.dim_addressid: Close
[0m10:22:18.973480 [debug] [Thread-1 (]: On model.rightmove_epc.uprn_match: Close
[0m10:22:19.061936 [debug] [Thread-4 (]: Database Error in model dim_addressid (models/bridge/dim_addressid.sql)
  001789 (42601): SQL compilation error:
  invalid number of result columns for set operator input branches, expected 5, got 6 in branch 2
  compiled Code at target/run/rightmove_epc/models/bridge/dim_addressid.sql
[0m10:22:19.062613 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6ee09048-1a0d-42ed-821a-3d2275f60b54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107ff0550>]}
[0m10:22:19.064106 [debug] [Thread-1 (]: Database Error in model uprn_match (models/matching/uprn_match.sql)
  002028 (42601): SQL compilation error:
  ambiguous column name 'FLOOR_LEVEL'
  compiled Code at target/run/rightmove_epc/models/matching/uprn_match.sql
[0m10:22:19.064617 [error] [Thread-4 (]: 3 of 10 ERROR creating sql view model dbt_melissa_rm_epc.dim_addressid ......... [[31mERROR[0m in 0.59s]
[0m10:22:19.065045 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6ee09048-1a0d-42ed-821a-3d2275f60b54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106a9e150>]}
[0m10:22:19.065493 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.dim_addressid
[0m10:22:19.065896 [error] [Thread-1 (]: 5 of 10 ERROR creating sql view model dbt_melissa_rm_epc.uprn_match ............ [[31mERROR[0m in 0.59s]
[0m10:22:19.066605 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.uprn_match
[0m10:22:19.066925 [debug] [Thread-2 (]: Began running node model.rightmove_epc.address_match
[0m10:22:19.067255 [debug] [Thread-1 (]: Began running node model.rightmove_epc.address_simularity
[0m10:22:19.067592 [info ] [Thread-2 (]: 6 of 10 SKIP relation dbt_melissa_rm_epc.address_match ......................... [[33mSKIP[0m]
[0m10:22:19.067995 [info ] [Thread-1 (]: 7 of 10 SKIP relation dbt_melissa_rm_epc.address_simularity .................... [[33mSKIP[0m]
[0m10:22:19.068418 [debug] [Thread-4 (]: Began running node model.rightmove_epc.no_uprn_match
[0m10:22:19.068679 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.address_match
[0m10:22:19.068948 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.address_simularity
[0m10:22:19.069213 [info ] [Thread-4 (]: 8 of 10 SKIP relation dbt_melissa_rm_epc.no_uprn_match ......................... [[33mSKIP[0m]
[0m10:22:19.069644 [debug] [Thread-2 (]: Began running node model.rightmove_epc.all_matches
[0m10:22:19.069902 [debug] [Thread-1 (]: Began running node model.rightmove_epc.no_matches
[0m10:22:19.070196 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.no_uprn_match
[0m10:22:19.070466 [info ] [Thread-2 (]: 9 of 10 SKIP relation dbt_melissa_rm_epc.all_matches ........................... [[33mSKIP[0m]
[0m10:22:19.070812 [info ] [Thread-1 (]: 10 of 10 SKIP relation dbt_melissa_rm_epc.no_matches ........................... [[33mSKIP[0m]
[0m10:22:19.071244 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.all_matches
[0m10:22:19.071672 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.no_matches
[0m10:22:19.159139 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m10:22:19.161365 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.dim_uprn (execute): 10:22:18.494808 => 10:22:19.161210
[0m10:22:19.161672 [debug] [Thread-3 (]: On model.rightmove_epc.dim_uprn: Close
[0m10:22:19.245475 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6ee09048-1a0d-42ed-821a-3d2275f60b54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107fe1a10>]}
[0m10:22:19.247456 [info ] [Thread-3 (]: 4 of 10 OK created sql view model dbt_melissa_rm_epc.dim_uprn .................. [[32mSUCCESS 1[0m in 0.77s]
[0m10:22:19.247850 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.dim_uprn
[0m10:22:19.249446 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:22:19.251793 [debug] [MainThread]: Connection 'model.rightmove_epc.uprn_match' was properly closed.
[0m10:22:19.253646 [debug] [MainThread]: Connection 'model.rightmove_epc.stg_rightmove' was properly closed.
[0m10:22:19.253916 [debug] [MainThread]: Connection 'model.rightmove_epc.dim_addressid' was properly closed.
[0m10:22:19.257792 [debug] [MainThread]: Connection 'model.rightmove_epc.dim_uprn' was properly closed.
[0m10:22:19.259961 [info ] [MainThread]: 
[0m10:22:19.260420 [info ] [MainThread]: Finished running 10 view models in 0 hours 0 minutes and 2.56 seconds (2.56s).
[0m10:22:19.264435 [debug] [MainThread]: Command end result
[0m10:22:19.272932 [info ] [MainThread]: 
[0m10:22:19.273292 [info ] [MainThread]: [31mCompleted with 2 errors and 0 warnings:[0m
[0m10:22:19.273525 [info ] [MainThread]: 
[0m10:22:19.273762 [error] [MainThread]:   Database Error in model dim_addressid (models/bridge/dim_addressid.sql)
  001789 (42601): SQL compilation error:
  invalid number of result columns for set operator input branches, expected 5, got 6 in branch 2
  compiled Code at target/run/rightmove_epc/models/bridge/dim_addressid.sql
[0m10:22:19.273992 [info ] [MainThread]: 
[0m10:22:19.274212 [error] [MainThread]:   Database Error in model uprn_match (models/matching/uprn_match.sql)
  002028 (42601): SQL compilation error:
  ambiguous column name 'FLOOR_LEVEL'
  compiled Code at target/run/rightmove_epc/models/matching/uprn_match.sql
[0m10:22:19.274436 [info ] [MainThread]: 
[0m10:22:19.274677 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=2 SKIP=5 TOTAL=10
[0m10:22:19.276450 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 2.854955, "process_user_time": 1.340635, "process_kernel_time": 0.165268, "process_mem_max_rss": "137134080", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m10:22:19.276842 [debug] [MainThread]: Command `dbt run` failed at 10:22:19.276761 after 2.86 seconds
[0m10:22:19.277110 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106deba90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107291550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1072a64d0>]}
[0m10:22:19.277355 [debug] [MainThread]: Flushing usage events
[0m10:22:59.728482 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106edba50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106f36390>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106f36f10>]}


============================== 10:22:59.731407 | a8ae531c-31f5-4b90-9f02-d8068b1ccaca ==============================
[0m10:22:59.731407 [info ] [MainThread]: Running with dbt=1.7.10
[0m10:22:59.731750 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'profiles_dir': '/Users/melissabee/.dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m10:22:59.900344 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a8ae531c-31f5-4b90-9f02-d8068b1ccaca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106f0f350>]}
[0m10:22:59.934053 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a8ae531c-31f5-4b90-9f02-d8068b1ccaca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106f80450>]}
[0m10:22:59.934712 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m10:22:59.944811 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m10:22:59.966881 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:22:59.967140 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:22:59.970258 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a8ae531c-31f5-4b90-9f02-d8068b1ccaca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110616250>]}
[0m10:22:59.976190 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a8ae531c-31f5-4b90-9f02-d8068b1ccaca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106ee83d0>]}
[0m10:22:59.976437 [info ] [MainThread]: Found 11 models, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m10:22:59.976630 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a8ae531c-31f5-4b90-9f02-d8068b1ccaca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106f06c50>]}
[0m10:22:59.977623 [info ] [MainThread]: 
[0m10:22:59.978020 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m10:22:59.978693 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m10:22:59.984722 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m10:22:59.984933 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m10:22:59.985098 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:23:00.411538 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 0.0 seconds
[0m10:23:00.414071 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m10:23:00.503662 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m10:23:00.511535 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m10:23:00.511866 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m10:23:00.512121 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:23:00.910827 [debug] [ThreadPool]: SQL status: SUCCESS 11 in 0.0 seconds
[0m10:23:00.912541 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m10:23:00.994301 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a8ae531c-31f5-4b90-9f02-d8068b1ccaca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1104db650>]}
[0m10:23:00.995139 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m10:23:00.995475 [info ] [MainThread]: 
[0m10:23:00.998168 [debug] [Thread-1 (]: Began running node model.rightmove_epc.stg_epc_certs
[0m10:23:00.998507 [debug] [Thread-2 (]: Began running node model.rightmove_epc.stg_rightmove
[0m10:23:00.998894 [info ] [Thread-1 (]: 1 of 10 START sql view model dbt_melissa_rm_epc.stg_epc_certs .................. [RUN]
[0m10:23:00.999262 [info ] [Thread-2 (]: 2 of 10 START sql view model dbt_melissa_rm_epc.stg_rightmove .................. [RUN]
[0m10:23:00.999853 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.stg_epc_certs)
[0m10:23:01.000422 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.stg_rightmove'
[0m10:23:01.000726 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.stg_epc_certs
[0m10:23:01.001008 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.stg_rightmove
[0m10:23:01.007115 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.stg_epc_certs"
[0m10:23:01.009434 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.stg_rightmove"
[0m10:23:01.010217 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (compile): 10:23:01.007386 => 10:23:01.010015
[0m10:23:01.010539 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (compile): 10:23:01.001188 => 10:23:01.010384
[0m10:23:01.010802 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.stg_rightmove
[0m10:23:01.011055 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.stg_epc_certs
[0m10:23:01.058372 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.stg_rightmove"
[0m10:23:01.060024 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.stg_epc_certs"
[0m10:23:01.060916 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.stg_epc_certs"
[0m10:23:01.061383 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.stg_rightmove"
[0m10:23:01.061599 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_epc_certs"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
  
   as (
    WITH epc_certs as (
    
    select 
    UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    COUNTY,
    LOCAL_AUTHORITY as LOCAL_AUTHORITY_CODE,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    UPPER(CASE WHEN (UPPER(ADDRESS1) LIKE 'FLAT%' OR UPPER(ADDRESS1) LIKE 'UNIT%') or UPPER(ADDRESS1) LIKE 'ROOM%' 
    THEN TRIM(REPLACE(REPLACE(CONCAT(ADDRESS),','),' '))
    ELSE trim(replace(replace(ADDRESS1,' '),',')) END) AS ADDRESSID,
    CASE WHEN UPRN is null and addressid is null THEN 1 else 0 end as REMOVE_FROM_RM_MATCH,
    FLOOR_LEVEL,
    FLAT_TOP_STOREY,
    FLAT_STOREY_COUNT,
    PROPERTY_TYPE
 from  RAW.EPC_TEST_DATA.EPC_CERTIFICATES 

)

SELECT * FROM epc_certs
  );
[0m10:23:01.061818 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_rightmove"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
  
   as (
    with rm as (

    SELECT 
    LISTING_ID,
    UPPER(TRIM(replace(REPLACE(CONCAT(ADDRESS_1::VARCHAR,ADDRESS_2::VARCHAR),' '),','))) AS ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, 
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    STUDENTLET_FLAG,
    COMBINED_PROPERTY_TYPE
    -- property type
    FROM 
       ANALYTICS.RIGHTMOVE_PROD.CLEAN_RAW_RIGHTMOVE_DATA 

 
)

SELECT * FROM rm
  );
[0m10:23:01.062005 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:23:01.062155 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m10:23:01.551525 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m10:23:01.569891 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (execute): 10:23:01.058536 => 10:23:01.569700
[0m10:23:01.570259 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: Close
[0m10:23:01.620764 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m10:23:01.623108 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (execute): 10:23:01.011209 => 10:23:01.622933
[0m10:23:01.623443 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: Close
[0m10:23:01.645785 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a8ae531c-31f5-4b90-9f02-d8068b1ccaca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110605d50>]}
[0m10:23:01.646349 [info ] [Thread-1 (]: 1 of 10 OK created sql view model dbt_melissa_rm_epc.stg_epc_certs ............. [[32mSUCCESS 1[0m in 0.65s]
[0m10:23:01.646834 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.stg_epc_certs
[0m10:23:01.704760 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a8ae531c-31f5-4b90-9f02-d8068b1ccaca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106fb7110>]}
[0m10:23:01.705301 [info ] [Thread-2 (]: 2 of 10 OK created sql view model dbt_melissa_rm_epc.stg_rightmove ............. [[32mSUCCESS 1[0m in 0.70s]
[0m10:23:01.705692 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.stg_rightmove
[0m10:23:01.706291 [debug] [Thread-4 (]: Began running node model.rightmove_epc.dim_addressid
[0m10:23:01.706573 [debug] [Thread-3 (]: Began running node model.rightmove_epc.dim_uprn
[0m10:23:01.706831 [info ] [Thread-4 (]: 3 of 10 START sql view model dbt_melissa_rm_epc.dim_addressid .................. [RUN]
[0m10:23:01.707133 [debug] [Thread-1 (]: Began running node model.rightmove_epc.uprn_match
[0m10:23:01.707445 [info ] [Thread-3 (]: 4 of 10 START sql view model dbt_melissa_rm_epc.dim_uprn ....................... [RUN]
[0m10:23:01.707985 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_addressid'
[0m10:23:01.708266 [info ] [Thread-1 (]: 5 of 10 START sql view model dbt_melissa_rm_epc.uprn_match ..................... [RUN]
[0m10:23:01.708736 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_uprn'
[0m10:23:01.708975 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.dim_addressid
[0m10:23:01.709370 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_epc_certs, now model.rightmove_epc.uprn_match)
[0m10:23:01.709600 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.dim_uprn
[0m10:23:01.711843 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.dim_addressid"
[0m10:23:01.712121 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.uprn_match
[0m10:23:01.713841 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.dim_uprn"
[0m10:23:01.715949 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.uprn_match"
[0m10:23:01.716521 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_addressid (compile): 10:23:01.709752 => 10:23:01.716372
[0m10:23:01.716961 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.dim_uprn (compile): 10:23:01.712261 => 10:23:01.716725
[0m10:23:01.717306 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.dim_addressid
[0m10:23:01.717598 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.dim_uprn
[0m10:23:01.717848 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.uprn_match (compile): 10:23:01.714143 => 10:23:01.717725
[0m10:23:01.720058 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.dim_addressid"
[0m10:23:01.721758 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.dim_uprn"
[0m10:23:01.722011 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.uprn_match
[0m10:23:01.723901 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.uprn_match"
[0m10:23:01.724714 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.dim_addressid"
[0m10:23:01.725307 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.dim_uprn"
[0m10:23:01.725551 [debug] [Thread-4 (]: On model.rightmove_epc.dim_addressid: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_addressid"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE ADDRESS'

with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource,
    POSTCODE

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    where REMOVE_FROM_RM_MATCH = 0
    AND ADDRESSID IS NOT NULL

),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    WHERE ADDRESSID IS NOT NULL

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where uprn is null
and addressid is not null
  );
[0m10:23:01.725819 [debug] [Thread-3 (]: On model.rightmove_epc.dim_uprn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_uprn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE UPRNS


with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource,
    POSTCODE,
    TOTAL_FLOOR_AREA

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    where REMOVE_FROM_RM_MATCH = 0
    AND UPRN IS NOT NULL
),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    WHERE UPRN IS NOT NULL

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where uprn is not null
  );
[0m10:23:01.726456 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.uprn_match"
[0m10:23:01.726652 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m10:23:01.726850 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m10:23:01.727079 [debug] [Thread-1 (]: On model.rightmove_epc.uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
  
   as (
    with epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    where uprn is not null
    AND REMOVE_FROM_RM_MATCH = 1

),

rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where uprn is not null
),

final as (

    select 
    LISTING_ID,
    rm.ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    rm.UPRN,
    rm.LOCAL_AUTHORITY_CODE,
    rm.LOCAL_AUTHORITY,
    rm.GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    epc.UPRN AS EPC_UPRN,
    epc.TOTAL_FLOOR_AREA,
    epc.ADDRESSID as EPC_ADDRESSID,
    CASE WHEN epc.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC    
    
     from rm left join epc on rm.uprn = epc.uprn
)

select * from final
  );
[0m10:23:01.728448 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:23:02.173529 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b3440f-0103-9b63-0000-719506375156
[0m10:23:02.174344 [debug] [Thread-3 (]: Snowflake adapter: Snowflake query id: 01b3440f-0103-9b63-0000-719506375152
[0m10:23:02.174797 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 002028 (42601): SQL compilation error:
ambiguous column name 'FLOOR_LEVEL'
[0m10:23:02.175290 [debug] [Thread-3 (]: Snowflake adapter: Snowflake error: 001789 (42601): SQL compilation error:
invalid number of result columns for set operator input branches, expected 6, got 5 in branch 2
[0m10:23:02.175871 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.uprn_match (execute): 10:23:01.722278 => 10:23:02.175665
[0m10:23:02.176407 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.dim_uprn (execute): 10:23:01.720214 => 10:23:02.176192
[0m10:23:02.176794 [debug] [Thread-1 (]: On model.rightmove_epc.uprn_match: Close
[0m10:23:02.177149 [debug] [Thread-3 (]: On model.rightmove_epc.dim_uprn: Close
[0m10:23:02.250224 [debug] [Thread-1 (]: Database Error in model uprn_match (models/matching/uprn_match.sql)
  002028 (42601): SQL compilation error:
  ambiguous column name 'FLOOR_LEVEL'
  compiled Code at target/run/rightmove_epc/models/matching/uprn_match.sql
[0m10:23:02.250717 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a8ae531c-31f5-4b90-9f02-d8068b1ccaca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110464390>]}
[0m10:23:02.251205 [error] [Thread-1 (]: 5 of 10 ERROR creating sql view model dbt_melissa_rm_epc.uprn_match ............ [[31mERROR[0m in 0.54s]
[0m10:23:02.251673 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.uprn_match
[0m10:23:02.252180 [debug] [Thread-2 (]: Began running node model.rightmove_epc.no_uprn_match
[0m10:23:02.252503 [info ] [Thread-2 (]: 6 of 10 SKIP relation dbt_melissa_rm_epc.no_uprn_match ......................... [[33mSKIP[0m]
[0m10:23:02.252829 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.no_uprn_match
[0m10:23:02.253913 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m10:23:02.256006 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_addressid (execute): 10:23:01.717989 => 10:23:02.255856
[0m10:23:02.256288 [debug] [Thread-4 (]: On model.rightmove_epc.dim_addressid: Close
[0m10:23:02.269798 [debug] [Thread-3 (]: Database Error in model dim_uprn (models/bridge/dim_uprn.sql)
  001789 (42601): SQL compilation error:
  invalid number of result columns for set operator input branches, expected 6, got 5 in branch 2
  compiled Code at target/run/rightmove_epc/models/bridge/dim_uprn.sql
[0m10:23:02.270194 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a8ae531c-31f5-4b90-9f02-d8068b1ccaca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1105fce50>]}
[0m10:23:02.270572 [error] [Thread-3 (]: 4 of 10 ERROR creating sql view model dbt_melissa_rm_epc.dim_uprn .............. [[31mERROR[0m in 0.56s]
[0m10:23:02.270939 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.dim_uprn
[0m10:23:02.337418 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a8ae531c-31f5-4b90-9f02-d8068b1ccaca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11086f810>]}
[0m10:23:02.337940 [info ] [Thread-4 (]: 3 of 10 OK created sql view model dbt_melissa_rm_epc.dim_addressid ............. [[32mSUCCESS 1[0m in 0.63s]
[0m10:23:02.338317 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.dim_addressid
[0m10:23:02.338822 [debug] [Thread-1 (]: Began running node model.rightmove_epc.address_match
[0m10:23:02.339084 [debug] [Thread-2 (]: Began running node model.rightmove_epc.address_simularity
[0m10:23:02.339363 [info ] [Thread-1 (]: 7 of 10 START sql view model dbt_melissa_rm_epc.address_match .................. [RUN]
[0m10:23:02.339700 [info ] [Thread-2 (]: 8 of 10 START sql view model dbt_melissa_rm_epc.address_simularity ............. [RUN]
[0m10:23:02.340170 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.uprn_match, now model.rightmove_epc.address_match)
[0m10:23:02.340578 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_rightmove, now model.rightmove_epc.address_simularity)
[0m10:23:02.340833 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.address_match
[0m10:23:02.341056 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.address_simularity
[0m10:23:02.344995 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.address_simularity"
[0m10:23:02.346597 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.address_match"
[0m10:23:02.347118 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.address_simularity (compile): 10:23:02.343315 => 10:23:02.346968
[0m10:23:02.347378 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.address_match (compile): 10:23:02.341195 => 10:23:02.347256
[0m10:23:02.347617 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.address_simularity
[0m10:23:02.347885 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.address_match
[0m10:23:02.350070 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.address_simularity"
[0m10:23:02.351954 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.address_match"
[0m10:23:02.352754 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.address_simularity"
[0m10:23:02.353269 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.address_match"
[0m10:23:02.353542 [debug] [Thread-2 (]: On model.rightmove_epc.address_simularity: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.address_simularity"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.address_simularity
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NULL
),

epc_address as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
    where datasource = 'EPC'
)


SELECT rm.*,epc_address.addressid as EPC_ADDRESSID
FROM rm
JOIN epc_address
ON JAROWINKLER_SIMILARITY(rm.addressid, epc_address.addressid) = 1
  );
[0m10:23:02.353806 [debug] [Thread-1 (]: On model.rightmove_epc.address_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.address_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NULL
),

epc_address as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
    where datasource = 'EPC'
)


SELECT rm.*,
CASE WHEN epc_address.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC 


FROM rm
LEFT JOIN epc_address
ON rm.addressid = epc_address.addressid
and rm.FULL_POSTCODE = epc_address.POSTCODE
  );
[0m10:23:02.354057 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m10:23:02.354265 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:23:02.879969 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m10:23:02.882348 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.address_match (execute): 10:23:02.350257 => 10:23:02.882175
[0m10:23:02.882676 [debug] [Thread-1 (]: On model.rightmove_epc.address_match: Close
[0m10:23:02.911102 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m10:23:02.913318 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.address_simularity (execute): 10:23:02.348040 => 10:23:02.913149
[0m10:23:02.913642 [debug] [Thread-2 (]: On model.rightmove_epc.address_simularity: Close
[0m10:23:02.966998 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a8ae531c-31f5-4b90-9f02-d8068b1ccaca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110d0c4d0>]}
[0m10:23:02.967649 [info ] [Thread-1 (]: 7 of 10 OK created sql view model dbt_melissa_rm_epc.address_match ............. [[32mSUCCESS 1[0m in 0.63s]
[0m10:23:02.968176 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.address_match
[0m10:23:02.968730 [debug] [Thread-4 (]: Began running node model.rightmove_epc.all_matches
[0m10:23:02.969112 [debug] [Thread-3 (]: Began running node model.rightmove_epc.no_matches
[0m10:23:02.969447 [info ] [Thread-4 (]: 9 of 10 SKIP relation dbt_melissa_rm_epc.all_matches ........................... [[33mSKIP[0m]
[0m10:23:02.969891 [info ] [Thread-3 (]: 10 of 10 SKIP relation dbt_melissa_rm_epc.no_matches ........................... [[33mSKIP[0m]
[0m10:23:02.970283 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.all_matches
[0m10:23:02.970586 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.no_matches
[0m10:23:02.987603 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a8ae531c-31f5-4b90-9f02-d8068b1ccaca', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110f09550>]}
[0m10:23:02.988128 [info ] [Thread-2 (]: 8 of 10 OK created sql view model dbt_melissa_rm_epc.address_simularity ........ [[32mSUCCESS 1[0m in 0.65s]
[0m10:23:02.988531 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.address_simularity
[0m10:23:02.989788 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:23:02.990024 [debug] [MainThread]: Connection 'model.rightmove_epc.address_match' was properly closed.
[0m10:23:02.990221 [debug] [MainThread]: Connection 'model.rightmove_epc.address_simularity' was properly closed.
[0m10:23:02.990406 [debug] [MainThread]: Connection 'model.rightmove_epc.dim_addressid' was properly closed.
[0m10:23:02.990587 [debug] [MainThread]: Connection 'model.rightmove_epc.dim_uprn' was properly closed.
[0m10:23:02.990848 [info ] [MainThread]: 
[0m10:23:02.991072 [info ] [MainThread]: Finished running 10 view models in 0 hours 0 minutes and 3.01 seconds (3.01s).
[0m10:23:02.991995 [debug] [MainThread]: Command end result
[0m10:23:02.998359 [info ] [MainThread]: 
[0m10:23:02.998637 [info ] [MainThread]: [31mCompleted with 2 errors and 0 warnings:[0m
[0m10:23:02.998827 [info ] [MainThread]: 
[0m10:23:02.999020 [error] [MainThread]:   Database Error in model uprn_match (models/matching/uprn_match.sql)
  002028 (42601): SQL compilation error:
  ambiguous column name 'FLOOR_LEVEL'
  compiled Code at target/run/rightmove_epc/models/matching/uprn_match.sql
[0m10:23:02.999212 [info ] [MainThread]: 
[0m10:23:02.999400 [error] [MainThread]:   Database Error in model dim_uprn (models/bridge/dim_uprn.sql)
  001789 (42601): SQL compilation error:
  invalid number of result columns for set operator input branches, expected 6, got 5 in branch 2
  compiled Code at target/run/rightmove_epc/models/bridge/dim_uprn.sql
[0m10:23:02.999597 [info ] [MainThread]: 
[0m10:23:02.999814 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=2 SKIP=3 TOTAL=10
[0m10:23:03.001695 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 3.3067682, "process_user_time": 1.37939, "process_kernel_time": 0.169873, "process_mem_max_rss": "137805824", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m10:23:03.002063 [debug] [MainThread]: Command `dbt run` failed at 10:23:03.001982 after 3.31 seconds
[0m10:23:03.002324 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110406590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10309e110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1031d9d50>]}
[0m10:23:03.002584 [debug] [MainThread]: Flushing usage events
[0m10:23:35.920353 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108952b10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10895e6d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10895f210>]}


============================== 10:23:35.923038 | 14d8c1fa-a432-4bc3-9840-bd53bd1724af ==============================
[0m10:23:35.923038 [info ] [MainThread]: Running with dbt=1.7.10
[0m10:23:35.923363 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/Users/melissabee/.dbt', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m10:23:36.089821 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '14d8c1fa-a432-4bc3-9840-bd53bd1724af', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10939d310>]}
[0m10:23:36.123164 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '14d8c1fa-a432-4bc3-9840-bd53bd1724af', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10890b510>]}
[0m10:23:36.124654 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m10:23:36.134340 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m10:23:36.153635 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:23:36.153897 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:23:36.157127 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '14d8c1fa-a432-4bc3-9840-bd53bd1724af', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10989abd0>]}
[0m10:23:36.163183 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '14d8c1fa-a432-4bc3-9840-bd53bd1724af', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1095620d0>]}
[0m10:23:36.163457 [info ] [MainThread]: Found 11 models, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m10:23:36.163650 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '14d8c1fa-a432-4bc3-9840-bd53bd1724af', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109339210>]}
[0m10:23:36.164715 [info ] [MainThread]: 
[0m10:23:36.165132 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m10:23:36.165817 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m10:23:36.172080 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m10:23:36.172340 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m10:23:36.172493 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:23:36.716063 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 1.0 seconds
[0m10:23:36.718215 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m10:23:36.904010 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m10:23:36.910543 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m10:23:36.910882 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m10:23:36.911143 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:23:37.413011 [debug] [ThreadPool]: SQL status: SUCCESS 11 in 1.0 seconds
[0m10:23:37.414629 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m10:23:37.503054 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '14d8c1fa-a432-4bc3-9840-bd53bd1724af', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1094dec90>]}
[0m10:23:37.503885 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m10:23:37.504190 [info ] [MainThread]: 
[0m10:23:37.507088 [debug] [Thread-1 (]: Began running node model.rightmove_epc.stg_epc_certs
[0m10:23:37.507434 [debug] [Thread-2 (]: Began running node model.rightmove_epc.stg_rightmove
[0m10:23:37.507845 [info ] [Thread-1 (]: 1 of 10 START sql view model dbt_melissa_rm_epc.stg_epc_certs .................. [RUN]
[0m10:23:37.508250 [info ] [Thread-2 (]: 2 of 10 START sql view model dbt_melissa_rm_epc.stg_rightmove .................. [RUN]
[0m10:23:37.508828 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.stg_epc_certs)
[0m10:23:37.509272 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.stg_rightmove'
[0m10:23:37.509505 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.stg_epc_certs
[0m10:23:37.509730 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.stg_rightmove
[0m10:23:37.515457 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.stg_epc_certs"
[0m10:23:37.517720 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.stg_rightmove"
[0m10:23:37.518459 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (compile): 10:23:37.515751 => 10:23:37.518254
[0m10:23:37.518742 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (compile): 10:23:37.509895 => 10:23:37.518605
[0m10:23:37.518997 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.stg_rightmove
[0m10:23:37.519240 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.stg_epc_certs
[0m10:23:37.566671 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.stg_rightmove"
[0m10:23:37.568436 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.stg_epc_certs"
[0m10:23:37.569230 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.stg_rightmove"
[0m10:23:37.569813 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.stg_epc_certs"
[0m10:23:37.570012 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_rightmove"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
  
   as (
    with rm as (

    SELECT 
    LISTING_ID,
    UPPER(TRIM(replace(REPLACE(CONCAT(ADDRESS_1::VARCHAR,ADDRESS_2::VARCHAR),' '),','))) AS ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, 
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    STUDENTLET_FLAG,
    COMBINED_PROPERTY_TYPE
    -- property type
    FROM 
       ANALYTICS.RIGHTMOVE_PROD.CLEAN_RAW_RIGHTMOVE_DATA 

 
)

SELECT * FROM rm
  );
[0m10:23:37.570252 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_epc_certs"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
  
   as (
    WITH epc_certs as (
    
    select 
    UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    COUNTY,
    LOCAL_AUTHORITY as LOCAL_AUTHORITY_CODE,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    UPPER(CASE WHEN (UPPER(ADDRESS1) LIKE 'FLAT%' OR UPPER(ADDRESS1) LIKE 'UNIT%') or UPPER(ADDRESS1) LIKE 'ROOM%' 
    THEN TRIM(REPLACE(REPLACE(CONCAT(ADDRESS),','),' '))
    ELSE trim(replace(replace(ADDRESS1,' '),',')) END) AS ADDRESSID,
    CASE WHEN UPRN is null and addressid is null THEN 1 else 0 end as REMOVE_FROM_RM_MATCH,
    FLOOR_LEVEL,
    FLAT_TOP_STOREY,
    FLAT_STOREY_COUNT,
    PROPERTY_TYPE
 from  RAW.EPC_TEST_DATA.EPC_CERTIFICATES 

)

SELECT * FROM epc_certs
  );
[0m10:23:37.570460 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m10:23:37.570631 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:23:38.041397 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m10:23:38.058906 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (execute): 10:23:37.519389 => 10:23:38.058740
[0m10:23:38.059234 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: Close
[0m10:23:38.076302 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m10:23:38.078476 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (execute): 10:23:37.566869 => 10:23:38.078308
[0m10:23:38.078792 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: Close
[0m10:23:38.136866 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '14d8c1fa-a432-4bc3-9840-bd53bd1724af', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1099d2ed0>]}
[0m10:23:38.137548 [info ] [Thread-2 (]: 2 of 10 OK created sql view model dbt_melissa_rm_epc.stg_rightmove ............. [[32mSUCCESS 1[0m in 0.63s]
[0m10:23:38.138096 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.stg_rightmove
[0m10:23:38.161186 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '14d8c1fa-a432-4bc3-9840-bd53bd1724af', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10958b8d0>]}
[0m10:23:38.161722 [info ] [Thread-1 (]: 1 of 10 OK created sql view model dbt_melissa_rm_epc.stg_epc_certs ............. [[32mSUCCESS 1[0m in 0.65s]
[0m10:23:38.162148 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.stg_epc_certs
[0m10:23:38.162800 [debug] [Thread-4 (]: Began running node model.rightmove_epc.dim_addressid
[0m10:23:38.163123 [debug] [Thread-3 (]: Began running node model.rightmove_epc.dim_uprn
[0m10:23:38.163434 [debug] [Thread-2 (]: Began running node model.rightmove_epc.uprn_match
[0m10:23:38.163732 [info ] [Thread-4 (]: 3 of 10 START sql view model dbt_melissa_rm_epc.dim_addressid .................. [RUN]
[0m10:23:38.164075 [info ] [Thread-3 (]: 4 of 10 START sql view model dbt_melissa_rm_epc.dim_uprn ....................... [RUN]
[0m10:23:38.164382 [info ] [Thread-2 (]: 5 of 10 START sql view model dbt_melissa_rm_epc.uprn_match ..................... [RUN]
[0m10:23:38.164972 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_addressid'
[0m10:23:38.165488 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_uprn'
[0m10:23:38.165928 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_rightmove, now model.rightmove_epc.uprn_match)
[0m10:23:38.166199 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.dim_addressid
[0m10:23:38.166443 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.dim_uprn
[0m10:23:38.166674 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.uprn_match
[0m10:23:38.169096 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.dim_addressid"
[0m10:23:38.170953 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.dim_uprn"
[0m10:23:38.172987 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.uprn_match"
[0m10:23:38.173790 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.uprn_match (compile): 10:23:38.171126 => 10:23:38.173634
[0m10:23:38.174090 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.dim_uprn (compile): 10:23:38.169278 => 10:23:38.173949
[0m10:23:38.174332 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_addressid (compile): 10:23:38.166830 => 10:23:38.174218
[0m10:23:38.174550 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.uprn_match
[0m10:23:38.174802 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.dim_uprn
[0m10:23:38.175014 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.dim_addressid
[0m10:23:38.177158 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.uprn_match"
[0m10:23:38.179003 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.dim_uprn"
[0m10:23:38.180906 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.dim_addressid"
[0m10:23:38.181953 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.dim_uprn"
[0m10:23:38.182230 [debug] [Thread-3 (]: On model.rightmove_epc.dim_uprn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_uprn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE UPRNS


with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource,
    POSTCODE
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    where REMOVE_FROM_RM_MATCH = 0
    AND UPRN IS NOT NULL
),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    WHERE UPRN IS NOT NULL

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where uprn is not null
  );
[0m10:23:38.182952 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.uprn_match"
[0m10:23:38.183176 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m10:23:38.183805 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.dim_addressid"
[0m10:23:38.184048 [debug] [Thread-2 (]: On model.rightmove_epc.uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
  
   as (
    with epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    where uprn is not null
    AND REMOVE_FROM_RM_MATCH = 1

),

rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where uprn is not null
),

final as (

    select 
    LISTING_ID,
    rm.ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    rm.UPRN,
    rm.LOCAL_AUTHORITY_CODE,
    rm.LOCAL_AUTHORITY,
    rm.GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    epc.UPRN AS EPC_UPRN,
    epc.TOTAL_FLOOR_AREA,
    epc.ADDRESSID as EPC_ADDRESSID,
    CASE WHEN epc.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC    
    
     from rm left join epc on rm.uprn = epc.uprn
)

select * from final
  );
[0m10:23:38.185013 [debug] [Thread-4 (]: On model.rightmove_epc.dim_addressid: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_addressid"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE ADDRESS'

with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource,
    POSTCODE

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    where REMOVE_FROM_RM_MATCH = 0
    AND ADDRESSID IS NOT NULL

),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    WHERE ADDRESSID IS NOT NULL

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where uprn is null
and addressid is not null
  );
[0m10:23:38.185267 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m10:23:38.185478 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m10:23:38.608282 [debug] [Thread-2 (]: Snowflake adapter: Snowflake query id: 01b3440f-0103-9b9a-0000-71950637347e
[0m10:23:38.608931 [debug] [Thread-2 (]: Snowflake adapter: Snowflake error: 002028 (42601): SQL compilation error:
ambiguous column name 'FLOOR_LEVEL'
[0m10:23:38.609612 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.uprn_match (execute): 10:23:38.175150 => 10:23:38.609355
[0m10:23:38.610058 [debug] [Thread-2 (]: On model.rightmove_epc.uprn_match: Close
[0m10:23:38.760397 [debug] [Thread-2 (]: Database Error in model uprn_match (models/matching/uprn_match.sql)
  002028 (42601): SQL compilation error:
  ambiguous column name 'FLOOR_LEVEL'
  compiled Code at target/run/rightmove_epc/models/matching/uprn_match.sql
[0m10:23:38.760907 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '14d8c1fa-a432-4bc3-9840-bd53bd1724af', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1095b3dd0>]}
[0m10:23:38.761399 [error] [Thread-2 (]: 5 of 10 ERROR creating sql view model dbt_melissa_rm_epc.uprn_match ............ [[31mERROR[0m in 0.60s]
[0m10:23:38.761894 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.uprn_match
[0m10:23:38.762522 [debug] [Thread-1 (]: Began running node model.rightmove_epc.no_uprn_match
[0m10:23:38.762882 [info ] [Thread-1 (]: 6 of 10 SKIP relation dbt_melissa_rm_epc.no_uprn_match ......................... [[33mSKIP[0m]
[0m10:23:38.763226 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.no_uprn_match
[0m10:23:38.809020 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m10:23:38.811688 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_addressid (execute): 10:23:38.179161 => 10:23:38.811510
[0m10:23:38.812029 [debug] [Thread-4 (]: On model.rightmove_epc.dim_addressid: Close
[0m10:23:38.832016 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m10:23:38.834333 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.dim_uprn (execute): 10:23:38.177321 => 10:23:38.834165
[0m10:23:38.834666 [debug] [Thread-3 (]: On model.rightmove_epc.dim_uprn: Close
[0m10:23:38.890414 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '14d8c1fa-a432-4bc3-9840-bd53bd1724af', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109985750>]}
[0m10:23:38.891078 [info ] [Thread-4 (]: 3 of 10 OK created sql view model dbt_melissa_rm_epc.dim_addressid ............. [[32mSUCCESS 1[0m in 0.73s]
[0m10:23:38.891578 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.dim_addressid
[0m10:23:38.892078 [debug] [Thread-2 (]: Began running node model.rightmove_epc.address_match
[0m10:23:38.892429 [info ] [Thread-2 (]: 7 of 10 START sql view model dbt_melissa_rm_epc.address_match .................. [RUN]
[0m10:23:38.892774 [debug] [Thread-1 (]: Began running node model.rightmove_epc.address_simularity
[0m10:23:38.893373 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.uprn_match, now model.rightmove_epc.address_match)
[0m10:23:38.893724 [info ] [Thread-1 (]: 8 of 10 START sql view model dbt_melissa_rm_epc.address_simularity ............. [RUN]
[0m10:23:38.894038 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.address_match
[0m10:23:38.894519 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_epc_certs, now model.rightmove_epc.address_simularity)
[0m10:23:38.896390 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.address_simularity
[0m10:23:38.899740 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.address_match"
[0m10:23:38.902291 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.address_simularity"
[0m10:23:38.903091 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.address_match (compile): 10:23:38.894710 => 10:23:38.902911
[0m10:23:38.903443 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.address_simularity (compile): 10:23:38.900024 => 10:23:38.903263
[0m10:23:38.903725 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.address_match
[0m10:23:38.903993 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.address_simularity
[0m10:23:38.906508 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.address_match"
[0m10:23:38.908766 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.address_simularity"
[0m10:23:38.909700 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.address_match"
[0m10:23:38.910305 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.address_simularity"
[0m10:23:38.910584 [debug] [Thread-2 (]: On model.rightmove_epc.address_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.address_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NULL
),

epc_address as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
    where datasource = 'EPC'
)


SELECT rm.*,
CASE WHEN epc_address.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC 


FROM rm
LEFT JOIN epc_address
ON rm.addressid = epc_address.addressid
and rm.FULL_POSTCODE = epc_address.POSTCODE
  );
[0m10:23:38.910881 [debug] [Thread-1 (]: On model.rightmove_epc.address_simularity: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.address_simularity"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.address_simularity
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NULL
),

epc_address as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
    where datasource = 'EPC'
)


SELECT rm.*,epc_address.addressid as EPC_ADDRESSID
FROM rm
JOIN epc_address
ON JAROWINKLER_SIMILARITY(rm.addressid, epc_address.addressid) = 1
  );
[0m10:23:38.911129 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m10:23:38.911352 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:23:38.922822 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '14d8c1fa-a432-4bc3-9840-bd53bd1724af', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1099d1110>]}
[0m10:23:38.923281 [info ] [Thread-3 (]: 4 of 10 OK created sql view model dbt_melissa_rm_epc.dim_uprn .................. [[32mSUCCESS 1[0m in 0.76s]
[0m10:23:38.923642 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.dim_uprn
[0m10:23:39.474899 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m10:23:39.477514 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.address_simularity (execute): 10:23:38.906704 => 10:23:39.477331
[0m10:23:39.477854 [debug] [Thread-1 (]: On model.rightmove_epc.address_simularity: Close
[0m10:23:39.488277 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m10:23:39.490433 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.address_match (execute): 10:23:38.904153 => 10:23:39.490266
[0m10:23:39.490756 [debug] [Thread-2 (]: On model.rightmove_epc.address_match: Close
[0m10:23:39.553683 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '14d8c1fa-a432-4bc3-9840-bd53bd1724af', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109984210>]}
[0m10:23:39.554245 [info ] [Thread-1 (]: 8 of 10 OK created sql view model dbt_melissa_rm_epc.address_simularity ........ [[32mSUCCESS 1[0m in 0.66s]
[0m10:23:39.554865 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.address_simularity
[0m10:23:39.570396 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '14d8c1fa-a432-4bc3-9840-bd53bd1724af', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109ad6690>]}
[0m10:23:39.571086 [info ] [Thread-2 (]: 7 of 10 OK created sql view model dbt_melissa_rm_epc.address_match ............. [[32mSUCCESS 1[0m in 0.68s]
[0m10:23:39.571632 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.address_match
[0m10:23:39.572439 [debug] [Thread-4 (]: Began running node model.rightmove_epc.all_matches
[0m10:23:39.572855 [debug] [Thread-3 (]: Began running node model.rightmove_epc.no_matches
[0m10:23:39.573334 [info ] [Thread-4 (]: 9 of 10 SKIP relation dbt_melissa_rm_epc.all_matches ........................... [[33mSKIP[0m]
[0m10:23:39.573742 [info ] [Thread-3 (]: 10 of 10 SKIP relation dbt_melissa_rm_epc.no_matches ........................... [[33mSKIP[0m]
[0m10:23:39.574109 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.all_matches
[0m10:23:39.574423 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.no_matches
[0m10:23:39.575926 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:23:39.576225 [debug] [MainThread]: Connection 'model.rightmove_epc.address_simularity' was properly closed.
[0m10:23:39.576460 [debug] [MainThread]: Connection 'model.rightmove_epc.address_match' was properly closed.
[0m10:23:39.576675 [debug] [MainThread]: Connection 'model.rightmove_epc.dim_addressid' was properly closed.
[0m10:23:39.576887 [debug] [MainThread]: Connection 'model.rightmove_epc.dim_uprn' was properly closed.
[0m10:23:39.577198 [info ] [MainThread]: 
[0m10:23:39.577474 [info ] [MainThread]: Finished running 10 view models in 0 hours 0 minutes and 3.41 seconds (3.41s).
[0m10:23:39.578483 [debug] [MainThread]: Command end result
[0m10:23:39.585616 [info ] [MainThread]: 
[0m10:23:39.585943 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m10:23:39.586139 [info ] [MainThread]: 
[0m10:23:39.586344 [error] [MainThread]:   Database Error in model uprn_match (models/matching/uprn_match.sql)
  002028 (42601): SQL compilation error:
  ambiguous column name 'FLOOR_LEVEL'
  compiled Code at target/run/rightmove_epc/models/matching/uprn_match.sql
[0m10:23:39.586553 [info ] [MainThread]: 
[0m10:23:39.586761 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=1 SKIP=3 TOTAL=10
[0m10:23:39.588557 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 3.694495, "process_user_time": 1.380742, "process_kernel_time": 0.172031, "process_mem_max_rss": "138149888", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m10:23:39.588951 [debug] [MainThread]: Command `dbt run` failed at 10:23:39.588869 after 3.69 seconds
[0m10:23:39.589235 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10129e110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108952010>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10989b050>]}
[0m10:23:39.589500 [debug] [MainThread]: Flushing usage events
[0m10:24:22.343468 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108a54910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108a9a350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108a9af50>]}


============================== 10:24:22.346275 | fabfd65d-3ae2-44ca-bf97-8f53dc044a62 ==============================
[0m10:24:22.346275 [info ] [MainThread]: Running with dbt=1.7.10
[0m10:24:22.346635 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'profiles_dir': '/Users/melissabee/.dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m10:24:22.515928 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fabfd65d-3ae2-44ca-bf97-8f53dc044a62', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108a99850>]}
[0m10:24:22.549603 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'fabfd65d-3ae2-44ca-bf97-8f53dc044a62', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1094f6e50>]}
[0m10:24:22.551152 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m10:24:22.560867 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m10:24:22.586557 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:24:22.586863 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:24:22.590130 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'fabfd65d-3ae2-44ca-bf97-8f53dc044a62', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1099473d0>]}
[0m10:24:22.596174 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'fabfd65d-3ae2-44ca-bf97-8f53dc044a62', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109868f10>]}
[0m10:24:22.596426 [info ] [MainThread]: Found 11 models, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m10:24:22.596616 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fabfd65d-3ae2-44ca-bf97-8f53dc044a62', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1094c8e50>]}
[0m10:24:22.597712 [info ] [MainThread]: 
[0m10:24:22.598104 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m10:24:22.598784 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m10:24:22.605132 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m10:24:22.605398 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m10:24:22.605551 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:24:23.049280 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 0.0 seconds
[0m10:24:23.051477 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m10:24:23.151891 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m10:24:23.159072 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m10:24:23.159404 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m10:24:23.159662 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:24:23.507590 [debug] [ThreadPool]: SQL status: SUCCESS 11 in 0.0 seconds
[0m10:24:23.511089 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m10:24:23.605271 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fabfd65d-3ae2-44ca-bf97-8f53dc044a62', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1099a8790>]}
[0m10:24:23.606061 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m10:24:23.606378 [info ] [MainThread]: 
[0m10:24:23.609792 [debug] [Thread-1 (]: Began running node model.rightmove_epc.stg_epc_certs
[0m10:24:23.610225 [debug] [Thread-2 (]: Began running node model.rightmove_epc.stg_rightmove
[0m10:24:23.610594 [info ] [Thread-1 (]: 1 of 10 START sql view model dbt_melissa_rm_epc.stg_epc_certs .................. [RUN]
[0m10:24:23.611042 [info ] [Thread-2 (]: 2 of 10 START sql view model dbt_melissa_rm_epc.stg_rightmove .................. [RUN]
[0m10:24:23.611648 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.stg_epc_certs)
[0m10:24:23.612520 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.stg_rightmove'
[0m10:24:23.612995 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.stg_epc_certs
[0m10:24:23.613407 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.stg_rightmove
[0m10:24:23.621079 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.stg_epc_certs"
[0m10:24:23.623669 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.stg_rightmove"
[0m10:24:23.624762 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (compile): 10:24:23.613665 => 10:24:23.624462
[0m10:24:23.625250 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (compile): 10:24:23.621356 => 10:24:23.624976
[0m10:24:23.625657 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.stg_epc_certs
[0m10:24:23.625983 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.stg_rightmove
[0m10:24:23.675920 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.stg_epc_certs"
[0m10:24:23.677623 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.stg_rightmove"
[0m10:24:23.678434 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.stg_rightmove"
[0m10:24:23.679012 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.stg_epc_certs"
[0m10:24:23.679223 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_rightmove"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
  
   as (
    with rm as (

    SELECT 
    LISTING_ID,
    UPPER(TRIM(replace(REPLACE(CONCAT(ADDRESS_1::VARCHAR,ADDRESS_2::VARCHAR),' '),','))) AS ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, 
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    STUDENTLET_FLAG,
    COMBINED_PROPERTY_TYPE
    -- property type
    FROM 
       ANALYTICS.RIGHTMOVE_PROD.CLEAN_RAW_RIGHTMOVE_DATA 

 
)

SELECT * FROM rm
  );
[0m10:24:23.679477 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_epc_certs"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
  
   as (
    WITH epc_certs as (
    
    select 
    UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    COUNTY,
    LOCAL_AUTHORITY as LOCAL_AUTHORITY_CODE,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    UPPER(CASE WHEN (UPPER(ADDRESS1) LIKE 'FLAT%' OR UPPER(ADDRESS1) LIKE 'UNIT%') or UPPER(ADDRESS1) LIKE 'ROOM%' 
    THEN TRIM(REPLACE(REPLACE(CONCAT(ADDRESS),','),' '))
    ELSE trim(replace(replace(ADDRESS1,' '),',')) END) AS ADDRESSID,
    CASE WHEN UPRN is null and addressid is null THEN 1 else 0 end as REMOVE_FROM_RM_MATCH,
    FLOOR_LEVEL,
    FLAT_TOP_STOREY,
    FLAT_STOREY_COUNT,
    PROPERTY_TYPE
 from  RAW.EPC_TEST_DATA.EPC_CERTIFICATES 

)

SELECT * FROM epc_certs
  );
[0m10:24:23.679684 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m10:24:23.679844 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:24:24.124960 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m10:24:24.147029 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (execute): 10:24:23.626186 => 10:24:24.146879
[0m10:24:24.147346 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: Close
[0m10:24:24.183582 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m10:24:24.186326 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (execute): 10:24:23.676095 => 10:24:24.186138
[0m10:24:24.186704 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: Close
[0m10:24:24.244786 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fabfd65d-3ae2-44ca-bf97-8f53dc044a62', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1099a0550>]}
[0m10:24:24.245354 [info ] [Thread-1 (]: 1 of 10 OK created sql view model dbt_melissa_rm_epc.stg_epc_certs ............. [[32mSUCCESS 1[0m in 0.63s]
[0m10:24:24.245743 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.stg_epc_certs
[0m10:24:24.273191 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fabfd65d-3ae2-44ca-bf97-8f53dc044a62', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1098683d0>]}
[0m10:24:24.273690 [info ] [Thread-2 (]: 2 of 10 OK created sql view model dbt_melissa_rm_epc.stg_rightmove ............. [[32mSUCCESS 1[0m in 0.66s]
[0m10:24:24.274033 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.stg_rightmove
[0m10:24:24.274571 [debug] [Thread-4 (]: Began running node model.rightmove_epc.dim_addressid
[0m10:24:24.274877 [debug] [Thread-3 (]: Began running node model.rightmove_epc.dim_uprn
[0m10:24:24.275136 [info ] [Thread-4 (]: 3 of 10 START sql view model dbt_melissa_rm_epc.dim_addressid .................. [RUN]
[0m10:24:24.275387 [debug] [Thread-1 (]: Began running node model.rightmove_epc.uprn_match
[0m10:24:24.275611 [info ] [Thread-3 (]: 4 of 10 START sql view model dbt_melissa_rm_epc.dim_uprn ....................... [RUN]
[0m10:24:24.276104 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_addressid'
[0m10:24:24.276370 [info ] [Thread-1 (]: 5 of 10 START sql view model dbt_melissa_rm_epc.uprn_match ..................... [RUN]
[0m10:24:24.276874 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_uprn'
[0m10:24:24.277138 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.dim_addressid
[0m10:24:24.277491 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_epc_certs, now model.rightmove_epc.uprn_match)
[0m10:24:24.277698 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.dim_uprn
[0m10:24:24.279816 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.dim_addressid"
[0m10:24:24.280074 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.uprn_match
[0m10:24:24.281821 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.dim_uprn"
[0m10:24:24.284086 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.uprn_match"
[0m10:24:24.284630 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_addressid (compile): 10:24:24.277828 => 10:24:24.284500
[0m10:24:24.284892 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.dim_addressid
[0m10:24:24.287589 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.dim_addressid"
[0m10:24:24.288025 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.uprn_match (compile): 10:24:24.282168 => 10:24:24.287817
[0m10:24:24.288298 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.dim_uprn (compile): 10:24:24.280201 => 10:24:24.288167
[0m10:24:24.288614 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.uprn_match
[0m10:24:24.288910 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.dim_uprn
[0m10:24:24.290719 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.uprn_match"
[0m10:24:24.291403 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.dim_addressid"
[0m10:24:24.293354 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.dim_uprn"
[0m10:24:24.293712 [debug] [Thread-4 (]: On model.rightmove_epc.dim_addressid: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_addressid"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE ADDRESS'

with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource,
    POSTCODE

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    where REMOVE_FROM_RM_MATCH = 0
    AND ADDRESSID IS NOT NULL

),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    WHERE ADDRESSID IS NOT NULL

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where uprn is null
and addressid is not null
  );
[0m10:24:24.294028 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m10:24:24.294658 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.uprn_match"
[0m10:24:24.295660 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.dim_uprn"
[0m10:24:24.296173 [debug] [Thread-1 (]: On model.rightmove_epc.uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
  
   as (
    with epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    where uprn is not null
    AND REMOVE_FROM_RM_MATCH = 1

),

rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where uprn is not null
),

final as (

    select 
    LISTING_ID,
    rm.ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    rm.UPRN,
    rm.LOCAL_AUTHORITY_CODE,
    rm.LOCAL_AUTHORITY,
    rm.GOV_REGION_CODE,
    FLOOR_AREA,
    rm.FLOOR_LEVEL,
    epc.UPRN AS EPC_UPRN,
 --   epc.TOTAL_FLOOR_AREA,
    epc.ADDRESSID as EPC_ADDRESSID,
    CASE WHEN epc.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC    
    
     from rm left join epc on rm.uprn = epc.uprn
)

select * from final
  );
[0m10:24:24.296490 [debug] [Thread-3 (]: On model.rightmove_epc.dim_uprn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_uprn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE UPRNS


with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource,
    POSTCODE
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    where REMOVE_FROM_RM_MATCH = 0
    AND UPRN IS NOT NULL
),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    WHERE UPRN IS NOT NULL

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where uprn is not null
  );
[0m10:24:24.296716 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:24:24.296972 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m10:24:24.834409 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m10:24:24.838617 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.dim_uprn (execute): 10:24:24.291616 => 10:24:24.838302
[0m10:24:24.839619 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m10:24:24.840285 [debug] [Thread-3 (]: On model.rightmove_epc.dim_uprn: Close
[0m10:24:24.842647 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_addressid (execute): 10:24:24.285082 => 10:24:24.842516
[0m10:24:24.843541 [debug] [Thread-4 (]: On model.rightmove_epc.dim_addressid: Close
[0m10:24:24.864814 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m10:24:24.866871 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.uprn_match (execute): 10:24:24.289086 => 10:24:24.866727
[0m10:24:24.867169 [debug] [Thread-1 (]: On model.rightmove_epc.uprn_match: Close
[0m10:24:24.923764 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fabfd65d-3ae2-44ca-bf97-8f53dc044a62', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109716890>]}
[0m10:24:24.924383 [info ] [Thread-4 (]: 3 of 10 OK created sql view model dbt_melissa_rm_epc.dim_addressid ............. [[32mSUCCESS 1[0m in 0.65s]
[0m10:24:24.925148 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.dim_addressid
[0m10:24:24.925738 [debug] [Thread-2 (]: Began running node model.rightmove_epc.address_match
[0m10:24:24.926144 [debug] [Thread-4 (]: Began running node model.rightmove_epc.address_simularity
[0m10:24:24.926577 [info ] [Thread-2 (]: 6 of 10 START sql view model dbt_melissa_rm_epc.address_match .................. [RUN]
[0m10:24:24.927123 [info ] [Thread-4 (]: 7 of 10 START sql view model dbt_melissa_rm_epc.address_simularity ............. [RUN]
[0m10:24:24.927795 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_rightmove, now model.rightmove_epc.address_match)
[0m10:24:24.928390 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fabfd65d-3ae2-44ca-bf97-8f53dc044a62', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109b43750>]}
[0m10:24:24.928888 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.dim_addressid, now model.rightmove_epc.address_simularity)
[0m10:24:24.929189 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.address_match
[0m10:24:24.929643 [info ] [Thread-3 (]: 4 of 10 OK created sql view model dbt_melissa_rm_epc.dim_uprn .................. [[32mSUCCESS 1[0m in 0.65s]
[0m10:24:24.929932 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.address_simularity
[0m10:24:24.932690 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.address_match"
[0m10:24:24.933235 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.dim_uprn
[0m10:24:24.936096 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.address_simularity"
[0m10:24:24.937014 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.address_match (compile): 10:24:24.930193 => 10:24:24.936835
[0m10:24:24.937305 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.address_match
[0m10:24:24.937662 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.address_simularity (compile): 10:24:24.933434 => 10:24:24.937482
[0m10:24:24.940150 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.address_match"
[0m10:24:24.940471 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.address_simularity
[0m10:24:24.943024 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.address_simularity"
[0m10:24:24.943947 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.address_match"
[0m10:24:24.944274 [debug] [Thread-2 (]: On model.rightmove_epc.address_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.address_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NULL
),

epc_address as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
    where datasource = 'EPC'
)


SELECT rm.*,
CASE WHEN epc_address.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC 


FROM rm
LEFT JOIN epc_address
ON rm.addressid = epc_address.addressid
and rm.FULL_POSTCODE = epc_address.POSTCODE
  );
[0m10:24:24.944588 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m10:24:24.945451 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.address_simularity"
[0m10:24:24.945918 [debug] [Thread-4 (]: On model.rightmove_epc.address_simularity: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.address_simularity"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.address_simularity
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NULL
),

epc_address as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
    where datasource = 'EPC'
)


SELECT rm.*,epc_address.addressid as EPC_ADDRESSID
FROM rm
JOIN epc_address
ON JAROWINKLER_SIMILARITY(rm.addressid, epc_address.addressid) = 1
  );
[0m10:24:24.946199 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m10:24:24.949958 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fabfd65d-3ae2-44ca-bf97-8f53dc044a62', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10972ff10>]}
[0m10:24:24.951036 [info ] [Thread-1 (]: 5 of 10 OK created sql view model dbt_melissa_rm_epc.uprn_match ................ [[32mSUCCESS 1[0m in 0.67s]
[0m10:24:24.951947 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.uprn_match
[0m10:24:24.952392 [debug] [Thread-3 (]: Began running node model.rightmove_epc.no_uprn_match
[0m10:24:24.952888 [info ] [Thread-3 (]: 8 of 10 START sql view model dbt_melissa_rm_epc.no_uprn_match .................. [RUN]
[0m10:24:24.953497 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.dim_uprn, now model.rightmove_epc.no_uprn_match)
[0m10:24:24.953780 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.no_uprn_match
[0m10:24:24.956018 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.no_uprn_match"
[0m10:24:24.957018 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.no_uprn_match (compile): 10:24:24.953957 => 10:24:24.956777
[0m10:24:24.957327 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.no_uprn_match
[0m10:24:24.959455 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.no_uprn_match"
[0m10:24:24.960408 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.no_uprn_match"
[0m10:24:24.960686 [debug] [Thread-3 (]: On model.rightmove_epc.no_uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.no_uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.no_uprn_match
  
   as (
    with rm_no_match_to_epc  as ( -- rightmove uspn does not match epc

    select 
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL

     from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'NO'
    
)

select * from rm_no_match_to_epc

/*
epc_remove as (

    select EPC_UPRN,EPC_ADDRESSID from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'YES'  -- 
),

epc_matched as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs src
    left join epc_remove rem on src.UPRN = rem.EPC_UPRN
    
),

epc_fm_prep as (

    select * from epc_matched
    where EPC_UPRN is NULL

    
)


SELECT * FROM epc_fm_prep
WHERE UPRN NOT NULL */
  );
[0m10:24:24.960921 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m10:24:25.552998 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m10:24:25.553666 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m10:24:25.556895 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.address_simularity (execute): 10:24:24.940719 => 10:24:25.556714
[0m10:24:25.557422 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m10:24:25.559374 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.address_match (execute): 10:24:24.937818 => 10:24:25.559219
[0m10:24:25.559698 [debug] [Thread-4 (]: On model.rightmove_epc.address_simularity: Close
[0m10:24:25.561646 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.no_uprn_match (execute): 10:24:24.957480 => 10:24:25.561495
[0m10:24:25.561965 [debug] [Thread-2 (]: On model.rightmove_epc.address_match: Close
[0m10:24:25.563027 [debug] [Thread-3 (]: On model.rightmove_epc.no_uprn_match: Close
[0m10:24:25.635057 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fabfd65d-3ae2-44ca-bf97-8f53dc044a62', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10972e9d0>]}
[0m10:24:25.635652 [info ] [Thread-2 (]: 6 of 10 OK created sql view model dbt_melissa_rm_epc.address_match ............. [[32mSUCCESS 1[0m in 0.71s]
[0m10:24:25.636115 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.address_match
[0m10:24:25.636645 [debug] [Thread-1 (]: Began running node model.rightmove_epc.all_matches
[0m10:24:25.636998 [debug] [Thread-2 (]: Began running node model.rightmove_epc.no_matches
[0m10:24:25.637316 [info ] [Thread-1 (]: 9 of 10 START sql view model dbt_melissa_rm_epc.all_matches .................... [RUN]
[0m10:24:25.637731 [info ] [Thread-2 (]: 10 of 10 START sql view model dbt_melissa_rm_epc.no_matches .................... [RUN]
[0m10:24:25.638349 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.uprn_match, now model.rightmove_epc.all_matches)
[0m10:24:25.638863 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.address_match, now model.rightmove_epc.no_matches)
[0m10:24:25.639159 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.all_matches
[0m10:24:25.639430 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.no_matches
[0m10:24:25.642548 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.all_matches"
[0m10:24:25.645275 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.no_matches"
[0m10:24:25.646333 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.all_matches (compile): 10:24:25.639614 => 10:24:25.646134
[0m10:24:25.646611 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.all_matches
[0m10:24:25.649142 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.all_matches"
[0m10:24:25.649724 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fabfd65d-3ae2-44ca-bf97-8f53dc044a62', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109987f50>]}
[0m10:24:25.651028 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.no_matches (compile): 10:24:25.642826 => 10:24:25.650849
[0m10:24:25.651332 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.no_matches
[0m10:24:25.650671 [info ] [Thread-4 (]: 7 of 10 OK created sql view model dbt_melissa_rm_epc.address_simularity ........ [[32mSUCCESS 1[0m in 0.72s]
[0m10:24:25.653935 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.no_matches"
[0m10:24:25.654816 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.all_matches"
[0m10:24:25.655299 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fabfd65d-3ae2-44ca-bf97-8f53dc044a62', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109491250>]}
[0m10:24:25.655674 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.address_simularity
[0m10:24:25.656005 [debug] [Thread-1 (]: On model.rightmove_epc.all_matches: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.all_matches"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.all_matches
  
   as (
    with addr as (

    select 
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    '' AS EPC_UPRN,
    EPC_ADDRESSID
    
    from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
    where MATCH_EPC = 'YES' 
),

uprn as (

    select 
    
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN::VARCHAR AS EPC_UPRN,
    EPC_ADDRESSID
     from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'YES'
),

final as (

select 'ADDRESS AND POSTCODE MATCH' AS MATCH_RESULT, * from addr
union all
select 'UPRN MATCH' AS MATCH_RESULT, * from uprn
)

select * from final
  );
[0m10:24:25.656418 [info ] [Thread-3 (]: 8 of 10 OK created sql view model dbt_melissa_rm_epc.no_uprn_match ............. [[32mSUCCESS 1[0m in 0.70s]
[0m10:24:25.657256 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.no_matches"
[0m10:24:25.657633 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:24:25.657993 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.no_uprn_match
[0m10:24:25.658278 [debug] [Thread-2 (]: On model.rightmove_epc.no_matches: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.no_matches"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.no_matches
  
   as (
    with addr as (

    select 
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    '' AS EPC_UPRN,
    EPC_ADDRESSID
    
    from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
    where MATCH_EPC = 'NO' 
),

uprn as (

    select 
    
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN::VARCHAR AS EPC_UPRN,
    EPC_ADDRESSID
    
     from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'NO'
),

final as (

select 'NO ADDRESS OR UPRN MATCH' AS MATCH_RESULT, * from addr
union all
select 'NO UPRN MATCH' AS MATCH_RESULT, * from uprn
)

select * from final
  );
[0m10:24:25.659277 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m10:24:26.105673 [debug] [Thread-2 (]: Snowflake adapter: Snowflake query id: 01b34410-0103-9b9a-0000-719506373492
[0m10:24:26.106228 [debug] [Thread-2 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 19 at position 4
invalid identifier 'EPC_ADDRESSID'
[0m10:24:26.106866 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.no_matches (execute): 10:24:25.651674 => 10:24:26.106632
[0m10:24:26.107282 [debug] [Thread-2 (]: On model.rightmove_epc.no_matches: Close
[0m10:24:26.161086 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b34410-0103-9b63-0000-719506375176
[0m10:24:26.161450 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 19 at position 4
invalid identifier 'EPC_ADDRESSID'
[0m10:24:26.162074 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.all_matches (execute): 10:24:25.646768 => 10:24:26.161805
[0m10:24:26.162570 [debug] [Thread-1 (]: On model.rightmove_epc.all_matches: Close
[0m10:24:26.205058 [debug] [Thread-2 (]: Database Error in model no_matches (models/matching/no_matches.sql)
  000904 (42000): SQL compilation error: error line 19 at position 4
  invalid identifier 'EPC_ADDRESSID'
  compiled Code at target/run/rightmove_epc/models/matching/no_matches.sql
[0m10:24:26.205740 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fabfd65d-3ae2-44ca-bf97-8f53dc044a62', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b937a10>]}
[0m10:24:26.206406 [error] [Thread-2 (]: 10 of 10 ERROR creating sql view model dbt_melissa_rm_epc.no_matches ........... [[31mERROR[0m in 0.57s]
[0m10:24:26.207213 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.no_matches
[0m10:24:26.262937 [debug] [Thread-1 (]: Database Error in model all_matches (models/matching/all_matches.sql)
  000904 (42000): SQL compilation error: error line 19 at position 4
  invalid identifier 'EPC_ADDRESSID'
  compiled Code at target/run/rightmove_epc/models/matching/all_matches.sql
[0m10:24:26.263451 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fabfd65d-3ae2-44ca-bf97-8f53dc044a62', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b941850>]}
[0m10:24:26.263985 [error] [Thread-1 (]: 9 of 10 ERROR creating sql view model dbt_melissa_rm_epc.all_matches ........... [[31mERROR[0m in 0.63s]
[0m10:24:26.264500 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.all_matches
[0m10:24:26.266122 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:24:26.266405 [debug] [MainThread]: Connection 'model.rightmove_epc.all_matches' was properly closed.
[0m10:24:26.266629 [debug] [MainThread]: Connection 'model.rightmove_epc.no_matches' was properly closed.
[0m10:24:26.266836 [debug] [MainThread]: Connection 'model.rightmove_epc.address_simularity' was properly closed.
[0m10:24:26.267042 [debug] [MainThread]: Connection 'model.rightmove_epc.no_uprn_match' was properly closed.
[0m10:24:26.267346 [info ] [MainThread]: 
[0m10:24:26.267605 [info ] [MainThread]: Finished running 10 view models in 0 hours 0 minutes and 3.67 seconds (3.67s).
[0m10:24:26.268795 [debug] [MainThread]: Command end result
[0m10:24:26.276674 [info ] [MainThread]: 
[0m10:24:26.277044 [info ] [MainThread]: [31mCompleted with 2 errors and 0 warnings:[0m
[0m10:24:26.277283 [info ] [MainThread]: 
[0m10:24:26.277506 [error] [MainThread]:   Database Error in model no_matches (models/matching/no_matches.sql)
  000904 (42000): SQL compilation error: error line 19 at position 4
  invalid identifier 'EPC_ADDRESSID'
  compiled Code at target/run/rightmove_epc/models/matching/no_matches.sql
[0m10:24:26.277725 [info ] [MainThread]: 
[0m10:24:26.277945 [error] [MainThread]:   Database Error in model all_matches (models/matching/all_matches.sql)
  000904 (42000): SQL compilation error: error line 19 at position 4
  invalid identifier 'EPC_ADDRESSID'
  compiled Code at target/run/rightmove_epc/models/matching/all_matches.sql
[0m10:24:26.278176 [info ] [MainThread]: 
[0m10:24:26.278407 [info ] [MainThread]: Done. PASS=8 WARN=0 ERROR=2 SKIP=0 TOTAL=10
[0m10:24:26.280457 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 3.9665763, "process_user_time": 1.534008, "process_kernel_time": 0.191318, "process_mem_max_rss": "141590528", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m10:24:26.280878 [debug] [MainThread]: Command `dbt run` failed at 10:24:26.280787 after 3.97 seconds
[0m10:24:26.281179 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10353a110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10363cd90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10986a110>]}
[0m10:24:26.281458 [debug] [MainThread]: Flushing usage events
[0m10:25:20.473901 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113d8eb10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113d9a650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113d9b1d0>]}


============================== 10:25:20.477238 | 9bc4e537-5595-4713-a292-b700c9a9d454 ==============================
[0m10:25:20.477238 [info ] [MainThread]: Running with dbt=1.7.10
[0m10:25:20.477590 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m10:25:20.644501 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9bc4e537-5595-4713-a292-b700c9a9d454', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113dfe850>]}
[0m10:25:20.678390 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9bc4e537-5595-4713-a292-b700c9a9d454', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113ddccd0>]}
[0m10:25:20.679910 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m10:25:20.689127 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m10:25:20.705263 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:25:20.705547 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:25:20.708818 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9bc4e537-5595-4713-a292-b700c9a9d454', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x116bc6ed0>]}
[0m10:25:20.715194 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9bc4e537-5595-4713-a292-b700c9a9d454', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x116c04c10>]}
[0m10:25:20.715477 [info ] [MainThread]: Found 11 models, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m10:25:20.715674 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9bc4e537-5595-4713-a292-b700c9a9d454', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x116a8b850>]}
[0m10:25:20.716800 [info ] [MainThread]: 
[0m10:25:20.717222 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m10:25:20.718031 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m10:25:20.724799 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m10:25:20.725046 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m10:25:20.725219 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:25:21.221712 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 0.0 seconds
[0m10:25:21.224204 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m10:25:21.329022 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m10:25:21.335622 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m10:25:21.335958 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m10:25:21.336219 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:25:21.742821 [debug] [ThreadPool]: SQL status: SUCCESS 11 in 0.0 seconds
[0m10:25:21.744590 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m10:25:21.826117 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9bc4e537-5595-4713-a292-b700c9a9d454', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x116ab0690>]}
[0m10:25:21.827045 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m10:25:21.827388 [info ] [MainThread]: 
[0m10:25:21.830236 [debug] [Thread-1 (]: Began running node model.rightmove_epc.stg_epc_certs
[0m10:25:21.830662 [info ] [Thread-1 (]: 1 of 10 START sql view model dbt_melissa_rm_epc.stg_epc_certs .................. [RUN]
[0m10:25:21.831034 [debug] [Thread-2 (]: Began running node model.rightmove_epc.stg_rightmove
[0m10:25:21.831671 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.stg_epc_certs)
[0m10:25:21.832072 [info ] [Thread-2 (]: 2 of 10 START sql view model dbt_melissa_rm_epc.stg_rightmove .................. [RUN]
[0m10:25:21.832444 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.stg_epc_certs
[0m10:25:21.833119 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.stg_rightmove'
[0m10:25:21.839625 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.stg_epc_certs"
[0m10:25:21.840010 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.stg_rightmove
[0m10:25:21.842286 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.stg_rightmove"
[0m10:25:21.842803 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (compile): 10:25:21.833360 => 10:25:21.842633
[0m10:25:21.843122 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.stg_epc_certs
[0m10:25:21.843485 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (compile): 10:25:21.840270 => 10:25:21.843332
[0m10:25:21.891857 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.stg_epc_certs"
[0m10:25:21.892102 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.stg_rightmove
[0m10:25:21.893784 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.stg_rightmove"
[0m10:25:21.894418 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.stg_rightmove"
[0m10:25:21.894974 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.stg_epc_certs"
[0m10:25:21.895184 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_rightmove"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
  
   as (
    with rm as (

    SELECT 
    LISTING_ID,
    UPPER(TRIM(replace(REPLACE(CONCAT(ADDRESS_1::VARCHAR,ADDRESS_2::VARCHAR),' '),','))) AS ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, 
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    STUDENTLET_FLAG,
    COMBINED_PROPERTY_TYPE
    -- property type
    FROM 
       ANALYTICS.RIGHTMOVE_PROD.CLEAN_RAW_RIGHTMOVE_DATA 

 
)

SELECT * FROM rm
  );
[0m10:25:21.895407 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_epc_certs"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
  
   as (
    WITH epc_certs as (
    
    select 
    UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    COUNTY,
    LOCAL_AUTHORITY as LOCAL_AUTHORITY_CODE,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    UPPER(CASE WHEN (UPPER(ADDRESS1) LIKE 'FLAT%' OR UPPER(ADDRESS1) LIKE 'UNIT%') or UPPER(ADDRESS1) LIKE 'ROOM%' 
    THEN TRIM(REPLACE(REPLACE(CONCAT(ADDRESS),','),' '))
    ELSE trim(replace(replace(ADDRESS1,' '),',')) END) AS ADDRESSID,
    CASE WHEN UPRN is null and addressid is null THEN 1 else 0 end as REMOVE_FROM_RM_MATCH,
    FLOOR_LEVEL,
    FLAT_TOP_STOREY,
    FLAT_STOREY_COUNT,
    PROPERTY_TYPE
 from  RAW.EPC_TEST_DATA.EPC_CERTIFICATES 

)

SELECT * FROM epc_certs
  );
[0m10:25:21.895610 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m10:25:21.895772 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:25:22.436418 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m10:25:22.457272 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (execute): 10:25:21.892292 => 10:25:22.457087
[0m10:25:22.457664 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: Close
[0m10:25:22.480597 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m10:25:22.482589 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (execute): 10:25:21.843627 => 10:25:22.482445
[0m10:25:22.482860 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: Close
[0m10:25:22.534341 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9bc4e537-5595-4713-a292-b700c9a9d454', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113d99810>]}
[0m10:25:22.535125 [info ] [Thread-2 (]: 2 of 10 OK created sql view model dbt_melissa_rm_epc.stg_rightmove ............. [[32mSUCCESS 1[0m in 0.70s]
[0m10:25:22.535644 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.stg_rightmove
[0m10:25:22.550491 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9bc4e537-5595-4713-a292-b700c9a9d454', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x116b9f810>]}
[0m10:25:22.551080 [info ] [Thread-1 (]: 1 of 10 OK created sql view model dbt_melissa_rm_epc.stg_epc_certs ............. [[32mSUCCESS 1[0m in 0.72s]
[0m10:25:22.551503 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.stg_epc_certs
[0m10:25:22.552108 [debug] [Thread-4 (]: Began running node model.rightmove_epc.dim_addressid
[0m10:25:22.552425 [debug] [Thread-3 (]: Began running node model.rightmove_epc.dim_uprn
[0m10:25:22.552686 [info ] [Thread-4 (]: 3 of 10 START sql view model dbt_melissa_rm_epc.dim_addressid .................. [RUN]
[0m10:25:22.553017 [debug] [Thread-2 (]: Began running node model.rightmove_epc.uprn_match
[0m10:25:22.553319 [info ] [Thread-3 (]: 4 of 10 START sql view model dbt_melissa_rm_epc.dim_uprn ....................... [RUN]
[0m10:25:22.553884 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_addressid'
[0m10:25:22.554161 [info ] [Thread-2 (]: 5 of 10 START sql view model dbt_melissa_rm_epc.uprn_match ..................... [RUN]
[0m10:25:22.554637 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_uprn'
[0m10:25:22.554868 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.dim_addressid
[0m10:25:22.555263 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_rightmove, now model.rightmove_epc.uprn_match)
[0m10:25:22.555493 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.dim_uprn
[0m10:25:22.557843 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.dim_addressid"
[0m10:25:22.558104 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.uprn_match
[0m10:25:22.559799 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.dim_uprn"
[0m10:25:22.561704 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.uprn_match"
[0m10:25:22.562212 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_addressid (compile): 10:25:22.555634 => 10:25:22.562079
[0m10:25:22.562471 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.dim_addressid
[0m10:25:22.564542 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.dim_addressid"
[0m10:25:22.564857 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.dim_uprn (compile): 10:25:22.558264 => 10:25:22.564728
[0m10:25:22.565217 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.uprn_match (compile): 10:25:22.560027 => 10:25:22.565100
[0m10:25:22.565461 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.dim_uprn
[0m10:25:22.565739 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.uprn_match
[0m10:25:22.566475 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.dim_addressid"
[0m10:25:22.568428 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.dim_uprn"
[0m10:25:22.570272 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.uprn_match"
[0m10:25:22.570547 [debug] [Thread-4 (]: On model.rightmove_epc.dim_addressid: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_addressid"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE ADDRESS'

with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource,
    POSTCODE

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    where REMOVE_FROM_RM_MATCH = 0
    AND ADDRESSID IS NOT NULL

),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    WHERE ADDRESSID IS NOT NULL

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where uprn is null
and addressid is not null
  );
[0m10:25:22.571019 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m10:25:22.572380 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.dim_uprn"
[0m10:25:22.573048 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.uprn_match"
[0m10:25:22.573368 [debug] [Thread-3 (]: On model.rightmove_epc.dim_uprn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_uprn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE UPRNS


with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource,
    POSTCODE
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    where REMOVE_FROM_RM_MATCH = 0
    AND UPRN IS NOT NULL
),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    WHERE UPRN IS NOT NULL

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where uprn is not null
  );
[0m10:25:22.573656 [debug] [Thread-2 (]: On model.rightmove_epc.uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
  
   as (
    with epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    where uprn is not null
    AND REMOVE_FROM_RM_MATCH = 1

),

rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where uprn is not null
),

final as (

    select 
    LISTING_ID,
    rm.ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    rm.UPRN,
    rm.LOCAL_AUTHORITY_CODE,
    rm.LOCAL_AUTHORITY,
    rm.GOV_REGION_CODE,
    FLOOR_AREA,
    rm.FLOOR_LEVEL,
    epc.UPRN AS EPC_UPRN,
 --   epc.TOTAL_FLOOR_AREA,
    epc.ADDRESSID as EPC_ADDRESSID,
    CASE WHEN epc.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC    
    
     from rm left join epc on rm.uprn = epc.uprn
)

select * from final
  );
[0m10:25:22.573897 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m10:25:22.574099 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m10:25:23.408172 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m10:25:23.410845 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.dim_uprn (execute): 10:25:22.566608 => 10:25:23.410654
[0m10:25:23.411466 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m10:25:23.412094 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m10:25:23.412477 [debug] [Thread-3 (]: On model.rightmove_epc.dim_uprn: Close
[0m10:25:23.414496 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.uprn_match (execute): 10:25:22.568628 => 10:25:23.414338
[0m10:25:23.418096 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_addressid (execute): 10:25:22.562626 => 10:25:23.417941
[0m10:25:23.419161 [debug] [Thread-2 (]: On model.rightmove_epc.uprn_match: Close
[0m10:25:23.419783 [debug] [Thread-4 (]: On model.rightmove_epc.dim_addressid: Close
[0m10:25:23.493210 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9bc4e537-5595-4713-a292-b700c9a9d454', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x116f7eb50>]}
[0m10:25:23.493850 [info ] [Thread-3 (]: 4 of 10 OK created sql view model dbt_melissa_rm_epc.dim_uprn .................. [[32mSUCCESS 1[0m in 0.94s]
[0m10:25:23.494314 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.dim_uprn
[0m10:25:23.512653 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9bc4e537-5595-4713-a292-b700c9a9d454', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x116f7f0d0>]}
[0m10:25:23.513487 [info ] [Thread-2 (]: 5 of 10 OK created sql view model dbt_melissa_rm_epc.uprn_match ................ [[32mSUCCESS 1[0m in 0.96s]
[0m10:25:23.514034 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.uprn_match
[0m10:25:23.514513 [debug] [Thread-1 (]: Began running node model.rightmove_epc.no_uprn_match
[0m10:25:23.515330 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9bc4e537-5595-4713-a292-b700c9a9d454', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x116ab1dd0>]}
[0m10:25:23.514848 [info ] [Thread-1 (]: 6 of 10 START sql view model dbt_melissa_rm_epc.no_uprn_match .................. [RUN]
[0m10:25:23.515802 [info ] [Thread-4 (]: 3 of 10 OK created sql view model dbt_melissa_rm_epc.dim_addressid ............. [[32mSUCCESS 1[0m in 0.96s]
[0m10:25:23.516326 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_epc_certs, now model.rightmove_epc.no_uprn_match)
[0m10:25:23.516693 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.dim_addressid
[0m10:25:23.516966 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.no_uprn_match
[0m10:25:23.519555 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.no_uprn_match"
[0m10:25:23.519821 [debug] [Thread-2 (]: Began running node model.rightmove_epc.address_match
[0m10:25:23.520066 [debug] [Thread-3 (]: Began running node model.rightmove_epc.address_simularity
[0m10:25:23.520349 [info ] [Thread-2 (]: 7 of 10 START sql view model dbt_melissa_rm_epc.address_match .................. [RUN]
[0m10:25:23.520689 [info ] [Thread-3 (]: 8 of 10 START sql view model dbt_melissa_rm_epc.address_simularity ............. [RUN]
[0m10:25:23.521089 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.uprn_match, now model.rightmove_epc.address_match)
[0m10:25:23.521343 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.no_uprn_match (compile): 10:25:23.517249 => 10:25:23.521213
[0m10:25:23.522020 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.dim_uprn, now model.rightmove_epc.address_simularity)
[0m10:25:23.522267 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.address_match
[0m10:25:23.522501 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.no_uprn_match
[0m10:25:23.522722 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.address_simularity
[0m10:25:23.524588 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.address_match"
[0m10:25:23.527029 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.no_uprn_match"
[0m10:25:23.529041 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.address_simularity"
[0m10:25:23.529643 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.address_match (compile): 10:25:23.522859 => 10:25:23.529508
[0m10:25:23.529871 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.address_match
[0m10:25:23.531833 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.address_match"
[0m10:25:23.532112 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.address_simularity (compile): 10:25:23.527284 => 10:25:23.531973
[0m10:25:23.532712 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.no_uprn_match"
[0m10:25:23.533005 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.address_simularity
[0m10:25:23.533271 [debug] [Thread-1 (]: On model.rightmove_epc.no_uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.no_uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.no_uprn_match
  
   as (
    with rm_no_match_to_epc  as ( -- rightmove uspn does not match epc

    select 
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL

     from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'NO'
    
)

select * from rm_no_match_to_epc

/*
epc_remove as (

    select EPC_UPRN,EPC_ADDRESSID from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'YES'  -- 
),

epc_matched as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs src
    left join epc_remove rem on src.UPRN = rem.EPC_UPRN
    
),

epc_fm_prep as (

    select * from epc_matched
    where EPC_UPRN is NULL

    
)


SELECT * FROM epc_fm_prep
WHERE UPRN NOT NULL */
  );
[0m10:25:23.535230 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.address_simularity"
[0m10:25:23.535819 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.address_match"
[0m10:25:23.536042 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:25:23.536332 [debug] [Thread-2 (]: On model.rightmove_epc.address_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.address_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NULL
),

epc_address as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
    where datasource = 'EPC'
)


SELECT rm.*,
CASE WHEN epc_address.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_address.ADDRESSID AS EPC_ADDRESSID


FROM rm
LEFT JOIN epc_address
ON rm.addressid = epc_address.addressid
and rm.FULL_POSTCODE = epc_address.POSTCODE
  );
[0m10:25:23.537283 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.address_simularity"
[0m10:25:23.537521 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m10:25:23.537964 [debug] [Thread-3 (]: On model.rightmove_epc.address_simularity: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.address_simularity"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.address_simularity
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NULL
),

epc_address as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
    where datasource = 'EPC'
)


SELECT rm.*,epc_address.addressid as EPC_ADDRESSID
FROM rm
JOIN epc_address
ON JAROWINKLER_SIMILARITY(rm.addressid, epc_address.addressid) = 1
  );
[0m10:25:23.538467 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m10:25:24.123273 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m10:25:24.123938 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m10:25:24.126541 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.address_match (execute): 10:25:23.530011 => 10:25:24.126344
[0m10:25:24.128550 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.no_uprn_match (execute): 10:25:23.524781 => 10:25:24.128395
[0m10:25:24.128876 [debug] [Thread-2 (]: On model.rightmove_epc.address_match: Close
[0m10:25:24.129171 [debug] [Thread-1 (]: On model.rightmove_epc.no_uprn_match: Close
[0m10:25:24.136202 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m10:25:24.138391 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.address_simularity (execute): 10:25:23.533477 => 10:25:24.138219
[0m10:25:24.138717 [debug] [Thread-3 (]: On model.rightmove_epc.address_simularity: Close
[0m10:25:24.216983 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9bc4e537-5595-4713-a292-b700c9a9d454', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x116cb0bd0>]}
[0m10:25:24.217866 [info ] [Thread-3 (]: 8 of 10 OK created sql view model dbt_melissa_rm_epc.address_simularity ........ [[32mSUCCESS 1[0m in 0.70s]
[0m10:25:24.218419 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.address_simularity
[0m10:25:24.219316 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9bc4e537-5595-4713-a292-b700c9a9d454', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x116b2f9d0>]}
[0m10:25:24.219788 [info ] [Thread-2 (]: 7 of 10 OK created sql view model dbt_melissa_rm_epc.address_match ............. [[32mSUCCESS 1[0m in 0.70s]
[0m10:25:24.220233 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.address_match
[0m10:25:24.220684 [debug] [Thread-4 (]: Began running node model.rightmove_epc.all_matches
[0m10:25:24.221005 [debug] [Thread-3 (]: Began running node model.rightmove_epc.no_matches
[0m10:25:24.221316 [info ] [Thread-4 (]: 9 of 10 START sql view model dbt_melissa_rm_epc.all_matches .................... [RUN]
[0m10:25:24.221622 [info ] [Thread-3 (]: 10 of 10 START sql view model dbt_melissa_rm_epc.no_matches .................... [RUN]
[0m10:25:24.222107 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.dim_addressid, now model.rightmove_epc.all_matches)
[0m10:25:24.222542 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.address_simularity, now model.rightmove_epc.no_matches)
[0m10:25:24.222807 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.all_matches
[0m10:25:24.223046 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.no_matches
[0m10:25:24.225940 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.all_matches"
[0m10:25:24.228154 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.no_matches"
[0m10:25:24.229964 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.no_matches (compile): 10:25:24.226138 => 10:25:24.229786
[0m10:25:24.230270 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.all_matches (compile): 10:25:24.223227 => 10:25:24.230121
[0m10:25:24.230549 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.no_matches
[0m10:25:24.230849 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.all_matches
[0m10:25:24.233058 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.no_matches"
[0m10:25:24.235204 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.all_matches"
[0m10:25:24.236357 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.no_matches"
[0m10:25:24.237182 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.all_matches"
[0m10:25:24.237430 [debug] [Thread-3 (]: On model.rightmove_epc.no_matches: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.no_matches"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.no_matches
  
   as (
    with addr as (

    select 
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    '' AS EPC_UPRN,
    EPC_ADDRESSID
    
    from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
    where MATCH_EPC = 'NO' 
),

uprn as (

    select 
    
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN::VARCHAR AS EPC_UPRN,
    EPC_ADDRESSID
    
     from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'NO'
),

final as (

select 'NO ADDRESS OR UPRN MATCH' AS MATCH_RESULT, * from addr
union all
select 'NO UPRN MATCH' AS MATCH_RESULT, * from uprn
)

select * from final
  );
[0m10:25:24.237724 [debug] [Thread-4 (]: On model.rightmove_epc.all_matches: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.all_matches"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.all_matches
  
   as (
    with addr as (

    select 
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    '' AS EPC_UPRN,
    EPC_ADDRESSID
    
    from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
    where MATCH_EPC = 'YES' 
),

uprn as (

    select 
    
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN::VARCHAR AS EPC_UPRN,
    EPC_ADDRESSID
     from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'YES'
),

final as (

select 'ADDRESS AND POSTCODE MATCH' AS MATCH_RESULT, * from addr
union all
select 'UPRN MATCH' AS MATCH_RESULT, * from uprn
)

select * from final
  );
[0m10:25:24.237960 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m10:25:24.238152 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m10:25:24.272252 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9bc4e537-5595-4713-a292-b700c9a9d454', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x116ab7810>]}
[0m10:25:24.272734 [info ] [Thread-1 (]: 6 of 10 OK created sql view model dbt_melissa_rm_epc.no_uprn_match ............. [[32mSUCCESS 1[0m in 0.76s]
[0m10:25:24.273078 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.no_uprn_match
[0m10:25:24.838911 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m10:25:24.841286 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.no_matches (execute): 10:25:24.231027 => 10:25:24.841115
[0m10:25:24.841611 [debug] [Thread-3 (]: On model.rightmove_epc.no_matches: Close
[0m10:25:24.866264 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m10:25:24.868311 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.all_matches (execute): 10:25:24.233240 => 10:25:24.868148
[0m10:25:24.868614 [debug] [Thread-4 (]: On model.rightmove_epc.all_matches: Close
[0m10:25:24.953644 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9bc4e537-5595-4713-a292-b700c9a9d454', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11724bf90>]}
[0m10:25:24.954314 [info ] [Thread-3 (]: 10 of 10 OK created sql view model dbt_melissa_rm_epc.no_matches ............... [[32mSUCCESS 1[0m in 0.73s]
[0m10:25:24.954816 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.no_matches
[0m10:25:24.991953 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '9bc4e537-5595-4713-a292-b700c9a9d454', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x117221210>]}
[0m10:25:24.992580 [info ] [Thread-4 (]: 9 of 10 OK created sql view model dbt_melissa_rm_epc.all_matches ............... [[32mSUCCESS 1[0m in 0.77s]
[0m10:25:24.993044 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.all_matches
[0m10:25:24.994513 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:25:24.994803 [debug] [MainThread]: Connection 'model.rightmove_epc.no_uprn_match' was properly closed.
[0m10:25:24.995037 [debug] [MainThread]: Connection 'model.rightmove_epc.address_match' was properly closed.
[0m10:25:24.995253 [debug] [MainThread]: Connection 'model.rightmove_epc.all_matches' was properly closed.
[0m10:25:24.995460 [debug] [MainThread]: Connection 'model.rightmove_epc.no_matches' was properly closed.
[0m10:25:24.995758 [info ] [MainThread]: 
[0m10:25:24.996025 [info ] [MainThread]: Finished running 10 view models in 0 hours 0 minutes and 4.28 seconds (4.28s).
[0m10:25:24.997132 [debug] [MainThread]: Command end result
[0m10:25:25.005770 [info ] [MainThread]: 
[0m10:25:25.006178 [info ] [MainThread]: [32mCompleted successfully[0m
[0m10:25:25.006463 [info ] [MainThread]: 
[0m10:25:25.006729 [info ] [MainThread]: Done. PASS=10 WARN=0 ERROR=0 SKIP=0 TOTAL=10
[0m10:25:25.008657 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.5832567, "process_user_time": 1.492259, "process_kernel_time": 0.184596, "process_mem_max_rss": "139509760", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m10:25:25.009046 [debug] [MainThread]: Command `dbt run` succeeded at 10:25:25.008958 after 4.58 seconds
[0m10:25:25.009323 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10476a110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1048a5cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104752710>]}
[0m10:25:25.009593 [debug] [MainThread]: Flushing usage events
[0m10:46:02.900056 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10761bd50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10765e5d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10765f150>]}


============================== 10:46:02.903078 | b479bd7f-ff14-4ec0-9342-4b851c028cdb ==============================
[0m10:46:02.903078 [info ] [MainThread]: Running with dbt=1.7.10
[0m10:46:02.903400 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'profiles_dir': '/Users/melissabee/.dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m10:46:03.081611 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b479bd7f-ff14-4ec0-9342-4b851c028cdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107687490>]}
[0m10:46:03.115791 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b479bd7f-ff14-4ec0-9342-4b851c028cdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120a2b3d0>]}
[0m10:46:03.116345 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m10:46:03.126510 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m10:46:03.150686 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:46:03.150937 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:46:03.154051 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b479bd7f-ff14-4ec0-9342-4b851c028cdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120d47250>]}
[0m10:46:03.161046 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b479bd7f-ff14-4ec0-9342-4b851c028cdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107613190>]}
[0m10:46:03.161341 [info ] [MainThread]: Found 11 models, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m10:46:03.161552 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b479bd7f-ff14-4ec0-9342-4b851c028cdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120c732d0>]}
[0m10:46:03.162718 [info ] [MainThread]: 
[0m10:46:03.163169 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m10:46:03.163931 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m10:46:03.170360 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m10:46:03.170594 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m10:46:03.170744 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:46:03.630525 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 0.0 seconds
[0m10:46:03.633095 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m10:46:03.729605 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m10:46:03.738145 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m10:46:03.738556 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m10:46:03.738886 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:46:04.102777 [debug] [ThreadPool]: SQL status: SUCCESS 11 in 0.0 seconds
[0m10:46:04.104710 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m10:46:04.199239 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b479bd7f-ff14-4ec0-9342-4b851c028cdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120c96290>]}
[0m10:46:04.200589 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m10:46:04.201043 [info ] [MainThread]: 
[0m10:46:04.205057 [debug] [Thread-1 (]: Began running node model.rightmove_epc.stg_epc_certs
[0m10:46:04.205510 [debug] [Thread-2 (]: Began running node model.rightmove_epc.stg_rightmove
[0m10:46:04.206073 [info ] [Thread-1 (]: 1 of 11 START sql view model dbt_melissa_rm_epc.stg_epc_certs .................. [RUN]
[0m10:46:04.206576 [info ] [Thread-2 (]: 2 of 11 START sql view model dbt_melissa_rm_epc.stg_rightmove .................. [RUN]
[0m10:46:04.207349 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.stg_epc_certs)
[0m10:46:04.208015 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.stg_rightmove'
[0m10:46:04.208404 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.stg_epc_certs
[0m10:46:04.208753 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.stg_rightmove
[0m10:46:04.215614 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.stg_epc_certs"
[0m10:46:04.217971 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.stg_rightmove"
[0m10:46:04.218817 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (compile): 10:46:04.208980 => 10:46:04.218550
[0m10:46:04.219173 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.stg_epc_certs
[0m10:46:04.225815 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (compile): 10:46:04.215960 => 10:46:04.225635
[0m10:46:04.269470 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.stg_epc_certs"
[0m10:46:04.269737 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.stg_rightmove
[0m10:46:04.271500 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.stg_rightmove"
[0m10:46:04.272320 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.stg_epc_certs"
[0m10:46:04.272790 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.stg_rightmove"
[0m10:46:04.273012 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_epc_certs"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
  
   as (
    WITH epc_certs as (
    
    select 
    UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    COUNTY,
    LOCAL_AUTHORITY as LOCAL_AUTHORITY_CODE,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    UPPER(CASE WHEN (UPPER(ADDRESS1) LIKE 'FLAT%' OR UPPER(ADDRESS1) LIKE 'UNIT%') or UPPER(ADDRESS1) LIKE 'ROOM%' 
    THEN TRIM(REPLACE(REPLACE(CONCAT(ADDRESS),','),' '))
    ELSE trim(replace(replace(ADDRESS1,' '),',')) END) AS ADDRESSID,
    CASE WHEN UPRN is null and addressid is null THEN 1 else 0 end as REMOVE_FROM_RM_MATCH,
    FLOOR_LEVEL,
    FLAT_TOP_STOREY,
    FLAT_STOREY_COUNT,
    PROPERTY_TYPE
 from  RAW.EPC_TEST_DATA.EPC_CERTIFICATES 

)

SELECT * FROM epc_certs
  );
[0m10:46:04.273242 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_rightmove"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
  
   as (
    with rm as (

    SELECT 
    LISTING_ID,
    UPPER(TRIM(replace(REPLACE(CONCAT(ADDRESS_1::VARCHAR,ADDRESS_2::VARCHAR),' '),','))) AS ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, 
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    STUDENTLET_FLAG,
    COMBINED_PROPERTY_TYPE
    -- property type
    FROM 
       ANALYTICS.RIGHTMOVE_PROD.CLEAN_RAW_RIGHTMOVE_DATA 

 
)

SELECT * FROM rm
  );
[0m10:46:04.273430 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:46:04.273602 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m10:46:04.916617 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m10:46:04.917277 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m10:46:04.932735 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (execute): 10:46:04.219366 => 10:46:04.932571
[0m10:46:04.934383 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (execute): 10:46:04.269943 => 10:46:04.934265
[0m10:46:04.934630 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: Close
[0m10:46:04.934846 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: Close
[0m10:46:05.141555 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b479bd7f-ff14-4ec0-9342-4b851c028cdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120cc8350>]}
[0m10:46:05.142316 [info ] [Thread-1 (]: 1 of 11 OK created sql view model dbt_melissa_rm_epc.stg_epc_certs ............. [[32mSUCCESS 1[0m in 0.93s]
[0m10:46:05.142859 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.stg_epc_certs
[0m10:46:05.177407 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b479bd7f-ff14-4ec0-9342-4b851c028cdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120cade50>]}
[0m10:46:05.178023 [info ] [Thread-2 (]: 2 of 11 OK created sql view model dbt_melissa_rm_epc.stg_rightmove ............. [[32mSUCCESS 1[0m in 0.97s]
[0m10:46:05.178545 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.stg_rightmove
[0m10:46:05.179272 [debug] [Thread-4 (]: Began running node model.rightmove_epc.dim_addressid
[0m10:46:05.179612 [debug] [Thread-3 (]: Began running node model.rightmove_epc.dim_uprn
[0m10:46:05.179929 [debug] [Thread-1 (]: Began running node model.rightmove_epc.uprn_match
[0m10:46:05.180264 [info ] [Thread-4 (]: 3 of 11 START sql view model dbt_melissa_rm_epc.dim_addressid .................. [RUN]
[0m10:46:05.180644 [info ] [Thread-3 (]: 4 of 11 START sql view model dbt_melissa_rm_epc.dim_uprn ....................... [RUN]
[0m10:46:05.181019 [info ] [Thread-1 (]: 5 of 11 START sql view model dbt_melissa_rm_epc.uprn_match ..................... [RUN]
[0m10:46:05.181631 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_addressid'
[0m10:46:05.182165 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_uprn'
[0m10:46:05.182635 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_epc_certs, now model.rightmove_epc.uprn_match)
[0m10:46:05.182927 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.dim_addressid
[0m10:46:05.183196 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.dim_uprn
[0m10:46:05.183454 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.uprn_match
[0m10:46:05.186269 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.dim_addressid"
[0m10:46:05.188449 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.dim_uprn"
[0m10:46:05.190877 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.uprn_match"
[0m10:46:05.191997 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.uprn_match (compile): 10:46:05.188680 => 10:46:05.191734
[0m10:46:05.192440 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.dim_uprn (compile): 10:46:05.186513 => 10:46:05.192232
[0m10:46:05.192747 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_addressid (compile): 10:46:05.183630 => 10:46:05.192604
[0m10:46:05.192999 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.uprn_match
[0m10:46:05.193278 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.dim_uprn
[0m10:46:05.193518 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.dim_addressid
[0m10:46:05.195935 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.uprn_match"
[0m10:46:05.197966 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.dim_uprn"
[0m10:46:05.199938 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.dim_addressid"
[0m10:46:05.201140 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.dim_addressid"
[0m10:46:05.201694 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.uprn_match"
[0m10:46:05.202295 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.dim_uprn"
[0m10:46:05.202524 [debug] [Thread-4 (]: On model.rightmove_epc.dim_addressid: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_addressid"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE ADDRESS'

with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource,
    POSTCODE

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    where REMOVE_FROM_RM_MATCH = 0
    AND ADDRESSID IS NOT NULL

),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    WHERE ADDRESSID IS NOT NULL

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where uprn is null
and addressid is not null
  );
[0m10:46:05.202807 [debug] [Thread-1 (]: On model.rightmove_epc.uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
  
   as (
    with epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    where uprn is not null
    AND REMOVE_FROM_RM_MATCH = 1

),

rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where uprn is not null
),

final as (

    select rm.*
    epc.ADDRESSID as EPC_ADDRESSID,
    CASE WHEN epc.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC,

    
     from rm left join epc on rm.uprn = epc.uprn
)

select * from final
  );
[0m10:46:05.203084 [debug] [Thread-3 (]: On model.rightmove_epc.dim_uprn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_uprn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE UPRNS


with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource,
    POSTCODE
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    where REMOVE_FROM_RM_MATCH = 0
    AND UPRN IS NOT NULL
),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    WHERE UPRN IS NOT NULL

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where uprn is not null
  );
[0m10:46:05.203331 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m10:46:05.203529 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:46:05.203736 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m10:46:05.520379 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b34426-0103-9b63-0000-7195063751ba
[0m10:46:05.520833 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 21 at position 4 unexpected 'epc'.
syntax error line 22 at position 9 unexpected 'WHEN'.
syntax error line 25 at position 5 unexpected 'from'.
[0m10:46:05.521310 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.uprn_match (execute): 10:46:05.193678 => 10:46:05.521132
[0m10:46:05.521623 [debug] [Thread-1 (]: On model.rightmove_epc.uprn_match: Close
[0m10:46:05.616276 [debug] [Thread-1 (]: Database Error in model uprn_match (models/matching/uprn_match.sql)
  001003 (42000): SQL compilation error:
  syntax error line 21 at position 4 unexpected 'epc'.
  syntax error line 22 at position 9 unexpected 'WHEN'.
  syntax error line 25 at position 5 unexpected 'from'.
  compiled Code at target/run/rightmove_epc/models/matching/uprn_match.sql
[0m10:46:05.616829 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b479bd7f-ff14-4ec0-9342-4b851c028cdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120f24f10>]}
[0m10:46:05.617333 [error] [Thread-1 (]: 5 of 11 ERROR creating sql view model dbt_melissa_rm_epc.uprn_match ............ [[31mERROR[0m in 0.43s]
[0m10:46:05.617830 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.uprn_match
[0m10:46:05.618381 [debug] [Thread-2 (]: Began running node model.rightmove_epc.no_uprn_match
[0m10:46:05.618761 [info ] [Thread-2 (]: 6 of 11 SKIP relation dbt_melissa_rm_epc.no_uprn_match ......................... [[33mSKIP[0m]
[0m10:46:05.619142 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.no_uprn_match
[0m10:46:05.764606 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m10:46:05.767228 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_addressid (execute): 10:46:05.198132 => 10:46:05.767022
[0m10:46:05.767614 [debug] [Thread-4 (]: On model.rightmove_epc.dim_addressid: Close
[0m10:46:05.786234 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m10:46:05.788761 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.dim_uprn (execute): 10:46:05.196113 => 10:46:05.788568
[0m10:46:05.789142 [debug] [Thread-3 (]: On model.rightmove_epc.dim_uprn: Close
[0m10:46:05.863647 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b479bd7f-ff14-4ec0-9342-4b851c028cdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120d87490>]}
[0m10:46:05.864309 [info ] [Thread-4 (]: 3 of 11 OK created sql view model dbt_melissa_rm_epc.dim_addressid ............. [[32mSUCCESS 1[0m in 0.68s]
[0m10:46:05.864871 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.dim_addressid
[0m10:46:05.865467 [debug] [Thread-1 (]: Began running node model.rightmove_epc.address_match
[0m10:46:05.865876 [debug] [Thread-2 (]: Began running node model.rightmove_epc.address_simularity
[0m10:46:05.866246 [info ] [Thread-1 (]: 7 of 11 START sql view model dbt_melissa_rm_epc.address_match .................. [RUN]
[0m10:46:05.866614 [info ] [Thread-2 (]: 8 of 11 START sql view model dbt_melissa_rm_epc.address_simularity ............. [RUN]
[0m10:46:05.867148 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.uprn_match, now model.rightmove_epc.address_match)
[0m10:46:05.867624 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_rightmove, now model.rightmove_epc.address_simularity)
[0m10:46:05.867906 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.address_match
[0m10:46:05.868176 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.address_simularity
[0m10:46:05.872207 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.address_simularity"
[0m10:46:05.875222 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.address_match"
[0m10:46:05.877407 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.address_simularity (compile): 10:46:05.869761 => 10:46:05.877194
[0m10:46:05.877738 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.address_match (compile): 10:46:05.868350 => 10:46:05.877575
[0m10:46:05.878020 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.address_simularity
[0m10:46:05.878270 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.address_match
[0m10:46:05.880743 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.address_simularity"
[0m10:46:05.883024 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.address_match"
[0m10:46:05.884071 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.address_match"
[0m10:46:05.884644 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.address_simularity"
[0m10:46:05.884916 [debug] [Thread-1 (]: On model.rightmove_epc.address_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.address_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NULL
),

epc_address as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
    where datasource = 'EPC'
)


SELECT rm.*,
CASE WHEN epc_address.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_address.ADDRESSID AS EPC_ADDRESSID


FROM rm
LEFT JOIN epc_address
ON rm.addressid = epc_address.addressid
and rm.FULL_POSTCODE = epc_address.POSTCODE
  );
[0m10:46:05.885202 [debug] [Thread-2 (]: On model.rightmove_epc.address_simularity: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.address_simularity"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.address_simularity
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NULL
),

epc_address as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
    where datasource = 'EPC'
)


SELECT rm.*,epc_address.addressid as EPC_ADDRESSID
FROM rm
JOIN epc_address
ON JAROWINKLER_SIMILARITY(rm.addressid, epc_address.addressid) = 1
  );
[0m10:46:05.885456 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:46:05.885674 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m10:46:05.888938 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b479bd7f-ff14-4ec0-9342-4b851c028cdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x121c08a90>]}
[0m10:46:05.889348 [info ] [Thread-3 (]: 4 of 11 OK created sql view model dbt_melissa_rm_epc.dim_uprn .................. [[32mSUCCESS 1[0m in 0.71s]
[0m10:46:05.889741 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.dim_uprn
[0m10:46:06.779216 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m10:46:06.780621 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m10:46:06.784487 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.address_match (execute): 10:46:05.880939 => 10:46:06.784295
[0m10:46:06.786493 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.address_simularity (execute): 10:46:05.878422 => 10:46:06.786334
[0m10:46:06.786864 [debug] [Thread-1 (]: On model.rightmove_epc.address_match: Close
[0m10:46:06.787263 [debug] [Thread-2 (]: On model.rightmove_epc.address_simularity: Close
[0m10:46:06.903594 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b479bd7f-ff14-4ec0-9342-4b851c028cdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x121c088d0>]}
[0m10:46:06.904618 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b479bd7f-ff14-4ec0-9342-4b851c028cdb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1208e1850>]}
[0m10:46:06.905472 [info ] [Thread-1 (]: 7 of 11 OK created sql view model dbt_melissa_rm_epc.address_match ............. [[32mSUCCESS 1[0m in 1.04s]
[0m10:46:06.906190 [info ] [Thread-2 (]: 8 of 11 OK created sql view model dbt_melissa_rm_epc.address_simularity ........ [[32mSUCCESS 1[0m in 1.04s]
[0m10:46:06.906919 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.address_match
[0m10:46:06.907416 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.address_simularity
[0m10:46:06.908208 [debug] [Thread-4 (]: Began running node model.rightmove_epc.all_matches
[0m10:46:06.908688 [debug] [Thread-3 (]: Began running node model.rightmove_epc.houses_report
[0m10:46:06.909139 [debug] [Thread-1 (]: Began running node model.rightmove_epc.no_matches
[0m10:46:06.909601 [info ] [Thread-4 (]: 9 of 11 SKIP relation dbt_melissa_rm_epc.all_matches ........................... [[33mSKIP[0m]
[0m10:46:06.910003 [info ] [Thread-3 (]: 10 of 11 SKIP relation dbt_melissa_rm_epc.houses_report ........................ [[33mSKIP[0m]
[0m10:46:06.910433 [info ] [Thread-1 (]: 11 of 11 SKIP relation dbt_melissa_rm_epc.no_matches ........................... [[33mSKIP[0m]
[0m10:46:06.910919 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.all_matches
[0m10:46:06.911325 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.houses_report
[0m10:46:06.911681 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.no_matches
[0m10:46:06.913515 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:46:06.913853 [debug] [MainThread]: Connection 'model.rightmove_epc.address_match' was properly closed.
[0m10:46:06.914089 [debug] [MainThread]: Connection 'model.rightmove_epc.address_simularity' was properly closed.
[0m10:46:06.914304 [debug] [MainThread]: Connection 'model.rightmove_epc.dim_addressid' was properly closed.
[0m10:46:06.914512 [debug] [MainThread]: Connection 'model.rightmove_epc.dim_uprn' was properly closed.
[0m10:46:06.914827 [info ] [MainThread]: 
[0m10:46:06.915104 [info ] [MainThread]: Finished running 11 view models in 0 hours 0 minutes and 3.75 seconds (3.75s).
[0m10:46:06.916183 [debug] [MainThread]: Command end result
[0m10:46:06.925531 [info ] [MainThread]: 
[0m10:46:06.925875 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m10:46:06.926094 [info ] [MainThread]: 
[0m10:46:06.926323 [error] [MainThread]:   Database Error in model uprn_match (models/matching/uprn_match.sql)
  001003 (42000): SQL compilation error:
  syntax error line 21 at position 4 unexpected 'epc'.
  syntax error line 22 at position 9 unexpected 'WHEN'.
  syntax error line 25 at position 5 unexpected 'from'.
  compiled Code at target/run/rightmove_epc/models/matching/uprn_match.sql
[0m10:46:06.926578 [info ] [MainThread]: 
[0m10:46:06.926798 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=1 SKIP=4 TOTAL=11
[0m10:46:06.928823 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 4.0563235, "process_user_time": 1.418379, "process_kernel_time": 0.194716, "process_mem_max_rss": "138526720", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m10:46:06.929240 [debug] [MainThread]: Command `dbt run` failed at 10:46:06.929154 after 4.06 seconds
[0m10:46:06.929516 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1013c2110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1014fdcd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1014c4f10>]}
[0m10:46:06.929769 [debug] [MainThread]: Flushing usage events
[0m10:52:35.475575 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109518990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10955eb10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10955f690>]}


============================== 10:52:35.478519 | 70b3946c-aab6-4ab0-9c72-a85dd6e9a824 ==============================
[0m10:52:35.478519 [info ] [MainThread]: Running with dbt=1.7.10
[0m10:52:35.478861 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt run', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m10:52:35.652767 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '70b3946c-aab6-4ab0-9c72-a85dd6e9a824', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b09ca10>]}
[0m10:52:35.687088 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '70b3946c-aab6-4ab0-9c72-a85dd6e9a824', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a2a04d0>]}
[0m10:52:35.687771 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m10:52:35.696540 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m10:52:35.712321 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m10:52:35.712574 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m10:52:35.715651 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '70b3946c-aab6-4ab0-9c72-a85dd6e9a824', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b558650>]}
[0m10:52:35.721885 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '70b3946c-aab6-4ab0-9c72-a85dd6e9a824', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1095a0350>]}
[0m10:52:35.722151 [info ] [MainThread]: Found 11 models, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m10:52:35.722343 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '70b3946c-aab6-4ab0-9c72-a85dd6e9a824', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b4704d0>]}
[0m10:52:35.723363 [info ] [MainThread]: 
[0m10:52:35.723758 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m10:52:35.724483 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m10:52:35.730787 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m10:52:35.731037 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m10:52:35.731266 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m10:52:36.150438 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 0.0 seconds
[0m10:52:36.153306 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m10:52:36.238244 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m10:52:36.245493 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m10:52:36.245794 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m10:52:36.246021 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m10:52:36.575675 [debug] [ThreadPool]: SQL status: SUCCESS 11 in 0.0 seconds
[0m10:52:36.577426 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m10:52:36.659812 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '70b3946c-aab6-4ab0-9c72-a85dd6e9a824', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b314210>]}
[0m10:52:36.661155 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m10:52:36.661677 [info ] [MainThread]: 
[0m10:52:36.665151 [debug] [Thread-1 (]: Began running node model.rightmove_epc.stg_epc_certs
[0m10:52:36.665560 [debug] [Thread-2 (]: Began running node model.rightmove_epc.stg_rightmove
[0m10:52:36.666050 [info ] [Thread-1 (]: 1 of 11 START sql view model dbt_melissa_rm_epc.stg_epc_certs .................. [RUN]
[0m10:52:36.666653 [info ] [Thread-2 (]: 2 of 11 START sql view model dbt_melissa_rm_epc.stg_rightmove .................. [RUN]
[0m10:52:36.667541 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.stg_epc_certs)
[0m10:52:36.668444 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.stg_rightmove'
[0m10:52:36.668888 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.stg_epc_certs
[0m10:52:36.669253 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.stg_rightmove
[0m10:52:36.676830 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.stg_epc_certs"
[0m10:52:36.678951 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.stg_rightmove"
[0m10:52:36.679845 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (compile): 10:52:36.669528 => 10:52:36.679676
[0m10:52:36.681279 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.stg_epc_certs
[0m10:52:36.722957 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (compile): 10:52:36.677163 => 10:52:36.722730
[0m10:52:36.732175 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.stg_epc_certs"
[0m10:52:36.732427 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.stg_rightmove
[0m10:52:36.734096 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.stg_rightmove"
[0m10:52:36.734892 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.stg_epc_certs"
[0m10:52:36.735096 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_epc_certs"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
  
   as (
    WITH epc_certs as (
    
    select 
    UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    COUNTY,
    LOCAL_AUTHORITY as LOCAL_AUTHORITY_CODE,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    UPPER(CASE WHEN (UPPER(ADDRESS1) LIKE 'FLAT%' OR UPPER(ADDRESS1) LIKE 'UNIT%') or UPPER(ADDRESS1) LIKE 'ROOM%' 
    THEN TRIM(REPLACE(REPLACE(CONCAT(ADDRESS),','),' '))
    ELSE trim(replace(replace(ADDRESS1,' '),',')) END) AS ADDRESSID,
    CASE WHEN UPRN is null and addressid is null THEN 1 else 0 end as REMOVE_FROM_RM_MATCH,
    FLOOR_LEVEL,
    FLAT_TOP_STOREY,
    FLAT_STOREY_COUNT,
    PROPERTY_TYPE
 from  RAW.EPC_TEST_DATA.EPC_CERTIFICATES 

)

SELECT * FROM epc_certs
  );
[0m10:52:36.735279 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:52:36.736078 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.stg_rightmove"
[0m10:52:36.736275 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_rightmove"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
  
   as (
    with rm as (

    SELECT 
    LISTING_ID,
    UPPER(TRIM(replace(REPLACE(CONCAT(ADDRESS_1::VARCHAR,ADDRESS_2::VARCHAR),' '),','))) AS ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, 
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    STUDENTLET_FLAG,
    COMBINED_PROPERTY_TYPE
    -- property type
    FROM 
       ANALYTICS.RIGHTMOVE_PROD.CLEAN_RAW_RIGHTMOVE_DATA 

 
)

SELECT * FROM rm
  );
[0m10:52:36.736452 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m10:52:37.171817 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m10:52:37.189444 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (execute): 10:52:36.681489 => 10:52:37.189261
[0m10:52:37.189815 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: Close
[0m10:52:37.217842 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m10:52:37.219845 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (execute): 10:52:36.732613 => 10:52:37.219701
[0m10:52:37.220119 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: Close
[0m10:52:37.280044 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '70b3946c-aab6-4ab0-9c72-a85dd6e9a824', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b502290>]}
[0m10:52:37.280586 [info ] [Thread-1 (]: 1 of 11 OK created sql view model dbt_melissa_rm_epc.stg_epc_certs ............. [[32mSUCCESS 1[0m in 0.61s]
[0m10:52:37.281006 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.stg_epc_certs
[0m10:52:37.321065 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '70b3946c-aab6-4ab0-9c72-a85dd6e9a824', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b0c92d0>]}
[0m10:52:37.321717 [info ] [Thread-2 (]: 2 of 11 OK created sql view model dbt_melissa_rm_epc.stg_rightmove ............. [[32mSUCCESS 1[0m in 0.65s]
[0m10:52:37.322176 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.stg_rightmove
[0m10:52:37.322778 [debug] [Thread-4 (]: Began running node model.rightmove_epc.dim_addressid
[0m10:52:37.323098 [debug] [Thread-3 (]: Began running node model.rightmove_epc.dim_uprn
[0m10:52:37.323481 [info ] [Thread-4 (]: 3 of 11 START sql view model dbt_melissa_rm_epc.dim_addressid .................. [RUN]
[0m10:52:37.323812 [info ] [Thread-3 (]: 4 of 11 START sql view model dbt_melissa_rm_epc.dim_uprn ....................... [RUN]
[0m10:52:37.324381 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_addressid'
[0m10:52:37.324867 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_uprn'
[0m10:52:37.325117 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.dim_addressid
[0m10:52:37.325354 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.dim_uprn
[0m10:52:37.327775 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.dim_addressid"
[0m10:52:37.329662 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.dim_uprn"
[0m10:52:37.331512 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.dim_uprn (compile): 10:52:37.327964 => 10:52:37.331355
[0m10:52:37.331842 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_addressid (compile): 10:52:37.325504 => 10:52:37.331655
[0m10:52:37.332128 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.dim_uprn
[0m10:52:37.332369 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.dim_addressid
[0m10:52:37.334799 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.dim_uprn"
[0m10:52:37.336861 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.dim_addressid"
[0m10:52:37.337846 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.dim_uprn"
[0m10:52:37.338576 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.dim_addressid"
[0m10:52:37.338878 [debug] [Thread-3 (]: On model.rightmove_epc.dim_uprn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_uprn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE UPRNS


with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource,
    POSTCODE
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    where REMOVE_FROM_RM_MATCH = 0
    AND UPRN IS NOT NULL
),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    WHERE UPRN IS NOT NULL

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where uprn is not null
  );
[0m10:52:37.339162 [debug] [Thread-4 (]: On model.rightmove_epc.dim_addressid: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_addressid"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE ADDRESS'

with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource,
    POSTCODE

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    where REMOVE_FROM_RM_MATCH = 0
    AND ADDRESSID IS NOT NULL

),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    WHERE ADDRESSID IS NOT NULL

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where uprn is null
and addressid is not null
  );
[0m10:52:37.339408 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m10:52:37.339616 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m10:52:37.887803 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m10:52:37.891900 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_addressid (execute): 10:52:37.334991 => 10:52:37.891605
[0m10:52:37.892438 [debug] [Thread-4 (]: On model.rightmove_epc.dim_addressid: Close
[0m10:52:37.895759 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m10:52:37.898409 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.dim_uprn (execute): 10:52:37.332527 => 10:52:37.898218
[0m10:52:37.899137 [debug] [Thread-3 (]: On model.rightmove_epc.dim_uprn: Close
[0m10:52:37.986360 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '70b3946c-aab6-4ab0-9c72-a85dd6e9a824', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b7c92d0>]}
[0m10:52:37.987311 [info ] [Thread-4 (]: 3 of 11 OK created sql view model dbt_melissa_rm_epc.dim_addressid ............. [[32mSUCCESS 1[0m in 0.66s]
[0m10:52:37.988118 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.dim_addressid
[0m10:52:37.988888 [debug] [Thread-2 (]: Began running node model.rightmove_epc.address_match
[0m10:52:37.989424 [debug] [Thread-1 (]: Began running node model.rightmove_epc.address_simularity
[0m10:52:37.990095 [info ] [Thread-2 (]: 5 of 11 START sql view model dbt_melissa_rm_epc.address_match .................. [RUN]
[0m10:52:37.990720 [info ] [Thread-1 (]: 6 of 11 START sql view model dbt_melissa_rm_epc.address_simularity ............. [RUN]
[0m10:52:37.991602 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_rightmove, now model.rightmove_epc.address_match)
[0m10:52:37.992179 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_epc_certs, now model.rightmove_epc.address_simularity)
[0m10:52:37.992519 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.address_match
[0m10:52:37.992818 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.address_simularity
[0m10:52:37.996763 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.address_match"
[0m10:52:37.999719 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.address_simularity"
[0m10:52:38.001978 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.address_match (compile): 10:52:37.993065 => 10:52:38.001702
[0m10:52:38.002391 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.address_simularity (compile): 10:52:37.997006 => 10:52:38.002177
[0m10:52:38.002734 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.address_match
[0m10:52:38.003055 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.address_simularity
[0m10:52:38.007056 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.address_match"
[0m10:52:38.009193 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.address_simularity"
[0m10:52:38.010506 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.address_match"
[0m10:52:38.010786 [debug] [Thread-2 (]: On model.rightmove_epc.address_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.address_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NULL
),

epc_address as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
    where datasource = 'EPC'
)


SELECT rm.*,
CASE WHEN epc_address.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_address.ADDRESSID AS EPC_ADDRESSID


FROM rm
LEFT JOIN epc_address
ON rm.addressid = epc_address.addressid
and rm.FULL_POSTCODE = epc_address.POSTCODE
  );
[0m10:52:38.011371 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.address_simularity"
[0m10:52:38.011882 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '70b3946c-aab6-4ab0-9c72-a85dd6e9a824', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b7e3c90>]}
[0m10:52:38.012095 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m10:52:38.012391 [debug] [Thread-1 (]: On model.rightmove_epc.address_simularity: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.address_simularity"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.address_simularity
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NULL
),

epc_address as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
    where datasource = 'EPC'
)


SELECT rm.*,epc_address.addressid as EPC_ADDRESSID
FROM rm
JOIN epc_address
ON JAROWINKLER_SIMILARITY(rm.addressid, epc_address.addressid) = 1
  );
[0m10:52:38.012808 [info ] [Thread-3 (]: 4 of 11 OK created sql view model dbt_melissa_rm_epc.dim_uprn .................. [[32mSUCCESS 1[0m in 0.69s]
[0m10:52:38.013835 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:52:38.014285 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.dim_uprn
[0m10:52:38.015341 [debug] [Thread-4 (]: Began running node model.rightmove_epc.uprn_match
[0m10:52:38.015992 [info ] [Thread-4 (]: 7 of 11 START sql view model dbt_melissa_rm_epc.uprn_match ..................... [RUN]
[0m10:52:38.016709 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.dim_addressid, now model.rightmove_epc.uprn_match)
[0m10:52:38.016995 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.uprn_match
[0m10:52:38.018900 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.uprn_match"
[0m10:52:38.019613 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.uprn_match (compile): 10:52:38.017156 => 10:52:38.019495
[0m10:52:38.019794 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.uprn_match
[0m10:52:38.021469 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.uprn_match"
[0m10:52:38.022085 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.uprn_match"
[0m10:52:38.022279 [debug] [Thread-4 (]: On model.rightmove_epc.uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NULL
),

epc_uprn as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
    where datasource = 'EPC'
)


SELECT rm.*,
CASE WHEN epc_uprn.UPRN is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_uprn.UPRN AS EPC_UPRN,
epc_uprn.ADDRESSID AS EPC_ADDRESSID


FROM rm
LEFT JOIN epc_uprn
ON rm.UPRN = epc_uprn.UPRN
  );
[0m10:52:38.022465 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m10:52:38.583149 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m10:52:38.585384 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.uprn_match (execute): 10:52:38.019899 => 10:52:38.585185
[0m10:52:38.585851 [debug] [Thread-4 (]: On model.rightmove_epc.uprn_match: Close
[0m10:52:38.586824 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m10:52:38.589698 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.address_simularity (execute): 10:52:38.007270 => 10:52:38.589524
[0m10:52:38.590355 [debug] [Thread-1 (]: On model.rightmove_epc.address_simularity: Close
[0m10:52:38.596711 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m10:52:38.598838 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.address_match (execute): 10:52:38.003261 => 10:52:38.598690
[0m10:52:38.599122 [debug] [Thread-2 (]: On model.rightmove_epc.address_match: Close
[0m10:52:38.664983 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '70b3946c-aab6-4ab0-9c72-a85dd6e9a824', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b73a090>]}
[0m10:52:38.665532 [info ] [Thread-2 (]: 5 of 11 OK created sql view model dbt_melissa_rm_epc.address_match ............. [[32mSUCCESS 1[0m in 0.67s]
[0m10:52:38.665915 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.address_match
[0m10:52:38.668701 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '70b3946c-aab6-4ab0-9c72-a85dd6e9a824', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b6c3490>]}
[0m10:52:38.669089 [info ] [Thread-1 (]: 6 of 11 OK created sql view model dbt_melissa_rm_epc.address_simularity ........ [[32mSUCCESS 1[0m in 0.68s]
[0m10:52:38.669443 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.address_simularity
[0m10:52:38.673795 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '70b3946c-aab6-4ab0-9c72-a85dd6e9a824', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b66dd10>]}
[0m10:52:38.674224 [info ] [Thread-4 (]: 7 of 11 OK created sql view model dbt_melissa_rm_epc.uprn_match ................ [[32mSUCCESS 1[0m in 0.66s]
[0m10:52:38.674571 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.uprn_match
[0m10:52:38.675083 [debug] [Thread-3 (]: Began running node model.rightmove_epc.all_matches
[0m10:52:38.675337 [debug] [Thread-2 (]: Began running node model.rightmove_epc.houses_report
[0m10:52:38.675591 [info ] [Thread-3 (]: 8 of 11 START sql view model dbt_melissa_rm_epc.all_matches .................... [RUN]
[0m10:52:38.675834 [debug] [Thread-1 (]: Began running node model.rightmove_epc.no_matches
[0m10:52:38.676112 [info ] [Thread-2 (]: 9 of 11 START sql view model dbt_melissa_rm_epc.houses_report .................. [RUN]
[0m10:52:38.676362 [debug] [Thread-4 (]: Began running node model.rightmove_epc.no_uprn_match
[0m10:52:38.676712 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.dim_uprn, now model.rightmove_epc.all_matches)
[0m10:52:38.676960 [info ] [Thread-1 (]: 10 of 11 START sql view model dbt_melissa_rm_epc.no_matches .................... [RUN]
[0m10:52:38.677338 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.address_match, now model.rightmove_epc.houses_report)
[0m10:52:38.677575 [info ] [Thread-4 (]: 11 of 11 START sql view model dbt_melissa_rm_epc.no_uprn_match ................. [RUN]
[0m10:52:38.677789 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.all_matches
[0m10:52:38.678142 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.address_simularity, now model.rightmove_epc.no_matches)
[0m10:52:38.678345 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.houses_report
[0m10:52:38.678779 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.uprn_match, now model.rightmove_epc.no_uprn_match)
[0m10:52:38.679533 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.no_matches
[0m10:52:38.681518 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.all_matches"
[0m10:52:38.683773 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.houses_report"
[0m10:52:38.684104 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.no_uprn_match
[0m10:52:38.685870 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.no_matches"
[0m10:52:38.688929 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.no_uprn_match"
[0m10:52:38.689681 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.houses_report (compile): 10:52:38.681683 => 10:52:38.689534
[0m10:52:38.689940 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.all_matches (compile): 10:52:38.678962 => 10:52:38.689806
[0m10:52:38.690190 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.houses_report
[0m10:52:38.690447 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.no_uprn_match (compile): 10:52:38.687092 => 10:52:38.690333
[0m10:52:38.690655 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.all_matches
[0m10:52:38.690982 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.no_matches (compile): 10:52:38.684279 => 10:52:38.690763
[0m10:52:38.692884 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.houses_report"
[0m10:52:38.693106 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.no_uprn_match
[0m10:52:38.694716 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.all_matches"
[0m10:52:38.694969 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.no_matches
[0m10:52:38.696813 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.no_uprn_match"
[0m10:52:38.699794 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.no_matches"
[0m10:52:38.700937 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.houses_report"
[0m10:52:38.701585 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.all_matches"
[0m10:52:38.701869 [debug] [Thread-2 (]: On model.rightmove_epc.houses_report: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.houses_report"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.houses_report
  
   as (
    with house_addmatch as (

    select 
    distinct
    --count(LISTING_ID) as TOTAL_LISTINGS,
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN, -- NULL
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    am.FLOOR_LEVEL as RM_FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.*

     from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc on am.EPC_ADDRESSID = epc.ADDRESSID
    and am.FULL_POSTCODE = epc.POSTCODE
    where MATCH_EPC = 'YES'
    and COMBINED_PROPERTY_TYPE not in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')

),

with house_uprnmatch as (

    select 
    distinct
    --count(LISTING_ID) as TOTAL_LISTINGS,
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN, -- NULL
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    am.FLOOR_LEVEL as RM_FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.*

     from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc on am.EPC_ADDRESSID = epc.ADDRESSID
    and am.FULL_POSTCODE = epc.POSTCODE
    where MATCH_EPC = 'YES'
    and COMBINED_PROPERTY_TYPE not in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')

)

select * from house_addmatch


/* THIS IS USED FOR A TEST
select RM_URN,COUNT(BUILDING_REFERENCE_NUMBER)
from house
WHERE RM_URN IS NOT NULL
GROUP BY 1
HAVING COUNT(BUILDING_REFERENCE_NUMBER) >1
*/
  );
[0m10:52:38.702294 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.no_uprn_match"
[0m10:52:38.702533 [debug] [Thread-3 (]: On model.rightmove_epc.all_matches: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.all_matches"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.all_matches
  
   as (
    with addr as (

    select 
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    '' AS EPC_UPRN,
    EPC_ADDRESSID
    
    from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
    where MATCH_EPC = 'YES' 
),

uprn as (

    select 
    
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN::VARCHAR AS EPC_UPRN,
    EPC_ADDRESSID
     from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'YES'
),

final as (

select 'ADDRESS AND POSTCODE MATCH' AS MATCH_RESULT, * from addr
union all
select 'UPRN MATCH' AS MATCH_RESULT, * from uprn
)

select * from final
  );
[0m10:52:38.702770 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m10:52:38.703471 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.no_matches"
[0m10:52:38.703686 [debug] [Thread-4 (]: On model.rightmove_epc.no_uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.no_uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.no_uprn_match
  
   as (
    with rm_no_match_to_epc  as ( -- rightmove uspn does not match epc

    select *

     from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'NO'
    
)

select * from rm_no_match_to_epc

/*
epc_remove as (

    select EPC_UPRN,EPC_ADDRESSID from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'YES'  -- 
),

epc_matched as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs src
    left join epc_remove rem on src.UPRN = rem.EPC_UPRN
    
),

epc_fm_prep as (

    select * from epc_matched
    where EPC_UPRN is NULL

    
)


SELECT * FROM epc_fm_prep
WHERE UPRN NOT NULL */
  );
[0m10:52:38.703898 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m10:52:38.704509 [debug] [Thread-1 (]: On model.rightmove_epc.no_matches: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.no_matches"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.no_matches
  
   as (
    with addr as (

    select 
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    '' AS EPC_UPRN,
    EPC_ADDRESSID
    
    from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
    where MATCH_EPC = 'NO' 
),

uprn as (

    select 
    
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN::VARCHAR AS EPC_UPRN,
    EPC_ADDRESSID
    
     from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'NO'
),

final as (

select 'NO ADDRESS OR UPRN MATCH' AS MATCH_RESULT, * from addr
union all
select 'NO UPRN MATCH' AS MATCH_RESULT, * from uprn
)

select * from final
  );
[0m10:52:38.704952 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m10:52:38.705433 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m10:52:39.114786 [debug] [Thread-2 (]: Snowflake adapter: Snowflake query id: 01b3442c-0103-9b8b-0000-71950637250a
[0m10:52:39.115184 [debug] [Thread-2 (]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 31 at position 0 unexpected 'with'.
[0m10:52:39.115602 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.houses_report (execute): 10:52:38.691120 => 10:52:39.115449
[0m10:52:39.115890 [debug] [Thread-2 (]: On model.rightmove_epc.houses_report: Close
[0m10:52:39.209037 [debug] [Thread-2 (]: Database Error in model houses_report (models/reports/houses_report.sql)
  001003 (42000): SQL compilation error:
  syntax error line 31 at position 0 unexpected 'with'.
  compiled Code at target/run/rightmove_epc/models/reports/houses_report.sql
[0m10:52:39.209599 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '70b3946c-aab6-4ab0-9c72-a85dd6e9a824', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b584190>]}
[0m10:52:39.210108 [error] [Thread-2 (]: 9 of 11 ERROR creating sql view model dbt_melissa_rm_epc.houses_report ......... [[31mERROR[0m in 0.53s]
[0m10:52:39.210575 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.houses_report
[0m10:52:39.271413 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m10:52:39.273566 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.no_uprn_match (execute): 10:52:38.695162 => 10:52:39.273410
[0m10:52:39.273862 [debug] [Thread-4 (]: On model.rightmove_epc.no_uprn_match: Close
[0m10:52:39.329354 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m10:52:39.331411 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.no_matches (execute): 10:52:38.697096 => 10:52:39.331260
[0m10:52:39.331706 [debug] [Thread-1 (]: On model.rightmove_epc.no_matches: Close
[0m10:52:39.356660 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '70b3946c-aab6-4ab0-9c72-a85dd6e9a824', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10955ef10>]}
[0m10:52:39.357167 [info ] [Thread-4 (]: 11 of 11 OK created sql view model dbt_melissa_rm_epc.no_uprn_match ............ [[32mSUCCESS 1[0m in 0.68s]
[0m10:52:39.357556 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.no_uprn_match
[0m10:52:39.413688 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '70b3946c-aab6-4ab0-9c72-a85dd6e9a824', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b496bd0>]}
[0m10:52:39.414217 [info ] [Thread-1 (]: 10 of 11 OK created sql view model dbt_melissa_rm_epc.no_matches ............... [[32mSUCCESS 1[0m in 0.74s]
[0m10:52:39.414612 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.no_matches
[0m10:52:39.468271 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m10:52:39.470191 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.all_matches (execute): 10:52:38.693227 => 10:52:39.470051
[0m10:52:39.470449 [debug] [Thread-3 (]: On model.rightmove_epc.all_matches: Close
[0m10:52:39.554181 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '70b3946c-aab6-4ab0-9c72-a85dd6e9a824', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b483610>]}
[0m10:52:39.554786 [info ] [Thread-3 (]: 8 of 11 OK created sql view model dbt_melissa_rm_epc.all_matches ............... [[32mSUCCESS 1[0m in 0.88s]
[0m10:52:39.555276 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.all_matches
[0m10:52:39.556882 [debug] [MainThread]: Connection 'master' was properly closed.
[0m10:52:39.557214 [debug] [MainThread]: Connection 'model.rightmove_epc.no_matches' was properly closed.
[0m10:52:39.557431 [debug] [MainThread]: Connection 'model.rightmove_epc.houses_report' was properly closed.
[0m10:52:39.557632 [debug] [MainThread]: Connection 'model.rightmove_epc.no_uprn_match' was properly closed.
[0m10:52:39.557832 [debug] [MainThread]: Connection 'model.rightmove_epc.all_matches' was properly closed.
[0m10:52:39.558097 [info ] [MainThread]: 
[0m10:52:39.558344 [info ] [MainThread]: Finished running 11 view models in 0 hours 0 minutes and 3.83 seconds (3.83s).
[0m10:52:39.559529 [debug] [MainThread]: Command end result
[0m10:52:39.566960 [info ] [MainThread]: 
[0m10:52:39.567294 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m10:52:39.567501 [info ] [MainThread]: 
[0m10:52:39.567704 [error] [MainThread]:   Database Error in model houses_report (models/reports/houses_report.sql)
  001003 (42000): SQL compilation error:
  syntax error line 31 at position 0 unexpected 'with'.
  compiled Code at target/run/rightmove_epc/models/reports/houses_report.sql
[0m10:52:39.567917 [info ] [MainThread]: 
[0m10:52:39.568124 [info ] [MainThread]: Done. PASS=10 WARN=0 ERROR=1 SKIP=0 TOTAL=11
[0m10:52:39.570160 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 4.121404, "process_user_time": 1.519857, "process_kernel_time": 0.189289, "process_mem_max_rss": "138887168", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m10:52:39.570566 [debug] [MainThread]: Command `dbt run` failed at 10:52:39.570478 after 4.12 seconds
[0m10:52:39.570844 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103256110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108ed3850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103358ed0>]}
[0m10:52:39.571110 [debug] [MainThread]: Flushing usage events
[0m11:07:02.715394 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108e9b310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109362450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109363010>]}


============================== 11:07:02.718608 | 2787fca2-c1fa-42b8-84fb-9aeb08e85643 ==============================
[0m11:07:02.718608 [info ] [MainThread]: Running with dbt=1.7.10
[0m11:07:02.718968 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m11:07:02.892845 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2787fca2-c1fa-42b8-84fb-9aeb08e85643', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bef74d0>]}
[0m11:07:02.926631 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2787fca2-c1fa-42b8-84fb-9aeb08e85643', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bef74d0>]}
[0m11:07:02.927321 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m11:07:02.936263 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m11:07:02.951794 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:07:02.952042 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:07:02.955104 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2787fca2-c1fa-42b8-84fb-9aeb08e85643', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ba20710>]}
[0m11:07:02.961290 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2787fca2-c1fa-42b8-84fb-9aeb08e85643', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c0da010>]}
[0m11:07:02.961561 [info ] [MainThread]: Found 11 models, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m11:07:02.961755 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2787fca2-c1fa-42b8-84fb-9aeb08e85643', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10be9d050>]}
[0m11:07:02.962835 [info ] [MainThread]: 
[0m11:07:02.963249 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m11:07:02.963917 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m11:07:02.970430 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m11:07:02.970732 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m11:07:02.970892 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:07:03.456911 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 0.0 seconds
[0m11:07:03.460723 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m11:07:03.554565 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m11:07:03.561926 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m11:07:03.562303 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m11:07:03.562598 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:07:03.911853 [debug] [ThreadPool]: SQL status: SUCCESS 11 in 0.0 seconds
[0m11:07:03.916504 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m11:07:04.032820 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2787fca2-c1fa-42b8-84fb-9aeb08e85643', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bff24d0>]}
[0m11:07:04.033587 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:07:04.033855 [info ] [MainThread]: 
[0m11:07:04.037010 [debug] [Thread-1 (]: Began running node model.rightmove_epc.stg_epc_certs
[0m11:07:04.037428 [debug] [Thread-2 (]: Began running node model.rightmove_epc.stg_rightmove
[0m11:07:04.037981 [info ] [Thread-1 (]: 1 of 11 START sql view model dbt_melissa_rm_epc.stg_epc_certs .................. [RUN]
[0m11:07:04.038316 [info ] [Thread-2 (]: 2 of 11 START sql view model dbt_melissa_rm_epc.stg_rightmove .................. [RUN]
[0m11:07:04.038774 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.stg_epc_certs)
[0m11:07:04.039350 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.stg_rightmove'
[0m11:07:04.039663 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.stg_epc_certs
[0m11:07:04.039944 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.stg_rightmove
[0m11:07:04.046108 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.stg_epc_certs"
[0m11:07:04.048123 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.stg_rightmove"
[0m11:07:04.049074 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (compile): 11:07:04.040138 => 11:07:04.048855
[0m11:07:04.049371 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.stg_epc_certs
[0m11:07:04.049681 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (compile): 11:07:04.046312 => 11:07:04.049519
[0m11:07:04.098568 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.stg_epc_certs"
[0m11:07:04.098815 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.stg_rightmove
[0m11:07:04.100529 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.stg_rightmove"
[0m11:07:04.101296 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.stg_epc_certs"
[0m11:07:04.101766 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.stg_rightmove"
[0m11:07:04.101972 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_epc_certs"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
  
   as (
    WITH epc_certs as (
    
    select 
    UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    COUNTY,
    LOCAL_AUTHORITY as LOCAL_AUTHORITY_CODE,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    UPPER(CASE WHEN (UPPER(ADDRESS1) LIKE 'FLAT%' OR UPPER(ADDRESS1) LIKE 'UNIT%') or UPPER(ADDRESS1) LIKE 'ROOM%' 
    THEN TRIM(REPLACE(REPLACE(CONCAT(ADDRESS),','),' '))
    ELSE trim(replace(replace(ADDRESS1,' '),',')) END) AS ADDRESSID,
    CASE WHEN UPRN is null and addressid is null THEN 1 else 0 end as REMOVE_FROM_RM_MATCH,
    FLOOR_LEVEL,
    FLAT_TOP_STOREY,
    FLAT_STOREY_COUNT,
    PROPERTY_TYPE
 from  RAW.EPC_TEST_DATA.EPC_CERTIFICATES 

)

SELECT * FROM epc_certs
  );
[0m11:07:04.102189 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_rightmove"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
  
   as (
    with rm as (

    SELECT 
    LISTING_ID,
    UPPER(TRIM(replace(REPLACE(CONCAT(ADDRESS_1::VARCHAR,ADDRESS_2::VARCHAR),' '),','))) AS ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, 
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    STUDENTLET_FLAG,
    COMBINED_PROPERTY_TYPE
    -- property type
    FROM 
       ANALYTICS.RIGHTMOVE_PROD.CLEAN_RAW_RIGHTMOVE_DATA 

 
)

SELECT * FROM rm
  );
[0m11:07:04.102370 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:07:04.102527 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m11:07:04.631626 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m11:07:04.653217 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (execute): 11:07:04.049832 => 11:07:04.653076
[0m11:07:04.653587 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: Close
[0m11:07:04.671657 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m11:07:04.673892 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (execute): 11:07:04.099023 => 11:07:04.673748
[0m11:07:04.674180 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: Close
[0m11:07:04.728342 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2787fca2-c1fa-42b8-84fb-9aeb08e85643', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c0db4d0>]}
[0m11:07:04.728834 [info ] [Thread-1 (]: 1 of 11 OK created sql view model dbt_melissa_rm_epc.stg_epc_certs ............. [[32mSUCCESS 1[0m in 0.69s]
[0m11:07:04.729232 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.stg_epc_certs
[0m11:07:04.753299 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2787fca2-c1fa-42b8-84fb-9aeb08e85643', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c167490>]}
[0m11:07:04.753858 [info ] [Thread-2 (]: 2 of 11 OK created sql view model dbt_melissa_rm_epc.stg_rightmove ............. [[32mSUCCESS 1[0m in 0.71s]
[0m11:07:04.754282 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.stg_rightmove
[0m11:07:04.755072 [debug] [Thread-4 (]: Began running node model.rightmove_epc.dim_addressid
[0m11:07:04.755494 [debug] [Thread-3 (]: Began running node model.rightmove_epc.dim_uprn
[0m11:07:04.756078 [info ] [Thread-4 (]: 3 of 11 START sql view model dbt_melissa_rm_epc.dim_addressid .................. [RUN]
[0m11:07:04.756663 [info ] [Thread-3 (]: 4 of 11 START sql view model dbt_melissa_rm_epc.dim_uprn ....................... [RUN]
[0m11:07:04.757491 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_addressid'
[0m11:07:04.757994 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_uprn'
[0m11:07:04.758229 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.dim_addressid
[0m11:07:04.758535 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.dim_uprn
[0m11:07:04.762514 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.dim_addressid"
[0m11:07:04.764934 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.dim_uprn"
[0m11:07:04.766157 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_addressid (compile): 11:07:04.759629 => 11:07:04.765957
[0m11:07:04.766486 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.dim_uprn (compile): 11:07:04.762800 => 11:07:04.766325
[0m11:07:04.766760 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.dim_addressid
[0m11:07:04.767018 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.dim_uprn
[0m11:07:04.769260 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.dim_addressid"
[0m11:07:04.771257 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.dim_uprn"
[0m11:07:04.772396 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.dim_addressid"
[0m11:07:04.773072 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.dim_uprn"
[0m11:07:04.773384 [debug] [Thread-4 (]: On model.rightmove_epc.dim_addressid: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_addressid"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE ADDRESS'

with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource,
    POSTCODE

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    where REMOVE_FROM_RM_MATCH = 0
    AND ADDRESSID IS NOT NULL

),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    WHERE ADDRESSID IS NOT NULL

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where uprn is null
and addressid is not null
  );
[0m11:07:04.773711 [debug] [Thread-3 (]: On model.rightmove_epc.dim_uprn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_uprn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE UPRNS


with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource,
    POSTCODE
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    where REMOVE_FROM_RM_MATCH = 0
    AND UPRN IS NOT NULL
),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    WHERE UPRN IS NOT NULL

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where uprn is not null
  );
[0m11:07:04.773979 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m11:07:04.774184 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m11:07:05.358055 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m11:07:05.360080 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.dim_uprn (execute): 11:07:04.769427 => 11:07:05.359932
[0m11:07:05.360351 [debug] [Thread-3 (]: On model.rightmove_epc.dim_uprn: Close
[0m11:07:05.385453 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m11:07:05.387482 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_addressid (execute): 11:07:04.767177 => 11:07:05.387325
[0m11:07:05.387935 [debug] [Thread-4 (]: On model.rightmove_epc.dim_addressid: Close
[0m11:07:05.439589 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2787fca2-c1fa-42b8-84fb-9aeb08e85643', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c17a550>]}
[0m11:07:05.440235 [info ] [Thread-3 (]: 4 of 11 OK created sql view model dbt_melissa_rm_epc.dim_uprn .................. [[32mSUCCESS 1[0m in 0.68s]
[0m11:07:05.440717 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.dim_uprn
[0m11:07:05.441234 [debug] [Thread-2 (]: Began running node model.rightmove_epc.uprn_match
[0m11:07:05.441655 [info ] [Thread-2 (]: 5 of 11 START sql view model dbt_melissa_rm_epc.uprn_match ..................... [RUN]
[0m11:07:05.442267 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_rightmove, now model.rightmove_epc.uprn_match)
[0m11:07:05.442569 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.uprn_match
[0m11:07:05.445051 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.uprn_match"
[0m11:07:05.445729 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.uprn_match (compile): 11:07:05.442768 => 11:07:05.445585
[0m11:07:05.446002 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.uprn_match
[0m11:07:05.448469 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.uprn_match"
[0m11:07:05.449376 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.uprn_match"
[0m11:07:05.449649 [debug] [Thread-2 (]: On model.rightmove_epc.uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NOT NULL
),

epc_uprn as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
    where datasource = 'EPC'
)


SELECT rm.*,
CASE WHEN epc_uprn.UPRN is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_uprn.UPRN AS EPC_UPRN,
epc_uprn.ADDRESSID AS EPC_ADDRESSID


FROM rm
LEFT JOIN epc_uprn
ON rm.UPRN = epc_uprn.UPRN

WHERE MATCH_EPC = 'YES'
  );
[0m11:07:05.449892 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m11:07:05.482184 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2787fca2-c1fa-42b8-84fb-9aeb08e85643', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c0684d0>]}
[0m11:07:05.482720 [info ] [Thread-4 (]: 3 of 11 OK created sql view model dbt_melissa_rm_epc.dim_addressid ............. [[32mSUCCESS 1[0m in 0.73s]
[0m11:07:05.483080 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.dim_addressid
[0m11:07:05.483523 [debug] [Thread-3 (]: Began running node model.rightmove_epc.address_match
[0m11:07:05.483839 [debug] [Thread-1 (]: Began running node model.rightmove_epc.address_simularity
[0m11:07:05.484204 [info ] [Thread-3 (]: 6 of 11 START sql view model dbt_melissa_rm_epc.address_match .................. [RUN]
[0m11:07:05.484503 [info ] [Thread-1 (]: 7 of 11 START sql view model dbt_melissa_rm_epc.address_simularity ............. [RUN]
[0m11:07:05.485010 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.dim_uprn, now model.rightmove_epc.address_match)
[0m11:07:05.485454 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_epc_certs, now model.rightmove_epc.address_simularity)
[0m11:07:05.485764 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.address_match
[0m11:07:05.486067 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.address_simularity
[0m11:07:05.489410 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.address_match"
[0m11:07:05.491569 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.address_simularity"
[0m11:07:05.492769 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.address_simularity (compile): 11:07:05.489698 => 11:07:05.492553
[0m11:07:05.493032 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.address_simularity
[0m11:07:05.493308 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.address_match (compile): 11:07:05.486291 => 11:07:05.493162
[0m11:07:05.495410 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.address_simularity"
[0m11:07:05.495698 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.address_match
[0m11:07:05.497647 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.address_match"
[0m11:07:05.498370 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.address_simularity"
[0m11:07:05.498626 [debug] [Thread-1 (]: On model.rightmove_epc.address_simularity: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.address_simularity"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.address_simularity
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NULL
),

epc_address as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
    where datasource = 'EPC'
)


SELECT rm.*,epc_address.addressid as EPC_ADDRESSID
FROM rm
JOIN epc_address
ON JAROWINKLER_SIMILARITY(rm.addressid, epc_address.addressid) = 1
  );
[0m11:07:05.498837 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:07:05.499353 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.address_match"
[0m11:07:05.500209 [debug] [Thread-3 (]: On model.rightmove_epc.address_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.address_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NULL
),

epc_address as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
    where datasource = 'EPC'
)


SELECT rm.*,
CASE WHEN epc_address.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_address.ADDRESSID AS EPC_ADDRESSID


FROM rm
LEFT JOIN epc_address
ON rm.addressid = epc_address.addressid
and rm.FULL_POSTCODE = epc_address.POSTCODE
  );
[0m11:07:05.500448 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m11:07:06.079006 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m11:07:06.085030 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.uprn_match (execute): 11:07:05.446222 => 11:07:06.084834
[0m11:07:06.085636 [debug] [Thread-2 (]: On model.rightmove_epc.uprn_match: Close
[0m11:07:06.168767 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2787fca2-c1fa-42b8-84fb-9aeb08e85643', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bef5990>]}
[0m11:07:06.169304 [info ] [Thread-2 (]: 5 of 11 OK created sql view model dbt_melissa_rm_epc.uprn_match ................ [[32mSUCCESS 1[0m in 0.73s]
[0m11:07:06.169880 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.uprn_match
[0m11:07:06.170802 [debug] [Thread-4 (]: Began running node model.rightmove_epc.no_uprn_match
[0m11:07:06.171519 [info ] [Thread-4 (]: 8 of 11 START sql view model dbt_melissa_rm_epc.no_uprn_match .................. [RUN]
[0m11:07:06.172334 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.dim_addressid, now model.rightmove_epc.no_uprn_match)
[0m11:07:06.172714 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.no_uprn_match
[0m11:07:06.176299 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.no_uprn_match"
[0m11:07:06.177348 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.no_uprn_match (compile): 11:07:06.172845 => 11:07:06.177104
[0m11:07:06.177701 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.no_uprn_match
[0m11:07:06.179755 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.no_uprn_match"
[0m11:07:06.180501 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.no_uprn_match"
[0m11:07:06.180776 [debug] [Thread-4 (]: On model.rightmove_epc.no_uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.no_uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.no_uprn_match
  
   as (
    with rm_no_match_to_epc  as ( -- rightmove uspn does not match epc

    select *

     from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'NO'
    
)

select * from rm_no_match_to_epc

/*
epc_remove as (

    select EPC_UPRN,EPC_ADDRESSID from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'YES'  -- 
),

epc_matched as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs src
    left join epc_remove rem on src.UPRN = rem.EPC_UPRN
    
),

epc_fm_prep as (

    select * from epc_matched
    where EPC_UPRN is NULL

    
)


SELECT * FROM epc_fm_prep
WHERE UPRN NOT NULL */
  );
[0m11:07:06.181017 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m11:07:06.236698 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m11:07:06.239028 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.address_simularity (execute): 11:07:05.493432 => 11:07:06.238886
[0m11:07:06.239299 [debug] [Thread-1 (]: On model.rightmove_epc.address_simularity: Close
[0m11:07:06.319491 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2787fca2-c1fa-42b8-84fb-9aeb08e85643', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c3a6050>]}
[0m11:07:06.320036 [info ] [Thread-1 (]: 7 of 11 OK created sql view model dbt_melissa_rm_epc.address_simularity ........ [[32mSUCCESS 1[0m in 0.83s]
[0m11:07:06.320412 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.address_simularity
[0m11:07:06.388941 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m11:07:06.391568 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.address_match (execute): 11:07:05.495902 => 11:07:06.391370
[0m11:07:06.391949 [debug] [Thread-3 (]: On model.rightmove_epc.address_match: Close
[0m11:07:06.479086 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2787fca2-c1fa-42b8-84fb-9aeb08e85643', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109363010>]}
[0m11:07:06.479601 [info ] [Thread-3 (]: 6 of 11 OK created sql view model dbt_melissa_rm_epc.address_match ............. [[32mSUCCESS 1[0m in 0.99s]
[0m11:07:06.480110 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.address_match
[0m11:07:06.480785 [debug] [Thread-2 (]: Began running node model.rightmove_epc.all_matches
[0m11:07:06.481303 [debug] [Thread-1 (]: Began running node model.rightmove_epc.houses_report
[0m11:07:06.481794 [info ] [Thread-2 (]: 9 of 11 START sql view model dbt_melissa_rm_epc.all_matches .................... [RUN]
[0m11:07:06.482289 [debug] [Thread-3 (]: Began running node model.rightmove_epc.no_matches
[0m11:07:06.482744 [info ] [Thread-1 (]: 10 of 11 START sql view model dbt_melissa_rm_epc.houses_report ................. [RUN]
[0m11:07:06.483171 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.uprn_match, now model.rightmove_epc.all_matches)
[0m11:07:06.483447 [info ] [Thread-3 (]: 11 of 11 START sql view model dbt_melissa_rm_epc.no_matches .................... [RUN]
[0m11:07:06.483923 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.address_simularity, now model.rightmove_epc.houses_report)
[0m11:07:06.484268 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.all_matches
[0m11:07:06.484814 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.address_match, now model.rightmove_epc.no_matches)
[0m11:07:06.485136 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.houses_report
[0m11:07:06.488299 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.all_matches"
[0m11:07:06.488563 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.no_matches
[0m11:07:06.490889 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.houses_report"
[0m11:07:06.493549 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.no_matches"
[0m11:07:06.494109 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.all_matches (compile): 11:07:06.485340 => 11:07:06.493914
[0m11:07:06.494398 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.all_matches
[0m11:07:06.494676 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.houses_report (compile): 11:07:06.488701 => 11:07:06.494537
[0m11:07:06.497358 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.all_matches"
[0m11:07:06.497717 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.houses_report
[0m11:07:06.497989 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.no_matches (compile): 11:07:06.491244 => 11:07:06.497841
[0m11:07:06.501488 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.houses_report"
[0m11:07:06.501817 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.no_matches
[0m11:07:06.502861 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.all_matches"
[0m11:07:06.504891 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.no_matches"
[0m11:07:06.505265 [debug] [Thread-2 (]: On model.rightmove_epc.all_matches: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.all_matches"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.all_matches
  
   as (
    with addr as (

    select 
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    '' AS EPC_UPRN,
    EPC_ADDRESSID
    
    from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
    where MATCH_EPC = 'YES' 
),

uprn as (

    select 
    
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN::VARCHAR AS EPC_UPRN,
    EPC_ADDRESSID
     from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'YES'
),

final as (

select 'ADDRESS AND POSTCODE MATCH' AS MATCH_RESULT, * from addr
union all
select 'UPRN MATCH' AS MATCH_RESULT, * from uprn
)

select * from final
  );
[0m11:07:06.506370 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.houses_report"
[0m11:07:06.506668 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m11:07:06.507013 [debug] [Thread-1 (]: On model.rightmove_epc.houses_report: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.houses_report"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.houses_report
  
   as (
    with house_addmatch as (

    select 
    distinct
    --count(LISTING_ID) as TOTAL_LISTINGS,
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN, -- NULL
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    am.FLOOR_LEVEL as RM_FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.*

     from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc on am.EPC_ADDRESSID = epc.ADDRESSID
    and am.FULL_POSTCODE = epc.POSTCODE
    where MATCH_EPC = 'YES'
    and COMBINED_PROPERTY_TYPE not in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')

),

house_uprnmatch as (

    select 
    distinct
    --count(LISTING_ID) as TOTAL_LISTINGS,
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN, -- NULL
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    am.FLOOR_LEVEL as RM_FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE
    

    from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match am
    where MATCH_EPC = 'YES'
   and COMBINED_PROPERTY_TYPE not in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')

)

select * from house_uprnmatch


/* THIS IS USED FOR A TEST
select RM_URN,COUNT(BUILDING_REFERENCE_NUMBER)
from house
WHERE RM_URN IS NOT NULL
GROUP BY 1
HAVING COUNT(BUILDING_REFERENCE_NUMBER) >1
*/
  );
[0m11:07:06.507905 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.no_matches"
[0m11:07:06.508865 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:07:06.509246 [debug] [Thread-3 (]: On model.rightmove_epc.no_matches: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.no_matches"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.no_matches
  
   as (
    with addr as (

    select 
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    '' AS EPC_UPRN,
    EPC_ADDRESSID
    
    from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
    where MATCH_EPC = 'NO' 
),

uprn as (

    select 
    
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN::VARCHAR AS EPC_UPRN,
    EPC_ADDRESSID
    
     from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'NO'
),

final as (

select 'NO ADDRESS OR UPRN MATCH' AS MATCH_RESULT, * from addr
union all
select 'NO UPRN MATCH' AS MATCH_RESULT, * from uprn
)

select * from final
  );
[0m11:07:06.510164 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m11:07:06.780540 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m11:07:06.783135 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.no_uprn_match (execute): 11:07:06.177834 => 11:07:06.782997
[0m11:07:06.783393 [debug] [Thread-4 (]: On model.rightmove_epc.no_uprn_match: Close
[0m11:07:06.864107 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2787fca2-c1fa-42b8-84fb-9aeb08e85643', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c22ee90>]}
[0m11:07:06.864636 [info ] [Thread-4 (]: 8 of 11 OK created sql view model dbt_melissa_rm_epc.no_uprn_match ............. [[32mSUCCESS 1[0m in 0.69s]
[0m11:07:06.865025 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.no_uprn_match
[0m11:07:07.146524 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m11:07:07.148736 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.no_matches (execute): 11:07:06.503003 => 11:07:07.148608
[0m11:07:07.149155 [debug] [Thread-3 (]: On model.rightmove_epc.no_matches: Close
[0m11:07:07.163247 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m11:07:07.165183 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.houses_report (execute): 11:07:06.498191 => 11:07:07.164988
[0m11:07:07.165553 [debug] [Thread-1 (]: On model.rightmove_epc.houses_report: Close
[0m11:07:07.232975 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2787fca2-c1fa-42b8-84fb-9aeb08e85643', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c213190>]}
[0m11:07:07.233454 [info ] [Thread-3 (]: 11 of 11 OK created sql view model dbt_melissa_rm_epc.no_matches ............... [[32mSUCCESS 1[0m in 0.75s]
[0m11:07:07.234018 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.no_matches
[0m11:07:07.255671 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2787fca2-c1fa-42b8-84fb-9aeb08e85643', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10be39cd0>]}
[0m11:07:07.256384 [info ] [Thread-1 (]: 10 of 11 OK created sql view model dbt_melissa_rm_epc.houses_report ............ [[32mSUCCESS 1[0m in 0.77s]
[0m11:07:07.257293 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.houses_report
[0m11:07:07.257903 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m11:07:07.259687 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.all_matches (execute): 11:07:06.494814 => 11:07:07.259554
[0m11:07:07.259939 [debug] [Thread-2 (]: On model.rightmove_epc.all_matches: Close
[0m11:07:07.339223 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2787fca2-c1fa-42b8-84fb-9aeb08e85643', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bf88110>]}
[0m11:07:07.339791 [info ] [Thread-2 (]: 9 of 11 OK created sql view model dbt_melissa_rm_epc.all_matches ............... [[32mSUCCESS 1[0m in 0.86s]
[0m11:07:07.340188 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.all_matches
[0m11:07:07.342067 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:07:07.342494 [debug] [MainThread]: Connection 'model.rightmove_epc.houses_report' was properly closed.
[0m11:07:07.342893 [debug] [MainThread]: Connection 'model.rightmove_epc.all_matches' was properly closed.
[0m11:07:07.343107 [debug] [MainThread]: Connection 'model.rightmove_epc.no_uprn_match' was properly closed.
[0m11:07:07.343274 [debug] [MainThread]: Connection 'model.rightmove_epc.no_matches' was properly closed.
[0m11:07:07.343503 [info ] [MainThread]: 
[0m11:07:07.343709 [info ] [MainThread]: Finished running 11 view models in 0 hours 0 minutes and 4.38 seconds (4.38s).
[0m11:07:07.344655 [debug] [MainThread]: Command end result
[0m11:07:07.353361 [info ] [MainThread]: 
[0m11:07:07.353685 [info ] [MainThread]: [32mCompleted successfully[0m
[0m11:07:07.353892 [info ] [MainThread]: 
[0m11:07:07.354100 [info ] [MainThread]: Done. PASS=11 WARN=0 ERROR=0 SKIP=0 TOTAL=11
[0m11:07:07.356173 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 4.670708, "process_user_time": 1.57307, "process_kernel_time": 0.19647, "process_mem_max_rss": "138182656", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m11:07:07.356592 [debug] [MainThread]: Command `dbt run` succeeded at 11:07:07.356490 after 4.67 seconds
[0m11:07:07.356927 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10938b4d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1054ca110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1054ca190>]}
[0m11:07:07.357259 [debug] [MainThread]: Flushing usage events
[0m11:28:32.033654 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d518c50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d5528d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d55f390>]}


============================== 11:28:32.036520 | 314a931a-4777-41df-bb62-c4d2145fa6c3 ==============================
[0m11:28:32.036520 [info ] [MainThread]: Running with dbt=1.7.10
[0m11:28:32.036871 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --select models/staging', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m11:28:32.217514 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '314a931a-4777-41df-bb62-c4d2145fa6c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c5f1c50>]}
[0m11:28:32.253538 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '314a931a-4777-41df-bb62-c4d2145fa6c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10debe4d0>]}
[0m11:28:32.254402 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m11:28:32.264523 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m11:28:32.287309 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:28:32.287556 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:28:32.290679 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '314a931a-4777-41df-bb62-c4d2145fa6c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e001410>]}
[0m11:28:32.297253 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '314a931a-4777-41df-bb62-c4d2145fa6c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e0e8250>]}
[0m11:28:32.297503 [info ] [MainThread]: Found 11 models, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m11:28:32.297688 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '314a931a-4777-41df-bb62-c4d2145fa6c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10de39710>]}
[0m11:28:32.298663 [info ] [MainThread]: 
[0m11:28:32.299057 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m11:28:32.299679 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m11:28:32.306035 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m11:28:32.306329 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m11:28:32.306506 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:28:32.795834 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 0.0 seconds
[0m11:28:32.798292 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m11:28:32.881928 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m11:28:32.888859 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m11:28:32.889154 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m11:28:32.889381 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:28:33.227662 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 0.0 seconds
[0m11:28:33.229893 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m11:28:33.314361 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '314a931a-4777-41df-bb62-c4d2145fa6c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e0078d0>]}
[0m11:28:33.315247 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:28:33.315595 [info ] [MainThread]: 
[0m11:28:33.318932 [debug] [Thread-1 (]: Began running node model.rightmove_epc.stg_epc_certs
[0m11:28:33.319283 [debug] [Thread-2 (]: Began running node model.rightmove_epc.stg_rightmove
[0m11:28:33.319678 [info ] [Thread-1 (]: 1 of 2 START sql view model dbt_melissa_rm_epc.stg_epc_certs ................... [RUN]
[0m11:28:33.320101 [info ] [Thread-2 (]: 2 of 2 START sql view model dbt_melissa_rm_epc.stg_rightmove ................... [RUN]
[0m11:28:33.320719 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.stg_epc_certs)
[0m11:28:33.321296 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.stg_rightmove'
[0m11:28:33.321595 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.stg_epc_certs
[0m11:28:33.321864 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.stg_rightmove
[0m11:28:33.328239 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.stg_epc_certs"
[0m11:28:33.330452 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.stg_rightmove"
[0m11:28:33.331361 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (compile): 11:28:33.322041 => 11:28:33.331079
[0m11:28:33.331764 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (compile): 11:28:33.328454 => 11:28:33.331576
[0m11:28:33.332041 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.stg_epc_certs
[0m11:28:33.332315 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.stg_rightmove
[0m11:28:33.381254 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.stg_epc_certs"
[0m11:28:33.383131 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.stg_rightmove"
[0m11:28:33.384129 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.stg_epc_certs"
[0m11:28:33.384387 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_epc_certs"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
  
   as (
    WITH epc_certs as (
    
    select 
    UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    COUNTY,
    LOCAL_AUTHORITY as LOCAL_AUTHORITY_CODE,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    UPPER(CASE WHEN (UPPER(ADDRESS1) LIKE 'FLAT%' OR UPPER(ADDRESS1) LIKE 'UNIT%') or UPPER(ADDRESS1) LIKE 'ROOM%' 
    THEN TRIM(REPLACE(REPLACE(CONCAT(ADDRESS),','),' '))
    ELSE trim(replace(replace(ADDRESS1,' '),',')) END) AS ADDRESSID,
    CASE WHEN UPRN is null and addressid is null THEN 1 else 0 end as REMOVE_FROM_RM_MATCH,
    FLOOR_LEVEL,
    FLAT_TOP_STOREY,
    FLAT_STOREY_COUNT,
    PROPERTY_TYPE
 from  RAW.EPC_TEST_DATA.EPC_CERTIFICATES 

)

SELECT * FROM epc_certs
  );
[0m11:28:33.384898 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.stg_rightmove"
[0m11:28:33.385180 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:28:33.385472 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_rightmove"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
  
   as (
    with rm as (

    SELECT 
    LISTING_ID,
    UPPER(TRIM(replace(REPLACE(CONCAT(ADDRESS_1::VARCHAR,ADDRESS_2::VARCHAR),' '),','))) AS ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, 
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    BEDROOM,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    STUDENTLET_FLAG,
    COMBINED_PROPERTY_TYPE
    -- property type
    FROM 
       ANALYTICS.RIGHTMOVE_PROD.CLEAN_RAW_RIGHTMOVE_DATA 

 
)

SELECT * FROM rm
  );
[0m11:28:33.386287 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m11:28:33.838079 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m11:28:33.856371 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (execute): 11:28:33.381455 => 11:28:33.856207
[0m11:28:33.856717 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: Close
[0m11:28:33.877398 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m11:28:33.879525 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (execute): 11:28:33.332476 => 11:28:33.879359
[0m11:28:33.879838 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: Close
[0m11:28:33.927935 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '314a931a-4777-41df-bb62-c4d2145fa6c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e395cd0>]}
[0m11:28:33.928496 [info ] [Thread-2 (]: 2 of 2 OK created sql view model dbt_melissa_rm_epc.stg_rightmove .............. [[32mSUCCESS 1[0m in 0.61s]
[0m11:28:33.928918 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.stg_rightmove
[0m11:28:33.967707 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '314a931a-4777-41df-bb62-c4d2145fa6c3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10e143b90>]}
[0m11:28:33.968332 [info ] [Thread-1 (]: 1 of 2 OK created sql view model dbt_melissa_rm_epc.stg_epc_certs .............. [[32mSUCCESS 1[0m in 0.65s]
[0m11:28:33.968815 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.stg_epc_certs
[0m11:28:33.970240 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:28:33.970546 [debug] [MainThread]: Connection 'model.rightmove_epc.stg_epc_certs' was properly closed.
[0m11:28:33.970784 [debug] [MainThread]: Connection 'model.rightmove_epc.stg_rightmove' was properly closed.
[0m11:28:33.971060 [info ] [MainThread]: 
[0m11:28:33.971332 [info ] [MainThread]: Finished running 2 view models in 0 hours 0 minutes and 1.67 seconds (1.67s).
[0m11:28:33.971873 [debug] [MainThread]: Command end result
[0m11:28:33.978444 [info ] [MainThread]: 
[0m11:28:33.978740 [info ] [MainThread]: [32mCompleted successfully[0m
[0m11:28:33.978955 [info ] [MainThread]: 
[0m11:28:33.979182 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m11:28:33.981249 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 1.9776504, "process_user_time": 1.183739, "process_kernel_time": 0.168549, "process_mem_max_rss": "134545408", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m11:28:33.981589 [debug] [MainThread]: Command `dbt run` succeeded at 11:28:33.981516 after 1.98 seconds
[0m11:28:33.981844 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10585a0d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105706210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10571e350>]}
[0m11:28:33.982095 [debug] [MainThread]: Flushing usage events
[0m11:30:00.707070 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1090d4c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10965e210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10965eed0>]}


============================== 11:30:00.709653 | cf35f116-9b5a-454a-ba7e-048d2f1e69b4 ==============================
[0m11:30:00.709653 [info ] [MainThread]: Running with dbt=1.7.10
[0m11:30:00.709971 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m11:30:00.877644 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'cf35f116-9b5a-454a-ba7e-048d2f1e69b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1096870d0>]}
[0m11:30:00.911047 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'cf35f116-9b5a-454a-ba7e-048d2f1e69b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1096870d0>]}
[0m11:30:00.912649 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m11:30:00.921813 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m11:30:00.939705 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:30:00.939965 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:30:00.943198 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'cf35f116-9b5a-454a-ba7e-048d2f1e69b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a2fb250>]}
[0m11:30:00.949327 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'cf35f116-9b5a-454a-ba7e-048d2f1e69b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a175ad0>]}
[0m11:30:00.949582 [info ] [MainThread]: Found 11 models, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m11:30:00.949768 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cf35f116-9b5a-454a-ba7e-048d2f1e69b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a11b990>]}
[0m11:30:00.950839 [info ] [MainThread]: 
[0m11:30:00.951234 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m11:30:00.951930 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m11:30:00.958099 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m11:30:00.958355 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m11:30:00.958509 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:30:01.772003 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 1.0 seconds
[0m11:30:01.774348 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m11:30:01.860897 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m11:30:01.869438 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m11:30:01.869896 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m11:30:01.870166 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:30:02.317779 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 0.0 seconds
[0m11:30:02.320068 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m11:30:02.404507 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cf35f116-9b5a-454a-ba7e-048d2f1e69b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a0c6b90>]}
[0m11:30:02.405437 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:30:02.405784 [info ] [MainThread]: 
[0m11:30:02.408067 [debug] [Thread-1 (]: Began running node model.rightmove_epc.stg_epc_certs
[0m11:30:02.408436 [debug] [Thread-2 (]: Began running node model.rightmove_epc.stg_rightmove
[0m11:30:02.408867 [info ] [Thread-1 (]: 1 of 11 START sql view model dbt_melissa_rm_epc.stg_epc_certs .................. [RUN]
[0m11:30:02.409242 [info ] [Thread-2 (]: 2 of 11 START sql view model dbt_melissa_rm_epc.stg_rightmove .................. [RUN]
[0m11:30:02.409833 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.stg_epc_certs)
[0m11:30:02.410431 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.stg_rightmove'
[0m11:30:02.410749 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.stg_epc_certs
[0m11:30:02.411197 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.stg_rightmove
[0m11:30:02.417820 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.stg_epc_certs"
[0m11:30:02.420134 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.stg_rightmove"
[0m11:30:02.420983 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (compile): 11:30:02.411460 => 11:30:02.420777
[0m11:30:02.421331 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (compile): 11:30:02.418066 => 11:30:02.421151
[0m11:30:02.421621 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.stg_epc_certs
[0m11:30:02.421877 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.stg_rightmove
[0m11:30:02.469913 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.stg_epc_certs"
[0m11:30:02.471551 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.stg_rightmove"
[0m11:30:02.472341 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.stg_rightmove"
[0m11:30:02.472925 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.stg_epc_certs"
[0m11:30:02.473248 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_rightmove"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
  
   as (
    with rm as (

    SELECT 
    LISTING_ID,
    UPPER(TRIM(replace(REPLACE(CONCAT(ADDRESS_1::VARCHAR,ADDRESS_2::VARCHAR),' '),','))) AS ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, 
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    BEDROOM,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    STUDENTLET_FLAG,
    COMBINED_PROPERTY_TYPE
    -- property type
    FROM 
       ANALYTICS.RIGHTMOVE_PROD.CLEAN_RAW_RIGHTMOVE_DATA 

 
)

SELECT * FROM rm
  );
[0m11:30:02.473590 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_epc_certs"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
  
   as (
    WITH epc_certs as (
    
    select 
    UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    COUNTY,
    LOCAL_AUTHORITY as LOCAL_AUTHORITY_CODE,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    UPPER(CASE WHEN (UPPER(ADDRESS1) LIKE 'FLAT%' OR UPPER(ADDRESS1) LIKE 'UNIT%') or UPPER(ADDRESS1) LIKE 'ROOM%' 
    THEN TRIM(REPLACE(REPLACE(CONCAT(ADDRESS),','),' '))
    ELSE trim(replace(replace(ADDRESS1,' '),',')) END) AS ADDRESSID,
    CASE WHEN UPRN is null and addressid is null THEN 1 else 0 end as REMOVE_FROM_RM_MATCH,
    FLOOR_LEVEL,
    FLAT_TOP_STOREY,
    FLAT_STOREY_COUNT,
    PROPERTY_TYPE
 from  RAW.EPC_TEST_DATA.EPC_CERTIFICATES 

)

SELECT * FROM epc_certs
  );
[0m11:30:02.473827 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m11:30:02.474065 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:30:03.054254 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m11:30:03.055113 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m11:30:03.074579 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (execute): 11:30:02.422035 => 11:30:03.074412
[0m11:30:03.076419 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (execute): 11:30:02.470088 => 11:30:03.076278
[0m11:30:03.076715 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: Close
[0m11:30:03.076979 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: Close
[0m11:30:03.142578 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cf35f116-9b5a-454a-ba7e-048d2f1e69b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a44a290>]}
[0m11:30:03.143155 [info ] [Thread-2 (]: 2 of 11 OK created sql view model dbt_melissa_rm_epc.stg_rightmove ............. [[32mSUCCESS 1[0m in 0.73s]
[0m11:30:03.143633 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.stg_rightmove
[0m11:30:03.154820 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cf35f116-9b5a-454a-ba7e-048d2f1e69b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109fbd710>]}
[0m11:30:03.155364 [info ] [Thread-1 (]: 1 of 11 OK created sql view model dbt_melissa_rm_epc.stg_epc_certs ............. [[32mSUCCESS 1[0m in 0.75s]
[0m11:30:03.155800 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.stg_epc_certs
[0m11:30:03.156365 [debug] [Thread-4 (]: Began running node model.rightmove_epc.dim_addressid
[0m11:30:03.156663 [debug] [Thread-3 (]: Began running node model.rightmove_epc.dim_uprn
[0m11:30:03.157043 [info ] [Thread-4 (]: 3 of 11 START sql view model dbt_melissa_rm_epc.dim_addressid .................. [RUN]
[0m11:30:03.157374 [info ] [Thread-3 (]: 4 of 11 START sql view model dbt_melissa_rm_epc.dim_uprn ....................... [RUN]
[0m11:30:03.157918 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_addressid'
[0m11:30:03.158395 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_uprn'
[0m11:30:03.158658 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.dim_addressid
[0m11:30:03.158896 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.dim_uprn
[0m11:30:03.161217 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.dim_addressid"
[0m11:30:03.163085 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.dim_uprn"
[0m11:30:03.164617 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.dim_uprn (compile): 11:30:03.161393 => 11:30:03.164480
[0m11:30:03.164926 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_addressid (compile): 11:30:03.159045 => 11:30:03.164747
[0m11:30:03.165199 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.dim_uprn
[0m11:30:03.165441 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.dim_addressid
[0m11:30:03.167833 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.dim_uprn"
[0m11:30:03.169976 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.dim_addressid"
[0m11:30:03.171045 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.dim_uprn"
[0m11:30:03.171750 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.dim_addressid"
[0m11:30:03.171998 [debug] [Thread-3 (]: On model.rightmove_epc.dim_uprn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_uprn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE UPRNS


with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource,
    POSTCODE
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    where REMOVE_FROM_RM_MATCH = 0
    AND UPRN IS NOT NULL
),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    WHERE UPRN IS NOT NULL

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where uprn is not null
  );
[0m11:30:03.172280 [debug] [Thread-4 (]: On model.rightmove_epc.dim_addressid: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_addressid"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE ADDRESS'

with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource,
    POSTCODE

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    where REMOVE_FROM_RM_MATCH = 0
    AND ADDRESSID IS NOT NULL

),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    WHERE ADDRESSID IS NOT NULL

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where uprn is null
and addressid is not null
  );
[0m11:30:03.172517 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m11:30:03.172724 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m11:30:03.677010 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m11:30:03.680996 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_addressid (execute): 11:30:03.168046 => 11:30:03.680773
[0m11:30:03.681445 [debug] [Thread-4 (]: On model.rightmove_epc.dim_addressid: Close
[0m11:30:03.713534 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m11:30:03.718923 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.dim_uprn (execute): 11:30:03.165585 => 11:30:03.718596
[0m11:30:03.720746 [debug] [Thread-3 (]: On model.rightmove_epc.dim_uprn: Close
[0m11:30:03.762062 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cf35f116-9b5a-454a-ba7e-048d2f1e69b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a1def50>]}
[0m11:30:03.762634 [info ] [Thread-4 (]: 3 of 11 OK created sql view model dbt_melissa_rm_epc.dim_addressid ............. [[32mSUCCESS 1[0m in 0.60s]
[0m11:30:03.763061 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.dim_addressid
[0m11:30:03.763565 [debug] [Thread-1 (]: Began running node model.rightmove_epc.address_match
[0m11:30:03.763895 [debug] [Thread-2 (]: Began running node model.rightmove_epc.address_simularity
[0m11:30:03.764245 [info ] [Thread-1 (]: 5 of 11 START sql view model dbt_melissa_rm_epc.address_match .................. [RUN]
[0m11:30:03.764612 [info ] [Thread-2 (]: 6 of 11 START sql view model dbt_melissa_rm_epc.address_simularity ............. [RUN]
[0m11:30:03.765141 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_epc_certs, now model.rightmove_epc.address_match)
[0m11:30:03.765615 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_rightmove, now model.rightmove_epc.address_simularity)
[0m11:30:03.765983 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.address_match
[0m11:30:03.766323 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.address_simularity
[0m11:30:03.769651 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.address_match"
[0m11:30:03.771974 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.address_simularity"
[0m11:30:03.773151 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.address_match (compile): 11:30:03.766527 => 11:30:03.772975
[0m11:30:03.773512 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.address_simularity (compile): 11:30:03.769848 => 11:30:03.773334
[0m11:30:03.773836 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.address_match
[0m11:30:03.774240 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.address_simularity
[0m11:30:03.778219 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.address_match"
[0m11:30:03.780771 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.address_simularity"
[0m11:30:03.781975 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.address_simularity"
[0m11:30:03.782700 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.address_match"
[0m11:30:03.783018 [debug] [Thread-2 (]: On model.rightmove_epc.address_simularity: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.address_simularity"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.address_simularity
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NULL
),

epc_address as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
    where datasource = 'EPC'
)


SELECT rm.*,epc_address.addressid as EPC_ADDRESSID
FROM rm
JOIN epc_address
ON JAROWINKLER_SIMILARITY(rm.addressid, epc_address.addressid) = 1
  );
[0m11:30:03.783335 [debug] [Thread-1 (]: On model.rightmove_epc.address_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.address_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NULL
),

epc_address as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
    where datasource = 'EPC'
)


SELECT rm.*,
CASE WHEN epc_address.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_address.ADDRESSID AS EPC_ADDRESSID


FROM rm
LEFT JOIN epc_address
ON rm.addressid = epc_address.addressid
and rm.FULL_POSTCODE = epc_address.POSTCODE
  );
[0m11:30:03.783612 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m11:30:03.783858 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:30:03.802688 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cf35f116-9b5a-454a-ba7e-048d2f1e69b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109613690>]}
[0m11:30:03.803177 [info ] [Thread-3 (]: 4 of 11 OK created sql view model dbt_melissa_rm_epc.dim_uprn .................. [[32mSUCCESS 1[0m in 0.64s]
[0m11:30:03.803580 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.dim_uprn
[0m11:30:03.804002 [debug] [Thread-4 (]: Began running node model.rightmove_epc.uprn_match
[0m11:30:03.804316 [info ] [Thread-4 (]: 7 of 11 START sql view model dbt_melissa_rm_epc.uprn_match ..................... [RUN]
[0m11:30:03.804808 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.dim_addressid, now model.rightmove_epc.uprn_match)
[0m11:30:03.805062 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.uprn_match
[0m11:30:03.807254 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.uprn_match"
[0m11:30:03.807807 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.uprn_match (compile): 11:30:03.805219 => 11:30:03.807670
[0m11:30:03.808035 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.uprn_match
[0m11:30:03.810106 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.uprn_match"
[0m11:30:03.811193 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.uprn_match"
[0m11:30:03.811552 [debug] [Thread-4 (]: On model.rightmove_epc.uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NOT NULL
),

epc_uprn as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
    where datasource = 'EPC'
)


SELECT rm.*,
CASE WHEN epc_uprn.UPRN is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_uprn.UPRN AS EPC_UPRN,
epc_uprn.ADDRESSID AS EPC_ADDRESSID


FROM rm
LEFT JOIN epc_uprn
ON rm.UPRN = epc_uprn.UPRN

WHERE MATCH_EPC = 'YES'
  );
[0m11:30:03.812083 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m11:30:04.385078 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m11:30:04.386173 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m11:30:04.388775 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.address_match (execute): 11:30:03.774448 => 11:30:04.388582
[0m11:30:04.391027 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.address_simularity (execute): 11:30:03.778481 => 11:30:04.390849
[0m11:30:04.391390 [debug] [Thread-1 (]: On model.rightmove_epc.address_match: Close
[0m11:30:04.391679 [debug] [Thread-2 (]: On model.rightmove_epc.address_simularity: Close
[0m11:30:04.398670 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m11:30:04.400791 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.uprn_match (execute): 11:30:03.808169 => 11:30:04.400625
[0m11:30:04.401102 [debug] [Thread-4 (]: On model.rightmove_epc.uprn_match: Close
[0m11:30:04.485147 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cf35f116-9b5a-454a-ba7e-048d2f1e69b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a559510>]}
[0m11:30:04.485837 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cf35f116-9b5a-454a-ba7e-048d2f1e69b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a405f50>]}
[0m11:30:04.486409 [info ] [Thread-2 (]: 6 of 11 OK created sql view model dbt_melissa_rm_epc.address_simularity ........ [[32mSUCCESS 1[0m in 0.72s]
[0m11:30:04.486884 [info ] [Thread-4 (]: 7 of 11 OK created sql view model dbt_melissa_rm_epc.uprn_match ................ [[32mSUCCESS 1[0m in 0.68s]
[0m11:30:04.487344 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.address_simularity
[0m11:30:04.487733 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.uprn_match
[0m11:30:04.488272 [debug] [Thread-3 (]: Began running node model.rightmove_epc.no_uprn_match
[0m11:30:04.488663 [info ] [Thread-3 (]: 8 of 11 START sql view model dbt_melissa_rm_epc.no_uprn_match .................. [RUN]
[0m11:30:04.489510 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.dim_uprn, now model.rightmove_epc.no_uprn_match)
[0m11:30:04.489857 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.no_uprn_match
[0m11:30:04.493158 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.no_uprn_match"
[0m11:30:04.493813 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cf35f116-9b5a-454a-ba7e-048d2f1e69b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1096975d0>]}
[0m11:30:04.494261 [info ] [Thread-1 (]: 5 of 11 OK created sql view model dbt_melissa_rm_epc.address_match ............. [[32mSUCCESS 1[0m in 0.73s]
[0m11:30:04.494671 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.address_match
[0m11:30:04.495290 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.no_uprn_match (compile): 11:30:04.490080 => 11:30:04.495029
[0m11:30:04.495641 [debug] [Thread-4 (]: Began running node model.rightmove_epc.all_matches
[0m11:30:04.495990 [debug] [Thread-2 (]: Began running node model.rightmove_epc.houses_report
[0m11:30:04.496288 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.no_uprn_match
[0m11:30:04.496547 [debug] [Thread-1 (]: Began running node model.rightmove_epc.no_matches
[0m11:30:04.496888 [info ] [Thread-4 (]: 9 of 11 START sql view model dbt_melissa_rm_epc.all_matches .................... [RUN]
[0m11:30:04.497236 [info ] [Thread-2 (]: 10 of 11 START sql view model dbt_melissa_rm_epc.houses_report ................. [RUN]
[0m11:30:04.500109 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.no_uprn_match"
[0m11:30:04.500578 [info ] [Thread-1 (]: 11 of 11 START sql view model dbt_melissa_rm_epc.no_matches .................... [RUN]
[0m11:30:04.501126 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.uprn_match, now model.rightmove_epc.all_matches)
[0m11:30:04.501538 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.address_simularity, now model.rightmove_epc.houses_report)
[0m11:30:04.502113 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.address_match, now model.rightmove_epc.no_matches)
[0m11:30:04.502431 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.all_matches
[0m11:30:04.502719 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.houses_report
[0m11:30:04.503285 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.no_uprn_match"
[0m11:30:04.503526 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.no_matches
[0m11:30:04.505809 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.all_matches"
[0m11:30:04.508225 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.houses_report"
[0m11:30:04.508613 [debug] [Thread-3 (]: On model.rightmove_epc.no_uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.no_uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.no_uprn_match
  
   as (
    with rm_no_match_to_epc  as ( -- rightmove uspn does not match epc

    select *

     from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'NO'
    
)

select * from rm_no_match_to_epc

/*
epc_remove as (

    select EPC_UPRN,EPC_ADDRESSID from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'YES'  -- 
),

epc_matched as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs src
    left join epc_remove rem on src.UPRN = rem.EPC_UPRN
    
),

epc_fm_prep as (

    select * from epc_matched
    where EPC_UPRN is NULL

    
)


SELECT * FROM epc_fm_prep
WHERE UPRN NOT NULL */
  );
[0m11:30:04.510539 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.no_matches"
[0m11:30:04.510987 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m11:30:04.511868 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.all_matches (compile): 11:30:04.503681 => 11:30:04.511710
[0m11:30:04.512469 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.all_matches
[0m11:30:04.512908 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.no_matches (compile): 11:30:04.508823 => 11:30:04.512724
[0m11:30:04.515155 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.all_matches"
[0m11:30:04.515497 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.houses_report (compile): 11:30:04.506023 => 11:30:04.515328
[0m11:30:04.515841 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.no_matches
[0m11:30:04.516474 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.houses_report
[0m11:30:04.518437 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.no_matches"
[0m11:30:04.521377 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.houses_report"
[0m11:30:04.522213 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.all_matches"
[0m11:30:04.522545 [debug] [Thread-4 (]: On model.rightmove_epc.all_matches: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.all_matches"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.all_matches
  
   as (
    with addr as (

    select 
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    '' AS EPC_UPRN,
    EPC_ADDRESSID
    
    from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
    where MATCH_EPC = 'YES' 
),

uprn as (

    select 
    
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN::VARCHAR AS EPC_UPRN,
    EPC_ADDRESSID
     from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'YES'
),

final as (

select 'ADDRESS AND POSTCODE MATCH' AS MATCH_RESULT, * from addr
union all
select 'UPRN MATCH' AS MATCH_RESULT, * from uprn
)

select * from final
  );
[0m11:30:04.523295 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.no_matches"
[0m11:30:04.523502 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m11:30:04.524420 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.houses_report"
[0m11:30:04.524701 [debug] [Thread-1 (]: On model.rightmove_epc.no_matches: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.no_matches"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.no_matches
  
   as (
    with addr as (

    select 
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    '' AS EPC_UPRN,
    EPC_ADDRESSID
    
    from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
    where MATCH_EPC = 'NO' 
),

uprn as (

    select 
    
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN::VARCHAR AS EPC_UPRN,
    EPC_ADDRESSID
    
     from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'NO'
),

final as (

select 'NO ADDRESS OR UPRN MATCH' AS MATCH_RESULT, * from addr
union all
select 'NO UPRN MATCH' AS MATCH_RESULT, * from uprn
)

select * from final
  );
[0m11:30:04.525631 [debug] [Thread-2 (]: On model.rightmove_epc.houses_report: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.houses_report"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.houses_report
  
   as (
    with house_addmatch as (

    select 
    distinct
    --count(LISTING_ID) as TOTAL_LISTINGS,
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN, -- NULL
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
 --   am.FLOOR_LEVEL as RM_FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.*

     from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc on am.EPC_ADDRESSID = epc.ADDRESSID
    and am.FULL_POSTCODE = epc.POSTCODE
    where MATCH_EPC = 'YES'
    and COMBINED_PROPERTY_TYPE not in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')

),

house_uprnmatch as (

    select 
    distinct
    --count(LISTING_ID) as TOTAL_LISTINGS,
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN, -- NULL
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
  --  am.FLOOR_LEVEL as RM_FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.* -- remove uprn source
    

    from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc on am.EPC_UPRN = epc.UPRN

    where MATCH_EPC = 'YES'
   and COMBINED_PROPERTY_TYPE not in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')
   AND RM_UPRN = 10008798499

)

select * from house_uprnmatch

/*
--THIS IS USED FOR A TEST
select RM_UPRN,COUNT(BUILDING_REFERENCE_NUMBER)
from house_uprnmatch
WHERE RM_UPRN IS NOT NULL
GROUP BY 1
HAVING COUNT(BUILDING_REFERENCE_NUMBER) >1
*/
  );
[0m11:30:04.525959 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:30:04.526177 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m11:30:05.101605 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m11:30:05.103884 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.no_uprn_match (execute): 11:30:04.497435 => 11:30:05.103731
[0m11:30:05.104261 [debug] [Thread-3 (]: On model.rightmove_epc.no_uprn_match: Close
[0m11:30:05.110174 [debug] [Thread-2 (]: Snowflake adapter: Snowflake query id: 01b34452-0103-9b8b-0000-719506372902
[0m11:30:05.110467 [debug] [Thread-2 (]: Snowflake adapter: Snowflake error: 002025 (42S21): SQL compilation error:
duplicate column name 'LOCAL_AUTHORITY_CODE'
[0m11:30:05.110840 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.houses_report (execute): 11:30:04.518620 => 11:30:05.110711
[0m11:30:05.111072 [debug] [Thread-2 (]: On model.rightmove_epc.houses_report: Close
[0m11:30:05.137889 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m11:30:05.139818 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.all_matches (execute): 11:30:04.513097 => 11:30:05.139679
[0m11:30:05.140082 [debug] [Thread-4 (]: On model.rightmove_epc.all_matches: Close
[0m11:30:05.148327 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m11:30:05.150675 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.no_matches (execute): 11:30:04.516646 => 11:30:05.150524
[0m11:30:05.150980 [debug] [Thread-1 (]: On model.rightmove_epc.no_matches: Close
[0m11:30:05.186298 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cf35f116-9b5a-454a-ba7e-048d2f1e69b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a32af90>]}
[0m11:30:05.186883 [info ] [Thread-3 (]: 8 of 11 OK created sql view model dbt_melissa_rm_epc.no_uprn_match ............. [[32mSUCCESS 1[0m in 0.70s]
[0m11:30:05.187444 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.no_uprn_match
[0m11:30:05.189216 [debug] [Thread-2 (]: Database Error in model houses_report (models/reports/houses_report.sql)
  002025 (42S21): SQL compilation error:
  duplicate column name 'LOCAL_AUTHORITY_CODE'
  compiled Code at target/run/rightmove_epc/models/reports/houses_report.sql
[0m11:30:05.189513 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cf35f116-9b5a-454a-ba7e-048d2f1e69b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a13ff50>]}
[0m11:30:05.189828 [error] [Thread-2 (]: 10 of 11 ERROR creating sql view model dbt_melissa_rm_epc.houses_report ........ [[31mERROR[0m in 0.69s]
[0m11:30:05.190158 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.houses_report
[0m11:30:05.216004 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cf35f116-9b5a-454a-ba7e-048d2f1e69b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10508c690>]}
[0m11:30:05.216504 [info ] [Thread-4 (]: 9 of 11 OK created sql view model dbt_melissa_rm_epc.all_matches ............... [[32mSUCCESS 1[0m in 0.72s]
[0m11:30:05.216840 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.all_matches
[0m11:30:05.239320 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cf35f116-9b5a-454a-ba7e-048d2f1e69b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a4b8cd0>]}
[0m11:30:05.241009 [info ] [Thread-1 (]: 11 of 11 OK created sql view model dbt_melissa_rm_epc.no_matches ............... [[32mSUCCESS 1[0m in 0.74s]
[0m11:30:05.241399 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.no_matches
[0m11:30:05.242605 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:30:05.242815 [debug] [MainThread]: Connection 'model.rightmove_epc.no_matches' was properly closed.
[0m11:30:05.242990 [debug] [MainThread]: Connection 'model.rightmove_epc.houses_report' was properly closed.
[0m11:30:05.243181 [debug] [MainThread]: Connection 'model.rightmove_epc.all_matches' was properly closed.
[0m11:30:05.243346 [debug] [MainThread]: Connection 'model.rightmove_epc.no_uprn_match' was properly closed.
[0m11:30:05.243566 [info ] [MainThread]: 
[0m11:30:05.243772 [info ] [MainThread]: Finished running 11 view models in 0 hours 0 minutes and 4.29 seconds (4.29s).
[0m11:30:05.244799 [debug] [MainThread]: Command end result
[0m11:30:05.250618 [info ] [MainThread]: 
[0m11:30:05.250897 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m11:30:05.251088 [info ] [MainThread]: 
[0m11:30:05.251281 [error] [MainThread]:   Database Error in model houses_report (models/reports/houses_report.sql)
  002025 (42S21): SQL compilation error:
  duplicate column name 'LOCAL_AUTHORITY_CODE'
  compiled Code at target/run/rightmove_epc/models/reports/houses_report.sql
[0m11:30:05.251476 [info ] [MainThread]: 
[0m11:30:05.251661 [info ] [MainThread]: Done. PASS=10 WARN=0 ERROR=1 SKIP=0 TOTAL=11
[0m11:30:05.253487 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 4.57223, "process_user_time": 1.526181, "process_kernel_time": 0.190115, "process_mem_max_rss": "141049856", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m11:30:05.253962 [debug] [MainThread]: Command `dbt run` failed at 11:30:05.253883 after 4.57 seconds
[0m11:30:05.254232 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100e36110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1011c0f10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1011f9cd0>]}
[0m11:30:05.254489 [debug] [MainThread]: Flushing usage events
[0m11:44:05.644997 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109818a10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10985e810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10985f390>]}


============================== 11:44:05.647772 | 6b10dec0-0d41-47f9-8228-044e8e9b6dbd ==============================
[0m11:44:05.647772 [info ] [MainThread]: Running with dbt=1.7.10
[0m11:44:05.648117 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select models/staging', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m11:44:05.824702 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6b10dec0-0d41-47f9-8228-044e8e9b6dbd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a19d010>]}
[0m11:44:05.858543 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6b10dec0-0d41-47f9-8228-044e8e9b6dbd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1098375d0>]}
[0m11:44:05.859248 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m11:44:05.868347 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m11:44:05.884108 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:44:05.884386 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:44:05.887626 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6b10dec0-0d41-47f9-8228-044e8e9b6dbd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a2e5d50>]}
[0m11:44:05.894312 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6b10dec0-0d41-47f9-8228-044e8e9b6dbd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a39cbd0>]}
[0m11:44:05.894574 [info ] [MainThread]: Found 11 models, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m11:44:05.894762 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6b10dec0-0d41-47f9-8228-044e8e9b6dbd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a2f3550>]}
[0m11:44:05.895724 [info ] [MainThread]: 
[0m11:44:05.896118 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m11:44:05.896685 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m11:44:05.903021 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m11:44:05.903269 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m11:44:05.903435 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:44:06.499647 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 1.0 seconds
[0m11:44:06.501704 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m11:44:06.598021 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m11:44:06.604698 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m11:44:06.604998 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m11:44:06.605231 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:44:06.889871 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 0.0 seconds
[0m11:44:06.891504 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m11:44:06.969301 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6b10dec0-0d41-47f9-8228-044e8e9b6dbd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a3a68d0>]}
[0m11:44:06.969989 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:44:06.970300 [info ] [MainThread]: 
[0m11:44:06.973110 [debug] [Thread-1 (]: Began running node model.rightmove_epc.stg_epc_certs
[0m11:44:06.973365 [debug] [Thread-2 (]: Began running node model.rightmove_epc.stg_rightmove
[0m11:44:06.973674 [info ] [Thread-1 (]: 1 of 2 START sql view model dbt_melissa_rm_epc.stg_epc_certs ................... [RUN]
[0m11:44:06.973953 [info ] [Thread-2 (]: 2 of 2 START sql view model dbt_melissa_rm_epc.stg_rightmove ................... [RUN]
[0m11:44:06.974382 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.stg_epc_certs)
[0m11:44:06.974796 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.stg_rightmove'
[0m11:44:06.975014 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.stg_epc_certs
[0m11:44:06.975207 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.stg_rightmove
[0m11:44:06.978664 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.stg_rightmove"
[0m11:44:06.982056 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.stg_epc_certs"
[0m11:44:06.982838 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (compile): 11:44:06.976857 => 11:44:06.982708
[0m11:44:06.983108 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (compile): 11:44:06.975335 => 11:44:06.982966
[0m11:44:06.983323 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.stg_rightmove
[0m11:44:06.983517 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.stg_epc_certs
[0m11:44:07.031078 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.stg_rightmove"
[0m11:44:07.032723 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.stg_epc_certs"
[0m11:44:07.034014 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.stg_rightmove"
[0m11:44:07.034211 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_rightmove"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
  
   as (
    with rm as (

    SELECT 
    LISTING_ID,
    CHANGE_DATE,
    UPPER(TRIM(replace(REPLACE(CONCAT(ADDRESS_1::VARCHAR,ADDRESS_2::VARCHAR),' '),','))) AS ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, 
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    BEDROOM,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    STUDENTLET_FLAG,
    COMBINED_PROPERTY_TYPE
    -- property type
    FROM 
       ANALYTICS.RIGHTMOVE_PROD.CLEAN_RAW_RIGHTMOVE_DATA 

 
)

SELECT * FROM rm
  );
[0m11:44:07.034394 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m11:44:07.035281 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.stg_epc_certs"
[0m11:44:07.035512 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_epc_certs"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
  
   as (
    WITH epc_certs as (
    
    select 
    UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    COUNTY,
    LOCAL_AUTHORITY as LOCAL_AUTHORITY_CODE,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    UPPER(CASE WHEN (UPPER(ADDRESS1) LIKE 'FLAT%' OR UPPER(ADDRESS1) LIKE 'UNIT%') or UPPER(ADDRESS1) LIKE 'ROOM%' 
    THEN TRIM(REPLACE(REPLACE(CONCAT(ADDRESS),','),' '))
    ELSE trim(replace(replace(ADDRESS1,' '),',')) END) AS ADDRESSID,
    CASE WHEN UPRN is null and addressid is null THEN 1 else 0 end as REMOVE_FROM_RM_MATCH,
    FLOOR_LEVEL,
    FLAT_TOP_STOREY,
    FLAT_STOREY_COUNT,
    PROPERTY_TYPE
 from  RAW.EPC_TEST_DATA.EPC_CERTIFICATES 

)

SELECT * FROM epc_certs
  );
[0m11:44:07.035718 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:44:07.468854 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m11:44:07.486770 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (execute): 11:44:06.983639 => 11:44:07.486595
[0m11:44:07.487160 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: Close
[0m11:44:07.525069 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m11:44:07.527184 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (execute): 11:44:07.031245 => 11:44:07.527031
[0m11:44:07.527470 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: Close
[0m11:44:07.557215 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6b10dec0-0d41-47f9-8228-044e8e9b6dbd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a186090>]}
[0m11:44:07.558150 [info ] [Thread-2 (]: 2 of 2 OK created sql view model dbt_melissa_rm_epc.stg_rightmove .............. [[32mSUCCESS 1[0m in 0.58s]
[0m11:44:07.558708 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.stg_rightmove
[0m11:44:07.599618 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6b10dec0-0d41-47f9-8228-044e8e9b6dbd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a3fbe10>]}
[0m11:44:07.600173 [info ] [Thread-1 (]: 1 of 2 OK created sql view model dbt_melissa_rm_epc.stg_epc_certs .............. [[32mSUCCESS 1[0m in 0.63s]
[0m11:44:07.600571 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.stg_epc_certs
[0m11:44:07.601788 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:44:07.602019 [debug] [MainThread]: Connection 'model.rightmove_epc.stg_epc_certs' was properly closed.
[0m11:44:07.602209 [debug] [MainThread]: Connection 'model.rightmove_epc.stg_rightmove' was properly closed.
[0m11:44:07.602424 [info ] [MainThread]: 
[0m11:44:07.602643 [info ] [MainThread]: Finished running 2 view models in 0 hours 0 minutes and 1.71 seconds (1.71s).
[0m11:44:07.603090 [debug] [MainThread]: Command end result
[0m11:44:07.609669 [info ] [MainThread]: 
[0m11:44:07.609926 [info ] [MainThread]: [32mCompleted successfully[0m
[0m11:44:07.610105 [info ] [MainThread]: 
[0m11:44:07.610293 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m11:44:07.612103 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 1.9947478, "process_user_time": 1.178457, "process_kernel_time": 0.162216, "process_mem_max_rss": "135462912", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m11:44:07.612454 [debug] [MainThread]: Command `dbt run` succeeded at 11:44:07.612376 after 2.00 seconds
[0m11:44:07.612688 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109887610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102bbe210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102d12150>]}
[0m11:44:07.612911 [debug] [MainThread]: Flushing usage events
[0m11:48:20.236373 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109b18710>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1087d31d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109b5ecd0>]}


============================== 11:48:20.239787 | c8c3ceec-7f05-47a0-ade6-59af29d1dfa1 ==============================
[0m11:48:20.239787 [info ] [MainThread]: Running with dbt=1.7.10
[0m11:48:20.240161 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True'}
[0m11:48:20.423597 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c8c3ceec-7f05-47a0-ade6-59af29d1dfa1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a39cbd0>]}
[0m11:48:20.521299 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c8c3ceec-7f05-47a0-ade6-59af29d1dfa1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a3f7c10>]}
[0m11:48:20.522096 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m11:48:20.532484 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m11:48:20.561001 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:48:20.561282 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:48:20.564652 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c8c3ceec-7f05-47a0-ade6-59af29d1dfa1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a6a3950>]}
[0m11:48:20.572425 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c8c3ceec-7f05-47a0-ade6-59af29d1dfa1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a3ff910>]}
[0m11:48:20.572720 [info ] [MainThread]: Found 11 models, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m11:48:20.572905 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c8c3ceec-7f05-47a0-ade6-59af29d1dfa1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a68cc90>]}
[0m11:48:20.573931 [info ] [MainThread]: 
[0m11:48:20.574334 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m11:48:20.575156 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m11:48:20.582403 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m11:48:20.582625 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m11:48:20.582773 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:48:21.090322 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 1.0 seconds
[0m11:48:21.092781 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m11:48:21.195244 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m11:48:21.202938 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m11:48:21.203276 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m11:48:21.203537 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:48:21.674261 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 0.0 seconds
[0m11:48:21.676007 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m11:48:21.756617 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c8c3ceec-7f05-47a0-ade6-59af29d1dfa1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109b03dd0>]}
[0m11:48:21.757200 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:48:21.757416 [info ] [MainThread]: 
[0m11:48:21.759085 [debug] [Thread-1 (]: Began running node model.rightmove_epc.stg_epc_certs
[0m11:48:21.759333 [debug] [Thread-2 (]: Began running node model.rightmove_epc.stg_rightmove
[0m11:48:21.759651 [info ] [Thread-1 (]: 1 of 11 START sql view model dbt_melissa_rm_epc.stg_epc_certs .................. [RUN]
[0m11:48:21.759908 [info ] [Thread-2 (]: 2 of 11 START sql view model dbt_melissa_rm_epc.stg_rightmove .................. [RUN]
[0m11:48:21.760352 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.stg_epc_certs)
[0m11:48:21.760782 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.stg_rightmove'
[0m11:48:21.761021 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.stg_epc_certs
[0m11:48:21.761240 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.stg_rightmove
[0m11:48:21.767256 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.stg_epc_certs"
[0m11:48:21.769701 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.stg_rightmove"
[0m11:48:21.770730 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (compile): 11:48:21.767501 => 11:48:21.770531
[0m11:48:21.771008 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (compile): 11:48:21.761377 => 11:48:21.770864
[0m11:48:21.771269 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.stg_rightmove
[0m11:48:21.771506 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.stg_epc_certs
[0m11:48:21.819503 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.stg_rightmove"
[0m11:48:21.821204 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.stg_epc_certs"
[0m11:48:21.821990 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.stg_rightmove"
[0m11:48:21.822546 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.stg_epc_certs"
[0m11:48:21.822769 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_rightmove"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
  
   as (
    with rm as (

    SELECT 
    LISTING_ID,
    CHANGE_DATE,
    UPPER(TRIM(replace(REPLACE(CONCAT(ADDRESS_1::VARCHAR,ADDRESS_2::VARCHAR),' '),','))) AS ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, 
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    BEDROOM,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    STUDENTLET_FLAG,
    COMBINED_PROPERTY_TYPE
    -- property type
    FROM 
       ANALYTICS.RIGHTMOVE_PROD.CLEAN_RAW_RIGHTMOVE_DATA 

 
)

SELECT * FROM rm
  );
[0m11:48:21.823001 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_epc_certs"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
  
   as (
    WITH epc_certs as (
    
    select 
    UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    COUNTY,
    LOCAL_AUTHORITY as LOCAL_AUTHORITY_CODE,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    UPPER(CASE WHEN (UPPER(ADDRESS1) LIKE 'FLAT%' OR UPPER(ADDRESS1) LIKE 'UNIT%') or UPPER(ADDRESS1) LIKE 'ROOM%' 
    THEN TRIM(REPLACE(REPLACE(CONCAT(ADDRESS),','),' '))
    ELSE trim(replace(replace(ADDRESS1,' '),',')) END) AS ADDRESSID,
    CASE WHEN UPRN is null and addressid is null THEN 1 else 0 end as REMOVE_FROM_RM_MATCH,
    FLOOR_LEVEL,
    FLAT_TOP_STOREY,
    FLAT_STOREY_COUNT,
    PROPERTY_TYPE
 from  RAW.EPC_TEST_DATA.EPC_CERTIFICATES 

)

SELECT * FROM epc_certs
  );
[0m11:48:21.823202 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m11:48:21.823360 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:48:22.245413 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m11:48:22.264299 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (execute): 11:48:21.819712 => 11:48:22.264134
[0m11:48:22.264868 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: Close
[0m11:48:22.266054 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m11:48:22.268240 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (execute): 11:48:21.771638 => 11:48:22.268090
[0m11:48:22.268573 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: Close
[0m11:48:22.352780 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c8c3ceec-7f05-47a0-ade6-59af29d1dfa1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a6c7650>]}
[0m11:48:22.353481 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c8c3ceec-7f05-47a0-ade6-59af29d1dfa1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a62c350>]}
[0m11:48:22.354083 [info ] [Thread-1 (]: 1 of 11 OK created sql view model dbt_melissa_rm_epc.stg_epc_certs ............. [[32mSUCCESS 1[0m in 0.59s]
[0m11:48:22.354547 [info ] [Thread-2 (]: 2 of 11 OK created sql view model dbt_melissa_rm_epc.stg_rightmove ............. [[32mSUCCESS 1[0m in 0.59s]
[0m11:48:22.355003 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.stg_epc_certs
[0m11:48:22.355406 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.stg_rightmove
[0m11:48:22.356127 [debug] [Thread-4 (]: Began running node model.rightmove_epc.dim_addressid
[0m11:48:22.356472 [debug] [Thread-3 (]: Began running node model.rightmove_epc.dim_uprn
[0m11:48:22.356785 [info ] [Thread-4 (]: 3 of 11 START sql view model dbt_melissa_rm_epc.dim_addressid .................. [RUN]
[0m11:48:22.357170 [info ] [Thread-3 (]: 4 of 11 START sql view model dbt_melissa_rm_epc.dim_uprn ....................... [RUN]
[0m11:48:22.357812 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_addressid'
[0m11:48:22.358350 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_uprn'
[0m11:48:22.358601 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.dim_addressid
[0m11:48:22.358841 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.dim_uprn
[0m11:48:22.361487 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.dim_addressid"
[0m11:48:22.363679 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.dim_uprn"
[0m11:48:22.364980 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.dim_uprn (compile): 11:48:22.361731 => 11:48:22.364798
[0m11:48:22.365271 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_addressid (compile): 11:48:22.358997 => 11:48:22.365132
[0m11:48:22.365538 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.dim_uprn
[0m11:48:22.365831 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.dim_addressid
[0m11:48:22.368442 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.dim_uprn"
[0m11:48:22.370901 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.dim_addressid"
[0m11:48:22.372071 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.dim_uprn"
[0m11:48:22.372408 [debug] [Thread-3 (]: On model.rightmove_epc.dim_uprn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_uprn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE UPRNS


with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource,
    POSTCODE
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    where REMOVE_FROM_RM_MATCH = 0
    AND UPRN IS NOT NULL
),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    WHERE UPRN IS NOT NULL

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where uprn is not null
  );
[0m11:48:22.373154 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.dim_addressid"
[0m11:48:22.373400 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m11:48:22.373677 [debug] [Thread-4 (]: On model.rightmove_epc.dim_addressid: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_addressid"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE ADDRESS'

with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource,
    POSTCODE

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    where REMOVE_FROM_RM_MATCH = 0
    AND ADDRESSID IS NOT NULL

),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    WHERE ADDRESSID IS NOT NULL

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where uprn is null
and addressid is not null
  );
[0m11:48:22.374349 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m11:48:22.874414 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m11:48:22.877524 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.dim_uprn (execute): 11:48:22.366024 => 11:48:22.877322
[0m11:48:22.877908 [debug] [Thread-3 (]: On model.rightmove_epc.dim_uprn: Close
[0m11:48:22.884152 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m11:48:22.886580 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_addressid (execute): 11:48:22.368692 => 11:48:22.886380
[0m11:48:22.886929 [debug] [Thread-4 (]: On model.rightmove_epc.dim_addressid: Close
[0m11:48:22.958302 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c8c3ceec-7f05-47a0-ade6-59af29d1dfa1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b590190>]}
[0m11:48:22.959215 [info ] [Thread-3 (]: 4 of 11 OK created sql view model dbt_melissa_rm_epc.dim_uprn .................. [[32mSUCCESS 1[0m in 0.60s]
[0m11:48:22.959827 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.dim_uprn
[0m11:48:22.960376 [debug] [Thread-2 (]: Began running node model.rightmove_epc.uprn_match
[0m11:48:22.960819 [info ] [Thread-2 (]: 5 of 11 START sql view model dbt_melissa_rm_epc.uprn_match ..................... [RUN]
[0m11:48:22.961482 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c8c3ceec-7f05-47a0-ade6-59af29d1dfa1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b524b90>]}
[0m11:48:22.962037 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_rightmove, now model.rightmove_epc.uprn_match)
[0m11:48:22.962518 [info ] [Thread-4 (]: 3 of 11 OK created sql view model dbt_melissa_rm_epc.dim_addressid ............. [[32mSUCCESS 1[0m in 0.60s]
[0m11:48:22.962902 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.uprn_match
[0m11:48:22.963356 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.dim_addressid
[0m11:48:22.966477 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.uprn_match"
[0m11:48:22.966943 [debug] [Thread-3 (]: Began running node model.rightmove_epc.address_match
[0m11:48:22.967260 [debug] [Thread-1 (]: Began running node model.rightmove_epc.address_simularity
[0m11:48:22.967623 [info ] [Thread-3 (]: 6 of 11 START sql view model dbt_melissa_rm_epc.address_match .................. [RUN]
[0m11:48:22.967949 [info ] [Thread-1 (]: 7 of 11 START sql view model dbt_melissa_rm_epc.address_simularity ............. [RUN]
[0m11:48:22.968531 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.dim_uprn, now model.rightmove_epc.address_match)
[0m11:48:22.969082 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_epc_certs, now model.rightmove_epc.address_simularity)
[0m11:48:22.969483 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.uprn_match (compile): 11:48:22.963560 => 11:48:22.969315
[0m11:48:22.969738 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.address_match
[0m11:48:22.970037 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.address_simularity
[0m11:48:22.970346 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.uprn_match
[0m11:48:22.972776 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.address_match"
[0m11:48:22.974808 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.address_simularity"
[0m11:48:22.978368 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.uprn_match"
[0m11:48:22.979967 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.uprn_match"
[0m11:48:22.980276 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.address_simularity (compile): 11:48:22.973007 => 11:48:22.980136
[0m11:48:22.980519 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.address_match (compile): 11:48:22.970532 => 11:48:22.980404
[0m11:48:22.980767 [debug] [Thread-2 (]: On model.rightmove_epc.uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NOT NULL
),

change_date AS (
    SELECT 
        UPRN AS UPRN_CD, 
        MAX(CHANGE_DATE) AS MAX_CHANGE_DATE 
    FROM rm
    GROUP BY UPRN
),

rm_latest as (

    SELECT * FROM rm
    LEFT JOIN change_date cd
    ON rm.UPRN = cd.UPRN_CD
    WHERE cd.MAX_CHANGE_DATE = rm.CHANGE_DATE ),

epc_uprn as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
    where datasource = 'EPC'
)


SELECT rm_latest.*,
CASE WHEN epc_uprn.UPRN is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_uprn.UPRN AS EPC_UPRN,
epc_uprn.ADDRESSID AS EPC_ADDRESSID


FROM rm_latest
LEFT JOIN epc_uprn
ON rm_latest.UPRN = epc_uprn.UPRN

WHERE MATCH_EPC = 'YES'
  );
[0m11:48:22.981065 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.address_simularity
[0m11:48:22.981312 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.address_match
[0m11:48:22.981562 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m11:48:22.983644 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.address_simularity"
[0m11:48:22.985576 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.address_match"
[0m11:48:22.987049 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.address_simularity"
[0m11:48:22.987642 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.address_match"
[0m11:48:22.987889 [debug] [Thread-1 (]: On model.rightmove_epc.address_simularity: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.address_simularity"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.address_simularity
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NULL
),

epc_address as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
    where datasource = 'EPC'
)


SELECT rm.*,epc_address.addressid as EPC_ADDRESSID
FROM rm
JOIN epc_address
ON JAROWINKLER_SIMILARITY(rm.addressid, epc_address.addressid) = 1
  );
[0m11:48:22.988165 [debug] [Thread-3 (]: On model.rightmove_epc.address_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.address_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NULL
),

epc_address as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
    where datasource = 'EPC'
)


SELECT rm.*,
CASE WHEN epc_address.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_address.ADDRESSID AS EPC_ADDRESSID


FROM rm
LEFT JOIN epc_address
ON rm.addressid = epc_address.addressid
and rm.FULL_POSTCODE = epc_address.POSTCODE
  );
[0m11:48:22.988432 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:48:22.988653 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m11:48:23.639312 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m11:48:23.640944 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m11:48:23.645321 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.address_simularity (execute): 11:48:22.981725 => 11:48:23.644993
[0m11:48:23.646338 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m11:48:23.649229 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.address_match (execute): 11:48:22.983815 => 11:48:23.649009
[0m11:48:23.649697 [debug] [Thread-1 (]: On model.rightmove_epc.address_simularity: Close
[0m11:48:23.652251 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.uprn_match (execute): 11:48:22.975033 => 11:48:23.652046
[0m11:48:23.652746 [debug] [Thread-3 (]: On model.rightmove_epc.address_match: Close
[0m11:48:23.654251 [debug] [Thread-2 (]: On model.rightmove_epc.uprn_match: Close
[0m11:48:23.734236 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c8c3ceec-7f05-47a0-ade6-59af29d1dfa1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b68ca90>]}
[0m11:48:23.734903 [info ] [Thread-1 (]: 7 of 11 OK created sql view model dbt_melissa_rm_epc.address_simularity ........ [[32mSUCCESS 1[0m in 0.77s]
[0m11:48:23.735432 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.address_simularity
[0m11:48:23.738150 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c8c3ceec-7f05-47a0-ade6-59af29d1dfa1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a3e8a50>]}
[0m11:48:23.738775 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c8c3ceec-7f05-47a0-ade6-59af29d1dfa1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a67c390>]}
[0m11:48:23.739226 [info ] [Thread-3 (]: 6 of 11 OK created sql view model dbt_melissa_rm_epc.address_match ............. [[32mSUCCESS 1[0m in 0.77s]
[0m11:48:23.739714 [info ] [Thread-2 (]: 5 of 11 OK created sql view model dbt_melissa_rm_epc.uprn_match ................ [[32mSUCCESS 1[0m in 0.78s]
[0m11:48:23.740272 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.address_match
[0m11:48:23.740706 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.uprn_match
[0m11:48:23.741464 [debug] [Thread-4 (]: Began running node model.rightmove_epc.all_matches
[0m11:48:23.741795 [debug] [Thread-1 (]: Began running node model.rightmove_epc.houses_report
[0m11:48:23.742138 [info ] [Thread-4 (]: 8 of 11 START sql view model dbt_melissa_rm_epc.all_matches .................... [RUN]
[0m11:48:23.742483 [debug] [Thread-3 (]: Began running node model.rightmove_epc.no_matches
[0m11:48:23.742809 [debug] [Thread-2 (]: Began running node model.rightmove_epc.no_uprn_match
[0m11:48:23.743137 [info ] [Thread-1 (]: 9 of 11 START sql view model dbt_melissa_rm_epc.houses_report .................. [RUN]
[0m11:48:23.743723 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.dim_addressid, now model.rightmove_epc.all_matches)
[0m11:48:23.744175 [info ] [Thread-3 (]: 10 of 11 START sql view model dbt_melissa_rm_epc.no_matches .................... [RUN]
[0m11:48:23.744625 [info ] [Thread-2 (]: 11 of 11 START sql view model dbt_melissa_rm_epc.no_uprn_match ................. [RUN]
[0m11:48:23.745158 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.address_simularity, now model.rightmove_epc.houses_report)
[0m11:48:23.745433 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.all_matches
[0m11:48:23.745861 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.address_match, now model.rightmove_epc.no_matches)
[0m11:48:23.746274 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.uprn_match, now model.rightmove_epc.no_uprn_match)
[0m11:48:23.746532 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.houses_report
[0m11:48:23.747419 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.no_matches
[0m11:48:23.750035 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.all_matches"
[0m11:48:23.750316 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.no_uprn_match
[0m11:48:23.752843 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.houses_report"
[0m11:48:23.754803 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.no_matches"
[0m11:48:23.757205 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.no_uprn_match"
[0m11:48:23.757746 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.all_matches (compile): 11:48:23.746695 => 11:48:23.757572
[0m11:48:23.758153 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.all_matches
[0m11:48:23.758460 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.houses_report (compile): 11:48:23.750543 => 11:48:23.758316
[0m11:48:23.760648 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.all_matches"
[0m11:48:23.760934 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.houses_report
[0m11:48:23.761197 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.no_uprn_match (compile): 11:48:23.755097 => 11:48:23.761074
[0m11:48:23.761497 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.no_matches (compile): 11:48:23.753062 => 11:48:23.761388
[0m11:48:23.763312 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.houses_report"
[0m11:48:23.764161 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.all_matches"
[0m11:48:23.764447 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.no_uprn_match
[0m11:48:23.764711 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.no_matches
[0m11:48:23.765160 [debug] [Thread-4 (]: On model.rightmove_epc.all_matches: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.all_matches"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.all_matches
  
   as (
    with addr as (

    select 
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    '' AS EPC_UPRN,
    EPC_ADDRESSID
    
    from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
    where MATCH_EPC = 'YES' 
),

uprn as (

    select 
    
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN::VARCHAR AS EPC_UPRN,
    EPC_ADDRESSID
     from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'YES'
),

final as (

select 'ADDRESS AND POSTCODE MATCH' AS MATCH_RESULT, * from addr
union all
select 'UPRN MATCH' AS MATCH_RESULT, * from uprn
)

select * from final
  );
[0m11:48:23.767272 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.no_uprn_match"
[0m11:48:23.769706 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.houses_report"
[0m11:48:23.771644 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.no_matches"
[0m11:48:23.771972 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m11:48:23.772403 [debug] [Thread-1 (]: On model.rightmove_epc.houses_report: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.houses_report"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.houses_report
  
   as (
    with house_addmatch as (

    select 
    distinct
    --count(LISTING_ID) as TOTAL_LISTINGS,
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN, -- NULL
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
--    BEDROOM,
 --   am.FLOOR_LEVEL as RM_FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.*

     from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc on am.EPC_ADDRESSID = epc.ADDRESSID
    and am.FULL_POSTCODE = epc.POSTCODE
    where MATCH_EPC = 'YES'
    and COMBINED_PROPERTY_TYPE not in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')

),

house_uprnmatch as (

    select 
    distinct
    --count(LISTING_ID) as TOTAL_LISTINGS,
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN, -- NULL
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
 --   BEDROOM,
  --  am.FLOOR_LEVEL as RM_FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.* -- remove uprn source
    

    from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc on am.EPC_UPRN = epc.UPRN

    where MATCH_EPC = 'YES'
   and COMBINED_PROPERTY_TYPE not in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')
   AND RM_UPRN = 10008798499

)

select * from house_uprnmatch

/*
--THIS IS USED FOR A TEST
select RM_UPRN,COUNT(BUILDING_REFERENCE_NUMBER)
from house_uprnmatch
WHERE RM_UPRN IS NOT NULL
GROUP BY 1
HAVING COUNT(BUILDING_REFERENCE_NUMBER) >1
*/
  );
[0m11:48:23.773058 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.no_uprn_match"
[0m11:48:23.773708 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:48:23.774203 [debug] [Thread-2 (]: On model.rightmove_epc.no_uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.no_uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.no_uprn_match
  
   as (
    with rm_no_match_to_epc  as ( -- rightmove uspn does not match epc

    select *

     from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'NO'
    
)

select * from rm_no_match_to_epc

/*
epc_remove as (

    select EPC_UPRN,EPC_ADDRESSID from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'YES'  -- 
),

epc_matched as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs src
    left join epc_remove rem on src.UPRN = rem.EPC_UPRN
    
),

epc_fm_prep as (

    select * from epc_matched
    where EPC_UPRN is NULL

    
)


SELECT * FROM epc_fm_prep
WHERE UPRN NOT NULL */
  );
[0m11:48:23.774947 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.no_matches"
[0m11:48:23.775443 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m11:48:23.775875 [debug] [Thread-3 (]: On model.rightmove_epc.no_matches: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.no_matches"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.no_matches
  
   as (
    with addr as (

    select 
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    '' AS EPC_UPRN,
    EPC_ADDRESSID
    
    from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
    where MATCH_EPC = 'NO' 
),

uprn as (

    select 
    
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN::VARCHAR AS EPC_UPRN,
    EPC_ADDRESSID
    
     from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'NO'
),

final as (

select 'NO ADDRESS OR UPRN MATCH' AS MATCH_RESULT, * from addr
union all
select 'NO UPRN MATCH' AS MATCH_RESULT, * from uprn
)

select * from final
  );
[0m11:48:23.776781 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m11:48:24.300063 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b34464-0103-9b63-0000-7195063755e2
[0m11:48:24.300517 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 002025 (42S21): SQL compilation error:
duplicate column name 'LOCAL_AUTHORITY_CODE'
[0m11:48:24.300995 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.houses_report (execute): 11:48:23.761649 => 11:48:24.300822
[0m11:48:24.301319 [debug] [Thread-1 (]: On model.rightmove_epc.houses_report: Close
[0m11:48:24.376886 [debug] [Thread-1 (]: Database Error in model houses_report (models/reports/houses_report.sql)
  002025 (42S21): SQL compilation error:
  duplicate column name 'LOCAL_AUTHORITY_CODE'
  compiled Code at target/run/rightmove_epc/models/reports/houses_report.sql
[0m11:48:24.377767 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c8c3ceec-7f05-47a0-ade6-59af29d1dfa1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b58e290>]}
[0m11:48:24.378470 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m11:48:24.381597 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.no_uprn_match (execute): 11:48:23.765437 => 11:48:24.381417
[0m11:48:24.379101 [error] [Thread-1 (]: 9 of 11 ERROR creating sql view model dbt_melissa_rm_epc.houses_report ......... [[31mERROR[0m in 0.63s]
[0m11:48:24.382005 [debug] [Thread-2 (]: On model.rightmove_epc.no_uprn_match: Close
[0m11:48:24.382434 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.houses_report
[0m11:48:24.416959 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m11:48:24.419580 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.no_matches (execute): 11:48:23.769924 => 11:48:24.419430
[0m11:48:24.419923 [debug] [Thread-3 (]: On model.rightmove_epc.no_matches: Close
[0m11:48:24.449765 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m11:48:24.451863 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.all_matches (execute): 11:48:23.758630 => 11:48:24.451699
[0m11:48:24.452171 [debug] [Thread-4 (]: On model.rightmove_epc.all_matches: Close
[0m11:48:24.460315 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c8c3ceec-7f05-47a0-ade6-59af29d1dfa1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10aa66010>]}
[0m11:48:24.461783 [info ] [Thread-2 (]: 11 of 11 OK created sql view model dbt_melissa_rm_epc.no_uprn_match ............ [[32mSUCCESS 1[0m in 0.71s]
[0m11:48:24.462200 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.no_uprn_match
[0m11:48:24.488721 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c8c3ceec-7f05-47a0-ade6-59af29d1dfa1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a6e9910>]}
[0m11:48:24.489383 [info ] [Thread-3 (]: 10 of 11 OK created sql view model dbt_melissa_rm_epc.no_matches ............... [[32mSUCCESS 1[0m in 0.74s]
[0m11:48:24.489828 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.no_matches
[0m11:48:24.525237 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c8c3ceec-7f05-47a0-ade6-59af29d1dfa1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b525dd0>]}
[0m11:48:24.525805 [info ] [Thread-4 (]: 8 of 11 OK created sql view model dbt_melissa_rm_epc.all_matches ............... [[32mSUCCESS 1[0m in 0.78s]
[0m11:48:24.526222 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.all_matches
[0m11:48:24.527518 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:48:24.527726 [debug] [MainThread]: Connection 'model.rightmove_epc.houses_report' was properly closed.
[0m11:48:24.527901 [debug] [MainThread]: Connection 'model.rightmove_epc.no_uprn_match' was properly closed.
[0m11:48:24.528065 [debug] [MainThread]: Connection 'model.rightmove_epc.all_matches' was properly closed.
[0m11:48:24.528227 [debug] [MainThread]: Connection 'model.rightmove_epc.no_matches' was properly closed.
[0m11:48:24.528449 [info ] [MainThread]: 
[0m11:48:24.528653 [info ] [MainThread]: Finished running 11 view models in 0 hours 0 minutes and 3.95 seconds (3.95s).
[0m11:48:24.529671 [debug] [MainThread]: Command end result
[0m11:48:24.537605 [info ] [MainThread]: 
[0m11:48:24.537893 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m11:48:24.538073 [info ] [MainThread]: 
[0m11:48:24.538262 [error] [MainThread]:   Database Error in model houses_report (models/reports/houses_report.sql)
  002025 (42S21): SQL compilation error:
  duplicate column name 'LOCAL_AUTHORITY_CODE'
  compiled Code at target/run/rightmove_epc/models/reports/houses_report.sql
[0m11:48:24.538450 [info ] [MainThread]: 
[0m11:48:24.538633 [info ] [MainThread]: Done. PASS=10 WARN=0 ERROR=1 SKIP=0 TOTAL=11
[0m11:48:24.540487 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 4.3350177, "process_user_time": 1.56066, "process_kernel_time": 0.203988, "process_mem_max_rss": "133939200", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m11:48:24.540792 [debug] [MainThread]: Command `dbt run` failed at 11:48:24.540725 after 4.34 seconds
[0m11:48:24.541026 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104cbdd50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104b82110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104b82190>]}
[0m11:48:24.541242 [debug] [MainThread]: Flushing usage events
[0m11:51:35.625023 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1059809d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106a6a7d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106a76e90>]}


============================== 11:51:35.627967 | f01ef7f0-6401-453c-80cb-f6c02a5ac191 ==============================
[0m11:51:35.627967 [info ] [MainThread]: Running with dbt=1.7.10
[0m11:51:35.628312 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select models/reports', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m11:51:35.801348 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f01ef7f0-6401-453c-80cb-f6c02a5ac191', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1073f96d0>]}
[0m11:51:35.834908 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f01ef7f0-6401-453c-80cb-f6c02a5ac191', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106aad650>]}
[0m11:51:35.835425 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m11:51:35.844472 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m11:51:35.871231 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:51:35.871515 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:51:35.874844 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f01ef7f0-6401-453c-80cb-f6c02a5ac191', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1075c3550>]}
[0m11:51:35.881247 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f01ef7f0-6401-453c-80cb-f6c02a5ac191', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10724a150>]}
[0m11:51:35.881546 [info ] [MainThread]: Found 11 models, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m11:51:35.881758 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f01ef7f0-6401-453c-80cb-f6c02a5ac191', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1073e3390>]}
[0m11:51:35.882818 [info ] [MainThread]: 
[0m11:51:35.883260 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m11:51:35.883865 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m11:51:35.890338 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m11:51:35.890582 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m11:51:35.890731 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:51:36.324771 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 0.0 seconds
[0m11:51:36.327171 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m11:51:36.419570 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m11:51:36.426359 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m11:51:36.426656 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m11:51:36.426889 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:51:36.762744 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 0.0 seconds
[0m11:51:36.764917 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m11:51:36.867219 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f01ef7f0-6401-453c-80cb-f6c02a5ac191', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107390390>]}
[0m11:51:36.868100 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:51:36.868433 [info ] [MainThread]: 
[0m11:51:36.871674 [debug] [Thread-1 (]: Began running node model.rightmove_epc.houses_report
[0m11:51:36.872165 [info ] [Thread-1 (]: 1 of 1 START sql view model dbt_melissa_rm_epc.houses_report ................... [RUN]
[0m11:51:36.872834 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.houses_report)
[0m11:51:36.873172 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.houses_report
[0m11:51:36.880159 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.houses_report"
[0m11:51:36.881119 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.houses_report (compile): 11:51:36.873384 => 11:51:36.880938
[0m11:51:36.881434 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.houses_report
[0m11:51:36.932660 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.houses_report"
[0m11:51:36.933893 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.houses_report"
[0m11:51:36.934143 [debug] [Thread-1 (]: On model.rightmove_epc.houses_report: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.houses_report"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.houses_report
  
   as (
    with house_addmatch as (

    select 
    distinct
    --count(LISTING_ID) as TOTAL_LISTINGS,
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN, -- NULL
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
 --   am.FLOOR_LEVEL as RM_FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.*

     from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc on am.EPC_ADDRESSID = epc.ADDRESSID
    and am.FULL_POSTCODE = epc.POSTCODE
    where MATCH_EPC = 'YES'
    and COMBINED_PROPERTY_TYPE not in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')

),

house_uprnmatch as (

    select 
    distinct
    --count(LISTING_ID) as TOTAL_LISTINGS,
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN, -- NULL
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
  --  am.FLOOR_LEVEL as RM_FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.* -- remove uprn source
    

    from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc on am.EPC_UPRN = epc.UPRN

    where MATCH_EPC = 'YES'
   and COMBINED_PROPERTY_TYPE not in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')
  -- AND RM_UPRN = 100030719363

)


select * from house_uprnmatch

/*
--THIS IS USED FOR A TEST
select RM_UPRN,COUNT(BUILDING_REFERENCE_NUMBER)
from house_uprnmatch
WHERE RM_UPRN IS NOT NULL
GROUP BY 1
HAVING COUNT(BUILDING_REFERENCE_NUMBER) >1
*/
  );
[0m11:51:36.934395 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:51:37.407754 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b34467-0103-9b63-0000-71950637562e
[0m11:51:37.408305 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 002025 (42S21): SQL compilation error:
duplicate column name 'LOCAL_AUTHORITY_CODE'
[0m11:51:37.408929 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.houses_report (execute): 11:51:36.881590 => 11:51:37.408693
[0m11:51:37.409358 [debug] [Thread-1 (]: On model.rightmove_epc.houses_report: Close
[0m11:51:37.511966 [debug] [Thread-1 (]: Database Error in model houses_report (models/reports/houses_report.sql)
  002025 (42S21): SQL compilation error:
  duplicate column name 'LOCAL_AUTHORITY_CODE'
  compiled Code at target/run/rightmove_epc/models/reports/houses_report.sql
[0m11:51:37.512666 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f01ef7f0-6401-453c-80cb-f6c02a5ac191', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1073a9d50>]}
[0m11:51:37.513367 [error] [Thread-1 (]: 1 of 1 ERROR creating sql view model dbt_melissa_rm_epc.houses_report .......... [[31mERROR[0m in 0.64s]
[0m11:51:37.514023 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.houses_report
[0m11:51:37.515810 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:51:37.516108 [debug] [MainThread]: Connection 'model.rightmove_epc.houses_report' was properly closed.
[0m11:51:37.516401 [info ] [MainThread]: 
[0m11:51:37.516695 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 1.63 seconds (1.63s).
[0m11:51:37.517235 [debug] [MainThread]: Command end result
[0m11:51:37.525206 [info ] [MainThread]: 
[0m11:51:37.525619 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m11:51:37.525893 [info ] [MainThread]: 
[0m11:51:37.526155 [error] [MainThread]:   Database Error in model houses_report (models/reports/houses_report.sql)
  002025 (42S21): SQL compilation error:
  duplicate column name 'LOCAL_AUTHORITY_CODE'
  compiled Code at target/run/rightmove_epc/models/reports/houses_report.sql
[0m11:51:37.526410 [info ] [MainThread]: 
[0m11:51:37.526670 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m11:51:37.528693 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 1.9324023, "process_user_time": 1.153372, "process_kernel_time": 0.157146, "process_mem_max_rss": "134840320", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m11:51:37.529180 [debug] [MainThread]: Command `dbt run` failed at 11:51:37.529085 after 1.93 seconds
[0m11:51:37.529498 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106a9f2d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106a9f410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1058d4d10>]}
[0m11:51:37.529787 [debug] [MainThread]: Flushing usage events
[0m11:55:42.587546 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105418bd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10545e810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10545f390>]}


============================== 11:55:42.590135 | f8f1482d-2d67-4170-af56-b7a0a695a9f1 ==============================
[0m11:55:42.590135 [info ] [MainThread]: Running with dbt=1.7.10
[0m11:55:42.590456 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run --select models/reports', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m11:55:42.771168 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f8f1482d-2d67-4170-af56-b7a0a695a9f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105f58690>]}
[0m11:55:42.805168 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f8f1482d-2d67-4170-af56-b7a0a695a9f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10357ef50>]}
[0m11:55:42.806692 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m11:55:42.815786 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m11:55:42.841986 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:55:42.842241 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:55:42.845435 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f8f1482d-2d67-4170-af56-b7a0a695a9f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1068e5f50>]}
[0m11:55:42.851575 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f8f1482d-2d67-4170-af56-b7a0a695a9f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1069b09d0>]}
[0m11:55:42.851840 [info ] [MainThread]: Found 11 models, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m11:55:42.852027 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f8f1482d-2d67-4170-af56-b7a0a695a9f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106a14090>]}
[0m11:55:42.852951 [info ] [MainThread]: 
[0m11:55:42.853343 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m11:55:42.853869 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m11:55:42.859965 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m11:55:42.860310 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m11:55:42.860478 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:55:43.321711 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 0.0 seconds
[0m11:55:43.324569 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m11:55:43.408716 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m11:55:43.416425 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m11:55:43.416760 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m11:55:43.417021 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:55:43.883814 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 0.0 seconds
[0m11:55:43.885748 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m11:55:43.980521 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f8f1482d-2d67-4170-af56-b7a0a695a9f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10699f750>]}
[0m11:55:43.981848 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:55:43.982306 [info ] [MainThread]: 
[0m11:55:43.986979 [debug] [Thread-1 (]: Began running node model.rightmove_epc.houses_report
[0m11:55:43.987578 [info ] [Thread-1 (]: 1 of 1 START sql view model dbt_melissa_rm_epc.houses_report ................... [RUN]
[0m11:55:43.988342 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.houses_report)
[0m11:55:43.988719 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.houses_report
[0m11:55:43.996370 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.houses_report"
[0m11:55:43.997400 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.houses_report (compile): 11:55:43.988949 => 11:55:43.997107
[0m11:55:43.997771 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.houses_report
[0m11:55:44.049168 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.houses_report"
[0m11:55:44.050701 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.houses_report"
[0m11:55:44.050977 [debug] [Thread-1 (]: On model.rightmove_epc.houses_report: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.houses_report"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.houses_report
  
   as (
    with house_addmatch as (

    select 
    distinct
    --count(LISTING_ID) as TOTAL_LISTINGS,
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN, -- NULL
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
 --   am.FLOOR_LEVEL as RM_FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    COUNTY,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    epc.ADDRESSID AS EPC_ADDRESSID,
    -- REMOVE_FROM_RM_MATCH,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

     from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc on am.EPC_ADDRESSID = epc.ADDRESSID
    and am.FULL_POSTCODE = epc.POSTCODE
    where MATCH_EPC = 'YES'
    and COMBINED_PROPERTY_TYPE not in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')

),

house_uprnmatch as (

    select 
    distinct
    --count(LISTING_ID) as TOTAL_LISTINGS,
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN, -- NULL
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
  --  am.FLOOR_LEVEL as RM_FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    COUNTY,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    epc.ADDRESSID AS EPC_ADDRESSID,
    -- REMOVE_FROM_RM_MATCH,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

    

    from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc on am.EPC_UPRN = epc.UPRN

    where MATCH_EPC = 'YES'
   and COMBINED_PROPERTY_TYPE not in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')
  -- AND RM_UPRN = 100030719363

)


select 'UPRN' as MATCH_TYPE, * from house_uprnmatch

union all

select 'ADDRESSID' as MATCH_TYPE, * from house_addmatch

/*
--THIS IS USED FOR A TEST
select RM_UPRN,COUNT(BUILDING_REFERENCE_NUMBER)
from house_uprnmatch
WHERE RM_UPRN IS NOT NULL
GROUP BY 1
HAVING COUNT(BUILDING_REFERENCE_NUMBER) >1
*/
  );
[0m11:55:44.051222 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:55:44.882144 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m11:55:44.901864 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.houses_report (execute): 11:55:43.997957 => 11:55:44.901689
[0m11:55:44.902211 [debug] [Thread-1 (]: On model.rightmove_epc.houses_report: Close
[0m11:55:45.004326 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f8f1482d-2d67-4170-af56-b7a0a695a9f1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1069df490>]}
[0m11:55:45.005108 [info ] [Thread-1 (]: 1 of 1 OK created sql view model dbt_melissa_rm_epc.houses_report .............. [[32mSUCCESS 1[0m in 1.02s]
[0m11:55:45.005672 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.houses_report
[0m11:55:45.007170 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:55:45.007457 [debug] [MainThread]: Connection 'model.rightmove_epc.houses_report' was properly closed.
[0m11:55:45.007750 [info ] [MainThread]: 
[0m11:55:45.008044 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 2.15 seconds (2.15s).
[0m11:55:45.008575 [debug] [MainThread]: Command end result
[0m11:55:45.015857 [info ] [MainThread]: 
[0m11:55:45.016200 [info ] [MainThread]: [32mCompleted successfully[0m
[0m11:55:45.016433 [info ] [MainThread]: 
[0m11:55:45.016669 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m11:55:45.018625 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 2.4567094, "process_user_time": 1.178364, "process_kernel_time": 0.15933, "process_mem_max_rss": "132644864", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m11:55:45.019118 [debug] [MainThread]: Command `dbt run` succeeded at 11:55:45.019015 after 2.46 seconds
[0m11:55:45.019438 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10545cc90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100852210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1051d4c90>]}
[0m11:55:45.019731 [debug] [MainThread]: Flushing usage events
[0m12:07:27.481867 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1093f30d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1093a2710>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1093f2750>]}


============================== 12:07:27.485343 | fba9907e-a874-4c73-8661-2ec5cb083f23 ==============================
[0m12:07:27.485343 [info ] [MainThread]: Running with dbt=1.7.10
[0m12:07:27.485723 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select models/staging', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m12:07:27.660805 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fba9907e-a874-4c73-8661-2ec5cb083f23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109448090>]}
[0m12:07:27.694814 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'fba9907e-a874-4c73-8661-2ec5cb083f23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109da43d0>]}
[0m12:07:27.695445 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m12:07:27.704679 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m12:07:27.720643 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m12:07:27.720923 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m12:07:27.724071 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'fba9907e-a874-4c73-8661-2ec5cb083f23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109e87a50>]}
[0m12:07:27.730209 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'fba9907e-a874-4c73-8661-2ec5cb083f23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1093fc890>]}
[0m12:07:27.730451 [info ] [MainThread]: Found 11 models, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m12:07:27.730639 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fba9907e-a874-4c73-8661-2ec5cb083f23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1093f3a10>]}
[0m12:07:27.731575 [info ] [MainThread]: 
[0m12:07:27.731957 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m12:07:27.732491 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m12:07:27.738804 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m12:07:27.739065 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m12:07:27.739243 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:07:28.370522 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 1.0 seconds
[0m12:07:28.371899 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m12:07:28.455848 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m12:07:28.462277 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m12:07:28.462538 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m12:07:28.462745 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:07:28.854057 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 0.0 seconds
[0m12:07:28.855348 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m12:07:28.949252 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fba9907e-a874-4c73-8661-2ec5cb083f23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109d19610>]}
[0m12:07:28.950000 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m12:07:28.950267 [info ] [MainThread]: 
[0m12:07:28.953307 [debug] [Thread-1 (]: Began running node model.rightmove_epc.stg_epc_certs
[0m12:07:28.953602 [debug] [Thread-2 (]: Began running node model.rightmove_epc.stg_rightmove
[0m12:07:28.953945 [info ] [Thread-1 (]: 1 of 2 START sql view model dbt_melissa_rm_epc.stg_epc_certs ................... [RUN]
[0m12:07:28.954271 [info ] [Thread-2 (]: 2 of 2 START sql view model dbt_melissa_rm_epc.stg_rightmove ................... [RUN]
[0m12:07:28.954745 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.stg_epc_certs)
[0m12:07:28.955200 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.stg_rightmove'
[0m12:07:28.955437 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.stg_epc_certs
[0m12:07:28.955657 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.stg_rightmove
[0m12:07:28.960953 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.stg_epc_certs"
[0m12:07:28.962778 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.stg_rightmove"
[0m12:07:28.964271 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (compile): 12:07:28.955830 => 12:07:28.964099
[0m12:07:28.964539 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (compile): 12:07:28.961143 => 12:07:28.964411
[0m12:07:28.964763 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.stg_epc_certs
[0m12:07:28.964968 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.stg_rightmove
[0m12:07:29.014242 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.stg_rightmove"
[0m12:07:29.014648 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.stg_epc_certs"
[0m12:07:29.015430 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.stg_rightmove"
[0m12:07:29.015639 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_rightmove"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
  
   as (
    with rm as (

    SELECT 
    LISTING_ID,
    CHANGE_DATE,
    UPPER(TRIM(replace(REPLACE(CONCAT(ADDRESS_1::VARCHAR,ADDRESS_2::VARCHAR),' '),','))) AS ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, 
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    BEDROOM,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    STUDENTLET_FLAG,
    COMBINED_PROPERTY_TYPE
    -- property type
    FROM 
       ANALYTICS.RIGHTMOVE_PROD.CLEAN_RAW_RIGHTMOVE_DATA 

 
)

SELECT * FROM rm
  );
[0m12:07:29.015848 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m12:07:29.016734 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.stg_epc_certs"
[0m12:07:29.017148 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_epc_certs"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
  
   as (
    WITH epc_certs as (
    
    select 
    UPRN,
    LODGEMENT_DATE,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    COUNTY,
    LOCAL_AUTHORITY as LOCAL_AUTHORITY_CODE,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    UPPER(CASE WHEN (UPPER(ADDRESS1) LIKE 'FLAT%' OR UPPER(ADDRESS1) LIKE 'UNIT%') or UPPER(ADDRESS1) LIKE 'ROOM%' 
    THEN TRIM(REPLACE(REPLACE(CONCAT(ADDRESS),','),' '))
    ELSE trim(replace(replace(ADDRESS1,' '),',')) END) AS ADDRESSID,
    CASE WHEN UPRN is null and addressid is null THEN 1 else 0 end as REMOVE_FROM_RM_MATCH,
    FLOOR_LEVEL,
    FLAT_TOP_STOREY,
    FLAT_STOREY_COUNT,
    PROPERTY_TYPE
 from  RAW.EPC_TEST_DATA.EPC_CERTIFICATES 

)

SELECT * FROM epc_certs
  );
[0m12:07:29.017374 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:07:29.804784 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:07:29.805370 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:07:29.818907 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (execute): 12:07:28.965094 => 12:07:29.818760
[0m12:07:29.820512 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (execute): 12:07:29.009659 => 12:07:29.820394
[0m12:07:29.820774 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: Close
[0m12:07:29.820997 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: Close
[0m12:07:29.896371 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fba9907e-a874-4c73-8661-2ec5cb083f23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109d8e510>]}
[0m12:07:29.896942 [info ] [Thread-2 (]: 2 of 2 OK created sql view model dbt_melissa_rm_epc.stg_rightmove .............. [[32mSUCCESS 1[0m in 0.94s]
[0m12:07:29.897310 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.stg_rightmove
[0m12:07:29.925796 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fba9907e-a874-4c73-8661-2ec5cb083f23', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109f6fed0>]}
[0m12:07:29.926274 [info ] [Thread-1 (]: 1 of 2 OK created sql view model dbt_melissa_rm_epc.stg_epc_certs .............. [[32mSUCCESS 1[0m in 0.97s]
[0m12:07:29.926604 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.stg_epc_certs
[0m12:07:29.927743 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:07:29.927931 [debug] [MainThread]: Connection 'model.rightmove_epc.stg_epc_certs' was properly closed.
[0m12:07:29.928078 [debug] [MainThread]: Connection 'model.rightmove_epc.stg_rightmove' was properly closed.
[0m12:07:29.928254 [info ] [MainThread]: 
[0m12:07:29.928429 [info ] [MainThread]: Finished running 2 view models in 0 hours 0 minutes and 2.20 seconds (2.20s).
[0m12:07:29.928826 [debug] [MainThread]: Command end result
[0m12:07:29.934497 [info ] [MainThread]: 
[0m12:07:29.934801 [info ] [MainThread]: [32mCompleted successfully[0m
[0m12:07:29.934976 [info ] [MainThread]: 
[0m12:07:29.935172 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m12:07:29.937149 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 2.486988, "process_user_time": 1.154952, "process_kernel_time": 0.166758, "process_mem_max_rss": "135626752", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m12:07:29.937527 [debug] [MainThread]: Command `dbt run` succeeded at 12:07:29.937455 after 2.49 seconds
[0m12:07:29.937765 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10554e210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1056a2010>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1056a2150>]}
[0m12:07:29.937991 [debug] [MainThread]: Flushing usage events
[0m12:09:29.333145 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105a18c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105a527d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1044171d0>]}


============================== 12:09:29.335917 | 72e08101-08dd-47b9-90f1-dae067584355 ==============================
[0m12:09:29.335917 [info ] [MainThread]: Running with dbt=1.7.10
[0m12:09:29.336236 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt run', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m12:09:29.516727 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '72e08101-08dd-47b9-90f1-dae067584355', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1064a7010>]}
[0m12:09:29.550604 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '72e08101-08dd-47b9-90f1-dae067584355', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1063e1550>]}
[0m12:09:29.551258 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m12:09:29.560442 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m12:09:29.577465 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m12:09:29.577775 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m12:09:29.581301 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '72e08101-08dd-47b9-90f1-dae067584355', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1064b1350>]}
[0m12:09:29.589253 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '72e08101-08dd-47b9-90f1-dae067584355', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105a94290>]}
[0m12:09:29.589546 [info ] [MainThread]: Found 11 models, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m12:09:29.589731 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '72e08101-08dd-47b9-90f1-dae067584355', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10633bb50>]}
[0m12:09:29.590790 [info ] [MainThread]: 
[0m12:09:29.591232 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m12:09:29.591979 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m12:09:29.598229 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m12:09:29.598450 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m12:09:29.598595 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:09:30.166104 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 1.0 seconds
[0m12:09:30.169323 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m12:09:30.250206 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m12:09:30.258638 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m12:09:30.259010 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m12:09:30.259281 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:09:30.688877 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 0.0 seconds
[0m12:09:30.691535 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m12:09:30.782857 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '72e08101-08dd-47b9-90f1-dae067584355', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10659d0d0>]}
[0m12:09:30.783885 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m12:09:30.784299 [info ] [MainThread]: 
[0m12:09:30.787638 [debug] [Thread-1 (]: Began running node model.rightmove_epc.stg_epc_certs
[0m12:09:30.788009 [debug] [Thread-2 (]: Began running node model.rightmove_epc.stg_rightmove
[0m12:09:30.788478 [info ] [Thread-1 (]: 1 of 11 START sql view model dbt_melissa_rm_epc.stg_epc_certs .................. [RUN]
[0m12:09:30.788916 [info ] [Thread-2 (]: 2 of 11 START sql view model dbt_melissa_rm_epc.stg_rightmove .................. [RUN]
[0m12:09:30.789571 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.stg_epc_certs)
[0m12:09:30.790239 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.stg_rightmove'
[0m12:09:30.790598 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.stg_epc_certs
[0m12:09:30.790914 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.stg_rightmove
[0m12:09:30.797708 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.stg_epc_certs"
[0m12:09:30.800198 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.stg_rightmove"
[0m12:09:30.801359 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (compile): 12:09:30.798038 => 12:09:30.801109
[0m12:09:30.801713 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (compile): 12:09:30.791122 => 12:09:30.801548
[0m12:09:30.801984 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.stg_rightmove
[0m12:09:30.802243 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.stg_epc_certs
[0m12:09:30.853756 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.stg_rightmove"
[0m12:09:30.855428 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.stg_epc_certs"
[0m12:09:30.856182 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.stg_rightmove"
[0m12:09:30.856749 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.stg_epc_certs"
[0m12:09:30.856960 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_rightmove"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
  
   as (
    with rm as (

    SELECT 
    LISTING_ID,
    CHANGE_DATE,
    UPPER(TRIM(replace(REPLACE(CONCAT(ADDRESS_1::VARCHAR,ADDRESS_2::VARCHAR),' '),','))) AS ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, 
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    BEDROOM,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    STUDENTLET_FLAG,
    COMBINED_PROPERTY_TYPE
    -- property type
    FROM 
       ANALYTICS.RIGHTMOVE_PROD.CLEAN_RAW_RIGHTMOVE_DATA 

 
)

SELECT * FROM rm
  );
[0m12:09:30.857188 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_epc_certs"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
  
   as (
    WITH epc_certs as (
    
    select 
    UPRN,
    LODGEMENT_DATE,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    COUNTY,
    LOCAL_AUTHORITY as LOCAL_AUTHORITY_CODE,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    UPPER(CASE WHEN (UPPER(ADDRESS1) LIKE 'FLAT%' OR UPPER(ADDRESS1) LIKE 'UNIT%') or UPPER(ADDRESS1) LIKE 'ROOM%' 
    THEN TRIM(REPLACE(REPLACE(CONCAT(ADDRESS),','),' '))
    ELSE trim(replace(replace(ADDRESS1,' '),',')) END) AS ADDRESSID,
    CASE WHEN UPRN is null and addressid is null THEN 1 else 0 end as REMOVE_FROM_RM_MATCH,
    FLOOR_LEVEL,
    FLAT_TOP_STOREY,
    FLAT_STOREY_COUNT,
    PROPERTY_TYPE
 from  RAW.EPC_TEST_DATA.EPC_CERTIFICATES 

)

SELECT * FROM epc_certs
  );
[0m12:09:30.857377 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m12:09:30.857530 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:09:31.381039 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:09:31.399531 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (execute): 12:09:30.853921 => 12:09:31.399364
[0m12:09:31.399858 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: Close
[0m12:09:31.440102 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:09:31.442475 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (execute): 12:09:30.802403 => 12:09:31.442301
[0m12:09:31.442818 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: Close
[0m12:09:31.499457 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '72e08101-08dd-47b9-90f1-dae067584355', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106946790>]}
[0m12:09:31.500060 [info ] [Thread-1 (]: 1 of 11 OK created sql view model dbt_melissa_rm_epc.stg_epc_certs ............. [[32mSUCCESS 1[0m in 0.71s]
[0m12:09:31.500493 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.stg_epc_certs
[0m12:09:31.534185 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '72e08101-08dd-47b9-90f1-dae067584355', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10659dcd0>]}
[0m12:09:31.534795 [info ] [Thread-2 (]: 2 of 11 OK created sql view model dbt_melissa_rm_epc.stg_rightmove ............. [[32mSUCCESS 1[0m in 0.74s]
[0m12:09:31.535273 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.stg_rightmove
[0m12:09:31.535945 [debug] [Thread-4 (]: Began running node model.rightmove_epc.dim_addressid
[0m12:09:31.536300 [info ] [Thread-4 (]: 3 of 11 START sql view model dbt_melissa_rm_epc.dim_addressid .................. [RUN]
[0m12:09:31.536628 [debug] [Thread-3 (]: Began running node model.rightmove_epc.dim_uprn
[0m12:09:31.537215 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_addressid'
[0m12:09:31.537581 [info ] [Thread-3 (]: 4 of 11 START sql view model dbt_melissa_rm_epc.dim_uprn ....................... [RUN]
[0m12:09:31.537891 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.dim_addressid
[0m12:09:31.538390 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_uprn'
[0m12:09:31.541011 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.dim_addressid"
[0m12:09:31.541338 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.dim_uprn
[0m12:09:31.543622 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.dim_uprn"
[0m12:09:31.544191 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_addressid (compile): 12:09:31.538556 => 12:09:31.544023
[0m12:09:31.544473 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.dim_uprn (compile): 12:09:31.541576 => 12:09:31.544334
[0m12:09:31.544689 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.dim_addressid
[0m12:09:31.544915 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.dim_uprn
[0m12:09:31.547321 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.dim_addressid"
[0m12:09:31.549425 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.dim_uprn"
[0m12:09:31.550699 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.dim_uprn"
[0m12:09:31.551460 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.dim_addressid"
[0m12:09:31.551869 [debug] [Thread-3 (]: On model.rightmove_epc.dim_uprn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_uprn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE UPRNS


with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource,
    POSTCODE
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    where REMOVE_FROM_RM_MATCH = 0
    AND UPRN IS NOT NULL
),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    WHERE UPRN IS NOT NULL

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where uprn is not null
  );
[0m12:09:31.552263 [debug] [Thread-4 (]: On model.rightmove_epc.dim_addressid: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_addressid"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE ADDRESS'

with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource,
    POSTCODE

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    where REMOVE_FROM_RM_MATCH = 0
    AND ADDRESSID IS NOT NULL

),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    WHERE ADDRESSID IS NOT NULL

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where uprn is null
and addressid is not null
  );
[0m12:09:31.552524 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m12:09:31.552739 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m12:09:32.175854 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:09:32.181005 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_addressid (execute): 12:09:31.545058 => 12:09:32.180723
[0m12:09:32.181636 [debug] [Thread-4 (]: On model.rightmove_epc.dim_addressid: Close
[0m12:09:32.275903 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '72e08101-08dd-47b9-90f1-dae067584355', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1066f3c90>]}
[0m12:09:32.276900 [info ] [Thread-4 (]: 3 of 11 OK created sql view model dbt_melissa_rm_epc.dim_addressid ............. [[32mSUCCESS 1[0m in 0.74s]
[0m12:09:32.277671 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.dim_addressid
[0m12:09:32.278576 [debug] [Thread-2 (]: Began running node model.rightmove_epc.address_match
[0m12:09:32.279092 [debug] [Thread-1 (]: Began running node model.rightmove_epc.address_simularity
[0m12:09:32.279725 [info ] [Thread-2 (]: 5 of 11 START sql view model dbt_melissa_rm_epc.address_match .................. [RUN]
[0m12:09:32.280382 [info ] [Thread-1 (]: 6 of 11 START sql view model dbt_melissa_rm_epc.address_simularity ............. [RUN]
[0m12:09:32.281321 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_rightmove, now model.rightmove_epc.address_match)
[0m12:09:32.282114 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_epc_certs, now model.rightmove_epc.address_simularity)
[0m12:09:32.282586 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.address_match
[0m12:09:32.283003 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.address_simularity
[0m12:09:32.286768 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.address_match"
[0m12:09:32.290030 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.address_simularity"
[0m12:09:32.290872 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:09:32.294705 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.dim_uprn (execute): 12:09:31.547545 => 12:09:32.294518
[0m12:09:32.295278 [debug] [Thread-3 (]: On model.rightmove_epc.dim_uprn: Close
[0m12:09:32.296498 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.address_match (compile): 12:09:32.283265 => 12:09:32.296301
[0m12:09:32.297208 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.address_simularity (compile): 12:09:32.287376 => 12:09:32.297012
[0m12:09:32.297500 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.address_match
[0m12:09:32.297910 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.address_simularity
[0m12:09:32.302075 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.address_match"
[0m12:09:32.304415 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.address_simularity"
[0m12:09:32.305703 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.address_match"
[0m12:09:32.306378 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.address_simularity"
[0m12:09:32.306626 [debug] [Thread-2 (]: On model.rightmove_epc.address_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.address_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NULL
),

epc_address as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
    where datasource = 'EPC'
)


SELECT rm.*,
CASE WHEN epc_address.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_address.ADDRESSID AS EPC_ADDRESSID


FROM rm
LEFT JOIN epc_address
ON rm.addressid = epc_address.addressid
and rm.FULL_POSTCODE = epc_address.POSTCODE
  );
[0m12:09:32.306917 [debug] [Thread-1 (]: On model.rightmove_epc.address_simularity: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.address_simularity"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.address_simularity
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NULL
),

epc_address as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
    where datasource = 'EPC'
)


SELECT rm.*,epc_address.addressid as EPC_ADDRESSID
FROM rm
JOIN epc_address
ON JAROWINKLER_SIMILARITY(rm.addressid, epc_address.addressid) = 1
  );
[0m12:09:32.307162 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m12:09:32.307401 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:09:32.374236 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '72e08101-08dd-47b9-90f1-dae067584355', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10695cd50>]}
[0m12:09:32.374750 [info ] [Thread-3 (]: 4 of 11 OK created sql view model dbt_melissa_rm_epc.dim_uprn .................. [[32mSUCCESS 1[0m in 0.84s]
[0m12:09:32.375117 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.dim_uprn
[0m12:09:32.375496 [debug] [Thread-4 (]: Began running node model.rightmove_epc.uprn_match
[0m12:09:32.375768 [info ] [Thread-4 (]: 7 of 11 START sql view model dbt_melissa_rm_epc.uprn_match ..................... [RUN]
[0m12:09:32.376198 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.dim_addressid, now model.rightmove_epc.uprn_match)
[0m12:09:32.376422 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.uprn_match
[0m12:09:32.378482 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.uprn_match"
[0m12:09:32.379073 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.uprn_match (compile): 12:09:32.376561 => 12:09:32.378938
[0m12:09:32.379308 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.uprn_match
[0m12:09:32.381751 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.uprn_match"
[0m12:09:32.382946 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.uprn_match"
[0m12:09:32.383265 [debug] [Thread-4 (]: On model.rightmove_epc.uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NOT NULL
),

change_date AS (
    SELECT 
        UPRN AS UPRN_CD, 
        MAX(CHANGE_DATE) AS MAX_CHANGE_DATE 
    FROM rm
    GROUP BY UPRN
),

rm_latest as (

    SELECT * FROM rm
    LEFT JOIN change_date cd
    ON rm.UPRN = cd.UPRN_CD
    WHERE cd.MAX_CHANGE_DATE = rm.CHANGE_DATE ),

epc_uprn as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
    where datasource = 'EPC'
)


SELECT rm_latest.*,
CASE WHEN epc_uprn.UPRN is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_uprn.UPRN AS EPC_UPRN,
epc_uprn.ADDRESSID AS EPC_ADDRESSID


FROM rm_latest
LEFT JOIN epc_uprn
ON rm_latest.UPRN = epc_uprn.UPRN

WHERE MATCH_EPC = 'YES'
  );
[0m12:09:32.383512 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m12:09:32.881922 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:09:32.887546 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.address_simularity (execute): 12:09:32.302359 => 12:09:32.887197
[0m12:09:32.888235 [debug] [Thread-1 (]: On model.rightmove_epc.address_simularity: Close
[0m12:09:32.947330 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:09:32.949883 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.address_match (execute): 12:09:32.298152 => 12:09:32.949685
[0m12:09:32.950257 [debug] [Thread-2 (]: On model.rightmove_epc.address_match: Close
[0m12:09:32.983220 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '72e08101-08dd-47b9-90f1-dae067584355', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106561650>]}
[0m12:09:32.983918 [info ] [Thread-1 (]: 6 of 11 OK created sql view model dbt_melissa_rm_epc.address_simularity ........ [[32mSUCCESS 1[0m in 0.70s]
[0m12:09:32.984550 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.address_simularity
[0m12:09:33.030809 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '72e08101-08dd-47b9-90f1-dae067584355', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106721290>]}
[0m12:09:33.031528 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:09:33.032006 [info ] [Thread-2 (]: 5 of 11 OK created sql view model dbt_melissa_rm_epc.address_match ............. [[32mSUCCESS 1[0m in 0.75s]
[0m12:09:33.034015 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.uprn_match (execute): 12:09:32.379452 => 12:09:33.033862
[0m12:09:33.034396 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.address_match
[0m12:09:33.034668 [debug] [Thread-4 (]: On model.rightmove_epc.uprn_match: Close
[0m12:09:33.117529 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '72e08101-08dd-47b9-90f1-dae067584355', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1064a7010>]}
[0m12:09:33.118106 [info ] [Thread-4 (]: 7 of 11 OK created sql view model dbt_melissa_rm_epc.uprn_match ................ [[32mSUCCESS 1[0m in 0.74s]
[0m12:09:33.118519 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.uprn_match
[0m12:09:33.119148 [debug] [Thread-3 (]: Began running node model.rightmove_epc.all_matches
[0m12:09:33.119461 [debug] [Thread-1 (]: Began running node model.rightmove_epc.houses_report
[0m12:09:33.119746 [info ] [Thread-3 (]: 8 of 11 START sql view model dbt_melissa_rm_epc.all_matches .................... [RUN]
[0m12:09:33.120076 [debug] [Thread-2 (]: Began running node model.rightmove_epc.no_matches
[0m12:09:33.120382 [info ] [Thread-1 (]: 9 of 11 START sql view model dbt_melissa_rm_epc.houses_report .................. [RUN]
[0m12:09:33.120710 [debug] [Thread-4 (]: Began running node model.rightmove_epc.no_uprn_match
[0m12:09:33.121166 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.dim_uprn, now model.rightmove_epc.all_matches)
[0m12:09:33.121920 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.address_simularity, now model.rightmove_epc.houses_report)
[0m12:09:33.121486 [info ] [Thread-2 (]: 10 of 11 START sql view model dbt_melissa_rm_epc.no_matches .................... [RUN]
[0m12:09:33.122275 [info ] [Thread-4 (]: 11 of 11 START sql view model dbt_melissa_rm_epc.no_uprn_match ................. [RUN]
[0m12:09:33.122558 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.all_matches
[0m12:09:33.122798 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.houses_report
[0m12:09:33.123215 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.address_match, now model.rightmove_epc.no_matches)
[0m12:09:33.123617 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.uprn_match, now model.rightmove_epc.no_uprn_match)
[0m12:09:33.126407 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.all_matches"
[0m12:09:33.128809 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.houses_report"
[0m12:09:33.129153 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.no_matches
[0m12:09:33.129425 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.no_uprn_match
[0m12:09:33.131924 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.no_matches"
[0m12:09:33.134351 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.no_uprn_match"
[0m12:09:33.134665 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.all_matches (compile): 12:09:33.123767 => 12:09:33.134520
[0m12:09:33.134997 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.all_matches
[0m12:09:33.135256 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.houses_report (compile): 12:09:33.126608 => 12:09:33.135133
[0m12:09:33.137382 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.all_matches"
[0m12:09:33.137668 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.no_uprn_match (compile): 12:09:33.132263 => 12:09:33.137537
[0m12:09:33.137941 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.houses_report
[0m12:09:33.138245 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.no_matches (compile): 12:09:33.129788 => 12:09:33.138123
[0m12:09:33.138466 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.no_uprn_match
[0m12:09:33.140504 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.houses_report"
[0m12:09:33.141350 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.all_matches"
[0m12:09:33.141604 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.no_matches
[0m12:09:33.144750 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.no_uprn_match"
[0m12:09:33.145130 [debug] [Thread-3 (]: On model.rightmove_epc.all_matches: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.all_matches"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.all_matches
  
   as (
    with addr as (

    select 
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    '' AS EPC_UPRN,
    EPC_ADDRESSID
    
    from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
    where MATCH_EPC = 'YES' 
),

uprn as (

    select 
    
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN::VARCHAR AS EPC_UPRN,
    EPC_ADDRESSID
     from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'YES'
),

final as (

select 'ADDRESS AND POSTCODE MATCH' AS MATCH_RESULT, * from addr
union all
select 'UPRN MATCH' AS MATCH_RESULT, * from uprn
)

select * from final
  );
[0m12:09:33.146963 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.no_matches"
[0m12:09:33.148500 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.houses_report"
[0m12:09:33.148735 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m12:09:33.149228 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.no_uprn_match"
[0m12:09:33.149551 [debug] [Thread-1 (]: On model.rightmove_epc.houses_report: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.houses_report"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.houses_report
  
   as (
    with epc_max_date as (

    select uprn as UPRN_EPC,
    MAX(LODGEMENT_DATE) AS MAX_LODGEMENT_DATE,
    from  ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    group by 1


),

latest_epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc
    inner join epc_max_date on epc.uprn = epc_max_date.UPRN_EPC
    where MAX_LODGEMENT_DATE = LODGEMENT_DATE

),

 house_addmatch as (

    select 
    distinct
    --count(LISTING_ID) as TOTAL_LISTINGS,
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN, -- NULL
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
 --   am.FLOOR_LEVEL as RM_FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    COUNTY,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    epc.ADDRESSID AS EPC_ADDRESSID,
    -- REMOVE_FROM_RM_MATCH,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

     from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match am
    inner join latest_epc epc on am.EPC_ADDRESSID = epc.ADDRESSID
    and am.FULL_POSTCODE = epc.POSTCODE
    where MATCH_EPC = 'YES'
    and COMBINED_PROPERTY_TYPE not in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')

),

house_uprnmatch as (

    select 
    distinct
    --count(LISTING_ID) as TOTAL_LISTINGS,
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN, -- NULL
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
  --  am.FLOOR_LEVEL as RM_FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    COUNTY,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    epc.ADDRESSID AS EPC_ADDRESSID,
    -- REMOVE_FROM_RM_MATCH,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

    

    from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match am
    inner join latest_epc epc on am.EPC_UPRN = epc.UPRN

    where MATCH_EPC = 'YES'
   and COMBINED_PROPERTY_TYPE not in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')
  -- AND RM_UPRN = 100030719363

)


select 'UPRN' as MATCH_TYPE, * from house_uprnmatch

union all

select 'ADDRESSID' as MATCH_TYPE, * from house_addmatch

/*
--THIS IS USED FOR A TEST
select RM_UPRN,COUNT(BUILDING_REFERENCE_NUMBER)
from house_uprnmatch
WHERE RM_UPRN IS NOT NULL
GROUP BY 1
HAVING COUNT(BUILDING_REFERENCE_NUMBER) >1
*/
  );
[0m12:09:33.150323 [debug] [Thread-4 (]: On model.rightmove_epc.no_uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.no_uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.no_uprn_match
  
   as (
    with rm_no_match_to_epc  as ( -- rightmove uspn does not match epc

    select *

     from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'NO'
    
)

select * from rm_no_match_to_epc

/*
epc_remove as (

    select EPC_UPRN,EPC_ADDRESSID from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'YES'  -- 
),

epc_matched as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs src
    left join epc_remove rem on src.UPRN = rem.EPC_UPRN
    
),

epc_fm_prep as (

    select * from epc_matched
    where EPC_UPRN is NULL

    
)


SELECT * FROM epc_fm_prep
WHERE UPRN NOT NULL */
  );
[0m12:09:33.151270 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.no_matches"
[0m12:09:33.151504 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:09:33.151706 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m12:09:33.151936 [debug] [Thread-2 (]: On model.rightmove_epc.no_matches: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.no_matches"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.no_matches
  
   as (
    with addr as (

    select 
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    '' AS EPC_UPRN,
    EPC_ADDRESSID
    
    from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
    where MATCH_EPC = 'NO' 
),

uprn as (

    select 
    
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN::VARCHAR AS EPC_UPRN,
    EPC_ADDRESSID
    
     from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'NO'
),

final as (

select 'NO ADDRESS OR UPRN MATCH' AS MATCH_RESULT, * from addr
union all
select 'NO UPRN MATCH' AS MATCH_RESULT, * from uprn
)

select * from final
  );
[0m12:09:33.153346 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m12:09:33.914421 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:09:33.915470 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:09:33.920110 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.houses_report (execute): 12:09:33.138635 => 12:09:33.919830
[0m12:09:33.920974 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:09:33.923645 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.all_matches (execute): 12:09:33.135446 => 12:09:33.923431
[0m12:09:33.924079 [debug] [Thread-1 (]: On model.rightmove_epc.houses_report: Close
[0m12:09:33.926498 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.no_matches (execute): 12:09:33.145318 => 12:09:33.926324
[0m12:09:33.926875 [debug] [Thread-3 (]: On model.rightmove_epc.all_matches: Close
[0m12:09:33.928309 [debug] [Thread-2 (]: On model.rightmove_epc.no_matches: Close
[0m12:09:34.008851 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '72e08101-08dd-47b9-90f1-dae067584355', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106563e50>]}
[0m12:09:34.010001 [info ] [Thread-1 (]: 9 of 11 OK created sql view model dbt_melissa_rm_epc.houses_report ............. [[32mSUCCESS 1[0m in 0.89s]
[0m12:09:34.010828 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.houses_report
[0m12:09:34.012514 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '72e08101-08dd-47b9-90f1-dae067584355', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10792c350>]}
[0m12:09:34.013012 [info ] [Thread-2 (]: 10 of 11 OK created sql view model dbt_melissa_rm_epc.no_matches ............... [[32mSUCCESS 1[0m in 0.89s]
[0m12:09:34.013500 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.no_matches
[0m12:09:34.025702 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '72e08101-08dd-47b9-90f1-dae067584355', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1067e4990>]}
[0m12:09:34.026308 [info ] [Thread-3 (]: 8 of 11 OK created sql view model dbt_melissa_rm_epc.all_matches ............... [[32mSUCCESS 1[0m in 0.90s]
[0m12:09:34.026752 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.all_matches
[0m12:09:35.100149 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m12:09:35.101773 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.no_uprn_match (execute): 12:09:33.141773 => 12:09:35.101668
[0m12:09:35.101966 [debug] [Thread-4 (]: On model.rightmove_epc.no_uprn_match: Close
[0m12:09:35.197022 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '72e08101-08dd-47b9-90f1-dae067584355', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1063f5950>]}
[0m12:09:35.197569 [info ] [Thread-4 (]: 11 of 11 OK created sql view model dbt_melissa_rm_epc.no_uprn_match ............ [[32mSUCCESS 1[0m in 2.07s]
[0m12:09:35.197949 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.no_uprn_match
[0m12:09:35.199157 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:09:35.199410 [debug] [MainThread]: Connection 'model.rightmove_epc.houses_report' was properly closed.
[0m12:09:35.199617 [debug] [MainThread]: Connection 'model.rightmove_epc.no_matches' was properly closed.
[0m12:09:35.199797 [debug] [MainThread]: Connection 'model.rightmove_epc.no_uprn_match' was properly closed.
[0m12:09:35.199971 [debug] [MainThread]: Connection 'model.rightmove_epc.all_matches' was properly closed.
[0m12:09:35.200203 [info ] [MainThread]: 
[0m12:09:35.200423 [info ] [MainThread]: Finished running 11 view models in 0 hours 0 minutes and 5.61 seconds (5.61s).
[0m12:09:35.201449 [debug] [MainThread]: Command end result
[0m12:09:35.208254 [info ] [MainThread]: 
[0m12:09:35.208628 [info ] [MainThread]: [32mCompleted successfully[0m
[0m12:09:35.208883 [info ] [MainThread]: 
[0m12:09:35.209127 [info ] [MainThread]: Done. PASS=11 WARN=0 ERROR=0 SKIP=0 TOTAL=11
[0m12:09:35.211104 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 5.9080577, "process_user_time": 1.574513, "process_kernel_time": 0.214511, "process_mem_max_rss": "141197312", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m12:09:35.211479 [debug] [MainThread]: Command `dbt run` succeeded at 12:09:35.211399 after 5.91 seconds
[0m12:09:35.211732 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x101316110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x101451cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1012fe710>]}
[0m12:09:35.211984 [debug] [MainThread]: Flushing usage events
[0m12:10:48.273158 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107d54b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107d9a950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107d9b4d0>]}


============================== 12:10:48.276278 | 1cc0ff45-1bb7-49c5-a57e-1976693990ab ==============================
[0m12:10:48.276278 [info ] [MainThread]: Running with dbt=1.7.10
[0m12:10:48.276585 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'debug': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select models/reports', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m12:10:48.453029 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1cc0ff45-1bb7-49c5-a57e-1976693990ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x118d7e750>]}
[0m12:10:48.487696 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1cc0ff45-1bb7-49c5-a57e-1976693990ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x118420590>]}
[0m12:10:48.488405 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m12:10:48.497881 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m12:10:48.522993 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m12:10:48.523256 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m12:10:48.526896 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1cc0ff45-1bb7-49c5-a57e-1976693990ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x118f24450>]}
[0m12:10:48.534671 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1cc0ff45-1bb7-49c5-a57e-1976693990ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x118e733d0>]}
[0m12:10:48.534950 [info ] [MainThread]: Found 12 models, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m12:10:48.535143 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1cc0ff45-1bb7-49c5-a57e-1976693990ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x118e32410>]}
[0m12:10:48.536098 [info ] [MainThread]: 
[0m12:10:48.536494 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m12:10:48.537021 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m12:10:48.543378 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m12:10:48.543609 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m12:10:48.543752 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:10:49.024295 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 0.0 seconds
[0m12:10:49.027570 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m12:10:49.165868 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m12:10:49.174854 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m12:10:49.175230 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m12:10:49.175530 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:10:49.618170 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 0.0 seconds
[0m12:10:49.619411 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m12:10:49.721193 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1cc0ff45-1bb7-49c5-a57e-1976693990ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x118ac84d0>]}
[0m12:10:49.721789 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m12:10:49.721992 [info ] [MainThread]: 
[0m12:10:49.723776 [debug] [Thread-1 (]: Began running node model.rightmove_epc.houses_report
[0m12:10:49.724083 [info ] [Thread-1 (]: 1 of 1 START sql view model dbt_melissa_rm_epc.houses_report ................... [RUN]
[0m12:10:49.724460 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.houses_report)
[0m12:10:49.724649 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.houses_report
[0m12:10:49.730895 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.houses_report"
[0m12:10:49.732107 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.houses_report (compile): 12:10:49.724767 => 12:10:49.731897
[0m12:10:49.732404 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.houses_report
[0m12:10:49.780936 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.houses_report"
[0m12:10:49.783006 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.houses_report"
[0m12:10:49.783383 [debug] [Thread-1 (]: On model.rightmove_epc.houses_report: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.houses_report"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.houses_report
  
   as (
    with epc_max_date as (

    select uprn as UPRN_EPC,
    MAX(LODGEMENT_DATE) AS MAX_LODGEMENT_DATE,
    from  ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    group by 1


),

latest_epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc
    inner join epc_max_date on epc.uprn = epc_max_date.UPRN_EPC
    where MAX_LODGEMENT_DATE = LODGEMENT_DATE

),

 house_addmatch as (

    select 
    distinct
    --count(LISTING_ID) as TOTAL_LISTINGS,
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN, -- NULL
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
 --   am.FLOOR_LEVEL as RM_FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    COUNTY,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    epc.ADDRESSID AS EPC_ADDRESSID,
    -- REMOVE_FROM_RM_MATCH,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

     from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc on am.EPC_ADDRESSID = epc.ADDRESSID
    and am.FULL_POSTCODE = epc.POSTCODE
    where MATCH_EPC = 'YES'
    and COMBINED_PROPERTY_TYPE not in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')

),

house_uprnmatch as (

    select 
    distinct
    --count(LISTING_ID) as TOTAL_LISTINGS,
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN, -- NULL
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
  --  am.FLOOR_LEVEL as RM_FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    COUNTY,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    epc.ADDRESSID AS EPC_ADDRESSID,
    -- REMOVE_FROM_RM_MATCH,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

    

    from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match am
    inner join latest_epc epc on am.EPC_UPRN = epc.UPRN

    where MATCH_EPC = 'YES'
   and COMBINED_PROPERTY_TYPE not in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')
  -- AND RM_UPRN = 100030719363

)


select 'UPRN' as MATCH_TYPE, * from house_uprnmatch

union all

select 'ADDRESSID' as MATCH_TYPE, * from house_addmatch

/*
--THIS IS USED FOR A TEST
select RM_UPRN,COUNT(BUILDING_REFERENCE_NUMBER)
from house_uprnmatch
WHERE RM_UPRN IS NOT NULL
GROUP BY 1
HAVING COUNT(BUILDING_REFERENCE_NUMBER) >1
*/
  );
[0m12:10:49.783665 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:10:50.712306 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:10:50.732793 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.houses_report (execute): 12:10:49.732515 => 12:10:50.732604
[0m12:10:50.733148 [debug] [Thread-1 (]: On model.rightmove_epc.houses_report: Close
[0m12:10:50.880088 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1cc0ff45-1bb7-49c5-a57e-1976693990ab', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106186e50>]}
[0m12:10:50.880761 [info ] [Thread-1 (]: 1 of 1 OK created sql view model dbt_melissa_rm_epc.houses_report .............. [[32mSUCCESS 1[0m in 1.16s]
[0m12:10:50.881242 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.houses_report
[0m12:10:50.882644 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:10:50.882953 [debug] [MainThread]: Connection 'model.rightmove_epc.houses_report' was properly closed.
[0m12:10:50.883229 [info ] [MainThread]: 
[0m12:10:50.883505 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 2.35 seconds (2.35s).
[0m12:10:50.883989 [debug] [MainThread]: Command end result
[0m12:10:50.892784 [info ] [MainThread]: 
[0m12:10:50.893153 [info ] [MainThread]: [32mCompleted successfully[0m
[0m12:10:50.893395 [info ] [MainThread]: 
[0m12:10:50.893639 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m12:10:50.895546 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 2.6520746, "process_user_time": 1.167795, "process_kernel_time": 0.167201, "process_mem_max_rss": "133447680", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m12:10:50.895942 [debug] [MainThread]: Command `dbt run` succeeded at 12:10:50.895859 after 2.65 seconds
[0m12:10:50.896197 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102b660d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102a12210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102a2a350>]}
[0m12:10:50.896453 [debug] [MainThread]: Flushing usage events
[0m12:13:33.992054 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113d8eed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113d99c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113d9b210>]}


============================== 12:13:33.994796 | 2ad4343f-8996-4d1c-8c71-e1759e78cf7f ==============================
[0m12:13:33.994796 [info ] [MainThread]: Running with dbt=1.7.10
[0m12:13:33.995124 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt run --select models/reports', 'send_anonymous_usage_stats': 'True'}
[0m12:13:34.171383 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2ad4343f-8996-4d1c-8c71-e1759e78cf7f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113d735d0>]}
[0m12:13:34.205201 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2ad4343f-8996-4d1c-8c71-e1759e78cf7f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114a2b0d0>]}
[0m12:13:34.205938 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m12:13:34.214878 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m12:13:34.231151 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m12:13:34.231397 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m12:13:34.234460 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2ad4343f-8996-4d1c-8c71-e1759e78cf7f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1149e1dd0>]}
[0m12:13:34.243214 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2ad4343f-8996-4d1c-8c71-e1759e78cf7f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1148fd810>]}
[0m12:13:34.243487 [info ] [MainThread]: Found 13 models, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m12:13:34.243683 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2ad4343f-8996-4d1c-8c71-e1759e78cf7f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114b14150>]}
[0m12:13:34.244649 [info ] [MainThread]: 
[0m12:13:34.245042 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m12:13:34.245613 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m12:13:34.251793 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m12:13:34.252063 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m12:13:34.252224 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:13:34.835303 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 1.0 seconds
[0m12:13:34.838035 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m12:13:34.938793 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m12:13:34.946278 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m12:13:34.946609 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m12:13:34.946877 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:13:35.362986 [debug] [ThreadPool]: SQL status: SUCCESS 12 in 0.0 seconds
[0m12:13:35.365152 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m12:13:35.460791 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2ad4343f-8996-4d1c-8c71-e1759e78cf7f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114ae8250>]}
[0m12:13:35.461651 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m12:13:35.461989 [info ] [MainThread]: 
[0m12:13:35.464438 [debug] [Thread-1 (]: Began running node model.rightmove_epc.flats_report
[0m12:13:35.464768 [debug] [Thread-2 (]: Began running node model.rightmove_epc.houses_report
[0m12:13:35.465168 [info ] [Thread-1 (]: 1 of 3 START sql view model dbt_melissa_rm_epc.flats_report .................... [RUN]
[0m12:13:35.465545 [info ] [Thread-2 (]: 2 of 3 START sql view model dbt_melissa_rm_epc.houses_report ................... [RUN]
[0m12:13:35.466102 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.flats_report)
[0m12:13:35.466720 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.houses_report'
[0m12:13:35.467037 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.flats_report
[0m12:13:35.467338 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.houses_report
[0m12:13:35.474933 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.flats_report"
[0m12:13:35.477918 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.houses_report"
[0m12:13:35.478970 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.flats_report (compile): 12:13:35.467534 => 12:13:35.478797
[0m12:13:35.479281 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.flats_report
[0m12:13:35.485968 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.houses_report (compile): 12:13:35.475147 => 12:13:35.485763
[0m12:13:35.528300 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.flats_report"
[0m12:13:35.528568 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.houses_report
[0m12:13:35.530550 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.houses_report"
[0m12:13:35.532084 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.flats_report"
[0m12:13:35.532385 [debug] [Thread-1 (]: On model.rightmove_epc.flats_report: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.flats_report"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.flats_report
  
   as (
    with epc_max_date as (

    select uprn as UPRN_EPC,
    MAX(LODGEMENT_DATE) AS MAX_LODGEMENT_DATE,
    from  ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    group by 1


),

latest_epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc
    inner join epc_max_date on epc.uprn = epc_max_date.UPRN_EPC
    where MAX_LODGEMENT_DATE = LODGEMENT_DATE

),

 house_addmatch as (

    select 
    distinct
    --count(LISTING_ID) as TOTAL_LISTINGS,
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN, -- NULL
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
 --   am.FLOOR_LEVEL as RM_FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    COUNTY,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    epc.ADDRESSID AS EPC_ADDRESSID,
    -- REMOVE_FROM_RM_MATCH,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

     from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc on am.EPC_ADDRESSID = epc.ADDRESSID
    and am.FULL_POSTCODE = epc.POSTCODE
    where MATCH_EPC = 'YES'
    and COMBINED_PROPERTY_TYPE in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')

),

house_uprnmatch as (

    select 
    distinct
    --count(LISTING_ID) as TOTAL_LISTINGS,
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN, -- NULL
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
  --  am.FLOOR_LEVEL as RM_FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    COUNTY,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    epc.ADDRESSID AS EPC_ADDRESSID,
    -- REMOVE_FROM_RM_MATCH,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

    

    from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match am
    inner join latest_epc epc on am.EPC_UPRN = epc.UPRN

    where MATCH_EPC = 'YES'
   and COMBINED_PROPERTY_TYPE in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')
  -- AND RM_UPRN = 100030719363

)


select 'UPRN' as MATCH_TYPE, * from house_uprnmatch

union all

select 'ADDRESSID' as MATCH_TYPE, * from house_addmatch

/*
--THIS IS USED FOR A TEST
select RM_UPRN,COUNT(BUILDING_REFERENCE_NUMBER)
from house_uprnmatch
WHERE RM_UPRN IS NOT NULL
GROUP BY 1
HAVING COUNT(BUILDING_REFERENCE_NUMBER) >1
*/
  );
[0m12:13:35.532642 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:13:35.534888 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.houses_report"
[0m12:13:35.535164 [debug] [Thread-2 (]: On model.rightmove_epc.houses_report: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.houses_report"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.houses_report
  
   as (
    with epc_max_date as (

    select uprn as UPRN_EPC,
    MAX(LODGEMENT_DATE) AS MAX_LODGEMENT_DATE,
    from  ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    group by 1


),

latest_epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc
    inner join epc_max_date on epc.uprn = epc_max_date.UPRN_EPC
    where MAX_LODGEMENT_DATE = LODGEMENT_DATE

),

 house_addmatch as (

    select 
    distinct
    --count(LISTING_ID) as TOTAL_LISTINGS,
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN, -- NULL
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
 --   am.FLOOR_LEVEL as RM_FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    COUNTY,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    epc.ADDRESSID AS EPC_ADDRESSID,
    -- REMOVE_FROM_RM_MATCH,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

     from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc on am.EPC_ADDRESSID = epc.ADDRESSID
    and am.FULL_POSTCODE = epc.POSTCODE
    where MATCH_EPC = 'YES'
    and COMBINED_PROPERTY_TYPE not in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')

),

house_uprnmatch as (

    select 
    distinct
    --count(LISTING_ID) as TOTAL_LISTINGS,
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN, -- NULL
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
  --  am.FLOOR_LEVEL as RM_FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    COUNTY,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    epc.ADDRESSID AS EPC_ADDRESSID,
    -- REMOVE_FROM_RM_MATCH,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

    

    from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match am
    inner join latest_epc epc on am.EPC_UPRN = epc.UPRN

    where MATCH_EPC = 'YES'
   and COMBINED_PROPERTY_TYPE not in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')
  -- AND RM_UPRN = 100030719363

)


select 'UPRN' as MATCH_TYPE, * from house_uprnmatch

union all

select 'ADDRESSID' as MATCH_TYPE, * from house_addmatch

/*
--THIS IS USED FOR A TEST
select RM_UPRN,COUNT(BUILDING_REFERENCE_NUMBER)
from house_uprnmatch
WHERE RM_UPRN IS NOT NULL
GROUP BY 1
HAVING COUNT(BUILDING_REFERENCE_NUMBER) >1
*/
  );
[0m12:13:35.535437 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m12:13:36.292036 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:13:36.308279 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.flats_report (execute): 12:13:35.479443 => 12:13:36.308115
[0m12:13:36.308615 [debug] [Thread-1 (]: On model.rightmove_epc.flats_report: Close
[0m12:13:36.309807 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:13:36.313919 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.houses_report (execute): 12:13:35.528822 => 12:13:36.313781
[0m12:13:36.314227 [debug] [Thread-2 (]: On model.rightmove_epc.houses_report: Close
[0m12:13:36.401541 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2ad4343f-8996-4d1c-8c71-e1759e78cf7f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114db4450>]}
[0m12:13:36.402210 [info ] [Thread-2 (]: 2 of 3 OK created sql view model dbt_melissa_rm_epc.houses_report .............. [[32mSUCCESS 1[0m in 0.94s]
[0m12:13:36.402696 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.houses_report
[0m12:13:36.403165 [debug] [Thread-4 (]: Began running node model.rightmove_epc.zero_bedrooms
[0m12:13:36.403514 [info ] [Thread-4 (]: 3 of 3 START sql view model dbt_melissa_rm_epc.zero_bedrooms ................... [RUN]
[0m12:13:36.404093 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.rightmove_epc.zero_bedrooms'
[0m12:13:36.404360 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.zero_bedrooms
[0m12:13:36.406731 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.zero_bedrooms"
[0m12:13:36.408266 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.zero_bedrooms (compile): 12:13:36.404522 => 12:13:36.408109
[0m12:13:36.408529 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.zero_bedrooms
[0m12:13:36.410944 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.zero_bedrooms"
[0m12:13:36.411469 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2ad4343f-8996-4d1c-8c71-e1759e78cf7f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113dc3c50>]}
[0m12:13:36.411921 [info ] [Thread-1 (]: 1 of 3 OK created sql view model dbt_melissa_rm_epc.flats_report ............... [[32mSUCCESS 1[0m in 0.95s]
[0m12:13:36.412394 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.flats_report
[0m12:13:36.412984 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.zero_bedrooms"
[0m12:13:36.413264 [debug] [Thread-4 (]: On model.rightmove_epc.zero_bedrooms: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.zero_bedrooms"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.zero_bedrooms
  
   as (
    with houses as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.houses_report
),

flats as (

    select * from ref('flats_report')
)

select * from flats
union all
select * from houses

where BEDROOM = 0 or null
  );
[0m12:13:36.413511 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m12:13:36.729716 [debug] [Thread-4 (]: Snowflake adapter: Snowflake query id: 01b3447d-0103-9b9a-0000-719506376242
[0m12:13:36.730187 [debug] [Thread-4 (]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 11 at position 21 unexpected '('.
syntax error line 11 at position 22 unexpected ''flats_report''.
syntax error line 14 at position 0 unexpected 'select'.
[0m12:13:36.730715 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.zero_bedrooms (execute): 12:13:36.408684 => 12:13:36.730519
[0m12:13:36.731066 [debug] [Thread-4 (]: On model.rightmove_epc.zero_bedrooms: Close
[0m12:13:36.816198 [debug] [Thread-4 (]: Database Error in model zero_bedrooms (models/reports/zero_bedrooms.sql)
  001003 (42000): SQL compilation error:
  syntax error line 11 at position 21 unexpected '('.
  syntax error line 11 at position 22 unexpected ''flats_report''.
  syntax error line 14 at position 0 unexpected 'select'.
  compiled Code at target/run/rightmove_epc/models/reports/zero_bedrooms.sql
[0m12:13:36.816594 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2ad4343f-8996-4d1c-8c71-e1759e78cf7f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114c21710>]}
[0m12:13:36.816963 [error] [Thread-4 (]: 3 of 3 ERROR creating sql view model dbt_melissa_rm_epc.zero_bedrooms .......... [[31mERROR[0m in 0.41s]
[0m12:13:36.817311 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.zero_bedrooms
[0m12:13:36.818427 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:13:36.818642 [debug] [MainThread]: Connection 'model.rightmove_epc.flats_report' was properly closed.
[0m12:13:36.818809 [debug] [MainThread]: Connection 'model.rightmove_epc.houses_report' was properly closed.
[0m12:13:36.818962 [debug] [MainThread]: Connection 'model.rightmove_epc.zero_bedrooms' was properly closed.
[0m12:13:36.819163 [info ] [MainThread]: 
[0m12:13:36.819347 [info ] [MainThread]: Finished running 3 view models in 0 hours 0 minutes and 2.57 seconds (2.57s).
[0m12:13:36.819820 [debug] [MainThread]: Command end result
[0m12:13:36.826687 [info ] [MainThread]: 
[0m12:13:36.826943 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m12:13:36.827115 [info ] [MainThread]: 
[0m12:13:36.827298 [error] [MainThread]:   Database Error in model zero_bedrooms (models/reports/zero_bedrooms.sql)
  001003 (42000): SQL compilation error:
  syntax error line 11 at position 21 unexpected '('.
  syntax error line 11 at position 22 unexpected ''flats_report''.
  syntax error line 14 at position 0 unexpected 'select'.
  compiled Code at target/run/rightmove_epc/models/reports/zero_bedrooms.sql
[0m12:13:36.827476 [info ] [MainThread]: 
[0m12:13:36.827646 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=1 SKIP=0 TOTAL=3
[0m12:13:36.829372 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 2.8671985, "process_user_time": 1.234051, "process_kernel_time": 0.182308, "process_mem_max_rss": "136331264", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m12:13:36.829741 [debug] [MainThread]: Command `dbt run` failed at 12:13:36.829666 after 2.87 seconds
[0m12:13:36.829976 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113dc2f50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113dc0c90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1051ae310>]}
[0m12:13:36.830195 [debug] [MainThread]: Flushing usage events
[0m12:30:32.574263 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111ad3310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11209a7d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11209b350>]}


============================== 12:30:32.577386 | db25270b-d2ab-4a21-a195-c9b113e4039d ==============================
[0m12:30:32.577386 [info ] [MainThread]: Running with dbt=1.7.10
[0m12:30:32.577781 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m12:30:32.753551 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'db25270b-d2ab-4a21-a195-c9b113e4039d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1134b1a50>]}
[0m12:30:32.788626 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'db25270b-d2ab-4a21-a195-c9b113e4039d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1133f7f10>]}
[0m12:30:32.789358 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m12:30:32.799905 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m12:30:32.822874 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m12:30:32.823167 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m12:30:32.826464 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'db25270b-d2ab-4a21-a195-c9b113e4039d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1148c4590>]}
[0m12:30:32.833214 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'db25270b-d2ab-4a21-a195-c9b113e4039d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1135d8f50>]}
[0m12:30:32.833471 [info ] [MainThread]: Found 13 models, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m12:30:32.833664 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'db25270b-d2ab-4a21-a195-c9b113e4039d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113610810>]}
[0m12:30:32.834762 [info ] [MainThread]: 
[0m12:30:32.835157 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m12:30:32.835879 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m12:30:32.842005 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m12:30:32.842243 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m12:30:32.842390 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:30:33.326759 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 0.0 seconds
[0m12:30:33.329308 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m12:30:33.418229 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m12:30:33.427319 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m12:30:33.427745 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m12:30:33.428040 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:30:33.793851 [debug] [ThreadPool]: SQL status: SUCCESS 13 in 0.0 seconds
[0m12:30:33.796619 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m12:30:33.883873 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'db25270b-d2ab-4a21-a195-c9b113e4039d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1135b02d0>]}
[0m12:30:33.885034 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m12:30:33.885445 [info ] [MainThread]: 
[0m12:30:33.888727 [debug] [Thread-1 (]: Began running node model.rightmove_epc.stg_epc_certs
[0m12:30:33.889139 [debug] [Thread-2 (]: Began running node model.rightmove_epc.stg_rightmove
[0m12:30:33.889661 [info ] [Thread-1 (]: 1 of 13 START sql view model dbt_melissa_rm_epc.stg_epc_certs .................. [RUN]
[0m12:30:33.890131 [info ] [Thread-2 (]: 2 of 13 START sql view model dbt_melissa_rm_epc.stg_rightmove .................. [RUN]
[0m12:30:33.890838 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.stg_epc_certs)
[0m12:30:33.891532 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.stg_rightmove'
[0m12:30:33.891882 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.stg_epc_certs
[0m12:30:33.892211 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.stg_rightmove
[0m12:30:33.898928 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.stg_epc_certs"
[0m12:30:33.901099 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.stg_rightmove"
[0m12:30:33.902356 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (compile): 12:30:33.899206 => 12:30:33.902140
[0m12:30:33.902675 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.stg_rightmove
[0m12:30:33.903004 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (compile): 12:30:33.892426 => 12:30:33.902842
[0m12:30:33.955874 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.stg_rightmove"
[0m12:30:33.956128 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.stg_epc_certs
[0m12:30:33.957906 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.stg_epc_certs"
[0m12:30:33.958572 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.stg_rightmove"
[0m12:30:33.958775 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_rightmove"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
  
   as (
    with rm as (

    SELECT 
    LISTING_ID,
    CHANGE_DATE,
    UPPER(TRIM(replace(REPLACE(CONCAT(ADDRESS_1::VARCHAR,ADDRESS_2::VARCHAR),' '),','))) AS ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, 
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    BEDROOM,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    STUDENTLET_FLAG,
    COMBINED_PROPERTY_TYPE
    -- property type
    FROM 
       ANALYTICS.RIGHTMOVE_PROD.CLEAN_RAW_RIGHTMOVE_DATA 

 
)

SELECT * FROM rm
  );
[0m12:30:33.958968 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m12:30:33.959854 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.stg_epc_certs"
[0m12:30:33.960263 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_epc_certs"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
  
   as (
    WITH epc_certs as (
    
    select 
    UPRN,
    LODGEMENT_DATE,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    COUNTY,
    LOCAL_AUTHORITY as LOCAL_AUTHORITY_CODE,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    UPPER(CASE WHEN (UPPER(ADDRESS1) LIKE 'FLAT%' OR UPPER(ADDRESS1) LIKE 'UNIT%') or UPPER(ADDRESS1) LIKE 'ROOM%' 
    THEN TRIM(REPLACE(REPLACE(CONCAT(ADDRESS),','),' '))
    ELSE trim(replace(replace(ADDRESS1,' '),',')) END) AS ADDRESSID,
    CASE WHEN UPRN is null and addressid is null THEN 1 else 0 end as REMOVE_FROM_RM_MATCH,
    FLOOR_LEVEL,
    FLAT_TOP_STOREY,
    FLAT_STOREY_COUNT,
    PROPERTY_TYPE
 from  RAW.EPC_TEST_DATA.EPC_CERTIFICATES 

)

SELECT * FROM epc_certs
  );
[0m12:30:33.960482 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:30:34.440229 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m12:30:34.454840 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m12:30:34.465218 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (execute): 12:30:33.956333 => 12:30:34.465026
[0m12:30:34.467266 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (execute): 12:30:33.903155 => 12:30:34.467121
[0m12:30:34.467586 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: Close
[0m12:30:34.467854 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: Close
[0m12:30:34.540401 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'db25270b-d2ab-4a21-a195-c9b113e4039d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1148a3fd0>]}
[0m12:30:34.541236 [info ] [Thread-1 (]: 1 of 13 OK created sql view model dbt_melissa_rm_epc.stg_epc_certs ............. [[32mSUCCESS 1[0m in 0.65s]
[0m12:30:34.541813 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.stg_epc_certs
[0m12:30:34.551169 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'db25270b-d2ab-4a21-a195-c9b113e4039d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1117e77d0>]}
[0m12:30:34.551786 [info ] [Thread-2 (]: 2 of 13 OK created sql view model dbt_melissa_rm_epc.stg_rightmove ............. [[32mSUCCESS 1[0m in 0.66s]
[0m12:30:34.552298 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.stg_rightmove
[0m12:30:34.553057 [debug] [Thread-4 (]: Began running node model.rightmove_epc.dim_addressid
[0m12:30:34.553418 [debug] [Thread-3 (]: Began running node model.rightmove_epc.dim_uprn
[0m12:30:34.553844 [info ] [Thread-4 (]: 3 of 13 START sql view model dbt_melissa_rm_epc.dim_addressid .................. [RUN]
[0m12:30:34.554278 [info ] [Thread-3 (]: 4 of 13 START sql view model dbt_melissa_rm_epc.dim_uprn ....................... [RUN]
[0m12:30:34.555219 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_addressid'
[0m12:30:34.555955 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_uprn'
[0m12:30:34.556369 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.dim_addressid
[0m12:30:34.556750 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.dim_uprn
[0m12:30:34.559650 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.dim_addressid"
[0m12:30:34.562056 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.dim_uprn"
[0m12:30:34.563325 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_addressid (compile): 12:30:34.556979 => 12:30:34.563072
[0m12:30:34.563686 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.dim_addressid
[0m12:30:34.564032 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.dim_uprn (compile): 12:30:34.559939 => 12:30:34.563857
[0m12:30:34.566680 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.dim_addressid"
[0m12:30:34.566971 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.dim_uprn
[0m12:30:34.569196 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.dim_uprn"
[0m12:30:34.570179 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.dim_addressid"
[0m12:30:34.570913 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.dim_uprn"
[0m12:30:34.571185 [debug] [Thread-4 (]: On model.rightmove_epc.dim_addressid: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_addressid"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE ADDRESS'

with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource,
    POSTCODE

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    where REMOVE_FROM_RM_MATCH = 0
    AND ADDRESSID IS NOT NULL

),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    WHERE ADDRESSID IS NOT NULL

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where uprn is null
and addressid is not null
  );
[0m12:30:34.571517 [debug] [Thread-3 (]: On model.rightmove_epc.dim_uprn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_uprn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE UPRNS


with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource,
    POSTCODE
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    where REMOVE_FROM_RM_MATCH = 0
    AND UPRN IS NOT NULL
),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    WHERE UPRN IS NOT NULL

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where uprn is not null
  );
[0m12:30:34.571778 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m12:30:34.571994 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m12:30:35.379136 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:30:35.383548 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.dim_uprn (execute): 12:30:34.567190 => 12:30:35.383262
[0m12:30:35.384478 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:30:35.384990 [debug] [Thread-3 (]: On model.rightmove_epc.dim_uprn: Close
[0m12:30:35.387857 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_addressid (execute): 12:30:34.564190 => 12:30:35.387620
[0m12:30:35.389278 [debug] [Thread-4 (]: On model.rightmove_epc.dim_addressid: Close
[0m12:30:35.468134 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'db25270b-d2ab-4a21-a195-c9b113e4039d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114b5fe50>]}
[0m12:30:35.468870 [info ] [Thread-4 (]: 3 of 13 OK created sql view model dbt_melissa_rm_epc.dim_addressid ............. [[32mSUCCESS 1[0m in 0.91s]
[0m12:30:35.469431 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.dim_addressid
[0m12:30:35.469990 [debug] [Thread-2 (]: Began running node model.rightmove_epc.address_simularity
[0m12:30:35.470402 [info ] [Thread-2 (]: 5 of 13 START sql view model dbt_melissa_rm_epc.address_simularity ............. [RUN]
[0m12:30:35.471020 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_rightmove, now model.rightmove_epc.address_simularity)
[0m12:30:35.471349 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.address_simularity
[0m12:30:35.474552 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.address_simularity"
[0m12:30:35.475775 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.address_simularity (compile): 12:30:35.471551 => 12:30:35.475537
[0m12:30:35.476136 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.address_simularity
[0m12:30:35.479039 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.address_simularity"
[0m12:30:35.479726 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'db25270b-d2ab-4a21-a195-c9b113e4039d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1148a0590>]}
[0m12:30:35.480256 [info ] [Thread-3 (]: 4 of 13 OK created sql view model dbt_melissa_rm_epc.dim_uprn .................. [[32mSUCCESS 1[0m in 0.92s]
[0m12:30:35.480738 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.dim_uprn
[0m12:30:35.481321 [debug] [Thread-4 (]: Began running node model.rightmove_epc.no_uprn_match
[0m12:30:35.481651 [debug] [Thread-1 (]: Began running node model.rightmove_epc.uprn_match
[0m12:30:35.482345 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.address_simularity"
[0m12:30:35.482749 [info ] [Thread-4 (]: 6 of 13 START sql view model dbt_melissa_rm_epc.no_uprn_match .................. [RUN]
[0m12:30:35.483124 [info ] [Thread-1 (]: 7 of 13 START sql view model dbt_melissa_rm_epc.uprn_match ..................... [RUN]
[0m12:30:35.483518 [debug] [Thread-2 (]: On model.rightmove_epc.address_simularity: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.address_simularity"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.address_simularity
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NULL
),

epc_address as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
    where datasource = 'EPC'
)


SELECT rm.*,epc_address.addressid as EPC_ADDRESSID
FROM rm
JOIN epc_address
ON JAROWINKLER_SIMILARITY(rm.addressid, epc_address.addressid) = 1
  );
[0m12:30:35.484068 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.dim_addressid, now model.rightmove_epc.no_uprn_match)
[0m12:30:35.484552 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_epc_certs, now model.rightmove_epc.uprn_match)
[0m12:30:35.484881 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m12:30:35.485163 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.no_uprn_match
[0m12:30:35.485464 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.uprn_match
[0m12:30:35.489635 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.no_uprn_match"
[0m12:30:35.492020 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.uprn_match"
[0m12:30:35.492928 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.uprn_match (compile): 12:30:35.490100 => 12:30:35.492775
[0m12:30:35.493210 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.no_uprn_match (compile): 12:30:35.486148 => 12:30:35.493067
[0m12:30:35.493558 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.uprn_match
[0m12:30:35.493931 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.no_uprn_match
[0m12:30:35.496353 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.uprn_match"
[0m12:30:35.498577 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.no_uprn_match"
[0m12:30:35.500084 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.uprn_match"
[0m12:30:35.500403 [debug] [Thread-1 (]: On model.rightmove_epc.uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NOT NULL
),

change_date AS (
    SELECT 
        UPRN AS UPRN_CD, 
        MAX(CHANGE_DATE) AS MAX_CHANGE_DATE 
    FROM rm
    GROUP BY UPRN
),

rm_latest as (

    SELECT * FROM rm
    LEFT JOIN change_date cd
    ON rm.UPRN = cd.UPRN_CD
    WHERE cd.MAX_CHANGE_DATE = rm.CHANGE_DATE ),

epc_uprn as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
    where datasource = 'EPC'
)


SELECT rm_latest.*,
CASE WHEN epc_uprn.UPRN is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_uprn.UPRN AS EPC_UPRN,
epc_uprn.ADDRESSID AS EPC_ADDRESSID


FROM rm_latest
LEFT JOIN epc_uprn
ON rm_latest.UPRN = epc_uprn.UPRN

WHERE MATCH_EPC = 'YES'
  );
[0m12:30:35.501178 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.no_uprn_match"
[0m12:30:35.501466 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:30:35.501804 [debug] [Thread-4 (]: On model.rightmove_epc.no_uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.no_uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.no_uprn_match
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NOT NULL
),

change_date AS (
    SELECT 
        UPRN AS UPRN_CD, 
        MAX(CHANGE_DATE) AS MAX_CHANGE_DATE 
    FROM rm
    GROUP BY UPRN
),

rm_latest as (

    SELECT * FROM rm
    LEFT JOIN change_date cd
    ON rm.UPRN = cd.UPRN_CD
    WHERE cd.MAX_CHANGE_DATE = rm.CHANGE_DATE ),

epc_uprn as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
    where datasource = 'EPC'
)


SELECT rm_latest.*,
CASE WHEN epc_uprn.UPRN is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_uprn.UPRN AS EPC_UPRN,
epc_uprn.ADDRESSID AS EPC_ADDRESSID


FROM rm_latest
LEFT JOIN epc_uprn
ON rm_latest.UPRN = epc_uprn.UPRN

WHERE MATCH_EPC = 'NO'
  );
[0m12:30:35.502852 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m12:30:36.014743 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:30:36.016325 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.uprn_match (execute): 12:30:35.494160 => 12:30:36.016215
[0m12:30:36.016531 [debug] [Thread-1 (]: On model.rightmove_epc.uprn_match: Close
[0m12:30:36.067508 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:30:36.069215 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.address_simularity (execute): 12:30:35.476332 => 12:30:36.069093
[0m12:30:36.069450 [debug] [Thread-2 (]: On model.rightmove_epc.address_simularity: Close
[0m12:30:36.099717 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'db25270b-d2ab-4a21-a195-c9b113e4039d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114a7ed50>]}
[0m12:30:36.100117 [info ] [Thread-1 (]: 7 of 13 OK created sql view model dbt_melissa_rm_epc.uprn_match ................ [[32mSUCCESS 1[0m in 0.62s]
[0m12:30:36.100482 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.uprn_match
[0m12:30:36.135537 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:30:36.137314 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.no_uprn_match (execute): 12:30:35.496673 => 12:30:36.137189
[0m12:30:36.137560 [debug] [Thread-4 (]: On model.rightmove_epc.no_uprn_match: Close
[0m12:30:36.160049 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'db25270b-d2ab-4a21-a195-c9b113e4039d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11364f510>]}
[0m12:30:36.160461 [info ] [Thread-2 (]: 5 of 13 OK created sql view model dbt_melissa_rm_epc.address_simularity ........ [[32mSUCCESS 1[0m in 0.69s]
[0m12:30:36.160823 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.address_simularity
[0m12:30:36.226313 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'db25270b-d2ab-4a21-a195-c9b113e4039d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111781b10>]}
[0m12:30:36.226935 [info ] [Thread-4 (]: 6 of 13 OK created sql view model dbt_melissa_rm_epc.no_uprn_match ............. [[32mSUCCESS 1[0m in 0.74s]
[0m12:30:36.227399 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.no_uprn_match
[0m12:30:36.228067 [debug] [Thread-3 (]: Began running node model.rightmove_epc.address_match
[0m12:30:36.228745 [info ] [Thread-3 (]: 8 of 13 START sql view model dbt_melissa_rm_epc.address_match .................. [RUN]
[0m12:30:36.229411 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.dim_uprn, now model.rightmove_epc.address_match)
[0m12:30:36.229716 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.address_match
[0m12:30:36.232689 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.address_match"
[0m12:30:36.233365 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.address_match (compile): 12:30:36.229897 => 12:30:36.233212
[0m12:30:36.233643 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.address_match
[0m12:30:36.236158 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.address_match"
[0m12:30:36.237113 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.address_match"
[0m12:30:36.237381 [debug] [Thread-3 (]: On model.rightmove_epc.address_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.address_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NULL

    union all

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.no_uprn_match
),

epc_address as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
    where datasource = 'EPC'
)


SELECT rm.*,
CASE WHEN epc_address.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_address.ADDRESSID AS EPC_ADDRESSID


FROM rm
LEFT JOIN epc_address
ON rm.addressid = epc_address.addressid
and rm.FULL_POSTCODE = epc_address.POSTCODE
  );
[0m12:30:36.237634 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m12:30:36.822208 [debug] [Thread-3 (]: Snowflake adapter: Snowflake query id: 01b3448e-0103-9b63-0000-719506375c56
[0m12:30:36.822694 [debug] [Thread-3 (]: Snowflake adapter: Snowflake error: 001789 (42601): SQL compilation error:
invalid number of result columns for set operator input branches, expected 17, got 22 in branch 2
[0m12:30:36.823225 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.address_match (execute): 12:30:36.233813 => 12:30:36.823035
[0m12:30:36.823573 [debug] [Thread-3 (]: On model.rightmove_epc.address_match: Close
[0m12:30:36.912236 [debug] [Thread-3 (]: Database Error in model address_match (models/matching/address_match.sql)
  001789 (42601): SQL compilation error:
  invalid number of result columns for set operator input branches, expected 17, got 22 in branch 2
  compiled Code at target/run/rightmove_epc/models/matching/address_match.sql
[0m12:30:36.912812 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'db25270b-d2ab-4a21-a195-c9b113e4039d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114aab510>]}
[0m12:30:36.913371 [error] [Thread-3 (]: 8 of 13 ERROR creating sql view model dbt_melissa_rm_epc.address_match ......... [[31mERROR[0m in 0.68s]
[0m12:30:36.913918 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.address_match
[0m12:30:36.914660 [debug] [Thread-2 (]: Began running node model.rightmove_epc.all_matches
[0m12:30:36.915066 [debug] [Thread-4 (]: Began running node model.rightmove_epc.flats_report
[0m12:30:36.915380 [debug] [Thread-1 (]: Began running node model.rightmove_epc.houses_report
[0m12:30:36.915730 [debug] [Thread-3 (]: Began running node model.rightmove_epc.no_matches
[0m12:30:36.916046 [info ] [Thread-2 (]: 9 of 13 SKIP relation dbt_melissa_rm_epc.all_matches ........................... [[33mSKIP[0m]
[0m12:30:36.916437 [info ] [Thread-4 (]: 10 of 13 SKIP relation dbt_melissa_rm_epc.flats_report ......................... [[33mSKIP[0m]
[0m12:30:36.916811 [info ] [Thread-1 (]: 11 of 13 SKIP relation dbt_melissa_rm_epc.houses_report ........................ [[33mSKIP[0m]
[0m12:30:36.917146 [info ] [Thread-3 (]: 12 of 13 SKIP relation dbt_melissa_rm_epc.no_matches ........................... [[33mSKIP[0m]
[0m12:30:36.917470 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.all_matches
[0m12:30:36.917759 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.flats_report
[0m12:30:36.918036 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.houses_report
[0m12:30:36.918312 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.no_matches
[0m12:30:36.918825 [debug] [Thread-2 (]: Began running node model.rightmove_epc.zero_bedrooms
[0m12:30:36.919217 [info ] [Thread-2 (]: 13 of 13 SKIP relation dbt_melissa_rm_epc.zero_bedrooms ........................ [[33mSKIP[0m]
[0m12:30:36.919530 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.zero_bedrooms
[0m12:30:36.920963 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:30:36.921244 [debug] [MainThread]: Connection 'model.rightmove_epc.uprn_match' was properly closed.
[0m12:30:36.921461 [debug] [MainThread]: Connection 'model.rightmove_epc.address_simularity' was properly closed.
[0m12:30:36.921670 [debug] [MainThread]: Connection 'model.rightmove_epc.no_uprn_match' was properly closed.
[0m12:30:36.921873 [debug] [MainThread]: Connection 'model.rightmove_epc.address_match' was properly closed.
[0m12:30:36.922166 [info ] [MainThread]: 
[0m12:30:36.922431 [info ] [MainThread]: Finished running 13 view models in 0 hours 0 minutes and 4.09 seconds (4.09s).
[0m12:30:36.923458 [debug] [MainThread]: Command end result
[0m12:30:36.930806 [info ] [MainThread]: 
[0m12:30:36.931131 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m12:30:36.931327 [info ] [MainThread]: 
[0m12:30:36.931528 [error] [MainThread]:   Database Error in model address_match (models/matching/address_match.sql)
  001789 (42601): SQL compilation error:
  invalid number of result columns for set operator input branches, expected 17, got 22 in branch 2
  compiled Code at target/run/rightmove_epc/models/matching/address_match.sql
[0m12:30:36.931741 [info ] [MainThread]: 
[0m12:30:36.931941 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=1 SKIP=5 TOTAL=13
[0m12:30:36.933840 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 4.3910084, "process_user_time": 1.455145, "process_kernel_time": 0.192018, "process_mem_max_rss": "138788864", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m12:30:36.934242 [debug] [MainThread]: Command `dbt run` failed at 12:30:36.934154 after 4.39 seconds
[0m12:30:36.934533 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1120c34d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f0a110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11492f050>]}
[0m12:30:36.934788 [debug] [MainThread]: Flushing usage events
[0m12:31:02.275597 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b7530d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b73d510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b7084d0>]}


============================== 12:31:02.278649 | 8c8863b8-4487-42dc-bc85-7bdc1103a1f5 ==============================
[0m12:31:02.278649 [info ] [MainThread]: Running with dbt=1.7.10
[0m12:31:02.279007 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'fail_fast': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m12:31:02.449643 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8c8863b8-4487-42dc-bc85-7bdc1103a1f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c19d010>]}
[0m12:31:02.484716 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8c8863b8-4487-42dc-bc85-7bdc1103a1f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b7a8a10>]}
[0m12:31:02.485641 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m12:31:02.495318 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m12:31:02.512139 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m12:31:02.512469 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m12:31:02.515908 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8c8863b8-4487-42dc-bc85-7bdc1103a1f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c6200d0>]}
[0m12:31:02.522453 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8c8863b8-4487-42dc-bc85-7bdc1103a1f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c562590>]}
[0m12:31:02.522726 [info ] [MainThread]: Found 13 models, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m12:31:02.522931 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8c8863b8-4487-42dc-bc85-7bdc1103a1f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c139290>]}
[0m12:31:02.524078 [info ] [MainThread]: 
[0m12:31:02.524490 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m12:31:02.525230 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m12:31:02.531341 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m12:31:02.531566 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m12:31:02.531712 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:31:03.098549 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 1.0 seconds
[0m12:31:03.101434 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m12:31:03.189222 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m12:31:03.199120 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m12:31:03.199568 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m12:31:03.200010 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:31:03.615623 [debug] [ThreadPool]: SQL status: SUCCESS 13 in 0.0 seconds
[0m12:31:03.618493 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m12:31:03.712623 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8c8863b8-4487-42dc-bc85-7bdc1103a1f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c1ac810>]}
[0m12:31:03.713922 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m12:31:03.714396 [info ] [MainThread]: 
[0m12:31:03.718228 [debug] [Thread-1 (]: Began running node model.rightmove_epc.stg_epc_certs
[0m12:31:03.718729 [debug] [Thread-2 (]: Began running node model.rightmove_epc.stg_rightmove
[0m12:31:03.719373 [info ] [Thread-1 (]: 1 of 13 START sql view model dbt_melissa_rm_epc.stg_epc_certs .................. [RUN]
[0m12:31:03.719941 [info ] [Thread-2 (]: 2 of 13 START sql view model dbt_melissa_rm_epc.stg_rightmove .................. [RUN]
[0m12:31:03.720883 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.stg_epc_certs)
[0m12:31:03.721660 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.stg_rightmove'
[0m12:31:03.722076 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.stg_epc_certs
[0m12:31:03.722514 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.stg_rightmove
[0m12:31:03.730093 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.stg_epc_certs"
[0m12:31:03.732032 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.stg_rightmove"
[0m12:31:03.732758 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (compile): 12:31:03.730412 => 12:31:03.732538
[0m12:31:03.733049 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (compile): 12:31:03.722790 => 12:31:03.732914
[0m12:31:03.733265 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.stg_rightmove
[0m12:31:03.733460 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.stg_epc_certs
[0m12:31:03.783938 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.stg_rightmove"
[0m12:31:03.785738 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.stg_epc_certs"
[0m12:31:03.786524 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.stg_rightmove"
[0m12:31:03.787136 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.stg_epc_certs"
[0m12:31:03.787385 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_rightmove"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
  
   as (
    with rm as (

    SELECT 
    LISTING_ID,
    CHANGE_DATE,
    UPPER(TRIM(replace(REPLACE(CONCAT(ADDRESS_1::VARCHAR,ADDRESS_2::VARCHAR),' '),','))) AS ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, 
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    BEDROOM,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    STUDENTLET_FLAG,
    COMBINED_PROPERTY_TYPE
    -- property type
    FROM 
       ANALYTICS.RIGHTMOVE_PROD.CLEAN_RAW_RIGHTMOVE_DATA 

 
)

SELECT * FROM rm
  );
[0m12:31:03.787634 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_epc_certs"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
  
   as (
    WITH epc_certs as (
    
    select 
    UPRN,
    LODGEMENT_DATE,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    COUNTY,
    LOCAL_AUTHORITY as LOCAL_AUTHORITY_CODE,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    UPPER(CASE WHEN (UPPER(ADDRESS1) LIKE 'FLAT%' OR UPPER(ADDRESS1) LIKE 'UNIT%') or UPPER(ADDRESS1) LIKE 'ROOM%' 
    THEN TRIM(REPLACE(REPLACE(CONCAT(ADDRESS),','),' '))
    ELSE trim(replace(replace(ADDRESS1,' '),',')) END) AS ADDRESSID,
    CASE WHEN UPRN is null and addressid is null THEN 1 else 0 end as REMOVE_FROM_RM_MATCH,
    FLOOR_LEVEL,
    FLAT_TOP_STOREY,
    FLAT_STOREY_COUNT,
    PROPERTY_TYPE
 from  RAW.EPC_TEST_DATA.EPC_CERTIFICATES 

)

SELECT * FROM epc_certs
  );
[0m12:31:03.787841 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m12:31:03.788000 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:31:04.277980 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m12:31:04.290757 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (execute): 12:31:03.784155 => 12:31:04.290624
[0m12:31:04.291028 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: Close
[0m12:31:04.377242 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8c8863b8-4487-42dc-bc85-7bdc1103a1f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c3096d0>]}
[0m12:31:04.377847 [info ] [Thread-1 (]: 1 of 13 OK created sql view model dbt_melissa_rm_epc.stg_epc_certs ............. [[32mSUCCESS 1[0m in 0.66s]
[0m12:31:04.378251 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.stg_epc_certs
[0m12:31:04.573697 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:31:04.576237 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (execute): 12:31:03.733624 => 12:31:04.576063
[0m12:31:04.576574 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: Close
[0m12:31:04.664181 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8c8863b8-4487-42dc-bc85-7bdc1103a1f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c3b6f90>]}
[0m12:31:04.665001 [info ] [Thread-2 (]: 2 of 13 OK created sql view model dbt_melissa_rm_epc.stg_rightmove ............. [[32mSUCCESS 1[0m in 0.94s]
[0m12:31:04.665681 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.stg_rightmove
[0m12:31:04.666734 [debug] [Thread-4 (]: Began running node model.rightmove_epc.dim_addressid
[0m12:31:04.667327 [debug] [Thread-3 (]: Began running node model.rightmove_epc.dim_uprn
[0m12:31:04.668069 [info ] [Thread-4 (]: 3 of 13 START sql view model dbt_melissa_rm_epc.dim_addressid .................. [RUN]
[0m12:31:04.668704 [info ] [Thread-3 (]: 4 of 13 START sql view model dbt_melissa_rm_epc.dim_uprn ....................... [RUN]
[0m12:31:04.669669 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_addressid'
[0m12:31:04.670390 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_uprn'
[0m12:31:04.670812 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.dim_addressid
[0m12:31:04.671239 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.dim_uprn
[0m12:31:04.674872 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.dim_addressid"
[0m12:31:04.677700 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.dim_uprn"
[0m12:31:04.678649 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.dim_uprn (compile): 12:31:04.675221 => 12:31:04.678361
[0m12:31:04.679084 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_addressid (compile): 12:31:04.671531 => 12:31:04.678884
[0m12:31:04.679408 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.dim_uprn
[0m12:31:04.679759 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.dim_addressid
[0m12:31:04.682902 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.dim_uprn"
[0m12:31:04.685317 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.dim_addressid"
[0m12:31:04.686407 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.dim_uprn"
[0m12:31:04.687230 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.dim_addressid"
[0m12:31:04.687549 [debug] [Thread-3 (]: On model.rightmove_epc.dim_uprn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_uprn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE UPRNS


with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource,
    POSTCODE
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    where REMOVE_FROM_RM_MATCH = 0
    AND UPRN IS NOT NULL
),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    WHERE UPRN IS NOT NULL

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where uprn is not null
  );
[0m12:31:04.687901 [debug] [Thread-4 (]: On model.rightmove_epc.dim_addressid: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_addressid"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE ADDRESS'

with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource,
    POSTCODE

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    where REMOVE_FROM_RM_MATCH = 0
    AND ADDRESSID IS NOT NULL

),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    WHERE ADDRESSID IS NOT NULL

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where uprn is null
and addressid is not null
  );
[0m12:31:04.688198 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m12:31:04.688443 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m12:31:05.221885 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:31:05.224564 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_addressid (execute): 12:31:04.683123 => 12:31:05.224371
[0m12:31:05.224939 [debug] [Thread-4 (]: On model.rightmove_epc.dim_addressid: Close
[0m12:31:05.252804 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:31:05.255187 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.dim_uprn (execute): 12:31:04.679977 => 12:31:05.254993
[0m12:31:05.255560 [debug] [Thread-3 (]: On model.rightmove_epc.dim_uprn: Close
[0m12:31:05.309062 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8c8863b8-4487-42dc-bc85-7bdc1103a1f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c511450>]}
[0m12:31:05.309646 [info ] [Thread-4 (]: 3 of 13 OK created sql view model dbt_melissa_rm_epc.dim_addressid ............. [[32mSUCCESS 1[0m in 0.64s]
[0m12:31:05.310120 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.dim_addressid
[0m12:31:05.310617 [debug] [Thread-2 (]: Began running node model.rightmove_epc.address_match
[0m12:31:05.310948 [debug] [Thread-1 (]: Began running node model.rightmove_epc.address_simularity
[0m12:31:05.311348 [info ] [Thread-2 (]: 5 of 13 START sql view model dbt_melissa_rm_epc.address_match .................. [RUN]
[0m12:31:05.311736 [info ] [Thread-1 (]: 6 of 13 START sql view model dbt_melissa_rm_epc.address_simularity ............. [RUN]
[0m12:31:05.312284 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_rightmove, now model.rightmove_epc.address_match)
[0m12:31:05.312772 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_epc_certs, now model.rightmove_epc.address_simularity)
[0m12:31:05.313059 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.address_match
[0m12:31:05.313328 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.address_simularity
[0m12:31:05.316288 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.address_simularity"
[0m12:31:05.318318 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.address_match"
[0m12:31:05.319156 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.address_match (compile): 12:31:05.313497 => 12:31:05.318956
[0m12:31:05.319488 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.address_simularity (compile): 12:31:05.314032 => 12:31:05.319338
[0m12:31:05.319724 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.address_match
[0m12:31:05.319987 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.address_simularity
[0m12:31:05.322579 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.address_match"
[0m12:31:05.326066 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.address_simularity"
[0m12:31:05.327059 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.address_match"
[0m12:31:05.327681 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.address_simularity"
[0m12:31:05.327949 [debug] [Thread-2 (]: On model.rightmove_epc.address_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.address_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NULL

),

epc_address as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
    where datasource = 'EPC'
)


SELECT rm.*,
CASE WHEN epc_address.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_address.ADDRESSID AS EPC_ADDRESSID


FROM rm
LEFT JOIN epc_address
ON rm.addressid = epc_address.addressid
and rm.FULL_POSTCODE = epc_address.POSTCODE
  );
[0m12:31:05.328244 [debug] [Thread-1 (]: On model.rightmove_epc.address_simularity: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.address_simularity"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.address_simularity
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NULL
),

epc_address as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
    where datasource = 'EPC'
)


SELECT rm.*,epc_address.addressid as EPC_ADDRESSID
FROM rm
JOIN epc_address
ON JAROWINKLER_SIMILARITY(rm.addressid, epc_address.addressid) = 1
  );
[0m12:31:05.328551 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m12:31:05.328831 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:31:05.355500 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8c8863b8-4487-42dc-bc85-7bdc1103a1f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d715a90>]}
[0m12:31:05.355969 [info ] [Thread-3 (]: 4 of 13 OK created sql view model dbt_melissa_rm_epc.dim_uprn .................. [[32mSUCCESS 1[0m in 0.69s]
[0m12:31:05.356345 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.dim_uprn
[0m12:31:05.356759 [debug] [Thread-4 (]: Began running node model.rightmove_epc.no_uprn_match
[0m12:31:05.357044 [debug] [Thread-3 (]: Began running node model.rightmove_epc.uprn_match
[0m12:31:05.357297 [info ] [Thread-4 (]: 7 of 13 START sql view model dbt_melissa_rm_epc.no_uprn_match .................. [RUN]
[0m12:31:05.357645 [info ] [Thread-3 (]: 8 of 13 START sql view model dbt_melissa_rm_epc.uprn_match ..................... [RUN]
[0m12:31:05.358118 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.dim_addressid, now model.rightmove_epc.no_uprn_match)
[0m12:31:05.358516 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.dim_uprn, now model.rightmove_epc.uprn_match)
[0m12:31:05.358748 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.no_uprn_match
[0m12:31:05.358962 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.uprn_match
[0m12:31:05.361160 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.no_uprn_match"
[0m12:31:05.363030 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.uprn_match"
[0m12:31:05.363733 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.no_uprn_match (compile): 12:31:05.359104 => 12:31:05.363598
[0m12:31:05.364003 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.uprn_match (compile): 12:31:05.361323 => 12:31:05.363865
[0m12:31:05.364230 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.no_uprn_match
[0m12:31:05.364446 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.uprn_match
[0m12:31:05.366441 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.no_uprn_match"
[0m12:31:05.368624 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.uprn_match"
[0m12:31:05.369782 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.uprn_match"
[0m12:31:05.370537 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.no_uprn_match"
[0m12:31:05.370851 [debug] [Thread-3 (]: On model.rightmove_epc.uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NOT NULL
),

change_date AS (
    SELECT 
        UPRN AS UPRN_CD, 
        MAX(CHANGE_DATE) AS MAX_CHANGE_DATE 
    FROM rm
    GROUP BY UPRN
),

rm_latest as (

    SELECT * FROM rm
    LEFT JOIN change_date cd
    ON rm.UPRN = cd.UPRN_CD
    WHERE cd.MAX_CHANGE_DATE = rm.CHANGE_DATE ),

epc_uprn as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
    where datasource = 'EPC'
)


SELECT rm_latest.*,
CASE WHEN epc_uprn.UPRN is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_uprn.UPRN AS EPC_UPRN,
epc_uprn.ADDRESSID AS EPC_ADDRESSID


FROM rm_latest
LEFT JOIN epc_uprn
ON rm_latest.UPRN = epc_uprn.UPRN

WHERE MATCH_EPC = 'YES'
  );
[0m12:31:05.371151 [debug] [Thread-4 (]: On model.rightmove_epc.no_uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.no_uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.no_uprn_match
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NOT NULL
),

change_date AS (
    SELECT 
        UPRN AS UPRN_CD, 
        MAX(CHANGE_DATE) AS MAX_CHANGE_DATE 
    FROM rm
    GROUP BY UPRN
),

rm_latest as (

    SELECT * FROM rm
    LEFT JOIN change_date cd
    ON rm.UPRN = cd.UPRN_CD
    WHERE cd.MAX_CHANGE_DATE = rm.CHANGE_DATE ),

epc_uprn as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
    where datasource = 'EPC'
)


SELECT rm_latest.*,
CASE WHEN epc_uprn.UPRN is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_uprn.UPRN AS EPC_UPRN,
epc_uprn.ADDRESSID AS EPC_ADDRESSID


FROM rm_latest
LEFT JOIN epc_uprn
ON rm_latest.UPRN = epc_uprn.UPRN

WHERE MATCH_EPC = 'NO'
  );
[0m12:31:05.371391 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m12:31:05.371578 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m12:31:06.098922 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:31:06.100686 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:31:06.104836 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.address_match (execute): 12:31:05.320168 => 12:31:06.104508
[0m12:31:06.108583 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.address_simularity (execute): 12:31:05.322830 => 12:31:06.108342
[0m12:31:06.109434 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:31:06.109997 [debug] [Thread-2 (]: On model.rightmove_epc.address_match: Close
[0m12:31:06.110627 [debug] [Thread-1 (]: On model.rightmove_epc.address_simularity: Close
[0m12:31:06.113594 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.uprn_match (execute): 12:31:05.366696 => 12:31:06.113392
[0m12:31:06.116505 [debug] [Thread-3 (]: On model.rightmove_epc.uprn_match: Close
[0m12:31:06.148689 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:31:06.151859 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.no_uprn_match (execute): 12:31:05.364591 => 12:31:06.151667
[0m12:31:06.152228 [debug] [Thread-4 (]: On model.rightmove_epc.no_uprn_match: Close
[0m12:31:06.205208 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8c8863b8-4487-42dc-bc85-7bdc1103a1f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c563e50>]}
[0m12:31:06.206127 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8c8863b8-4487-42dc-bc85-7bdc1103a1f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d71eb90>]}
[0m12:31:06.206783 [info ] [Thread-1 (]: 6 of 13 OK created sql view model dbt_melissa_rm_epc.address_simularity ........ [[32mSUCCESS 1[0m in 0.89s]
[0m12:31:06.207547 [info ] [Thread-3 (]: 8 of 13 OK created sql view model dbt_melissa_rm_epc.uprn_match ................ [[32mSUCCESS 1[0m in 0.85s]
[0m12:31:06.208191 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.address_simularity
[0m12:31:06.208728 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.uprn_match
[0m12:31:06.209536 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8c8863b8-4487-42dc-bc85-7bdc1103a1f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c5b9450>]}
[0m12:31:06.210285 [info ] [Thread-2 (]: 5 of 13 OK created sql view model dbt_melissa_rm_epc.address_match ............. [[32mSUCCESS 1[0m in 0.90s]
[0m12:31:06.210818 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.address_match
[0m12:31:06.211377 [debug] [Thread-1 (]: Began running node model.rightmove_epc.all_matches
[0m12:31:06.211770 [debug] [Thread-3 (]: Began running node model.rightmove_epc.flats_report
[0m12:31:06.212159 [info ] [Thread-1 (]: 9 of 13 START sql view model dbt_melissa_rm_epc.all_matches .................... [RUN]
[0m12:31:06.213225 [debug] [Thread-2 (]: Began running node model.rightmove_epc.houses_report
[0m12:31:06.212790 [info ] [Thread-3 (]: 10 of 13 START sql view model dbt_melissa_rm_epc.flats_report .................. [RUN]
[0m12:31:06.214034 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.address_simularity, now model.rightmove_epc.all_matches)
[0m12:31:06.214508 [info ] [Thread-2 (]: 11 of 13 START sql view model dbt_melissa_rm_epc.houses_report ................. [RUN]
[0m12:31:06.215204 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.uprn_match, now model.rightmove_epc.flats_report)
[0m12:31:06.215663 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.all_matches
[0m12:31:06.216291 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.address_match, now model.rightmove_epc.houses_report)
[0m12:31:06.216617 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.flats_report
[0m12:31:06.219557 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.all_matches"
[0m12:31:06.220012 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.houses_report
[0m12:31:06.223277 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.flats_report"
[0m12:31:06.226607 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.houses_report"
[0m12:31:06.227430 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.all_matches (compile): 12:31:06.216820 => 12:31:06.227233
[0m12:31:06.227720 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.all_matches
[0m12:31:06.230159 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.all_matches"
[0m12:31:06.230632 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.houses_report (compile): 12:31:06.223724 => 12:31:06.230484
[0m12:31:06.230933 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.flats_report (compile): 12:31:06.220284 => 12:31:06.230784
[0m12:31:06.231207 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.houses_report
[0m12:31:06.231444 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.flats_report
[0m12:31:06.232399 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.all_matches"
[0m12:31:06.235735 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.houses_report"
[0m12:31:06.237925 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.flats_report"
[0m12:31:06.238265 [debug] [Thread-1 (]: On model.rightmove_epc.all_matches: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.all_matches"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.all_matches
  
   as (
    with addr as (

    select 
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    '' AS EPC_UPRN,
    EPC_ADDRESSID
    
    from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
    where MATCH_EPC = 'YES' 
),

uprn as (

    select 
    
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN::VARCHAR AS EPC_UPRN,
    EPC_ADDRESSID
     from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'YES'
),

final as (

select 'ADDRESS AND POSTCODE MATCH' AS MATCH_RESULT, * from addr
union all
select 'UPRN MATCH' AS MATCH_RESULT, * from uprn
)

select * from final
  );
[0m12:31:06.238701 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:31:06.241000 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.houses_report"
[0m12:31:06.242546 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.flats_report"
[0m12:31:06.242934 [debug] [Thread-2 (]: On model.rightmove_epc.houses_report: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.houses_report"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.houses_report
  
   as (
    with epc_max_date as (

    select uprn as UPRN_EPC,
    MAX(LODGEMENT_DATE) AS MAX_LODGEMENT_DATE,
    from  ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    group by 1


),

latest_epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc
    inner join epc_max_date on epc.uprn = epc_max_date.UPRN_EPC
    where MAX_LODGEMENT_DATE = LODGEMENT_DATE

),

 house_addmatch as (

    select 
    distinct
    --count(LISTING_ID) as TOTAL_LISTINGS,
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN, -- NULL
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
 --   am.FLOOR_LEVEL as RM_FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    COUNTY,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    epc.ADDRESSID AS EPC_ADDRESSID,
    -- REMOVE_FROM_RM_MATCH,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

     from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc on am.EPC_ADDRESSID = epc.ADDRESSID
    and am.FULL_POSTCODE = epc.POSTCODE
    where MATCH_EPC = 'YES'
    and COMBINED_PROPERTY_TYPE not in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')

),

house_uprnmatch as (

    select 
    distinct
    --count(LISTING_ID) as TOTAL_LISTINGS,
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN, -- NULL
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
  --  am.FLOOR_LEVEL as RM_FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    COUNTY,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    epc.ADDRESSID AS EPC_ADDRESSID,
    -- REMOVE_FROM_RM_MATCH,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

    

    from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match am
    inner join latest_epc epc on am.EPC_UPRN = epc.UPRN

    where MATCH_EPC = 'YES'
   and COMBINED_PROPERTY_TYPE not in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')
  -- AND RM_UPRN = 100030719363

)


select 'UPRN' as MATCH_TYPE, * from house_uprnmatch

union all

select 'ADDRESSID' as MATCH_TYPE, * from house_addmatch

/*
--THIS IS USED FOR A TEST
select RM_UPRN,COUNT(BUILDING_REFERENCE_NUMBER)
from house_uprnmatch
WHERE RM_UPRN IS NOT NULL
GROUP BY 1
HAVING COUNT(BUILDING_REFERENCE_NUMBER) >1
*/
  );
[0m12:31:06.243398 [debug] [Thread-3 (]: On model.rightmove_epc.flats_report: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.flats_report"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.flats_report
  
   as (
    with epc_max_date as (

    select uprn as UPRN_EPC,
    MAX(LODGEMENT_DATE) AS MAX_LODGEMENT_DATE,
    from  ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    group by 1


),

latest_epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc
    inner join epc_max_date on epc.uprn = epc_max_date.UPRN_EPC
    where MAX_LODGEMENT_DATE = LODGEMENT_DATE

),

 house_addmatch as (

    select 
    distinct
    --count(LISTING_ID) as TOTAL_LISTINGS,
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN, -- NULL
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
 --   am.FLOOR_LEVEL as RM_FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    COUNTY,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    epc.ADDRESSID AS EPC_ADDRESSID,
    -- REMOVE_FROM_RM_MATCH,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

     from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc on am.EPC_ADDRESSID = epc.ADDRESSID
    and am.FULL_POSTCODE = epc.POSTCODE
    where MATCH_EPC = 'YES'
    and COMBINED_PROPERTY_TYPE in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')

),

house_uprnmatch as (

    select 
    distinct
    --count(LISTING_ID) as TOTAL_LISTINGS,
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN, -- NULL
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
  --  am.FLOOR_LEVEL as RM_FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    COUNTY,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    epc.ADDRESSID AS EPC_ADDRESSID,
    -- REMOVE_FROM_RM_MATCH,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

    

    from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match am
    inner join latest_epc epc on am.EPC_UPRN = epc.UPRN

    where MATCH_EPC = 'YES'
   and COMBINED_PROPERTY_TYPE in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')
  -- AND RM_UPRN = 100030719363

)


select 'UPRN' as MATCH_TYPE, * from house_uprnmatch

union all

select 'ADDRESSID' as MATCH_TYPE, * from house_addmatch

/*
--THIS IS USED FOR A TEST
select RM_UPRN,COUNT(BUILDING_REFERENCE_NUMBER)
from house_uprnmatch
WHERE RM_UPRN IS NOT NULL
GROUP BY 1
HAVING COUNT(BUILDING_REFERENCE_NUMBER) >1
*/
  );
[0m12:31:06.243728 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m12:31:06.244101 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m12:31:06.246775 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8c8863b8-4487-42dc-bc85-7bdc1103a1f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d71f510>]}
[0m12:31:06.247130 [info ] [Thread-4 (]: 7 of 13 OK created sql view model dbt_melissa_rm_epc.no_uprn_match ............. [[32mSUCCESS 1[0m in 0.89s]
[0m12:31:06.247456 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.no_uprn_match
[0m12:31:06.247697 [debug] [Thread-4 (]: Began running node model.rightmove_epc.no_matches
[0m12:31:06.247965 [info ] [Thread-4 (]: 12 of 13 START sql view model dbt_melissa_rm_epc.no_matches .................... [RUN]
[0m12:31:06.248329 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.no_uprn_match, now model.rightmove_epc.no_matches)
[0m12:31:06.248528 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.no_matches
[0m12:31:06.250391 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.no_matches"
[0m12:31:06.251529 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.no_matches (compile): 12:31:06.248649 => 12:31:06.251408
[0m12:31:06.251723 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.no_matches
[0m12:31:06.253568 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.no_matches"
[0m12:31:06.254522 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.no_matches"
[0m12:31:06.254767 [debug] [Thread-4 (]: On model.rightmove_epc.no_matches: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.no_matches"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.no_matches
  
   as (
    with addr as (

    select 
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    '' AS EPC_UPRN,
    EPC_ADDRESSID
    
    from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
    where MATCH_EPC = 'NO' 
),

uprn as (

    select 
    
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN::VARCHAR AS EPC_UPRN,
    EPC_ADDRESSID
    
     from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'NO'
),

final as (

select 'NO ADDRESS OR UPRN MATCH' AS MATCH_RESULT, * from addr
union all
select 'NO UPRN MATCH' AS MATCH_RESULT, * from uprn
)

select * from final
  );
[0m12:31:06.254986 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m12:31:06.883442 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:31:06.883975 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:31:06.885638 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.no_matches (execute): 12:31:06.251852 => 12:31:06.885510
[0m12:31:06.887052 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.all_matches (execute): 12:31:06.227918 => 12:31:06.886942
[0m12:31:06.887299 [debug] [Thread-4 (]: On model.rightmove_epc.no_matches: Close
[0m12:31:06.887511 [debug] [Thread-1 (]: On model.rightmove_epc.all_matches: Close
[0m12:31:06.919167 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:31:06.920874 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.houses_report (execute): 12:31:06.232562 => 12:31:06.920743
[0m12:31:06.921208 [debug] [Thread-2 (]: On model.rightmove_epc.houses_report: Close
[0m12:31:06.962891 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8c8863b8-4487-42dc-bc85-7bdc1103a1f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d71e950>]}
[0m12:31:06.963377 [info ] [Thread-4 (]: 12 of 13 OK created sql view model dbt_melissa_rm_epc.no_matches ............... [[32mSUCCESS 1[0m in 0.71s]
[0m12:31:06.963752 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.no_matches
[0m12:31:06.984792 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8c8863b8-4487-42dc-bc85-7bdc1103a1f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d0c91d0>]}
[0m12:31:06.985291 [info ] [Thread-1 (]: 9 of 13 OK created sql view model dbt_melissa_rm_epc.all_matches ............... [[32mSUCCESS 1[0m in 0.77s]
[0m12:31:06.985661 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.all_matches
[0m12:31:07.001942 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:31:07.003785 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.flats_report (execute): 12:31:06.235989 => 12:31:07.003645
[0m12:31:07.004328 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8c8863b8-4487-42dc-bc85-7bdc1103a1f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d714e10>]}
[0m12:31:07.004591 [debug] [Thread-3 (]: On model.rightmove_epc.flats_report: Close
[0m12:31:07.004996 [info ] [Thread-2 (]: 11 of 13 OK created sql view model dbt_melissa_rm_epc.houses_report ............ [[32mSUCCESS 1[0m in 0.79s]
[0m12:31:07.005915 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.houses_report
[0m12:31:07.087473 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8c8863b8-4487-42dc-bc85-7bdc1103a1f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c5ee5d0>]}
[0m12:31:07.088044 [info ] [Thread-3 (]: 10 of 13 OK created sql view model dbt_melissa_rm_epc.flats_report ............. [[32mSUCCESS 1[0m in 0.87s]
[0m12:31:07.088460 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.flats_report
[0m12:31:07.088925 [debug] [Thread-4 (]: Began running node model.rightmove_epc.zero_bedrooms
[0m12:31:07.089360 [info ] [Thread-4 (]: 13 of 13 START sql view model dbt_melissa_rm_epc.zero_bedrooms ................. [RUN]
[0m12:31:07.089936 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.no_matches, now model.rightmove_epc.zero_bedrooms)
[0m12:31:07.090206 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.zero_bedrooms
[0m12:31:07.092422 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.zero_bedrooms"
[0m12:31:07.093077 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.zero_bedrooms (compile): 12:31:07.090364 => 12:31:07.092928
[0m12:31:07.093339 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.zero_bedrooms
[0m12:31:07.096314 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.zero_bedrooms"
[0m12:31:07.097192 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.zero_bedrooms"
[0m12:31:07.097485 [debug] [Thread-4 (]: On model.rightmove_epc.zero_bedrooms: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.zero_bedrooms"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.zero_bedrooms
  
   as (
    with houses as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.houses_report
    where BEDROOM = 0
),

flats as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.flats_report
        where BEDROOM = 0

)

select * from flats
union all
select * from houses
  );
[0m12:31:07.097729 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m12:31:08.043337 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:31:08.046184 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.zero_bedrooms (execute): 12:31:07.093492 => 12:31:08.045958
[0m12:31:08.046621 [debug] [Thread-4 (]: On model.rightmove_epc.zero_bedrooms: Close
[0m12:31:08.124956 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8c8863b8-4487-42dc-bc85-7bdc1103a1f5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c1eb650>]}
[0m12:31:08.125644 [info ] [Thread-4 (]: 13 of 13 OK created sql view model dbt_melissa_rm_epc.zero_bedrooms ............ [[32mSUCCESS 1[0m in 1.04s]
[0m12:31:08.126168 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.zero_bedrooms
[0m12:31:08.127763 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:31:08.128048 [debug] [MainThread]: Connection 'model.rightmove_epc.all_matches' was properly closed.
[0m12:31:08.128302 [debug] [MainThread]: Connection 'model.rightmove_epc.houses_report' was properly closed.
[0m12:31:08.128542 [debug] [MainThread]: Connection 'model.rightmove_epc.zero_bedrooms' was properly closed.
[0m12:31:08.128779 [debug] [MainThread]: Connection 'model.rightmove_epc.flats_report' was properly closed.
[0m12:31:08.129092 [info ] [MainThread]: 
[0m12:31:08.129385 [info ] [MainThread]: Finished running 13 view models in 0 hours 0 minutes and 5.60 seconds (5.60s).
[0m12:31:08.131008 [debug] [MainThread]: Command end result
[0m12:31:08.138720 [info ] [MainThread]: 
[0m12:31:08.139097 [info ] [MainThread]: [32mCompleted successfully[0m
[0m12:31:08.139398 [info ] [MainThread]: 
[0m12:31:08.139648 [info ] [MainThread]: Done. PASS=13 WARN=0 ERROR=0 SKIP=0 TOTAL=13
[0m12:31:08.141623 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 5.893585, "process_user_time": 1.641661, "process_kernel_time": 0.201686, "process_mem_max_rss": "141410304", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m12:31:08.142092 [debug] [MainThread]: Command `dbt run` succeeded at 12:31:08.141996 after 5.89 seconds
[0m12:31:08.142391 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b787490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b7527d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106059d90>]}
[0m12:31:08.142675 [debug] [MainThread]: Flushing usage events
[0m12:52:03.946043 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10601a050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106062150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106062d90>]}


============================== 12:52:03.948771 | 5e52033b-9eee-4418-92eb-3211a7bae61b ==============================
[0m12:52:03.948771 [info ] [MainThread]: Running with dbt=1.7.10
[0m12:52:03.949114 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'debug': 'False', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m12:52:04.124489 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5e52033b-9eee-4418-92eb-3211a7bae61b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106037110>]}
[0m12:52:04.157556 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5e52033b-9eee-4418-92eb-3211a7bae61b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107dafe90>]}
[0m12:52:04.158065 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m12:52:04.167550 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m12:52:04.191651 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m12:52:04.191942 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m12:52:04.196235 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5e52033b-9eee-4418-92eb-3211a7bae61b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11128ca10>]}
[0m12:52:04.204675 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5e52033b-9eee-4418-92eb-3211a7bae61b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11108fa10>]}
[0m12:52:04.205065 [info ] [MainThread]: Found 14 models, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m12:52:04.205275 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5e52033b-9eee-4418-92eb-3211a7bae61b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107d38d10>]}
[0m12:52:04.206554 [info ] [MainThread]: 
[0m12:52:04.207033 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m12:52:04.207826 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m12:52:04.214393 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m12:52:04.214669 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m12:52:04.214815 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:52:04.846651 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 1.0 seconds
[0m12:52:04.849170 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m12:52:04.929570 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m12:52:04.937193 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m12:52:04.937552 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m12:52:04.937823 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:52:05.299043 [debug] [ThreadPool]: SQL status: SUCCESS 14 in 0.0 seconds
[0m12:52:05.301363 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m12:52:05.381539 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5e52033b-9eee-4418-92eb-3211a7bae61b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111010050>]}
[0m12:52:05.382416 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m12:52:05.382763 [info ] [MainThread]: 
[0m12:52:05.385882 [debug] [Thread-1 (]: Began running node model.rightmove_epc.stg_epc_certs
[0m12:52:05.386211 [debug] [Thread-2 (]: Began running node model.rightmove_epc.stg_rightmove
[0m12:52:05.386620 [info ] [Thread-1 (]: 1 of 14 START sql view model dbt_melissa_rm_epc.stg_epc_certs .................. [RUN]
[0m12:52:05.386996 [info ] [Thread-2 (]: 2 of 14 START sql view model dbt_melissa_rm_epc.stg_rightmove .................. [RUN]
[0m12:52:05.387638 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.stg_epc_certs)
[0m12:52:05.388276 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.stg_rightmove'
[0m12:52:05.388597 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.stg_epc_certs
[0m12:52:05.388924 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.stg_rightmove
[0m12:52:05.395173 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.stg_epc_certs"
[0m12:52:05.398711 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.stg_rightmove"
[0m12:52:05.400798 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (compile): 12:52:05.395469 => 12:52:05.400534
[0m12:52:05.401121 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.stg_rightmove
[0m12:52:05.401663 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (compile): 12:52:05.389129 => 12:52:05.401307
[0m12:52:05.458229 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.stg_epc_certs
[0m12:52:05.461404 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.stg_rightmove"
[0m12:52:05.463293 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.stg_epc_certs"
[0m12:52:05.464114 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.stg_rightmove"
[0m12:52:05.464334 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_rightmove"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
  
   as (
    with rm as (

    SELECT 
    LISTING_ID,
    CHANGE_DATE,
    UPPER(TRIM(replace(REPLACE(CONCAT(ADDRESS_1::VARCHAR,ADDRESS_2::VARCHAR),' '),','))) AS ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, 
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    BEDROOM,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    STUDENTLET_FLAG,
    COMBINED_PROPERTY_TYPE
    -- property type
    FROM 
       ANALYTICS.RIGHTMOVE_PROD.CLEAN_RAW_RIGHTMOVE_DATA 

 
)

SELECT * FROM rm
  );
[0m12:52:05.464926 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.stg_epc_certs"
[0m12:52:05.465119 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m12:52:05.465331 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_epc_certs"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
  
   as (
    WITH epc_certs as (
    
    select 
    UPRN,
    LODGEMENT_DATE,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    COUNTY,
    LOCAL_AUTHORITY as LOCAL_AUTHORITY_CODE,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    UPPER(CASE WHEN (UPPER(ADDRESS1) LIKE 'FLAT%' OR UPPER(ADDRESS1) LIKE 'UNIT%') or UPPER(ADDRESS1) LIKE 'ROOM%' 
    THEN TRIM(REPLACE(REPLACE(CONCAT(ADDRESS),','),' '))
    ELSE trim(replace(replace(ADDRESS1,' '),',')) END) AS ADDRESSID,
    CASE WHEN UPRN is null and addressid is null THEN 1 else 0 end as REMOVE_FROM_RM_MATCH,
    FLOOR_LEVEL,
    FLAT_TOP_STOREY,
    FLAT_STOREY_COUNT,
    PROPERTY_TYPE
 from  RAW.EPC_TEST_DATA.EPC_CERTIFICATES 

)

SELECT * FROM epc_certs
  );
[0m12:52:05.466115 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:52:05.987778 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:52:06.004958 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (execute): 12:52:05.401853 => 12:52:06.004792
[0m12:52:06.005284 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: Close
[0m12:52:06.084767 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5e52033b-9eee-4418-92eb-3211a7bae61b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111209510>]}
[0m12:52:06.085404 [info ] [Thread-2 (]: 2 of 14 OK created sql view model dbt_melissa_rm_epc.stg_rightmove ............. [[32mSUCCESS 1[0m in 0.70s]
[0m12:52:06.085830 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.stg_rightmove
[0m12:52:06.135636 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:52:06.137960 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (execute): 12:52:05.461604 => 12:52:06.137787
[0m12:52:06.138283 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: Close
[0m12:52:06.221766 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5e52033b-9eee-4418-92eb-3211a7bae61b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1112a9d50>]}
[0m12:52:06.222475 [info ] [Thread-1 (]: 1 of 14 OK created sql view model dbt_melissa_rm_epc.stg_epc_certs ............. [[32mSUCCESS 1[0m in 0.83s]
[0m12:52:06.223030 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.stg_epc_certs
[0m12:52:06.223690 [debug] [Thread-4 (]: Began running node model.rightmove_epc.dim_addressid
[0m12:52:06.224048 [debug] [Thread-3 (]: Began running node model.rightmove_epc.dim_uprn
[0m12:52:06.224362 [info ] [Thread-4 (]: 3 of 14 START sql view model dbt_melissa_rm_epc.dim_addressid .................. [RUN]
[0m12:52:06.224733 [info ] [Thread-3 (]: 4 of 14 START sql view model dbt_melissa_rm_epc.dim_uprn ....................... [RUN]
[0m12:52:06.225424 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_addressid'
[0m12:52:06.226026 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_uprn'
[0m12:52:06.226338 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.dim_addressid
[0m12:52:06.226617 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.dim_uprn
[0m12:52:06.229614 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.dim_addressid"
[0m12:52:06.231780 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.dim_uprn"
[0m12:52:06.232892 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_addressid (compile): 12:52:06.226799 => 12:52:06.232727
[0m12:52:06.233322 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.dim_uprn (compile): 12:52:06.229856 => 12:52:06.233081
[0m12:52:06.233654 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.dim_addressid
[0m12:52:06.233979 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.dim_uprn
[0m12:52:06.236695 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.dim_addressid"
[0m12:52:06.238842 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.dim_uprn"
[0m12:52:06.239868 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.dim_addressid"
[0m12:52:06.240591 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.dim_uprn"
[0m12:52:06.240881 [debug] [Thread-4 (]: On model.rightmove_epc.dim_addressid: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_addressid"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE ADDRESS'

with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource,
    POSTCODE

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    where REMOVE_FROM_RM_MATCH = 0
    AND ADDRESSID IS NOT NULL

),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    WHERE ADDRESSID IS NOT NULL

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where addressid is not null
  );
[0m12:52:06.241214 [debug] [Thread-3 (]: On model.rightmove_epc.dim_uprn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_uprn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE UPRNS


with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource,
    POSTCODE
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    where REMOVE_FROM_RM_MATCH = 0
    AND UPRN IS NOT NULL
),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    WHERE UPRN IS NOT NULL

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where uprn is not null
  );
[0m12:52:06.241472 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m12:52:06.241738 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m12:52:06.850874 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:52:06.851677 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:52:06.854749 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_addressid (execute): 12:52:06.234162 => 12:52:06.854517
[0m12:52:06.857336 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.dim_uprn (execute): 12:52:06.236916 => 12:52:06.857134
[0m12:52:06.857716 [debug] [Thread-4 (]: On model.rightmove_epc.dim_addressid: Close
[0m12:52:06.858047 [debug] [Thread-3 (]: On model.rightmove_epc.dim_uprn: Close
[0m12:52:06.953333 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5e52033b-9eee-4418-92eb-3211a7bae61b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1110c6e50>]}
[0m12:52:06.954245 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5e52033b-9eee-4418-92eb-3211a7bae61b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111160c90>]}
[0m12:52:06.954933 [info ] [Thread-3 (]: 4 of 14 OK created sql view model dbt_melissa_rm_epc.dim_uprn .................. [[32mSUCCESS 1[0m in 0.73s]
[0m12:52:06.955511 [info ] [Thread-4 (]: 3 of 14 OK created sql view model dbt_melissa_rm_epc.dim_addressid ............. [[32mSUCCESS 1[0m in 0.73s]
[0m12:52:06.956095 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.dim_uprn
[0m12:52:06.956579 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.dim_addressid
[0m12:52:06.957197 [debug] [Thread-1 (]: Began running node model.rightmove_epc.no_uprn_match
[0m12:52:06.957533 [debug] [Thread-4 (]: Began running node model.rightmove_epc.uprn_match
[0m12:52:06.958052 [info ] [Thread-1 (]: 5 of 14 START sql view model dbt_melissa_rm_epc.no_uprn_match .................. [RUN]
[0m12:52:06.958456 [debug] [Thread-3 (]: Began running node model.rightmove_epc.address_match
[0m12:52:06.958815 [debug] [Thread-2 (]: Began running node model.rightmove_epc.address_simularity
[0m12:52:06.959157 [info ] [Thread-4 (]: 6 of 14 START sql view model dbt_melissa_rm_epc.uprn_match ..................... [RUN]
[0m12:52:06.959776 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_epc_certs, now model.rightmove_epc.no_uprn_match)
[0m12:52:06.960154 [info ] [Thread-3 (]: 7 of 14 START sql view model dbt_melissa_rm_epc.address_match .................. [RUN]
[0m12:52:06.960530 [info ] [Thread-2 (]: 8 of 14 START sql view model dbt_melissa_rm_epc.address_simularity ............. [RUN]
[0m12:52:06.961037 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.dim_addressid, now model.rightmove_epc.uprn_match)
[0m12:52:06.961332 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.no_uprn_match
[0m12:52:06.961793 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.dim_uprn, now model.rightmove_epc.address_match)
[0m12:52:06.962270 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_rightmove, now model.rightmove_epc.address_simularity)
[0m12:52:06.962549 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.uprn_match
[0m12:52:06.963487 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.address_match
[0m12:52:06.966000 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.no_uprn_match"
[0m12:52:06.966424 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.address_simularity
[0m12:52:06.970230 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.uprn_match"
[0m12:52:06.972286 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.address_match"
[0m12:52:06.974608 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.address_simularity"
[0m12:52:06.975233 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.no_uprn_match (compile): 12:52:06.962731 => 12:52:06.975024
[0m12:52:06.975688 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.uprn_match (compile): 12:52:06.966674 => 12:52:06.975542
[0m12:52:06.976006 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.address_match (compile): 12:52:06.970474 => 12:52:06.975859
[0m12:52:06.976255 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.no_uprn_match
[0m12:52:06.976531 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.uprn_match
[0m12:52:06.976837 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.address_simularity (compile): 12:52:06.972571 => 12:52:06.976685
[0m12:52:06.977057 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.address_match
[0m12:52:06.979275 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.no_uprn_match"
[0m12:52:06.981420 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.uprn_match"
[0m12:52:06.981688 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.address_simularity
[0m12:52:06.983754 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.address_match"
[0m12:52:06.985768 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.address_simularity"
[0m12:52:06.986693 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.no_uprn_match"
[0m12:52:06.987535 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.uprn_match"
[0m12:52:06.988238 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.address_match"
[0m12:52:06.988489 [debug] [Thread-1 (]: On model.rightmove_epc.no_uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.no_uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.no_uprn_match
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NOT NULL
),

change_date AS (
    SELECT 
        UPRN AS UPRN_CD, 
        MAX(CHANGE_DATE) AS MAX_CHANGE_DATE 
    FROM rm
    GROUP BY UPRN
),

rm_latest as (

    SELECT * FROM rm
    LEFT JOIN change_date cd
    ON rm.UPRN = cd.UPRN_CD
    WHERE cd.MAX_CHANGE_DATE = rm.CHANGE_DATE ),

epc_uprn as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
    where datasource = 'EPC'
)


SELECT rm_latest.*,
CASE WHEN epc_uprn.UPRN is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_uprn.UPRN AS EPC_UPRN,
epc_uprn.ADDRESSID AS EPC_ADDRESSID


FROM rm_latest
LEFT JOIN epc_uprn
ON rm_latest.UPRN = epc_uprn.UPRN

WHERE MATCH_EPC = 'NO'
  );
[0m12:52:06.988799 [debug] [Thread-4 (]: On model.rightmove_epc.uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NOT NULL
),

change_date AS (
    SELECT 
        UPRN AS UPRN_CD, 
        MAX(CHANGE_DATE) AS MAX_CHANGE_DATE 
    FROM rm
    GROUP BY UPRN
),

rm_latest as (

    SELECT * FROM rm
    LEFT JOIN change_date cd
    ON rm.UPRN = cd.UPRN_CD
    WHERE cd.MAX_CHANGE_DATE = rm.CHANGE_DATE ),

epc_uprn as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
    where datasource = 'EPC'
)


SELECT rm_latest.*,
CASE WHEN epc_uprn.UPRN is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_uprn.UPRN AS EPC_UPRN,
epc_uprn.ADDRESSID AS EPC_ADDRESSID


FROM rm_latest
LEFT JOIN epc_uprn
ON rm_latest.UPRN = epc_uprn.UPRN

WHERE MATCH_EPC = 'YES'
  );
[0m12:52:06.989346 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.address_simularity"
[0m12:52:06.989581 [debug] [Thread-3 (]: On model.rightmove_epc.address_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.address_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NULL

),

epc_address as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
    where datasource = 'EPC'
)


SELECT rm.*,
CASE WHEN epc_address.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_address.ADDRESSID AS EPC_ADDRESSID,
epc_address.UPRN AS EPC_UPRN


FROM rm
LEFT JOIN epc_address
ON rm.addressid = epc_address.addressid
and rm.FULL_POSTCODE = epc_address.POSTCODE
  );
[0m12:52:06.989824 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:52:06.990033 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m12:52:06.990259 [debug] [Thread-2 (]: On model.rightmove_epc.address_simularity: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.address_simularity"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.address_simularity
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NULL
),

epc_address as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
    where datasource = 'EPC'
)


SELECT rm.*,epc_address.addressid as EPC_ADDRESSID
FROM rm
JOIN epc_address
ON JAROWINKLER_SIMILARITY(rm.addressid, epc_address.addressid) = 1
  );
[0m12:52:06.990479 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m12:52:06.991875 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m12:52:07.568062 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:52:07.571220 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.uprn_match (execute): 12:52:06.979453 => 12:52:07.570992
[0m12:52:07.571900 [debug] [Thread-4 (]: On model.rightmove_epc.uprn_match: Close
[0m12:52:07.572597 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:52:07.575688 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.no_uprn_match (execute): 12:52:06.977208 => 12:52:07.575504
[0m12:52:07.576359 [debug] [Thread-1 (]: On model.rightmove_epc.no_uprn_match: Close
[0m12:52:07.583947 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:52:07.586161 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.address_match (execute): 12:52:06.981845 => 12:52:07.586000
[0m12:52:07.586459 [debug] [Thread-3 (]: On model.rightmove_epc.address_match: Close
[0m12:52:07.615014 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:52:07.617612 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.address_simularity (execute): 12:52:06.984066 => 12:52:07.617419
[0m12:52:07.618205 [debug] [Thread-2 (]: On model.rightmove_epc.address_simularity: Close
[0m12:52:07.657416 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5e52033b-9eee-4418-92eb-3211a7bae61b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1113f98d0>]}
[0m12:52:07.658012 [info ] [Thread-3 (]: 7 of 14 OK created sql view model dbt_melissa_rm_epc.address_match ............. [[32mSUCCESS 1[0m in 0.70s]
[0m12:52:07.658799 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.address_match
[0m12:52:07.660636 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5e52033b-9eee-4418-92eb-3211a7bae61b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111203850>]}
[0m12:52:07.661057 [info ] [Thread-1 (]: 5 of 14 OK created sql view model dbt_melissa_rm_epc.no_uprn_match ............. [[32mSUCCESS 1[0m in 0.70s]
[0m12:52:07.661459 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.no_uprn_match
[0m12:52:07.661850 [debug] [Thread-3 (]: Began running node model.rightmove_epc.uprn_address_match
[0m12:52:07.662160 [info ] [Thread-3 (]: 9 of 14 START sql view model dbt_melissa_rm_epc.uprn_address_match ............. [RUN]
[0m12:52:07.662683 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.address_match, now model.rightmove_epc.uprn_address_match)
[0m12:52:07.662990 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.uprn_address_match
[0m12:52:07.665269 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.uprn_address_match"
[0m12:52:07.665941 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.uprn_address_match (compile): 12:52:07.663164 => 12:52:07.665788
[0m12:52:07.666202 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.uprn_address_match
[0m12:52:07.668758 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.uprn_address_match"
[0m12:52:07.669864 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.uprn_address_match"
[0m12:52:07.670219 [debug] [Thread-3 (]: On model.rightmove_epc.uprn_address_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.uprn_address_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_address_match
  
   as (
    -- where uprn is not matched we try address.

with uprn as (

    select *,
    CASE WHEN ad.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC,
    ad.ADDRESSID AS EPC_ADDRESSID,
    ad.UPRN AS EPC_UPRN

     from ANALYTICS_DEV.dbt_melissa_rm_epc.no_uprn_match up
    left join ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid ad on up.ADDRESSID = ad.ADDRESSID
    and up.FULL_POSTCODE = ad.POSTCODE
   
)

SELECT * FROM UPRN
  );
[0m12:52:07.670594 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m12:52:07.671870 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5e52033b-9eee-4418-92eb-3211a7bae61b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1114d7950>]}
[0m12:52:07.672338 [info ] [Thread-4 (]: 6 of 14 OK created sql view model dbt_melissa_rm_epc.uprn_match ................ [[32mSUCCESS 1[0m in 0.71s]
[0m12:52:07.672731 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.uprn_match
[0m12:52:07.673413 [debug] [Thread-1 (]: Began running node model.rightmove_epc.all_matches
[0m12:52:07.673675 [debug] [Thread-4 (]: Began running node model.rightmove_epc.flats_report
[0m12:52:07.674109 [info ] [Thread-1 (]: 10 of 14 START sql view model dbt_melissa_rm_epc.all_matches ................... [RUN]
[0m12:52:07.674394 [info ] [Thread-4 (]: 11 of 14 START sql view model dbt_melissa_rm_epc.flats_report .................. [RUN]
[0m12:52:07.674816 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.no_uprn_match, now model.rightmove_epc.all_matches)
[0m12:52:07.675197 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.uprn_match, now model.rightmove_epc.flats_report)
[0m12:52:07.675450 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.all_matches
[0m12:52:07.675713 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.flats_report
[0m12:52:07.678860 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.all_matches"
[0m12:52:07.681202 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.flats_report"
[0m12:52:07.682205 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.flats_report (compile): 12:52:07.679071 => 12:52:07.682056
[0m12:52:07.682473 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.all_matches (compile): 12:52:07.675883 => 12:52:07.682330
[0m12:52:07.682715 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.flats_report
[0m12:52:07.682948 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.all_matches
[0m12:52:07.685145 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.flats_report"
[0m12:52:07.686953 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.all_matches"
[0m12:52:07.687930 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.all_matches"
[0m12:52:07.688230 [debug] [Thread-1 (]: On model.rightmove_epc.all_matches: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.all_matches"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.all_matches
  
   as (
    with addr as (

    select 
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    '' AS EPC_UPRN,
    EPC_ADDRESSID
    
    from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
    where MATCH_EPC = 'YES' 
),

uprn as (

    select 
    
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN::VARCHAR AS EPC_UPRN,
    EPC_ADDRESSID
     from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'YES'
),

final as (

select 'ADDRESS AND POSTCODE MATCH' AS MATCH_RESULT, * from addr
union all
select 'UPRN MATCH' AS MATCH_RESULT, * from uprn
)

select * from final
  );
[0m12:52:07.688723 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:52:07.690145 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.flats_report"
[0m12:52:07.690876 [debug] [Thread-4 (]: On model.rightmove_epc.flats_report: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.flats_report"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.flats_report
  
   as (
    with epc_max_date as (

    select uprn as UPRN_EPC,
    MAX(LODGEMENT_DATE) AS MAX_LODGEMENT_DATE,
    from  ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    group by 1


),

latest_epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc
    inner join epc_max_date on epc.uprn = epc_max_date.UPRN_EPC
    where MAX_LODGEMENT_DATE = LODGEMENT_DATE

),

 house_addmatch as (

    select 
    distinct
    --count(LISTING_ID) as TOTAL_LISTINGS,
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN, -- NULL
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
 --   am.FLOOR_LEVEL as RM_FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    COUNTY,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    epc.ADDRESSID AS EPC_ADDRESSID,
    -- REMOVE_FROM_RM_MATCH,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

     from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc on am.EPC_ADDRESSID = epc.ADDRESSID
    and am.FULL_POSTCODE = epc.POSTCODE
    where MATCH_EPC = 'YES'
    and COMBINED_PROPERTY_TYPE in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')

),

house_uprnmatch as (

    select 
    distinct
    --count(LISTING_ID) as TOTAL_LISTINGS,
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN, -- NULL
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
  --  am.FLOOR_LEVEL as RM_FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    COUNTY,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    epc.ADDRESSID AS EPC_ADDRESSID,
    -- REMOVE_FROM_RM_MATCH,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

    

    from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match am
    inner join latest_epc epc on am.EPC_UPRN = epc.UPRN

    where MATCH_EPC = 'YES'
   and COMBINED_PROPERTY_TYPE in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')
  -- AND RM_UPRN = 100030719363

)


select 'UPRN' as MATCH_TYPE, * from house_uprnmatch

union all

select 'ADDRESSID' as MATCH_TYPE, * from house_addmatch

/*
--THIS IS USED FOR A TEST
select RM_UPRN,COUNT(BUILDING_REFERENCE_NUMBER)
from house_uprnmatch
WHERE RM_UPRN IS NOT NULL
GROUP BY 1
HAVING COUNT(BUILDING_REFERENCE_NUMBER) >1
*/
  );
[0m12:52:07.691397 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m12:52:07.691810 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5e52033b-9eee-4418-92eb-3211a7bae61b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1120a6010>]}
[0m12:52:07.692584 [info ] [Thread-2 (]: 8 of 14 OK created sql view model dbt_melissa_rm_epc.address_simularity ........ [[32mSUCCESS 1[0m in 0.73s]
[0m12:52:07.692949 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.address_simularity
[0m12:52:07.693196 [debug] [Thread-2 (]: Began running node model.rightmove_epc.houses_report
[0m12:52:07.693680 [info ] [Thread-2 (]: 12 of 14 START sql view model dbt_melissa_rm_epc.houses_report ................. [RUN]
[0m12:52:07.694069 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.address_simularity, now model.rightmove_epc.houses_report)
[0m12:52:07.694263 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.houses_report
[0m12:52:07.696505 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.houses_report"
[0m12:52:07.697614 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.houses_report (compile): 12:52:07.694376 => 12:52:07.697492
[0m12:52:07.697807 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.houses_report
[0m12:52:07.699510 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.houses_report"
[0m12:52:07.701048 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.houses_report"
[0m12:52:07.701323 [debug] [Thread-2 (]: On model.rightmove_epc.houses_report: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.houses_report"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.houses_report
  
   as (
    with epc_max_date as (

    select uprn as UPRN_EPC,
    MAX(LODGEMENT_DATE) AS MAX_LODGEMENT_DATE,
    from  ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    group by 1


),

latest_epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc
    inner join epc_max_date on epc.uprn = epc_max_date.UPRN_EPC
    where MAX_LODGEMENT_DATE = LODGEMENT_DATE

),

 house_addmatch as (

    select 
    distinct
    --count(LISTING_ID) as TOTAL_LISTINGS,
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN, -- NULL
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
 --   am.FLOOR_LEVEL as RM_FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    COUNTY,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    epc.ADDRESSID AS EPC_ADDRESSID,
    -- REMOVE_FROM_RM_MATCH,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

     from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc on am.EPC_ADDRESSID = epc.ADDRESSID
    and am.FULL_POSTCODE = epc.POSTCODE
    where MATCH_EPC = 'YES'
    and COMBINED_PROPERTY_TYPE not in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')

),

house_uprnmatch as (

    select 
    distinct
    --count(LISTING_ID) as TOTAL_LISTINGS,
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN, -- NULL
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
  --  am.FLOOR_LEVEL as RM_FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    COUNTY,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    epc.ADDRESSID AS EPC_ADDRESSID,
    -- REMOVE_FROM_RM_MATCH,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

    

    from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match am
    inner join latest_epc epc on am.EPC_UPRN = epc.UPRN

    where MATCH_EPC = 'YES'
   and COMBINED_PROPERTY_TYPE not in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')
  -- AND RM_UPRN = 100030719363

)


select 'UPRN' as MATCH_TYPE, * from house_uprnmatch

union all

select 'ADDRESSID' as MATCH_TYPE, * from house_addmatch

/*
--THIS IS USED FOR A TEST
select RM_UPRN,COUNT(BUILDING_REFERENCE_NUMBER)
from house_uprnmatch
WHERE RM_UPRN IS NOT NULL
GROUP BY 1
HAVING COUNT(BUILDING_REFERENCE_NUMBER) >1
*/
  );
[0m12:52:07.701581 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m12:52:08.187056 [debug] [Thread-3 (]: Snowflake adapter: Snowflake query id: 01b344a4-0103-9b9a-0000-71950637656a
[0m12:52:08.187488 [debug] [Thread-3 (]: Snowflake adapter: Snowflake error: 002025 (42S21): SQL compilation error:
duplicate column name 'UPRN'
[0m12:52:08.187947 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.uprn_address_match (execute): 12:52:07.666351 => 12:52:08.187774
[0m12:52:08.188264 [debug] [Thread-3 (]: On model.rightmove_epc.uprn_address_match: Close
[0m12:52:08.264154 [debug] [Thread-3 (]: Database Error in model uprn_address_match (models/matching/uprn_address_match.sql)
  002025 (42S21): SQL compilation error:
  duplicate column name 'UPRN'
  compiled Code at target/run/rightmove_epc/models/matching/uprn_address_match.sql
[0m12:52:08.264677 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5e52033b-9eee-4418-92eb-3211a7bae61b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1110eb7d0>]}
[0m12:52:08.265180 [error] [Thread-3 (]: 9 of 14 ERROR creating sql view model dbt_melissa_rm_epc.uprn_address_match .... [[31mERROR[0m in 0.60s]
[0m12:52:08.265648 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.uprn_address_match
[0m12:52:08.265985 [debug] [Thread-3 (]: Began running node model.rightmove_epc.no_matches
[0m12:52:08.266440 [info ] [Thread-3 (]: 13 of 14 START sql view model dbt_melissa_rm_epc.no_matches .................... [RUN]
[0m12:52:08.267094 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.uprn_address_match, now model.rightmove_epc.no_matches)
[0m12:52:08.267406 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.no_matches
[0m12:52:08.270006 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.no_matches"
[0m12:52:08.271031 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.no_matches (compile): 12:52:08.267588 => 12:52:08.270857
[0m12:52:08.271304 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.no_matches
[0m12:52:08.274122 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.no_matches"
[0m12:52:08.275612 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.no_matches"
[0m12:52:08.276001 [debug] [Thread-3 (]: On model.rightmove_epc.no_matches: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.no_matches"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.no_matches
  
   as (
    with addr as (

    select 
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    '' AS EPC_UPRN,
    EPC_ADDRESSID
    
    from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
    where MATCH_EPC = 'NO' 
),

uprn as (

    select 
    
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN::VARCHAR AS EPC_UPRN,
    EPC_ADDRESSID
    
     from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'NO'
),

final as (

select 'NO ADDRESS OR UPRN MATCH' AS MATCH_RESULT, * from addr
union all
select 'NO UPRN MATCH' AS MATCH_RESULT, * from uprn
)

select * from final
  );
[0m12:52:08.276316 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m12:52:08.298642 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:52:08.300751 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.all_matches (execute): 12:52:07.685317 => 12:52:08.300597
[0m12:52:08.301069 [debug] [Thread-1 (]: On model.rightmove_epc.all_matches: Close
[0m12:52:08.373090 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:52:08.373581 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:52:08.375395 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.flats_report (execute): 12:52:07.683267 => 12:52:08.375260
[0m12:52:08.376796 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.houses_report (execute): 12:52:07.697914 => 12:52:08.376686
[0m12:52:08.377035 [debug] [Thread-4 (]: On model.rightmove_epc.flats_report: Close
[0m12:52:08.380260 [debug] [Thread-2 (]: On model.rightmove_epc.houses_report: Close
[0m12:52:08.383607 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5e52033b-9eee-4418-92eb-3211a7bae61b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1123173d0>]}
[0m12:52:08.384231 [info ] [Thread-1 (]: 10 of 14 OK created sql view model dbt_melissa_rm_epc.all_matches .............. [[32mSUCCESS 1[0m in 0.71s]
[0m12:52:08.384923 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.all_matches
[0m12:52:08.447962 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5e52033b-9eee-4418-92eb-3211a7bae61b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111183250>]}
[0m12:52:08.448492 [info ] [Thread-2 (]: 12 of 14 OK created sql view model dbt_melissa_rm_epc.houses_report ............ [[32mSUCCESS 1[0m in 0.75s]
[0m12:52:08.448851 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.houses_report
[0m12:52:08.457621 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5e52033b-9eee-4418-92eb-3211a7bae61b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1113cbd90>]}
[0m12:52:08.458285 [info ] [Thread-4 (]: 11 of 14 OK created sql view model dbt_melissa_rm_epc.flats_report ............. [[32mSUCCESS 1[0m in 0.78s]
[0m12:52:08.458695 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.flats_report
[0m12:52:08.459180 [debug] [Thread-1 (]: Began running node model.rightmove_epc.zero_bedrooms
[0m12:52:08.459570 [info ] [Thread-1 (]: 14 of 14 START sql view model dbt_melissa_rm_epc.zero_bedrooms ................. [RUN]
[0m12:52:08.460062 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.all_matches, now model.rightmove_epc.zero_bedrooms)
[0m12:52:08.460306 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.zero_bedrooms
[0m12:52:08.462348 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.zero_bedrooms"
[0m12:52:08.462981 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.zero_bedrooms (compile): 12:52:08.460449 => 12:52:08.462841
[0m12:52:08.463235 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.zero_bedrooms
[0m12:52:08.466961 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.zero_bedrooms"
[0m12:52:08.468134 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.zero_bedrooms"
[0m12:52:08.468435 [debug] [Thread-1 (]: On model.rightmove_epc.zero_bedrooms: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.zero_bedrooms"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.zero_bedrooms
  
   as (
    with houses as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.houses_report
    where BEDROOM = 0
),

flats as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.flats_report
        where BEDROOM = 0

)

select * from flats
union all
select * from houses
  );
[0m12:52:08.468674 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:52:08.887125 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:52:08.889195 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.no_matches (execute): 12:52:08.271458 => 12:52:08.889043
[0m12:52:08.889486 [debug] [Thread-3 (]: On model.rightmove_epc.no_matches: Close
[0m12:52:08.966999 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5e52033b-9eee-4418-92eb-3211a7bae61b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1111b8090>]}
[0m12:52:08.967721 [info ] [Thread-3 (]: 13 of 14 OK created sql view model dbt_melissa_rm_epc.no_matches ............... [[32mSUCCESS 1[0m in 0.70s]
[0m12:52:08.968302 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.no_matches
[0m12:52:09.376094 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:52:09.380992 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.zero_bedrooms (execute): 12:52:08.463386 => 12:52:09.380689
[0m12:52:09.381572 [debug] [Thread-1 (]: On model.rightmove_epc.zero_bedrooms: Close
[0m12:52:09.478076 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5e52033b-9eee-4418-92eb-3211a7bae61b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104ff1bd0>]}
[0m12:52:09.478602 [info ] [Thread-1 (]: 14 of 14 OK created sql view model dbt_melissa_rm_epc.zero_bedrooms ............ [[32mSUCCESS 1[0m in 1.02s]
[0m12:52:09.478893 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.zero_bedrooms
[0m12:52:09.479910 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:52:09.480070 [debug] [MainThread]: Connection 'model.rightmove_epc.zero_bedrooms' was properly closed.
[0m12:52:09.480194 [debug] [MainThread]: Connection 'model.rightmove_epc.houses_report' was properly closed.
[0m12:52:09.480311 [debug] [MainThread]: Connection 'model.rightmove_epc.flats_report' was properly closed.
[0m12:52:09.480426 [debug] [MainThread]: Connection 'model.rightmove_epc.no_matches' was properly closed.
[0m12:52:09.480626 [info ] [MainThread]: 
[0m12:52:09.480785 [info ] [MainThread]: Finished running 14 view models in 0 hours 0 minutes and 5.27 seconds (5.27s).
[0m12:52:09.481657 [debug] [MainThread]: Command end result
[0m12:52:09.487359 [info ] [MainThread]: 
[0m12:52:09.487790 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m12:52:09.488083 [info ] [MainThread]: 
[0m12:52:09.488375 [error] [MainThread]:   Database Error in model uprn_address_match (models/matching/uprn_address_match.sql)
  002025 (42S21): SQL compilation error:
  duplicate column name 'UPRN'
  compiled Code at target/run/rightmove_epc/models/matching/uprn_address_match.sql
[0m12:52:09.488676 [info ] [MainThread]: 
[0m12:52:09.488971 [info ] [MainThread]: Done. PASS=13 WARN=0 ERROR=1 SKIP=0 TOTAL=14
[0m12:52:09.491278 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 5.5720162, "process_user_time": 1.657494, "process_kernel_time": 0.212793, "process_mem_max_rss": "140935168", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m12:52:09.491760 [debug] [MainThread]: Command `dbt run` failed at 12:52:09.491667 after 5.57 seconds
[0m12:52:09.492083 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106003c50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1059d3990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103cbd610>]}
[0m12:52:09.492357 [debug] [MainThread]: Flushing usage events
[0m12:54:06.555818 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1049b70d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1049c2950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1049c34d0>]}


============================== 12:54:06.559179 | 7590bee0-780c-48ec-9cd0-88a581a40b99 ==============================
[0m12:54:06.559179 [info ] [MainThread]: Running with dbt=1.7.10
[0m12:54:06.559579 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m12:54:06.726775 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7590bee0-780c-48ec-9cd0-88a581a40b99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105301a50>]}
[0m12:54:06.762001 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7590bee0-780c-48ec-9cd0-88a581a40b99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1051756d0>]}
[0m12:54:06.763660 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m12:54:06.772333 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m12:54:06.788381 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m12:54:06.788627 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m12:54:06.791808 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7590bee0-780c-48ec-9cd0-88a581a40b99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1050ed950>]}
[0m12:54:06.797829 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7590bee0-780c-48ec-9cd0-88a581a40b99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10497d150>]}
[0m12:54:06.798081 [info ] [MainThread]: Found 14 models, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m12:54:06.798285 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7590bee0-780c-48ec-9cd0-88a581a40b99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105352510>]}
[0m12:54:06.799378 [info ] [MainThread]: 
[0m12:54:06.799765 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m12:54:06.800481 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m12:54:06.806798 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m12:54:06.807011 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m12:54:06.807179 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:54:07.375761 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 1.0 seconds
[0m12:54:07.377943 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m12:54:07.475367 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m12:54:07.483524 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m12:54:07.483903 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m12:54:07.484192 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:54:07.921823 [debug] [ThreadPool]: SQL status: SUCCESS 14 in 0.0 seconds
[0m12:54:07.923847 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m12:54:08.020501 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7590bee0-780c-48ec-9cd0-88a581a40b99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1053453d0>]}
[0m12:54:08.021416 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m12:54:08.021759 [info ] [MainThread]: 
[0m12:54:08.024710 [debug] [Thread-1 (]: Began running node model.rightmove_epc.stg_epc_certs
[0m12:54:08.025102 [debug] [Thread-2 (]: Began running node model.rightmove_epc.stg_rightmove
[0m12:54:08.025565 [info ] [Thread-1 (]: 1 of 14 START sql view model dbt_melissa_rm_epc.stg_epc_certs .................. [RUN]
[0m12:54:08.025998 [info ] [Thread-2 (]: 2 of 14 START sql view model dbt_melissa_rm_epc.stg_rightmove .................. [RUN]
[0m12:54:08.026669 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.stg_epc_certs)
[0m12:54:08.027247 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.stg_rightmove'
[0m12:54:08.027540 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.stg_epc_certs
[0m12:54:08.027809 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.stg_rightmove
[0m12:54:08.034615 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.stg_epc_certs"
[0m12:54:08.037660 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.stg_rightmove"
[0m12:54:08.038347 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (compile): 12:54:08.028043 => 12:54:08.038179
[0m12:54:08.038701 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (compile): 12:54:08.034897 => 12:54:08.038515
[0m12:54:08.038987 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.stg_epc_certs
[0m12:54:08.039277 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.stg_rightmove
[0m12:54:08.086352 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.stg_epc_certs"
[0m12:54:08.088191 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.stg_rightmove"
[0m12:54:08.089053 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.stg_rightmove"
[0m12:54:08.089642 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.stg_epc_certs"
[0m12:54:08.089848 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_rightmove"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
  
   as (
    with rm as (

    SELECT 
    LISTING_ID,
    CHANGE_DATE,
    UPPER(TRIM(replace(REPLACE(CONCAT(ADDRESS_1::VARCHAR,ADDRESS_2::VARCHAR),' '),','))) AS ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, 
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    BEDROOM,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    STUDENTLET_FLAG,
    COMBINED_PROPERTY_TYPE
    -- property type
    FROM 
       ANALYTICS.RIGHTMOVE_PROD.CLEAN_RAW_RIGHTMOVE_DATA 

 
)

SELECT * FROM rm
  );
[0m12:54:08.090067 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_epc_certs"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
  
   as (
    WITH epc_certs as (
    
    select 
    UPRN,
    LODGEMENT_DATE,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    COUNTY,
    LOCAL_AUTHORITY as LOCAL_AUTHORITY_CODE,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    UPPER(CASE WHEN (UPPER(ADDRESS1) LIKE 'FLAT%' OR UPPER(ADDRESS1) LIKE 'UNIT%') or UPPER(ADDRESS1) LIKE 'ROOM%' 
    THEN TRIM(REPLACE(REPLACE(CONCAT(ADDRESS),','),' '))
    ELSE trim(replace(replace(ADDRESS1,' '),',')) END) AS ADDRESSID,
    CASE WHEN UPRN is null and addressid is null THEN 1 else 0 end as REMOVE_FROM_RM_MATCH,
    FLOOR_LEVEL,
    FLAT_TOP_STOREY,
    FLAT_STOREY_COUNT,
    PROPERTY_TYPE
 from  RAW.EPC_TEST_DATA.EPC_CERTIFICATES 

)

SELECT * FROM epc_certs
  );
[0m12:54:08.090255 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m12:54:08.090407 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:54:08.574977 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m12:54:08.598229 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (execute): 12:54:08.039447 => 12:54:08.598037
[0m12:54:08.599252 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:54:08.599636 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: Close
[0m12:54:08.601636 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (execute): 12:54:08.086582 => 12:54:08.601488
[0m12:54:08.602736 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: Close
[0m12:54:08.676639 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7590bee0-780c-48ec-9cd0-88a581a40b99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10551d510>]}
[0m12:54:08.677386 [info ] [Thread-2 (]: 2 of 14 OK created sql view model dbt_melissa_rm_epc.stg_rightmove ............. [[32mSUCCESS 1[0m in 0.65s]
[0m12:54:08.677964 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.stg_rightmove
[0m12:54:08.689199 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7590bee0-780c-48ec-9cd0-88a581a40b99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105352ad0>]}
[0m12:54:08.689810 [info ] [Thread-1 (]: 1 of 14 OK created sql view model dbt_melissa_rm_epc.stg_epc_certs ............. [[32mSUCCESS 1[0m in 0.66s]
[0m12:54:08.690290 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.stg_epc_certs
[0m12:54:08.690951 [debug] [Thread-4 (]: Began running node model.rightmove_epc.dim_addressid
[0m12:54:08.691413 [info ] [Thread-4 (]: 3 of 14 START sql view model dbt_melissa_rm_epc.dim_addressid .................. [RUN]
[0m12:54:08.691864 [debug] [Thread-3 (]: Began running node model.rightmove_epc.dim_uprn
[0m12:54:08.692550 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_addressid'
[0m12:54:08.692952 [info ] [Thread-3 (]: 4 of 14 START sql view model dbt_melissa_rm_epc.dim_uprn ....................... [RUN]
[0m12:54:08.693306 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.dim_addressid
[0m12:54:08.693922 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_uprn'
[0m12:54:08.697069 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.dim_addressid"
[0m12:54:08.697583 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.dim_uprn
[0m12:54:08.700131 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.dim_uprn"
[0m12:54:08.700694 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_addressid (compile): 12:54:08.694195 => 12:54:08.700517
[0m12:54:08.701063 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.dim_addressid
[0m12:54:08.701401 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.dim_uprn (compile): 12:54:08.697929 => 12:54:08.701210
[0m12:54:08.704121 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.dim_addressid"
[0m12:54:08.704524 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.dim_uprn
[0m12:54:08.706906 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.dim_uprn"
[0m12:54:08.707860 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.dim_addressid"
[0m12:54:08.708188 [debug] [Thread-4 (]: On model.rightmove_epc.dim_addressid: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_addressid"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE ADDRESS'

with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource,
    POSTCODE

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    where REMOVE_FROM_RM_MATCH = 0
    AND ADDRESSID IS NOT NULL

),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    WHERE ADDRESSID IS NOT NULL

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where addressid is not null
  );
[0m12:54:08.708481 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m12:54:08.709176 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.dim_uprn"
[0m12:54:08.709935 [debug] [Thread-3 (]: On model.rightmove_epc.dim_uprn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_uprn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE UPRNS


with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource,
    POSTCODE
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    where REMOVE_FROM_RM_MATCH = 0
    AND UPRN IS NOT NULL
),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    WHERE UPRN IS NOT NULL

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where uprn is not null
  );
[0m12:54:08.710467 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m12:54:09.322890 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:54:09.323942 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:54:09.327793 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.dim_uprn (execute): 12:54:08.704870 => 12:54:09.327552
[0m12:54:09.330632 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_addressid (execute): 12:54:08.701626 => 12:54:09.330423
[0m12:54:09.331089 [debug] [Thread-3 (]: On model.rightmove_epc.dim_uprn: Close
[0m12:54:09.331451 [debug] [Thread-4 (]: On model.rightmove_epc.dim_addressid: Close
[0m12:54:09.422693 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7590bee0-780c-48ec-9cd0-88a581a40b99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1054d4550>]}
[0m12:54:09.423870 [info ] [Thread-3 (]: 4 of 14 OK created sql view model dbt_melissa_rm_epc.dim_uprn .................. [[32mSUCCESS 1[0m in 0.73s]
[0m12:54:09.424833 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.dim_uprn
[0m12:54:09.425627 [debug] [Thread-1 (]: Began running node model.rightmove_epc.no_uprn_match
[0m12:54:09.426082 [debug] [Thread-2 (]: Began running node model.rightmove_epc.uprn_match
[0m12:54:09.426963 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7590bee0-780c-48ec-9cd0-88a581a40b99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10557b850>]}
[0m12:54:09.427520 [info ] [Thread-1 (]: 5 of 14 START sql view model dbt_melissa_rm_epc.no_uprn_match .................. [RUN]
[0m12:54:09.428055 [info ] [Thread-2 (]: 6 of 14 START sql view model dbt_melissa_rm_epc.uprn_match ..................... [RUN]
[0m12:54:09.428733 [info ] [Thread-4 (]: 3 of 14 OK created sql view model dbt_melissa_rm_epc.dim_addressid ............. [[32mSUCCESS 1[0m in 0.73s]
[0m12:54:09.429620 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_epc_certs, now model.rightmove_epc.no_uprn_match)
[0m12:54:09.430308 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_rightmove, now model.rightmove_epc.uprn_match)
[0m12:54:09.430824 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.dim_addressid
[0m12:54:09.431191 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.no_uprn_match
[0m12:54:09.431632 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.uprn_match
[0m12:54:09.432380 [debug] [Thread-3 (]: Began running node model.rightmove_epc.address_match
[0m12:54:09.432804 [debug] [Thread-4 (]: Began running node model.rightmove_epc.address_simularity
[0m12:54:09.436631 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.uprn_match"
[0m12:54:09.438941 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.no_uprn_match"
[0m12:54:09.439406 [info ] [Thread-3 (]: 7 of 14 START sql view model dbt_melissa_rm_epc.address_match .................. [RUN]
[0m12:54:09.439807 [info ] [Thread-4 (]: 8 of 14 START sql view model dbt_melissa_rm_epc.address_simularity ............. [RUN]
[0m12:54:09.440698 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.dim_uprn, now model.rightmove_epc.address_match)
[0m12:54:09.441523 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.dim_addressid, now model.rightmove_epc.address_simularity)
[0m12:54:09.442025 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.uprn_match (compile): 12:54:09.433785 => 12:54:09.441803
[0m12:54:09.442319 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.address_match
[0m12:54:09.442659 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.address_simularity
[0m12:54:09.443024 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.no_uprn_match (compile): 12:54:09.433014 => 12:54:09.442860
[0m12:54:09.443347 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.uprn_match
[0m12:54:09.447358 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.address_match"
[0m12:54:09.449697 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.address_simularity"
[0m12:54:09.450007 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.no_uprn_match
[0m12:54:09.452151 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.uprn_match"
[0m12:54:09.454436 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.no_uprn_match"
[0m12:54:09.454938 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.address_match (compile): 12:54:09.443558 => 12:54:09.454790
[0m12:54:09.455191 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.address_simularity (compile): 12:54:09.447646 => 12:54:09.455070
[0m12:54:09.455497 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.address_match
[0m12:54:09.455780 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.address_simularity
[0m12:54:09.456566 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.uprn_match"
[0m12:54:09.457361 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.no_uprn_match"
[0m12:54:09.459482 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.address_match"
[0m12:54:09.461708 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.address_simularity"
[0m12:54:09.462133 [debug] [Thread-2 (]: On model.rightmove_epc.uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NOT NULL
),

change_date AS (
    SELECT 
        UPRN AS UPRN_CD, 
        MAX(CHANGE_DATE) AS MAX_CHANGE_DATE 
    FROM rm
    GROUP BY UPRN
),

rm_latest as (

    SELECT * FROM rm
    LEFT JOIN change_date cd
    ON rm.UPRN = cd.UPRN_CD
    WHERE cd.MAX_CHANGE_DATE = rm.CHANGE_DATE ),

epc_uprn as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
    where datasource = 'EPC'
)


SELECT rm_latest.*,
CASE WHEN epc_uprn.UPRN is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_uprn.UPRN AS EPC_UPRN,
epc_uprn.ADDRESSID AS EPC_ADDRESSID


FROM rm_latest
LEFT JOIN epc_uprn
ON rm_latest.UPRN = epc_uprn.UPRN

WHERE MATCH_EPC = 'YES'
  );
[0m12:54:09.462507 [debug] [Thread-1 (]: On model.rightmove_epc.no_uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.no_uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.no_uprn_match
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NOT NULL
),

change_date AS (
    SELECT 
        UPRN AS UPRN_CD, 
        MAX(CHANGE_DATE) AS MAX_CHANGE_DATE 
    FROM rm
    GROUP BY UPRN
),

rm_latest as (

    SELECT * FROM rm
    LEFT JOIN change_date cd
    ON rm.UPRN = cd.UPRN_CD
    WHERE cd.MAX_CHANGE_DATE = rm.CHANGE_DATE ),

epc_uprn as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
    where datasource = 'EPC'
)


SELECT rm_latest.*,
CASE WHEN epc_uprn.UPRN is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_uprn.UPRN AS EPC_UPRN,
epc_uprn.ADDRESSID AS EPC_ADDRESSID


FROM rm_latest
LEFT JOIN epc_uprn
ON rm_latest.UPRN = epc_uprn.UPRN

WHERE MATCH_EPC = 'NO'
  );
[0m12:54:09.463019 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m12:54:09.463778 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.address_match"
[0m12:54:09.464280 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.address_simularity"
[0m12:54:09.464468 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:54:09.465551 [debug] [Thread-3 (]: On model.rightmove_epc.address_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.address_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NULL

),

epc_address as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
    where datasource = 'EPC'
)


SELECT rm.*,
CASE WHEN epc_address.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_address.ADDRESSID AS EPC_ADDRESSID,
epc_address.UPRN AS EPC_UPRN


FROM rm
LEFT JOIN epc_address
ON rm.addressid = epc_address.addressid
and rm.FULL_POSTCODE = epc_address.POSTCODE
  );
[0m12:54:09.465929 [debug] [Thread-4 (]: On model.rightmove_epc.address_simularity: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.address_simularity"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.address_simularity
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NULL
),

epc_address as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
    where datasource = 'EPC'
)


SELECT rm.*,epc_address.addressid as EPC_ADDRESSID
FROM rm
JOIN epc_address
ON JAROWINKLER_SIMILARITY(rm.addressid, epc_address.addressid) = 1
  );
[0m12:54:09.466752 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m12:54:09.467001 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m12:54:10.147082 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:54:10.152364 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.no_uprn_match (execute): 12:54:09.452478 => 12:54:10.152036
[0m12:54:10.153844 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:54:10.155110 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:54:10.155919 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:54:10.156427 [debug] [Thread-1 (]: On model.rightmove_epc.no_uprn_match: Close
[0m12:54:10.159380 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.uprn_match (execute): 12:54:09.450184 => 12:54:10.159180
[0m12:54:10.162232 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.address_simularity (execute): 12:54:09.459687 => 12:54:10.162018
[0m12:54:10.164710 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.address_match (execute): 12:54:09.457491 => 12:54:10.164513
[0m12:54:10.165880 [debug] [Thread-2 (]: On model.rightmove_epc.uprn_match: Close
[0m12:54:10.166553 [debug] [Thread-4 (]: On model.rightmove_epc.address_simularity: Close
[0m12:54:10.166929 [debug] [Thread-3 (]: On model.rightmove_epc.address_match: Close
[0m12:54:10.254679 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7590bee0-780c-48ec-9cd0-88a581a40b99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10590bd50>]}
[0m12:54:10.255542 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7590bee0-780c-48ec-9cd0-88a581a40b99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10590b350>]}
[0m12:54:10.256508 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7590bee0-780c-48ec-9cd0-88a581a40b99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105909950>]}
[0m12:54:10.257290 [info ] [Thread-4 (]: 8 of 14 OK created sql view model dbt_melissa_rm_epc.address_simularity ........ [[32mSUCCESS 1[0m in 0.81s]
[0m12:54:10.258009 [info ] [Thread-3 (]: 7 of 14 OK created sql view model dbt_melissa_rm_epc.address_match ............. [[32mSUCCESS 1[0m in 0.82s]
[0m12:54:10.258779 [info ] [Thread-2 (]: 6 of 14 OK created sql view model dbt_melissa_rm_epc.uprn_match ................ [[32mSUCCESS 1[0m in 0.83s]
[0m12:54:10.259488 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.address_simularity
[0m12:54:10.259968 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.address_match
[0m12:54:10.260416 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.uprn_match
[0m12:54:10.261849 [debug] [Thread-4 (]: Began running node model.rightmove_epc.all_matches
[0m12:54:10.262255 [debug] [Thread-3 (]: Began running node model.rightmove_epc.flats_report
[0m12:54:10.262696 [debug] [Thread-2 (]: Began running node model.rightmove_epc.houses_report
[0m12:54:10.263195 [info ] [Thread-4 (]: 9 of 14 START sql view model dbt_melissa_rm_epc.all_matches .................... [RUN]
[0m12:54:10.263934 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7590bee0-780c-48ec-9cd0-88a581a40b99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105909550>]}
[0m12:54:10.264414 [info ] [Thread-3 (]: 10 of 14 START sql view model dbt_melissa_rm_epc.flats_report .................. [RUN]
[0m12:54:10.264858 [info ] [Thread-2 (]: 11 of 14 START sql view model dbt_melissa_rm_epc.houses_report ................. [RUN]
[0m12:54:10.265575 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.address_simularity, now model.rightmove_epc.all_matches)
[0m12:54:10.266103 [info ] [Thread-1 (]: 5 of 14 OK created sql view model dbt_melissa_rm_epc.no_uprn_match ............. [[32mSUCCESS 1[0m in 0.83s]
[0m12:54:10.266654 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.address_match, now model.rightmove_epc.flats_report)
[0m12:54:10.267144 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.uprn_match, now model.rightmove_epc.houses_report)
[0m12:54:10.267449 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.all_matches
[0m12:54:10.267859 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.no_uprn_match
[0m12:54:10.268136 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.flats_report
[0m12:54:10.268419 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.houses_report
[0m12:54:10.271466 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.all_matches"
[0m12:54:10.271954 [debug] [Thread-1 (]: Began running node model.rightmove_epc.no_matches
[0m12:54:10.274941 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.flats_report"
[0m12:54:10.277495 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.houses_report"
[0m12:54:10.277905 [info ] [Thread-1 (]: 12 of 14 START sql view model dbt_melissa_rm_epc.no_matches .................... [RUN]
[0m12:54:10.278428 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.all_matches (compile): 12:54:10.268591 => 12:54:10.278261
[0m12:54:10.278856 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.no_uprn_match, now model.rightmove_epc.no_matches)
[0m12:54:10.279115 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.all_matches
[0m12:54:10.279354 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.flats_report (compile): 12:54:10.272295 => 12:54:10.279242
[0m12:54:10.279611 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.houses_report (compile): 12:54:10.275196 => 12:54:10.279487
[0m12:54:10.279800 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.no_matches
[0m12:54:10.282929 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.all_matches"
[0m12:54:10.283169 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.flats_report
[0m12:54:10.283384 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.houses_report
[0m12:54:10.285118 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.no_matches"
[0m12:54:10.287207 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.flats_report"
[0m12:54:10.288974 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.houses_report"
[0m12:54:10.289704 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.all_matches"
[0m12:54:10.290167 [debug] [Thread-4 (]: On model.rightmove_epc.all_matches: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.all_matches"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.all_matches
  
   as (
    with addr as (

    select 
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    '' AS EPC_UPRN,
    EPC_ADDRESSID
    
    from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
    where MATCH_EPC = 'YES' 
),

uprn as (

    select 
    
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN::VARCHAR AS EPC_UPRN,
    EPC_ADDRESSID
     from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'YES'
),

final as (

select 'ADDRESS AND POSTCODE MATCH' AS MATCH_RESULT, * from addr
union all
select 'UPRN MATCH' AS MATCH_RESULT, * from uprn
)

select * from final
  );
[0m12:54:10.291654 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.flats_report"
[0m12:54:10.291889 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.no_matches (compile): 12:54:10.283519 => 12:54:10.291772
[0m12:54:10.292097 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m12:54:10.292418 [debug] [Thread-3 (]: On model.rightmove_epc.flats_report: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.flats_report"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.flats_report
  
   as (
    with epc_max_date as (

    select uprn as UPRN_EPC,
    MAX(LODGEMENT_DATE) AS MAX_LODGEMENT_DATE,
    from  ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    group by 1


),

latest_epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc
    inner join epc_max_date on epc.uprn = epc_max_date.UPRN_EPC
    where MAX_LODGEMENT_DATE = LODGEMENT_DATE

),

 house_addmatch as (

    select 
    distinct
    --count(LISTING_ID) as TOTAL_LISTINGS,
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN, -- NULL
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
 --   am.FLOOR_LEVEL as RM_FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    COUNTY,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    epc.ADDRESSID AS EPC_ADDRESSID,
    -- REMOVE_FROM_RM_MATCH,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

     from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc on am.EPC_ADDRESSID = epc.ADDRESSID
    and am.FULL_POSTCODE = epc.POSTCODE
    where MATCH_EPC = 'YES'
    and COMBINED_PROPERTY_TYPE in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')

),

house_uprnmatch as (

    select 
    distinct
    --count(LISTING_ID) as TOTAL_LISTINGS,
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN, -- NULL
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
  --  am.FLOOR_LEVEL as RM_FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    COUNTY,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    epc.ADDRESSID AS EPC_ADDRESSID,
    -- REMOVE_FROM_RM_MATCH,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

    

    from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match am
    inner join latest_epc epc on am.EPC_UPRN = epc.UPRN

    where MATCH_EPC = 'YES'
   and COMBINED_PROPERTY_TYPE in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')
  -- AND RM_UPRN = 100030719363

)


select 'UPRN' as MATCH_TYPE, * from house_uprnmatch

union all

select 'ADDRESSID' as MATCH_TYPE, * from house_addmatch

/*
--THIS IS USED FOR A TEST
select RM_UPRN,COUNT(BUILDING_REFERENCE_NUMBER)
from house_uprnmatch
WHERE RM_UPRN IS NOT NULL
GROUP BY 1
HAVING COUNT(BUILDING_REFERENCE_NUMBER) >1
*/
  );
[0m12:54:10.293903 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.houses_report"
[0m12:54:10.294115 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.no_matches
[0m12:54:10.294681 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m12:54:10.295265 [debug] [Thread-2 (]: On model.rightmove_epc.houses_report: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.houses_report"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.houses_report
  
   as (
    with epc_max_date as (

    select uprn as UPRN_EPC,
    MAX(LODGEMENT_DATE) AS MAX_LODGEMENT_DATE,
    from  ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    group by 1


),

latest_epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc
    inner join epc_max_date on epc.uprn = epc_max_date.UPRN_EPC
    where MAX_LODGEMENT_DATE = LODGEMENT_DATE

),

 house_addmatch as (

    select 
    distinct
    --count(LISTING_ID) as TOTAL_LISTINGS,
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN, -- NULL
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
 --   am.FLOOR_LEVEL as RM_FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    COUNTY,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    epc.ADDRESSID AS EPC_ADDRESSID,
    -- REMOVE_FROM_RM_MATCH,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

     from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc on am.EPC_ADDRESSID = epc.ADDRESSID
    and am.FULL_POSTCODE = epc.POSTCODE
    where MATCH_EPC = 'YES'
    and COMBINED_PROPERTY_TYPE not in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')

),

house_uprnmatch as (

    select 
    distinct
    --count(LISTING_ID) as TOTAL_LISTINGS,
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN, -- NULL
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
  --  am.FLOOR_LEVEL as RM_FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    COUNTY,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    epc.ADDRESSID AS EPC_ADDRESSID,
    -- REMOVE_FROM_RM_MATCH,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

    

    from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match am
    inner join latest_epc epc on am.EPC_UPRN = epc.UPRN

    where MATCH_EPC = 'YES'
   and COMBINED_PROPERTY_TYPE not in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')
  -- AND RM_UPRN = 100030719363

)


select 'UPRN' as MATCH_TYPE, * from house_uprnmatch

union all

select 'ADDRESSID' as MATCH_TYPE, * from house_addmatch

/*
--THIS IS USED FOR A TEST
select RM_UPRN,COUNT(BUILDING_REFERENCE_NUMBER)
from house_uprnmatch
WHERE RM_UPRN IS NOT NULL
GROUP BY 1
HAVING COUNT(BUILDING_REFERENCE_NUMBER) >1
*/
  );
[0m12:54:10.297134 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.no_matches"
[0m12:54:10.297977 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m12:54:10.299313 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.no_matches"
[0m12:54:10.299588 [debug] [Thread-1 (]: On model.rightmove_epc.no_matches: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.no_matches"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.no_matches
  
   as (
    with addr as (

    select 
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    '' AS EPC_UPRN,
    EPC_ADDRESSID
    
    from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
    where MATCH_EPC = 'NO' 
),

uprn as (

    select 
    
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN::VARCHAR AS EPC_UPRN,
    EPC_ADDRESSID
    
     from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'NO'
),

final as (

select 'NO ADDRESS OR UPRN MATCH' AS MATCH_RESULT, * from addr
union all
select 'NO UPRN MATCH' AS MATCH_RESULT, * from uprn
)

select * from final
  );
[0m12:54:10.299809 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:54:10.997814 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:54:11.000522 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.no_matches (execute): 12:54:10.295518 => 12:54:11.000312
[0m12:54:11.001449 [debug] [Thread-1 (]: On model.rightmove_epc.no_matches: Close
[0m12:54:11.002273 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:54:11.005412 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.houses_report (execute): 12:54:10.287393 => 12:54:11.005219
[0m12:54:11.006045 [debug] [Thread-2 (]: On model.rightmove_epc.houses_report: Close
[0m12:54:11.028759 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:54:11.030935 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.all_matches (execute): 12:54:10.279937 => 12:54:11.030768
[0m12:54:11.031245 [debug] [Thread-4 (]: On model.rightmove_epc.all_matches: Close
[0m12:54:11.079124 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:54:11.082013 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.flats_report (execute): 12:54:10.285350 => 12:54:11.081791
[0m12:54:11.082433 [debug] [Thread-3 (]: On model.rightmove_epc.flats_report: Close
[0m12:54:11.090921 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7590bee0-780c-48ec-9cd0-88a581a40b99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10544ad50>]}
[0m12:54:11.091526 [info ] [Thread-1 (]: 12 of 14 OK created sql view model dbt_melissa_rm_epc.no_matches ............... [[32mSUCCESS 1[0m in 0.81s]
[0m12:54:11.092056 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.no_matches
[0m12:54:11.092458 [debug] [Thread-1 (]: Began running node model.rightmove_epc.uprn_address_match
[0m12:54:11.092943 [info ] [Thread-1 (]: 13 of 14 START sql view model dbt_melissa_rm_epc.uprn_address_match ............ [RUN]
[0m12:54:11.093597 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.no_matches, now model.rightmove_epc.uprn_address_match)
[0m12:54:11.093954 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.uprn_address_match
[0m12:54:11.096986 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.uprn_address_match"
[0m12:54:11.097818 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.uprn_address_match (compile): 12:54:11.094147 => 12:54:11.097649
[0m12:54:11.098117 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.uprn_address_match
[0m12:54:11.100669 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.uprn_address_match"
[0m12:54:11.101635 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.uprn_address_match"
[0m12:54:11.101995 [debug] [Thread-1 (]: On model.rightmove_epc.uprn_address_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.uprn_address_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_address_match
  
   as (
    -- where uprn is not matched we try address.

with uprn as (

    select uprn.*,
    CASE WHEN ad.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC,
    ad.ADDRESSID AS EPC_ADDRESSID,
    ad.UPRN AS EPC_UPRN

     from ANALYTICS_DEV.dbt_melissa_rm_epc.no_uprn_match up
    left join ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid ad on up.ADDRESSID = ad.ADDRESSID
    and up.FULL_POSTCODE = ad.POSTCODE
   
)

SELECT * FROM UPRN
  );
[0m12:54:11.102267 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:54:11.106789 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7590bee0-780c-48ec-9cd0-88a581a40b99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105578590>]}
[0m12:54:11.107108 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7590bee0-780c-48ec-9cd0-88a581a40b99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105563750>]}
[0m12:54:11.107635 [info ] [Thread-4 (]: 9 of 14 OK created sql view model dbt_melissa_rm_epc.all_matches ............... [[32mSUCCESS 1[0m in 0.84s]
[0m12:54:11.108104 [info ] [Thread-2 (]: 11 of 14 OK created sql view model dbt_melissa_rm_epc.houses_report ............ [[32mSUCCESS 1[0m in 0.84s]
[0m12:54:11.108569 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.all_matches
[0m12:54:11.108950 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.houses_report
[0m12:54:11.173420 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7590bee0-780c-48ec-9cd0-88a581a40b99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1053bbe50>]}
[0m12:54:11.173995 [info ] [Thread-3 (]: 10 of 14 OK created sql view model dbt_melissa_rm_epc.flats_report ............. [[32mSUCCESS 1[0m in 0.91s]
[0m12:54:11.174413 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.flats_report
[0m12:54:11.174866 [debug] [Thread-4 (]: Began running node model.rightmove_epc.zero_bedrooms
[0m12:54:11.175223 [info ] [Thread-4 (]: 14 of 14 START sql view model dbt_melissa_rm_epc.zero_bedrooms ................. [RUN]
[0m12:54:11.175723 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.all_matches, now model.rightmove_epc.zero_bedrooms)
[0m12:54:11.175992 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.zero_bedrooms
[0m12:54:11.178469 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.zero_bedrooms"
[0m12:54:11.179078 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.zero_bedrooms (compile): 12:54:11.176160 => 12:54:11.178943
[0m12:54:11.179315 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.zero_bedrooms
[0m12:54:11.181511 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.zero_bedrooms"
[0m12:54:11.182285 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.zero_bedrooms"
[0m12:54:11.182571 [debug] [Thread-4 (]: On model.rightmove_epc.zero_bedrooms: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.zero_bedrooms"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.zero_bedrooms
  
   as (
    with houses as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.houses_report
    where BEDROOM = 0
),

flats as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.flats_report
        where BEDROOM = 0

)

select * from flats
union all
select * from houses
  );
[0m12:54:11.182818 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m12:54:11.520810 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b344a6-0103-9b63-0000-719506375c92
[0m12:54:11.521243 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 002001 (02000): SQL compilation error:
Object 'UPRN' does not exist or not authorized.
[0m12:54:11.521711 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.uprn_address_match (execute): 12:54:11.098288 => 12:54:11.521540
[0m12:54:11.522026 [debug] [Thread-1 (]: On model.rightmove_epc.uprn_address_match: Close
[0m12:54:11.612520 [debug] [Thread-1 (]: Database Error in model uprn_address_match (models/matching/uprn_address_match.sql)
  002001 (02000): SQL compilation error:
  Object 'UPRN' does not exist or not authorized.
  compiled Code at target/run/rightmove_epc/models/matching/uprn_address_match.sql
[0m12:54:11.613099 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7590bee0-780c-48ec-9cd0-88a581a40b99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10544bb10>]}
[0m12:54:11.613656 [error] [Thread-1 (]: 13 of 14 ERROR creating sql view model dbt_melissa_rm_epc.uprn_address_match ... [[31mERROR[0m in 0.52s]
[0m12:54:11.614165 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.uprn_address_match
[0m12:54:12.087267 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:54:12.090750 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.zero_bedrooms (execute): 12:54:11.179457 => 12:54:12.090517
[0m12:54:12.091182 [debug] [Thread-4 (]: On model.rightmove_epc.zero_bedrooms: Close
[0m12:54:12.175491 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7590bee0-780c-48ec-9cd0-88a581a40b99', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10591ccd0>]}
[0m12:54:12.176295 [info ] [Thread-4 (]: 14 of 14 OK created sql view model dbt_melissa_rm_epc.zero_bedrooms ............ [[32mSUCCESS 1[0m in 1.00s]
[0m12:54:12.176917 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.zero_bedrooms
[0m12:54:12.178732 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:54:12.179024 [debug] [MainThread]: Connection 'model.rightmove_epc.uprn_address_match' was properly closed.
[0m12:54:12.179277 [debug] [MainThread]: Connection 'model.rightmove_epc.houses_report' was properly closed.
[0m12:54:12.179517 [debug] [MainThread]: Connection 'model.rightmove_epc.zero_bedrooms' was properly closed.
[0m12:54:12.179756 [debug] [MainThread]: Connection 'model.rightmove_epc.flats_report' was properly closed.
[0m12:54:12.180074 [info ] [MainThread]: 
[0m12:54:12.180363 [info ] [MainThread]: Finished running 14 view models in 0 hours 0 minutes and 5.38 seconds (5.38s).
[0m12:54:12.182102 [debug] [MainThread]: Command end result
[0m12:54:12.193061 [info ] [MainThread]: 
[0m12:54:12.193425 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m12:54:12.193644 [info ] [MainThread]: 
[0m12:54:12.193860 [error] [MainThread]:   Database Error in model uprn_address_match (models/matching/uprn_address_match.sql)
  002001 (02000): SQL compilation error:
  Object 'UPRN' does not exist or not authorized.
  compiled Code at target/run/rightmove_epc/models/matching/uprn_address_match.sql
[0m12:54:12.194094 [info ] [MainThread]: 
[0m12:54:12.194315 [info ] [MainThread]: Done. PASS=13 WARN=0 ERROR=1 SKIP=0 TOTAL=14
[0m12:54:12.196248 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 5.671751, "process_user_time": 1.687188, "process_kernel_time": 0.218026, "process_mem_max_rss": "140787712", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m12:54:12.196626 [debug] [MainThread]: Command `dbt run` failed at 12:54:12.196542 after 5.67 seconds
[0m12:54:12.196909 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104964f10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100b2a110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100b2a190>]}
[0m12:54:12.197168 [debug] [MainThread]: Flushing usage events
[0m12:55:00.263927 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1202029d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12025e690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12025f210>]}


============================== 12:55:00.266843 | f8df9190-5f0d-49ce-9243-90b01a9effcc ==============================
[0m12:55:00.266843 [info ] [MainThread]: Running with dbt=1.7.10
[0m12:55:00.267185 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select models/matching/uprn_address_match.sql', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m12:55:00.432258 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f8df9190-5f0d-49ce-9243-90b01a9effcc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120d015d0>]}
[0m12:55:00.466701 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f8df9190-5f0d-49ce-9243-90b01a9effcc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120be3ed0>]}
[0m12:55:00.467736 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m12:55:00.477304 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m12:55:00.500504 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m12:55:00.500779 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m12:55:00.504091 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f8df9190-5f0d-49ce-9243-90b01a9effcc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120e94dd0>]}
[0m12:55:00.510315 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f8df9190-5f0d-49ce-9243-90b01a9effcc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120e17e50>]}
[0m12:55:00.510558 [info ] [MainThread]: Found 14 models, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m12:55:00.510759 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f8df9190-5f0d-49ce-9243-90b01a9effcc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1202024d0>]}
[0m12:55:00.511697 [info ] [MainThread]: 
[0m12:55:00.512078 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m12:55:00.512607 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m12:55:00.518695 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m12:55:00.518925 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m12:55:00.519096 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:55:01.051889 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 1.0 seconds
[0m12:55:01.055585 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m12:55:01.161830 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m12:55:01.171864 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m12:55:01.172325 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m12:55:01.172659 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:55:01.582454 [debug] [ThreadPool]: SQL status: SUCCESS 14 in 0.0 seconds
[0m12:55:01.583881 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m12:55:01.662604 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f8df9190-5f0d-49ce-9243-90b01a9effcc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120f23710>]}
[0m12:55:01.663403 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m12:55:01.663728 [info ] [MainThread]: 
[0m12:55:01.665869 [debug] [Thread-1 (]: Began running node model.rightmove_epc.uprn_address_match
[0m12:55:01.666296 [info ] [Thread-1 (]: 1 of 1 START sql view model dbt_melissa_rm_epc.uprn_address_match .............. [RUN]
[0m12:55:01.666841 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.uprn_address_match)
[0m12:55:01.667121 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.uprn_address_match
[0m12:55:01.673119 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.uprn_address_match"
[0m12:55:01.673880 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.uprn_address_match (compile): 12:55:01.667286 => 12:55:01.673724
[0m12:55:01.674156 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.uprn_address_match
[0m12:55:01.724860 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.uprn_address_match"
[0m12:55:01.725639 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.uprn_address_match"
[0m12:55:01.725843 [debug] [Thread-1 (]: On model.rightmove_epc.uprn_address_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.uprn_address_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_address_match
  
   as (
    -- where uprn is not matched we try address.

with uprn as (

    select up.*,
    CASE WHEN ad.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC,
    ad.ADDRESSID AS EPC_ADDRESSID,
    ad.UPRN AS EPC_UPRN

     from ANALYTICS_DEV.dbt_melissa_rm_epc.no_uprn_match up
    left join ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid ad on up.ADDRESSID = ad.ADDRESSID
    and up.FULL_POSTCODE = ad.POSTCODE
   
)

SELECT * FROM UPRN
  );
[0m12:55:01.726026 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:55:02.161979 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b344a7-0103-9b63-0000-719506375c9a
[0m12:55:02.162481 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 002025 (42S21): SQL compilation error:
duplicate column name 'MATCH_EPC'
[0m12:55:02.163014 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.uprn_address_match (execute): 12:55:01.674316 => 12:55:02.162815
[0m12:55:02.163379 [debug] [Thread-1 (]: On model.rightmove_epc.uprn_address_match: Close
[0m12:55:02.261371 [debug] [Thread-1 (]: Database Error in model uprn_address_match (models/matching/uprn_address_match.sql)
  002025 (42S21): SQL compilation error:
  duplicate column name 'MATCH_EPC'
  compiled Code at target/run/rightmove_epc/models/matching/uprn_address_match.sql
[0m12:55:02.262061 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f8df9190-5f0d-49ce-9243-90b01a9effcc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120e33690>]}
[0m12:55:02.262742 [error] [Thread-1 (]: 1 of 1 ERROR creating sql view model dbt_melissa_rm_epc.uprn_address_match ..... [[31mERROR[0m in 0.60s]
[0m12:55:02.263318 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.uprn_address_match
[0m12:55:02.265036 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:55:02.265418 [debug] [MainThread]: Connection 'model.rightmove_epc.uprn_address_match' was properly closed.
[0m12:55:02.265792 [info ] [MainThread]: 
[0m12:55:02.266117 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 1.75 seconds (1.75s).
[0m12:55:02.266669 [debug] [MainThread]: Command end result
[0m12:55:02.274057 [info ] [MainThread]: 
[0m12:55:02.274404 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m12:55:02.274647 [info ] [MainThread]: 
[0m12:55:02.274896 [error] [MainThread]:   Database Error in model uprn_address_match (models/matching/uprn_address_match.sql)
  002025 (42S21): SQL compilation error:
  duplicate column name 'MATCH_EPC'
  compiled Code at target/run/rightmove_epc/models/matching/uprn_address_match.sql
[0m12:55:02.275142 [info ] [MainThread]: 
[0m12:55:02.275395 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m12:55:02.277245 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 2.0413454, "process_user_time": 1.155064, "process_kernel_time": 0.152836, "process_mem_max_rss": "132890624", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m12:55:02.277732 [debug] [MainThread]: Command `dbt run` failed at 12:55:02.277633 after 2.04 seconds
[0m12:55:02.278042 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10301ead0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120203dd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103159f50>]}
[0m12:55:02.278333 [debug] [MainThread]: Flushing usage events
[0m12:55:36.233796 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a318210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a35e450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a35efd0>]}


============================== 12:55:36.236836 | 18a66af2-3864-4ba1-9b92-4753a4290825 ==============================
[0m12:55:36.236836 [info ] [MainThread]: Running with dbt=1.7.10
[0m12:55:36.237200 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --select models/matching/uprn_address_match.sql', 'send_anonymous_usage_stats': 'True'}
[0m12:55:36.412847 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '18a66af2-3864-4ba1-9b92-4753a4290825', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ad9cc50>]}
[0m12:55:36.450201 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '18a66af2-3864-4ba1-9b92-4753a4290825', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a3a9110>]}
[0m12:55:36.450961 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m12:55:36.460666 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m12:55:36.485012 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m12:55:36.485297 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m12:55:36.488872 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '18a66af2-3864-4ba1-9b92-4753a4290825', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10af063d0>]}
[0m12:55:36.495602 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '18a66af2-3864-4ba1-9b92-4753a4290825', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10afd9fd0>]}
[0m12:55:36.495907 [info ] [MainThread]: Found 14 models, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m12:55:36.496106 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '18a66af2-3864-4ba1-9b92-4753a4290825', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10adade50>]}
[0m12:55:36.497193 [info ] [MainThread]: 
[0m12:55:36.497663 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m12:55:36.498280 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m12:55:36.505293 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m12:55:36.505610 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m12:55:36.505774 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:55:37.006415 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 1.0 seconds
[0m12:55:37.009785 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m12:55:37.110747 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m12:55:37.119377 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m12:55:37.119819 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m12:55:37.120128 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:55:37.550711 [debug] [ThreadPool]: SQL status: SUCCESS 14 in 0.0 seconds
[0m12:55:37.554030 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m12:55:37.651593 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '18a66af2-3864-4ba1-9b92-4753a4290825', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10adf7150>]}
[0m12:55:37.652581 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m12:55:37.652983 [info ] [MainThread]: 
[0m12:55:37.656552 [debug] [Thread-1 (]: Began running node model.rightmove_epc.uprn_address_match
[0m12:55:37.657097 [info ] [Thread-1 (]: 1 of 1 START sql view model dbt_melissa_rm_epc.uprn_address_match .............. [RUN]
[0m12:55:37.657738 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.uprn_address_match)
[0m12:55:37.658091 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.uprn_address_match
[0m12:55:37.665532 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.uprn_address_match"
[0m12:55:37.666444 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.uprn_address_match (compile): 12:55:37.658302 => 12:55:37.666231
[0m12:55:37.666795 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.uprn_address_match
[0m12:55:37.717104 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.uprn_address_match"
[0m12:55:37.717982 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.uprn_address_match"
[0m12:55:37.718205 [debug] [Thread-1 (]: On model.rightmove_epc.uprn_address_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.uprn_address_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_address_match
  
   as (
    -- where uprn is not matched we try address.

with uprn as (

    select up.*,
    CASE WHEN ad.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC_ADDRESS,
    ad.ADDRESSID AS EPC_ADDRESSID,
    ad.UPRN AS EPC_UPRN

     from ANALYTICS_DEV.dbt_melissa_rm_epc.no_uprn_match up
    left join ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid ad on up.ADDRESSID = ad.ADDRESSID
    and up.FULL_POSTCODE = ad.POSTCODE
   
)

SELECT * FROM UPRN
  );
[0m12:55:37.718403 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:55:38.313388 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b344a7-0103-9bad-0000-71950637751a
[0m12:55:38.313814 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 002025 (42S21): SQL compilation error:
duplicate column name 'EPC_ADDRESSID'
[0m12:55:38.314286 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.uprn_address_match (execute): 12:55:37.666996 => 12:55:38.314110
[0m12:55:38.314622 [debug] [Thread-1 (]: On model.rightmove_epc.uprn_address_match: Close
[0m12:55:38.405099 [debug] [Thread-1 (]: Database Error in model uprn_address_match (models/matching/uprn_address_match.sql)
  002025 (42S21): SQL compilation error:
  duplicate column name 'EPC_ADDRESSID'
  compiled Code at target/run/rightmove_epc/models/matching/uprn_address_match.sql
[0m12:55:38.405626 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '18a66af2-3864-4ba1-9b92-4753a4290825', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10af02b10>]}
[0m12:55:38.406121 [error] [Thread-1 (]: 1 of 1 ERROR creating sql view model dbt_melissa_rm_epc.uprn_address_match ..... [[31mERROR[0m in 0.75s]
[0m12:55:38.406561 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.uprn_address_match
[0m12:55:38.407807 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:55:38.408044 [debug] [MainThread]: Connection 'model.rightmove_epc.uprn_address_match' was properly closed.
[0m12:55:38.408268 [info ] [MainThread]: 
[0m12:55:38.408498 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 1.91 seconds (1.91s).
[0m12:55:38.408912 [debug] [MainThread]: Command end result
[0m12:55:38.414903 [info ] [MainThread]: 
[0m12:55:38.415174 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m12:55:38.415372 [info ] [MainThread]: 
[0m12:55:38.415562 [error] [MainThread]:   Database Error in model uprn_address_match (models/matching/uprn_address_match.sql)
  002025 (42S21): SQL compilation error:
  duplicate column name 'EPC_ADDRESSID'
  compiled Code at target/run/rightmove_epc/models/matching/uprn_address_match.sql
[0m12:55:38.415756 [info ] [MainThread]: 
[0m12:55:38.415949 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m12:55:38.417710 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 2.215527, "process_user_time": 1.201904, "process_kernel_time": 0.159261, "process_mem_max_rss": "136888320", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m12:55:38.418166 [debug] [MainThread]: Command `dbt run` failed at 12:55:38.418075 after 2.22 seconds
[0m12:55:38.418455 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a303dd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a35e6d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104a71f10>]}
[0m12:55:38.418725 [debug] [MainThread]: Flushing usage events
[0m12:56:01.644243 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10632c210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106372690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106373210>]}


============================== 12:56:01.647237 | 90f2a4be-8213-4bb6-b518-4d2b49421b80 ==============================
[0m12:56:01.647237 [info ] [MainThread]: Running with dbt=1.7.10
[0m12:56:01.647562 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'profiles_dir': '/Users/melissabee/.dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --select models/matching/uprn_address_match.sql', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m12:56:01.824170 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '90f2a4be-8213-4bb6-b518-4d2b49421b80', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106eb1490>]}
[0m12:56:01.859821 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '90f2a4be-8213-4bb6-b518-4d2b49421b80', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106f2b890>]}
[0m12:56:01.861378 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m12:56:01.870838 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m12:56:01.887169 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m12:56:01.887409 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m12:56:01.890570 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '90f2a4be-8213-4bb6-b518-4d2b49421b80', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107104f50>]}
[0m12:56:01.897127 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '90f2a4be-8213-4bb6-b518-4d2b49421b80', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106fd8810>]}
[0m12:56:01.897439 [info ] [MainThread]: Found 14 models, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m12:56:01.897649 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '90f2a4be-8213-4bb6-b518-4d2b49421b80', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1063b6550>]}
[0m12:56:01.898710 [info ] [MainThread]: 
[0m12:56:01.899188 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m12:56:01.899839 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m12:56:01.906523 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m12:56:01.906773 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m12:56:01.906918 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:56:02.333763 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 0.0 seconds
[0m12:56:02.336011 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m12:56:02.410805 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m12:56:02.416976 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m12:56:02.417242 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m12:56:02.417454 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:56:02.832883 [debug] [ThreadPool]: SQL status: SUCCESS 14 in 0.0 seconds
[0m12:56:02.834564 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m12:56:02.915741 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '90f2a4be-8213-4bb6-b518-4d2b49421b80', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106dbebd0>]}
[0m12:56:02.916407 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m12:56:02.916635 [info ] [MainThread]: 
[0m12:56:02.918965 [debug] [Thread-1 (]: Began running node model.rightmove_epc.uprn_address_match
[0m12:56:02.919327 [info ] [Thread-1 (]: 1 of 1 START sql view model dbt_melissa_rm_epc.uprn_address_match .............. [RUN]
[0m12:56:02.919725 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.uprn_address_match)
[0m12:56:02.919915 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.uprn_address_match
[0m12:56:02.923975 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.uprn_address_match"
[0m12:56:02.924531 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.uprn_address_match (compile): 12:56:02.920032 => 12:56:02.924405
[0m12:56:02.924750 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.uprn_address_match
[0m12:56:02.971180 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.uprn_address_match"
[0m12:56:02.972112 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.uprn_address_match"
[0m12:56:02.972378 [debug] [Thread-1 (]: On model.rightmove_epc.uprn_address_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.uprn_address_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_address_match
  
   as (
    -- where uprn is not matched we try address.

with uprn as (

    select up.*,
    CASE WHEN ad.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC_ADDRESS,
    ad.ADDRESSID AS EPC_ADDRESSID_ADDRESS,
    ad.UPRN AS EPC_UPRN_ADDRESS

     from ANALYTICS_DEV.dbt_melissa_rm_epc.no_uprn_match up
    left join ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid ad on up.ADDRESSID = ad.ADDRESSID
    and up.FULL_POSTCODE = ad.POSTCODE
   
)

SELECT * FROM UPRN
  );
[0m12:56:02.972564 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:56:03.701010 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:56:03.714784 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.uprn_address_match (execute): 12:56:02.924860 => 12:56:03.714625
[0m12:56:03.715112 [debug] [Thread-1 (]: On model.rightmove_epc.uprn_address_match: Close
[0m12:56:03.791020 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '90f2a4be-8213-4bb6-b518-4d2b49421b80', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107120410>]}
[0m12:56:03.791575 [info ] [Thread-1 (]: 1 of 1 OK created sql view model dbt_melissa_rm_epc.uprn_address_match ......... [[32mSUCCESS 1[0m in 0.87s]
[0m12:56:03.791978 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.uprn_address_match
[0m12:56:03.793246 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:56:03.793484 [debug] [MainThread]: Connection 'model.rightmove_epc.uprn_address_match' was properly closed.
[0m12:56:03.793718 [info ] [MainThread]: 
[0m12:56:03.794083 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 1.89 seconds (1.89s).
[0m12:56:03.794651 [debug] [MainThread]: Command end result
[0m12:56:03.799958 [info ] [MainThread]: 
[0m12:56:03.800211 [info ] [MainThread]: [32mCompleted successfully[0m
[0m12:56:03.800392 [info ] [MainThread]: 
[0m12:56:03.800577 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m12:56:03.802563 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 2.1876123, "process_user_time": 1.156618, "process_kernel_time": 0.151642, "process_mem_max_rss": "133906432", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m12:56:03.803027 [debug] [MainThread]: Command `dbt run` succeeded at 12:56:03.802944 after 2.19 seconds
[0m12:56:03.803290 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10639b310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1063664d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1043b1210>]}
[0m12:56:03.803531 [debug] [MainThread]: Flushing usage events
[0m12:57:10.999048 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1094a0a10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1094e6790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1094e72d0>]}


============================== 12:57:11.001644 | cc06aa7e-82c6-46f3-8ede-fb431874aae6 ==============================
[0m12:57:11.001644 [info ] [MainThread]: Running with dbt=1.7.10
[0m12:57:11.001981 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt run --select models/matching/address_match.sql', 'send_anonymous_usage_stats': 'True'}
[0m12:57:11.165635 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'cc06aa7e-82c6-46f3-8ede-fb431874aae6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1094bf510>]}
[0m12:57:11.198659 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'cc06aa7e-82c6-46f3-8ede-fb431874aae6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109cc4f90>]}
[0m12:57:11.199609 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m12:57:11.208723 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m12:57:11.237432 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m12:57:11.237720 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m12:57:11.241013 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'cc06aa7e-82c6-46f3-8ede-fb431874aae6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a0783d0>]}
[0m12:57:11.250817 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'cc06aa7e-82c6-46f3-8ede-fb431874aae6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109f5c1d0>]}
[0m12:57:11.251078 [info ] [MainThread]: Found 14 models, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m12:57:11.251271 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cc06aa7e-82c6-46f3-8ede-fb431874aae6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109c35490>]}
[0m12:57:11.252233 [info ] [MainThread]: 
[0m12:57:11.252624 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m12:57:11.253126 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m12:57:11.259399 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m12:57:11.259739 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m12:57:11.259929 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:57:11.716598 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 0.0 seconds
[0m12:57:11.718481 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m12:57:11.795971 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m12:57:11.801907 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m12:57:11.802196 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m12:57:11.802403 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:57:12.226976 [debug] [ThreadPool]: SQL status: SUCCESS 15 in 0.0 seconds
[0m12:57:12.229299 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m12:57:12.322869 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cc06aa7e-82c6-46f3-8ede-fb431874aae6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109f4c690>]}
[0m12:57:12.323864 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m12:57:12.324207 [info ] [MainThread]: 
[0m12:57:12.327334 [debug] [Thread-1 (]: Began running node model.rightmove_epc.address_match
[0m12:57:12.327805 [info ] [Thread-1 (]: 1 of 1 START sql view model dbt_melissa_rm_epc.address_match ................... [RUN]
[0m12:57:12.328433 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.address_match)
[0m12:57:12.328766 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.address_match
[0m12:57:12.335776 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.address_match"
[0m12:57:12.336689 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.address_match (compile): 12:57:12.328973 => 12:57:12.336474
[0m12:57:12.337017 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.address_match
[0m12:57:12.388704 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.address_match"
[0m12:57:12.389616 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.address_match"
[0m12:57:12.389838 [debug] [Thread-1 (]: On model.rightmove_epc.address_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.address_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NULL

),

epc_address as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
    where datasource = 'EPC'
)


SELECT rm.*,
CASE WHEN epc_address.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_address.ADDRESSID AS EPC_ADDRESSID,
epc_address.UPRN AS EPC_UPRN


FROM rm
LEFT JOIN epc_address
ON rm.addressid = epc_address.addressid
and rm.FULL_POSTCODE = epc_address.POSTCODE
  );
[0m12:57:12.390032 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:57:13.130266 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m12:57:13.148784 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.address_match (execute): 12:57:12.337215 => 12:57:13.148616
[0m12:57:13.149122 [debug] [Thread-1 (]: On model.rightmove_epc.address_match: Close
[0m12:57:13.228867 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cc06aa7e-82c6-46f3-8ede-fb431874aae6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109f248d0>]}
[0m12:57:13.229529 [info ] [Thread-1 (]: 1 of 1 OK created sql view model dbt_melissa_rm_epc.address_match .............. [[32mSUCCESS 1[0m in 0.90s]
[0m12:57:13.230009 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.address_match
[0m12:57:13.231382 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:57:13.231673 [debug] [MainThread]: Connection 'model.rightmove_epc.address_match' was properly closed.
[0m12:57:13.231951 [info ] [MainThread]: 
[0m12:57:13.232224 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 1.98 seconds (1.98s).
[0m12:57:13.232704 [debug] [MainThread]: Command end result
[0m12:57:13.240698 [info ] [MainThread]: 
[0m12:57:13.241052 [info ] [MainThread]: [32mCompleted successfully[0m
[0m12:57:13.241302 [info ] [MainThread]: 
[0m12:57:13.241547 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m12:57:13.243545 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 2.2704532, "process_user_time": 1.148747, "process_kernel_time": 0.153592, "process_mem_max_rss": "133775360", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m12:57:13.243981 [debug] [MainThread]: Command `dbt run` succeeded at 12:57:13.243900 after 2.27 seconds
[0m12:57:13.244243 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1094db610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108215850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105636150>]}
[0m12:57:13.244501 [debug] [MainThread]: Flushing usage events
[0m13:00:34.591197 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107918190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1071d7250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10795edd0>]}


============================== 13:00:34.594143 | 2918d9e3-e4fd-468f-9fd3-6cd4222a8e49 ==============================
[0m13:00:34.594143 [info ] [MainThread]: Running with dbt=1.7.10
[0m13:00:34.594489 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'debug': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --select models/matching/uprn_address_match.sql', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m13:00:34.772458 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2918d9e3-e4fd-468f-9fd3-6cd4222a8e49', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10795c110>]}
[0m13:00:34.805744 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2918d9e3-e4fd-468f-9fd3-6cd4222a8e49', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1102afe10>]}
[0m13:00:34.806356 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m13:00:34.815419 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m13:00:34.831678 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m13:00:34.831933 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m13:00:34.835392 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2918d9e3-e4fd-468f-9fd3-6cd4222a8e49', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107dc0910>]}
[0m13:00:34.843571 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2918d9e3-e4fd-468f-9fd3-6cd4222a8e49', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11051b850>]}
[0m13:00:34.843910 [info ] [MainThread]: Found 14 models, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m13:00:34.844112 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2918d9e3-e4fd-468f-9fd3-6cd4222a8e49', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11029f6d0>]}
[0m13:00:34.845159 [info ] [MainThread]: 
[0m13:00:34.845582 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m13:00:34.846250 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m13:00:34.853059 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m13:00:34.853319 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m13:00:34.853480 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:00:35.388115 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 1.0 seconds
[0m13:00:35.390322 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m13:00:35.493049 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m13:00:35.500198 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m13:00:35.500532 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m13:00:35.500801 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:00:35.953822 [debug] [ThreadPool]: SQL status: SUCCESS 15 in 0.0 seconds
[0m13:00:35.955845 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m13:00:36.042040 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2918d9e3-e4fd-468f-9fd3-6cd4222a8e49', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1104aaf50>]}
[0m13:00:36.042881 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m13:00:36.043220 [info ] [MainThread]: 
[0m13:00:36.046587 [debug] [Thread-1 (]: Began running node model.rightmove_epc.uprn_address_match
[0m13:00:36.047044 [info ] [Thread-1 (]: 1 of 1 START sql view model dbt_melissa_rm_epc.uprn_address_match .............. [RUN]
[0m13:00:36.047642 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.uprn_address_match)
[0m13:00:36.047952 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.uprn_address_match
[0m13:00:36.054119 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.uprn_address_match"
[0m13:00:36.055361 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.uprn_address_match (compile): 13:00:36.048133 => 13:00:36.055102
[0m13:00:36.055684 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.uprn_address_match
[0m13:00:36.106479 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.uprn_address_match"
[0m13:00:36.107481 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.uprn_address_match"
[0m13:00:36.107701 [debug] [Thread-1 (]: On model.rightmove_epc.uprn_address_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.uprn_address_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_address_match
  
   as (
    -- where uprn is not matched we try address.

with uprn as (

    select 
    up.LISTING_ID
    CHANGE_DATE
    up.ADDRESSID
    up.ADDRESS_1
    up.ADDRESS_2
    FULL_POSTCODE
    up.UPRN
    LOCAL_AUTHORITY_CODE
    LOCAL_AUTHORITY
    GOV_REGION_CODE
    FLOOR_AREA
    FLOOR_LEVEL
    BEDROOM
    PROPERTY_TYPE_1
    PROPERTY_TYPE_2
    STUDENTLET_FLAG
    COMBINED_PROPERTY_TYPE,
 -- need to sleect the same fields as address match
    CASE WHEN ad.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC,
    ad.ADDRESSID AS EPC_ADDRESSID,
    ad.UPRN AS EPC_UPRN

     from ANALYTICS_DEV.dbt_melissa_rm_epc.no_uprn_match up
    left join ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid ad on up.ADDRESSID = ad.ADDRESSID
    and up.FULL_POSTCODE = ad.POSTCODE
   
)

SELECT * FROM UPRN
  );
[0m13:00:36.107896 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:00:36.504474 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b344ac-0103-9b9a-0000-719506376616
[0m13:00:36.505075 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 11 at position 4 unexpected 'up'.
syntax error line 27 at position 9 unexpected 'WHEN'.
syntax error line 28 at position 6 unexpected '.'.
syntax error line 29 at position 6 unexpected '.'.
syntax error line 37 at position 0 unexpected 'SELECT'.
[0m13:00:36.505754 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.uprn_address_match (execute): 13:00:36.055864 => 13:00:36.505518
[0m13:00:36.506222 [debug] [Thread-1 (]: On model.rightmove_epc.uprn_address_match: Close
[0m13:00:36.614209 [debug] [Thread-1 (]: Database Error in model uprn_address_match (models/matching/uprn_address_match.sql)
  001003 (42000): SQL compilation error:
  syntax error line 11 at position 4 unexpected 'up'.
  syntax error line 27 at position 9 unexpected 'WHEN'.
  syntax error line 28 at position 6 unexpected '.'.
  syntax error line 29 at position 6 unexpected '.'.
  syntax error line 37 at position 0 unexpected 'SELECT'.
  compiled Code at target/run/rightmove_epc/models/matching/uprn_address_match.sql
[0m13:00:36.615053 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2918d9e3-e4fd-468f-9fd3-6cd4222a8e49', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110567690>]}
[0m13:00:36.615897 [error] [Thread-1 (]: 1 of 1 ERROR creating sql view model dbt_melissa_rm_epc.uprn_address_match ..... [[31mERROR[0m in 0.57s]
[0m13:00:36.616554 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.uprn_address_match
[0m13:00:36.618432 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:00:36.618855 [debug] [MainThread]: Connection 'model.rightmove_epc.uprn_address_match' was properly closed.
[0m13:00:36.619203 [info ] [MainThread]: 
[0m13:00:36.619556 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 1.77 seconds (1.77s).
[0m13:00:36.620144 [debug] [MainThread]: Command end result
[0m13:00:36.628444 [info ] [MainThread]: 
[0m13:00:36.628814 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m13:00:36.629051 [info ] [MainThread]: 
[0m13:00:36.629296 [error] [MainThread]:   Database Error in model uprn_address_match (models/matching/uprn_address_match.sql)
  001003 (42000): SQL compilation error:
  syntax error line 11 at position 4 unexpected 'up'.
  syntax error line 27 at position 9 unexpected 'WHEN'.
  syntax error line 28 at position 6 unexpected '.'.
  syntax error line 29 at position 6 unexpected '.'.
  syntax error line 37 at position 0 unexpected 'SELECT'.
  compiled Code at target/run/rightmove_epc/models/matching/uprn_address_match.sql
[0m13:00:36.629547 [info ] [MainThread]: 
[0m13:00:36.629775 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m13:00:36.631770 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 2.069547, "process_user_time": 1.151478, "process_kernel_time": 0.170055, "process_mem_max_rss": "135921664", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m13:00:36.632202 [debug] [MainThread]: Command `dbt run` failed at 13:00:36.632109 after 2.07 seconds
[0m13:00:36.632506 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103462ad0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10359dfd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1104503d0>]}
[0m13:00:36.632795 [debug] [MainThread]: Flushing usage events
[0m13:01:14.262866 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108d9c690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108de2650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108de31d0>]}


============================== 13:01:14.265706 | 62dfdfde-ef7e-4b7e-aa6a-20a225d11967 ==============================
[0m13:01:14.265706 [info ] [MainThread]: Running with dbt=1.7.10
[0m13:01:14.266045 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'invocation_command': 'dbt run --select models/matching/uprn_address_match.sql', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m13:01:14.432248 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '62dfdfde-ef7e-4b7e-aa6a-20a225d11967', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1098b0f50>]}
[0m13:01:14.465366 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '62dfdfde-ef7e-4b7e-aa6a-20a225d11967', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108e2ccd0>]}
[0m13:01:14.466171 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m13:01:14.475571 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m13:01:14.492866 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m13:01:14.493140 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m13:01:14.496466 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '62dfdfde-ef7e-4b7e-aa6a-20a225d11967', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109c1c290>]}
[0m13:01:14.502976 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '62dfdfde-ef7e-4b7e-aa6a-20a225d11967', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109919e10>]}
[0m13:01:14.503281 [info ] [MainThread]: Found 14 models, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m13:01:14.503483 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '62dfdfde-ef7e-4b7e-aa6a-20a225d11967', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109739a50>]}
[0m13:01:14.504547 [info ] [MainThread]: 
[0m13:01:14.504955 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m13:01:14.505532 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m13:01:14.511965 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m13:01:14.512198 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m13:01:14.512348 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:01:18.686179 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 4.0 seconds
[0m13:01:18.688586 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m13:01:18.838210 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m13:01:18.844489 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m13:01:18.844739 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m13:01:18.844912 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:01:19.328150 [debug] [ThreadPool]: SQL status: SUCCESS 15 in 0.0 seconds
[0m13:01:19.329194 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m13:01:19.452103 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '62dfdfde-ef7e-4b7e-aa6a-20a225d11967', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1098883d0>]}
[0m13:01:19.452791 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m13:01:19.452983 [info ] [MainThread]: 
[0m13:01:19.454888 [debug] [Thread-1 (]: Began running node model.rightmove_epc.uprn_address_match
[0m13:01:19.455368 [info ] [Thread-1 (]: 1 of 1 START sql view model dbt_melissa_rm_epc.uprn_address_match .............. [RUN]
[0m13:01:19.456112 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.uprn_address_match)
[0m13:01:19.456963 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.uprn_address_match
[0m13:01:19.461623 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.uprn_address_match"
[0m13:01:19.462259 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.uprn_address_match (compile): 13:01:19.457122 => 13:01:19.462126
[0m13:01:19.462470 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.uprn_address_match
[0m13:01:19.519449 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.uprn_address_match"
[0m13:01:19.520431 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.uprn_address_match"
[0m13:01:19.520658 [debug] [Thread-1 (]: On model.rightmove_epc.uprn_address_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.uprn_address_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_address_match
  
   as (
    -- where uprn is not matched we try address.

with uprn as (

    select 
    up.LISTING_ID,
    CHANGE_DATE,
    up.ADDRESSID,
    up.ADDRESS_1,
    up.ADDRESS_2,
    FULL_POSTCODE,
    up.UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    BEDROOM,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    STUDENTLET_FLAG,
    COMBINED_PROPERTY_TYPE,
 -- need to sleect the same fields as address match
    CASE WHEN ad.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC,
    ad.ADDRESSID AS EPC_ADDRESSID,
    ad.UPRN AS EPC_UPRN

     from ANALYTICS_DEV.dbt_melissa_rm_epc.no_uprn_match up
    left join ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid ad on up.ADDRESSID = ad.ADDRESSID
    and up.FULL_POSTCODE = ad.POSTCODE
   
)

SELECT * FROM UPRN
  );
[0m13:01:19.520865 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:01:20.483295 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:01:20.537795 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.uprn_address_match (execute): 13:01:19.462582 => 13:01:20.537640
[0m13:01:20.538219 [debug] [Thread-1 (]: On model.rightmove_epc.uprn_address_match: Close
[0m13:01:20.658762 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '62dfdfde-ef7e-4b7e-aa6a-20a225d11967', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109738c50>]}
[0m13:01:20.659314 [info ] [Thread-1 (]: 1 of 1 OK created sql view model dbt_melissa_rm_epc.uprn_address_match ......... [[32mSUCCESS 1[0m in 1.20s]
[0m13:01:20.659712 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.uprn_address_match
[0m13:01:20.660808 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:01:20.661016 [debug] [MainThread]: Connection 'model.rightmove_epc.uprn_address_match' was properly closed.
[0m13:01:20.661224 [info ] [MainThread]: 
[0m13:01:20.661438 [info ] [MainThread]: Finished running 1 view model in 0 hours 0 minutes and 6.16 seconds (6.16s).
[0m13:01:20.661813 [debug] [MainThread]: Command end result
[0m13:01:20.667787 [info ] [MainThread]: 
[0m13:01:20.668074 [info ] [MainThread]: [32mCompleted successfully[0m
[0m13:01:20.668270 [info ] [MainThread]: 
[0m13:01:20.668475 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m13:01:20.670109 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 6.432482, "process_user_time": 1.155953, "process_kernel_time": 0.156504, "process_mem_max_rss": "131760128", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m13:01:20.670531 [debug] [MainThread]: Command `dbt run` succeeded at 13:01:20.670440 after 6.43 seconds
[0m13:01:20.670799 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108de2a50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108a57990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104d32150>]}
[0m13:01:20.671037 [debug] [MainThread]: Flushing usage events
[0m13:16:17.258823 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106c64950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106c9dfd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106caad50>]}


============================== 13:16:17.261859 | 72d0f9d5-dadf-40cc-91d9-1940ca29b3a9 ==============================
[0m13:16:17.261859 [info ] [MainThread]: Running with dbt=1.7.10
[0m13:16:17.262232 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'debug': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --select models/staging', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m13:16:17.463119 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '72d0f9d5-dadf-40cc-91d9-1940ca29b3a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1074a49d0>]}
[0m13:16:17.503803 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '72d0f9d5-dadf-40cc-91d9-1940ca29b3a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106c9e910>]}
[0m13:16:17.504415 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m13:16:17.515176 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m13:16:17.541165 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m13:16:17.541476 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m13:16:17.545467 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '72d0f9d5-dadf-40cc-91d9-1940ca29b3a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106d3f250>]}
[0m13:16:17.553177 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '72d0f9d5-dadf-40cc-91d9-1940ca29b3a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10774bb50>]}
[0m13:16:17.553458 [info ] [MainThread]: Found 16 models, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m13:16:17.553673 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '72d0f9d5-dadf-40cc-91d9-1940ca29b3a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1074a7390>]}
[0m13:16:17.554781 [info ] [MainThread]: 
[0m13:16:17.555228 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m13:16:17.555936 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m13:16:17.563414 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m13:16:17.563708 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m13:16:17.564027 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:16:18.009029 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 0.0 seconds
[0m13:16:18.011903 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m13:16:18.109050 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m13:16:18.117578 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m13:16:18.117926 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m13:16:18.118183 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:16:18.524024 [debug] [ThreadPool]: SQL status: SUCCESS 15 in 0.0 seconds
[0m13:16:18.525334 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m13:16:18.602710 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '72d0f9d5-dadf-40cc-91d9-1940ca29b3a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1075fa4d0>]}
[0m13:16:18.603313 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m13:16:18.603530 [info ] [MainThread]: 
[0m13:16:18.606222 [debug] [Thread-1 (]: Began running node model.rightmove_epc.stg_epc_certs
[0m13:16:18.606503 [debug] [Thread-2 (]: Began running node model.rightmove_epc.stg_rightmove
[0m13:16:18.606775 [info ] [Thread-1 (]: 1 of 2 START sql view model dbt_melissa_rm_epc.stg_epc_certs ................... [RUN]
[0m13:16:18.607051 [info ] [Thread-2 (]: 2 of 2 START sql view model dbt_melissa_rm_epc.stg_rightmove ................... [RUN]
[0m13:16:18.607459 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.stg_epc_certs)
[0m13:16:18.607893 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.stg_rightmove'
[0m13:16:18.608112 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.stg_epc_certs
[0m13:16:18.608323 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.stg_rightmove
[0m13:16:18.613055 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.stg_epc_certs"
[0m13:16:18.615594 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.stg_rightmove"
[0m13:16:18.616773 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (compile): 13:16:18.608470 => 13:16:18.616630
[0m13:16:18.617004 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.stg_epc_certs
[0m13:16:18.648544 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (compile): 13:16:18.613312 => 13:16:18.648312
[0m13:16:18.664397 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.stg_epc_certs"
[0m13:16:18.664677 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.stg_rightmove
[0m13:16:18.666556 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.stg_rightmove"
[0m13:16:18.667332 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.stg_rightmove"
[0m13:16:18.668002 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.stg_epc_certs"
[0m13:16:18.668218 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_rightmove"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
  
   as (
    with rm as (

    SELECT 
    LISTING_ID,
    CHANGE_DATE,
    UPPER(TRIM(replace(REPLACE(CONCAT(ADDRESS_1::VARCHAR,ADDRESS_2::VARCHAR),' '),','))) AS ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, 
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    BEDROOM,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    STUDENTLET_FLAG,
    COMBINED_PROPERTY_TYPE
    -- property type
    FROM 
       ANALYTICS.RIGHTMOVE_PROD.CLEAN_RAW_RIGHTMOVE_DATA 

 
)

SELECT * FROM rm
  );
[0m13:16:18.668471 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_epc_certs"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
  
   as (
    WITH epc_certs as (
    
    select 
    UPRN,
    LODGEMENT_DATE,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
   -- COUNTY,
    LOCAL_AUTHORITY as LOCAL_AUTHORITY_CODE,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    UPPER(CASE WHEN (UPPER(ADDRESS1) LIKE 'FLAT%' OR UPPER(ADDRESS1) LIKE 'UNIT%') or UPPER(ADDRESS1) LIKE 'ROOM%' 
    THEN TRIM(REPLACE(REPLACE(CONCAT(ADDRESS),','),' '))
    ELSE trim(replace(replace(ADDRESS1,' '),',')) END) AS ADDRESSID,
    CASE WHEN UPRN is null and addressid is null THEN 1 else 0 end as REMOVE_FROM_RM_MATCH,
    FLOOR_LEVEL,
    FLAT_TOP_STOREY,
    FLAT_STOREY_COUNT,
    PROPERTY_TYPE
 from  RAW.EPC_TEST_DATA.EPC_CERTIFICATES 

)

SELECT * FROM epc_certs
  );
[0m13:16:18.668695 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m13:16:18.668870 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:16:19.147242 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m13:16:19.164090 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (execute): 13:16:18.617152 => 13:16:19.163918
[0m13:16:19.164446 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: Close
[0m13:16:19.255292 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:16:19.257373 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (execute): 13:16:18.664893 => 13:16:19.257238
[0m13:16:19.257900 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '72d0f9d5-dadf-40cc-91d9-1940ca29b3a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1079b1dd0>]}
[0m13:16:19.258146 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: Close
[0m13:16:19.258557 [info ] [Thread-1 (]: 1 of 2 OK created sql view model dbt_melissa_rm_epc.stg_epc_certs .............. [[32mSUCCESS 1[0m in 0.65s]
[0m13:16:19.259517 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.stg_epc_certs
[0m13:16:19.365935 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '72d0f9d5-dadf-40cc-91d9-1940ca29b3a9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10777ab90>]}
[0m13:16:19.366475 [info ] [Thread-2 (]: 2 of 2 OK created sql view model dbt_melissa_rm_epc.stg_rightmove .............. [[32mSUCCESS 1[0m in 0.76s]
[0m13:16:19.366893 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.stg_rightmove
[0m13:16:19.368100 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:16:19.368359 [debug] [MainThread]: Connection 'model.rightmove_epc.stg_epc_certs' was properly closed.
[0m13:16:19.368545 [debug] [MainThread]: Connection 'model.rightmove_epc.stg_rightmove' was properly closed.
[0m13:16:19.368757 [info ] [MainThread]: 
[0m13:16:19.368972 [info ] [MainThread]: Finished running 2 view models in 0 hours 0 minutes and 1.81 seconds (1.81s).
[0m13:16:19.369416 [debug] [MainThread]: Command end result
[0m13:16:19.375918 [info ] [MainThread]: 
[0m13:16:19.376232 [info ] [MainThread]: [32mCompleted successfully[0m
[0m13:16:19.376438 [info ] [MainThread]: 
[0m13:16:19.376650 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m13:16:19.378752 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 2.1521916, "process_user_time": 1.35195, "process_kernel_time": 0.185187, "process_mem_max_rss": "133726208", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m13:16:19.379235 [debug] [MainThread]: Command `dbt run` succeeded at 13:16:19.379149 after 2.15 seconds
[0m13:16:19.379505 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106ccf550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1059c4c90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102df6210>]}
[0m13:16:19.379759 [debug] [MainThread]: Flushing usage events
[0m13:21:06.905444 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104e8f0d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104e9a890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104e9b410>]}


============================== 13:21:06.908634 | 1b6debe6-d200-4d7f-ae4e-6843caf96811 ==============================
[0m13:21:06.908634 [info ] [MainThread]: Running with dbt=1.7.10
[0m13:21:06.909049 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select models/staging', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m13:21:07.113097 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1b6debe6-d200-4d7f-ae4e-6843caf96811', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1057c8710>]}
[0m13:21:07.155200 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1b6debe6-d200-4d7f-ae4e-6843caf96811', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104e54910>]}
[0m13:21:07.156038 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m13:21:07.165632 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m13:21:07.183900 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m13:21:07.184223 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m13:21:07.188112 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1b6debe6-d200-4d7f-ae4e-6843caf96811', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1057be690>]}
[0m13:21:07.196422 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1b6debe6-d200-4d7f-ae4e-6843caf96811', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104edc310>]}
[0m13:21:07.196706 [info ] [MainThread]: Found 16 models, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m13:21:07.196922 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1b6debe6-d200-4d7f-ae4e-6843caf96811', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105a6b990>]}
[0m13:21:07.198028 [info ] [MainThread]: 
[0m13:21:07.198470 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m13:21:07.199077 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m13:21:07.206227 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m13:21:07.206495 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m13:21:07.206677 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:21:07.670766 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 0.0 seconds
[0m13:21:07.672300 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m13:21:07.751102 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m13:21:07.756004 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m13:21:07.756250 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m13:21:07.756422 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:21:08.168465 [debug] [ThreadPool]: SQL status: SUCCESS 15 in 0.0 seconds
[0m13:21:08.170531 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m13:21:08.268372 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1b6debe6-d200-4d7f-ae4e-6843caf96811', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1057e2b50>]}
[0m13:21:08.269107 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m13:21:08.269378 [info ] [MainThread]: 
[0m13:21:08.272630 [debug] [Thread-1 (]: Began running node model.rightmove_epc.stg_epc_certs
[0m13:21:08.272972 [debug] [Thread-2 (]: Began running node model.rightmove_epc.stg_rightmove
[0m13:21:08.273404 [info ] [Thread-1 (]: 1 of 2 START sql view model dbt_melissa_rm_epc.stg_epc_certs ................... [RUN]
[0m13:21:08.273770 [info ] [Thread-2 (]: 2 of 2 START sql view model dbt_melissa_rm_epc.stg_rightmove ................... [RUN]
[0m13:21:08.274290 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.stg_epc_certs)
[0m13:21:08.274877 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.stg_rightmove'
[0m13:21:08.275182 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.stg_epc_certs
[0m13:21:08.275552 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.stg_rightmove
[0m13:21:08.280686 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.stg_epc_certs"
[0m13:21:08.284268 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.stg_rightmove"
[0m13:21:08.285464 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (compile): 13:21:08.275751 => 13:21:08.285305
[0m13:21:08.285818 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (compile): 13:21:08.280971 => 13:21:08.285599
[0m13:21:08.286139 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.stg_epc_certs
[0m13:21:08.286384 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.stg_rightmove
[0m13:21:08.336717 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.stg_epc_certs"
[0m13:21:08.338669 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.stg_rightmove"
[0m13:21:08.339566 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.stg_rightmove"
[0m13:21:08.340231 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.stg_epc_certs"
[0m13:21:08.340502 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_rightmove"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
  
   as (
    with rm as (

    SELECT 
    LISTING_ID,
    CHANGE_DATE,
    UPPER(TRIM(replace(REPLACE(CONCAT(ADDRESS_1::VARCHAR,ADDRESS_2::VARCHAR),' '),','))) AS ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, 
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    BEDROOM,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
 --   STUDENTLET_FLAG,
    COMBINED_PROPERTY_TYPE
    -- property type
    FROM 
       ANALYTICS.RIGHTMOVE_PROD.CLEAN_RAW_RIGHTMOVE_DATA 

 
)

SELECT * FROM rm
  );
[0m13:21:08.340804 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_epc_certs"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
  
   as (
    WITH epc_certs as (
    
    select 
    UPRN,
    LODGEMENT_DATE,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
   -- COUNTY,
    LOCAL_AUTHORITY as LOCAL_AUTHORITY_CODE,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    UPPER(CASE WHEN (UPPER(ADDRESS1) LIKE 'FLAT%' OR UPPER(ADDRESS1) LIKE 'UNIT%') or UPPER(ADDRESS1) LIKE 'ROOM%' 
    THEN TRIM(REPLACE(REPLACE(CONCAT(ADDRESS),','),' '))
    ELSE trim(replace(replace(ADDRESS1,' '),',')) END) AS ADDRESSID,
    CASE WHEN UPRN is null and addressid is null THEN 1 else 0 end as REMOVE_FROM_RM_MATCH,
    FLOOR_LEVEL,
    FLAT_TOP_STOREY,
    FLAT_STOREY_COUNT,
    PROPERTY_TYPE
 from  RAW.EPC_TEST_DATA.EPC_CERTIFICATES 

)

SELECT * FROM epc_certs
  );
[0m13:21:08.341056 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m13:21:08.341256 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:21:08.990642 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:21:08.991180 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:21:09.004420 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (execute): 13:21:08.336921 => 13:21:09.004284
[0m13:21:09.005937 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (execute): 13:21:08.286522 => 13:21:09.005830
[0m13:21:09.006181 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: Close
[0m13:21:09.006476 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: Close
[0m13:21:09.090357 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1b6debe6-d200-4d7f-ae4e-6843caf96811', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105db1050>]}
[0m13:21:09.090838 [info ] [Thread-2 (]: 2 of 2 OK created sql view model dbt_melissa_rm_epc.stg_rightmove .............. [[32mSUCCESS 1[0m in 0.82s]
[0m13:21:09.091174 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.stg_rightmove
[0m13:21:09.096171 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1b6debe6-d200-4d7f-ae4e-6843caf96811', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105fcbe90>]}
[0m13:21:09.096674 [info ] [Thread-1 (]: 1 of 2 OK created sql view model dbt_melissa_rm_epc.stg_epc_certs .............. [[32mSUCCESS 1[0m in 0.82s]
[0m13:21:09.097040 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.stg_epc_certs
[0m13:21:09.098136 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:21:09.098359 [debug] [MainThread]: Connection 'model.rightmove_epc.stg_epc_certs' was properly closed.
[0m13:21:09.098523 [debug] [MainThread]: Connection 'model.rightmove_epc.stg_rightmove' was properly closed.
[0m13:21:09.098724 [info ] [MainThread]: 
[0m13:21:09.098909 [info ] [MainThread]: Finished running 2 view models in 0 hours 0 minutes and 1.90 seconds (1.90s).
[0m13:21:09.099285 [debug] [MainThread]: Command end result
[0m13:21:09.104613 [info ] [MainThread]: 
[0m13:21:09.104873 [info ] [MainThread]: [32mCompleted successfully[0m
[0m13:21:09.105052 [info ] [MainThread]: 
[0m13:21:09.105232 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m13:21:09.107350 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 2.2341685, "process_user_time": 1.349023, "process_kernel_time": 0.173353, "process_mem_max_rss": "133791744", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m13:21:09.107803 [debug] [MainThread]: Command `dbt run` succeeded at 13:21:09.107725 after 2.23 seconds
[0m13:21:09.108047 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104e9a010>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100c9a210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100dee150>]}
[0m13:21:09.108271 [debug] [MainThread]: Flushing usage events
[0m13:35:08.029019 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112f18f90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112f5e5d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112f5f150>]}


============================== 13:35:08.031855 | cc4f3b58-f9e0-4776-b6e6-73233f18b7b5 ==============================
[0m13:35:08.031855 [info ] [MainThread]: Running with dbt=1.7.10
[0m13:35:08.032295 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'debug': 'False', 'warn_error': 'None', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m13:35:08.204444 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'cc4f3b58-f9e0-4776-b6e6-73233f18b7b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113a74f90>]}
[0m13:35:08.244724 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'cc4f3b58-f9e0-4776-b6e6-73233f18b7b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112f87910>]}
[0m13:35:08.245628 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m13:35:08.257595 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m13:35:08.287561 [debug] [MainThread]: Partial parsing enabled: 1 files deleted, 1 files added, 0 files changed.
[0m13:35:08.287994 [debug] [MainThread]: Partial parsing: added file: rightmove_epc://analyses/address_simularity.sql
[0m13:35:08.288177 [debug] [MainThread]: Partial parsing: deleted file: rightmove_epc://models/matching/address_simularity.sql
[0m13:35:08.348780 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'cc4f3b58-f9e0-4776-b6e6-73233f18b7b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113ef1f50>]}
[0m13:35:08.390608 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'cc4f3b58-f9e0-4776-b6e6-73233f18b7b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11375a0d0>]}
[0m13:35:08.390995 [info ] [MainThread]: Found 15 models, 1 analysis, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m13:35:08.391225 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cc4f3b58-f9e0-4776-b6e6-73233f18b7b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112f52590>]}
[0m13:35:08.392448 [info ] [MainThread]: 
[0m13:35:08.392888 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m13:35:08.393709 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m13:35:08.400721 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m13:35:08.400977 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m13:35:08.401158 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:35:08.876881 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 0.0 seconds
[0m13:35:08.879210 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m13:35:08.964144 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m13:35:08.975308 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m13:35:08.975744 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m13:35:08.976061 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:35:09.322297 [debug] [ThreadPool]: SQL status: SUCCESS 14 in 0.0 seconds
[0m13:35:09.324238 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m13:35:09.409606 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cc4f3b58-f9e0-4776-b6e6-73233f18b7b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113dc3250>]}
[0m13:35:09.410344 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m13:35:09.410650 [info ] [MainThread]: 
[0m13:35:09.413709 [debug] [Thread-1 (]: Began running node model.rightmove_epc.stg_epc_certs
[0m13:35:09.414055 [debug] [Thread-2 (]: Began running node model.rightmove_epc.stg_rightmove
[0m13:35:09.414416 [info ] [Thread-1 (]: 1 of 15 START sql view model dbt_melissa_rm_epc.stg_epc_certs .................. [RUN]
[0m13:35:09.414809 [info ] [Thread-2 (]: 2 of 15 START sql view model dbt_melissa_rm_epc.stg_rightmove .................. [RUN]
[0m13:35:09.415456 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.stg_epc_certs)
[0m13:35:09.416043 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.stg_rightmove'
[0m13:35:09.416344 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.stg_epc_certs
[0m13:35:09.416618 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.stg_rightmove
[0m13:35:09.420865 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.stg_rightmove"
[0m13:35:09.424884 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.stg_epc_certs"
[0m13:35:09.426323 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (compile): 13:35:09.416801 => 13:35:09.426144
[0m13:35:09.426628 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (compile): 13:35:09.418655 => 13:35:09.426474
[0m13:35:09.426895 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.stg_epc_certs
[0m13:35:09.427127 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.stg_rightmove
[0m13:35:09.444680 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.stg_epc_certs"
[0m13:35:09.446656 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.stg_rightmove"
[0m13:35:09.448048 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.stg_rightmove"
[0m13:35:09.448828 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.stg_epc_certs"
[0m13:35:09.449071 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_rightmove"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
  
   as (
    with rm as (

    SELECT 
    LISTING_ID,
    CHANGE_DATE,
    UPPER(TRIM(replace(REPLACE(CONCAT(ADDRESS_1::VARCHAR,ADDRESS_2::VARCHAR),' '),','))) AS ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, 
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    BEDROOM,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
 --   STUDENTLET_FLAG,
    COMBINED_PROPERTY_TYPE
    -- property type
    FROM 
       ANALYTICS.RIGHTMOVE_PROD.CLEAN_RAW_RIGHTMOVE_DATA 

 
)

SELECT * FROM rm
  );
[0m13:35:09.449348 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_epc_certs"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
  
   as (
    WITH epc_certs as (
    
    select 
    UPRN,
    LODGEMENT_DATE,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
   -- COUNTY,
    LOCAL_AUTHORITY as LOCAL_AUTHORITY_CODE,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    UPPER(CASE WHEN (UPPER(ADDRESS1) LIKE 'FLAT%' OR UPPER(ADDRESS1) LIKE 'UNIT%') or UPPER(ADDRESS1) LIKE 'ROOM%' 
    THEN TRIM(REPLACE(REPLACE(CONCAT(ADDRESS),','),' '))
    ELSE trim(replace(replace(ADDRESS1,' '),',')) END) AS ADDRESSID,
    CASE WHEN UPRN is null and addressid is null THEN 1 else 0 end as REMOVE_FROM_RM_MATCH,
    FLOOR_LEVEL,
    FLAT_TOP_STOREY,
    FLAT_STOREY_COUNT,
    PROPERTY_TYPE
 from  RAW.EPC_TEST_DATA.EPC_CERTIFICATES 

)

SELECT * FROM epc_certs
  );
[0m13:35:09.449598 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m13:35:09.449801 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:35:09.995944 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:35:10.012828 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (execute): 13:35:09.427270 => 13:35:10.012620
[0m13:35:10.013262 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: Close
[0m13:35:10.092376 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cc4f3b58-f9e0-4776-b6e6-73233f18b7b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113efeb50>]}
[0m13:35:10.093142 [info ] [Thread-1 (]: 1 of 15 OK created sql view model dbt_melissa_rm_epc.stg_epc_certs ............. [[32mSUCCESS 1[0m in 0.68s]
[0m13:35:10.093699 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.stg_epc_certs
[0m13:35:10.094328 [debug] [Thread-4 (]: Began running node model.rightmove_epc.latest_epc_urn
[0m13:35:10.094802 [info ] [Thread-4 (]: 3 of 15 START sql view model dbt_melissa_rm_epc.latest_epc_urn ................. [RUN]
[0m13:35:10.095499 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.rightmove_epc.latest_epc_urn'
[0m13:35:10.095834 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.latest_epc_urn
[0m13:35:10.098656 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.latest_epc_urn"
[0m13:35:10.100435 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.latest_epc_urn (compile): 13:35:10.096045 => 13:35:10.100185
[0m13:35:10.100790 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.latest_epc_urn
[0m13:35:10.103991 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.latest_epc_urn"
[0m13:35:10.105350 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.latest_epc_urn"
[0m13:35:10.105756 [debug] [Thread-4 (]: On model.rightmove_epc.latest_epc_urn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.latest_epc_urn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn
  
   as (
    with epc_max_date as (

    select uprn as UPRN_EPC,
    MAX(LODGEMENT_DATE) AS MAX_LODGEMENT_DATE,
    from  ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    group by 1


),

latest_epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc
    inner join epc_max_date on epc.uprn = epc_max_date.UPRN_EPC
    where MAX_LODGEMENT_DATE = LODGEMENT_DATE
   -- and uprn = 200073066

)

select DISTINCT * from latest_epc

/*
select uprn, count(*) from latest_epc
group by 1
having count(*) >1
*/
  );
[0m13:35:10.106064 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m13:35:10.277321 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:35:10.279850 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (execute): 13:35:09.444916 => 13:35:10.279676
[0m13:35:10.280190 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: Close
[0m13:35:10.363510 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cc4f3b58-f9e0-4776-b6e6-73233f18b7b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113ad9650>]}
[0m13:35:10.364040 [info ] [Thread-2 (]: 2 of 15 OK created sql view model dbt_melissa_rm_epc.stg_rightmove ............. [[32mSUCCESS 1[0m in 0.95s]
[0m13:35:10.364442 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.stg_rightmove
[0m13:35:10.364896 [debug] [Thread-1 (]: Began running node model.rightmove_epc.dim_addressid
[0m13:35:10.365175 [debug] [Thread-3 (]: Began running node model.rightmove_epc.dim_uprn
[0m13:35:10.365642 [debug] [Thread-2 (]: Began running node model.rightmove_epc.latest_rm_urn
[0m13:35:10.365433 [info ] [Thread-1 (]: 4 of 15 START sql view model dbt_melissa_rm_epc.dim_addressid .................. [RUN]
[0m13:35:10.365997 [info ] [Thread-3 (]: 5 of 15 START sql view model dbt_melissa_rm_epc.dim_uprn ....................... [RUN]
[0m13:35:10.366358 [info ] [Thread-2 (]: 6 of 15 START sql view model dbt_melissa_rm_epc.latest_rm_urn .................. [RUN]
[0m13:35:10.366833 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_epc_certs, now model.rightmove_epc.dim_addressid)
[0m13:35:10.367253 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_uprn'
[0m13:35:10.367608 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_rightmove, now model.rightmove_epc.latest_rm_urn)
[0m13:35:10.367823 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.dim_addressid
[0m13:35:10.368074 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.dim_uprn
[0m13:35:10.368322 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.latest_rm_urn
[0m13:35:10.371396 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.dim_addressid"
[0m13:35:10.373372 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.dim_uprn"
[0m13:35:10.375181 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.latest_rm_urn"
[0m13:35:10.376032 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.latest_rm_urn (compile): 13:35:10.373560 => 13:35:10.375826
[0m13:35:10.376318 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.latest_rm_urn
[0m13:35:10.378326 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.latest_rm_urn"
[0m13:35:10.378602 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.dim_addressid (compile): 13:35:10.368455 => 13:35:10.378477
[0m13:35:10.378858 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.dim_uprn (compile): 13:35:10.371594 => 13:35:10.378726
[0m13:35:10.379134 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.dim_addressid
[0m13:35:10.379385 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.dim_uprn
[0m13:35:10.381279 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.dim_addressid"
[0m13:35:10.381892 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.latest_rm_urn"
[0m13:35:10.384023 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.dim_uprn"
[0m13:35:10.384354 [debug] [Thread-2 (]: On model.rightmove_epc.latest_rm_urn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.latest_rm_urn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NOT NULL
),

change_date AS (
    SELECT 
        UPRN AS UPRN_CD, 
        MAX(CHANGE_DATE) AS MAX_CHANGE_DATE 
    FROM rm
    GROUP BY UPRN
),

rm_latest as (

    SELECT distinct * FROM rm
    LEFT JOIN change_date cd
    ON rm.UPRN = cd.UPRN_CD
    WHERE cd.MAX_CHANGE_DATE = rm.CHANGE_DATE 
   and UPRN = 100090588560
    
)

select DISTINCT * from rm_latest

/*
select uprn, count(*) from rm_latest
group by 1
having count(*) >1
*/
  );
[0m13:35:10.384709 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m13:35:10.385339 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.dim_addressid"
[0m13:35:10.386527 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.dim_uprn"
[0m13:35:10.386775 [debug] [Thread-1 (]: On model.rightmove_epc.dim_addressid: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_addressid"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE ADDRESS'

with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource,
    POSTCODE

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    where REMOVE_FROM_RM_MATCH = 0
    AND ADDRESSID IS NOT NULL

),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    WHERE ADDRESSID IS NOT NULL

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where addressid is not null
  );
[0m13:35:10.387316 [debug] [Thread-3 (]: On model.rightmove_epc.dim_uprn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_uprn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE UPRNS


with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource,
    POSTCODE
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    where REMOVE_FROM_RM_MATCH = 0
    AND UPRN IS NOT NULL
),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    WHERE UPRN IS NOT NULL

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where uprn is not null
  );
[0m13:35:10.387583 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:35:10.387794 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m13:35:10.623516 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:35:10.626160 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.latest_epc_urn (execute): 13:35:10.100981 => 13:35:10.625963
[0m13:35:10.626822 [debug] [Thread-4 (]: On model.rightmove_epc.latest_epc_urn: Close
[0m13:35:10.772452 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cc4f3b58-f9e0-4776-b6e6-73233f18b7b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113effed0>]}
[0m13:35:10.773165 [info ] [Thread-4 (]: 3 of 15 OK created sql view model dbt_melissa_rm_epc.latest_epc_urn ............ [[32mSUCCESS 1[0m in 0.68s]
[0m13:35:10.773725 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.latest_epc_urn
[0m13:35:10.912410 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:35:10.915513 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.dim_addressid (execute): 13:35:10.379523 => 13:35:10.915287
[0m13:35:10.915956 [debug] [Thread-1 (]: On model.rightmove_epc.dim_addressid: Close
[0m13:35:10.923006 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:35:10.925365 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.latest_rm_urn (execute): 13:35:10.376486 => 13:35:10.925183
[0m13:35:10.925727 [debug] [Thread-2 (]: On model.rightmove_epc.latest_rm_urn: Close
[0m13:35:10.943974 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:35:10.946514 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.dim_uprn (execute): 13:35:10.382039 => 13:35:10.946322
[0m13:35:10.946892 [debug] [Thread-3 (]: On model.rightmove_epc.dim_uprn: Close
[0m13:35:10.993077 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cc4f3b58-f9e0-4776-b6e6-73233f18b7b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113fa5650>]}
[0m13:35:10.993759 [info ] [Thread-1 (]: 4 of 15 OK created sql view model dbt_melissa_rm_epc.dim_addressid ............. [[32mSUCCESS 1[0m in 0.63s]
[0m13:35:10.994721 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.dim_addressid
[0m13:35:10.995359 [debug] [Thread-4 (]: Began running node model.rightmove_epc.address_match
[0m13:35:10.995834 [info ] [Thread-4 (]: 7 of 15 START sql view model dbt_melissa_rm_epc.address_match .................. [RUN]
[0m13:35:10.996483 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.latest_epc_urn, now model.rightmove_epc.address_match)
[0m13:35:10.996797 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.address_match
[0m13:35:10.997389 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cc4f3b58-f9e0-4776-b6e6-73233f18b7b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113bf5d10>]}
[0m13:35:11.000572 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.address_match"
[0m13:35:11.001059 [info ] [Thread-2 (]: 6 of 15 OK created sql view model dbt_melissa_rm_epc.latest_rm_urn ............. [[32mSUCCESS 1[0m in 0.63s]
[0m13:35:11.001733 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.latest_rm_urn
[0m13:35:11.003744 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.address_match (compile): 13:35:10.997570 => 13:35:11.003531
[0m13:35:11.004070 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.address_match
[0m13:35:11.006662 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.address_match"
[0m13:35:11.007715 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.address_match"
[0m13:35:11.008019 [debug] [Thread-4 (]: On model.rightmove_epc.address_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.address_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NULL

),

epc_address as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
    where datasource = 'EPC'
)


SELECT rm.*,
CASE WHEN epc_address.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_address.ADDRESSID AS EPC_ADDRESSID,
epc_address.UPRN AS EPC_UPRN


FROM rm
LEFT JOIN epc_address
ON rm.addressid = epc_address.addressid
and rm.FULL_POSTCODE = epc_address.POSTCODE
  );
[0m13:35:11.008306 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m13:35:11.030562 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cc4f3b58-f9e0-4776-b6e6-73233f18b7b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114999750>]}
[0m13:35:11.031360 [info ] [Thread-3 (]: 5 of 15 OK created sql view model dbt_melissa_rm_epc.dim_uprn .................. [[32mSUCCESS 1[0m in 0.66s]
[0m13:35:11.031810 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.dim_uprn
[0m13:35:11.032263 [debug] [Thread-1 (]: Began running node model.rightmove_epc.no_uprn_match
[0m13:35:11.032541 [debug] [Thread-2 (]: Began running node model.rightmove_epc.uprn_match
[0m13:35:11.032826 [info ] [Thread-1 (]: 8 of 15 START sql view model dbt_melissa_rm_epc.no_uprn_match .................. [RUN]
[0m13:35:11.033108 [info ] [Thread-2 (]: 9 of 15 START sql view model dbt_melissa_rm_epc.uprn_match ..................... [RUN]
[0m13:35:11.033545 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.dim_addressid, now model.rightmove_epc.no_uprn_match)
[0m13:35:11.033930 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.latest_rm_urn, now model.rightmove_epc.uprn_match)
[0m13:35:11.034166 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.no_uprn_match
[0m13:35:11.034388 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.uprn_match
[0m13:35:11.036737 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.no_uprn_match"
[0m13:35:11.038868 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.uprn_match"
[0m13:35:11.039453 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.no_uprn_match (compile): 13:35:11.034529 => 13:35:11.039312
[0m13:35:11.039705 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.no_uprn_match
[0m13:35:11.040034 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.uprn_match (compile): 13:35:11.036986 => 13:35:11.039851
[0m13:35:11.043763 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.no_uprn_match"
[0m13:35:11.044128 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.uprn_match
[0m13:35:11.046537 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.uprn_match"
[0m13:35:11.047351 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.no_uprn_match"
[0m13:35:11.047669 [debug] [Thread-1 (]: On model.rightmove_epc.no_uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.no_uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.no_uprn_match
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn 
    where UPRN IS NOT NULL
),

epc_uprn as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
    where datasource = 'EPC'
)


SELECT rm_latest.*,
CASE WHEN epc_uprn.UPRN is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_uprn.UPRN AS EPC_UPRN,
epc_uprn.ADDRESSID AS EPC_ADDRESSID


FROM rm_latest
LEFT JOIN epc_uprn
ON rm_latest.UPRN = epc_uprn.UPRN

WHERE MATCH_EPC = 'NO'
  );
[0m13:35:11.048256 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.uprn_match"
[0m13:35:11.048477 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:35:11.048724 [debug] [Thread-2 (]: On model.rightmove_epc.uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn
    where UPRN IS NOT NULL
),

epc_uprn as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
    where datasource = 'EPC'
)


SELECT rm_latest.*,
CASE WHEN epc_uprn.UPRN is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_uprn.UPRN AS EPC_UPRN,
epc_uprn.ADDRESSID AS EPC_ADDRESSID


FROM rm_latest
LEFT JOIN epc_uprn
ON rm_latest.UPRN = epc_uprn.UPRN

WHERE MATCH_EPC = 'YES'
  );
[0m13:35:11.049709 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m13:35:11.431270 [debug] [Thread-2 (]: Snowflake adapter: Snowflake query id: 01b344cf-0103-9b8b-0000-7195063783ea
[0m13:35:11.431749 [debug] [Thread-2 (]: Snowflake adapter: Snowflake error: 002003 (42S02): SQL compilation error:
Object 'ANALYTICS_DEV.DBT_MELISSA_RM_EPC.RM_LATEST' does not exist or not authorized.
[0m13:35:11.432280 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.uprn_match (execute): 13:35:11.044538 => 13:35:11.432087
[0m13:35:11.432631 [debug] [Thread-2 (]: On model.rightmove_epc.uprn_match: Close
[0m13:35:11.446099 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b344cf-0103-9b9a-0000-719506376996
[0m13:35:11.446568 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 002003 (42S02): SQL compilation error:
Object 'ANALYTICS_DEV.DBT_MELISSA_RM_EPC.RM_LATEST' does not exist or not authorized.
[0m13:35:11.447089 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.no_uprn_match (execute): 13:35:11.040197 => 13:35:11.446899
[0m13:35:11.447439 [debug] [Thread-1 (]: On model.rightmove_epc.no_uprn_match: Close
[0m13:35:11.530735 [debug] [Thread-2 (]: Database Error in model uprn_match (models/matching/uprn_match.sql)
  002003 (42S02): SQL compilation error:
  Object 'ANALYTICS_DEV.DBT_MELISSA_RM_EPC.RM_LATEST' does not exist or not authorized.
  compiled Code at target/run/rightmove_epc/models/matching/uprn_match.sql
[0m13:35:11.532297 [debug] [Thread-1 (]: Database Error in model no_uprn_match (models/matching/no_uprn_match.sql)
  002003 (42S02): SQL compilation error:
  Object 'ANALYTICS_DEV.DBT_MELISSA_RM_EPC.RM_LATEST' does not exist or not authorized.
  compiled Code at target/run/rightmove_epc/models/matching/no_uprn_match.sql
[0m13:35:11.532764 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cc4f3b58-f9e0-4776-b6e6-73233f18b7b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113ff7350>]}
[0m13:35:11.533144 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cc4f3b58-f9e0-4776-b6e6-73233f18b7b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113bc0610>]}
[0m13:35:11.533640 [error] [Thread-2 (]: 9 of 15 ERROR creating sql view model dbt_melissa_rm_epc.uprn_match ............ [[31mERROR[0m in 0.50s]
[0m13:35:11.534078 [error] [Thread-1 (]: 8 of 15 ERROR creating sql view model dbt_melissa_rm_epc.no_uprn_match ......... [[31mERROR[0m in 0.50s]
[0m13:35:11.534633 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.uprn_match
[0m13:35:11.535027 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.no_uprn_match
[0m13:35:11.535617 [debug] [Thread-3 (]: Began running node model.rightmove_epc.uprn_address_match
[0m13:35:11.535922 [info ] [Thread-3 (]: 10 of 15 SKIP relation dbt_melissa_rm_epc.uprn_address_match ................... [[33mSKIP[0m]
[0m13:35:11.536211 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.uprn_address_match
[0m13:35:11.583273 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:35:11.585213 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.address_match (execute): 13:35:11.004236 => 13:35:11.585074
[0m13:35:11.585479 [debug] [Thread-4 (]: On model.rightmove_epc.address_match: Close
[0m13:35:11.677167 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cc4f3b58-f9e0-4776-b6e6-73233f18b7b5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112490550>]}
[0m13:35:11.677928 [info ] [Thread-4 (]: 7 of 15 OK created sql view model dbt_melissa_rm_epc.address_match ............. [[32mSUCCESS 1[0m in 0.68s]
[0m13:35:11.678428 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.address_match
[0m13:35:11.679253 [debug] [Thread-1 (]: Began running node model.rightmove_epc.flats_report
[0m13:35:11.679687 [debug] [Thread-2 (]: Began running node model.rightmove_epc.houses_report
[0m13:35:11.680038 [debug] [Thread-3 (]: Began running node model.rightmove_epc.rm_all_matches
[0m13:35:11.680378 [debug] [Thread-4 (]: Began running node model.rightmove_epc.rm_no_matches
[0m13:35:11.680680 [info ] [Thread-1 (]: 11 of 15 SKIP relation dbt_melissa_rm_epc.flats_report ......................... [[33mSKIP[0m]
[0m13:35:11.681032 [info ] [Thread-2 (]: 12 of 15 SKIP relation dbt_melissa_rm_epc.houses_report ........................ [[33mSKIP[0m]
[0m13:35:11.681424 [info ] [Thread-3 (]: 13 of 15 SKIP relation dbt_melissa_rm_epc.rm_all_matches ....................... [[33mSKIP[0m]
[0m13:35:11.681775 [info ] [Thread-4 (]: 14 of 15 SKIP relation dbt_melissa_rm_epc.rm_no_matches ........................ [[33mSKIP[0m]
[0m13:35:11.682110 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.flats_report
[0m13:35:11.682386 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.houses_report
[0m13:35:11.682645 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.rm_all_matches
[0m13:35:11.682902 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.rm_no_matches
[0m13:35:11.683443 [debug] [Thread-1 (]: Began running node model.rightmove_epc.zero_bedrooms
[0m13:35:11.683809 [info ] [Thread-1 (]: 15 of 15 SKIP relation dbt_melissa_rm_epc.zero_bedrooms ........................ [[33mSKIP[0m]
[0m13:35:11.684120 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.zero_bedrooms
[0m13:35:11.685426 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:35:11.685712 [debug] [MainThread]: Connection 'model.rightmove_epc.no_uprn_match' was properly closed.
[0m13:35:11.685923 [debug] [MainThread]: Connection 'model.rightmove_epc.uprn_match' was properly closed.
[0m13:35:11.686116 [debug] [MainThread]: Connection 'model.rightmove_epc.address_match' was properly closed.
[0m13:35:11.686301 [debug] [MainThread]: Connection 'model.rightmove_epc.dim_uprn' was properly closed.
[0m13:35:11.686573 [info ] [MainThread]: 
[0m13:35:11.686807 [info ] [MainThread]: Finished running 15 view models in 0 hours 0 minutes and 3.29 seconds (3.29s).
[0m13:35:11.687885 [debug] [MainThread]: Command end result
[0m13:35:11.694411 [info ] [MainThread]: 
[0m13:35:11.694689 [info ] [MainThread]: [31mCompleted with 2 errors and 0 warnings:[0m
[0m13:35:11.695136 [info ] [MainThread]: 
[0m13:35:11.695365 [error] [MainThread]:   Database Error in model uprn_match (models/matching/uprn_match.sql)
  002003 (42S02): SQL compilation error:
  Object 'ANALYTICS_DEV.DBT_MELISSA_RM_EPC.RM_LATEST' does not exist or not authorized.
  compiled Code at target/run/rightmove_epc/models/matching/uprn_match.sql
[0m13:35:11.695570 [info ] [MainThread]: 
[0m13:35:11.695759 [error] [MainThread]:   Database Error in model no_uprn_match (models/matching/no_uprn_match.sql)
  002003 (42S02): SQL compilation error:
  Object 'ANALYTICS_DEV.DBT_MELISSA_RM_EPC.RM_LATEST' does not exist or not authorized.
  compiled Code at target/run/rightmove_epc/models/matching/no_uprn_match.sql
[0m13:35:11.695969 [info ] [MainThread]: 
[0m13:35:11.696164 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=2 SKIP=6 TOTAL=15
[0m13:35:11.699154 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 3.6994216, "process_user_time": 1.715548, "process_kernel_time": 0.199344, "process_mem_max_rss": "141852672", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m13:35:11.699509 [debug] [MainThread]: Command `dbt run` failed at 13:35:11.699428 after 3.70 seconds
[0m13:35:11.699775 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104a8e110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112f87350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112f87010>]}
[0m13:35:11.700014 [debug] [MainThread]: Flushing usage events
[0m13:37:30.239245 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111e18b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111e51fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111e5ed90>]}


============================== 13:37:30.242483 | cf2fd68a-bd13-4342-8548-d70b4180b4b6 ==============================
[0m13:37:30.242483 [info ] [MainThread]: Running with dbt=1.7.10
[0m13:37:30.242855 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt run', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m13:37:30.444994 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'cf2fd68a-bd13-4342-8548-d70b4180b4b6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111e877d0>]}
[0m13:37:30.485681 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'cf2fd68a-bd13-4342-8548-d70b4180b4b6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114142690>]}
[0m13:37:30.486400 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m13:37:30.497566 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m13:37:30.528428 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m13:37:30.528728 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m13:37:30.532522 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'cf2fd68a-bd13-4342-8548-d70b4180b4b6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1141071d0>]}
[0m13:37:30.541548 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'cf2fd68a-bd13-4342-8548-d70b4180b4b6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111e19490>]}
[0m13:37:30.541903 [info ] [MainThread]: Found 15 models, 1 analysis, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m13:37:30.542140 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cf2fd68a-bd13-4342-8548-d70b4180b4b6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1142da5d0>]}
[0m13:37:30.543458 [info ] [MainThread]: 
[0m13:37:30.543923 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m13:37:30.544834 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m13:37:30.552249 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m13:37:30.552580 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m13:37:30.552764 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:37:31.031092 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 0.0 seconds
[0m13:37:31.035593 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m13:37:31.111828 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m13:37:31.120455 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m13:37:31.120828 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m13:37:31.121132 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:37:31.496761 [debug] [ThreadPool]: SQL status: SUCCESS 16 in 0.0 seconds
[0m13:37:31.498740 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m13:37:31.592411 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cf2fd68a-bd13-4342-8548-d70b4180b4b6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112ffe950>]}
[0m13:37:31.593261 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m13:37:31.593575 [info ] [MainThread]: 
[0m13:37:31.595893 [debug] [Thread-1 (]: Began running node model.rightmove_epc.stg_epc_certs
[0m13:37:31.596224 [debug] [Thread-2 (]: Began running node model.rightmove_epc.stg_rightmove
[0m13:37:31.596655 [info ] [Thread-1 (]: 1 of 15 START sql view model dbt_melissa_rm_epc.stg_epc_certs .................. [RUN]
[0m13:37:31.597074 [info ] [Thread-2 (]: 2 of 15 START sql view model dbt_melissa_rm_epc.stg_rightmove .................. [RUN]
[0m13:37:31.597665 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.stg_epc_certs)
[0m13:37:31.598240 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.stg_rightmove'
[0m13:37:31.598555 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.stg_epc_certs
[0m13:37:31.598802 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.stg_rightmove
[0m13:37:31.604858 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.stg_epc_certs"
[0m13:37:31.607986 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.stg_rightmove"
[0m13:37:31.609003 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (compile): 13:37:31.598964 => 13:37:31.608836
[0m13:37:31.609304 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (compile): 13:37:31.605070 => 13:37:31.609139
[0m13:37:31.609570 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.stg_epc_certs
[0m13:37:31.609811 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.stg_rightmove
[0m13:37:31.656740 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.stg_epc_certs"
[0m13:37:31.658584 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.stg_rightmove"
[0m13:37:31.659545 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.stg_epc_certs"
[0m13:37:31.660091 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.stg_rightmove"
[0m13:37:31.660357 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_epc_certs"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
  
   as (
    WITH epc_certs as (
    
    select 
    UPRN,
    LODGEMENT_DATE,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
   -- COUNTY,
    LOCAL_AUTHORITY as LOCAL_AUTHORITY_CODE,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    UPPER(CASE WHEN (UPPER(ADDRESS1) LIKE 'FLAT%' OR UPPER(ADDRESS1) LIKE 'UNIT%') or UPPER(ADDRESS1) LIKE 'ROOM%' 
    THEN TRIM(REPLACE(REPLACE(CONCAT(ADDRESS),','),' '))
    ELSE trim(replace(replace(ADDRESS1,' '),',')) END) AS ADDRESSID,
    CASE WHEN UPRN is null and addressid is null THEN 1 else 0 end as REMOVE_FROM_RM_MATCH,
    FLOOR_LEVEL,
    FLAT_TOP_STOREY,
    FLAT_STOREY_COUNT,
    PROPERTY_TYPE
 from  RAW.EPC_TEST_DATA.EPC_CERTIFICATES 

)

SELECT * FROM epc_certs
  );
[0m13:37:31.660621 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_rightmove"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
  
   as (
    with rm as (

    SELECT 
    LISTING_ID,
    CHANGE_DATE,
    UPPER(TRIM(replace(REPLACE(CONCAT(ADDRESS_1::VARCHAR,ADDRESS_2::VARCHAR),' '),','))) AS ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, 
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    BEDROOM,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
 --   STUDENTLET_FLAG,
    COMBINED_PROPERTY_TYPE
    -- property type
    FROM 
       ANALYTICS.RIGHTMOVE_PROD.CLEAN_RAW_RIGHTMOVE_DATA 

 
)

SELECT * FROM rm
  );
[0m13:37:31.660961 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:37:31.661245 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m13:37:32.238309 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:37:32.258662 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (execute): 13:37:31.656917 => 13:37:32.258463
[0m13:37:32.259247 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:37:32.259541 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: Close
[0m13:37:32.261402 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (execute): 13:37:31.609963 => 13:37:32.261255
[0m13:37:32.262367 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: Close
[0m13:37:32.333571 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cf2fd68a-bd13-4342-8548-d70b4180b4b6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1142fd410>]}
[0m13:37:32.334147 [info ] [Thread-2 (]: 2 of 15 OK created sql view model dbt_melissa_rm_epc.stg_rightmove ............. [[32mSUCCESS 1[0m in 0.74s]
[0m13:37:32.334582 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.stg_rightmove
[0m13:37:32.335048 [debug] [Thread-4 (]: Began running node model.rightmove_epc.latest_rm_urn
[0m13:37:32.335405 [info ] [Thread-4 (]: 3 of 15 START sql view model dbt_melissa_rm_epc.latest_rm_urn .................. [RUN]
[0m13:37:32.335965 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.rightmove_epc.latest_rm_urn'
[0m13:37:32.336222 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.latest_rm_urn
[0m13:37:32.338586 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.latest_rm_urn"
[0m13:37:32.340374 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.latest_rm_urn (compile): 13:37:32.336384 => 13:37:32.340219
[0m13:37:32.340624 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.latest_rm_urn
[0m13:37:32.342918 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.latest_rm_urn"
[0m13:37:32.343837 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.latest_rm_urn"
[0m13:37:32.344132 [debug] [Thread-4 (]: On model.rightmove_epc.latest_rm_urn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.latest_rm_urn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NOT NULL
),

change_date AS (
    SELECT 
        UPRN AS UPRN_CD, 
        MAX(CHANGE_DATE) AS MAX_CHANGE_DATE 
    FROM rm
    GROUP BY UPRN
),

rm_latest as (

    SELECT distinct * FROM rm
    LEFT JOIN change_date cd
    ON rm.UPRN = cd.UPRN_CD
    WHERE cd.MAX_CHANGE_DATE = rm.CHANGE_DATE 
 --  and UPRN = 100090588560
    
)

select DISTINCT * from rm_latest

/*
select uprn, count(*) from rm_latest
group by 1
having count(*) >1
*/
  );
[0m13:37:32.344409 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m13:37:32.352446 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cf2fd68a-bd13-4342-8548-d70b4180b4b6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1142f7310>]}
[0m13:37:32.352907 [info ] [Thread-1 (]: 1 of 15 OK created sql view model dbt_melissa_rm_epc.stg_epc_certs ............. [[32mSUCCESS 1[0m in 0.76s]
[0m13:37:32.353290 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.stg_epc_certs
[0m13:37:32.353687 [debug] [Thread-2 (]: Began running node model.rightmove_epc.dim_addressid
[0m13:37:32.353949 [debug] [Thread-3 (]: Began running node model.rightmove_epc.dim_uprn
[0m13:37:32.354239 [info ] [Thread-2 (]: 4 of 15 START sql view model dbt_melissa_rm_epc.dim_addressid .................. [RUN]
[0m13:37:32.354513 [debug] [Thread-1 (]: Began running node model.rightmove_epc.latest_epc_urn
[0m13:37:32.354787 [info ] [Thread-3 (]: 5 of 15 START sql view model dbt_melissa_rm_epc.dim_uprn ....................... [RUN]
[0m13:37:32.355222 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_rightmove, now model.rightmove_epc.dim_addressid)
[0m13:37:32.355495 [info ] [Thread-1 (]: 6 of 15 START sql view model dbt_melissa_rm_epc.latest_epc_urn ................. [RUN]
[0m13:37:32.355949 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_uprn'
[0m13:37:32.356178 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.dim_addressid
[0m13:37:32.356564 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_epc_certs, now model.rightmove_epc.latest_epc_urn)
[0m13:37:32.356780 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.dim_uprn
[0m13:37:32.358869 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.dim_addressid"
[0m13:37:32.359106 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.latest_epc_urn
[0m13:37:32.361014 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.dim_uprn"
[0m13:37:32.362858 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.latest_epc_urn"
[0m13:37:32.363478 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.dim_addressid (compile): 13:37:32.356920 => 13:37:32.363313
[0m13:37:32.363737 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.dim_uprn (compile): 13:37:32.359237 => 13:37:32.363610
[0m13:37:32.363976 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.latest_epc_urn (compile): 13:37:32.361305 => 13:37:32.363859
[0m13:37:32.364193 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.dim_addressid
[0m13:37:32.364399 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.dim_uprn
[0m13:37:32.364595 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.latest_epc_urn
[0m13:37:32.366505 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.dim_addressid"
[0m13:37:32.369296 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.dim_uprn"
[0m13:37:32.370978 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.latest_epc_urn"
[0m13:37:32.371994 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.dim_addressid"
[0m13:37:32.372227 [debug] [Thread-2 (]: On model.rightmove_epc.dim_addressid: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_addressid"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE ADDRESS'

with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource,
    POSTCODE

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    where REMOVE_FROM_RM_MATCH = 0
    AND ADDRESSID IS NOT NULL

),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    WHERE ADDRESSID IS NOT NULL

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where addressid is not null
  );
[0m13:37:32.372493 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m13:37:32.373088 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.dim_uprn"
[0m13:37:32.373846 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.latest_epc_urn"
[0m13:37:32.374304 [debug] [Thread-3 (]: On model.rightmove_epc.dim_uprn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_uprn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE UPRNS


with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource,
    POSTCODE
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    where REMOVE_FROM_RM_MATCH = 0
    AND UPRN IS NOT NULL
),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    WHERE UPRN IS NOT NULL

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where uprn is not null
  );
[0m13:37:32.375071 [debug] [Thread-1 (]: On model.rightmove_epc.latest_epc_urn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.latest_epc_urn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn
  
   as (
    with epc_max_date as (

    select uprn as UPRN_EPC,
    MAX(LODGEMENT_DATE) AS MAX_LODGEMENT_DATE,
    from  ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    group by 1


),

latest_epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc
    inner join epc_max_date on epc.uprn = epc_max_date.UPRN_EPC
    where MAX_LODGEMENT_DATE = LODGEMENT_DATE
   -- and uprn = 200073066

)

select DISTINCT * from latest_epc

/*
select uprn, count(*) from latest_epc
group by 1
having count(*) >1
*/
  );
[0m13:37:32.375453 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m13:37:32.375698 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:37:32.901354 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:37:32.906515 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.latest_rm_urn (execute): 13:37:32.340773 => 13:37:32.906161
[0m13:37:32.907205 [debug] [Thread-4 (]: On model.rightmove_epc.latest_rm_urn: Close
[0m13:37:32.922081 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:37:32.924372 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.dim_addressid (execute): 13:37:32.364720 => 13:37:32.924201
[0m13:37:32.924689 [debug] [Thread-2 (]: On model.rightmove_epc.dim_addressid: Close
[0m13:37:32.938485 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:37:32.940660 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.dim_uprn (execute): 13:37:32.366675 => 13:37:32.940498
[0m13:37:32.940970 [debug] [Thread-3 (]: On model.rightmove_epc.dim_uprn: Close
[0m13:37:32.965806 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:37:32.968519 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.latest_epc_urn (execute): 13:37:32.369463 => 13:37:32.968354
[0m13:37:32.968834 [debug] [Thread-1 (]: On model.rightmove_epc.latest_epc_urn: Close
[0m13:37:32.988803 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cf2fd68a-bd13-4342-8548-d70b4180b4b6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11521b3d0>]}
[0m13:37:32.989378 [info ] [Thread-4 (]: 3 of 15 OK created sql view model dbt_melissa_rm_epc.latest_rm_urn ............. [[32mSUCCESS 1[0m in 0.65s]
[0m13:37:32.989902 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.latest_rm_urn
[0m13:37:33.006960 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cf2fd68a-bd13-4342-8548-d70b4180b4b6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1144e7e50>]}
[0m13:37:33.007594 [info ] [Thread-2 (]: 4 of 15 OK created sql view model dbt_melissa_rm_epc.dim_addressid ............. [[32mSUCCESS 1[0m in 0.65s]
[0m13:37:33.008118 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.dim_addressid
[0m13:37:33.008708 [debug] [Thread-4 (]: Began running node model.rightmove_epc.address_match
[0m13:37:33.009081 [info ] [Thread-4 (]: 7 of 15 START sql view model dbt_melissa_rm_epc.address_match .................. [RUN]
[0m13:37:33.009646 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.latest_rm_urn, now model.rightmove_epc.address_match)
[0m13:37:33.009959 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.address_match
[0m13:37:33.012489 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.address_match"
[0m13:37:33.014788 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.address_match (compile): 13:37:33.010128 => 13:37:33.014527
[0m13:37:33.015138 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.address_match
[0m13:37:33.018109 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.address_match"
[0m13:37:33.019089 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.address_match"
[0m13:37:33.019665 [debug] [Thread-4 (]: On model.rightmove_epc.address_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.address_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NULL

),

epc_address as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
    where datasource = 'EPC'
)


SELECT rm.*,
CASE WHEN epc_address.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_address.ADDRESSID AS EPC_ADDRESSID,
epc_address.UPRN AS EPC_UPRN


FROM rm
LEFT JOIN epc_address
ON rm.addressid = epc_address.addressid
and rm.FULL_POSTCODE = epc_address.POSTCODE
  );
[0m13:37:33.019951 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m13:37:33.021536 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cf2fd68a-bd13-4342-8548-d70b4180b4b6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114482710>]}
[0m13:37:33.021949 [info ] [Thread-3 (]: 5 of 15 OK created sql view model dbt_melissa_rm_epc.dim_uprn .................. [[32mSUCCESS 1[0m in 0.67s]
[0m13:37:33.022589 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.dim_uprn
[0m13:37:33.023152 [debug] [Thread-2 (]: Began running node model.rightmove_epc.no_uprn_match
[0m13:37:33.023389 [debug] [Thread-3 (]: Began running node model.rightmove_epc.uprn_match
[0m13:37:33.023719 [info ] [Thread-2 (]: 8 of 15 START sql view model dbt_melissa_rm_epc.no_uprn_match .................. [RUN]
[0m13:37:33.024027 [info ] [Thread-3 (]: 9 of 15 START sql view model dbt_melissa_rm_epc.uprn_match ..................... [RUN]
[0m13:37:33.024482 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.dim_addressid, now model.rightmove_epc.no_uprn_match)
[0m13:37:33.024875 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.dim_uprn, now model.rightmove_epc.uprn_match)
[0m13:37:33.025116 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.no_uprn_match
[0m13:37:33.025368 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.uprn_match
[0m13:37:33.027504 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.no_uprn_match"
[0m13:37:33.029420 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.uprn_match"
[0m13:37:33.030032 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.no_uprn_match (compile): 13:37:33.025530 => 13:37:33.029885
[0m13:37:33.030279 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.uprn_match (compile): 13:37:33.027734 => 13:37:33.030155
[0m13:37:33.030502 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.no_uprn_match
[0m13:37:33.030706 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.uprn_match
[0m13:37:33.032832 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.no_uprn_match"
[0m13:37:33.034654 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.uprn_match"
[0m13:37:33.036029 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.no_uprn_match"
[0m13:37:33.036549 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.uprn_match"
[0m13:37:33.036776 [debug] [Thread-2 (]: On model.rightmove_epc.no_uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.no_uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.no_uprn_match
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn 
    where UPRN IS NOT NULL
),

epc_uprn as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
    where datasource = 'EPC'
)


SELECT rm_latest.*,
CASE WHEN epc_uprn.UPRN is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_uprn.UPRN AS EPC_UPRN,
epc_uprn.ADDRESSID AS EPC_ADDRESSID


FROM rm_latest
LEFT JOIN epc_uprn
ON rm_latest.UPRN = epc_uprn.UPRN

WHERE MATCH_EPC = 'NO'
  );
[0m13:37:33.037020 [debug] [Thread-3 (]: On model.rightmove_epc.uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
  
   as (
    with rm_latest as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn
    where UPRN IS NOT NULL
),

epc_uprn as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
    where datasource = 'EPC'
)


SELECT rm_latest.*,
CASE WHEN epc_uprn.UPRN is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_uprn.UPRN AS EPC_UPRN,
epc_uprn.ADDRESSID AS EPC_ADDRESSID


FROM rm_latest
LEFT JOIN epc_uprn
ON rm_latest.UPRN = epc_uprn.UPRN

WHERE MATCH_EPC = 'YES'
  );
[0m13:37:33.037233 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m13:37:33.037410 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m13:37:33.048421 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cf2fd68a-bd13-4342-8548-d70b4180b4b6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1141d0590>]}
[0m13:37:33.048835 [info ] [Thread-1 (]: 6 of 15 OK created sql view model dbt_melissa_rm_epc.latest_epc_urn ............ [[32mSUCCESS 1[0m in 0.69s]
[0m13:37:33.049153 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.latest_epc_urn
[0m13:37:33.511726 [debug] [Thread-2 (]: Snowflake adapter: Snowflake query id: 01b344d1-0103-9bad-0000-719506377952
[0m13:37:33.512290 [debug] [Thread-2 (]: Snowflake adapter: Snowflake error: 002003 (42S02): SQL compilation error:
Object 'ANALYTICS_DEV.DBT_MELISSA_RM_EPC.RM_LATEST' does not exist or not authorized.
[0m13:37:33.512913 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.no_uprn_match (execute): 13:37:33.030833 => 13:37:33.512683
[0m13:37:33.513322 [debug] [Thread-2 (]: On model.rightmove_epc.no_uprn_match: Close
[0m13:37:33.591989 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:37:33.595458 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.address_match (execute): 13:37:33.015320 => 13:37:33.595229
[0m13:37:33.595971 [debug] [Thread-4 (]: On model.rightmove_epc.address_match: Close
[0m13:37:33.603231 [debug] [Thread-2 (]: Database Error in model no_uprn_match (models/matching/no_uprn_match.sql)
  002003 (42S02): SQL compilation error:
  Object 'ANALYTICS_DEV.DBT_MELISSA_RM_EPC.RM_LATEST' does not exist or not authorized.
  compiled Code at target/run/rightmove_epc/models/matching/no_uprn_match.sql
[0m13:37:33.603731 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cf2fd68a-bd13-4342-8548-d70b4180b4b6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1140da710>]}
[0m13:37:33.604218 [error] [Thread-2 (]: 8 of 15 ERROR creating sql view model dbt_melissa_rm_epc.no_uprn_match ......... [[31mERROR[0m in 0.58s]
[0m13:37:33.604700 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.no_uprn_match
[0m13:37:33.605206 [debug] [Thread-1 (]: Began running node model.rightmove_epc.uprn_address_match
[0m13:37:33.605540 [info ] [Thread-1 (]: 10 of 15 SKIP relation dbt_melissa_rm_epc.uprn_address_match ................... [[33mSKIP[0m]
[0m13:37:33.605925 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.uprn_address_match
[0m13:37:33.632507 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:37:33.634347 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.uprn_match (execute): 13:37:33.033009 => 13:37:33.634214
[0m13:37:33.634604 [debug] [Thread-3 (]: On model.rightmove_epc.uprn_match: Close
[0m13:37:33.680567 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cf2fd68a-bd13-4342-8548-d70b4180b4b6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11428c650>]}
[0m13:37:33.681094 [info ] [Thread-4 (]: 7 of 15 OK created sql view model dbt_melissa_rm_epc.address_match ............. [[32mSUCCESS 1[0m in 0.67s]
[0m13:37:33.681556 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.address_match
[0m13:37:33.713310 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cf2fd68a-bd13-4342-8548-d70b4180b4b6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1144cd190>]}
[0m13:37:33.713897 [info ] [Thread-3 (]: 9 of 15 OK created sql view model dbt_melissa_rm_epc.uprn_match ................ [[32mSUCCESS 1[0m in 0.69s]
[0m13:37:33.714348 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.uprn_match
[0m13:37:33.715012 [debug] [Thread-2 (]: Began running node model.rightmove_epc.flats_report
[0m13:37:33.715349 [debug] [Thread-1 (]: Began running node model.rightmove_epc.houses_report
[0m13:37:33.715657 [debug] [Thread-4 (]: Began running node model.rightmove_epc.rm_all_matches
[0m13:37:33.715929 [info ] [Thread-2 (]: 11 of 15 START sql view model dbt_melissa_rm_epc.flats_report .................. [RUN]
[0m13:37:33.716207 [debug] [Thread-3 (]: Began running node model.rightmove_epc.rm_no_matches
[0m13:37:33.716526 [info ] [Thread-1 (]: 12 of 15 START sql view model dbt_melissa_rm_epc.houses_report ................. [RUN]
[0m13:37:33.716839 [info ] [Thread-4 (]: 13 of 15 SKIP relation dbt_melissa_rm_epc.rm_all_matches ....................... [[33mSKIP[0m]
[0m13:37:33.717340 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.no_uprn_match, now model.rightmove_epc.flats_report)
[0m13:37:33.717627 [info ] [Thread-3 (]: 14 of 15 SKIP relation dbt_melissa_rm_epc.rm_no_matches ........................ [[33mSKIP[0m]
[0m13:37:33.718077 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.latest_epc_urn, now model.rightmove_epc.houses_report)
[0m13:37:33.718354 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.rm_all_matches
[0m13:37:33.718594 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.flats_report
[0m13:37:33.718851 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.rm_no_matches
[0m13:37:33.719078 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.houses_report
[0m13:37:33.724327 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.flats_report"
[0m13:37:33.726712 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.houses_report"
[0m13:37:33.728864 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.houses_report (compile): 13:37:33.724531 => 13:37:33.728710
[0m13:37:33.729244 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.houses_report
[0m13:37:33.729608 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.flats_report (compile): 13:37:33.719301 => 13:37:33.729433
[0m13:37:33.731949 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.houses_report"
[0m13:37:33.732219 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.flats_report
[0m13:37:33.734490 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.flats_report"
[0m13:37:33.736154 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.houses_report"
[0m13:37:33.736557 [debug] [Thread-1 (]: On model.rightmove_epc.houses_report: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.houses_report"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.houses_report
  
   as (
    with house_addmatch as (

    select 
    distinct
    --count(LISTING_ID) as TOTAL_LISTINGS,
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN, -- NULL
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
 --   am.FLOOR_LEVEL as RM_FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    COUNTY,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    epc.ADDRESSID AS EPC_ADDRESSID,
    -- REMOVE_FROM_RM_MATCH,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

     from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc on am.EPC_ADDRESSID = epc.ADDRESSID
    and am.FULL_POSTCODE = epc.POSTCODE
    where MATCH_EPC = 'YES'
    and COMBINED_PROPERTY_TYPE not in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')

),

house_uprnmatch as (

    select 
    distinct
    --count(LISTING_ID) as TOTAL_LISTINGS,
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN, -- NULL
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
  --  am.FLOOR_LEVEL as RM_FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    COUNTY,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    epc.ADDRESSID AS EPC_ADDRESSID,
    -- REMOVE_FROM_RM_MATCH,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

    

    from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn epc on am.EPC_UPRN = epc.UPRN

    where MATCH_EPC = 'YES'
    and COMBINED_PROPERTY_TYPE not in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')
  -- AND RM_UPRN = 100030719363

)


select 'UPRN' as MATCH_TYPE, * from house_uprnmatch

union all

select 'ADDRESSID' as MATCH_TYPE, * from house_addmatch

/*
--THIS IS USED FOR A TEST
select RM_UPRN,COUNT(BUILDING_REFERENCE_NUMBER)
from house_uprnmatch
WHERE RM_UPRN IS NOT NULL
GROUP BY 1
HAVING COUNT(BUILDING_REFERENCE_NUMBER) >1
*/
  );
[0m13:37:33.738014 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.flats_report"
[0m13:37:33.738233 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:37:33.738551 [debug] [Thread-2 (]: On model.rightmove_epc.flats_report: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.flats_report"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.flats_report
  
   as (
    with house_addmatch as (

    select 
    distinct
    --count(LISTING_ID) as TOTAL_LISTINGS,
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN, -- NULL
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
 --   am.FLOOR_LEVEL as RM_FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    COUNTY,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    epc.ADDRESSID AS EPC_ADDRESSID,
    -- REMOVE_FROM_RM_MATCH,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

     from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc on am.EPC_ADDRESSID = epc.ADDRESSID
    and am.FULL_POSTCODE = epc.POSTCODE
    where MATCH_EPC = 'YES'
    and COMBINED_PROPERTY_TYPE in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')

),

house_uprnmatch as (

    select 
    distinct
    --count(LISTING_ID) as TOTAL_LISTINGS,
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN, -- NULL
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
  --  am.FLOOR_LEVEL as RM_FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    COUNTY,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    epc.ADDRESSID AS EPC_ADDRESSID,
    -- REMOVE_FROM_RM_MATCH,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

    

    from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn epc on am.EPC_UPRN = epc.UPRN

    where MATCH_EPC = 'YES'
   and COMBINED_PROPERTY_TYPE in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')
  -- AND RM_UPRN = 100030719363

)


select 'UPRN' as MATCH_TYPE, * from house_uprnmatch

union all

select 'ADDRESSID' as MATCH_TYPE, * from house_addmatch

/*
--THIS IS USED FOR A TEST
select RM_UPRN,COUNT(BUILDING_REFERENCE_NUMBER)
from house_uprnmatch
WHERE RM_UPRN IS NOT NULL
GROUP BY 1
HAVING COUNT(BUILDING_REFERENCE_NUMBER) >1
*/
  );
[0m13:37:33.739255 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m13:37:34.391553 [debug] [Thread-2 (]: Snowflake adapter: Snowflake query id: 01b344d1-0103-9bad-0000-719506377956
[0m13:37:34.391905 [debug] [Thread-2 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 30 at position 4
invalid identifier 'COUNTY'
[0m13:37:34.392255 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.flats_report (execute): 13:37:33.732463 => 13:37:34.392128
[0m13:37:34.392473 [debug] [Thread-2 (]: On model.rightmove_epc.flats_report: Close
[0m13:37:34.392775 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b344d1-0103-9b9a-0000-7195063769ae
[0m13:37:34.393542 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 30 at position 4
invalid identifier 'COUNTY'
[0m13:37:34.393822 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.houses_report (execute): 13:37:33.729801 => 13:37:34.393721
[0m13:37:34.394005 [debug] [Thread-1 (]: On model.rightmove_epc.houses_report: Close
[0m13:37:34.471597 [debug] [Thread-2 (]: Database Error in model flats_report (models/reports/flats_report.sql)
  000904 (42000): SQL compilation error: error line 30 at position 4
  invalid identifier 'COUNTY'
  compiled Code at target/run/rightmove_epc/models/reports/flats_report.sql
[0m13:37:34.471958 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cf2fd68a-bd13-4342-8548-d70b4180b4b6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114435d90>]}
[0m13:37:34.472294 [error] [Thread-2 (]: 11 of 15 ERROR creating sql view model dbt_melissa_rm_epc.flats_report ......... [[31mERROR[0m in 0.75s]
[0m13:37:34.472602 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.flats_report
[0m13:37:34.476106 [debug] [Thread-1 (]: Database Error in model houses_report (models/reports/houses_report.sql)
  000904 (42000): SQL compilation error: error line 30 at position 4
  invalid identifier 'COUNTY'
  compiled Code at target/run/rightmove_epc/models/reports/houses_report.sql
[0m13:37:34.476352 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cf2fd68a-bd13-4342-8548-d70b4180b4b6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114353890>]}
[0m13:37:34.476627 [error] [Thread-1 (]: 12 of 15 ERROR creating sql view model dbt_melissa_rm_epc.houses_report ........ [[31mERROR[0m in 0.76s]
[0m13:37:34.476914 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.houses_report
[0m13:37:34.477308 [debug] [Thread-4 (]: Began running node model.rightmove_epc.zero_bedrooms
[0m13:37:34.477564 [info ] [Thread-4 (]: 15 of 15 SKIP relation dbt_melissa_rm_epc.zero_bedrooms ........................ [[33mSKIP[0m]
[0m13:37:34.477865 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.zero_bedrooms
[0m13:37:34.478987 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:37:34.479220 [debug] [MainThread]: Connection 'model.rightmove_epc.houses_report' was properly closed.
[0m13:37:34.479373 [debug] [MainThread]: Connection 'model.rightmove_epc.flats_report' was properly closed.
[0m13:37:34.479516 [debug] [MainThread]: Connection 'model.rightmove_epc.address_match' was properly closed.
[0m13:37:34.479654 [debug] [MainThread]: Connection 'model.rightmove_epc.uprn_match' was properly closed.
[0m13:37:34.479904 [info ] [MainThread]: 
[0m13:37:34.480091 [info ] [MainThread]: Finished running 15 view models in 0 hours 0 minutes and 3.94 seconds (3.94s).
[0m13:37:34.481062 [debug] [MainThread]: Command end result
[0m13:37:34.488740 [info ] [MainThread]: 
[0m13:37:34.489011 [info ] [MainThread]: [31mCompleted with 3 errors and 0 warnings:[0m
[0m13:37:34.489174 [info ] [MainThread]: 
[0m13:37:34.489338 [error] [MainThread]:   Database Error in model no_uprn_match (models/matching/no_uprn_match.sql)
  002003 (42S02): SQL compilation error:
  Object 'ANALYTICS_DEV.DBT_MELISSA_RM_EPC.RM_LATEST' does not exist or not authorized.
  compiled Code at target/run/rightmove_epc/models/matching/no_uprn_match.sql
[0m13:37:34.489509 [info ] [MainThread]: 
[0m13:37:34.489661 [error] [MainThread]:   Database Error in model flats_report (models/reports/flats_report.sql)
  000904 (42000): SQL compilation error: error line 30 at position 4
  invalid identifier 'COUNTY'
  compiled Code at target/run/rightmove_epc/models/reports/flats_report.sql
[0m13:37:34.489817 [info ] [MainThread]: 
[0m13:37:34.489970 [error] [MainThread]:   Database Error in model houses_report (models/reports/houses_report.sql)
  000904 (42000): SQL compilation error: error line 30 at position 4
  invalid identifier 'COUNTY'
  compiled Code at target/run/rightmove_epc/models/reports/houses_report.sql
[0m13:37:34.490136 [info ] [MainThread]: 
[0m13:37:34.490299 [info ] [MainThread]: Done. PASS=8 WARN=0 ERROR=3 SKIP=4 TOTAL=15
[0m13:37:34.492073 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 4.285454, "process_user_time": 1.705429, "process_kernel_time": 0.229222, "process_mem_max_rss": "140410880", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m13:37:34.492470 [debug] [MainThread]: Command `dbt run` failed at 13:37:34.492395 after 4.29 seconds
[0m13:37:34.492711 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111e5cd50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111e5ef50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f0a190>]}
[0m13:37:34.492930 [debug] [MainThread]: Flushing usage events
[0m13:37:45.673143 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107019a50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107060850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107063110>]}


============================== 13:37:45.675944 | c2b022a9-91b4-4e09-af72-bf1e2a790f5b ==============================
[0m13:37:45.675944 [info ] [MainThread]: Running with dbt=1.7.10
[0m13:37:45.676316 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'version_check': 'True', 'profiles_dir': '/Users/melissabee/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m13:37:45.865482 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c2b022a9-91b4-4e09-af72-bf1e2a790f5b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107037490>]}
[0m13:37:45.905389 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c2b022a9-91b4-4e09-af72-bf1e2a790f5b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107037490>]}
[0m13:37:45.906968 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m13:37:45.916558 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m13:37:45.938708 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m13:37:45.939017 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m13:37:45.943008 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c2b022a9-91b4-4e09-af72-bf1e2a790f5b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11281c3d0>]}
[0m13:37:45.950633 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c2b022a9-91b4-4e09-af72-bf1e2a790f5b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110573a50>]}
[0m13:37:45.950946 [info ] [MainThread]: Found 15 models, 1 analysis, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m13:37:45.951176 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c2b022a9-91b4-4e09-af72-bf1e2a790f5b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11283aa50>]}
[0m13:37:45.952441 [info ] [MainThread]: 
[0m13:37:45.952883 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m13:37:45.953725 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m13:37:45.960978 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m13:37:45.961217 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m13:37:45.961392 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:37:46.390481 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 0.0 seconds
[0m13:37:46.393464 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m13:37:46.498369 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m13:37:46.505869 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m13:37:46.506188 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m13:37:46.506452 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:37:46.915263 [debug] [ThreadPool]: SQL status: SUCCESS 16 in 0.0 seconds
[0m13:37:46.917195 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m13:37:47.020034 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c2b022a9-91b4-4e09-af72-bf1e2a790f5b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112922990>]}
[0m13:37:47.020918 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m13:37:47.021267 [info ] [MainThread]: 
[0m13:37:47.024432 [debug] [Thread-1 (]: Began running node model.rightmove_epc.stg_epc_certs
[0m13:37:47.024795 [debug] [Thread-2 (]: Began running node model.rightmove_epc.stg_rightmove
[0m13:37:47.025237 [info ] [Thread-1 (]: 1 of 15 START sql view model dbt_melissa_rm_epc.stg_epc_certs .................. [RUN]
[0m13:37:47.025656 [info ] [Thread-2 (]: 2 of 15 START sql view model dbt_melissa_rm_epc.stg_rightmove .................. [RUN]
[0m13:37:47.026299 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.stg_epc_certs)
[0m13:37:47.026919 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.stg_rightmove'
[0m13:37:47.027239 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.stg_epc_certs
[0m13:37:47.027696 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.stg_rightmove
[0m13:37:47.034135 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.stg_epc_certs"
[0m13:37:47.037174 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.stg_rightmove"
[0m13:37:47.038005 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (compile): 13:37:47.027979 => 13:37:47.037722
[0m13:37:47.038398 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (compile): 13:37:47.034360 => 13:37:47.038210
[0m13:37:47.038672 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.stg_epc_certs
[0m13:37:47.038935 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.stg_rightmove
[0m13:37:47.091561 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.stg_epc_certs"
[0m13:37:47.093528 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.stg_rightmove"
[0m13:37:47.094574 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.stg_epc_certs"
[0m13:37:47.095146 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.stg_rightmove"
[0m13:37:47.095367 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_epc_certs"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
  
   as (
    WITH epc_certs as (
    
    select 
    UPRN,
    LODGEMENT_DATE,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
   -- COUNTY,
    LOCAL_AUTHORITY as LOCAL_AUTHORITY_CODE,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    UPPER(CASE WHEN (UPPER(ADDRESS1) LIKE 'FLAT%' OR UPPER(ADDRESS1) LIKE 'UNIT%') or UPPER(ADDRESS1) LIKE 'ROOM%' 
    THEN TRIM(REPLACE(REPLACE(CONCAT(ADDRESS),','),' '))
    ELSE trim(replace(replace(ADDRESS1,' '),',')) END) AS ADDRESSID,
    CASE WHEN UPRN is null and addressid is null THEN 1 else 0 end as REMOVE_FROM_RM_MATCH,
    FLOOR_LEVEL,
    FLAT_TOP_STOREY,
    FLAT_STOREY_COUNT,
    PROPERTY_TYPE
 from  RAW.EPC_TEST_DATA.EPC_CERTIFICATES 

)

SELECT * FROM epc_certs
  );
[0m13:37:47.095631 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_rightmove"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
  
   as (
    with rm as (

    SELECT 
    LISTING_ID,
    CHANGE_DATE,
    UPPER(TRIM(replace(REPLACE(CONCAT(ADDRESS_1::VARCHAR,ADDRESS_2::VARCHAR),' '),','))) AS ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, 
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    BEDROOM,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
 --   STUDENTLET_FLAG,
    COMBINED_PROPERTY_TYPE
    -- property type
    FROM 
       ANALYTICS.RIGHTMOVE_PROD.CLEAN_RAW_RIGHTMOVE_DATA 

 
)

SELECT * FROM rm
  );
[0m13:37:47.095843 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:37:47.096018 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m13:37:47.604527 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:37:47.605428 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:37:47.624904 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (execute): 13:37:47.091756 => 13:37:47.624710
[0m13:37:47.626872 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (execute): 13:37:47.039101 => 13:37:47.626723
[0m13:37:47.627187 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: Close
[0m13:37:47.627455 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: Close
[0m13:37:47.725708 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c2b022a9-91b4-4e09-af72-bf1e2a790f5b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1105cc0d0>]}
[0m13:37:47.726298 [info ] [Thread-2 (]: 2 of 15 OK created sql view model dbt_melissa_rm_epc.stg_rightmove ............. [[32mSUCCESS 1[0m in 0.70s]
[0m13:37:47.726854 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c2b022a9-91b4-4e09-af72-bf1e2a790f5b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11280bf90>]}
[0m13:37:47.727253 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.stg_rightmove
[0m13:37:47.727621 [info ] [Thread-1 (]: 1 of 15 OK created sql view model dbt_melissa_rm_epc.stg_epc_certs ............. [[32mSUCCESS 1[0m in 0.70s]
[0m13:37:47.728068 [debug] [Thread-4 (]: Began running node model.rightmove_epc.latest_rm_urn
[0m13:37:47.728382 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.stg_epc_certs
[0m13:37:47.728637 [info ] [Thread-4 (]: 3 of 15 START sql view model dbt_melissa_rm_epc.latest_rm_urn .................. [RUN]
[0m13:37:47.729164 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.rightmove_epc.latest_rm_urn'
[0m13:37:47.729431 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.latest_rm_urn
[0m13:37:47.731251 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.latest_rm_urn"
[0m13:37:47.731830 [debug] [Thread-2 (]: Began running node model.rightmove_epc.dim_addressid
[0m13:37:47.732108 [debug] [Thread-3 (]: Began running node model.rightmove_epc.dim_uprn
[0m13:37:47.732387 [debug] [Thread-1 (]: Began running node model.rightmove_epc.latest_epc_urn
[0m13:37:47.732713 [info ] [Thread-2 (]: 4 of 15 START sql view model dbt_melissa_rm_epc.dim_addressid .................. [RUN]
[0m13:37:47.733052 [info ] [Thread-3 (]: 5 of 15 START sql view model dbt_melissa_rm_epc.dim_uprn ....................... [RUN]
[0m13:37:47.733318 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.latest_rm_urn (compile): 13:37:47.729595 => 13:37:47.733196
[0m13:37:47.733574 [info ] [Thread-1 (]: 6 of 15 START sql view model dbt_melissa_rm_epc.latest_epc_urn ................. [RUN]
[0m13:37:47.733996 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_rightmove, now model.rightmove_epc.dim_addressid)
[0m13:37:47.734401 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_uprn'
[0m13:37:47.734616 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.latest_rm_urn
[0m13:37:47.734961 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_epc_certs, now model.rightmove_epc.latest_epc_urn)
[0m13:37:47.735271 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.dim_addressid
[0m13:37:47.735639 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.dim_uprn
[0m13:37:47.737886 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.latest_rm_urn"
[0m13:37:47.738154 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.latest_epc_urn
[0m13:37:47.740252 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.dim_addressid"
[0m13:37:47.742127 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.dim_uprn"
[0m13:37:47.744106 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.latest_epc_urn"
[0m13:37:47.744878 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.latest_rm_urn"
[0m13:37:47.745313 [debug] [Thread-4 (]: On model.rightmove_epc.latest_rm_urn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.latest_rm_urn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NOT NULL
),

change_date AS (
    SELECT 
        UPRN AS UPRN_CD, 
        MAX(CHANGE_DATE) AS MAX_CHANGE_DATE 
    FROM rm
    GROUP BY UPRN
),

rm_latest as (

    SELECT distinct * FROM rm
    LEFT JOIN change_date cd
    ON rm.UPRN = cd.UPRN_CD
    WHERE cd.MAX_CHANGE_DATE = rm.CHANGE_DATE 
 --  and UPRN = 100090588560
    
)

select DISTINCT * from rm_latest

/*
select uprn, count(*) from rm_latest
group by 1
having count(*) >1
*/
  );
[0m13:37:47.745745 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.dim_addressid (compile): 13:37:47.738311 => 13:37:47.745599
[0m13:37:47.745967 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.latest_epc_urn (compile): 13:37:47.742426 => 13:37:47.745858
[0m13:37:47.746179 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.dim_uprn (compile): 13:37:47.740477 => 13:37:47.746074
[0m13:37:47.746346 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m13:37:47.746571 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.dim_addressid
[0m13:37:47.746878 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.latest_epc_urn
[0m13:37:47.747084 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.dim_uprn
[0m13:37:47.749645 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.dim_addressid"
[0m13:37:47.752348 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.latest_epc_urn"
[0m13:37:47.754478 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.dim_uprn"
[0m13:37:47.755789 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.latest_epc_urn"
[0m13:37:47.756402 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.dim_uprn"
[0m13:37:47.756988 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.dim_addressid"
[0m13:37:47.757248 [debug] [Thread-1 (]: On model.rightmove_epc.latest_epc_urn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.latest_epc_urn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn
  
   as (
    with epc_max_date as (

    select uprn as UPRN_EPC,
    MAX(LODGEMENT_DATE) AS MAX_LODGEMENT_DATE,
    from  ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    group by 1


),

latest_epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc
    inner join epc_max_date on epc.uprn = epc_max_date.UPRN_EPC
    where MAX_LODGEMENT_DATE = LODGEMENT_DATE
   -- and uprn = 200073066

)

select DISTINCT * from latest_epc

/*
select uprn, count(*) from latest_epc
group by 1
having count(*) >1
*/
  );
[0m13:37:47.757514 [debug] [Thread-3 (]: On model.rightmove_epc.dim_uprn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_uprn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE UPRNS


with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource,
    POSTCODE
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    where REMOVE_FROM_RM_MATCH = 0
    AND UPRN IS NOT NULL
),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    WHERE UPRN IS NOT NULL

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where uprn is not null
  );
[0m13:37:47.757794 [debug] [Thread-2 (]: On model.rightmove_epc.dim_addressid: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_addressid"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE ADDRESS'

with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource,
    POSTCODE

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    where REMOVE_FROM_RM_MATCH = 0
    AND ADDRESSID IS NOT NULL

),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    WHERE ADDRESSID IS NOT NULL

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where addressid is not null
  );
[0m13:37:47.758032 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:37:47.758218 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m13:37:47.758421 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m13:37:48.223186 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m13:37:48.226450 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.latest_rm_urn (execute): 13:37:47.735821 => 13:37:48.226213
[0m13:37:48.226930 [debug] [Thread-4 (]: On model.rightmove_epc.latest_rm_urn: Close
[0m13:37:48.233687 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m13:37:48.236164 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.latest_epc_urn (execute): 13:37:47.749878 => 13:37:48.235985
[0m13:37:48.236510 [debug] [Thread-1 (]: On model.rightmove_epc.latest_epc_urn: Close
[0m13:37:48.261114 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:37:48.263522 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.dim_uprn (execute): 13:37:47.752564 => 13:37:48.263330
[0m13:37:48.263883 [debug] [Thread-3 (]: On model.rightmove_epc.dim_uprn: Close
[0m13:37:48.309302 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:37:48.312786 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.dim_addressid (execute): 13:37:47.747854 => 13:37:48.312562
[0m13:37:48.313877 [debug] [Thread-2 (]: On model.rightmove_epc.dim_addressid: Close
[0m13:37:48.326073 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c2b022a9-91b4-4e09-af72-bf1e2a790f5b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1129bdcd0>]}
[0m13:37:48.326666 [info ] [Thread-4 (]: 3 of 15 OK created sql view model dbt_melissa_rm_epc.latest_rm_urn ............. [[32mSUCCESS 1[0m in 0.60s]
[0m13:37:48.327160 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.latest_rm_urn
[0m13:37:48.330495 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c2b022a9-91b4-4e09-af72-bf1e2a790f5b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11285f750>]}
[0m13:37:48.330963 [info ] [Thread-1 (]: 6 of 15 OK created sql view model dbt_melissa_rm_epc.latest_epc_urn ............ [[32mSUCCESS 1[0m in 0.60s]
[0m13:37:48.331355 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.latest_epc_urn
[0m13:37:48.362755 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c2b022a9-91b4-4e09-af72-bf1e2a790f5b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1128b0d90>]}
[0m13:37:48.363330 [info ] [Thread-3 (]: 5 of 15 OK created sql view model dbt_melissa_rm_epc.dim_uprn .................. [[32mSUCCESS 1[0m in 0.63s]
[0m13:37:48.363747 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.dim_uprn
[0m13:37:48.364208 [debug] [Thread-4 (]: Began running node model.rightmove_epc.no_uprn_match
[0m13:37:48.364528 [debug] [Thread-1 (]: Began running node model.rightmove_epc.uprn_match
[0m13:37:48.364912 [info ] [Thread-4 (]: 7 of 15 START sql view model dbt_melissa_rm_epc.no_uprn_match .................. [RUN]
[0m13:37:48.365303 [info ] [Thread-1 (]: 8 of 15 START sql view model dbt_melissa_rm_epc.uprn_match ..................... [RUN]
[0m13:37:48.365858 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.latest_rm_urn, now model.rightmove_epc.no_uprn_match)
[0m13:37:48.366332 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.latest_epc_urn, now model.rightmove_epc.uprn_match)
[0m13:37:48.366698 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.no_uprn_match
[0m13:37:48.367030 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.uprn_match
[0m13:37:48.369554 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.no_uprn_match"
[0m13:37:48.371520 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.uprn_match"
[0m13:37:48.372191 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.uprn_match (compile): 13:37:48.369800 => 13:37:48.372046
[0m13:37:48.372490 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.no_uprn_match (compile): 13:37:48.367197 => 13:37:48.372332
[0m13:37:48.372734 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.uprn_match
[0m13:37:48.372969 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.no_uprn_match
[0m13:37:48.375241 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.uprn_match"
[0m13:37:48.377127 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.no_uprn_match"
[0m13:37:48.377889 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.uprn_match"
[0m13:37:48.378466 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.no_uprn_match"
[0m13:37:48.378711 [debug] [Thread-1 (]: On model.rightmove_epc.uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
  
   as (
    with rm_latest as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn
    where UPRN IS NOT NULL
),

epc_uprn as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
    where datasource = 'EPC'
)


SELECT rm_latest.*,
CASE WHEN epc_uprn.UPRN is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_uprn.UPRN AS EPC_UPRN,
epc_uprn.ADDRESSID AS EPC_ADDRESSID


FROM rm_latest
LEFT JOIN epc_uprn
ON rm_latest.UPRN = epc_uprn.UPRN

WHERE MATCH_EPC = 'YES'
  );
[0m13:37:48.378993 [debug] [Thread-4 (]: On model.rightmove_epc.no_uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.no_uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.no_uprn_match
  
   as (
    with rm_latest as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn 
    where UPRN IS NOT NULL
),

epc_uprn as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
    where datasource = 'EPC'
)


SELECT rm_latest.*,
CASE WHEN epc_uprn.UPRN is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_uprn.UPRN AS EPC_UPRN,
epc_uprn.ADDRESSID AS EPC_ADDRESSID


FROM rm_latest
LEFT JOIN epc_uprn
ON rm_latest.UPRN = epc_uprn.UPRN

WHERE MATCH_EPC = 'NO'
  );
[0m13:37:48.379234 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:37:48.379452 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m13:37:48.412156 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c2b022a9-91b4-4e09-af72-bf1e2a790f5b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1128b1850>]}
[0m13:37:48.412674 [info ] [Thread-2 (]: 4 of 15 OK created sql view model dbt_melissa_rm_epc.dim_addressid ............. [[32mSUCCESS 1[0m in 0.68s]
[0m13:37:48.413082 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.dim_addressid
[0m13:37:48.413455 [debug] [Thread-3 (]: Began running node model.rightmove_epc.address_match
[0m13:37:48.413744 [info ] [Thread-3 (]: 9 of 15 START sql view model dbt_melissa_rm_epc.address_match .................. [RUN]
[0m13:37:48.414140 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.dim_uprn, now model.rightmove_epc.address_match)
[0m13:37:48.414339 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.address_match
[0m13:37:48.416254 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.address_match"
[0m13:37:48.416702 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.address_match (compile): 13:37:48.414457 => 13:37:48.416593
[0m13:37:48.416892 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.address_match
[0m13:37:48.418648 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.address_match"
[0m13:37:48.419354 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.address_match"
[0m13:37:48.419587 [debug] [Thread-3 (]: On model.rightmove_epc.address_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.address_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NULL

),

epc_address as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
    where datasource = 'EPC'
)


SELECT rm.*,
CASE WHEN epc_address.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_address.ADDRESSID AS EPC_ADDRESSID,
epc_address.UPRN AS EPC_UPRN


FROM rm
LEFT JOIN epc_address
ON rm.addressid = epc_address.addressid
and rm.FULL_POSTCODE = epc_address.POSTCODE
  );
[0m13:37:48.419798 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m13:37:48.924382 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:37:48.928240 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.no_uprn_match (execute): 13:37:48.375403 => 13:37:48.927951
[0m13:37:48.928779 [debug] [Thread-4 (]: On model.rightmove_epc.no_uprn_match: Close
[0m13:37:48.951044 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:37:48.954114 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.address_match (execute): 13:37:48.417001 => 13:37:48.953873
[0m13:37:48.954579 [debug] [Thread-3 (]: On model.rightmove_epc.address_match: Close
[0m13:37:48.966640 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:37:48.968986 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.uprn_match (execute): 13:37:48.373108 => 13:37:48.968815
[0m13:37:48.969315 [debug] [Thread-1 (]: On model.rightmove_epc.uprn_match: Close
[0m13:37:49.037022 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c2b022a9-91b4-4e09-af72-bf1e2a790f5b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112a127d0>]}
[0m13:37:49.037755 [info ] [Thread-3 (]: 9 of 15 OK created sql view model dbt_melissa_rm_epc.address_match ............. [[32mSUCCESS 1[0m in 0.62s]
[0m13:37:49.038387 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.address_match
[0m13:37:49.049789 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c2b022a9-91b4-4e09-af72-bf1e2a790f5b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11034c210>]}
[0m13:37:49.050692 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c2b022a9-91b4-4e09-af72-bf1e2a790f5b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112aedf10>]}
[0m13:37:49.051445 [info ] [Thread-4 (]: 7 of 15 OK created sql view model dbt_melissa_rm_epc.no_uprn_match ............. [[32mSUCCESS 1[0m in 0.68s]
[0m13:37:49.052094 [info ] [Thread-1 (]: 8 of 15 OK created sql view model dbt_melissa_rm_epc.uprn_match ................ [[32mSUCCESS 1[0m in 0.68s]
[0m13:37:49.052703 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.no_uprn_match
[0m13:37:49.053198 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.uprn_match
[0m13:37:49.053830 [debug] [Thread-2 (]: Began running node model.rightmove_epc.uprn_address_match
[0m13:37:49.054473 [debug] [Thread-4 (]: Began running node model.rightmove_epc.flats_report
[0m13:37:49.054901 [debug] [Thread-3 (]: Began running node model.rightmove_epc.houses_report
[0m13:37:49.055273 [info ] [Thread-2 (]: 10 of 15 START sql view model dbt_melissa_rm_epc.uprn_address_match ............ [RUN]
[0m13:37:49.055685 [info ] [Thread-4 (]: 11 of 15 START sql view model dbt_melissa_rm_epc.flats_report .................. [RUN]
[0m13:37:49.056061 [info ] [Thread-3 (]: 12 of 15 START sql view model dbt_melissa_rm_epc.houses_report ................. [RUN]
[0m13:37:49.056623 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.dim_addressid, now model.rightmove_epc.uprn_address_match)
[0m13:37:49.057268 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.no_uprn_match, now model.rightmove_epc.flats_report)
[0m13:37:49.057907 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.address_match, now model.rightmove_epc.houses_report)
[0m13:37:49.058263 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.uprn_address_match
[0m13:37:49.058657 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.flats_report
[0m13:37:49.059012 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.houses_report
[0m13:37:49.063688 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.flats_report"
[0m13:37:49.066700 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.houses_report"
[0m13:37:49.069329 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.uprn_address_match"
[0m13:37:49.070045 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.houses_report (compile): 13:37:49.063964 => 13:37:49.069891
[0m13:37:49.070335 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.flats_report (compile): 13:37:49.060999 => 13:37:49.070190
[0m13:37:49.070560 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.houses_report
[0m13:37:49.070786 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.flats_report
[0m13:37:49.073195 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.houses_report"
[0m13:37:49.075473 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.flats_report"
[0m13:37:49.075998 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.uprn_address_match (compile): 13:37:49.059239 => 13:37:49.075837
[0m13:37:49.076375 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.uprn_address_match
[0m13:37:49.078014 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.houses_report"
[0m13:37:49.079415 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.flats_report"
[0m13:37:49.081433 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.uprn_address_match"
[0m13:37:49.081806 [debug] [Thread-3 (]: On model.rightmove_epc.houses_report: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.houses_report"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.houses_report
  
   as (
    with house_addmatch as (

    select 
    distinct
    --count(LISTING_ID) as TOTAL_LISTINGS,
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN, -- NULL
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
 --   am.FLOOR_LEVEL as RM_FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    COUNTY,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    epc.ADDRESSID AS EPC_ADDRESSID,
    -- REMOVE_FROM_RM_MATCH,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

     from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc on am.EPC_ADDRESSID = epc.ADDRESSID
    and am.FULL_POSTCODE = epc.POSTCODE
    where MATCH_EPC = 'YES'
    and COMBINED_PROPERTY_TYPE not in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')

),

house_uprnmatch as (

    select 
    distinct
    --count(LISTING_ID) as TOTAL_LISTINGS,
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN, -- NULL
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
  --  am.FLOOR_LEVEL as RM_FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    COUNTY,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    epc.ADDRESSID AS EPC_ADDRESSID,
    -- REMOVE_FROM_RM_MATCH,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

    

    from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn epc on am.EPC_UPRN = epc.UPRN

    where MATCH_EPC = 'YES'
    and COMBINED_PROPERTY_TYPE not in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')
  -- AND RM_UPRN = 100030719363

)


select 'UPRN' as MATCH_TYPE, * from house_uprnmatch

union all

select 'ADDRESSID' as MATCH_TYPE, * from house_addmatch

/*
--THIS IS USED FOR A TEST
select RM_UPRN,COUNT(BUILDING_REFERENCE_NUMBER)
from house_uprnmatch
WHERE RM_UPRN IS NOT NULL
GROUP BY 1
HAVING COUNT(BUILDING_REFERENCE_NUMBER) >1
*/
  );
[0m13:37:49.082229 [debug] [Thread-4 (]: On model.rightmove_epc.flats_report: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.flats_report"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.flats_report
  
   as (
    with house_addmatch as (

    select 
    distinct
    --count(LISTING_ID) as TOTAL_LISTINGS,
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN, -- NULL
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
 --   am.FLOOR_LEVEL as RM_FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    COUNTY,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    epc.ADDRESSID AS EPC_ADDRESSID,
    -- REMOVE_FROM_RM_MATCH,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

     from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc on am.EPC_ADDRESSID = epc.ADDRESSID
    and am.FULL_POSTCODE = epc.POSTCODE
    where MATCH_EPC = 'YES'
    and COMBINED_PROPERTY_TYPE in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')

),

house_uprnmatch as (

    select 
    distinct
    --count(LISTING_ID) as TOTAL_LISTINGS,
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN, -- NULL
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
  --  am.FLOOR_LEVEL as RM_FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    COUNTY,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    epc.ADDRESSID AS EPC_ADDRESSID,
    -- REMOVE_FROM_RM_MATCH,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

    

    from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn epc on am.EPC_UPRN = epc.UPRN

    where MATCH_EPC = 'YES'
   and COMBINED_PROPERTY_TYPE in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')
  -- AND RM_UPRN = 100030719363

)


select 'UPRN' as MATCH_TYPE, * from house_uprnmatch

union all

select 'ADDRESSID' as MATCH_TYPE, * from house_addmatch

/*
--THIS IS USED FOR A TEST
select RM_UPRN,COUNT(BUILDING_REFERENCE_NUMBER)
from house_uprnmatch
WHERE RM_UPRN IS NOT NULL
GROUP BY 1
HAVING COUNT(BUILDING_REFERENCE_NUMBER) >1
*/
  );
[0m13:37:49.082640 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m13:37:49.082897 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m13:37:49.083593 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.uprn_address_match"
[0m13:37:49.084775 [debug] [Thread-2 (]: On model.rightmove_epc.uprn_address_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.uprn_address_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_address_match
  
   as (
    -- where uprn is not matched we try address.

with uprn as (

    select 
    up.LISTING_ID,
    CHANGE_DATE,
    up.ADDRESSID,
    up.ADDRESS_1,
    up.ADDRESS_2,
    FULL_POSTCODE,
    up.UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    BEDROOM,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    STUDENTLET_FLAG,
    COMBINED_PROPERTY_TYPE,
 -- need to sleect the same fields as address match
    CASE WHEN ad.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC,
    ad.ADDRESSID AS EPC_ADDRESSID,
    ad.UPRN AS EPC_UPRN

     from ANALYTICS_DEV.dbt_melissa_rm_epc.no_uprn_match up
    left join ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid ad on up.ADDRESSID = ad.ADDRESSID
    and up.FULL_POSTCODE = ad.POSTCODE
   
)

SELECT * FROM UPRN
  );
[0m13:37:49.085262 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m13:37:49.558095 [debug] [Thread-2 (]: Snowflake adapter: Snowflake query id: 01b344d1-0103-9bad-0000-719506377972
[0m13:37:49.558707 [debug] [Thread-2 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 24 at position 4
invalid identifier 'STUDENTLET_FLAG'
[0m13:37:49.559370 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.uprn_address_match (execute): 13:37:49.079562 => 13:37:49.559127
[0m13:37:49.559792 [debug] [Thread-2 (]: On model.rightmove_epc.uprn_address_match: Close
[0m13:37:49.597898 [debug] [Thread-3 (]: Snowflake adapter: Snowflake query id: 01b344d1-0103-9b8b-0000-71950637840a
[0m13:37:49.598347 [debug] [Thread-3 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 30 at position 4
invalid identifier 'COUNTY'
[0m13:37:49.598888 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.houses_report (execute): 13:37:49.070929 => 13:37:49.598692
[0m13:37:49.599247 [debug] [Thread-3 (]: On model.rightmove_epc.houses_report: Close
[0m13:37:49.607860 [debug] [Thread-4 (]: Snowflake adapter: Snowflake query id: 01b344d1-0103-9b8b-0000-719506378406
[0m13:37:49.608230 [debug] [Thread-4 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 30 at position 4
invalid identifier 'COUNTY'
[0m13:37:49.608723 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.flats_report (execute): 13:37:49.073427 => 13:37:49.608535
[0m13:37:49.609059 [debug] [Thread-4 (]: On model.rightmove_epc.flats_report: Close
[0m13:37:49.651649 [debug] [Thread-2 (]: Database Error in model uprn_address_match (models/matching/uprn_address_match.sql)
  000904 (42000): SQL compilation error: error line 24 at position 4
  invalid identifier 'STUDENTLET_FLAG'
  compiled Code at target/run/rightmove_epc/models/matching/uprn_address_match.sql
[0m13:37:49.652172 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c2b022a9-91b4-4e09-af72-bf1e2a790f5b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110531b50>]}
[0m13:37:49.652725 [error] [Thread-2 (]: 10 of 15 ERROR creating sql view model dbt_melissa_rm_epc.uprn_address_match ... [[31mERROR[0m in 0.60s]
[0m13:37:49.653312 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.uprn_address_match
[0m13:37:49.653885 [debug] [Thread-1 (]: Began running node model.rightmove_epc.rm_all_matches
[0m13:37:49.654203 [debug] [Thread-2 (]: Began running node model.rightmove_epc.rm_no_matches
[0m13:37:49.654526 [info ] [Thread-1 (]: 13 of 15 SKIP relation dbt_melissa_rm_epc.rm_all_matches ....................... [[33mSKIP[0m]
[0m13:37:49.654864 [info ] [Thread-2 (]: 14 of 15 SKIP relation dbt_melissa_rm_epc.rm_no_matches ........................ [[33mSKIP[0m]
[0m13:37:49.655190 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.rm_all_matches
[0m13:37:49.655485 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.rm_no_matches
[0m13:37:49.679608 [debug] [Thread-3 (]: Database Error in model houses_report (models/reports/houses_report.sql)
  000904 (42000): SQL compilation error: error line 30 at position 4
  invalid identifier 'COUNTY'
  compiled Code at target/run/rightmove_epc/models/reports/houses_report.sql
[0m13:37:49.680059 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c2b022a9-91b4-4e09-af72-bf1e2a790f5b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11289b5d0>]}
[0m13:37:49.680491 [error] [Thread-3 (]: 12 of 15 ERROR creating sql view model dbt_melissa_rm_epc.houses_report ........ [[31mERROR[0m in 0.62s]
[0m13:37:49.680902 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.houses_report
[0m13:37:49.695707 [debug] [Thread-4 (]: Database Error in model flats_report (models/reports/flats_report.sql)
  000904 (42000): SQL compilation error: error line 30 at position 4
  invalid identifier 'COUNTY'
  compiled Code at target/run/rightmove_epc/models/reports/flats_report.sql
[0m13:37:49.696116 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c2b022a9-91b4-4e09-af72-bf1e2a790f5b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11036b950>]}
[0m13:37:49.696504 [error] [Thread-4 (]: 11 of 15 ERROR creating sql view model dbt_melissa_rm_epc.flats_report ......... [[31mERROR[0m in 0.64s]
[0m13:37:49.696876 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.flats_report
[0m13:37:49.697412 [debug] [Thread-1 (]: Began running node model.rightmove_epc.zero_bedrooms
[0m13:37:49.697839 [info ] [Thread-1 (]: 15 of 15 SKIP relation dbt_melissa_rm_epc.zero_bedrooms ........................ [[33mSKIP[0m]
[0m13:37:49.698163 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.zero_bedrooms
[0m13:37:49.699352 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:37:49.699561 [debug] [MainThread]: Connection 'model.rightmove_epc.uprn_match' was properly closed.
[0m13:37:49.699736 [debug] [MainThread]: Connection 'model.rightmove_epc.uprn_address_match' was properly closed.
[0m13:37:49.699902 [debug] [MainThread]: Connection 'model.rightmove_epc.flats_report' was properly closed.
[0m13:37:49.700063 [debug] [MainThread]: Connection 'model.rightmove_epc.houses_report' was properly closed.
[0m13:37:49.700304 [info ] [MainThread]: 
[0m13:37:49.700510 [info ] [MainThread]: Finished running 15 view models in 0 hours 0 minutes and 3.75 seconds (3.75s).
[0m13:37:49.701554 [debug] [MainThread]: Command end result
[0m13:37:49.708611 [info ] [MainThread]: 
[0m13:37:49.708874 [info ] [MainThread]: [31mCompleted with 3 errors and 0 warnings:[0m
[0m13:37:49.709054 [info ] [MainThread]: 
[0m13:37:49.709235 [error] [MainThread]:   Database Error in model uprn_address_match (models/matching/uprn_address_match.sql)
  000904 (42000): SQL compilation error: error line 24 at position 4
  invalid identifier 'STUDENTLET_FLAG'
  compiled Code at target/run/rightmove_epc/models/matching/uprn_address_match.sql
[0m13:37:49.709410 [info ] [MainThread]: 
[0m13:37:49.709578 [error] [MainThread]:   Database Error in model houses_report (models/reports/houses_report.sql)
  000904 (42000): SQL compilation error: error line 30 at position 4
  invalid identifier 'COUNTY'
  compiled Code at target/run/rightmove_epc/models/reports/houses_report.sql
[0m13:37:49.709744 [info ] [MainThread]: 
[0m13:37:49.709906 [error] [MainThread]:   Database Error in model flats_report (models/reports/flats_report.sql)
  000904 (42000): SQL compilation error: error line 30 at position 4
  invalid identifier 'COUNTY'
  compiled Code at target/run/rightmove_epc/models/reports/flats_report.sql
[0m13:37:49.710086 [info ] [MainThread]: 
[0m13:37:49.710262 [info ] [MainThread]: Done. PASS=9 WARN=0 ERROR=3 SKIP=3 TOTAL=15
[0m13:37:49.712336 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 4.0730767, "process_user_time": 1.745713, "process_kernel_time": 0.199801, "process_mem_max_rss": "140656640", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m13:37:49.712653 [debug] [MainThread]: Command `dbt run` failed at 13:37:49.712586 after 4.07 seconds
[0m13:37:49.712891 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10277e110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107060750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102880f10>]}
[0m13:37:49.713107 [debug] [MainThread]: Flushing usage events
[0m13:38:34.441262 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107818a50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10785e610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10785f190>]}


============================== 13:38:34.444345 | 012045f0-619a-41a5-b503-11d4954a8d85 ==============================
[0m13:38:34.444345 [info ] [MainThread]: Running with dbt=1.7.10
[0m13:38:34.444722 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m13:38:34.646426 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '012045f0-619a-41a5-b503-11d4954a8d85', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11091af50>]}
[0m13:38:34.686452 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '012045f0-619a-41a5-b503-11d4954a8d85', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107837250>]}
[0m13:38:34.687082 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m13:38:34.697809 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m13:38:34.730662 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m13:38:34.730983 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m13:38:34.735017 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '012045f0-619a-41a5-b503-11d4954a8d85', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10648e5d0>]}
[0m13:38:34.743860 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '012045f0-619a-41a5-b503-11d4954a8d85', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1109bd310>]}
[0m13:38:34.744220 [info ] [MainThread]: Found 15 models, 1 analysis, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m13:38:34.744459 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '012045f0-619a-41a5-b503-11d4954a8d85', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1109eb110>]}
[0m13:38:34.745840 [info ] [MainThread]: 
[0m13:38:34.746327 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m13:38:34.747333 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m13:38:34.754640 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m13:38:34.754892 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m13:38:34.755076 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:38:35.188525 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 0.0 seconds
[0m13:38:35.190465 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m13:38:35.267431 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m13:38:35.273863 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m13:38:35.274160 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m13:38:35.274397 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:38:35.620847 [debug] [ThreadPool]: SQL status: SUCCESS 16 in 0.0 seconds
[0m13:38:35.623120 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m13:38:35.758567 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '012045f0-619a-41a5-b503-11d4954a8d85', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110809cd0>]}
[0m13:38:35.760309 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m13:38:35.760775 [info ] [MainThread]: 
[0m13:38:35.763802 [debug] [Thread-1 (]: Began running node model.rightmove_epc.stg_epc_certs
[0m13:38:35.764084 [debug] [Thread-2 (]: Began running node model.rightmove_epc.stg_rightmove
[0m13:38:35.764547 [info ] [Thread-1 (]: 1 of 15 START sql view model dbt_melissa_rm_epc.stg_epc_certs .................. [RUN]
[0m13:38:35.764905 [info ] [Thread-2 (]: 2 of 15 START sql view model dbt_melissa_rm_epc.stg_rightmove .................. [RUN]
[0m13:38:35.765817 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.stg_epc_certs)
[0m13:38:35.766632 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.stg_rightmove'
[0m13:38:35.767044 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.stg_epc_certs
[0m13:38:35.767399 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.stg_rightmove
[0m13:38:35.775514 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.stg_epc_certs"
[0m13:38:35.779159 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.stg_rightmove"
[0m13:38:35.780680 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (compile): 13:38:35.775787 => 13:38:35.780413
[0m13:38:35.781125 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (compile): 13:38:35.767670 => 13:38:35.780871
[0m13:38:35.781472 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.stg_rightmove
[0m13:38:35.781779 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.stg_epc_certs
[0m13:38:35.830779 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.stg_rightmove"
[0m13:38:35.832625 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.stg_epc_certs"
[0m13:38:35.833611 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.stg_rightmove"
[0m13:38:35.833865 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_rightmove"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
  
   as (
    with rm as (

    SELECT 
    LISTING_ID,
    CHANGE_DATE,
    UPPER(TRIM(replace(REPLACE(CONCAT(ADDRESS_1::VARCHAR,ADDRESS_2::VARCHAR),' '),','))) AS ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, 
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    BEDROOM,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
 --   STUDENTLET_FLAG,
    COMBINED_PROPERTY_TYPE
    -- property type
    FROM 
       ANALYTICS.RIGHTMOVE_PROD.CLEAN_RAW_RIGHTMOVE_DATA 

 
)

SELECT * FROM rm
  );
[0m13:38:35.834541 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.stg_epc_certs"
[0m13:38:35.834757 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m13:38:35.834990 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_epc_certs"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
  
   as (
    WITH epc_certs as (
    
    select 
    UPRN,
    LODGEMENT_DATE,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
   -- COUNTY,
    LOCAL_AUTHORITY as LOCAL_AUTHORITY_CODE,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    UPPER(CASE WHEN (UPPER(ADDRESS1) LIKE 'FLAT%' OR UPPER(ADDRESS1) LIKE 'UNIT%') or UPPER(ADDRESS1) LIKE 'ROOM%' 
    THEN TRIM(REPLACE(REPLACE(CONCAT(ADDRESS),','),' '))
    ELSE trim(replace(replace(ADDRESS1,' '),',')) END) AS ADDRESSID,
    CASE WHEN UPRN is null and addressid is null THEN 1 else 0 end as REMOVE_FROM_RM_MATCH,
    FLOOR_LEVEL,
    FLAT_TOP_STOREY,
    FLAT_STOREY_COUNT,
    PROPERTY_TYPE
 from  RAW.EPC_TEST_DATA.EPC_CERTIFICATES 

)

SELECT * FROM epc_certs
  );
[0m13:38:35.835584 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:38:36.306572 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m13:38:36.322585 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (execute): 13:38:35.830967 => 13:38:36.322437
[0m13:38:36.322877 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: Close
[0m13:38:36.331750 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m13:38:36.333493 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (execute): 13:38:35.782007 => 13:38:36.333355
[0m13:38:36.333752 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: Close
[0m13:38:36.417904 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '012045f0-619a-41a5-b503-11d4954a8d85', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110fe1910>]}
[0m13:38:36.418496 [info ] [Thread-2 (]: 2 of 15 OK created sql view model dbt_melissa_rm_epc.stg_rightmove ............. [[32mSUCCESS 1[0m in 0.65s]
[0m13:38:36.418929 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.stg_rightmove
[0m13:38:36.419375 [debug] [Thread-4 (]: Began running node model.rightmove_epc.latest_rm_urn
[0m13:38:36.419684 [info ] [Thread-4 (]: 3 of 15 START sql view model dbt_melissa_rm_epc.latest_rm_urn .................. [RUN]
[0m13:38:36.420240 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.rightmove_epc.latest_rm_urn'
[0m13:38:36.420489 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.latest_rm_urn
[0m13:38:36.422867 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.latest_rm_urn"
[0m13:38:36.424692 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.latest_rm_urn (compile): 13:38:36.420643 => 13:38:36.424516
[0m13:38:36.425267 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '012045f0-619a-41a5-b503-11d4954a8d85', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110dc00d0>]}
[0m13:38:36.425553 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.latest_rm_urn
[0m13:38:36.425930 [info ] [Thread-1 (]: 1 of 15 OK created sql view model dbt_melissa_rm_epc.stg_epc_certs ............. [[32mSUCCESS 1[0m in 0.66s]
[0m13:38:36.428295 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.latest_rm_urn"
[0m13:38:36.428706 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.stg_epc_certs
[0m13:38:36.429246 [debug] [Thread-2 (]: Began running node model.rightmove_epc.dim_addressid
[0m13:38:36.429800 [debug] [Thread-3 (]: Began running node model.rightmove_epc.dim_uprn
[0m13:38:36.430524 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.latest_rm_urn"
[0m13:38:36.430763 [debug] [Thread-1 (]: Began running node model.rightmove_epc.latest_epc_urn
[0m13:38:36.429559 [info ] [Thread-2 (]: 4 of 15 START sql view model dbt_melissa_rm_epc.dim_addressid .................. [RUN]
[0m13:38:36.431160 [info ] [Thread-3 (]: 5 of 15 START sql view model dbt_melissa_rm_epc.dim_uprn ....................... [RUN]
[0m13:38:36.431506 [debug] [Thread-4 (]: On model.rightmove_epc.latest_rm_urn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.latest_rm_urn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NOT NULL
),

change_date AS (
    SELECT 
        UPRN AS UPRN_CD, 
        MAX(CHANGE_DATE) AS MAX_CHANGE_DATE 
    FROM rm
    GROUP BY UPRN
),

rm_latest as (

    SELECT distinct * FROM rm
    LEFT JOIN change_date cd
    ON rm.UPRN = cd.UPRN_CD
    WHERE cd.MAX_CHANGE_DATE = rm.CHANGE_DATE 
 --  and UPRN = 100090588560
    
)

select DISTINCT * from rm_latest

/*
select uprn, count(*) from rm_latest
group by 1
having count(*) >1
*/
  );
[0m13:38:36.431862 [info ] [Thread-1 (]: 6 of 15 START sql view model dbt_melissa_rm_epc.latest_epc_urn ................. [RUN]
[0m13:38:36.432384 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_rightmove, now model.rightmove_epc.dim_addressid)
[0m13:38:36.432862 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_uprn'
[0m13:38:36.433108 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m13:38:36.433519 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_epc_certs, now model.rightmove_epc.latest_epc_urn)
[0m13:38:36.433743 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.dim_addressid
[0m13:38:36.433958 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.dim_uprn
[0m13:38:36.434557 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.latest_epc_urn
[0m13:38:36.436841 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.dim_addressid"
[0m13:38:36.438821 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.dim_uprn"
[0m13:38:36.440629 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.latest_epc_urn"
[0m13:38:36.442190 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.latest_epc_urn (compile): 13:38:36.439090 => 13:38:36.442024
[0m13:38:36.442467 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.dim_uprn (compile): 13:38:36.437073 => 13:38:36.442337
[0m13:38:36.442726 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.dim_addressid (compile): 13:38:36.434923 => 13:38:36.442599
[0m13:38:36.442925 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.latest_epc_urn
[0m13:38:36.443196 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.dim_uprn
[0m13:38:36.443401 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.dim_addressid
[0m13:38:36.445240 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.latest_epc_urn"
[0m13:38:36.447877 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.dim_uprn"
[0m13:38:36.449593 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.dim_addressid"
[0m13:38:36.451320 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.dim_uprn"
[0m13:38:36.451880 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.latest_epc_urn"
[0m13:38:36.452510 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.dim_addressid"
[0m13:38:36.452751 [debug] [Thread-3 (]: On model.rightmove_epc.dim_uprn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_uprn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE UPRNS


with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource,
    POSTCODE
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    where REMOVE_FROM_RM_MATCH = 0
    AND UPRN IS NOT NULL
),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    WHERE UPRN IS NOT NULL

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where uprn is not null
  );
[0m13:38:36.453047 [debug] [Thread-1 (]: On model.rightmove_epc.latest_epc_urn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.latest_epc_urn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn
  
   as (
    with epc_max_date as (

    select uprn as UPRN_EPC,
    MAX(LODGEMENT_DATE) AS MAX_LODGEMENT_DATE,
    from  ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    group by 1


),

latest_epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc
    inner join epc_max_date on epc.uprn = epc_max_date.UPRN_EPC
    where MAX_LODGEMENT_DATE = LODGEMENT_DATE
   -- and uprn = 200073066

)

select DISTINCT * from latest_epc

/*
select uprn, count(*) from latest_epc
group by 1
having count(*) >1
*/
  );
[0m13:38:36.453306 [debug] [Thread-2 (]: On model.rightmove_epc.dim_addressid: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_addressid"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE ADDRESS'

with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource,
    POSTCODE

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    where REMOVE_FROM_RM_MATCH = 0
    AND ADDRESSID IS NOT NULL

),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    WHERE ADDRESSID IS NOT NULL

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where addressid is not null
  );
[0m13:38:36.453525 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m13:38:36.453707 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:38:36.453883 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m13:38:36.987233 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:38:36.990854 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.dim_uprn (execute): 13:38:36.445382 => 13:38:36.990621
[0m13:38:36.991302 [debug] [Thread-3 (]: On model.rightmove_epc.dim_uprn: Close
[0m13:38:37.033124 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:38:37.035688 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.latest_rm_urn (execute): 13:38:36.426120 => 13:38:37.035494
[0m13:38:37.036066 [debug] [Thread-4 (]: On model.rightmove_epc.latest_rm_urn: Close
[0m13:38:37.048290 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:38:37.048986 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:38:37.051678 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.dim_addressid (execute): 13:38:36.448049 => 13:38:37.051475
[0m13:38:37.054328 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.latest_epc_urn (execute): 13:38:36.443532 => 13:38:37.054159
[0m13:38:37.054667 [debug] [Thread-2 (]: On model.rightmove_epc.dim_addressid: Close
[0m13:38:37.054954 [debug] [Thread-1 (]: On model.rightmove_epc.latest_epc_urn: Close
[0m13:38:37.066546 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '012045f0-619a-41a5-b503-11d4954a8d85', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110c2c410>]}
[0m13:38:37.067083 [info ] [Thread-3 (]: 5 of 15 OK created sql view model dbt_melissa_rm_epc.dim_uprn .................. [[32mSUCCESS 1[0m in 0.63s]
[0m13:38:37.067551 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.dim_uprn
[0m13:38:37.123161 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '012045f0-619a-41a5-b503-11d4954a8d85', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10785d710>]}
[0m13:38:37.123852 [info ] [Thread-4 (]: 3 of 15 OK created sql view model dbt_melissa_rm_epc.latest_rm_urn ............. [[32mSUCCESS 1[0m in 0.70s]
[0m13:38:37.124355 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.latest_rm_urn
[0m13:38:37.124992 [debug] [Thread-3 (]: Began running node model.rightmove_epc.no_uprn_match
[0m13:38:37.125352 [debug] [Thread-4 (]: Began running node model.rightmove_epc.uprn_match
[0m13:38:37.125791 [info ] [Thread-3 (]: 7 of 15 START sql view model dbt_melissa_rm_epc.no_uprn_match .................. [RUN]
[0m13:38:37.126329 [info ] [Thread-4 (]: 8 of 15 START sql view model dbt_melissa_rm_epc.uprn_match ..................... [RUN]
[0m13:38:37.127006 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.dim_uprn, now model.rightmove_epc.no_uprn_match)
[0m13:38:37.127562 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.latest_rm_urn, now model.rightmove_epc.uprn_match)
[0m13:38:37.127950 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.no_uprn_match
[0m13:38:37.128358 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.uprn_match
[0m13:38:37.131251 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.no_uprn_match"
[0m13:38:37.133737 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.uprn_match"
[0m13:38:37.135917 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '012045f0-619a-41a5-b503-11d4954a8d85', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110f83590>]}
[0m13:38:37.136527 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '012045f0-619a-41a5-b503-11d4954a8d85', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111043f50>]}
[0m13:38:37.137084 [info ] [Thread-1 (]: 6 of 15 OK created sql view model dbt_melissa_rm_epc.latest_epc_urn ............ [[32mSUCCESS 1[0m in 0.70s]
[0m13:38:37.137609 [info ] [Thread-2 (]: 4 of 15 OK created sql view model dbt_melissa_rm_epc.dim_addressid ............. [[32mSUCCESS 1[0m in 0.70s]
[0m13:38:37.138017 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.no_uprn_match (compile): 13:38:37.128628 => 13:38:37.137800
[0m13:38:37.138298 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.uprn_match (compile): 13:38:37.131875 => 13:38:37.138174
[0m13:38:37.138628 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.latest_epc_urn
[0m13:38:37.138961 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.dim_addressid
[0m13:38:37.139203 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.no_uprn_match
[0m13:38:37.139447 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.uprn_match
[0m13:38:37.139886 [debug] [Thread-1 (]: Began running node model.rightmove_epc.address_match
[0m13:38:37.142323 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.no_uprn_match"
[0m13:38:37.144518 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.uprn_match"
[0m13:38:37.144846 [info ] [Thread-1 (]: 9 of 15 START sql view model dbt_melissa_rm_epc.address_match .................. [RUN]
[0m13:38:37.145458 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.latest_epc_urn, now model.rightmove_epc.address_match)
[0m13:38:37.145701 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.address_match
[0m13:38:37.147782 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.address_match"
[0m13:38:37.148519 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.no_uprn_match"
[0m13:38:37.149116 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.uprn_match"
[0m13:38:37.149403 [debug] [Thread-3 (]: On model.rightmove_epc.no_uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.no_uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.no_uprn_match
  
   as (
    with rm_latest as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn 
    where UPRN IS NOT NULL
),

epc_uprn as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
    where datasource = 'EPC'
)


SELECT rm_latest.*,
CASE WHEN epc_uprn.UPRN is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_uprn.UPRN AS EPC_UPRN,
epc_uprn.ADDRESSID AS EPC_ADDRESSID


FROM rm_latest
LEFT JOIN epc_uprn
ON rm_latest.UPRN = epc_uprn.UPRN

WHERE MATCH_EPC = 'NO'
  );
[0m13:38:37.149688 [debug] [Thread-4 (]: On model.rightmove_epc.uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
  
   as (
    with rm_latest as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn
    where UPRN IS NOT NULL
),

epc_uprn as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
    where datasource = 'EPC'
)


SELECT rm_latest.*,
CASE WHEN epc_uprn.UPRN is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_uprn.UPRN AS EPC_UPRN,
epc_uprn.ADDRESSID AS EPC_ADDRESSID


FROM rm_latest
LEFT JOIN epc_uprn
ON rm_latest.UPRN = epc_uprn.UPRN

WHERE MATCH_EPC = 'YES'
  );
[0m13:38:37.149959 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.address_match (compile): 13:38:37.145896 => 13:38:37.149843
[0m13:38:37.150161 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m13:38:37.150355 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m13:38:37.150559 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.address_match
[0m13:38:37.153805 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.address_match"
[0m13:38:37.154987 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.address_match"
[0m13:38:37.155240 [debug] [Thread-1 (]: On model.rightmove_epc.address_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.address_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NULL

),

epc_address as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
    where datasource = 'EPC'
)


SELECT rm.*,
CASE WHEN epc_address.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_address.ADDRESSID AS EPC_ADDRESSID,
epc_address.UPRN AS EPC_UPRN


FROM rm
LEFT JOIN epc_address
ON rm.addressid = epc_address.addressid
and rm.FULL_POSTCODE = epc_address.POSTCODE
  );
[0m13:38:37.155463 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:38:37.794615 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:38:37.796075 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:38:37.798622 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.no_uprn_match (execute): 13:38:37.140046 => 13:38:37.798421
[0m13:38:37.799204 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:38:37.801451 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.uprn_match (execute): 13:38:37.142504 => 13:38:37.801296
[0m13:38:37.801777 [debug] [Thread-3 (]: On model.rightmove_epc.no_uprn_match: Close
[0m13:38:37.803698 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.address_match (execute): 13:38:37.151927 => 13:38:37.803543
[0m13:38:37.803996 [debug] [Thread-4 (]: On model.rightmove_epc.uprn_match: Close
[0m13:38:37.805143 [debug] [Thread-1 (]: On model.rightmove_epc.address_match: Close
[0m13:38:37.887104 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '012045f0-619a-41a5-b503-11d4954a8d85', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110dc3f50>]}
[0m13:38:37.887791 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '012045f0-619a-41a5-b503-11d4954a8d85', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110ddc410>]}
[0m13:38:37.888353 [info ] [Thread-1 (]: 9 of 15 OK created sql view model dbt_melissa_rm_epc.address_match ............. [[32mSUCCESS 1[0m in 0.74s]
[0m13:38:37.889118 [info ] [Thread-3 (]: 7 of 15 OK created sql view model dbt_melissa_rm_epc.no_uprn_match ............. [[32mSUCCESS 1[0m in 0.76s]
[0m13:38:37.889637 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.address_match
[0m13:38:37.890053 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.no_uprn_match
[0m13:38:37.890581 [debug] [Thread-2 (]: Began running node model.rightmove_epc.uprn_address_match
[0m13:38:37.891204 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '012045f0-619a-41a5-b503-11d4954a8d85', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110d83dd0>]}
[0m13:38:37.891590 [info ] [Thread-2 (]: 10 of 15 START sql view model dbt_melissa_rm_epc.uprn_address_match ............ [RUN]
[0m13:38:37.892111 [info ] [Thread-4 (]: 8 of 15 OK created sql view model dbt_melissa_rm_epc.uprn_match ................ [[32mSUCCESS 1[0m in 0.76s]
[0m13:38:37.892595 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.dim_addressid, now model.rightmove_epc.uprn_address_match)
[0m13:38:37.892953 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.uprn_match
[0m13:38:37.893196 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.uprn_address_match
[0m13:38:37.893576 [debug] [Thread-3 (]: Began running node model.rightmove_epc.flats_report
[0m13:38:37.893866 [debug] [Thread-1 (]: Began running node model.rightmove_epc.houses_report
[0m13:38:37.897850 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.uprn_address_match"
[0m13:38:37.898185 [info ] [Thread-3 (]: 11 of 15 START sql view model dbt_melissa_rm_epc.flats_report .................. [RUN]
[0m13:38:37.898555 [info ] [Thread-1 (]: 12 of 15 START sql view model dbt_melissa_rm_epc.houses_report ................. [RUN]
[0m13:38:37.899247 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.no_uprn_match, now model.rightmove_epc.flats_report)
[0m13:38:37.900047 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.address_match, now model.rightmove_epc.houses_report)
[0m13:38:37.900325 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.flats_report
[0m13:38:37.900620 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.houses_report
[0m13:38:37.900906 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.uprn_address_match (compile): 13:38:37.894006 => 13:38:37.900761
[0m13:38:37.903263 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.flats_report"
[0m13:38:37.905724 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.houses_report"
[0m13:38:37.906008 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.uprn_address_match
[0m13:38:37.908273 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.uprn_address_match"
[0m13:38:37.908682 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.houses_report (compile): 13:38:37.903464 => 13:38:37.908558
[0m13:38:37.908921 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.flats_report (compile): 13:38:37.901052 => 13:38:37.908794
[0m13:38:37.909150 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.houses_report
[0m13:38:37.909841 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.uprn_address_match"
[0m13:38:37.910050 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.flats_report
[0m13:38:37.912007 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.houses_report"
[0m13:38:37.912309 [debug] [Thread-2 (]: On model.rightmove_epc.uprn_address_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.uprn_address_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_address_match
  
   as (
    -- where uprn is not matched we try address.

with uprn as (

    select 
    up.LISTING_ID,
    CHANGE_DATE,
    up.ADDRESSID,
    up.ADDRESS_1,
    up.ADDRESS_2,
    FULL_POSTCODE,
    up.UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    BEDROOM,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
 -- need to sleect the same fields as address match
    CASE WHEN ad.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC,
    ad.ADDRESSID AS EPC_ADDRESSID,
    ad.UPRN AS EPC_UPRN

     from ANALYTICS_DEV.dbt_melissa_rm_epc.no_uprn_match up
    left join ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid ad on up.ADDRESSID = ad.ADDRESSID
    and up.FULL_POSTCODE = ad.POSTCODE
   
)

SELECT * FROM UPRN
  );
[0m13:38:37.914156 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.flats_report"
[0m13:38:37.914448 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m13:38:37.916051 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.houses_report"
[0m13:38:37.916619 [debug] [Thread-1 (]: On model.rightmove_epc.houses_report: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.houses_report"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.houses_report
  
   as (
    with house_addmatch as (

    select 
    distinct
    --count(LISTING_ID) as TOTAL_LISTINGS,
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN, -- NULL
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
 --   am.FLOOR_LEVEL as RM_FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    COUNTY,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    epc.ADDRESSID AS EPC_ADDRESSID,
    -- REMOVE_FROM_RM_MATCH,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

     from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc on am.EPC_ADDRESSID = epc.ADDRESSID
    and am.FULL_POSTCODE = epc.POSTCODE
    where MATCH_EPC = 'YES'
    and COMBINED_PROPERTY_TYPE not in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')

),

house_uprnmatch as (

    select 
    distinct
    --count(LISTING_ID) as TOTAL_LISTINGS,
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN, -- NULL
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
  --  am.FLOOR_LEVEL as RM_FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    COUNTY,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    epc.ADDRESSID AS EPC_ADDRESSID,
    -- REMOVE_FROM_RM_MATCH,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

    

    from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn epc on am.EPC_UPRN = epc.UPRN

    where MATCH_EPC = 'YES'
    and COMBINED_PROPERTY_TYPE not in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')
  -- AND RM_UPRN = 100030719363

)


select 'UPRN' as MATCH_TYPE, * from house_uprnmatch

union all

select 'ADDRESSID' as MATCH_TYPE, * from house_addmatch

/*
--THIS IS USED FOR A TEST
select RM_UPRN,COUNT(BUILDING_REFERENCE_NUMBER)
from house_uprnmatch
WHERE RM_UPRN IS NOT NULL
GROUP BY 1
HAVING COUNT(BUILDING_REFERENCE_NUMBER) >1
*/
  );
[0m13:38:37.918386 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.flats_report"
[0m13:38:37.918629 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:38:37.919011 [debug] [Thread-3 (]: On model.rightmove_epc.flats_report: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.flats_report"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.flats_report
  
   as (
    with house_addmatch as (

    select 
    distinct
    --count(LISTING_ID) as TOTAL_LISTINGS,
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN, -- NULL
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
 --   am.FLOOR_LEVEL as RM_FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    COUNTY,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    epc.ADDRESSID AS EPC_ADDRESSID,
    -- REMOVE_FROM_RM_MATCH,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

     from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc on am.EPC_ADDRESSID = epc.ADDRESSID
    and am.FULL_POSTCODE = epc.POSTCODE
    where MATCH_EPC = 'YES'
    and COMBINED_PROPERTY_TYPE in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')

),

house_uprnmatch as (

    select 
    distinct
    --count(LISTING_ID) as TOTAL_LISTINGS,
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN, -- NULL
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
  --  am.FLOOR_LEVEL as RM_FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    COUNTY,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    epc.ADDRESSID AS EPC_ADDRESSID,
    -- REMOVE_FROM_RM_MATCH,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

    

    from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn epc on am.EPC_UPRN = epc.UPRN

    where MATCH_EPC = 'YES'
   and COMBINED_PROPERTY_TYPE in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')
  -- AND RM_UPRN = 100030719363

)


select 'UPRN' as MATCH_TYPE, * from house_uprnmatch

union all

select 'ADDRESSID' as MATCH_TYPE, * from house_addmatch

/*
--THIS IS USED FOR A TEST
select RM_UPRN,COUNT(BUILDING_REFERENCE_NUMBER)
from house_uprnmatch
WHERE RM_UPRN IS NOT NULL
GROUP BY 1
HAVING COUNT(BUILDING_REFERENCE_NUMBER) >1
*/
  );
[0m13:38:37.920146 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m13:38:38.506822 [debug] [Thread-3 (]: Snowflake adapter: Snowflake query id: 01b344d2-0103-9bad-0000-719506377976
[0m13:38:38.507593 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b344d2-0103-9bad-0000-71950637797a
[0m13:38:38.508021 [debug] [Thread-3 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 30 at position 4
invalid identifier 'COUNTY'
[0m13:38:38.508431 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 30 at position 4
invalid identifier 'COUNTY'
[0m13:38:38.509017 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.flats_report (execute): 13:38:37.912502 => 13:38:38.508808
[0m13:38:38.509651 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.houses_report (execute): 13:38:37.910184 => 13:38:38.509389
[0m13:38:38.510072 [debug] [Thread-3 (]: On model.rightmove_epc.flats_report: Close
[0m13:38:38.510470 [debug] [Thread-1 (]: On model.rightmove_epc.houses_report: Close
[0m13:38:38.607469 [debug] [Thread-3 (]: Database Error in model flats_report (models/reports/flats_report.sql)
  000904 (42000): SQL compilation error: error line 30 at position 4
  invalid identifier 'COUNTY'
  compiled Code at target/run/rightmove_epc/models/reports/flats_report.sql
[0m13:38:38.609107 [debug] [Thread-1 (]: Database Error in model houses_report (models/reports/houses_report.sql)
  000904 (42000): SQL compilation error: error line 30 at position 4
  invalid identifier 'COUNTY'
  compiled Code at target/run/rightmove_epc/models/reports/houses_report.sql
[0m13:38:38.609552 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '012045f0-619a-41a5-b503-11d4954a8d85', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110db8ed0>]}
[0m13:38:38.610262 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '012045f0-619a-41a5-b503-11d4954a8d85', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110ddc910>]}
[0m13:38:38.610923 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:38:38.611427 [error] [Thread-3 (]: 11 of 15 ERROR creating sql view model dbt_melissa_rm_epc.flats_report ......... [[31mERROR[0m in 0.71s]
[0m13:38:38.611939 [error] [Thread-1 (]: 12 of 15 ERROR creating sql view model dbt_melissa_rm_epc.houses_report ........ [[31mERROR[0m in 0.71s]
[0m13:38:38.614161 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.uprn_address_match (execute): 13:38:37.906283 => 13:38:38.614007
[0m13:38:38.614559 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.flats_report
[0m13:38:38.614920 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.houses_report
[0m13:38:38.615195 [debug] [Thread-2 (]: On model.rightmove_epc.uprn_address_match: Close
[0m13:38:38.615733 [debug] [Thread-4 (]: Began running node model.rightmove_epc.zero_bedrooms
[0m13:38:38.616683 [info ] [Thread-4 (]: 13 of 15 SKIP relation dbt_melissa_rm_epc.zero_bedrooms ........................ [[33mSKIP[0m]
[0m13:38:38.617263 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.zero_bedrooms
[0m13:38:38.705509 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '012045f0-619a-41a5-b503-11d4954a8d85', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110e53810>]}
[0m13:38:38.706129 [info ] [Thread-2 (]: 10 of 15 OK created sql view model dbt_melissa_rm_epc.uprn_address_match ....... [[32mSUCCESS 1[0m in 0.81s]
[0m13:38:38.706628 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.uprn_address_match
[0m13:38:38.707284 [debug] [Thread-1 (]: Began running node model.rightmove_epc.rm_all_matches
[0m13:38:38.707707 [info ] [Thread-1 (]: 14 of 15 START sql view model dbt_melissa_rm_epc.rm_all_matches ................ [RUN]
[0m13:38:38.708244 [debug] [Thread-3 (]: Began running node model.rightmove_epc.rm_no_matches
[0m13:38:38.708812 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.houses_report, now model.rightmove_epc.rm_all_matches)
[0m13:38:38.709275 [info ] [Thread-3 (]: 15 of 15 START sql view model dbt_melissa_rm_epc.rm_no_matches ................. [RUN]
[0m13:38:38.709642 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.rm_all_matches
[0m13:38:38.710184 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.flats_report, now model.rightmove_epc.rm_no_matches)
[0m13:38:38.712471 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.rm_no_matches
[0m13:38:38.714848 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.rm_no_matches"
[0m13:38:38.716048 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.rm_all_matches"
[0m13:38:38.716738 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.rm_no_matches (compile): 13:38:38.712668 => 13:38:38.716591
[0m13:38:38.717054 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.rm_all_matches (compile): 13:38:38.710369 => 13:38:38.716905
[0m13:38:38.717284 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.rm_no_matches
[0m13:38:38.717521 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.rm_all_matches
[0m13:38:38.719728 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.rm_no_matches"
[0m13:38:38.721761 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.rm_all_matches"
[0m13:38:38.723104 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.rm_no_matches"
[0m13:38:38.724171 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.rm_all_matches"
[0m13:38:38.724486 [debug] [Thread-3 (]: On model.rightmove_epc.rm_no_matches: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.rm_no_matches"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.rm_no_matches
  
   as (
    with addr as (

    select 
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    '' AS EPC_UPRN,
    EPC_ADDRESSID
    
    from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
    where MATCH_EPC = 'NO' 
),

uprn as (

    select 
    
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN::VARCHAR AS EPC_UPRN,
    EPC_ADDRESSID
    
     from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'NO'
),

uprn_address as (

        select 
    
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN::VARCHAR AS EPC_UPRN,
    EPC_ADDRESSID
    
     from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_address_match
    where MATCH_EPC = 'NO'
)

final as (

select 'NO ADDRESS MATCH' AS MATCH_RESULT, * from addr
union all
select 'NO UPRN MATCH' AS MATCH_RESULT, * from uprn
union select 'NO ADDRESS OR UPRN MATCH ' AS MATCH_RESULT

* from uprn

)

select * from final
  );
[0m13:38:38.724851 [debug] [Thread-1 (]: On model.rightmove_epc.rm_all_matches: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.rm_all_matches"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.rm_all_matches
  
   as (
    with addr as (

    select 
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN,
    EPC_ADDRESSID
    
    from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
    where MATCH_EPC = 'YES' 
),

uprn_addr as (

    select 
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN,
    EPC_ADDRESSID
    
    from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_address_match
    where MATCH_EPC = 'YES' 
),

uprn as (

    select 
    
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN::VARCHAR AS EPC_UPRN,
    EPC_ADDRESSID

    from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'YES'
),

final as (

select 'ADDRESS AND POSTCODE MATCH' AS MATCH_RESULT, * from addr
union all
select 'UPRN MATCH' AS MATCH_RESULT, * from uprn
union all
select 'MATCH ADDRESS NO MATCH TO EPC UPRN' AS MATCH_RESULT, * from uprn
)

select * from final
  );
[0m13:38:38.725144 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m13:38:38.725355 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:38:39.045375 [debug] [Thread-3 (]: Snowflake adapter: Snowflake query id: 01b344d2-0103-9b9a-0000-7195063769d6
[0m13:38:39.045692 [debug] [Thread-3 (]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 69 at position 0 unexpected 'final'.
syntax error line 76 at position 0 unexpected '*'.
[0m13:38:39.046003 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.rm_no_matches (execute): 13:38:38.717660 => 13:38:39.045888
[0m13:38:39.046212 [debug] [Thread-3 (]: On model.rightmove_epc.rm_no_matches: Close
[0m13:38:39.141361 [debug] [Thread-3 (]: Database Error in model rm_no_matches (models/reports/rm_no_matches.sql)
  001003 (42000): SQL compilation error:
  syntax error line 69 at position 0 unexpected 'final'.
  syntax error line 76 at position 0 unexpected '*'.
  compiled Code at target/run/rightmove_epc/models/reports/rm_no_matches.sql
[0m13:38:39.141779 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '012045f0-619a-41a5-b503-11d4954a8d85', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110d61ad0>]}
[0m13:38:39.142171 [error] [Thread-3 (]: 15 of 15 ERROR creating sql view model dbt_melissa_rm_epc.rm_no_matches ........ [[31mERROR[0m in 0.43s]
[0m13:38:39.142546 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.rm_no_matches
[0m13:38:39.584510 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:38:39.587329 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.rm_all_matches (execute): 13:38:38.719898 => 13:38:39.587098
[0m13:38:39.587760 [debug] [Thread-1 (]: On model.rightmove_epc.rm_all_matches: Close
[0m13:38:39.677401 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '012045f0-619a-41a5-b503-11d4954a8d85', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110ec09d0>]}
[0m13:38:39.678192 [info ] [Thread-1 (]: 14 of 15 OK created sql view model dbt_melissa_rm_epc.rm_all_matches ........... [[32mSUCCESS 1[0m in 0.97s]
[0m13:38:39.678764 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.rm_all_matches
[0m13:38:39.680341 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:38:39.680631 [debug] [MainThread]: Connection 'model.rightmove_epc.rm_all_matches' was properly closed.
[0m13:38:39.680886 [debug] [MainThread]: Connection 'model.rightmove_epc.uprn_address_match' was properly closed.
[0m13:38:39.681127 [debug] [MainThread]: Connection 'model.rightmove_epc.uprn_match' was properly closed.
[0m13:38:39.681367 [debug] [MainThread]: Connection 'model.rightmove_epc.rm_no_matches' was properly closed.
[0m13:38:39.681703 [info ] [MainThread]: 
[0m13:38:39.681997 [info ] [MainThread]: Finished running 15 view models in 0 hours 0 minutes and 4.94 seconds (4.94s).
[0m13:38:39.683747 [debug] [MainThread]: Command end result
[0m13:38:39.695361 [info ] [MainThread]: 
[0m13:38:39.695690 [info ] [MainThread]: [31mCompleted with 3 errors and 0 warnings:[0m
[0m13:38:39.695913 [info ] [MainThread]: 
[0m13:38:39.696139 [error] [MainThread]:   Database Error in model flats_report (models/reports/flats_report.sql)
  000904 (42000): SQL compilation error: error line 30 at position 4
  invalid identifier 'COUNTY'
  compiled Code at target/run/rightmove_epc/models/reports/flats_report.sql
[0m13:38:39.696354 [info ] [MainThread]: 
[0m13:38:39.696562 [error] [MainThread]:   Database Error in model houses_report (models/reports/houses_report.sql)
  000904 (42000): SQL compilation error: error line 30 at position 4
  invalid identifier 'COUNTY'
  compiled Code at target/run/rightmove_epc/models/reports/houses_report.sql
[0m13:38:39.696768 [info ] [MainThread]: 
[0m13:38:39.696974 [error] [MainThread]:   Database Error in model rm_no_matches (models/reports/rm_no_matches.sql)
  001003 (42000): SQL compilation error:
  syntax error line 69 at position 0 unexpected 'final'.
  syntax error line 76 at position 0 unexpected '*'.
  compiled Code at target/run/rightmove_epc/models/reports/rm_no_matches.sql
[0m13:38:39.697199 [info ] [MainThread]: 
[0m13:38:39.697419 [info ] [MainThread]: Done. PASS=11 WARN=0 ERROR=3 SKIP=1 TOTAL=15
[0m13:38:39.699950 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 5.2920566, "process_user_time": 1.817465, "process_kernel_time": 0.231582, "process_mem_max_rss": "138657792", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m13:38:39.700347 [debug] [MainThread]: Command `dbt run` failed at 13:38:39.700261 after 5.29 seconds
[0m13:38:39.700615 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1036f6110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103831cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1037f8f10>]}
[0m13:38:39.700865 [debug] [MainThread]: Flushing usage events
[0m13:39:28.178013 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106ac2950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106af2890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106af3410>]}


============================== 13:39:28.181554 | 4cf971da-8dce-4e5e-88fe-9d8ef30d9a37 ==============================
[0m13:39:28.181554 [info ] [MainThread]: Running with dbt=1.7.10
[0m13:39:28.181938 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m13:39:28.384623 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4cf971da-8dce-4e5e-88fe-9d8ef30d9a37', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106b3c750>]}
[0m13:39:28.425442 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4cf971da-8dce-4e5e-88fe-9d8ef30d9a37', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106b2ab50>]}
[0m13:39:28.426064 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m13:39:28.436455 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m13:39:28.464358 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m13:39:28.464673 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m13:39:28.468563 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4cf971da-8dce-4e5e-88fe-9d8ef30d9a37', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107653e90>]}
[0m13:39:28.477368 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4cf971da-8dce-4e5e-88fe-9d8ef30d9a37', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1076b7f90>]}
[0m13:39:28.477726 [info ] [MainThread]: Found 15 models, 1 analysis, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m13:39:28.477961 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4cf971da-8dce-4e5e-88fe-9d8ef30d9a37', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1075692d0>]}
[0m13:39:28.479415 [info ] [MainThread]: 
[0m13:39:28.480006 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m13:39:28.480955 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m13:39:28.488527 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m13:39:28.488817 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m13:39:28.489007 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:39:28.915296 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 0.0 seconds
[0m13:39:28.917741 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m13:39:29.002691 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m13:39:29.010467 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m13:39:29.010810 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m13:39:29.011070 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:39:29.317920 [debug] [ThreadPool]: SQL status: SUCCESS 17 in 0.0 seconds
[0m13:39:29.319885 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m13:39:29.417039 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4cf971da-8dce-4e5e-88fe-9d8ef30d9a37', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10401ff50>]}
[0m13:39:29.418001 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m13:39:29.418371 [info ] [MainThread]: 
[0m13:39:29.422085 [debug] [Thread-1 (]: Began running node model.rightmove_epc.stg_epc_certs
[0m13:39:29.422547 [debug] [Thread-2 (]: Began running node model.rightmove_epc.stg_rightmove
[0m13:39:29.423145 [info ] [Thread-1 (]: 1 of 15 START sql view model dbt_melissa_rm_epc.stg_epc_certs .................. [RUN]
[0m13:39:29.423786 [info ] [Thread-2 (]: 2 of 15 START sql view model dbt_melissa_rm_epc.stg_rightmove .................. [RUN]
[0m13:39:29.424640 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.stg_epc_certs)
[0m13:39:29.425338 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.stg_rightmove'
[0m13:39:29.425703 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.stg_epc_certs
[0m13:39:29.426036 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.stg_rightmove
[0m13:39:29.432632 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.stg_epc_certs"
[0m13:39:29.435673 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.stg_rightmove"
[0m13:39:29.436879 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (compile): 13:39:29.426249 => 13:39:29.436603
[0m13:39:29.437290 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (compile): 13:39:29.432858 => 13:39:29.437103
[0m13:39:29.437567 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.stg_epc_certs
[0m13:39:29.437840 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.stg_rightmove
[0m13:39:29.489068 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.stg_epc_certs"
[0m13:39:29.490987 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.stg_rightmove"
[0m13:39:29.492077 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.stg_epc_certs"
[0m13:39:29.492661 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.stg_rightmove"
[0m13:39:29.492903 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_epc_certs"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
  
   as (
    WITH epc_certs as (
    
    select 
    UPRN,
    LODGEMENT_DATE,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
   -- COUNTY,
    LOCAL_AUTHORITY as LOCAL_AUTHORITY_CODE,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    UPPER(CASE WHEN (UPPER(ADDRESS1) LIKE 'FLAT%' OR UPPER(ADDRESS1) LIKE 'UNIT%') or UPPER(ADDRESS1) LIKE 'ROOM%' 
    THEN TRIM(REPLACE(REPLACE(CONCAT(ADDRESS),','),' '))
    ELSE trim(replace(replace(ADDRESS1,' '),',')) END) AS ADDRESSID,
    CASE WHEN UPRN is null and addressid is null THEN 1 else 0 end as REMOVE_FROM_RM_MATCH,
    FLOOR_LEVEL,
    FLAT_TOP_STOREY,
    FLAT_STOREY_COUNT,
    PROPERTY_TYPE
 from  RAW.EPC_TEST_DATA.EPC_CERTIFICATES 

)

SELECT * FROM epc_certs
  );
[0m13:39:29.493167 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_rightmove"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
  
   as (
    with rm as (

    SELECT 
    LISTING_ID,
    CHANGE_DATE,
    UPPER(TRIM(replace(REPLACE(CONCAT(ADDRESS_1::VARCHAR,ADDRESS_2::VARCHAR),' '),','))) AS ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, 
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    BEDROOM,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
 --   STUDENTLET_FLAG,
    COMBINED_PROPERTY_TYPE
    -- property type
    FROM 
       ANALYTICS.RIGHTMOVE_PROD.CLEAN_RAW_RIGHTMOVE_DATA 

 
)

SELECT * FROM rm
  );
[0m13:39:29.493384 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:39:29.493562 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m13:39:29.956967 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m13:39:29.973441 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (execute): 13:39:29.438005 => 13:39:29.973274
[0m13:39:29.973768 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: Close
[0m13:39:30.020182 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:39:30.022392 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (execute): 13:39:29.489252 => 13:39:30.022224
[0m13:39:30.022705 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: Close
[0m13:39:30.043763 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4cf971da-8dce-4e5e-88fe-9d8ef30d9a37', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107588fd0>]}
[0m13:39:30.044328 [info ] [Thread-1 (]: 1 of 15 OK created sql view model dbt_melissa_rm_epc.stg_epc_certs ............. [[32mSUCCESS 1[0m in 0.62s]
[0m13:39:30.044733 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.stg_epc_certs
[0m13:39:30.045136 [debug] [Thread-4 (]: Began running node model.rightmove_epc.latest_epc_urn
[0m13:39:30.045414 [info ] [Thread-4 (]: 3 of 15 START sql view model dbt_melissa_rm_epc.latest_epc_urn ................. [RUN]
[0m13:39:30.045883 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.rightmove_epc.latest_epc_urn'
[0m13:39:30.046106 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.latest_epc_urn
[0m13:39:30.048341 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.latest_epc_urn"
[0m13:39:30.049139 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.latest_epc_urn (compile): 13:39:30.046243 => 13:39:30.048997
[0m13:39:30.049378 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.latest_epc_urn
[0m13:39:30.051570 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.latest_epc_urn"
[0m13:39:30.052966 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.latest_epc_urn"
[0m13:39:30.053365 [debug] [Thread-4 (]: On model.rightmove_epc.latest_epc_urn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.latest_epc_urn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn
  
   as (
    with epc_max_date as (

    select uprn as UPRN_EPC,
    MAX(LODGEMENT_DATE) AS MAX_LODGEMENT_DATE,
    from  ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    group by 1


),

latest_epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc
    inner join epc_max_date on epc.uprn = epc_max_date.UPRN_EPC
    where MAX_LODGEMENT_DATE = LODGEMENT_DATE
   -- and uprn = 200073066

)

select DISTINCT * from latest_epc

/*
select uprn, count(*) from latest_epc
group by 1
having count(*) >1
*/
  );
[0m13:39:30.053637 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m13:39:30.117795 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4cf971da-8dce-4e5e-88fe-9d8ef30d9a37', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107a2de10>]}
[0m13:39:30.118335 [info ] [Thread-2 (]: 2 of 15 OK created sql view model dbt_melissa_rm_epc.stg_rightmove ............. [[32mSUCCESS 1[0m in 0.69s]
[0m13:39:30.118725 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.stg_rightmove
[0m13:39:30.119136 [debug] [Thread-1 (]: Began running node model.rightmove_epc.dim_addressid
[0m13:39:30.119410 [debug] [Thread-3 (]: Began running node model.rightmove_epc.dim_uprn
[0m13:39:30.119702 [info ] [Thread-1 (]: 4 of 15 START sql view model dbt_melissa_rm_epc.dim_addressid .................. [RUN]
[0m13:39:30.119981 [debug] [Thread-2 (]: Began running node model.rightmove_epc.latest_rm_urn
[0m13:39:30.120243 [info ] [Thread-3 (]: 5 of 15 START sql view model dbt_melissa_rm_epc.dim_uprn ....................... [RUN]
[0m13:39:30.120675 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_epc_certs, now model.rightmove_epc.dim_addressid)
[0m13:39:30.120939 [info ] [Thread-2 (]: 6 of 15 START sql view model dbt_melissa_rm_epc.latest_rm_urn .................. [RUN]
[0m13:39:30.121391 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_uprn'
[0m13:39:30.121616 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.dim_addressid
[0m13:39:30.122013 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_rightmove, now model.rightmove_epc.latest_rm_urn)
[0m13:39:30.122233 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.dim_uprn
[0m13:39:30.124306 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.dim_addressid"
[0m13:39:30.124544 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.latest_rm_urn
[0m13:39:30.126292 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.dim_uprn"
[0m13:39:30.128213 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.latest_rm_urn"
[0m13:39:30.129037 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.dim_addressid (compile): 13:39:30.122377 => 13:39:30.128857
[0m13:39:30.129350 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.latest_rm_urn (compile): 13:39:30.126595 => 13:39:30.129191
[0m13:39:30.129612 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.dim_uprn (compile): 13:39:30.124677 => 13:39:30.129499
[0m13:39:30.129853 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.dim_addressid
[0m13:39:30.130083 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.latest_rm_urn
[0m13:39:30.130410 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.dim_uprn
[0m13:39:30.132545 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.dim_addressid"
[0m13:39:30.135311 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.latest_rm_urn"
[0m13:39:30.137541 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.dim_uprn"
[0m13:39:30.138563 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.dim_addressid"
[0m13:39:30.139158 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.dim_uprn"
[0m13:39:30.139654 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.latest_rm_urn"
[0m13:39:30.139903 [debug] [Thread-1 (]: On model.rightmove_epc.dim_addressid: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_addressid"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE ADDRESS'

with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource,
    POSTCODE

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    where REMOVE_FROM_RM_MATCH = 0
    AND ADDRESSID IS NOT NULL

),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    WHERE ADDRESSID IS NOT NULL

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where addressid is not null
  );
[0m13:39:30.140188 [debug] [Thread-3 (]: On model.rightmove_epc.dim_uprn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_uprn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE UPRNS


with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource,
    POSTCODE
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    where REMOVE_FROM_RM_MATCH = 0
    AND UPRN IS NOT NULL
),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    WHERE UPRN IS NOT NULL

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where uprn is not null
  );
[0m13:39:30.140461 [debug] [Thread-2 (]: On model.rightmove_epc.latest_rm_urn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.latest_rm_urn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NOT NULL
),

change_date AS (
    SELECT 
        UPRN AS UPRN_CD, 
        MAX(CHANGE_DATE) AS MAX_CHANGE_DATE 
    FROM rm
    GROUP BY UPRN
),

rm_latest as (

    SELECT distinct * FROM rm
    LEFT JOIN change_date cd
    ON rm.UPRN = cd.UPRN_CD
    WHERE cd.MAX_CHANGE_DATE = rm.CHANGE_DATE 
 --  and UPRN = 100090588560
    
)

select DISTINCT * from rm_latest

/*
select uprn, count(*) from rm_latest
group by 1
having count(*) >1
*/
  );
[0m13:39:30.140687 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:39:30.140899 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m13:39:30.141123 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m13:39:30.581481 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:39:30.584710 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.latest_epc_urn (execute): 13:39:30.049515 => 13:39:30.584482
[0m13:39:30.585158 [debug] [Thread-4 (]: On model.rightmove_epc.latest_epc_urn: Close
[0m13:39:30.610410 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m13:39:30.613164 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.latest_rm_urn (execute): 13:39:30.132719 => 13:39:30.612942
[0m13:39:30.613575 [debug] [Thread-2 (]: On model.rightmove_epc.latest_rm_urn: Close
[0m13:39:30.647781 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:39:30.648682 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:39:30.652383 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.dim_addressid (execute): 13:39:30.130614 => 13:39:30.652186
[0m13:39:30.654827 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.dim_uprn (execute): 13:39:30.135549 => 13:39:30.654647
[0m13:39:30.655486 [debug] [Thread-1 (]: On model.rightmove_epc.dim_addressid: Close
[0m13:39:30.655933 [debug] [Thread-3 (]: On model.rightmove_epc.dim_uprn: Close
[0m13:39:30.669221 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4cf971da-8dce-4e5e-88fe-9d8ef30d9a37', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107a2c8d0>]}
[0m13:39:30.669785 [info ] [Thread-4 (]: 3 of 15 OK created sql view model dbt_melissa_rm_epc.latest_epc_urn ............ [[32mSUCCESS 1[0m in 0.62s]
[0m13:39:30.670259 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.latest_epc_urn
[0m13:39:30.703496 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4cf971da-8dce-4e5e-88fe-9d8ef30d9a37', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107753450>]}
[0m13:39:30.704080 [info ] [Thread-2 (]: 6 of 15 OK created sql view model dbt_melissa_rm_epc.latest_rm_urn ............. [[32mSUCCESS 1[0m in 0.58s]
[0m13:39:30.704538 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.latest_rm_urn
[0m13:39:30.760031 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4cf971da-8dce-4e5e-88fe-9d8ef30d9a37', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1075a3dd0>]}
[0m13:39:30.760669 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4cf971da-8dce-4e5e-88fe-9d8ef30d9a37', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1076f6350>]}
[0m13:39:30.761187 [info ] [Thread-3 (]: 5 of 15 OK created sql view model dbt_melissa_rm_epc.dim_uprn .................. [[32mSUCCESS 1[0m in 0.64s]
[0m13:39:30.761684 [info ] [Thread-1 (]: 4 of 15 OK created sql view model dbt_melissa_rm_epc.dim_addressid ............. [[32mSUCCESS 1[0m in 0.64s]
[0m13:39:30.762129 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.dim_uprn
[0m13:39:30.762520 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.dim_addressid
[0m13:39:30.763106 [debug] [Thread-4 (]: Began running node model.rightmove_epc.no_uprn_match
[0m13:39:30.763412 [debug] [Thread-2 (]: Began running node model.rightmove_epc.uprn_match
[0m13:39:30.763695 [info ] [Thread-4 (]: 7 of 15 START sql view model dbt_melissa_rm_epc.no_uprn_match .................. [RUN]
[0m13:39:30.763944 [debug] [Thread-3 (]: Began running node model.rightmove_epc.address_match
[0m13:39:30.764206 [info ] [Thread-2 (]: 8 of 15 START sql view model dbt_melissa_rm_epc.uprn_match ..................... [RUN]
[0m13:39:30.764633 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.latest_epc_urn, now model.rightmove_epc.no_uprn_match)
[0m13:39:30.764902 [info ] [Thread-3 (]: 9 of 15 START sql view model dbt_melissa_rm_epc.address_match .................. [RUN]
[0m13:39:30.765329 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.latest_rm_urn, now model.rightmove_epc.uprn_match)
[0m13:39:30.765579 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.no_uprn_match
[0m13:39:30.765959 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.dim_uprn, now model.rightmove_epc.address_match)
[0m13:39:30.766186 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.uprn_match
[0m13:39:30.768470 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.no_uprn_match"
[0m13:39:30.768769 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.address_match
[0m13:39:30.770631 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.uprn_match"
[0m13:39:30.772732 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.address_match"
[0m13:39:30.773281 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.no_uprn_match (compile): 13:39:30.766328 => 13:39:30.773132
[0m13:39:30.773519 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.no_uprn_match
[0m13:39:30.773751 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.uprn_match (compile): 13:39:30.768931 => 13:39:30.773642
[0m13:39:30.775912 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.no_uprn_match"
[0m13:39:30.776194 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.uprn_match
[0m13:39:30.776417 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.address_match (compile): 13:39:30.770938 => 13:39:30.776310
[0m13:39:30.778527 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.uprn_match"
[0m13:39:30.778798 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.address_match
[0m13:39:30.779451 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.no_uprn_match"
[0m13:39:30.781338 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.address_match"
[0m13:39:30.781610 [debug] [Thread-4 (]: On model.rightmove_epc.no_uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.no_uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.no_uprn_match
  
   as (
    with rm_latest as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn 
    where UPRN IS NOT NULL
),

epc_uprn as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
    where datasource = 'EPC'
)


SELECT rm_latest.*,
CASE WHEN epc_uprn.UPRN is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_uprn.UPRN AS EPC_UPRN,
epc_uprn.ADDRESSID AS EPC_ADDRESSID


FROM rm_latest
LEFT JOIN epc_uprn
ON rm_latest.UPRN = epc_uprn.UPRN

WHERE MATCH_EPC = 'NO'
  );
[0m13:39:30.782198 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.uprn_match"
[0m13:39:30.782417 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m13:39:30.782653 [debug] [Thread-2 (]: On model.rightmove_epc.uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
  
   as (
    with rm_latest as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn
    where UPRN IS NOT NULL
),

epc_uprn as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
    where datasource = 'EPC'
)


SELECT rm_latest.*,
CASE WHEN epc_uprn.UPRN is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_uprn.UPRN AS EPC_UPRN,
epc_uprn.ADDRESSID AS EPC_ADDRESSID


FROM rm_latest
LEFT JOIN epc_uprn
ON rm_latest.UPRN = epc_uprn.UPRN

WHERE MATCH_EPC = 'YES'
  );
[0m13:39:30.783203 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.address_match"
[0m13:39:30.783748 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m13:39:30.784186 [debug] [Thread-3 (]: On model.rightmove_epc.address_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.address_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NULL

),

epc_address as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
    where datasource = 'EPC'
)


SELECT rm.*,
CASE WHEN epc_address.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_address.ADDRESSID AS EPC_ADDRESSID,
epc_address.UPRN AS EPC_UPRN


FROM rm
LEFT JOIN epc_address
ON rm.addressid = epc_address.addressid
and rm.FULL_POSTCODE = epc_address.POSTCODE
  );
[0m13:39:30.784638 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m13:39:31.341880 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:39:31.344956 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.no_uprn_match (execute): 13:39:30.773909 => 13:39:31.344727
[0m13:39:31.345385 [debug] [Thread-4 (]: On model.rightmove_epc.no_uprn_match: Close
[0m13:39:31.355461 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:39:31.358103 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.address_match (execute): 13:39:30.779599 => 13:39:31.357893
[0m13:39:31.358505 [debug] [Thread-3 (]: On model.rightmove_epc.address_match: Close
[0m13:39:31.379581 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:39:31.382003 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.uprn_match (execute): 13:39:30.776612 => 13:39:31.381827
[0m13:39:31.382346 [debug] [Thread-2 (]: On model.rightmove_epc.uprn_match: Close
[0m13:39:31.430808 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4cf971da-8dce-4e5e-88fe-9d8ef30d9a37', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107a2e690>]}
[0m13:39:31.431485 [info ] [Thread-4 (]: 7 of 15 OK created sql view model dbt_melissa_rm_epc.no_uprn_match ............. [[32mSUCCESS 1[0m in 0.67s]
[0m13:39:31.432042 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.no_uprn_match
[0m13:39:31.432606 [debug] [Thread-1 (]: Began running node model.rightmove_epc.uprn_address_match
[0m13:39:31.433064 [info ] [Thread-1 (]: 10 of 15 START sql view model dbt_melissa_rm_epc.uprn_address_match ............ [RUN]
[0m13:39:31.433709 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.dim_addressid, now model.rightmove_epc.uprn_address_match)
[0m13:39:31.434061 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.uprn_address_match
[0m13:39:31.438998 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.uprn_address_match"
[0m13:39:31.440402 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.uprn_address_match (compile): 13:39:31.434274 => 13:39:31.440190
[0m13:39:31.440754 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.uprn_address_match
[0m13:39:31.443360 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.uprn_address_match"
[0m13:39:31.444365 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.uprn_address_match"
[0m13:39:31.444659 [debug] [Thread-1 (]: On model.rightmove_epc.uprn_address_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.uprn_address_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_address_match
  
   as (
    -- where uprn is not matched we try address.

with uprn as (

    select 
    up.LISTING_ID,
    CHANGE_DATE,
    up.ADDRESSID,
    up.ADDRESS_1,
    up.ADDRESS_2,
    FULL_POSTCODE,
    up.UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    BEDROOM,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
 -- need to sleect the same fields as address match
    CASE WHEN ad.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC,
    ad.ADDRESSID AS EPC_ADDRESSID,
    ad.UPRN AS EPC_UPRN

     from ANALYTICS_DEV.dbt_melissa_rm_epc.no_uprn_match up
    left join ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid ad on up.ADDRESSID = ad.ADDRESSID
    and up.FULL_POSTCODE = ad.POSTCODE
   
)

SELECT * FROM UPRN
  );
[0m13:39:31.444918 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:39:31.458181 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4cf971da-8dce-4e5e-88fe-9d8ef30d9a37', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108730c50>]}
[0m13:39:31.458658 [info ] [Thread-3 (]: 9 of 15 OK created sql view model dbt_melissa_rm_epc.address_match ............. [[32mSUCCESS 1[0m in 0.69s]
[0m13:39:31.459054 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.address_match
[0m13:39:31.469510 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4cf971da-8dce-4e5e-88fe-9d8ef30d9a37', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108732490>]}
[0m13:39:31.470079 [info ] [Thread-2 (]: 8 of 15 OK created sql view model dbt_melissa_rm_epc.uprn_match ................ [[32mSUCCESS 1[0m in 0.70s]
[0m13:39:31.470492 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.uprn_match
[0m13:39:31.470914 [debug] [Thread-4 (]: Began running node model.rightmove_epc.flats_report
[0m13:39:31.471197 [debug] [Thread-3 (]: Began running node model.rightmove_epc.houses_report
[0m13:39:31.471582 [info ] [Thread-4 (]: 11 of 15 START sql view model dbt_melissa_rm_epc.flats_report .................. [RUN]
[0m13:39:31.471923 [info ] [Thread-3 (]: 12 of 15 START sql view model dbt_melissa_rm_epc.houses_report ................. [RUN]
[0m13:39:31.472475 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.no_uprn_match, now model.rightmove_epc.flats_report)
[0m13:39:31.472934 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.address_match, now model.rightmove_epc.houses_report)
[0m13:39:31.473205 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.flats_report
[0m13:39:31.473571 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.houses_report
[0m13:39:31.476807 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.flats_report"
[0m13:39:31.479217 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.houses_report"
[0m13:39:31.480464 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.houses_report (compile): 13:39:31.477024 => 13:39:31.480240
[0m13:39:31.480809 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.houses_report
[0m13:39:31.481195 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.flats_report (compile): 13:39:31.473823 => 13:39:31.481018
[0m13:39:31.483550 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.houses_report"
[0m13:39:31.483969 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.flats_report
[0m13:39:31.486151 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.flats_report"
[0m13:39:31.487951 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.houses_report"
[0m13:39:31.488382 [debug] [Thread-3 (]: On model.rightmove_epc.houses_report: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.houses_report"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.houses_report
  
   as (
    with house_addmatch as (

    select 
    distinct
    --count(LISTING_ID) as TOTAL_LISTINGS,
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN, -- NULL
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
 --   am.FLOOR_LEVEL as RM_FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    epc.ADDRESSID AS EPC_ADDRESSID,
    -- REMOVE_FROM_RM_MATCH,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

     from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc on am.EPC_ADDRESSID = epc.ADDRESSID
    and am.FULL_POSTCODE = epc.POSTCODE
    where MATCH_EPC = 'YES'
    and COMBINED_PROPERTY_TYPE not in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')

),

house_uprnmatch as (

    select 
    distinct
    --count(LISTING_ID) as TOTAL_LISTINGS,
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN, -- NULL
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
  --  am.FLOOR_LEVEL as RM_FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    epc.ADDRESSID AS EPC_ADDRESSID,
    -- REMOVE_FROM_RM_MATCH,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

    

    from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn epc on am.EPC_UPRN = epc.UPRN

    where MATCH_EPC = 'YES'
    and COMBINED_PROPERTY_TYPE not in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')
  -- AND RM_UPRN = 100030719363

)


select 'UPRN' as MATCH_TYPE, * from house_uprnmatch

union all

select 'ADDRESSID' as MATCH_TYPE, * from house_addmatch

/*
--THIS IS USED FOR A TEST
select RM_UPRN,COUNT(BUILDING_REFERENCE_NUMBER)
from house_uprnmatch
WHERE RM_UPRN IS NOT NULL
GROUP BY 1
HAVING COUNT(BUILDING_REFERENCE_NUMBER) >1
*/
  );
[0m13:39:31.488704 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m13:39:31.490063 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.flats_report"
[0m13:39:31.491069 [debug] [Thread-4 (]: On model.rightmove_epc.flats_report: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.flats_report"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.flats_report
  
   as (
    with house_addmatch as (

    select 
    distinct
    --count(LISTING_ID) as TOTAL_LISTINGS,
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN, -- NULL
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
 --   am.FLOOR_LEVEL as RM_FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    epc.ADDRESSID AS EPC_ADDRESSID,
    -- REMOVE_FROM_RM_MATCH,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

     from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc on am.EPC_ADDRESSID = epc.ADDRESSID
    and am.FULL_POSTCODE = epc.POSTCODE
    where MATCH_EPC = 'YES'
    and COMBINED_PROPERTY_TYPE in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')

),

house_uprnmatch as (

    select 
    distinct
    --count(LISTING_ID) as TOTAL_LISTINGS,
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN, -- NULL
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
  --  am.FLOOR_LEVEL as RM_FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    epc.ADDRESSID AS EPC_ADDRESSID,
    -- REMOVE_FROM_RM_MATCH,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

    

    from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn epc on am.EPC_UPRN = epc.UPRN

    where MATCH_EPC = 'YES'
   and COMBINED_PROPERTY_TYPE in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')
  -- AND RM_UPRN = 100030719363

)


select 'UPRN' as MATCH_TYPE, * from house_uprnmatch

union all

select 'ADDRESSID' as MATCH_TYPE, * from house_addmatch

/*
--THIS IS USED FOR A TEST
select RM_UPRN,COUNT(BUILDING_REFERENCE_NUMBER)
from house_uprnmatch
WHERE RM_UPRN IS NOT NULL
GROUP BY 1
HAVING COUNT(BUILDING_REFERENCE_NUMBER) >1
*/
  );
[0m13:39:31.491422 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m13:39:32.046421 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:39:32.049517 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.uprn_address_match (execute): 13:39:31.440940 => 13:39:32.049281
[0m13:39:32.049951 [debug] [Thread-1 (]: On model.rightmove_epc.uprn_address_match: Close
[0m13:39:32.149555 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4cf971da-8dce-4e5e-88fe-9d8ef30d9a37', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1076aa7d0>]}
[0m13:39:32.150323 [info ] [Thread-1 (]: 10 of 15 OK created sql view model dbt_melissa_rm_epc.uprn_address_match ....... [[32mSUCCESS 1[0m in 0.72s]
[0m13:39:32.150958 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.uprn_address_match
[0m13:39:32.151585 [debug] [Thread-2 (]: Began running node model.rightmove_epc.rm_all_matches
[0m13:39:32.151985 [debug] [Thread-1 (]: Began running node model.rightmove_epc.rm_no_matches
[0m13:39:32.152406 [info ] [Thread-2 (]: 13 of 15 START sql view model dbt_melissa_rm_epc.rm_all_matches ................ [RUN]
[0m13:39:32.152864 [info ] [Thread-1 (]: 14 of 15 START sql view model dbt_melissa_rm_epc.rm_no_matches ................. [RUN]
[0m13:39:32.153549 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.uprn_match, now model.rightmove_epc.rm_all_matches)
[0m13:39:32.154180 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.uprn_address_match, now model.rightmove_epc.rm_no_matches)
[0m13:39:32.154550 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.rm_all_matches
[0m13:39:32.154882 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.rm_no_matches
[0m13:39:32.158378 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.rm_all_matches"
[0m13:39:32.160988 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.rm_no_matches"
[0m13:39:32.161892 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.rm_all_matches (compile): 13:39:32.155087 => 13:39:32.161679
[0m13:39:32.162321 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.rm_no_matches (compile): 13:39:32.158580 => 13:39:32.162113
[0m13:39:32.162673 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.rm_all_matches
[0m13:39:32.162969 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.rm_no_matches
[0m13:39:32.165736 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.rm_all_matches"
[0m13:39:32.168010 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.rm_no_matches"
[0m13:39:32.169583 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.rm_no_matches"
[0m13:39:32.170790 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.rm_all_matches"
[0m13:39:32.171118 [debug] [Thread-1 (]: On model.rightmove_epc.rm_no_matches: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.rm_no_matches"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.rm_no_matches
  
   as (
    with addr as (

    select 
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    '' AS EPC_UPRN,
    EPC_ADDRESSID
    
    from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
    where MATCH_EPC = 'NO' 
),

uprn as (

    select 
    
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN::VARCHAR AS EPC_UPRN,
    EPC_ADDRESSID
    
     from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'NO'
),

uprn_address as (

        select 
    
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN::VARCHAR AS EPC_UPRN,
    EPC_ADDRESSID
    
     from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_address_match
    where MATCH_EPC = 'NO'
)

final as (

select 'NO ADDRESS MATCH' AS MATCH_RESULT, * from addr
union all
select 'NO UPRN MATCH' AS MATCH_RESULT, * from uprn
union select 'NO ADDRESS OR UPRN MATCH ' AS MATCH_RESULT

* from uprn

)

select * from final
  );
[0m13:39:32.171538 [debug] [Thread-2 (]: On model.rightmove_epc.rm_all_matches: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.rm_all_matches"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.rm_all_matches
  
   as (
    with addr as (

    select 
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN,
    EPC_ADDRESSID
    
    from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
    where MATCH_EPC = 'YES' 
),

uprn_addr as (

    select 
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN,
    EPC_ADDRESSID
    
    from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_address_match
    where MATCH_EPC = 'YES' 
),

uprn as (

    select 
    
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN::VARCHAR AS EPC_UPRN,
    EPC_ADDRESSID

    from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'YES'
),

final as (

select 'ADDRESS AND POSTCODE MATCH' AS MATCH_RESULT, * from addr
union all
select 'UPRN MATCH' AS MATCH_RESULT, * from uprn
union all
select 'MATCH ADDRESS NO MATCH TO EPC UPRN' AS MATCH_RESULT, * from uprn
)

select * from final
  );
[0m13:39:32.171862 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:39:32.172115 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m13:39:32.337525 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:39:32.339607 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.houses_report (execute): 13:39:31.481393 => 13:39:32.339460
[0m13:39:32.339890 [debug] [Thread-3 (]: On model.rightmove_epc.houses_report: Close
[0m13:39:32.382310 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:39:32.384148 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.flats_report (execute): 13:39:31.484289 => 13:39:32.384011
[0m13:39:32.384413 [debug] [Thread-4 (]: On model.rightmove_epc.flats_report: Close
[0m13:39:32.409584 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4cf971da-8dce-4e5e-88fe-9d8ef30d9a37', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1087b3110>]}
[0m13:39:32.410204 [info ] [Thread-3 (]: 12 of 15 OK created sql view model dbt_melissa_rm_epc.houses_report ............ [[32mSUCCESS 1[0m in 0.94s]
[0m13:39:32.410680 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.houses_report
[0m13:39:32.461761 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4cf971da-8dce-4e5e-88fe-9d8ef30d9a37', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1076dde10>]}
[0m13:39:32.462334 [info ] [Thread-4 (]: 11 of 15 OK created sql view model dbt_melissa_rm_epc.flats_report ............. [[32mSUCCESS 1[0m in 0.99s]
[0m13:39:32.462745 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.flats_report
[0m13:39:32.463147 [debug] [Thread-3 (]: Began running node model.rightmove_epc.zero_bedrooms
[0m13:39:32.463441 [info ] [Thread-3 (]: 15 of 15 START sql view model dbt_melissa_rm_epc.zero_bedrooms ................. [RUN]
[0m13:39:32.463916 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.houses_report, now model.rightmove_epc.zero_bedrooms)
[0m13:39:32.464182 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.zero_bedrooms
[0m13:39:32.466624 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.zero_bedrooms"
[0m13:39:32.467303 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.zero_bedrooms (compile): 13:39:32.464332 => 13:39:32.467125
[0m13:39:32.467604 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.zero_bedrooms
[0m13:39:32.470684 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.zero_bedrooms"
[0m13:39:32.471623 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.zero_bedrooms"
[0m13:39:32.471934 [debug] [Thread-3 (]: On model.rightmove_epc.zero_bedrooms: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.zero_bedrooms"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.zero_bedrooms
  
   as (
    with houses as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.houses_report
    where BEDROOM = 0
),

flats as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.flats_report
        where BEDROOM = 0

)

select * from flats
union all
select * from houses
  );
[0m13:39:32.472202 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m13:39:32.484487 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b344d3-0103-9b8b-0000-71950637843e
[0m13:39:32.484849 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 69 at position 0 unexpected 'final'.
syntax error line 76 at position 0 unexpected '*'.
[0m13:39:32.485230 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.rm_no_matches (execute): 13:39:32.165949 => 13:39:32.485090
[0m13:39:32.485480 [debug] [Thread-1 (]: On model.rightmove_epc.rm_no_matches: Close
[0m13:39:32.569797 [debug] [Thread-1 (]: Database Error in model rm_no_matches (models/reports/rm_no_matches.sql)
  001003 (42000): SQL compilation error:
  syntax error line 69 at position 0 unexpected 'final'.
  syntax error line 76 at position 0 unexpected '*'.
  compiled Code at target/run/rightmove_epc/models/reports/rm_no_matches.sql
[0m13:39:32.570327 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4cf971da-8dce-4e5e-88fe-9d8ef30d9a37', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1087948d0>]}
[0m13:39:32.573299 [error] [Thread-1 (]: 14 of 15 ERROR creating sql view model dbt_melissa_rm_epc.rm_no_matches ........ [[31mERROR[0m in 0.42s]
[0m13:39:32.574025 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.rm_no_matches
[0m13:39:32.985097 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:39:32.986738 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.rm_all_matches (execute): 13:39:32.163190 => 13:39:32.986622
[0m13:39:32.986963 [debug] [Thread-2 (]: On model.rightmove_epc.rm_all_matches: Close
[0m13:39:33.068439 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4cf971da-8dce-4e5e-88fe-9d8ef30d9a37', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107a46090>]}
[0m13:39:33.068925 [info ] [Thread-2 (]: 13 of 15 OK created sql view model dbt_melissa_rm_epc.rm_all_matches ........... [[32mSUCCESS 1[0m in 0.92s]
[0m13:39:33.069247 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.rm_all_matches
[0m13:39:33.445141 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:39:33.447093 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.zero_bedrooms (execute): 13:39:32.467774 => 13:39:33.446964
[0m13:39:33.447391 [debug] [Thread-3 (]: On model.rightmove_epc.zero_bedrooms: Close
[0m13:39:33.539553 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4cf971da-8dce-4e5e-88fe-9d8ef30d9a37', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104a241d0>]}
[0m13:39:33.540065 [info ] [Thread-3 (]: 15 of 15 OK created sql view model dbt_melissa_rm_epc.zero_bedrooms ............ [[32mSUCCESS 1[0m in 1.08s]
[0m13:39:33.540416 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.zero_bedrooms
[0m13:39:33.541536 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:39:33.541756 [debug] [MainThread]: Connection 'model.rightmove_epc.rm_no_matches' was properly closed.
[0m13:39:33.541927 [debug] [MainThread]: Connection 'model.rightmove_epc.rm_all_matches' was properly closed.
[0m13:39:33.542085 [debug] [MainThread]: Connection 'model.rightmove_epc.flats_report' was properly closed.
[0m13:39:33.542234 [debug] [MainThread]: Connection 'model.rightmove_epc.zero_bedrooms' was properly closed.
[0m13:39:33.542437 [info ] [MainThread]: 
[0m13:39:33.542627 [info ] [MainThread]: Finished running 15 view models in 0 hours 0 minutes and 5.06 seconds (5.06s).
[0m13:39:33.543772 [debug] [MainThread]: Command end result
[0m13:39:33.550319 [info ] [MainThread]: 
[0m13:39:33.550575 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m13:39:33.550741 [info ] [MainThread]: 
[0m13:39:33.550912 [error] [MainThread]:   Database Error in model rm_no_matches (models/reports/rm_no_matches.sql)
  001003 (42000): SQL compilation error:
  syntax error line 69 at position 0 unexpected 'final'.
  syntax error line 76 at position 0 unexpected '*'.
  compiled Code at target/run/rightmove_epc/models/reports/rm_no_matches.sql
[0m13:39:33.551092 [info ] [MainThread]: 
[0m13:39:33.551262 [info ] [MainThread]: Done. PASS=14 WARN=0 ERROR=1 SKIP=0 TOTAL=15
[0m13:39:33.553022 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 5.4096155, "process_user_time": 1.86549, "process_kernel_time": 0.243426, "process_mem_max_rss": "140443648", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m13:39:33.553352 [debug] [MainThread]: Command `dbt run` failed at 13:39:33.553280 after 5.41 seconds
[0m13:39:33.553581 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102c5a110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102d95d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102d5cd90>]}
[0m13:39:33.553798 [debug] [MainThread]: Flushing usage events
[0m13:41:27.314940 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109754c90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10979a6d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10979b250>]}


============================== 13:41:27.318112 | 078f9252-4336-4111-b7c9-7e780c13d282 ==============================
[0m13:41:27.318112 [info ] [MainThread]: Running with dbt=1.7.10
[0m13:41:27.318506 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m13:41:27.518641 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '078f9252-4336-4111-b7c9-7e780c13d282', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b3bf690>]}
[0m13:41:27.558525 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '078f9252-4336-4111-b7c9-7e780c13d282', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109773450>]}
[0m13:41:27.560079 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m13:41:27.570789 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m13:41:27.590156 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m13:41:27.590479 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m13:41:27.594458 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '078f9252-4336-4111-b7c9-7e780c13d282', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b7029d0>]}
[0m13:41:27.602069 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '078f9252-4336-4111-b7c9-7e780c13d282', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1097e5250>]}
[0m13:41:27.602387 [info ] [MainThread]: Found 15 models, 1 analysis, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m13:41:27.602611 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '078f9252-4336-4111-b7c9-7e780c13d282', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b32b690>]}
[0m13:41:27.603913 [info ] [MainThread]: 
[0m13:41:27.604380 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m13:41:27.605244 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m13:41:27.612312 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m13:41:27.612545 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m13:41:27.612719 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:41:28.123270 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 1.0 seconds
[0m13:41:28.126059 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m13:41:28.228948 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m13:41:28.236584 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m13:41:28.236911 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m13:41:28.237169 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:41:28.644617 [debug] [ThreadPool]: SQL status: SUCCESS 17 in 0.0 seconds
[0m13:41:28.646575 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m13:41:28.732847 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '078f9252-4336-4111-b7c9-7e780c13d282', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1097c3750>]}
[0m13:41:28.733583 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m13:41:28.733877 [info ] [MainThread]: 
[0m13:41:28.736534 [debug] [Thread-1 (]: Began running node model.rightmove_epc.stg_epc_certs
[0m13:41:28.736857 [debug] [Thread-2 (]: Began running node model.rightmove_epc.stg_rightmove
[0m13:41:28.737255 [info ] [Thread-1 (]: 1 of 15 START sql view model dbt_melissa_rm_epc.stg_epc_certs .................. [RUN]
[0m13:41:28.737629 [info ] [Thread-2 (]: 2 of 15 START sql view model dbt_melissa_rm_epc.stg_rightmove .................. [RUN]
[0m13:41:28.738187 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.stg_epc_certs)
[0m13:41:28.738740 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.stg_rightmove'
[0m13:41:28.739026 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.stg_epc_certs
[0m13:41:28.739289 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.stg_rightmove
[0m13:41:28.743403 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.stg_rightmove"
[0m13:41:28.748429 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.stg_epc_certs"
[0m13:41:28.749202 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (compile): 13:41:28.741250 => 13:41:28.749035
[0m13:41:28.749495 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (compile): 13:41:28.739467 => 13:41:28.749340
[0m13:41:28.749758 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.stg_rightmove
[0m13:41:28.750025 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.stg_epc_certs
[0m13:41:28.797247 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.stg_rightmove"
[0m13:41:28.799117 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.stg_epc_certs"
[0m13:41:28.800116 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.stg_epc_certs"
[0m13:41:28.800673 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.stg_rightmove"
[0m13:41:28.800934 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_epc_certs"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
  
   as (
    WITH epc_certs as (
    
    select 
    UPRN,
    LODGEMENT_DATE,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
   -- COUNTY,
    LOCAL_AUTHORITY as LOCAL_AUTHORITY_CODE,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    UPPER(CASE WHEN (UPPER(ADDRESS1) LIKE 'FLAT%' OR UPPER(ADDRESS1) LIKE 'UNIT%') or UPPER(ADDRESS1) LIKE 'ROOM%' 
    THEN TRIM(REPLACE(REPLACE(CONCAT(ADDRESS),','),' '))
    ELSE trim(replace(replace(ADDRESS1,' '),',')) END) AS ADDRESSID,
    CASE WHEN UPRN is null and addressid is null THEN 1 else 0 end as REMOVE_FROM_RM_MATCH,
    FLOOR_LEVEL,
    FLAT_TOP_STOREY,
    FLAT_STOREY_COUNT,
    PROPERTY_TYPE
 from  RAW.EPC_TEST_DATA.EPC_CERTIFICATES 

)

SELECT * FROM epc_certs
  );
[0m13:41:28.801205 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_rightmove"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
  
   as (
    with rm as (

    SELECT 
    LISTING_ID,
    CHANGE_DATE,
    UPPER(TRIM(replace(REPLACE(CONCAT(ADDRESS_1::VARCHAR,ADDRESS_2::VARCHAR),' '),','))) AS ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, 
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    BEDROOM,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
 --   STUDENTLET_FLAG,
    COMBINED_PROPERTY_TYPE
    -- property type
    FROM 
       ANALYTICS.RIGHTMOVE_PROD.CLEAN_RAW_RIGHTMOVE_DATA 

 
)

SELECT * FROM rm
  );
[0m13:41:28.801425 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:41:28.801609 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m13:41:29.397868 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:41:29.398705 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:41:29.418069 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (execute): 13:41:28.797457 => 13:41:29.417904
[0m13:41:29.419925 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (execute): 13:41:28.750180 => 13:41:29.419780
[0m13:41:29.420258 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: Close
[0m13:41:29.420568 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: Close
[0m13:41:29.624755 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '078f9252-4336-4111-b7c9-7e780c13d282', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b4b29d0>]}
[0m13:41:29.625725 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '078f9252-4336-4111-b7c9-7e780c13d282', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b5eb690>]}
[0m13:41:29.626556 [info ] [Thread-1 (]: 1 of 15 OK created sql view model dbt_melissa_rm_epc.stg_epc_certs ............. [[32mSUCCESS 1[0m in 0.89s]
[0m13:41:29.627344 [info ] [Thread-2 (]: 2 of 15 OK created sql view model dbt_melissa_rm_epc.stg_rightmove ............. [[32mSUCCESS 1[0m in 0.89s]
[0m13:41:29.628053 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.stg_epc_certs
[0m13:41:29.628614 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.stg_rightmove
[0m13:41:29.629693 [debug] [Thread-4 (]: Began running node model.rightmove_epc.dim_addressid
[0m13:41:29.630124 [debug] [Thread-3 (]: Began running node model.rightmove_epc.dim_uprn
[0m13:41:29.630554 [debug] [Thread-1 (]: Began running node model.rightmove_epc.latest_epc_urn
[0m13:41:29.630977 [info ] [Thread-4 (]: 3 of 15 START sql view model dbt_melissa_rm_epc.dim_addressid .................. [RUN]
[0m13:41:29.631413 [debug] [Thread-2 (]: Began running node model.rightmove_epc.latest_rm_urn
[0m13:41:29.631810 [info ] [Thread-3 (]: 4 of 15 START sql view model dbt_melissa_rm_epc.dim_uprn ....................... [RUN]
[0m13:41:29.632235 [info ] [Thread-1 (]: 5 of 15 START sql view model dbt_melissa_rm_epc.latest_epc_urn ................. [RUN]
[0m13:41:29.632964 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_addressid'
[0m13:41:29.633385 [info ] [Thread-2 (]: 6 of 15 START sql view model dbt_melissa_rm_epc.latest_rm_urn .................. [RUN]
[0m13:41:29.634109 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_uprn'
[0m13:41:29.634692 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_epc_certs, now model.rightmove_epc.latest_epc_urn)
[0m13:41:29.635040 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.dim_addressid
[0m13:41:29.635733 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_rightmove, now model.rightmove_epc.latest_rm_urn)
[0m13:41:29.636144 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.dim_uprn
[0m13:41:29.636509 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.latest_epc_urn
[0m13:41:29.639714 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.dim_addressid"
[0m13:41:29.640123 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.latest_rm_urn
[0m13:41:29.642791 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.dim_uprn"
[0m13:41:29.644922 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.latest_epc_urn"
[0m13:41:29.647175 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.latest_rm_urn"
[0m13:41:29.648003 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_addressid (compile): 13:41:29.636723 => 13:41:29.647812
[0m13:41:29.648569 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.dim_uprn (compile): 13:41:29.640360 => 13:41:29.648423
[0m13:41:29.648839 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.dim_addressid
[0m13:41:29.649297 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.latest_epc_urn (compile): 13:41:29.643057 => 13:41:29.649019
[0m13:41:29.649699 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.dim_uprn
[0m13:41:29.649987 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.latest_rm_urn (compile): 13:41:29.645213 => 13:41:29.649850
[0m13:41:29.652557 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.dim_addressid"
[0m13:41:29.652874 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.latest_epc_urn
[0m13:41:29.655006 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.dim_uprn"
[0m13:41:29.655271 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.latest_rm_urn
[0m13:41:29.658976 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.latest_epc_urn"
[0m13:41:29.661377 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.latest_rm_urn"
[0m13:41:29.662118 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.dim_addressid"
[0m13:41:29.662944 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.dim_uprn"
[0m13:41:29.663253 [debug] [Thread-4 (]: On model.rightmove_epc.dim_addressid: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_addressid"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE ADDRESS'

with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource,
    POSTCODE

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    where REMOVE_FROM_RM_MATCH = 0
    AND ADDRESSID IS NOT NULL

),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    WHERE ADDRESSID IS NOT NULL

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where addressid is not null
  );
[0m13:41:29.663599 [debug] [Thread-3 (]: On model.rightmove_epc.dim_uprn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_uprn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE UPRNS


with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource,
    POSTCODE
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    where REMOVE_FROM_RM_MATCH = 0
    AND UPRN IS NOT NULL
),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    WHERE UPRN IS NOT NULL

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where uprn is not null
  );
[0m13:41:29.664177 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.latest_epc_urn"
[0m13:41:29.664403 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m13:41:29.664947 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.latest_rm_urn"
[0m13:41:29.665171 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m13:41:29.665410 [debug] [Thread-1 (]: On model.rightmove_epc.latest_epc_urn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.latest_epc_urn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn
  
   as (
    with epc_max_date as (

    select uprn as UPRN_EPC,
    MAX(LODGEMENT_DATE) AS MAX_LODGEMENT_DATE,
    from  ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    group by 1


),

latest_epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc
    inner join epc_max_date on epc.uprn = epc_max_date.UPRN_EPC
    where MAX_LODGEMENT_DATE = LODGEMENT_DATE
   -- and uprn = 200073066

)

select DISTINCT * from latest_epc

/*
select uprn, count(*) from latest_epc
group by 1
having count(*) >1
*/
  );
[0m13:41:29.666058 [debug] [Thread-2 (]: On model.rightmove_epc.latest_rm_urn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.latest_rm_urn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NOT NULL
),

change_date AS (
    SELECT 
        UPRN AS UPRN_CD, 
        MAX(CHANGE_DATE) AS MAX_CHANGE_DATE 
    FROM rm
    GROUP BY UPRN
),

rm_latest as (

    SELECT distinct * FROM rm
    LEFT JOIN change_date cd
    ON rm.UPRN = cd.UPRN_CD
    WHERE cd.MAX_CHANGE_DATE = rm.CHANGE_DATE 
 --  and UPRN = 100090588560
    
)

select DISTINCT * from rm_latest

/*
select uprn, count(*) from rm_latest
group by 1
having count(*) >1
*/
  );
[0m13:41:29.666998 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:41:29.667244 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m13:41:30.182253 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:41:30.184980 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.dim_uprn (execute): 13:41:29.653091 => 13:41:30.184785
[0m13:41:30.185371 [debug] [Thread-3 (]: On model.rightmove_epc.dim_uprn: Close
[0m13:41:30.194164 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:41:30.196626 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.latest_rm_urn (execute): 13:41:29.659324 => 13:41:30.196418
[0m13:41:30.196963 [debug] [Thread-2 (]: On model.rightmove_epc.latest_rm_urn: Close
[0m13:41:30.203226 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:41:30.205292 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.latest_epc_urn (execute): 13:41:29.655558 => 13:41:30.205133
[0m13:41:30.205605 [debug] [Thread-1 (]: On model.rightmove_epc.latest_epc_urn: Close
[0m13:41:30.400118 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '078f9252-4336-4111-b7c9-7e780c13d282', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b60c950>]}
[0m13:41:30.400953 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '078f9252-4336-4111-b7c9-7e780c13d282', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b359b10>]}
[0m13:41:30.401632 [info ] [Thread-1 (]: 5 of 15 OK created sql view model dbt_melissa_rm_epc.latest_epc_urn ............ [[32mSUCCESS 1[0m in 0.77s]
[0m13:41:30.402156 [info ] [Thread-2 (]: 6 of 15 OK created sql view model dbt_melissa_rm_epc.latest_rm_urn ............. [[32mSUCCESS 1[0m in 0.77s]
[0m13:41:30.402751 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.latest_epc_urn
[0m13:41:30.403238 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.latest_rm_urn
[0m13:41:30.422854 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:41:30.425214 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_addressid (execute): 13:41:29.650171 => 13:41:30.425042
[0m13:41:30.425521 [debug] [Thread-4 (]: On model.rightmove_epc.dim_addressid: Close
[0m13:41:30.463251 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '078f9252-4336-4111-b7c9-7e780c13d282', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b680550>]}
[0m13:41:30.463787 [info ] [Thread-3 (]: 4 of 15 OK created sql view model dbt_melissa_rm_epc.dim_uprn .................. [[32mSUCCESS 1[0m in 0.83s]
[0m13:41:30.464252 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.dim_uprn
[0m13:41:30.464783 [debug] [Thread-1 (]: Began running node model.rightmove_epc.no_uprn_match
[0m13:41:30.465124 [debug] [Thread-2 (]: Began running node model.rightmove_epc.uprn_match
[0m13:41:30.465463 [info ] [Thread-1 (]: 7 of 15 START sql view model dbt_melissa_rm_epc.no_uprn_match .................. [RUN]
[0m13:41:30.465818 [info ] [Thread-2 (]: 8 of 15 START sql view model dbt_melissa_rm_epc.uprn_match ..................... [RUN]
[0m13:41:30.466356 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.latest_epc_urn, now model.rightmove_epc.no_uprn_match)
[0m13:41:30.466852 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.latest_rm_urn, now model.rightmove_epc.uprn_match)
[0m13:41:30.467141 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.no_uprn_match
[0m13:41:30.467411 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.uprn_match
[0m13:41:30.470617 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.uprn_match"
[0m13:41:30.473079 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.no_uprn_match"
[0m13:41:30.473689 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.uprn_match (compile): 13:41:30.468212 => 13:41:30.473527
[0m13:41:30.474009 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.no_uprn_match (compile): 13:41:30.467582 => 13:41:30.473853
[0m13:41:30.474264 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.uprn_match
[0m13:41:30.474581 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.no_uprn_match
[0m13:41:30.477267 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.uprn_match"
[0m13:41:30.479605 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.no_uprn_match"
[0m13:41:30.480625 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.uprn_match"
[0m13:41:30.481302 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.no_uprn_match"
[0m13:41:30.481624 [debug] [Thread-2 (]: On model.rightmove_epc.uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
  
   as (
    with rm_latest as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn
    where UPRN IS NOT NULL
),

epc_uprn as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
    where datasource = 'EPC'
)


SELECT rm_latest.*,
CASE WHEN epc_uprn.UPRN is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_uprn.UPRN AS EPC_UPRN,
epc_uprn.ADDRESSID AS EPC_ADDRESSID


FROM rm_latest
LEFT JOIN epc_uprn
ON rm_latest.UPRN = epc_uprn.UPRN

WHERE MATCH_EPC = 'YES'
  );
[0m13:41:30.481936 [debug] [Thread-1 (]: On model.rightmove_epc.no_uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.no_uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.no_uprn_match
  
   as (
    with rm_latest as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn 
    where UPRN IS NOT NULL
),

epc_uprn as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
    where datasource = 'EPC'
)


SELECT rm_latest.*,
CASE WHEN epc_uprn.UPRN is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_uprn.UPRN AS EPC_UPRN,
epc_uprn.ADDRESSID AS EPC_ADDRESSID


FROM rm_latest
LEFT JOIN epc_uprn
ON rm_latest.UPRN = epc_uprn.UPRN

WHERE MATCH_EPC = 'NO'
  );
[0m13:41:30.482279 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m13:41:30.482568 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:41:30.507763 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '078f9252-4336-4111-b7c9-7e780c13d282', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b39f450>]}
[0m13:41:30.508365 [info ] [Thread-4 (]: 3 of 15 OK created sql view model dbt_melissa_rm_epc.dim_addressid ............. [[32mSUCCESS 1[0m in 0.88s]
[0m13:41:30.509248 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.dim_addressid
[0m13:41:30.509727 [debug] [Thread-3 (]: Began running node model.rightmove_epc.address_match
[0m13:41:30.510002 [info ] [Thread-3 (]: 9 of 15 START sql view model dbt_melissa_rm_epc.address_match .................. [RUN]
[0m13:41:30.510412 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.dim_uprn, now model.rightmove_epc.address_match)
[0m13:41:30.510629 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.address_match
[0m13:41:30.512477 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.address_match"
[0m13:41:30.512964 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.address_match (compile): 13:41:30.510757 => 13:41:30.512843
[0m13:41:30.513172 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.address_match
[0m13:41:30.515437 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.address_match"
[0m13:41:30.516309 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.address_match"
[0m13:41:30.516553 [debug] [Thread-3 (]: On model.rightmove_epc.address_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.address_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NULL

),

epc_address as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
    where datasource = 'EPC'
)


SELECT rm.*,
CASE WHEN epc_address.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_address.ADDRESSID AS EPC_ADDRESSID,
epc_address.UPRN AS EPC_UPRN


FROM rm
LEFT JOIN epc_address
ON rm.addressid = epc_address.addressid
and rm.FULL_POSTCODE = epc_address.POSTCODE
  );
[0m13:41:30.516777 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m13:41:31.036927 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:41:31.040044 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.no_uprn_match (execute): 13:41:30.477502 => 13:41:31.039816
[0m13:41:31.040478 [debug] [Thread-1 (]: On model.rightmove_epc.no_uprn_match: Close
[0m13:41:31.088761 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:41:31.093502 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.address_match (execute): 13:41:30.513294 => 13:41:31.093235
[0m13:41:31.094013 [debug] [Thread-3 (]: On model.rightmove_epc.address_match: Close
[0m13:41:31.131848 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '078f9252-4336-4111-b7c9-7e780c13d282', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b8bead0>]}
[0m13:41:31.132520 [info ] [Thread-1 (]: 7 of 15 OK created sql view model dbt_melissa_rm_epc.no_uprn_match ............. [[32mSUCCESS 1[0m in 0.67s]
[0m13:41:31.133052 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.no_uprn_match
[0m13:41:31.133548 [debug] [Thread-4 (]: Began running node model.rightmove_epc.uprn_address_match
[0m13:41:31.133975 [info ] [Thread-4 (]: 10 of 15 START sql view model dbt_melissa_rm_epc.uprn_address_match ............ [RUN]
[0m13:41:31.134849 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.dim_addressid, now model.rightmove_epc.uprn_address_match)
[0m13:41:31.135410 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:41:31.135707 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.uprn_address_match
[0m13:41:31.137768 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.uprn_match (execute): 13:41:30.474791 => 13:41:31.137608
[0m13:41:31.140612 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.uprn_address_match"
[0m13:41:31.140996 [debug] [Thread-2 (]: On model.rightmove_epc.uprn_match: Close
[0m13:41:31.143274 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.uprn_address_match (compile): 13:41:31.137969 => 13:41:31.143055
[0m13:41:31.143605 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.uprn_address_match
[0m13:41:31.147519 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.uprn_address_match"
[0m13:41:31.149415 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.uprn_address_match"
[0m13:41:31.149775 [debug] [Thread-4 (]: On model.rightmove_epc.uprn_address_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.uprn_address_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_address_match
  
   as (
    -- where uprn is not matched we try address.

with uprn as (

    select 
    up.LISTING_ID,
    CHANGE_DATE,
    up.ADDRESSID,
    up.ADDRESS_1,
    up.ADDRESS_2,
    FULL_POSTCODE,
    up.UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    BEDROOM,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
 -- need to sleect the same fields as address match
    CASE WHEN ad.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC,
    ad.ADDRESSID AS EPC_ADDRESSID,
    ad.UPRN AS EPC_UPRN

     from ANALYTICS_DEV.dbt_melissa_rm_epc.no_uprn_match up
    left join ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid ad on up.ADDRESSID = ad.ADDRESSID
    and up.FULL_POSTCODE = ad.POSTCODE
   
)

SELECT * FROM UPRN
  );
[0m13:41:31.150047 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m13:41:31.194756 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '078f9252-4336-4111-b7c9-7e780c13d282', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10be5d210>]}
[0m13:41:31.195256 [info ] [Thread-3 (]: 9 of 15 OK created sql view model dbt_melissa_rm_epc.address_match ............. [[32mSUCCESS 1[0m in 0.68s]
[0m13:41:31.195626 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.address_match
[0m13:41:31.253035 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '078f9252-4336-4111-b7c9-7e780c13d282', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10be5da90>]}
[0m13:41:31.253582 [info ] [Thread-2 (]: 8 of 15 OK created sql view model dbt_melissa_rm_epc.uprn_match ................ [[32mSUCCESS 1[0m in 0.79s]
[0m13:41:31.253947 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.uprn_match
[0m13:41:31.254340 [debug] [Thread-1 (]: Began running node model.rightmove_epc.flats_report
[0m13:41:31.254615 [debug] [Thread-3 (]: Began running node model.rightmove_epc.houses_report
[0m13:41:31.254857 [info ] [Thread-1 (]: 11 of 15 START sql view model dbt_melissa_rm_epc.flats_report .................. [RUN]
[0m13:41:31.255192 [info ] [Thread-3 (]: 12 of 15 START sql view model dbt_melissa_rm_epc.houses_report ................. [RUN]
[0m13:41:31.259044 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.no_uprn_match, now model.rightmove_epc.flats_report)
[0m13:41:31.259466 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.address_match, now model.rightmove_epc.houses_report)
[0m13:41:31.259760 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.flats_report
[0m13:41:31.259982 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.houses_report
[0m13:41:31.262542 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.flats_report"
[0m13:41:31.265032 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.houses_report"
[0m13:41:31.265621 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.flats_report (compile): 13:41:31.260116 => 13:41:31.265486
[0m13:41:31.265881 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.flats_report
[0m13:41:31.266179 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.houses_report (compile): 13:41:31.262820 => 13:41:31.266009
[0m13:41:31.268479 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.flats_report"
[0m13:41:31.268737 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.houses_report
[0m13:41:31.270590 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.houses_report"
[0m13:41:31.271967 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.flats_report"
[0m13:41:31.272280 [debug] [Thread-1 (]: On model.rightmove_epc.flats_report: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.flats_report"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.flats_report
  
   as (
    with house_addmatch as (

    select 
    distinct
    --count(LISTING_ID) as TOTAL_LISTINGS,
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN, -- NULL
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
 --   am.FLOOR_LEVEL as RM_FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    epc.ADDRESSID AS EPC_ADDRESSID,
    -- REMOVE_FROM_RM_MATCH,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

     from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc on am.EPC_ADDRESSID = epc.ADDRESSID
    and am.FULL_POSTCODE = epc.POSTCODE
    where MATCH_EPC = 'YES'
    and COMBINED_PROPERTY_TYPE in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')

),

house_uprnmatch as (

    select 
    distinct
    --count(LISTING_ID) as TOTAL_LISTINGS,
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN, -- NULL
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
  --  am.FLOOR_LEVEL as RM_FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    epc.ADDRESSID AS EPC_ADDRESSID,
    -- REMOVE_FROM_RM_MATCH,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

    

    from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn epc on am.EPC_UPRN = epc.UPRN

    where MATCH_EPC = 'YES'
   and COMBINED_PROPERTY_TYPE in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')
  -- AND RM_UPRN = 100030719363

)


select 'UPRN' as MATCH_TYPE, * from house_uprnmatch

union all

select 'ADDRESSID' as MATCH_TYPE, * from house_addmatch

/*
--THIS IS USED FOR A TEST
select RM_UPRN,COUNT(BUILDING_REFERENCE_NUMBER)
from house_uprnmatch
WHERE RM_UPRN IS NOT NULL
GROUP BY 1
HAVING COUNT(BUILDING_REFERENCE_NUMBER) >1
*/
  );
[0m13:41:31.272572 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:41:31.273846 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.houses_report"
[0m13:41:31.274630 [debug] [Thread-3 (]: On model.rightmove_epc.houses_report: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.houses_report"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.houses_report
  
   as (
    with house_addmatch as (

    select 
    distinct
    --count(LISTING_ID) as TOTAL_LISTINGS,
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN, -- NULL
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
 --   am.FLOOR_LEVEL as RM_FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    epc.ADDRESSID AS EPC_ADDRESSID,
    -- REMOVE_FROM_RM_MATCH,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

     from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc on am.EPC_ADDRESSID = epc.ADDRESSID
    and am.FULL_POSTCODE = epc.POSTCODE
    where MATCH_EPC = 'YES'
    and COMBINED_PROPERTY_TYPE not in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')

),

house_uprnmatch as (

    select 
    distinct
    --count(LISTING_ID) as TOTAL_LISTINGS,
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN, -- NULL
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
  --  am.FLOOR_LEVEL as RM_FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    epc.ADDRESSID AS EPC_ADDRESSID,
    -- REMOVE_FROM_RM_MATCH,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

    

    from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn epc on am.EPC_UPRN = epc.UPRN

    where MATCH_EPC = 'YES'
    and COMBINED_PROPERTY_TYPE not in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')
  -- AND RM_UPRN = 100030719363

)


select 'UPRN' as MATCH_TYPE, * from house_uprnmatch

union all

select 'ADDRESSID' as MATCH_TYPE, * from house_addmatch

/*
--THIS IS USED FOR A TEST
select RM_UPRN,COUNT(BUILDING_REFERENCE_NUMBER)
from house_uprnmatch
WHERE RM_UPRN IS NOT NULL
GROUP BY 1
HAVING COUNT(BUILDING_REFERENCE_NUMBER) >1
*/
  );
[0m13:41:31.275144 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m13:41:31.809762 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:41:31.812242 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.uprn_address_match (execute): 13:41:31.143775 => 13:41:31.812063
[0m13:41:31.812588 [debug] [Thread-4 (]: On model.rightmove_epc.uprn_address_match: Close
[0m13:41:32.010852 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:41:32.015351 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.flats_report (execute): 13:41:31.266352 => 13:41:32.015031
[0m13:41:32.016214 [debug] [Thread-1 (]: On model.rightmove_epc.flats_report: Close
[0m13:41:32.070452 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '078f9252-4336-4111-b7c9-7e780c13d282', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b645b90>]}
[0m13:41:32.071117 [info ] [Thread-4 (]: 10 of 15 OK created sql view model dbt_melissa_rm_epc.uprn_address_match ....... [[32mSUCCESS 1[0m in 0.94s]
[0m13:41:32.071668 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.uprn_address_match
[0m13:41:32.072221 [debug] [Thread-2 (]: Began running node model.rightmove_epc.rm_all_matches
[0m13:41:32.072597 [debug] [Thread-4 (]: Began running node model.rightmove_epc.rm_no_matches
[0m13:41:32.073028 [info ] [Thread-2 (]: 13 of 15 START sql view model dbt_melissa_rm_epc.rm_all_matches ................ [RUN]
[0m13:41:32.073514 [info ] [Thread-4 (]: 14 of 15 START sql view model dbt_melissa_rm_epc.rm_no_matches ................. [RUN]
[0m13:41:32.074184 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.uprn_match, now model.rightmove_epc.rm_all_matches)
[0m13:41:32.074755 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.uprn_address_match, now model.rightmove_epc.rm_no_matches)
[0m13:41:32.075103 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.rm_all_matches
[0m13:41:32.075392 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.rm_no_matches
[0m13:41:32.078560 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.rm_all_matches"
[0m13:41:32.081299 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.rm_no_matches"
[0m13:41:32.082047 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.rm_no_matches (compile): 13:41:32.078786 => 13:41:32.081858
[0m13:41:32.082400 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.rm_all_matches (compile): 13:41:32.075569 => 13:41:32.082231
[0m13:41:32.082727 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.rm_no_matches
[0m13:41:32.083025 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.rm_all_matches
[0m13:41:32.085406 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.rm_no_matches"
[0m13:41:32.087724 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.rm_all_matches"
[0m13:41:32.089334 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.rm_no_matches"
[0m13:41:32.090528 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.rm_all_matches"
[0m13:41:32.090881 [debug] [Thread-4 (]: On model.rightmove_epc.rm_no_matches: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.rm_no_matches"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.rm_no_matches
  
   as (
    with addr as (

    select 
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    '' AS EPC_UPRN,
    EPC_ADDRESSID
    
    from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
    where MATCH_EPC = 'NO' 
),

uprn as (

    select 
    
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN::VARCHAR AS EPC_UPRN,
    EPC_ADDRESSID
    
     from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'NO'
),

uprn_address as (

        select 
    
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN::VARCHAR AS EPC_UPRN,
    EPC_ADDRESSID
    
     from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_address_match
    where MATCH_EPC = 'NO'
),

final as (

select 'NO ADDRESS MATCH' AS MATCH_RESULT, * from addr
union all
select 'NO UPRN MATCH' AS MATCH_RESULT, * from uprn
union select 'NO ADDRESS OR UPRN MATCH ' AS MATCH_RESULT, * from uprn

)

select * from final
  );
[0m13:41:32.091267 [debug] [Thread-2 (]: On model.rightmove_epc.rm_all_matches: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.rm_all_matches"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.rm_all_matches
  
   as (
    with addr as (

    select 
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN,
    EPC_ADDRESSID
    
    from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
    where MATCH_EPC = 'YES' 
),

uprn_addr as (

    select 
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN,
    EPC_ADDRESSID
    
    from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_address_match
    where MATCH_EPC = 'YES' 
),

uprn as (

    select 
    
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN::VARCHAR AS EPC_UPRN,
    EPC_ADDRESSID

    from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'YES'
),

final as (

select 'ADDRESS AND POSTCODE MATCH' AS MATCH_RESULT, * from addr
union all
select 'UPRN MATCH' AS MATCH_RESULT, * from uprn
union all
select 'MATCH ADDRESS NO MATCH TO EPC UPRN' AS MATCH_RESULT, * from uprn
)

select * from final
  );
[0m13:41:32.091563 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m13:41:32.091790 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m13:41:32.119595 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '078f9252-4336-4111-b7c9-7e780c13d282', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b961d50>]}
[0m13:41:32.120094 [info ] [Thread-1 (]: 11 of 15 OK created sql view model dbt_melissa_rm_epc.flats_report ............. [[32mSUCCESS 1[0m in 0.86s]
[0m13:41:32.120507 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.flats_report
[0m13:41:32.121262 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:41:32.123053 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.houses_report (execute): 13:41:31.268941 => 13:41:32.122921
[0m13:41:32.123305 [debug] [Thread-3 (]: On model.rightmove_epc.houses_report: Close
[0m13:41:32.196658 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '078f9252-4336-4111-b7c9-7e780c13d282', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b6cbe50>]}
[0m13:41:32.197205 [info ] [Thread-3 (]: 12 of 15 OK created sql view model dbt_melissa_rm_epc.houses_report ............ [[32mSUCCESS 1[0m in 0.94s]
[0m13:41:32.200506 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.houses_report
[0m13:41:32.200876 [debug] [Thread-1 (]: Began running node model.rightmove_epc.zero_bedrooms
[0m13:41:32.201206 [info ] [Thread-1 (]: 15 of 15 START sql view model dbt_melissa_rm_epc.zero_bedrooms ................. [RUN]
[0m13:41:32.201606 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.flats_report, now model.rightmove_epc.zero_bedrooms)
[0m13:41:32.201814 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.zero_bedrooms
[0m13:41:32.204017 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.zero_bedrooms"
[0m13:41:32.204631 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.zero_bedrooms (compile): 13:41:32.201942 => 13:41:32.204491
[0m13:41:32.204882 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.zero_bedrooms
[0m13:41:32.208090 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.zero_bedrooms"
[0m13:41:32.208819 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.zero_bedrooms"
[0m13:41:32.209054 [debug] [Thread-1 (]: On model.rightmove_epc.zero_bedrooms: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.zero_bedrooms"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.zero_bedrooms
  
   as (
    with houses as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.houses_report
    where BEDROOM = 0
),

flats as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.flats_report
        where BEDROOM = 0

)

select * from flats
union all
select * from houses
  );
[0m13:41:32.209263 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:41:32.922758 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:41:32.925595 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.rm_no_matches (execute): 13:41:32.083183 => 13:41:32.925365
[0m13:41:32.926387 [debug] [Thread-4 (]: On model.rightmove_epc.rm_no_matches: Close
[0m13:41:32.927167 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:41:32.930311 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.rm_all_matches (execute): 13:41:32.085582 => 13:41:32.930132
[0m13:41:32.931002 [debug] [Thread-2 (]: On model.rightmove_epc.rm_all_matches: Close
[0m13:41:33.007934 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '078f9252-4336-4111-b7c9-7e780c13d282', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10be9d8d0>]}
[0m13:41:33.008613 [info ] [Thread-2 (]: 13 of 15 OK created sql view model dbt_melissa_rm_epc.rm_all_matches ........... [[32mSUCCESS 1[0m in 0.93s]
[0m13:41:33.009131 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.rm_all_matches
[0m13:41:33.018161 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '078f9252-4336-4111-b7c9-7e780c13d282', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10beacf90>]}
[0m13:41:33.018753 [info ] [Thread-4 (]: 14 of 15 OK created sql view model dbt_melissa_rm_epc.rm_no_matches ............ [[32mSUCCESS 1[0m in 0.94s]
[0m13:41:33.019293 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.rm_no_matches
[0m13:41:33.269633 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:41:33.275854 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.zero_bedrooms (execute): 13:41:32.205013 => 13:41:33.275557
[0m13:41:33.276487 [debug] [Thread-1 (]: On model.rightmove_epc.zero_bedrooms: Close
[0m13:41:33.360057 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '078f9252-4336-4111-b7c9-7e780c13d282', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b85f410>]}
[0m13:41:33.360623 [info ] [Thread-1 (]: 15 of 15 OK created sql view model dbt_melissa_rm_epc.zero_bedrooms ............ [[32mSUCCESS 1[0m in 1.16s]
[0m13:41:33.361050 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.zero_bedrooms
[0m13:41:33.362316 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:41:33.362552 [debug] [MainThread]: Connection 'model.rightmove_epc.zero_bedrooms' was properly closed.
[0m13:41:33.362746 [debug] [MainThread]: Connection 'model.rightmove_epc.rm_all_matches' was properly closed.
[0m13:41:33.362929 [debug] [MainThread]: Connection 'model.rightmove_epc.rm_no_matches' was properly closed.
[0m13:41:33.363108 [debug] [MainThread]: Connection 'model.rightmove_epc.houses_report' was properly closed.
[0m13:41:33.363379 [info ] [MainThread]: 
[0m13:41:33.363606 [info ] [MainThread]: Finished running 15 view models in 0 hours 0 minutes and 5.76 seconds (5.76s).
[0m13:41:33.365003 [debug] [MainThread]: Command end result
[0m13:41:33.372067 [info ] [MainThread]: 
[0m13:41:33.372345 [info ] [MainThread]: [32mCompleted successfully[0m
[0m13:41:33.372554 [info ] [MainThread]: 
[0m13:41:33.372762 [info ] [MainThread]: Done. PASS=15 WARN=0 ERROR=0 SKIP=0 TOTAL=15
[0m13:41:33.374475 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 6.097224, "process_user_time": 1.886105, "process_kernel_time": 0.235227, "process_mem_max_rss": "138690560", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m13:41:33.374874 [debug] [MainThread]: Command `dbt run` succeeded at 13:41:33.374783 after 6.10 seconds
[0m13:41:33.375142 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102c92110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102c92190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102dcdd50>]}
[0m13:41:33.375392 [debug] [MainThread]: Flushing usage events
[0m13:51:47.264386 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110452a90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11045e250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11045edd0>]}


============================== 13:51:47.267266 | 1aa3857c-865c-4de2-a5b0-ce0a99d4b055 ==============================
[0m13:51:47.267266 [info ] [MainThread]: Running with dbt=1.7.10
[0m13:51:47.267639 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'profiles_dir': '/Users/melissabee/.dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m13:51:47.474136 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1aa3857c-865c-4de2-a5b0-ce0a99d4b055', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110453c90>]}
[0m13:51:47.516126 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1aa3857c-865c-4de2-a5b0-ce0a99d4b055', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110437250>]}
[0m13:51:47.517052 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m13:51:47.528339 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m13:51:47.556584 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m13:51:47.556877 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m13:51:47.560616 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1aa3857c-865c-4de2-a5b0-ce0a99d4b055', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1112a3290>]}
[0m13:51:47.569392 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1aa3857c-865c-4de2-a5b0-ce0a99d4b055', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110f3eb50>]}
[0m13:51:47.569675 [info ] [MainThread]: Found 16 models, 1 analysis, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m13:51:47.569904 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1aa3857c-865c-4de2-a5b0-ce0a99d4b055', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1104a1650>]}
[0m13:51:47.571167 [info ] [MainThread]: 
[0m13:51:47.571604 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m13:51:47.572525 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m13:51:47.579949 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m13:51:47.580251 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m13:51:47.580431 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m13:51:48.044914 [debug] [ThreadPool]: SQL status: SUCCESS 45 in 0.0 seconds
[0m13:51:48.047077 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m13:51:48.129630 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now create_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m13:51:48.130338 [debug] [ThreadPool]: Creating schema "database: "ANALYTICS_DEV"
schema: "dbt_melissa_rm_epc"
"
[0m13:51:48.134328 [debug] [ThreadPool]: Using snowflake connection "create_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m13:51:48.134599 [debug] [ThreadPool]: On create_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "create_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
create schema if not exists ANALYTICS_DEV.dbt_melissa_rm_epc
[0m13:51:48.134829 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:51:48.567722 [debug] [ThreadPool]: SQL status: SUCCESS 1 in 0.0 seconds
[0m13:51:48.568842 [debug] [ThreadPool]: On create_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m13:51:48.653081 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_ANALYTICS_DEV_dbt_melissa_rm_epc, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m13:51:48.660856 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m13:51:48.661155 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m13:51:48.661382 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m13:51:48.974316 [debug] [ThreadPool]: SQL status: SUCCESS 0 in 0.0 seconds
[0m13:51:48.975505 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m13:51:49.049115 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1aa3857c-865c-4de2-a5b0-ce0a99d4b055', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110dea7d0>]}
[0m13:51:49.049978 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m13:51:49.050302 [info ] [MainThread]: 
[0m13:51:49.053414 [debug] [Thread-1 (]: Began running node model.rightmove_epc.stg_epc_certs
[0m13:51:49.053818 [debug] [Thread-2 (]: Began running node model.rightmove_epc.stg_rightmove
[0m13:51:49.054199 [info ] [Thread-1 (]: 1 of 16 START sql view model dbt_melissa_rm_epc.stg_epc_certs .................. [RUN]
[0m13:51:49.054575 [info ] [Thread-2 (]: 2 of 16 START sql view model dbt_melissa_rm_epc.stg_rightmove .................. [RUN]
[0m13:51:49.090784 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.stg_epc_certs)
[0m13:51:49.091281 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.stg_rightmove'
[0m13:51:49.091514 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.stg_epc_certs
[0m13:51:49.091710 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.stg_rightmove
[0m13:51:49.095780 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.stg_epc_certs"
[0m13:51:49.097280 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.stg_rightmove"
[0m13:51:49.098203 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (compile): 13:51:49.095938 => 13:51:49.098067
[0m13:51:49.098496 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (compile): 13:51:49.091834 => 13:51:49.098352
[0m13:51:49.098717 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.stg_rightmove
[0m13:51:49.098928 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.stg_epc_certs
[0m13:51:49.113977 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.stg_rightmove"
[0m13:51:49.115768 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.stg_epc_certs"
[0m13:51:49.117297 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.stg_epc_certs"
[0m13:51:49.117849 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.stg_rightmove"
[0m13:51:49.118092 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_epc_certs"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
  
   as (
    WITH epc_certs as (
    
    select 
    UPRN,
    LODGEMENT_DATE,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
   -- COUNTY,
    LOCAL_AUTHORITY as LOCAL_AUTHORITY_CODE,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    UPPER(CASE WHEN (UPPER(ADDRESS1) LIKE 'FLAT%' OR UPPER(ADDRESS1) LIKE 'UNIT%') or UPPER(ADDRESS1) LIKE 'ROOM%' 
    THEN TRIM(REPLACE(REPLACE(CONCAT(ADDRESS),','),' '))
    ELSE trim(replace(replace(ADDRESS1,' '),',')) END) AS ADDRESSID,
    CASE WHEN UPRN is null and addressid is null THEN 1 else 0 end as REMOVE_FROM_RM_MATCH,
    FLOOR_LEVEL,
    FLAT_TOP_STOREY,
    FLAT_STOREY_COUNT,
    PROPERTY_TYPE
 from  RAW.EPC_TEST_DATA.EPC_CERTIFICATES 

)

SELECT * FROM epc_certs
  );
[0m13:51:49.118370 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_rightmove"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
  
   as (
    with rm as (

    SELECT 
    LISTING_ID,
    CHANGE_DATE,
    UPPER(TRIM(replace(REPLACE(CONCAT(ADDRESS_1::VARCHAR,ADDRESS_2::VARCHAR),' '),','))) AS ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, 
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    BEDROOM,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
 --   STUDENTLET_FLAG,
    COMBINED_PROPERTY_TYPE
    -- property type
    FROM 
       ANALYTICS.RIGHTMOVE_PROD.CLEAN_RAW_RIGHTMOVE_DATA 

 
)

SELECT * FROM rm
  );
[0m13:51:49.118598 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:51:49.118783 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m13:51:49.637026 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:51:49.638064 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:51:49.661739 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (execute): 13:51:49.099052 => 13:51:49.661541
[0m13:51:49.662679 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (execute): 13:51:49.114169 => 13:51:49.662498
[0m13:51:49.663091 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: Close
[0m13:51:49.663463 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: Close
[0m13:51:49.742442 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1aa3857c-865c-4de2-a5b0-ce0a99d4b055', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11045e790>]}
[0m13:51:49.743174 [info ] [Thread-2 (]: 2 of 16 OK created sql view model dbt_melissa_rm_epc.stg_rightmove ............. [[32mSUCCESS 1[0m in 0.65s]
[0m13:51:49.743744 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.stg_rightmove
[0m13:51:49.744311 [debug] [Thread-4 (]: Began running node model.rightmove_epc.latest_rm_urn
[0m13:51:49.745052 [info ] [Thread-4 (]: 3 of 16 START sql view model dbt_melissa_rm_epc.latest_rm_urn .................. [RUN]
[0m13:51:49.745776 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.rightmove_epc.latest_rm_urn'
[0m13:51:49.746081 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.latest_rm_urn
[0m13:51:49.748899 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.latest_rm_urn"
[0m13:51:49.749577 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1aa3857c-865c-4de2-a5b0-ce0a99d4b055', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1111eba10>]}
[0m13:51:49.750112 [info ] [Thread-1 (]: 1 of 16 OK created sql view model dbt_melissa_rm_epc.stg_epc_certs ............. [[32mSUCCESS 1[0m in 0.69s]
[0m13:51:49.750554 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.stg_epc_certs
[0m13:51:49.750979 [debug] [Thread-2 (]: Began running node model.rightmove_epc.dim_addressid
[0m13:51:49.751319 [info ] [Thread-2 (]: 4 of 16 START sql view model dbt_melissa_rm_epc.dim_addressid .................. [RUN]
[0m13:51:49.751664 [debug] [Thread-3 (]: Began running node model.rightmove_epc.dim_uprn
[0m13:51:49.752231 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_rightmove, now model.rightmove_epc.dim_addressid)
[0m13:51:49.752505 [debug] [Thread-1 (]: Began running node model.rightmove_epc.latest_epc_urn
[0m13:51:49.752824 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.latest_rm_urn (compile): 13:51:49.746263 => 13:51:49.752671
[0m13:51:49.753129 [info ] [Thread-3 (]: 5 of 16 START sql view model dbt_melissa_rm_epc.dim_uprn ....................... [RUN]
[0m13:51:49.753412 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.dim_addressid
[0m13:51:49.753708 [info ] [Thread-1 (]: 6 of 16 START sql view model dbt_melissa_rm_epc.latest_epc_urn ................. [RUN]
[0m13:51:49.753985 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.latest_rm_urn
[0m13:51:49.754506 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_uprn'
[0m13:51:49.757110 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.dim_addressid"
[0m13:51:49.757672 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_epc_certs, now model.rightmove_epc.latest_epc_urn)
[0m13:51:49.759896 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.latest_rm_urn"
[0m13:51:49.760149 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.dim_uprn
[0m13:51:49.760457 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.latest_epc_urn
[0m13:51:49.762477 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.dim_uprn"
[0m13:51:49.765955 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.latest_epc_urn"
[0m13:51:49.766719 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.latest_rm_urn"
[0m13:51:49.767091 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.dim_addressid (compile): 13:51:49.754672 => 13:51:49.766914
[0m13:51:49.767771 [debug] [Thread-4 (]: On model.rightmove_epc.latest_rm_urn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.latest_rm_urn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NOT NULL
),

change_date AS (
    SELECT 
        UPRN AS UPRN_CD, 
        MAX(CHANGE_DATE) AS MAX_CHANGE_DATE 
    FROM rm
    GROUP BY UPRN
),

rm_latest as (

    SELECT distinct * FROM rm
    LEFT JOIN change_date cd
    ON rm.UPRN = cd.UPRN_CD
    WHERE cd.MAX_CHANGE_DATE = rm.CHANGE_DATE 
 --  and UPRN = 100090588560
    
)

select DISTINCT * from rm_latest

/*
select uprn, count(*) from rm_latest
group by 1
having count(*) >1
*/
  );
[0m13:51:49.768124 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.dim_uprn (compile): 13:51:49.760678 => 13:51:49.767986
[0m13:51:49.768470 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.dim_addressid
[0m13:51:49.768755 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.latest_epc_urn (compile): 13:51:49.762808 => 13:51:49.768634
[0m13:51:49.769012 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m13:51:49.769285 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.dim_uprn
[0m13:51:49.771300 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.dim_addressid"
[0m13:51:49.771551 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.latest_epc_urn
[0m13:51:49.774193 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.dim_uprn"
[0m13:51:49.776422 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.latest_epc_urn"
[0m13:51:49.777430 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.dim_addressid"
[0m13:51:49.777888 [debug] [Thread-2 (]: On model.rightmove_epc.dim_addressid: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_addressid"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE ADDRESS'

with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource,
    POSTCODE

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    where REMOVE_FROM_RM_MATCH = 0
    AND ADDRESSID IS NOT NULL

),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    WHERE ADDRESSID IS NOT NULL

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where addressid is not null
  );
[0m13:51:49.778591 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.dim_uprn"
[0m13:51:49.778798 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m13:51:49.779313 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.latest_epc_urn"
[0m13:51:49.779573 [debug] [Thread-3 (]: On model.rightmove_epc.dim_uprn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_uprn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE UPRNS


with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource,
    POSTCODE
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    where REMOVE_FROM_RM_MATCH = 0
    AND UPRN IS NOT NULL
),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    WHERE UPRN IS NOT NULL

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where uprn is not null
  );
[0m13:51:49.780589 [debug] [Thread-1 (]: On model.rightmove_epc.latest_epc_urn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.latest_epc_urn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn
  
   as (
    with epc_max_date as (

    select uprn as UPRN_EPC,
    MAX(LODGEMENT_DATE) AS MAX_LODGEMENT_DATE,
    from  ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    group by 1


),

latest_epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc
    inner join epc_max_date on epc.uprn = epc_max_date.UPRN_EPC
    where MAX_LODGEMENT_DATE = LODGEMENT_DATE
   -- and uprn = 200073066

)

select DISTINCT * from latest_epc

/*
select uprn, count(*) from latest_epc
group by 1
having count(*) >1
*/
  );
[0m13:51:49.780847 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m13:51:49.781296 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:51:50.297894 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:51:50.300384 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.latest_rm_urn (execute): 13:51:49.757858 => 13:51:50.300187
[0m13:51:50.300767 [debug] [Thread-4 (]: On model.rightmove_epc.latest_rm_urn: Close
[0m13:51:50.303500 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:51:50.305847 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.latest_epc_urn (execute): 13:51:49.774510 => 13:51:50.305668
[0m13:51:50.306735 [debug] [Thread-1 (]: On model.rightmove_epc.latest_epc_urn: Close
[0m13:51:50.307467 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:51:50.310310 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.dim_addressid (execute): 13:51:49.769450 => 13:51:50.310140
[0m13:51:50.310882 [debug] [Thread-2 (]: On model.rightmove_epc.dim_addressid: Close
[0m13:51:50.350156 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:51:50.352305 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.dim_uprn (execute): 13:51:49.772367 => 13:51:50.352131
[0m13:51:50.352615 [debug] [Thread-3 (]: On model.rightmove_epc.dim_uprn: Close
[0m13:51:50.396877 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1aa3857c-865c-4de2-a5b0-ce0a99d4b055', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1111ab210>]}
[0m13:51:50.397430 [info ] [Thread-1 (]: 6 of 16 OK created sql view model dbt_melissa_rm_epc.latest_epc_urn ............ [[32mSUCCESS 1[0m in 0.64s]
[0m13:51:50.397847 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.latest_epc_urn
[0m13:51:50.462483 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1aa3857c-865c-4de2-a5b0-ce0a99d4b055', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110f3f290>]}
[0m13:51:50.463287 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1aa3857c-865c-4de2-a5b0-ce0a99d4b055', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1111ce4d0>]}
[0m13:51:50.463910 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1aa3857c-865c-4de2-a5b0-ce0a99d4b055', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110f02dd0>]}
[0m13:51:50.465322 [info ] [Thread-3 (]: 5 of 16 OK created sql view model dbt_melissa_rm_epc.dim_uprn .................. [[32mSUCCESS 1[0m in 0.71s]
[0m13:51:50.465862 [info ] [Thread-4 (]: 3 of 16 OK created sql view model dbt_melissa_rm_epc.latest_rm_urn ............. [[32mSUCCESS 1[0m in 0.72s]
[0m13:51:50.466300 [info ] [Thread-2 (]: 4 of 16 OK created sql view model dbt_melissa_rm_epc.dim_addressid ............. [[32mSUCCESS 1[0m in 0.71s]
[0m13:51:50.466767 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.dim_uprn
[0m13:51:50.467171 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.latest_rm_urn
[0m13:51:50.467556 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.dim_addressid
[0m13:51:50.468747 [debug] [Thread-1 (]: Began running node model.rightmove_epc.false_listings
[0m13:51:50.469127 [debug] [Thread-3 (]: Began running node model.rightmove_epc.no_uprn_match
[0m13:51:50.469607 [debug] [Thread-4 (]: Began running node model.rightmove_epc.uprn_match
[0m13:51:50.470103 [info ] [Thread-1 (]: 7 of 16 START sql table model dbt_melissa_rm_epc.false_listings ................ [RUN]
[0m13:51:50.470508 [debug] [Thread-2 (]: Began running node model.rightmove_epc.address_match
[0m13:51:50.470824 [info ] [Thread-3 (]: 8 of 16 START sql view model dbt_melissa_rm_epc.no_uprn_match .................. [RUN]
[0m13:51:50.471188 [info ] [Thread-4 (]: 9 of 16 START sql view model dbt_melissa_rm_epc.uprn_match ..................... [RUN]
[0m13:51:50.471753 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.latest_epc_urn, now model.rightmove_epc.false_listings)
[0m13:51:50.472076 [info ] [Thread-2 (]: 10 of 16 START sql view model dbt_melissa_rm_epc.address_match ................. [RUN]
[0m13:51:50.472595 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.dim_uprn, now model.rightmove_epc.no_uprn_match)
[0m13:51:50.473059 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.latest_rm_urn, now model.rightmove_epc.uprn_match)
[0m13:51:50.473349 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.false_listings
[0m13:51:50.473853 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.dim_addressid, now model.rightmove_epc.address_match)
[0m13:51:50.474150 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.no_uprn_match
[0m13:51:50.474423 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.uprn_match
[0m13:51:50.475375 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.address_match
[0m13:51:50.477797 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.no_uprn_match"
[0m13:51:50.479665 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.false_listings"
[0m13:51:50.481688 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.uprn_match"
[0m13:51:50.483415 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.address_match"
[0m13:51:50.484671 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.no_uprn_match (compile): 13:51:50.475546 => 13:51:50.484500
[0m13:51:50.485004 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.uprn_match (compile): 13:51:50.479888 => 13:51:50.484875
[0m13:51:50.485390 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.address_match (compile): 13:51:50.481869 => 13:51:50.485192
[0m13:51:50.485654 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.false_listings (compile): 13:51:50.474598 => 13:51:50.485534
[0m13:51:50.485917 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.no_uprn_match
[0m13:51:50.486258 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.uprn_match
[0m13:51:50.486598 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.address_match
[0m13:51:50.486901 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.false_listings
[0m13:51:50.489294 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.no_uprn_match"
[0m13:51:50.491490 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.uprn_match"
[0m13:51:50.493579 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.address_match"
[0m13:51:50.506713 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.false_listings"
[0m13:51:50.507654 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.uprn_match"
[0m13:51:50.508179 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.no_uprn_match"
[0m13:51:50.508413 [debug] [Thread-4 (]: On model.rightmove_epc.uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
  
   as (
    with rm_latest as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn
    where UPRN IS NOT NULL
),

epc_uprn as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
    where datasource = 'EPC'
)


SELECT rm_latest.*,
CASE WHEN epc_uprn.UPRN is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_uprn.UPRN AS EPC_UPRN,
epc_uprn.ADDRESSID AS EPC_ADDRESSID


FROM rm_latest
LEFT JOIN epc_uprn
ON rm_latest.UPRN = epc_uprn.UPRN

WHERE MATCH_EPC = 'YES'
  );
[0m13:51:50.508984 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.address_match"
[0m13:51:50.509248 [debug] [Thread-3 (]: On model.rightmove_epc.no_uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.no_uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.no_uprn_match
  
   as (
    with rm_latest as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn 
    where UPRN IS NOT NULL
),

epc_uprn as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
    where datasource = 'EPC'
)


SELECT rm_latest.*,
CASE WHEN epc_uprn.UPRN is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_uprn.UPRN AS EPC_UPRN,
epc_uprn.ADDRESSID AS EPC_ADDRESSID


FROM rm_latest
LEFT JOIN epc_uprn
ON rm_latest.UPRN = epc_uprn.UPRN

WHERE MATCH_EPC = 'NO'
  );
[0m13:51:50.509736 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.false_listings"
[0m13:51:50.509931 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m13:51:50.510149 [debug] [Thread-2 (]: On model.rightmove_epc.address_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.address_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NULL

),

epc_address as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
    where datasource = 'EPC'
)


SELECT rm.*,
CASE WHEN epc_address.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_address.ADDRESSID AS EPC_ADDRESSID,
epc_address.UPRN AS EPC_UPRN


FROM rm
LEFT JOIN epc_address
ON rm.addressid = epc_address.addressid
and rm.FULL_POSTCODE = epc_address.POSTCODE
  );
[0m13:51:50.510366 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m13:51:50.510572 [debug] [Thread-1 (]: On model.rightmove_epc.false_listings: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.false_listings"} */
create or replace transient table ANALYTICS_DEV.dbt_melissa_rm_epc.false_listings
         as
        (with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn

),

false_rm as (

    select 
    uprn,
    count(LISTING_ID) listing_count
    from rm
    group by 1
    having count(LISTING_ID) >1

),

get_false as (

    select rm.*

    from rm
    inner join false_rm
    on rm.uprn = false_rm.uprn

)

select * from get_false
        );
[0m13:51:50.511156 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m13:51:50.511973 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:51:51.033709 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:51:51.034405 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:51:51.036778 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.no_uprn_match (execute): 13:51:50.487092 => 13:51:51.036606
[0m13:51:51.038561 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.address_match (execute): 13:51:50.491729 => 13:51:51.038402
[0m13:51:51.038884 [debug] [Thread-3 (]: On model.rightmove_epc.no_uprn_match: Close
[0m13:51:51.039175 [debug] [Thread-2 (]: On model.rightmove_epc.address_match: Close
[0m13:51:51.103550 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:51:51.106205 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.uprn_match (execute): 13:51:50.489571 => 13:51:51.105978
[0m13:51:51.106625 [debug] [Thread-4 (]: On model.rightmove_epc.uprn_match: Close
[0m13:51:51.118583 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1aa3857c-865c-4de2-a5b0-ce0a99d4b055', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1114d3090>]}
[0m13:51:51.119233 [info ] [Thread-2 (]: 10 of 16 OK created sql view model dbt_melissa_rm_epc.address_match ............ [[32mSUCCESS 1[0m in 0.64s]
[0m13:51:51.119786 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.address_match
[0m13:51:51.127378 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1aa3857c-865c-4de2-a5b0-ce0a99d4b055', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111196750>]}
[0m13:51:51.128023 [info ] [Thread-3 (]: 8 of 16 OK created sql view model dbt_melissa_rm_epc.no_uprn_match ............. [[32mSUCCESS 1[0m in 0.65s]
[0m13:51:51.128508 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.no_uprn_match
[0m13:51:51.128979 [debug] [Thread-2 (]: Began running node model.rightmove_epc.uprn_address_match
[0m13:51:51.129337 [info ] [Thread-2 (]: 11 of 16 START sql view model dbt_melissa_rm_epc.uprn_address_match ............ [RUN]
[0m13:51:51.129853 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.address_match, now model.rightmove_epc.uprn_address_match)
[0m13:51:51.130120 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.uprn_address_match
[0m13:51:51.133030 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.uprn_address_match"
[0m13:51:51.134710 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.uprn_address_match (compile): 13:51:51.130282 => 13:51:51.134522
[0m13:51:51.135000 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.uprn_address_match
[0m13:51:51.137282 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.uprn_address_match"
[0m13:51:51.138235 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.uprn_address_match"
[0m13:51:51.138516 [debug] [Thread-2 (]: On model.rightmove_epc.uprn_address_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.uprn_address_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_address_match
  
   as (
    -- where uprn is not matched we try address.

with uprn as (

    select 
    up.LISTING_ID,
    CHANGE_DATE,
    up.ADDRESSID,
    up.ADDRESS_1,
    up.ADDRESS_2,
    FULL_POSTCODE,
    up.UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    BEDROOM,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
 -- need to sleect the same fields as address match
    CASE WHEN ad.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC,
    ad.ADDRESSID AS EPC_ADDRESSID,
    ad.UPRN AS EPC_UPRN

     from ANALYTICS_DEV.dbt_melissa_rm_epc.no_uprn_match up
    left join ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid ad on up.ADDRESSID = ad.ADDRESSID
    and up.FULL_POSTCODE = ad.POSTCODE
   
)

SELECT * FROM UPRN
  );
[0m13:51:51.138780 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m13:51:51.195804 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1aa3857c-865c-4de2-a5b0-ce0a99d4b055', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1112b7790>]}
[0m13:51:51.196304 [info ] [Thread-4 (]: 9 of 16 OK created sql view model dbt_melissa_rm_epc.uprn_match ................ [[32mSUCCESS 1[0m in 0.72s]
[0m13:51:51.196668 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.uprn_match
[0m13:51:51.197101 [debug] [Thread-3 (]: Began running node model.rightmove_epc.flats_report
[0m13:51:51.197405 [debug] [Thread-4 (]: Began running node model.rightmove_epc.houses_report
[0m13:51:51.197743 [info ] [Thread-3 (]: 12 of 16 START sql table model dbt_melissa_rm_epc.flats_report ................. [RUN]
[0m13:51:51.198091 [info ] [Thread-4 (]: 13 of 16 START sql table model dbt_melissa_rm_epc.houses_report ................ [RUN]
[0m13:51:51.198535 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.no_uprn_match, now model.rightmove_epc.flats_report)
[0m13:51:51.198936 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.uprn_match, now model.rightmove_epc.houses_report)
[0m13:51:51.199186 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.flats_report
[0m13:51:51.199427 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.houses_report
[0m13:51:51.202045 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.flats_report"
[0m13:51:51.204266 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.houses_report"
[0m13:51:51.205261 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.houses_report (compile): 13:51:51.202252 => 13:51:51.205114
[0m13:51:51.205521 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.flats_report (compile): 13:51:51.199599 => 13:51:51.205389
[0m13:51:51.205762 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.houses_report
[0m13:51:51.205998 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.flats_report
[0m13:51:51.207802 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.houses_report"
[0m13:51:51.209537 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.flats_report"
[0m13:51:51.211339 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.houses_report"
[0m13:51:51.212586 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.flats_report"
[0m13:51:51.212891 [debug] [Thread-4 (]: On model.rightmove_epc.houses_report: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.houses_report"} */
create or replace transient table ANALYTICS_DEV.dbt_melissa_rm_epc.houses_report
         as
        (with house_addmatch as (

    select 
    distinct
    --count(LISTING_ID) as TOTAL_LISTINGS,
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN, -- NULL
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
 --   am.FLOOR_LEVEL as RM_FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    epc.ADDRESSID AS EPC_ADDRESSID,
    -- REMOVE_FROM_RM_MATCH,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

     from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc on am.EPC_ADDRESSID = epc.ADDRESSID
    and am.FULL_POSTCODE = epc.POSTCODE
    where MATCH_EPC = 'YES'
    and COMBINED_PROPERTY_TYPE not in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')

),

house_uprnmatch as (

    select 
    distinct
    --count(LISTING_ID) as TOTAL_LISTINGS,
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN, -- NULL
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
  --  am.FLOOR_LEVEL as RM_FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    epc.ADDRESSID AS EPC_ADDRESSID,
    -- REMOVE_FROM_RM_MATCH,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

    

    from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn epc on am.EPC_UPRN = epc.UPRN

    where MATCH_EPC = 'YES'
    and COMBINED_PROPERTY_TYPE not in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')
  -- AND RM_UPRN = 100030719363

)


select 'UPRN' as MATCH_TYPE, * from house_uprnmatch

union all

select 'ADDRESSID' as MATCH_TYPE, * from house_addmatch

/*
--THIS IS USED FOR A TEST
select RM_UPRN,COUNT(BUILDING_REFERENCE_NUMBER)
from house_uprnmatch
WHERE RM_UPRN IS NOT NULL
GROUP BY 1
HAVING COUNT(BUILDING_REFERENCE_NUMBER) >1
*/
        );
[0m13:51:51.213265 [debug] [Thread-3 (]: On model.rightmove_epc.flats_report: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.flats_report"} */
create or replace transient table ANALYTICS_DEV.dbt_melissa_rm_epc.flats_report
         as
        (with house_addmatch as (

    select 
    distinct
    --count(LISTING_ID) as TOTAL_LISTINGS,
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN, -- NULL
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
 --   am.FLOOR_LEVEL as RM_FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    epc.ADDRESSID AS EPC_ADDRESSID,
    -- REMOVE_FROM_RM_MATCH,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

     from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc on am.EPC_ADDRESSID = epc.ADDRESSID
    and am.FULL_POSTCODE = epc.POSTCODE
    where MATCH_EPC = 'YES'
    and COMBINED_PROPERTY_TYPE in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')

),

house_uprnmatch as (

    select 
    distinct
    --count(LISTING_ID) as TOTAL_LISTINGS,
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN, -- NULL
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
  --  am.FLOOR_LEVEL as RM_FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    epc.ADDRESSID AS EPC_ADDRESSID,
    -- REMOVE_FROM_RM_MATCH,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

    

    from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn epc on am.EPC_UPRN = epc.UPRN

    where MATCH_EPC = 'YES'
   and COMBINED_PROPERTY_TYPE in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')
  -- AND RM_UPRN = 100030719363

)


select 'UPRN' as MATCH_TYPE, * from house_uprnmatch

union all

select 'ADDRESSID' as MATCH_TYPE, * from house_addmatch

/*
--THIS IS USED FOR A TEST
select RM_UPRN,COUNT(BUILDING_REFERENCE_NUMBER)
from house_uprnmatch
WHERE RM_UPRN IS NOT NULL
GROUP BY 1
HAVING COUNT(BUILDING_REFERENCE_NUMBER) >1
*/
        );
[0m13:51:51.213540 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m13:51:51.213732 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m13:51:51.785268 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m13:51:51.786950 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.uprn_address_match (execute): 13:51:51.135154 => 13:51:51.786825
[0m13:51:51.787205 [debug] [Thread-2 (]: On model.rightmove_epc.uprn_address_match: Close
[0m13:51:51.874667 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1aa3857c-865c-4de2-a5b0-ce0a99d4b055', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110d39390>]}
[0m13:51:51.875172 [info ] [Thread-2 (]: 11 of 16 OK created sql view model dbt_melissa_rm_epc.uprn_address_match ....... [[32mSUCCESS 1[0m in 0.74s]
[0m13:51:51.875514 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.uprn_address_match
[0m13:51:51.875867 [debug] [Thread-2 (]: Began running node model.rightmove_epc.rm_all_matches
[0m13:51:51.876109 [info ] [Thread-2 (]: 14 of 16 START sql table model dbt_melissa_rm_epc.rm_all_matches ............... [RUN]
[0m13:51:51.876504 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.uprn_address_match, now model.rightmove_epc.rm_all_matches)
[0m13:51:51.876708 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.rm_all_matches
[0m13:51:51.878968 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.rm_all_matches"
[0m13:51:51.881196 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.rm_all_matches (compile): 13:51:51.876835 => 13:51:51.881063
[0m13:51:51.881411 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.rm_all_matches
[0m13:51:51.884191 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.rm_all_matches"
[0m13:51:51.885627 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.rm_all_matches"
[0m13:51:51.885900 [debug] [Thread-2 (]: On model.rightmove_epc.rm_all_matches: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.rm_all_matches"} */
create or replace transient table ANALYTICS_DEV.dbt_melissa_rm_epc.rm_all_matches
         as
        (with addr as (

    select 
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN,
    EPC_ADDRESSID
    
    from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
    where MATCH_EPC = 'YES' 
),

uprn_addr as (

    select 
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN,
    EPC_ADDRESSID
    
    from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_address_match
    where MATCH_EPC = 'YES' 
),

uprn as (

    select 
    
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN::VARCHAR AS EPC_UPRN,
    EPC_ADDRESSID

    from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'YES'
),

final as (

select 'ADDRESS AND POSTCODE MATCH' AS MATCH_RESULT, * from addr
union all
select 'UPRN MATCH' AS MATCH_RESULT, * from uprn
union all
select 'MATCH ADDRESS NO MATCH TO EPC UPRN' AS MATCH_RESULT, * from uprn
)

select * from final
        );
[0m13:51:51.886139 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m13:54:03.879879 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 133.0 seconds
[0m13:54:03.884269 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.false_listings (execute): 13:51:50.493785 => 13:54:03.884001
[0m13:54:03.884756 [debug] [Thread-1 (]: On model.rightmove_epc.false_listings: Close
[0m13:54:04.103373 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1aa3857c-865c-4de2-a5b0-ce0a99d4b055', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1113e7310>]}
[0m13:54:04.104456 [info ] [Thread-1 (]: 7 of 16 OK created sql table model dbt_melissa_rm_epc.false_listings ........... [[32mSUCCESS 1[0m in 133.63s]
[0m13:54:04.105209 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.false_listings
[0m13:54:04.105709 [debug] [Thread-1 (]: Began running node model.rightmove_epc.rm_no_matches
[0m13:54:04.106336 [info ] [Thread-1 (]: 15 of 16 START sql table model dbt_melissa_rm_epc.rm_no_matches ................ [RUN]
[0m13:54:04.107219 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.false_listings, now model.rightmove_epc.rm_no_matches)
[0m13:54:04.107609 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.rm_no_matches
[0m13:54:04.111248 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.rm_no_matches"
[0m13:54:04.113916 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.rm_no_matches (compile): 13:54:04.107842 => 13:54:04.113618
[0m13:54:04.114311 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.rm_no_matches
[0m13:54:04.116903 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.rm_no_matches"
[0m13:54:04.119062 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.rm_no_matches"
[0m13:54:04.119460 [debug] [Thread-1 (]: On model.rightmove_epc.rm_no_matches: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.rm_no_matches"} */
create or replace transient table ANALYTICS_DEV.dbt_melissa_rm_epc.rm_no_matches
         as
        (with addr as (

    select 
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    '' AS EPC_UPRN,
    EPC_ADDRESSID
    
    from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
    where MATCH_EPC = 'NO' 
),

uprn as (

    select 
    
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN::VARCHAR AS EPC_UPRN,
    EPC_ADDRESSID
    
     from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'NO'
),

uprn_address as (

        select 
    
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN::VARCHAR AS EPC_UPRN,
    EPC_ADDRESSID
    
     from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_address_match
    where MATCH_EPC = 'NO'
),

final as (

select 'NO ADDRESS MATCH' AS MATCH_RESULT, * from addr
union all
select 'NO UPRN MATCH' AS MATCH_RESULT, * from uprn
union select 'NO ADDRESS OR UPRN MATCH ' AS MATCH_RESULT, * from uprn

)

select * from final
        );
[0m13:54:04.119872 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:56:20.589070 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 136.0 seconds
[0m13:56:20.591840 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.rm_no_matches (execute): 13:54:04.114518 => 13:56:20.591629
[0m13:56:20.592259 [debug] [Thread-1 (]: On model.rightmove_epc.rm_no_matches: Close
[0m13:56:20.703021 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1aa3857c-865c-4de2-a5b0-ce0a99d4b055', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1112c0050>]}
[0m13:56:20.703629 [info ] [Thread-1 (]: 15 of 16 OK created sql table model dbt_melissa_rm_epc.rm_no_matches ........... [[32mSUCCESS 1[0m in 136.60s]
[0m13:56:20.704100 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.rm_no_matches
[0m13:56:34.000425 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 283.0 seconds
[0m13:56:34.003767 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.flats_report (execute): 13:51:51.207986 => 13:56:34.003489
[0m13:56:34.004296 [debug] [Thread-3 (]: On model.rightmove_epc.flats_report: Close
[0m13:56:34.159699 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1aa3857c-865c-4de2-a5b0-ce0a99d4b055', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112b9fc90>]}
[0m13:56:34.160347 [info ] [Thread-3 (]: 12 of 16 OK created sql table model dbt_melissa_rm_epc.flats_report ............ [[32mSUCCESS 1[0m in 282.96s]
[0m13:56:34.160829 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.flats_report
[0m13:57:25.509956 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 334.0 seconds
[0m13:57:25.512934 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.rm_all_matches (execute): 13:51:51.881535 => 13:57:25.512758
[0m13:57:25.513267 [debug] [Thread-2 (]: On model.rightmove_epc.rm_all_matches: Close
[0m13:57:25.671577 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1aa3857c-865c-4de2-a5b0-ce0a99d4b055', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110e90850>]}
[0m13:57:25.672189 [info ] [Thread-2 (]: 14 of 16 OK created sql table model dbt_melissa_rm_epc.rm_all_matches .......... [[32mSUCCESS 1[0m in 333.80s]
[0m13:57:25.672586 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.rm_all_matches
[0m13:58:05.956577 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 375.0 seconds
[0m13:58:05.960002 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.houses_report (execute): 13:51:51.206144 => 13:58:05.959723
[0m13:58:05.960541 [debug] [Thread-4 (]: On model.rightmove_epc.houses_report: Close
[0m13:58:06.045994 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1aa3857c-865c-4de2-a5b0-ce0a99d4b055', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110dbd6d0>]}
[0m13:58:06.046789 [info ] [Thread-4 (]: 13 of 16 OK created sql table model dbt_melissa_rm_epc.houses_report ........... [[32mSUCCESS 1[0m in 374.85s]
[0m13:58:06.047410 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.houses_report
[0m13:58:06.048309 [debug] [Thread-1 (]: Began running node model.rightmove_epc.zero_bedrooms
[0m13:58:06.048909 [info ] [Thread-1 (]: 16 of 16 START sql table model dbt_melissa_rm_epc.zero_bedrooms ................ [RUN]
[0m13:58:06.049621 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.rm_no_matches, now model.rightmove_epc.zero_bedrooms)
[0m13:58:06.049954 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.zero_bedrooms
[0m13:58:06.052947 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.zero_bedrooms"
[0m13:58:06.056042 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.zero_bedrooms (compile): 13:58:06.050154 => 13:58:06.055833
[0m13:58:06.056399 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.zero_bedrooms
[0m13:58:06.059650 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.zero_bedrooms"
[0m13:58:06.060870 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.zero_bedrooms"
[0m13:58:06.061248 [debug] [Thread-1 (]: On model.rightmove_epc.zero_bedrooms: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.zero_bedrooms"} */
create or replace transient table ANALYTICS_DEV.dbt_melissa_rm_epc.zero_bedrooms
         as
        (with houses as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.houses_report
    where BEDROOM = 0
),

flats as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.flats_report
        where BEDROOM = 0

)

select * from flats
union all
select * from houses
        );
[0m13:58:06.061560 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m13:58:09.660798 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 4.0 seconds
[0m13:58:09.664946 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.zero_bedrooms (execute): 13:58:06.056600 => 13:58:09.664742
[0m13:58:09.665336 [debug] [Thread-1 (]: On model.rightmove_epc.zero_bedrooms: Close
[0m13:58:09.794338 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1aa3857c-865c-4de2-a5b0-ce0a99d4b055', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1111b4ad0>]}
[0m13:58:09.795134 [info ] [Thread-1 (]: 16 of 16 OK created sql table model dbt_melissa_rm_epc.zero_bedrooms ........... [[32mSUCCESS 1[0m in 3.74s]
[0m13:58:09.795761 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.zero_bedrooms
[0m13:58:09.797576 [debug] [MainThread]: Connection 'master' was properly closed.
[0m13:58:09.797930 [debug] [MainThread]: Connection 'model.rightmove_epc.zero_bedrooms' was properly closed.
[0m13:58:09.798261 [debug] [MainThread]: Connection 'model.rightmove_epc.rm_all_matches' was properly closed.
[0m13:58:09.798578 [debug] [MainThread]: Connection 'model.rightmove_epc.houses_report' was properly closed.
[0m13:58:09.798872 [debug] [MainThread]: Connection 'model.rightmove_epc.flats_report' was properly closed.
[0m13:58:09.799282 [info ] [MainThread]: 
[0m13:58:09.799645 [info ] [MainThread]: Finished running 10 view models, 6 table models in 0 hours 6 minutes and 22.23 seconds (382.23s).
[0m13:58:09.801882 [debug] [MainThread]: Command end result
[0m13:58:09.814001 [info ] [MainThread]: 
[0m13:58:09.814375 [info ] [MainThread]: [32mCompleted successfully[0m
[0m13:58:09.814646 [info ] [MainThread]: 
[0m13:58:09.814921 [info ] [MainThread]: Done. PASS=16 WARN=0 ERROR=0 SKIP=0 TOTAL=16
[0m13:58:09.818792 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 382.58542, "process_user_time": 2.00967, "process_kernel_time": 0.25842, "process_mem_max_rss": "138592256", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m13:58:09.819243 [debug] [MainThread]: Command `dbt run` succeeded at 13:58:09.819146 after 382.59 seconds
[0m13:58:09.819546 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11045c2d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100eb6110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100ff1cd0>]}
[0m13:58:09.819835 [debug] [MainThread]: Flushing usage events
[0m14:09:36.579150 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107018b90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10705dc10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10705ef50>]}


============================== 14:09:36.582714 | 3aff5bd1-272e-4407-a7ed-ea693cdb630f ==============================
[0m14:09:36.582714 [info ] [MainThread]: Running with dbt=1.7.10
[0m14:09:36.583144 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m14:09:36.784050 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3aff5bd1-272e-4407-a7ed-ea693cdb630f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110a9a9d0>]}
[0m14:09:36.824618 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3aff5bd1-272e-4407-a7ed-ea693cdb630f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110ab0350>]}
[0m14:09:36.825335 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m14:09:36.835808 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m14:09:36.867064 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:09:36.867389 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:09:36.871369 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3aff5bd1-272e-4407-a7ed-ea693cdb630f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110a98190>]}
[0m14:09:36.879280 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3aff5bd1-272e-4407-a7ed-ea693cdb630f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110b60390>]}
[0m14:09:36.879609 [info ] [MainThread]: Found 17 models, 1 analysis, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m14:09:36.879839 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3aff5bd1-272e-4407-a7ed-ea693cdb630f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110b58410>]}
[0m14:09:36.881222 [info ] [MainThread]: 
[0m14:09:36.881728 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m14:09:36.882658 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m14:09:36.890408 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m14:09:36.890700 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m14:09:36.890893 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:09:37.416700 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 1.0 seconds
[0m14:09:37.419448 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m14:09:37.500511 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m14:09:37.510987 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m14:09:37.511468 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m14:09:37.511811 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:09:37.989703 [debug] [ThreadPool]: SQL status: SUCCESS 16 in 0.0 seconds
[0m14:09:37.991425 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m14:09:38.070465 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3aff5bd1-272e-4407-a7ed-ea693cdb630f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1062b6790>]}
[0m14:09:38.071225 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:09:38.071504 [info ] [MainThread]: 
[0m14:09:38.074333 [debug] [Thread-1 (]: Began running node model.rightmove_epc.stg_epc_certs
[0m14:09:38.074610 [debug] [Thread-2 (]: Began running node model.rightmove_epc.stg_rightmove
[0m14:09:38.074950 [info ] [Thread-1 (]: 1 of 17 START sql view model dbt_melissa_rm_epc.stg_epc_certs .................. [RUN]
[0m14:09:38.075256 [info ] [Thread-2 (]: 2 of 17 START sql view model dbt_melissa_rm_epc.stg_rightmove .................. [RUN]
[0m14:09:38.075720 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.stg_epc_certs)
[0m14:09:38.076179 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.stg_rightmove'
[0m14:09:38.076414 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.stg_epc_certs
[0m14:09:38.076628 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.stg_rightmove
[0m14:09:38.083011 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.stg_epc_certs"
[0m14:09:38.118472 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.stg_rightmove"
[0m14:09:38.119416 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (compile): 14:09:38.076768 => 14:09:38.119280
[0m14:09:38.119672 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (compile): 14:09:38.083284 => 14:09:38.119529
[0m14:09:38.119900 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.stg_epc_certs
[0m14:09:38.120098 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.stg_rightmove
[0m14:09:38.141197 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.stg_epc_certs"
[0m14:09:38.141723 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.stg_rightmove"
[0m14:09:38.142913 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.stg_epc_certs"
[0m14:09:38.143504 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.stg_rightmove"
[0m14:09:38.143765 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_epc_certs"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
  
   as (
    WITH epc_certs as (
    
    select 
    UPRN,
    LODGEMENT_DATE,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
   -- COUNTY,
    LOCAL_AUTHORITY as LOCAL_AUTHORITY_CODE,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    UPPER(CASE WHEN (UPPER(ADDRESS1) LIKE 'FLAT%' OR UPPER(ADDRESS1) LIKE 'UNIT%') or UPPER(ADDRESS1) LIKE 'ROOM%' 
    THEN TRIM(REPLACE(REPLACE(CONCAT(ADDRESS),','),' '))
    ELSE trim(replace(replace(ADDRESS1,' '),',')) END) AS ADDRESSID,
    CASE WHEN UPRN is null and addressid is null THEN 1 else 0 end as REMOVE_FROM_RM_MATCH,
    FLOOR_LEVEL,
    FLAT_TOP_STOREY,
    FLAT_STOREY_COUNT,
    PROPERTY_TYPE
 from  RAW.EPC_TEST_DATA.EPC_CERTIFICATES 

)

SELECT * FROM epc_certs
  );
[0m14:09:38.144027 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_rightmove"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
  
   as (
    with rm as (

    SELECT 
    LISTING_ID,
    CHANGE_DATE,
    UPPER(TRIM(replace(REPLACE(CONCAT(ADDRESS_1::VARCHAR,ADDRESS_2::VARCHAR),' '),','))) AS ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, 
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    BEDROOM,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
 --   STUDENTLET_FLAG,
    COMBINED_PROPERTY_TYPE
    -- property type
    FROM 
       ANALYTICS.RIGHTMOVE_PROD.CLEAN_RAW_RIGHTMOVE_DATA 

 
)

SELECT * FROM rm
  );
[0m14:09:38.144248 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:09:38.144453 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m14:09:38.623891 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m14:09:38.644883 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (execute): 14:09:38.130853 => 14:09:38.644687
[0m14:09:38.645566 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:09:38.645874 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: Close
[0m14:09:38.647785 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (execute): 14:09:38.120224 => 14:09:38.647641
[0m14:09:38.648775 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: Close
[0m14:09:38.730811 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3aff5bd1-272e-4407-a7ed-ea693cdb630f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1121e7910>]}
[0m14:09:38.731563 [info ] [Thread-2 (]: 2 of 17 OK created sql view model dbt_melissa_rm_epc.stg_rightmove ............. [[32mSUCCESS 1[0m in 0.65s]
[0m14:09:38.732131 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.stg_rightmove
[0m14:09:38.732694 [debug] [Thread-4 (]: Began running node model.rightmove_epc.latest_rm_urn
[0m14:09:38.733078 [info ] [Thread-4 (]: 3 of 17 START sql view model dbt_melissa_rm_epc.latest_rm_urn .................. [RUN]
[0m14:09:38.733691 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.rightmove_epc.latest_rm_urn'
[0m14:09:38.733973 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.latest_rm_urn
[0m14:09:38.736746 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.latest_rm_urn"
[0m14:09:38.738330 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.latest_rm_urn (compile): 14:09:38.734147 => 14:09:38.738158
[0m14:09:38.738619 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.latest_rm_urn
[0m14:09:38.741150 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.latest_rm_urn"
[0m14:09:38.742162 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.latest_rm_urn"
[0m14:09:38.742470 [debug] [Thread-4 (]: On model.rightmove_epc.latest_rm_urn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.latest_rm_urn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NOT NULL
),

change_date AS (
    SELECT 
        UPRN AS UPRN_CD, 
        MAX(CHANGE_DATE) AS MAX_CHANGE_DATE 
    FROM rm
    GROUP BY UPRN
),

rm_latest as (

    SELECT distinct * FROM rm
    LEFT JOIN change_date cd
    ON rm.UPRN = cd.UPRN_CD
    WHERE cd.MAX_CHANGE_DATE = rm.CHANGE_DATE 
 --  and UPRN = 100090588560
    
)

select DISTINCT * from rm_latest

/*
select uprn, count(*) from rm_latest
group by 1
having count(*) >1
*/
  );
[0m14:09:38.742753 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m14:09:38.755453 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3aff5bd1-272e-4407-a7ed-ea693cdb630f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110f67010>]}
[0m14:09:38.756008 [info ] [Thread-1 (]: 1 of 17 OK created sql view model dbt_melissa_rm_epc.stg_epc_certs ............. [[32mSUCCESS 1[0m in 0.68s]
[0m14:09:38.756420 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.stg_epc_certs
[0m14:09:38.756960 [debug] [Thread-2 (]: Began running node model.rightmove_epc.dim_addressid
[0m14:09:38.757262 [debug] [Thread-3 (]: Began running node model.rightmove_epc.latest_epc_urn
[0m14:09:38.757710 [info ] [Thread-2 (]: 4 of 17 START sql view model dbt_melissa_rm_epc.dim_addressid .................. [RUN]
[0m14:09:38.758095 [info ] [Thread-3 (]: 5 of 17 START sql view model dbt_melissa_rm_epc.latest_epc_urn ................. [RUN]
[0m14:09:38.758626 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_rightmove, now model.rightmove_epc.dim_addressid)
[0m14:09:38.759148 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.rightmove_epc.latest_epc_urn'
[0m14:09:38.759413 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.dim_addressid
[0m14:09:38.759663 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.latest_epc_urn
[0m14:09:38.762088 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.dim_addressid"
[0m14:09:38.764096 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.latest_epc_urn"
[0m14:09:38.765201 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.dim_addressid (compile): 14:09:38.759874 => 14:09:38.765057
[0m14:09:38.765474 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.latest_epc_urn (compile): 14:09:38.762352 => 14:09:38.765338
[0m14:09:38.765685 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.dim_addressid
[0m14:09:38.765920 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.latest_epc_urn
[0m14:09:38.767958 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.dim_addressid"
[0m14:09:38.771055 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.latest_epc_urn"
[0m14:09:38.772128 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.latest_epc_urn"
[0m14:09:38.772759 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.dim_addressid"
[0m14:09:38.773055 [debug] [Thread-3 (]: On model.rightmove_epc.latest_epc_urn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.latest_epc_urn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn
  
   as (
    with epc_max_date as (

    select uprn as UPRN_EPC,
    MAX(LODGEMENT_DATE) AS MAX_LODGEMENT_DATE,
    from  ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    group by 1


),

latest_epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc
    inner join epc_max_date on epc.uprn = epc_max_date.UPRN_EPC
    where MAX_LODGEMENT_DATE = LODGEMENT_DATE
   -- and uprn = 200073066

)

select DISTINCT * from latest_epc

/*
select uprn, count(*) from latest_epc
group by 1
having count(*) >1
*/
  );
[0m14:09:38.773351 [debug] [Thread-2 (]: On model.rightmove_epc.dim_addressid: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_addressid"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE ADDRESS'

with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource,
    POSTCODE

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    where REMOVE_FROM_RM_MATCH = 0
    AND ADDRESSID IS NOT NULL

),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    WHERE ADDRESSID IS NOT NULL

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where addressid is not null
  );
[0m14:09:38.773611 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m14:09:38.773835 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m14:09:39.215101 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m14:09:39.217873 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.latest_rm_urn (execute): 14:09:38.738793 => 14:09:39.217656
[0m14:09:39.218267 [debug] [Thread-4 (]: On model.rightmove_epc.latest_rm_urn: Close
[0m14:09:39.308023 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3aff5bd1-272e-4407-a7ed-ea693cdb630f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1120b6550>]}
[0m14:09:39.308700 [info ] [Thread-4 (]: 3 of 17 OK created sql view model dbt_melissa_rm_epc.latest_rm_urn ............. [[32mSUCCESS 1[0m in 0.57s]
[0m14:09:39.309242 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.latest_rm_urn
[0m14:09:39.309820 [debug] [Thread-1 (]: Began running node model.rightmove_epc.false_listings
[0m14:09:39.310276 [info ] [Thread-1 (]: 6 of 17 START sql table model dbt_melissa_rm_epc.false_listings ................ [RUN]
[0m14:09:39.310950 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_epc_certs, now model.rightmove_epc.false_listings)
[0m14:09:39.311296 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.false_listings
[0m14:09:39.314348 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.false_listings"
[0m14:09:39.315118 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.false_listings (compile): 14:09:39.311510 => 14:09:39.314944
[0m14:09:39.315420 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.false_listings
[0m14:09:39.331344 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.false_listings"
[0m14:09:39.332377 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.false_listings"
[0m14:09:39.332660 [debug] [Thread-1 (]: On model.rightmove_epc.false_listings: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.false_listings"} */
create or replace transient table ANALYTICS_DEV.dbt_melissa_rm_epc.false_listings
         as
        (with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn

),

false_rm as (

    select 
    uprn,
    count(LISTING_ID) listing_count
    from rm
    group by 1
    having count(LISTING_ID) >1

),

get_false as (

    select rm.*,
    listing_count

    from rm
    inner join false_rm
    on rm.uprn = false_rm.uprn

)

select * from get_false
order by uprn
        );
[0m14:09:39.332912 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:09:39.362141 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:09:39.363839 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.dim_addressid (execute): 14:09:38.766052 => 14:09:39.363714
[0m14:09:39.364076 [debug] [Thread-2 (]: On model.rightmove_epc.dim_addressid: Close
[0m14:09:39.379321 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:09:39.381266 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.latest_epc_urn (execute): 14:09:38.768114 => 14:09:39.381123
[0m14:09:39.381591 [debug] [Thread-3 (]: On model.rightmove_epc.latest_epc_urn: Close
[0m14:09:39.455403 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3aff5bd1-272e-4407-a7ed-ea693cdb630f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112207dd0>]}
[0m14:09:39.456060 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3aff5bd1-272e-4407-a7ed-ea693cdb630f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112207fd0>]}
[0m14:09:39.456595 [info ] [Thread-3 (]: 5 of 17 OK created sql view model dbt_melissa_rm_epc.latest_epc_urn ............ [[32mSUCCESS 1[0m in 0.70s]
[0m14:09:39.457070 [info ] [Thread-2 (]: 4 of 17 OK created sql view model dbt_melissa_rm_epc.dim_addressid ............. [[32mSUCCESS 1[0m in 0.70s]
[0m14:09:39.457537 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.latest_epc_urn
[0m14:09:39.457888 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.dim_addressid
[0m14:09:39.458340 [debug] [Thread-4 (]: Began running node model.rightmove_epc.epc_flats
[0m14:09:39.458665 [debug] [Thread-3 (]: Began running node model.rightmove_epc.address_match
[0m14:09:39.458962 [info ] [Thread-4 (]: 7 of 17 START sql table model dbt_melissa_rm_epc.epc_flats ..................... [RUN]
[0m14:09:39.459250 [info ] [Thread-3 (]: 8 of 17 START sql view model dbt_melissa_rm_epc.address_match .................. [RUN]
[0m14:09:39.459710 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.latest_rm_urn, now model.rightmove_epc.epc_flats)
[0m14:09:39.460113 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.latest_epc_urn, now model.rightmove_epc.address_match)
[0m14:09:39.460352 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.epc_flats
[0m14:09:39.460577 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.address_match
[0m14:09:39.462502 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.epc_flats"
[0m14:09:39.464595 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.address_match"
[0m14:09:39.466170 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.epc_flats (compile): 14:09:39.460719 => 14:09:39.465975
[0m14:09:39.466469 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.epc_flats
[0m14:09:39.468485 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.epc_flats"
[0m14:09:39.468789 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.address_match (compile): 14:09:39.462676 => 14:09:39.468652
[0m14:09:39.469117 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.address_match
[0m14:09:39.471253 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.address_match"
[0m14:09:39.471997 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.epc_flats"
[0m14:09:39.472254 [debug] [Thread-4 (]: On model.rightmove_epc.epc_flats: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.epc_flats"} */
create or replace transient table ANALYTICS_DEV.dbt_melissa_rm_epc.epc_flats
         as
        (with epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn

),

flat_epc as (

    select uprn,
    count(BUILDING_REFERENCE_NUMBER) as building_ref_count
    from epc
    group by 1
    having count(BUILDING_REFERENCE_NUMBER) >1

),

match_flat_epc as (

    select epc.*,
    building_ref_count
    from epc
    inner join flat_epc on epc.uprn = flat_epc.uprn

)

select * from match_flat_epc
        );
[0m14:09:39.472898 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.address_match"
[0m14:09:39.473135 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m14:09:39.473382 [debug] [Thread-3 (]: On model.rightmove_epc.address_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.address_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NULL

),

epc_address as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
    where datasource = 'EPC'
)


SELECT rm.*,
CASE WHEN epc_address.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_address.ADDRESSID AS EPC_ADDRESSID,
epc_address.UPRN AS EPC_UPRN


FROM rm
LEFT JOIN epc_address
ON rm.addressid = epc_address.addressid
and rm.FULL_POSTCODE = epc_address.POSTCODE
  );
[0m14:09:39.473978 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m14:09:40.080684 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:09:40.085887 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.address_match (execute): 14:09:39.469255 => 14:09:40.085528
[0m14:09:40.086547 [debug] [Thread-3 (]: On model.rightmove_epc.address_match: Close
[0m14:09:40.156158 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3aff5bd1-272e-4407-a7ed-ea693cdb630f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110f53b50>]}
[0m14:09:40.156831 [info ] [Thread-3 (]: 8 of 17 OK created sql view model dbt_melissa_rm_epc.address_match ............. [[32mSUCCESS 1[0m in 0.70s]
[0m14:09:40.157380 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.address_match
[0m14:11:01.519842 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 82.0 seconds
[0m14:11:01.524032 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.false_listings (execute): 14:09:39.315600 => 14:11:01.523797
[0m14:11:01.524449 [debug] [Thread-1 (]: On model.rightmove_epc.false_listings: Close
[0m14:11:04.717228 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3aff5bd1-272e-4407-a7ed-ea693cdb630f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1122ecfd0>]}
[0m14:11:04.718387 [info ] [Thread-1 (]: 6 of 17 OK created sql table model dbt_melissa_rm_epc.false_listings ........... [[32mSUCCESS 1[0m in 85.41s]
[0m14:11:04.719161 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.false_listings
[0m14:11:18.572174 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 99.0 seconds
[0m14:11:18.574162 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.epc_flats (execute): 14:09:39.466620 => 14:11:18.574005
[0m14:11:18.574462 [debug] [Thread-4 (]: On model.rightmove_epc.epc_flats: Close
[0m14:11:18.685083 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3aff5bd1-272e-4407-a7ed-ea693cdb630f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x120828390>]}
[0m14:11:18.685648 [info ] [Thread-4 (]: 7 of 17 OK created sql table model dbt_melissa_rm_epc.epc_flats ................ [[32mSUCCESS 1[0m in 99.23s]
[0m14:11:18.686035 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.epc_flats
[0m14:11:18.686528 [debug] [Thread-2 (]: Began running node model.rightmove_epc.dim_uprn
[0m14:11:18.686914 [info ] [Thread-2 (]: 9 of 17 START sql view model dbt_melissa_rm_epc.dim_uprn ....................... [RUN]
[0m14:11:18.687485 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.dim_addressid, now model.rightmove_epc.dim_uprn)
[0m14:11:18.687744 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.dim_uprn
[0m14:11:18.690066 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.dim_uprn"
[0m14:11:18.690709 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.dim_uprn (compile): 14:11:18.687893 => 14:11:18.690576
[0m14:11:18.690958 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.dim_uprn
[0m14:11:18.694623 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.dim_uprn"
[0m14:11:18.695765 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.dim_uprn"
[0m14:11:18.696041 [debug] [Thread-2 (]: On model.rightmove_epc.dim_uprn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_uprn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE UPRNS


with epc as (

    select distinct
    epc.uprn,
    epc.addressid,
    epc.ADDRESS,
    'EPC' AS datasource,
    epc.POSTCODE,
    multi.uprn as multi_uprn
    
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc
    left join ANALYTICS_DEV.dbt_melissa_rm_epc.epc_flats multi on epc.uprn = multi.uprn

    where REMOVE_FROM_RM_MATCH = 0
    AND UPRN IS NOT NULL
),

rightmove as (

 select distinct
    rm.uprn,
    rm.addressid,
    concat(rm.ADDRESS_1,',',rm.ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    rm.FULL_POSTCODE AS POSTCODE,
    multi.uprn as multi_uprn

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove rm
    left join ANALYTICS_DEV.dbt_melissa_rm_epc.false_listings multi on rm.uprn = multi.uprn
    WHERE UPRN IS NOT NULL


),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where uprn is not null
  );
[0m14:11:18.696288 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m14:11:19.330200 [debug] [Thread-2 (]: Snowflake adapter: Snowflake query id: 01b344f3-0103-9b8b-0000-7195063785e6
[0m14:11:19.330622 [debug] [Thread-2 (]: Snowflake adapter: Snowflake error: 002028 (42601): SQL compilation error:
ambiguous column name 'REMOVE_FROM_RM_MATCH'
[0m14:11:19.331085 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.dim_uprn (execute): 14:11:18.691100 => 14:11:19.330914
[0m14:11:19.331399 [debug] [Thread-2 (]: On model.rightmove_epc.dim_uprn: Close
[0m14:11:19.416974 [debug] [Thread-2 (]: Database Error in model dim_uprn (models/bridge/dim_uprn.sql)
  002028 (42601): SQL compilation error:
  ambiguous column name 'REMOVE_FROM_RM_MATCH'
  compiled Code at target/run/rightmove_epc/models/bridge/dim_uprn.sql
[0m14:11:19.417505 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3aff5bd1-272e-4407-a7ed-ea693cdb630f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12085b3d0>]}
[0m14:11:19.418007 [error] [Thread-2 (]: 9 of 17 ERROR creating sql view model dbt_melissa_rm_epc.dim_uprn .............. [[31mERROR[0m in 0.73s]
[0m14:11:19.418476 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.dim_uprn
[0m14:11:19.419106 [debug] [Thread-1 (]: Began running node model.rightmove_epc.no_uprn_match
[0m14:11:19.419447 [debug] [Thread-4 (]: Began running node model.rightmove_epc.uprn_match
[0m14:11:19.419765 [info ] [Thread-1 (]: 10 of 17 SKIP relation dbt_melissa_rm_epc.no_uprn_match ........................ [[33mSKIP[0m]
[0m14:11:19.420150 [info ] [Thread-4 (]: 11 of 17 SKIP relation dbt_melissa_rm_epc.uprn_match ........................... [[33mSKIP[0m]
[0m14:11:19.420479 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.no_uprn_match
[0m14:11:19.420752 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.uprn_match
[0m14:11:19.421138 [debug] [Thread-2 (]: Began running node model.rightmove_epc.uprn_address_match
[0m14:11:19.421530 [info ] [Thread-2 (]: 12 of 17 SKIP relation dbt_melissa_rm_epc.uprn_address_match ................... [[33mSKIP[0m]
[0m14:11:19.421850 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.uprn_address_match
[0m14:11:19.422119 [debug] [Thread-1 (]: Began running node model.rightmove_epc.flats_report
[0m14:11:19.422364 [debug] [Thread-2 (]: Began running node model.rightmove_epc.houses_report
[0m14:11:19.422683 [debug] [Thread-3 (]: Began running node model.rightmove_epc.rm_all_matches
[0m14:11:19.422951 [debug] [Thread-4 (]: Began running node model.rightmove_epc.rm_no_matches
[0m14:11:19.423204 [info ] [Thread-1 (]: 13 of 17 SKIP relation dbt_melissa_rm_epc.flats_report ......................... [[33mSKIP[0m]
[0m14:11:19.423505 [info ] [Thread-2 (]: 14 of 17 SKIP relation dbt_melissa_rm_epc.houses_report ........................ [[33mSKIP[0m]
[0m14:11:19.423823 [info ] [Thread-3 (]: 15 of 17 SKIP relation dbt_melissa_rm_epc.rm_all_matches ....................... [[33mSKIP[0m]
[0m14:11:19.424112 [info ] [Thread-4 (]: 16 of 17 SKIP relation dbt_melissa_rm_epc.rm_no_matches ........................ [[33mSKIP[0m]
[0m14:11:19.424413 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.flats_report
[0m14:11:19.424676 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.houses_report
[0m14:11:19.424929 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.rm_all_matches
[0m14:11:19.425174 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.rm_no_matches
[0m14:11:19.425611 [debug] [Thread-1 (]: Began running node model.rightmove_epc.zero_bedrooms
[0m14:11:19.426021 [info ] [Thread-1 (]: 17 of 17 SKIP relation dbt_melissa_rm_epc.zero_bedrooms ........................ [[33mSKIP[0m]
[0m14:11:19.426325 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.zero_bedrooms
[0m14:11:19.427553 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:11:19.427772 [debug] [MainThread]: Connection 'model.rightmove_epc.false_listings' was properly closed.
[0m14:11:19.427944 [debug] [MainThread]: Connection 'model.rightmove_epc.dim_uprn' was properly closed.
[0m14:11:19.428109 [debug] [MainThread]: Connection 'model.rightmove_epc.epc_flats' was properly closed.
[0m14:11:19.428268 [debug] [MainThread]: Connection 'model.rightmove_epc.address_match' was properly closed.
[0m14:11:19.428538 [info ] [MainThread]: 
[0m14:11:19.428757 [info ] [MainThread]: Finished running 10 view models, 7 table models in 0 hours 1 minutes and 42.55 seconds (102.55s).
[0m14:11:19.429841 [debug] [MainThread]: Command end result
[0m14:11:19.437904 [info ] [MainThread]: 
[0m14:11:19.438189 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m14:11:19.438367 [info ] [MainThread]: 
[0m14:11:19.438549 [error] [MainThread]:   Database Error in model dim_uprn (models/bridge/dim_uprn.sql)
  002028 (42601): SQL compilation error:
  ambiguous column name 'REMOVE_FROM_RM_MATCH'
  compiled Code at target/run/rightmove_epc/models/bridge/dim_uprn.sql
[0m14:11:19.438736 [info ] [MainThread]: 
[0m14:11:19.438919 [info ] [MainThread]: Done. PASS=8 WARN=0 ERROR=1 SKIP=8 TOTAL=17
[0m14:11:19.440653 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 102.8934, "process_user_time": 1.679983, "process_kernel_time": 0.227017, "process_mem_max_rss": "137822208", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:11:19.440977 [debug] [MainThread]: Command `dbt run` failed at 14:11:19.440909 after 102.89 seconds
[0m14:11:19.441218 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106f1e750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100d15d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100bda190>]}
[0m14:11:19.441439 [debug] [MainThread]: Flushing usage events
[0m14:12:40.671482 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11371bc50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113751fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11375ed10>]}


============================== 14:12:40.674591 | c033387f-a1e3-4f68-b44d-1f7460891840 ==============================
[0m14:12:40.674591 [info ] [MainThread]: Running with dbt=1.7.10
[0m14:12:40.674976 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'profiles_dir': '/Users/melissabee/.dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m14:12:40.886972 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c033387f-a1e3-4f68-b44d-1f7460891840', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113737150>]}
[0m14:12:40.928059 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c033387f-a1e3-4f68-b44d-1f7460891840', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113737150>]}
[0m14:12:40.928923 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m14:12:40.939238 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m14:12:40.959225 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:12:40.959533 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:12:40.963605 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c033387f-a1e3-4f68-b44d-1f7460891840', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1144901d0>]}
[0m14:12:40.972150 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c033387f-a1e3-4f68-b44d-1f7460891840', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114140c50>]}
[0m14:12:40.972506 [info ] [MainThread]: Found 17 models, 1 analysis, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m14:12:40.972733 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c033387f-a1e3-4f68-b44d-1f7460891840', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113f39010>]}
[0m14:12:40.974142 [info ] [MainThread]: 
[0m14:12:40.974603 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m14:12:40.975534 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m14:12:40.983283 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m14:12:40.983755 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m14:12:40.983960 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:12:41.454393 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 0.0 seconds
[0m14:12:41.456775 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m14:12:41.642755 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m14:12:41.652164 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m14:12:41.652610 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m14:12:41.652929 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:12:42.294602 [debug] [ThreadPool]: SQL status: SUCCESS 17 in 1.0 seconds
[0m14:12:42.296561 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m14:12:42.502384 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c033387f-a1e3-4f68-b44d-1f7460891840', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113753710>]}
[0m14:12:42.503190 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:12:42.503499 [info ] [MainThread]: 
[0m14:12:42.505690 [debug] [Thread-1 (]: Began running node model.rightmove_epc.stg_epc_certs
[0m14:12:42.506057 [debug] [Thread-2 (]: Began running node model.rightmove_epc.stg_rightmove
[0m14:12:42.506537 [info ] [Thread-1 (]: 1 of 17 START sql view model dbt_melissa_rm_epc.stg_epc_certs .................. [RUN]
[0m14:12:42.506995 [info ] [Thread-2 (]: 2 of 17 START sql view model dbt_melissa_rm_epc.stg_rightmove .................. [RUN]
[0m14:12:42.507675 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.stg_epc_certs)
[0m14:12:42.508218 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.stg_rightmove'
[0m14:12:42.508461 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.stg_epc_certs
[0m14:12:42.508723 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.stg_rightmove
[0m14:12:42.515640 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.stg_epc_certs"
[0m14:12:42.551303 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.stg_rightmove"
[0m14:12:42.552335 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (compile): 14:12:42.508876 => 14:12:42.552187
[0m14:12:42.552594 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (compile): 14:12:42.515926 => 14:12:42.552474
[0m14:12:42.552790 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.stg_epc_certs
[0m14:12:42.552987 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.stg_rightmove
[0m14:12:42.571816 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.stg_epc_certs"
[0m14:12:42.572105 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.stg_rightmove"
[0m14:12:42.573131 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.stg_epc_certs"
[0m14:12:42.573803 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.stg_rightmove"
[0m14:12:42.574083 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_epc_certs"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
  
   as (
    WITH epc_certs as (
    
    select 
    UPRN,
    LODGEMENT_DATE,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
   -- COUNTY,
    LOCAL_AUTHORITY as LOCAL_AUTHORITY_CODE,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    UPPER(CASE WHEN (UPPER(ADDRESS1) LIKE 'FLAT%' OR UPPER(ADDRESS1) LIKE 'UNIT%') or UPPER(ADDRESS1) LIKE 'ROOM%' 
    THEN TRIM(REPLACE(REPLACE(CONCAT(ADDRESS),','),' '))
    ELSE trim(replace(replace(ADDRESS1,' '),',')) END) AS ADDRESSID,
    CASE WHEN UPRN is null and addressid is null THEN 1 else 0 end as REMOVE_FROM_RM_MATCH,
    FLOOR_LEVEL,
    FLAT_TOP_STOREY,
    FLAT_STOREY_COUNT,
    PROPERTY_TYPE
 from  RAW.EPC_TEST_DATA.EPC_CERTIFICATES 

)

SELECT * FROM epc_certs
  );
[0m14:12:42.574531 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_rightmove"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
  
   as (
    with rm as (

    SELECT 
    LISTING_ID,
    CHANGE_DATE,
    UPPER(TRIM(replace(REPLACE(CONCAT(ADDRESS_1::VARCHAR,ADDRESS_2::VARCHAR),' '),','))) AS ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, 
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    BEDROOM,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
 --   STUDENTLET_FLAG,
    COMBINED_PROPERTY_TYPE
    -- property type
    FROM 
       ANALYTICS.RIGHTMOVE_PROD.CLEAN_RAW_RIGHTMOVE_DATA 

 
)

SELECT * FROM rm
  );
[0m14:12:42.574878 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:12:42.575144 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m14:12:43.012410 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m14:12:43.026206 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (execute): 14:12:42.553108 => 14:12:43.026060
[0m14:12:43.026523 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: Close
[0m14:12:43.188545 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c033387f-a1e3-4f68-b44d-1f7460891840', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11419e850>]}
[0m14:12:43.189221 [info ] [Thread-1 (]: 1 of 17 OK created sql view model dbt_melissa_rm_epc.stg_epc_certs ............. [[32mSUCCESS 1[0m in 0.68s]
[0m14:12:43.189649 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.stg_epc_certs
[0m14:12:43.190191 [debug] [Thread-4 (]: Began running node model.rightmove_epc.latest_epc_urn
[0m14:12:43.190643 [info ] [Thread-4 (]: 3 of 17 START sql view model dbt_melissa_rm_epc.latest_epc_urn ................. [RUN]
[0m14:12:43.191226 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.rightmove_epc.latest_epc_urn'
[0m14:12:43.191498 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.latest_epc_urn
[0m14:12:43.194119 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.latest_epc_urn"
[0m14:12:43.195075 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.latest_epc_urn (compile): 14:12:43.191673 => 14:12:43.194862
[0m14:12:43.195354 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.latest_epc_urn
[0m14:12:43.197719 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.latest_epc_urn"
[0m14:12:43.198711 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.latest_epc_urn"
[0m14:12:43.198998 [debug] [Thread-4 (]: On model.rightmove_epc.latest_epc_urn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.latest_epc_urn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn
  
   as (
    with epc_max_date as (

    select uprn as UPRN_EPC,
    MAX(LODGEMENT_DATE) AS MAX_LODGEMENT_DATE,
    from  ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    group by 1


),

latest_epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc
    inner join epc_max_date on epc.uprn = epc_max_date.UPRN_EPC
    where MAX_LODGEMENT_DATE = LODGEMENT_DATE
   -- and uprn = 200073066

)

select DISTINCT * from latest_epc

/*
select uprn, count(*) from latest_epc
group by 1
having count(*) >1
*/
  );
[0m14:12:43.199263 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m14:12:43.255239 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:12:43.256941 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (execute): 14:12:42.564719 => 14:12:43.256814
[0m14:12:43.257186 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: Close
[0m14:12:43.427669 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c033387f-a1e3-4f68-b44d-1f7460891840', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1144a1b10>]}
[0m14:12:43.428154 [info ] [Thread-2 (]: 2 of 17 OK created sql view model dbt_melissa_rm_epc.stg_rightmove ............. [[32mSUCCESS 1[0m in 0.92s]
[0m14:12:43.428499 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.stg_rightmove
[0m14:12:43.428879 [debug] [Thread-1 (]: Began running node model.rightmove_epc.dim_addressid
[0m14:12:43.429110 [debug] [Thread-3 (]: Began running node model.rightmove_epc.latest_rm_urn
[0m14:12:43.429408 [info ] [Thread-1 (]: 4 of 17 START sql view model dbt_melissa_rm_epc.dim_addressid .................. [RUN]
[0m14:12:43.429687 [info ] [Thread-3 (]: 5 of 17 START sql view model dbt_melissa_rm_epc.latest_rm_urn .................. [RUN]
[0m14:12:43.430125 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_epc_certs, now model.rightmove_epc.dim_addressid)
[0m14:12:43.430573 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.rightmove_epc.latest_rm_urn'
[0m14:12:43.430803 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.dim_addressid
[0m14:12:43.431002 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.latest_rm_urn
[0m14:12:43.432969 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.dim_addressid"
[0m14:12:43.434596 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.latest_rm_urn"
[0m14:12:43.435311 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.latest_rm_urn (compile): 14:12:43.433135 => 14:12:43.435177
[0m14:12:43.435579 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.dim_addressid (compile): 14:12:43.431134 => 14:12:43.435427
[0m14:12:43.435826 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.latest_rm_urn
[0m14:12:43.436028 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.dim_addressid
[0m14:12:43.439235 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.latest_rm_urn"
[0m14:12:43.441389 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.dim_addressid"
[0m14:12:43.442393 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.latest_rm_urn"
[0m14:12:43.443103 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.dim_addressid"
[0m14:12:43.443367 [debug] [Thread-3 (]: On model.rightmove_epc.latest_rm_urn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.latest_rm_urn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NOT NULL
),

change_date AS (
    SELECT 
        UPRN AS UPRN_CD, 
        MAX(CHANGE_DATE) AS MAX_CHANGE_DATE 
    FROM rm
    GROUP BY UPRN
),

rm_latest as (

    SELECT distinct * FROM rm
    LEFT JOIN change_date cd
    ON rm.UPRN = cd.UPRN_CD
    WHERE cd.MAX_CHANGE_DATE = rm.CHANGE_DATE 
 --  and UPRN = 100090588560
    
)

select DISTINCT * from rm_latest

/*
select uprn, count(*) from rm_latest
group by 1
having count(*) >1
*/
  );
[0m14:12:43.443658 [debug] [Thread-1 (]: On model.rightmove_epc.dim_addressid: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_addressid"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE ADDRESS'

with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource,
    POSTCODE

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    where REMOVE_FROM_RM_MATCH = 0
    AND ADDRESSID IS NOT NULL

),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    WHERE ADDRESSID IS NOT NULL

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where addressid is not null
  );
[0m14:12:43.443894 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m14:12:43.444088 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:12:44.043967 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:12:44.045675 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.dim_addressid (execute): 14:12:43.439470 => 14:12:44.045553
[0m14:12:44.045901 [debug] [Thread-1 (]: On model.rightmove_epc.dim_addressid: Close
[0m14:12:44.126915 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c033387f-a1e3-4f68-b44d-1f7460891840', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1147eb450>]}
[0m14:12:44.127487 [info ] [Thread-1 (]: 4 of 17 OK created sql view model dbt_melissa_rm_epc.dim_addressid ............. [[32mSUCCESS 1[0m in 0.70s]
[0m14:12:44.127913 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.dim_addressid
[0m14:12:44.128315 [debug] [Thread-2 (]: Began running node model.rightmove_epc.address_match
[0m14:12:44.128650 [info ] [Thread-2 (]: 6 of 17 START sql view model dbt_melissa_rm_epc.address_match .................. [RUN]
[0m14:12:44.129093 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_rightmove, now model.rightmove_epc.address_match)
[0m14:12:44.129301 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.address_match
[0m14:12:44.131360 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.address_match"
[0m14:12:44.133141 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.address_match (compile): 14:12:44.129427 => 14:12:44.133008
[0m14:12:44.133394 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.address_match
[0m14:12:44.135396 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.address_match"
[0m14:12:44.136310 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.address_match"
[0m14:12:44.136546 [debug] [Thread-2 (]: On model.rightmove_epc.address_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.address_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NULL

),

epc_address as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
    where datasource = 'EPC'
)


SELECT rm.*,
CASE WHEN epc_address.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_address.ADDRESSID AS EPC_ADDRESSID,
epc_address.UPRN AS EPC_UPRN


FROM rm
LEFT JOIN epc_address
ON rm.addressid = epc_address.addressid
and rm.FULL_POSTCODE = epc_address.POSTCODE
  );
[0m14:12:44.136760 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m14:12:44.514640 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:12:44.520543 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.latest_epc_urn (execute): 14:12:43.195513 => 14:12:44.520196
[0m14:12:44.521245 [debug] [Thread-4 (]: On model.rightmove_epc.latest_epc_urn: Close
[0m14:12:44.687986 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c033387f-a1e3-4f68-b44d-1f7460891840', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11419e850>]}
[0m14:12:44.688820 [info ] [Thread-4 (]: 3 of 17 OK created sql view model dbt_melissa_rm_epc.latest_epc_urn ............ [[32mSUCCESS 1[0m in 1.50s]
[0m14:12:44.689396 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.latest_epc_urn
[0m14:12:44.689943 [debug] [Thread-1 (]: Began running node model.rightmove_epc.epc_flats
[0m14:12:44.690399 [info ] [Thread-1 (]: 7 of 17 START sql table model dbt_melissa_rm_epc.epc_flats ..................... [RUN]
[0m14:12:44.691083 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.dim_addressid, now model.rightmove_epc.epc_flats)
[0m14:12:44.691437 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.epc_flats
[0m14:12:44.694499 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.epc_flats"
[0m14:12:44.695263 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.epc_flats (compile): 14:12:44.691645 => 14:12:44.695097
[0m14:12:44.695562 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.epc_flats
[0m14:12:44.711626 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.epc_flats"
[0m14:12:44.712655 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.epc_flats"
[0m14:12:44.712940 [debug] [Thread-1 (]: On model.rightmove_epc.epc_flats: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.epc_flats"} */
create or replace transient table ANALYTICS_DEV.dbt_melissa_rm_epc.epc_flats
         as
        (with epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn

),

flat_epc as (

    select uprn,
    count(BUILDING_REFERENCE_NUMBER) as building_ref_count
    from epc
    group by 1
    having count(BUILDING_REFERENCE_NUMBER) >1

),

match_flat_epc as (

    select epc.*,
    building_ref_count
    from epc
    inner join flat_epc on epc.uprn = flat_epc.uprn

)

select * from match_flat_epc
        );
[0m14:12:44.713196 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:12:44.797991 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:12:44.799930 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.latest_rm_urn (execute): 14:12:43.436155 => 14:12:44.799784
[0m14:12:44.800202 [debug] [Thread-3 (]: On model.rightmove_epc.latest_rm_urn: Close
[0m14:12:44.923359 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c033387f-a1e3-4f68-b44d-1f7460891840', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11471ca10>]}
[0m14:12:44.923940 [info ] [Thread-3 (]: 5 of 17 OK created sql view model dbt_melissa_rm_epc.latest_rm_urn ............. [[32mSUCCESS 1[0m in 1.49s]
[0m14:12:44.924364 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.latest_rm_urn
[0m14:12:44.924839 [debug] [Thread-4 (]: Began running node model.rightmove_epc.false_listings
[0m14:12:44.925206 [info ] [Thread-4 (]: 8 of 17 START sql table model dbt_melissa_rm_epc.false_listings ................ [RUN]
[0m14:12:44.925727 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.latest_epc_urn, now model.rightmove_epc.false_listings)
[0m14:12:44.925997 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.false_listings
[0m14:12:44.928278 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.false_listings"
[0m14:12:44.928983 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.false_listings (compile): 14:12:44.926157 => 14:12:44.928805
[0m14:12:44.929253 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.false_listings
[0m14:12:44.931316 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.false_listings"
[0m14:12:44.932179 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.false_listings"
[0m14:12:44.932463 [debug] [Thread-4 (]: On model.rightmove_epc.false_listings: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.false_listings"} */
create or replace transient table ANALYTICS_DEV.dbt_melissa_rm_epc.false_listings
         as
        (with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn

),

false_rm as (

    select 
    uprn,
    count(LISTING_ID) listing_count
    from rm
    group by 1
    having count(LISTING_ID) >1

),

get_false as (

    select rm.*,
    listing_count

    from rm
    inner join false_rm
    on rm.uprn = false_rm.uprn

)

select * from get_false
order by uprn
        );
[0m14:12:44.932711 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m14:12:45.076750 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:12:45.078467 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.address_match (execute): 14:12:44.133552 => 14:12:45.078341
[0m14:12:45.078712 [debug] [Thread-2 (]: On model.rightmove_epc.address_match: Close
[0m14:12:45.253691 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c033387f-a1e3-4f68-b44d-1f7460891840', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x115313090>]}
[0m14:12:45.254199 [info ] [Thread-2 (]: 6 of 17 OK created sql view model dbt_melissa_rm_epc.address_match ............. [[32mSUCCESS 1[0m in 1.12s]
[0m14:12:45.254547 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.address_match
[0m14:14:06.369354 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 81.0 seconds
[0m14:14:06.372200 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.false_listings (execute): 14:12:44.929406 => 14:14:06.372065
[0m14:14:06.372449 [debug] [Thread-4 (]: On model.rightmove_epc.false_listings: Close
[0m14:14:06.443000 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c033387f-a1e3-4f68-b44d-1f7460891840', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x115346890>]}
[0m14:14:06.443506 [info ] [Thread-4 (]: 8 of 17 OK created sql table model dbt_melissa_rm_epc.false_listings ........... [[32mSUCCESS 1[0m in 81.52s]
[0m14:14:06.443875 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.false_listings
[0m14:14:23.982908 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 99.0 seconds
[0m14:14:23.986707 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.epc_flats (execute): 14:12:44.695734 => 14:14:23.986497
[0m14:14:23.987103 [debug] [Thread-1 (]: On model.rightmove_epc.epc_flats: Close
[0m14:14:24.102521 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c033387f-a1e3-4f68-b44d-1f7460891840', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11426fb50>]}
[0m14:14:24.103332 [info ] [Thread-1 (]: 7 of 17 OK created sql table model dbt_melissa_rm_epc.epc_flats ................ [[32mSUCCESS 1[0m in 99.41s]
[0m14:14:24.103972 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.epc_flats
[0m14:14:24.104671 [debug] [Thread-3 (]: Began running node model.rightmove_epc.dim_uprn
[0m14:14:24.105153 [info ] [Thread-3 (]: 9 of 17 START sql view model dbt_melissa_rm_epc.dim_uprn ....................... [RUN]
[0m14:14:24.106415 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.latest_rm_urn, now model.rightmove_epc.dim_uprn)
[0m14:14:24.107023 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.dim_uprn
[0m14:14:24.110697 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.dim_uprn"
[0m14:14:24.111617 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.dim_uprn (compile): 14:14:24.107315 => 14:14:24.111418
[0m14:14:24.111967 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.dim_uprn
[0m14:14:24.117119 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.dim_uprn"
[0m14:14:24.118658 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.dim_uprn"
[0m14:14:24.119067 [debug] [Thread-3 (]: On model.rightmove_epc.dim_uprn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_uprn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE UPRNS


with epc as (

    select distinct
    epc.uprn,
    epc.addressid,
    epc.ADDRESS,
    'EPC' AS datasource,
    epc.POSTCODE,
    multi.uprn as multi_uprn

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc
    left join ANALYTICS_DEV.dbt_melissa_rm_epc.epc_flats multi on epc.uprn = multi.uprn
    
    where epc.REMOVE_FROM_RM_MATCH = 0
    AND epc.UPRN IS NOT NULL
),

rightmove as (

 select distinct
    rm.uprn,
    rm.addressid,
    concat(rm.ADDRESS_1,',',rm.ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    rm.FULL_POSTCODE AS POSTCODE,
    multi.uprn as multi_uprn

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove rm
    left join ANALYTICS_DEV.dbt_melissa_rm_epc.false_listings multi on rm.uprn = multi.uprn
    WHERE UPRN IS NOT NULL


),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where uprn is not null
  );
[0m14:14:24.119675 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m14:14:24.652657 [debug] [Thread-3 (]: Snowflake adapter: Snowflake query id: 01b344f6-0103-9b8b-0000-71950637863a
[0m14:14:24.653027 [debug] [Thread-3 (]: Snowflake adapter: Snowflake error: 002028 (42601): SQL compilation error:
ambiguous column name 'UPRN'
[0m14:14:24.653444 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.dim_uprn (execute): 14:14:24.112178 => 14:14:24.653296
[0m14:14:24.653716 [debug] [Thread-3 (]: On model.rightmove_epc.dim_uprn: Close
[0m14:14:24.754388 [debug] [Thread-3 (]: Database Error in model dim_uprn (models/bridge/dim_uprn.sql)
  002028 (42601): SQL compilation error:
  ambiguous column name 'UPRN'
  compiled Code at target/run/rightmove_epc/models/bridge/dim_uprn.sql
[0m14:14:24.754842 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c033387f-a1e3-4f68-b44d-1f7460891840', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114256010>]}
[0m14:14:24.755272 [error] [Thread-3 (]: 9 of 17 ERROR creating sql view model dbt_melissa_rm_epc.dim_uprn .............. [[31mERROR[0m in 0.65s]
[0m14:14:24.755688 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.dim_uprn
[0m14:14:24.756259 [debug] [Thread-4 (]: Began running node model.rightmove_epc.no_uprn_match
[0m14:14:24.756509 [debug] [Thread-1 (]: Began running node model.rightmove_epc.uprn_match
[0m14:14:24.756833 [info ] [Thread-4 (]: 10 of 17 SKIP relation dbt_melissa_rm_epc.no_uprn_match ........................ [[33mSKIP[0m]
[0m14:14:24.757153 [info ] [Thread-1 (]: 11 of 17 SKIP relation dbt_melissa_rm_epc.uprn_match ........................... [[33mSKIP[0m]
[0m14:14:24.757437 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.no_uprn_match
[0m14:14:24.757686 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.uprn_match
[0m14:14:24.758030 [debug] [Thread-1 (]: Began running node model.rightmove_epc.uprn_address_match
[0m14:14:24.758356 [debug] [Thread-2 (]: Began running node model.rightmove_epc.flats_report
[0m14:14:24.758808 [debug] [Thread-4 (]: Began running node model.rightmove_epc.houses_report
[0m14:14:24.758614 [info ] [Thread-1 (]: 12 of 17 SKIP relation dbt_melissa_rm_epc.uprn_address_match ................... [[33mSKIP[0m]
[0m14:14:24.759114 [info ] [Thread-2 (]: 13 of 17 SKIP relation dbt_melissa_rm_epc.flats_report ......................... [[33mSKIP[0m]
[0m14:14:24.759375 [info ] [Thread-4 (]: 14 of 17 SKIP relation dbt_melissa_rm_epc.houses_report ........................ [[33mSKIP[0m]
[0m14:14:24.759639 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.uprn_address_match
[0m14:14:24.759877 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.flats_report
[0m14:14:24.760103 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.houses_report
[0m14:14:24.760495 [debug] [Thread-4 (]: Began running node model.rightmove_epc.rm_all_matches
[0m14:14:24.760731 [debug] [Thread-3 (]: Began running node model.rightmove_epc.rm_no_matches
[0m14:14:24.760996 [info ] [Thread-4 (]: 15 of 17 SKIP relation dbt_melissa_rm_epc.rm_all_matches ....................... [[33mSKIP[0m]
[0m14:14:24.761336 [debug] [Thread-2 (]: Began running node model.rightmove_epc.zero_bedrooms
[0m14:14:24.761620 [info ] [Thread-3 (]: 16 of 17 SKIP relation dbt_melissa_rm_epc.rm_no_matches ........................ [[33mSKIP[0m]
[0m14:14:24.761928 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.rm_all_matches
[0m14:14:24.762195 [info ] [Thread-2 (]: 17 of 17 SKIP relation dbt_melissa_rm_epc.zero_bedrooms ........................ [[33mSKIP[0m]
[0m14:14:24.762492 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.rm_no_matches
[0m14:14:24.762822 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.zero_bedrooms
[0m14:14:24.764152 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:14:24.764414 [debug] [MainThread]: Connection 'model.rightmove_epc.epc_flats' was properly closed.
[0m14:14:24.764588 [debug] [MainThread]: Connection 'model.rightmove_epc.address_match' was properly closed.
[0m14:14:24.764748 [debug] [MainThread]: Connection 'model.rightmove_epc.false_listings' was properly closed.
[0m14:14:24.764897 [debug] [MainThread]: Connection 'model.rightmove_epc.dim_uprn' was properly closed.
[0m14:14:24.765144 [info ] [MainThread]: 
[0m14:14:24.765346 [info ] [MainThread]: Finished running 10 view models, 7 table models in 0 hours 1 minutes and 43.79 seconds (103.79s).
[0m14:14:24.766266 [debug] [MainThread]: Command end result
[0m14:14:24.773252 [info ] [MainThread]: 
[0m14:14:24.773547 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m14:14:24.773733 [info ] [MainThread]: 
[0m14:14:24.773910 [error] [MainThread]:   Database Error in model dim_uprn (models/bridge/dim_uprn.sql)
  002028 (42601): SQL compilation error:
  ambiguous column name 'UPRN'
  compiled Code at target/run/rightmove_epc/models/bridge/dim_uprn.sql
[0m14:14:24.774083 [info ] [MainThread]: 
[0m14:14:24.774256 [info ] [MainThread]: Done. PASS=8 WARN=0 ERROR=1 SKIP=8 TOTAL=17
[0m14:14:24.777133 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 104.13763, "process_user_time": 1.687648, "process_kernel_time": 0.239589, "process_mem_max_rss": "136134656", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:14:24.777452 [debug] [MainThread]: Command `dbt run` failed at 14:14:24.777384 after 104.14 seconds
[0m14:14:24.777672 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113787210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113787050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10491a190>]}
[0m14:14:24.777882 [debug] [MainThread]: Flushing usage events
[0m14:16:04.140981 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114c18050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114c5e4d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114c5f050>]}


============================== 14:16:04.144125 | 7d0e1655-2652-4189-8103-b2e2f0c91972 ==============================
[0m14:16:04.144125 [info ] [MainThread]: Running with dbt=1.7.10
[0m14:16:04.144522 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select models/staging', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m14:16:04.344490 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7d0e1655-2652-4189-8103-b2e2f0c91972', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11569d010>]}
[0m14:16:04.384290 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7d0e1655-2652-4189-8103-b2e2f0c91972', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1156afc90>]}
[0m14:16:04.384883 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m14:16:04.394746 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m14:16:04.421201 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:16:04.421494 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:16:04.425286 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7d0e1655-2652-4189-8103-b2e2f0c91972', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x115bad0d0>]}
[0m14:16:04.433464 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7d0e1655-2652-4189-8103-b2e2f0c91972', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x115a3e950>]}
[0m14:16:04.433757 [info ] [MainThread]: Found 19 models, 1 analysis, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m14:16:04.433977 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7d0e1655-2652-4189-8103-b2e2f0c91972', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x115a2c2d0>]}
[0m14:16:04.435163 [info ] [MainThread]: 
[0m14:16:04.435618 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m14:16:04.436422 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m14:16:04.444419 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m14:16:04.444777 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m14:16:04.445137 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:16:05.020880 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 1.0 seconds
[0m14:16:05.023650 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m14:16:05.115739 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m14:16:05.123842 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m14:16:05.124165 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m14:16:05.124429 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:16:05.651852 [debug] [ThreadPool]: SQL status: SUCCESS 17 in 1.0 seconds
[0m14:16:05.653636 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m14:16:05.730375 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7d0e1655-2652-4189-8103-b2e2f0c91972', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1157b0ed0>]}
[0m14:16:05.731189 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:16:05.731516 [info ] [MainThread]: 
[0m14:16:05.733544 [debug] [Thread-1 (]: Began running node model.rightmove_epc.stg_epc_certs
[0m14:16:05.733856 [debug] [Thread-2 (]: Began running node model.rightmove_epc.stg_rightmove
[0m14:16:05.734232 [info ] [Thread-1 (]: 1 of 2 START sql view model dbt_melissa_rm_epc.stg_epc_certs ................... [RUN]
[0m14:16:05.734573 [info ] [Thread-2 (]: 2 of 2 START sql view model dbt_melissa_rm_epc.stg_rightmove ................... [RUN]
[0m14:16:05.735085 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.stg_epc_certs)
[0m14:16:05.735578 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.stg_rightmove'
[0m14:16:05.735836 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.stg_epc_certs
[0m14:16:05.736073 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.stg_rightmove
[0m14:16:05.742812 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.stg_epc_certs"
[0m14:16:05.777332 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.stg_rightmove"
[0m14:16:05.778428 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (compile): 14:16:05.743085 => 14:16:05.778296
[0m14:16:05.778692 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (compile): 14:16:05.736235 => 14:16:05.778551
[0m14:16:05.778906 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.stg_rightmove
[0m14:16:05.779103 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.stg_epc_certs
[0m14:16:05.794450 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.stg_rightmove"
[0m14:16:05.796364 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.stg_epc_certs"
[0m14:16:05.797437 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.stg_rightmove"
[0m14:16:05.798125 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.stg_epc_certs"
[0m14:16:05.798400 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_rightmove"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
  
   as (
    with rm as (

    SELECT 
    LISTING_ID,
    CHANGE_DATE,
    UPPER(TRIM(replace(REPLACE(CONCAT(ADDRESS_1::VARCHAR,ADDRESS_2::VARCHAR),' '),','))) AS ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, 
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    BEDROOM,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
 --   STUDENTLET_FLAG,
    COMBINED_PROPERTY_TYPE
    -- property type
    FROM 
       ANALYTICS.RIGHTMOVE_PROD.CLEAN_RAW_RIGHTMOVE_DATA 

 
)

SELECT * FROM rm
  );
[0m14:16:05.798775 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_epc_certs"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
  
   as (
    WITH epc_certs as (
    
    select 
    UPRN,
    LODGEMENT_DATE,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
   -- COUNTY,
    LOCAL_AUTHORITY as LOCAL_AUTHORITY_CODE,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    UPPER(CASE WHEN (UPPER(ADDRESS1) LIKE 'FLAT%' OR UPPER(ADDRESS1) LIKE 'UNIT%') or UPPER(ADDRESS1) LIKE 'ROOM%' 
    THEN TRIM(REPLACE(REPLACE(CONCAT(ADDRESS),','),' '))
    ELSE trim(replace(replace(ADDRESS1,' '),',')) END) AS ADDRESSID,
    CASE WHEN UPRN is null and addressid is null THEN 1 else 0 end as REMOVE_FROM_RM_MATCH,
    FLOOR_LEVEL,
    FLAT_TOP_STOREY,
    FLAT_STOREY_COUNT,
    PROPERTY_TYPE
 from  RAW.EPC_TEST_DATA.EPC_CERTIFICATES 

)

SELECT * FROM epc_certs
  );
[0m14:16:05.799077 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m14:16:05.799322 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:16:06.437737 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:16:06.453260 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (execute): 14:16:05.794660 => 14:16:06.453113
[0m14:16:06.453548 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: Close
[0m14:16:06.469759 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:16:06.471528 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (execute): 14:16:05.779220 => 14:16:06.471395
[0m14:16:06.471783 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: Close
[0m14:16:06.532439 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7d0e1655-2652-4189-8103-b2e2f0c91972', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1157e7590>]}
[0m14:16:06.533057 [info ] [Thread-1 (]: 1 of 2 OK created sql view model dbt_melissa_rm_epc.stg_epc_certs .............. [[32mSUCCESS 1[0m in 0.80s]
[0m14:16:06.533488 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.stg_epc_certs
[0m14:16:06.547334 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7d0e1655-2652-4189-8103-b2e2f0c91972', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x115b64e10>]}
[0m14:16:06.547849 [info ] [Thread-2 (]: 2 of 2 OK created sql view model dbt_melissa_rm_epc.stg_rightmove .............. [[32mSUCCESS 1[0m in 0.81s]
[0m14:16:06.548243 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.stg_rightmove
[0m14:16:06.549367 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:16:06.549578 [debug] [MainThread]: Connection 'model.rightmove_epc.stg_epc_certs' was properly closed.
[0m14:16:06.549756 [debug] [MainThread]: Connection 'model.rightmove_epc.stg_rightmove' was properly closed.
[0m14:16:06.549978 [info ] [MainThread]: 
[0m14:16:06.550187 [info ] [MainThread]: Finished running 2 view models in 0 hours 0 minutes and 2.11 seconds (2.11s).
[0m14:16:06.550623 [debug] [MainThread]: Command end result
[0m14:16:06.556555 [info ] [MainThread]: 
[0m14:16:06.556821 [info ] [MainThread]: [32mCompleted successfully[0m
[0m14:16:06.557004 [info ] [MainThread]: 
[0m14:16:06.557196 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m14:16:06.559025 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 2.4538205, "process_user_time": 1.350878, "process_kernel_time": 0.1856, "process_mem_max_rss": "133398528", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:16:06.559423 [debug] [MainThread]: Command `dbt run` succeeded at 14:16:06.559323 after 2.45 seconds
[0m14:16:06.559670 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114c84bd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114c87310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x115857490>]}
[0m14:16:06.559918 [debug] [MainThread]: Flushing usage events
[0m14:16:24.164621 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111f54090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111f99c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111f9b050>]}


============================== 14:16:24.167695 | 0950a04b-8ac1-4038-987a-22820813e935 ==============================
[0m14:16:24.167695 [info ] [MainThread]: Running with dbt=1.7.10
[0m14:16:24.168070 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt run --select models/bridge', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m14:16:24.357576 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0950a04b-8ac1-4038-987a-22820813e935', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111f57010>]}
[0m14:16:24.399118 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0950a04b-8ac1-4038-987a-22820813e935', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11323b610>]}
[0m14:16:24.399858 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m14:16:24.410369 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m14:16:24.438256 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:16:24.438583 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:16:24.442540 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0950a04b-8ac1-4038-987a-22820813e935', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1136099d0>]}
[0m14:16:24.449853 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0950a04b-8ac1-4038-987a-22820813e935', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1134b0390>]}
[0m14:16:24.450143 [info ] [MainThread]: Found 19 models, 1 analysis, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m14:16:24.450374 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0950a04b-8ac1-4038-987a-22820813e935', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113390250>]}
[0m14:16:24.451629 [info ] [MainThread]: 
[0m14:16:24.452106 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m14:16:24.452934 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m14:16:24.460510 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m14:16:24.460795 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m14:16:24.460974 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:16:24.965310 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 1.0 seconds
[0m14:16:24.968351 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m14:16:25.069571 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m14:16:25.078212 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m14:16:25.078637 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m14:16:25.078938 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:16:25.655631 [debug] [ThreadPool]: SQL status: SUCCESS 17 in 1.0 seconds
[0m14:16:25.657136 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m14:16:25.737472 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0950a04b-8ac1-4038-987a-22820813e935', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113626210>]}
[0m14:16:25.738156 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:16:25.738430 [info ] [MainThread]: 
[0m14:16:25.740938 [debug] [Thread-1 (]: Began running node model.rightmove_epc.dim_addressid
[0m14:16:25.741253 [debug] [Thread-2 (]: Began running node model.rightmove_epc.latest_epc_urn
[0m14:16:25.741565 [info ] [Thread-1 (]: 1 of 4 START sql view model dbt_melissa_rm_epc.dim_addressid ................... [RUN]
[0m14:16:25.741870 [debug] [Thread-3 (]: Began running node model.rightmove_epc.latest_rm_urn
[0m14:16:25.742204 [info ] [Thread-2 (]: 2 of 4 START sql view model dbt_melissa_rm_epc.latest_epc_urn .................. [RUN]
[0m14:16:25.742679 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.dim_addressid)
[0m14:16:25.742957 [info ] [Thread-3 (]: 3 of 4 START sql view model dbt_melissa_rm_epc.latest_rm_urn ................... [RUN]
[0m14:16:25.743418 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.latest_epc_urn'
[0m14:16:25.743652 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.dim_addressid
[0m14:16:25.744068 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.rightmove_epc.latest_rm_urn'
[0m14:16:25.744289 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.latest_epc_urn
[0m14:16:25.783123 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.dim_addressid"
[0m14:16:25.783422 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.latest_rm_urn
[0m14:16:25.785171 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.latest_epc_urn"
[0m14:16:25.786741 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.latest_rm_urn"
[0m14:16:25.787320 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.dim_addressid (compile): 14:16:25.744435 => 14:16:25.787188
[0m14:16:25.787544 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.dim_addressid
[0m14:16:25.793471 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.latest_epc_urn (compile): 14:16:25.783560 => 14:16:25.793313
[0m14:16:25.800072 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.latest_epc_urn
[0m14:16:25.803636 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.dim_addressid"
[0m14:16:25.805733 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.latest_epc_urn"
[0m14:16:25.806039 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.latest_rm_urn (compile): 14:16:25.785385 => 14:16:25.805890
[0m14:16:25.806418 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.latest_rm_urn
[0m14:16:25.808554 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.latest_rm_urn"
[0m14:16:25.809136 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.latest_epc_urn"
[0m14:16:25.809744 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.dim_addressid"
[0m14:16:25.810035 [debug] [Thread-2 (]: On model.rightmove_epc.latest_epc_urn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.latest_epc_urn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn
  
   as (
    with epc_max_date as (

    select uprn as UPRN_EPC,
    MAX(LODGEMENT_DATE) AS MAX_LODGEMENT_DATE,
    from  ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    group by 1


),

latest_epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc
    inner join epc_max_date on epc.uprn = epc_max_date.UPRN_EPC
    where MAX_LODGEMENT_DATE = LODGEMENT_DATE
   -- and uprn = 200073066

)

select DISTINCT * from latest_epc


/*
select uprn, count(*) from latest_epc
group by 1
having count(*) >1
*/
  );
[0m14:16:25.810315 [debug] [Thread-1 (]: On model.rightmove_epc.dim_addressid: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_addressid"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE ADDRESS'

with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource,
    POSTCODE

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    where REMOVE_FROM_RM_MATCH = 0
    AND ADDRESSID IS NOT NULL

),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    WHERE ADDRESSID IS NOT NULL

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where addressid is not null
  );
[0m14:16:25.810544 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m14:16:25.811029 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.latest_rm_urn"
[0m14:16:25.811224 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:16:25.811837 [debug] [Thread-3 (]: On model.rightmove_epc.latest_rm_urn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.latest_rm_urn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NOT NULL
),

change_date AS (
    SELECT 
        UPRN AS UPRN_CD, 
        MAX(CHANGE_DATE) AS MAX_CHANGE_DATE 
    FROM rm
    GROUP BY UPRN
),

rm_latest as (

    SELECT distinct * FROM rm
    LEFT JOIN change_date cd
    ON rm.UPRN = cd.UPRN_CD
    WHERE cd.MAX_CHANGE_DATE = rm.CHANGE_DATE 
 --  and UPRN = 100090588560
    
)

select DISTINCT * from rm_latest

/*
select uprn, count(*) from rm_latest
group by 1
having count(*) >1
*/
  );
[0m14:16:25.812819 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m14:16:26.348988 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:16:26.349710 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:16:26.366675 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.latest_rm_urn (execute): 14:16:25.806626 => 14:16:26.366516
[0m14:16:26.367192 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:16:26.368922 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.dim_addressid (execute): 14:16:25.787664 => 14:16:26.368790
[0m14:16:26.369200 [debug] [Thread-3 (]: On model.rightmove_epc.latest_rm_urn: Close
[0m14:16:26.370745 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.latest_epc_urn (execute): 14:16:25.803880 => 14:16:26.370621
[0m14:16:26.370980 [debug] [Thread-1 (]: On model.rightmove_epc.dim_addressid: Close
[0m14:16:26.371824 [debug] [Thread-2 (]: On model.rightmove_epc.latest_epc_urn: Close
[0m14:16:26.453142 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0950a04b-8ac1-4038-987a-22820813e935', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1135888d0>]}
[0m14:16:26.453733 [info ] [Thread-3 (]: 3 of 4 OK created sql view model dbt_melissa_rm_epc.latest_rm_urn .............. [[32mSUCCESS 1[0m in 0.71s]
[0m14:16:26.454168 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.latest_rm_urn
[0m14:16:26.457596 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0950a04b-8ac1-4038-987a-22820813e935', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11350e550>]}
[0m14:16:26.458005 [info ] [Thread-1 (]: 1 of 4 OK created sql view model dbt_melissa_rm_epc.dim_addressid .............. [[32mSUCCESS 1[0m in 0.72s]
[0m14:16:26.458381 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.dim_addressid
[0m14:16:26.472564 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0950a04b-8ac1-4038-987a-22820813e935', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113638b10>]}
[0m14:16:26.473049 [info ] [Thread-2 (]: 2 of 4 OK created sql view model dbt_melissa_rm_epc.latest_epc_urn ............. [[32mSUCCESS 1[0m in 0.73s]
[0m14:16:26.473413 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.latest_epc_urn
[0m14:16:26.473850 [debug] [Thread-4 (]: Began running node model.rightmove_epc.dim_uprn
[0m14:16:26.474216 [info ] [Thread-4 (]: 4 of 4 START sql view model dbt_melissa_rm_epc.dim_uprn ........................ [RUN]
[0m14:16:26.474826 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_uprn'
[0m14:16:26.475093 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.dim_uprn
[0m14:16:26.477396 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.dim_uprn"
[0m14:16:26.478326 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_uprn (compile): 14:16:26.475243 => 14:16:26.478187
[0m14:16:26.478559 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.dim_uprn
[0m14:16:26.481117 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.dim_uprn"
[0m14:16:26.482224 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.dim_uprn"
[0m14:16:26.482492 [debug] [Thread-4 (]: On model.rightmove_epc.dim_uprn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_uprn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE UPRNS


with epc as (

    select distinct
    epc.uprn,
    epc.addressid,
    epc.ADDRESS,
    'EPC' AS datasource,
    epc.POSTCODE,
    multi.uprn as multi_uprn

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc
    left join ANALYTICS_DEV.dbt_melissa_rm_epc.epc_flats_count multi on epc.uprn = multi.uprn

    where epc.REMOVE_FROM_RM_MATCH = 0
    AND epc.UPRN IS NOT NULL
),

rightmove as (

 select distinct
    rm.uprn,
    rm.addressid,
    concat(rm.ADDRESS_1,',',rm.ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    rm.FULL_POSTCODE AS POSTCODE,
    multi.uprn as multi_uprn

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove rm
    left join ANALYTICS_DEV.dbt_melissa_rm_epc.false_listings_count multi on rm.uprn = multi.uprn
    WHERE UPRN IS NOT NULL


),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where uprn is not null
  );
[0m14:16:26.482732 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m14:16:26.820991 [debug] [Thread-4 (]: Snowflake adapter: Snowflake query id: 01b344f8-0103-9b63-0000-71950637933a
[0m14:16:26.821493 [debug] [Thread-4 (]: Snowflake adapter: Snowflake error: 002003 (42S02): SQL compilation error:
Object 'ANALYTICS_DEV.DBT_MELISSA_RM_EPC.EPC_FLATS_COUNT' does not exist or not authorized.
[0m14:16:26.822034 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_uprn (execute): 14:16:26.478698 => 14:16:26.821830
[0m14:16:26.822389 [debug] [Thread-4 (]: On model.rightmove_epc.dim_uprn: Close
[0m14:16:26.936088 [debug] [Thread-4 (]: Database Error in model dim_uprn (models/bridge/dim_uprn.sql)
  002003 (42S02): SQL compilation error:
  Object 'ANALYTICS_DEV.DBT_MELISSA_RM_EPC.EPC_FLATS_COUNT' does not exist or not authorized.
  compiled Code at target/run/rightmove_epc/models/bridge/dim_uprn.sql
[0m14:16:26.936688 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0950a04b-8ac1-4038-987a-22820813e935', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113769910>]}
[0m14:16:26.937260 [error] [Thread-4 (]: 4 of 4 ERROR creating sql view model dbt_melissa_rm_epc.dim_uprn ............... [[31mERROR[0m in 0.46s]
[0m14:16:26.937836 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.dim_uprn
[0m14:16:26.939522 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:16:26.939849 [debug] [MainThread]: Connection 'model.rightmove_epc.dim_addressid' was properly closed.
[0m14:16:26.940116 [debug] [MainThread]: Connection 'model.rightmove_epc.latest_epc_urn' was properly closed.
[0m14:16:26.940365 [debug] [MainThread]: Connection 'model.rightmove_epc.latest_rm_urn' was properly closed.
[0m14:16:26.940602 [debug] [MainThread]: Connection 'model.rightmove_epc.dim_uprn' was properly closed.
[0m14:16:26.940909 [info ] [MainThread]: 
[0m14:16:26.941205 [info ] [MainThread]: Finished running 4 view models in 0 hours 0 minutes and 2.49 seconds (2.49s).
[0m14:16:26.942032 [debug] [MainThread]: Command end result
[0m14:16:26.951478 [info ] [MainThread]: 
[0m14:16:26.951849 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m14:16:26.952097 [info ] [MainThread]: 
[0m14:16:26.952338 [error] [MainThread]:   Database Error in model dim_uprn (models/bridge/dim_uprn.sql)
  002003 (42S02): SQL compilation error:
  Object 'ANALYTICS_DEV.DBT_MELISSA_RM_EPC.EPC_FLATS_COUNT' does not exist or not authorized.
  compiled Code at target/run/rightmove_epc/models/bridge/dim_uprn.sql
[0m14:16:26.952583 [info ] [MainThread]: 
[0m14:16:26.952835 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=1 SKIP=0 TOTAL=4
[0m14:16:26.954945 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 2.825447, "process_user_time": 1.437853, "process_kernel_time": 0.178214, "process_mem_max_rss": "138625024", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:16:26.955502 [debug] [MainThread]: Command `dbt run` failed at 14:16:26.955401 after 2.83 seconds
[0m14:16:26.955833 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1119d36d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1034fa0d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1033be350>]}
[0m14:16:26.956136 [debug] [MainThread]: Flushing usage events
[0m14:16:47.848177 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114718150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11475e790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11475f310>]}


============================== 14:16:47.851623 | e24a66c1-2ede-4614-b0e0-d11b80ba32ee ==============================
[0m14:16:47.851623 [info ] [MainThread]: Running with dbt=1.7.10
[0m14:16:47.852034 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --select models/matching', 'send_anonymous_usage_stats': 'True'}
[0m14:16:48.040492 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e24a66c1-2ede-4614-b0e0-d11b80ba32ee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1147a8190>]}
[0m14:16:48.080267 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e24a66c1-2ede-4614-b0e0-d11b80ba32ee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114fc8350>]}
[0m14:16:48.081284 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m14:16:48.091861 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m14:16:48.122353 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:16:48.122678 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:16:48.126660 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e24a66c1-2ede-4614-b0e0-d11b80ba32ee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1150de890>]}
[0m14:16:48.134231 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e24a66c1-2ede-4614-b0e0-d11b80ba32ee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11522b090>]}
[0m14:16:48.134516 [info ] [MainThread]: Found 19 models, 1 analysis, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m14:16:48.134736 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e24a66c1-2ede-4614-b0e0-d11b80ba32ee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x115527ed0>]}
[0m14:16:48.136015 [info ] [MainThread]: 
[0m14:16:48.136449 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m14:16:48.137218 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m14:16:48.144628 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m14:16:48.144900 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m14:16:48.145083 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:16:48.605824 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 0.0 seconds
[0m14:16:48.608533 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m14:16:48.683047 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m14:16:48.690636 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m14:16:48.690975 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m14:16:48.691244 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:16:49.032077 [debug] [ThreadPool]: SQL status: SUCCESS 17 in 0.0 seconds
[0m14:16:49.036353 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m14:16:49.121634 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e24a66c1-2ede-4614-b0e0-d11b80ba32ee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11508d590>]}
[0m14:16:49.122659 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:16:49.123065 [info ] [MainThread]: 
[0m14:16:49.126625 [debug] [Thread-1 (]: Began running node model.rightmove_epc.address_match
[0m14:16:49.127021 [debug] [Thread-2 (]: Began running node model.rightmove_epc.epc_flats_count
[0m14:16:49.127428 [debug] [Thread-3 (]: Began running node model.rightmove_epc.false_listings_count
[0m14:16:49.127987 [info ] [Thread-1 (]: 1 of 6 START sql view model dbt_melissa_rm_epc.address_match ................... [RUN]
[0m14:16:49.128722 [info ] [Thread-2 (]: 2 of 6 START sql view model dbt_melissa_rm_epc.epc_flats_count ................. [RUN]
[0m14:16:49.129244 [info ] [Thread-3 (]: 3 of 6 START sql view model dbt_melissa_rm_epc.false_listings_count ............ [RUN]
[0m14:16:49.129973 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.address_match)
[0m14:16:49.130676 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.epc_flats_count'
[0m14:16:49.131337 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.rightmove_epc.false_listings_count'
[0m14:16:49.131686 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.address_match
[0m14:16:49.132011 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.epc_flats_count
[0m14:16:49.132318 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.false_listings_count
[0m14:16:49.175619 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.epc_flats_count"
[0m14:16:49.176268 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.address_match"
[0m14:16:49.177759 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.false_listings_count"
[0m14:16:49.179219 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.epc_flats_count (compile): 14:16:49.174007 => 14:16:49.179089
[0m14:16:49.179548 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.false_listings_count (compile): 14:16:49.176505 => 14:16:49.179396
[0m14:16:49.179743 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.epc_flats_count
[0m14:16:49.180052 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.address_match (compile): 14:16:49.132523 => 14:16:49.179850
[0m14:16:49.180278 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.false_listings_count
[0m14:16:49.195276 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.epc_flats_count"
[0m14:16:49.195546 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.address_match
[0m14:16:49.197350 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.false_listings_count"
[0m14:16:49.199177 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.address_match"
[0m14:16:49.199790 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.epc_flats_count"
[0m14:16:49.200062 [debug] [Thread-2 (]: On model.rightmove_epc.epc_flats_count: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.epc_flats_count"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.epc_flats_count
  
   as (
    with epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn

),

flat_epc as (

    select uprn,
    count(BUILDING_REFERENCE_NUMBER) as building_ref_count
    from epc
    group by 1
    having count(BUILDING_REFERENCE_NUMBER) >1

)

select * from flat_epc
  );
[0m14:16:49.200507 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.false_listings_count"
[0m14:16:49.200710 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m14:16:49.201235 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.address_match"
[0m14:16:49.201440 [debug] [Thread-3 (]: On model.rightmove_epc.false_listings_count: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.false_listings_count"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.false_listings_count
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn

),

false_rm as (

    select 
    uprn,
    count(LISTING_ID) listing_count
    from rm
    group by 1
    having count(LISTING_ID) >1

)

select * from false_rm
  );
[0m14:16:49.202054 [debug] [Thread-1 (]: On model.rightmove_epc.address_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.address_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NULL

),

epc_address as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
    where datasource = 'EPC'
)


SELECT rm.*,
CASE WHEN epc_address.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_address.ADDRESSID AS EPC_ADDRESSID,
epc_address.UPRN AS EPC_UPRN


FROM rm
LEFT JOIN epc_address
ON rm.addressid = epc_address.addressid
and rm.FULL_POSTCODE = epc_address.POSTCODE
  );
[0m14:16:49.202454 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m14:16:49.202670 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:16:49.670486 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m14:16:49.688021 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.false_listings_count (execute): 14:16:49.195701 => 14:16:49.687845
[0m14:16:49.688874 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m14:16:49.689161 [debug] [Thread-3 (]: On model.rightmove_epc.false_listings_count: Close
[0m14:16:49.690852 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.epc_flats_count (execute): 14:16:49.180428 => 14:16:49.690707
[0m14:16:49.691833 [debug] [Thread-2 (]: On model.rightmove_epc.epc_flats_count: Close
[0m14:16:49.768317 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e24a66c1-2ede-4614-b0e0-d11b80ba32ee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x115246990>]}
[0m14:16:49.769139 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e24a66c1-2ede-4614-b0e0-d11b80ba32ee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1155f2f50>]}
[0m14:16:49.769966 [info ] [Thread-3 (]: 3 of 6 OK created sql view model dbt_melissa_rm_epc.false_listings_count ....... [[32mSUCCESS 1[0m in 0.64s]
[0m14:16:49.770663 [info ] [Thread-2 (]: 2 of 6 OK created sql view model dbt_melissa_rm_epc.epc_flats_count ............ [[32mSUCCESS 1[0m in 0.64s]
[0m14:16:49.771404 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.false_listings_count
[0m14:16:49.771952 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.epc_flats_count
[0m14:16:49.772732 [debug] [Thread-4 (]: Began running node model.rightmove_epc.no_uprn_match
[0m14:16:49.773120 [debug] [Thread-3 (]: Began running node model.rightmove_epc.uprn_match
[0m14:16:49.773591 [info ] [Thread-4 (]: 4 of 6 START sql view model dbt_melissa_rm_epc.no_uprn_match ................... [RUN]
[0m14:16:49.774011 [info ] [Thread-3 (]: 5 of 6 START sql view model dbt_melissa_rm_epc.uprn_match ...................... [RUN]
[0m14:16:49.774690 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.rightmove_epc.no_uprn_match'
[0m14:16:49.775271 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.false_listings_count, now model.rightmove_epc.uprn_match)
[0m14:16:49.775664 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.no_uprn_match
[0m14:16:49.776066 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.uprn_match
[0m14:16:49.779139 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.no_uprn_match"
[0m14:16:49.781559 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.uprn_match"
[0m14:16:49.782512 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.no_uprn_match (compile): 14:16:49.776335 => 14:16:49.782263
[0m14:16:49.782896 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.uprn_match (compile): 14:16:49.779432 => 14:16:49.782707
[0m14:16:49.783202 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.no_uprn_match
[0m14:16:49.783475 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.uprn_match
[0m14:16:49.786108 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.no_uprn_match"
[0m14:16:49.789466 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.uprn_match"
[0m14:16:49.790376 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.no_uprn_match"
[0m14:16:49.791098 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.uprn_match"
[0m14:16:49.791373 [debug] [Thread-4 (]: On model.rightmove_epc.no_uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.no_uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.no_uprn_match
  
   as (
    with rm_latest as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn 
    where UPRN IS NOT NULL
),

epc_uprn as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
    where datasource = 'EPC'
)


SELECT rm_latest.*,
CASE WHEN epc_uprn.UPRN is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_uprn.UPRN AS EPC_UPRN,
epc_uprn.ADDRESSID AS EPC_ADDRESSID


FROM rm_latest
LEFT JOIN epc_uprn
ON rm_latest.UPRN = epc_uprn.UPRN

WHERE MATCH_EPC = 'NO'
  );
[0m14:16:49.791660 [debug] [Thread-3 (]: On model.rightmove_epc.uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
  
   as (
    with rm_latest as (

    select rm.* from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn rm
    left join ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn multi
    where rm.UPRN IS NOT NULL
    and multi.uprn IS NULL 
),

epc_uprn as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
    where datasource = 'EPC'
    and multi_uprn is null
)


SELECT rm_latest.*,
CASE WHEN epc_uprn.UPRN is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_uprn.UPRN AS EPC_UPRN,
epc_uprn.ADDRESSID AS EPC_ADDRESSID


FROM rm_latest
LEFT JOIN epc_uprn
ON rm_latest.UPRN = epc_uprn.UPRN

WHERE MATCH_EPC = 'YES'
  );
[0m14:16:49.791907 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m14:16:49.792115 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m14:16:50.218091 [debug] [Thread-3 (]: Snowflake adapter: Snowflake query id: 01b344f8-0103-9b8b-0000-7195063787fe
[0m14:16:50.218571 [debug] [Thread-3 (]: Snowflake adapter: Snowflake error: 000904 (42000): SQL compilation error: error line 16 at position 8
invalid identifier 'MULTI_UPRN'
[0m14:16:50.219100 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.uprn_match (execute): 14:16:49.786299 => 14:16:50.218902
[0m14:16:50.219457 [debug] [Thread-3 (]: On model.rightmove_epc.uprn_match: Close
[0m14:16:50.300693 [debug] [Thread-3 (]: Database Error in model uprn_match (models/matching/uprn_match.sql)
  000904 (42000): SQL compilation error: error line 16 at position 8
  invalid identifier 'MULTI_UPRN'
  compiled Code at target/run/rightmove_epc/models/matching/uprn_match.sql
[0m14:16:50.301208 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e24a66c1-2ede-4614-b0e0-d11b80ba32ee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x116600e90>]}
[0m14:16:50.301697 [error] [Thread-3 (]: 5 of 6 ERROR creating sql view model dbt_melissa_rm_epc.uprn_match ............. [[31mERROR[0m in 0.53s]
[0m14:16:50.302174 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.uprn_match
[0m14:16:50.308667 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:16:50.312938 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.no_uprn_match (execute): 14:16:49.783639 => 14:16:50.312784
[0m14:16:50.313265 [debug] [Thread-4 (]: On model.rightmove_epc.no_uprn_match: Close
[0m14:16:50.394253 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e24a66c1-2ede-4614-b0e0-d11b80ba32ee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11661b3d0>]}
[0m14:16:50.394870 [info ] [Thread-4 (]: 4 of 6 OK created sql view model dbt_melissa_rm_epc.no_uprn_match .............. [[32mSUCCESS 1[0m in 0.62s]
[0m14:16:50.395353 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.no_uprn_match
[0m14:16:50.395980 [debug] [Thread-2 (]: Began running node model.rightmove_epc.uprn_address_match
[0m14:16:50.396521 [info ] [Thread-2 (]: 6 of 6 START sql view model dbt_melissa_rm_epc.uprn_address_match .............. [RUN]
[0m14:16:50.397187 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.epc_flats_count, now model.rightmove_epc.uprn_address_match)
[0m14:16:50.397504 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.uprn_address_match
[0m14:16:50.400702 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.uprn_address_match"
[0m14:16:50.401913 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.uprn_address_match (compile): 14:16:50.397687 => 14:16:50.401702
[0m14:16:50.402205 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.uprn_address_match
[0m14:16:50.404704 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.uprn_address_match"
[0m14:16:50.405657 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:16:50.407751 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.address_match (execute): 14:16:49.197553 => 14:16:50.407591
[0m14:16:50.408680 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.uprn_address_match"
[0m14:16:50.409038 [debug] [Thread-1 (]: On model.rightmove_epc.address_match: Close
[0m14:16:50.409391 [debug] [Thread-2 (]: On model.rightmove_epc.uprn_address_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.uprn_address_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_address_match
  
   as (
    -- where uprn is not matched we try address.

with uprn as (

    select 
    up.LISTING_ID,
    CHANGE_DATE,
    up.ADDRESSID,
    up.ADDRESS_1,
    up.ADDRESS_2,
    FULL_POSTCODE,
    up.UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    BEDROOM,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
 -- need to sleect the same fields as address match
    CASE WHEN ad.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC,
    ad.ADDRESSID AS EPC_ADDRESSID,
    ad.UPRN AS EPC_UPRN

     from ANALYTICS_DEV.dbt_melissa_rm_epc.no_uprn_match up
    left join ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid ad on up.ADDRESSID = ad.ADDRESSID
    and up.FULL_POSTCODE = ad.POSTCODE
   
)

SELECT * FROM UPRN
  );
[0m14:16:50.410354 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m14:16:50.485514 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e24a66c1-2ede-4614-b0e0-d11b80ba32ee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11526e510>]}
[0m14:16:50.486116 [info ] [Thread-1 (]: 1 of 6 OK created sql view model dbt_melissa_rm_epc.address_match .............. [[32mSUCCESS 1[0m in 1.36s]
[0m14:16:50.486560 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.address_match
[0m14:16:51.028115 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:16:51.031713 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.uprn_address_match (execute): 14:16:50.402369 => 14:16:51.031481
[0m14:16:51.032120 [debug] [Thread-2 (]: On model.rightmove_epc.uprn_address_match: Close
[0m14:16:51.140202 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e24a66c1-2ede-4614-b0e0-d11b80ba32ee', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x115247b50>]}
[0m14:16:51.140940 [info ] [Thread-2 (]: 6 of 6 OK created sql view model dbt_melissa_rm_epc.uprn_address_match ......... [[32mSUCCESS 1[0m in 0.74s]
[0m14:16:51.141430 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.uprn_address_match
[0m14:16:51.142901 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:16:51.143211 [debug] [MainThread]: Connection 'model.rightmove_epc.address_match' was properly closed.
[0m14:16:51.143450 [debug] [MainThread]: Connection 'model.rightmove_epc.uprn_address_match' was properly closed.
[0m14:16:51.143664 [debug] [MainThread]: Connection 'model.rightmove_epc.uprn_match' was properly closed.
[0m14:16:51.143882 [debug] [MainThread]: Connection 'model.rightmove_epc.no_uprn_match' was properly closed.
[0m14:16:51.144148 [info ] [MainThread]: 
[0m14:16:51.144412 [info ] [MainThread]: Finished running 6 view models in 0 hours 0 minutes and 3.01 seconds (3.01s).
[0m14:16:51.145322 [debug] [MainThread]: Command end result
[0m14:16:51.152675 [info ] [MainThread]: 
[0m14:16:51.152994 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m14:16:51.153237 [info ] [MainThread]: 
[0m14:16:51.153463 [error] [MainThread]:   Database Error in model uprn_match (models/matching/uprn_match.sql)
  000904 (42000): SQL compilation error: error line 16 at position 8
  invalid identifier 'MULTI_UPRN'
  compiled Code at target/run/rightmove_epc/models/matching/uprn_match.sql
[0m14:16:51.153694 [info ] [MainThread]: 
[0m14:16:51.153917 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=0 TOTAL=6
[0m14:16:51.155846 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 3.3416388, "process_user_time": 1.533739, "process_kernel_time": 0.179467, "process_mem_max_rss": "137805824", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:16:51.156287 [debug] [MainThread]: Command `dbt run` failed at 14:16:51.156200 after 3.34 seconds
[0m14:16:51.156596 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111a4d950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x115089a90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10514a310>]}
[0m14:16:51.156862 [debug] [MainThread]: Flushing usage events
[0m14:16:57.521862 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108d8ed90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108d9a650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108d9b190>]}


============================== 14:16:57.524288 | 08e4e21d-60a7-43a6-b2a4-b684cbe2a3b3 ==============================
[0m14:16:57.524288 [info ] [MainThread]: Running with dbt=1.7.10
[0m14:16:57.524654 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt run --select models/bridge', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m14:16:57.687673 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '08e4e21d-60a7-43a6-b2a4-b684cbe2a3b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b2b5690>]}
[0m14:16:57.727329 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '08e4e21d-60a7-43a6-b2a4-b684cbe2a3b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b341d50>]}
[0m14:16:57.727810 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m14:16:57.737821 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m14:16:57.757501 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:16:57.757807 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:16:57.761757 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '08e4e21d-60a7-43a6-b2a4-b684cbe2a3b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b5319d0>]}
[0m14:16:57.769245 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '08e4e21d-60a7-43a6-b2a4-b684cbe2a3b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b38aa10>]}
[0m14:16:57.769542 [info ] [MainThread]: Found 19 models, 1 analysis, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m14:16:57.769766 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '08e4e21d-60a7-43a6-b2a4-b684cbe2a3b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b1d9090>]}
[0m14:16:57.771202 [info ] [MainThread]: 
[0m14:16:57.771722 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m14:16:57.772544 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m14:16:57.780033 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m14:16:57.780397 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m14:16:57.780639 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:16:58.111508 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 0.0 seconds
[0m14:16:58.113710 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m14:16:58.194488 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m14:16:58.201884 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m14:16:58.202274 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m14:16:58.202535 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:16:58.520221 [debug] [ThreadPool]: SQL status: SUCCESS 19 in 0.0 seconds
[0m14:16:58.522229 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m14:16:58.609342 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '08e4e21d-60a7-43a6-b2a4-b684cbe2a3b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b282590>]}
[0m14:16:58.610378 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:16:58.610806 [info ] [MainThread]: 
[0m14:16:58.614377 [debug] [Thread-1 (]: Began running node model.rightmove_epc.dim_addressid
[0m14:16:58.614889 [debug] [Thread-2 (]: Began running node model.rightmove_epc.latest_epc_urn
[0m14:16:58.615361 [debug] [Thread-3 (]: Began running node model.rightmove_epc.latest_rm_urn
[0m14:16:58.615846 [info ] [Thread-1 (]: 1 of 4 START sql view model dbt_melissa_rm_epc.dim_addressid ................... [RUN]
[0m14:16:58.616356 [info ] [Thread-2 (]: 2 of 4 START sql view model dbt_melissa_rm_epc.latest_epc_urn .................. [RUN]
[0m14:16:58.616818 [info ] [Thread-3 (]: 3 of 4 START sql view model dbt_melissa_rm_epc.latest_rm_urn ................... [RUN]
[0m14:16:58.617628 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.dim_addressid)
[0m14:16:58.618369 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.latest_epc_urn'
[0m14:16:58.619006 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.rightmove_epc.latest_rm_urn'
[0m14:16:58.619353 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.dim_addressid
[0m14:16:58.619656 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.latest_epc_urn
[0m14:16:58.619922 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.latest_rm_urn
[0m14:16:58.661551 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.dim_addressid"
[0m14:16:58.663398 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.latest_epc_urn"
[0m14:16:58.664868 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.latest_rm_urn"
[0m14:16:58.665480 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.latest_epc_urn (compile): 14:16:58.661827 => 14:16:58.665311
[0m14:16:58.665770 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.dim_addressid (compile): 14:16:58.621873 => 14:16:58.665623
[0m14:16:58.666024 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.latest_rm_urn (compile): 14:16:58.663576 => 14:16:58.665907
[0m14:16:58.666330 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.latest_epc_urn
[0m14:16:58.666542 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.dim_addressid
[0m14:16:58.666725 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.latest_rm_urn
[0m14:16:58.684329 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.dim_addressid"
[0m14:16:58.686914 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.latest_epc_urn"
[0m14:16:58.688752 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.latest_rm_urn"
[0m14:16:58.689623 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.latest_epc_urn"
[0m14:16:58.690180 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.latest_rm_urn"
[0m14:16:58.690773 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.dim_addressid"
[0m14:16:58.690988 [debug] [Thread-2 (]: On model.rightmove_epc.latest_epc_urn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.latest_epc_urn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn
  
   as (
    with epc_max_date as (

    select uprn as UPRN_EPC,
    MAX(LODGEMENT_DATE) AS MAX_LODGEMENT_DATE,
    from  ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    group by 1


),

latest_epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc
    inner join epc_max_date on epc.uprn = epc_max_date.UPRN_EPC
    where MAX_LODGEMENT_DATE = LODGEMENT_DATE
   -- and uprn = 200073066

)

select DISTINCT * from latest_epc


/*
select uprn, count(*) from latest_epc
group by 1
having count(*) >1
*/
  );
[0m14:16:58.691244 [debug] [Thread-3 (]: On model.rightmove_epc.latest_rm_urn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.latest_rm_urn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NOT NULL
),

change_date AS (
    SELECT 
        UPRN AS UPRN_CD, 
        MAX(CHANGE_DATE) AS MAX_CHANGE_DATE 
    FROM rm
    GROUP BY UPRN
),

rm_latest as (

    SELECT distinct * FROM rm
    LEFT JOIN change_date cd
    ON rm.UPRN = cd.UPRN_CD
    WHERE cd.MAX_CHANGE_DATE = rm.CHANGE_DATE 
 --  and UPRN = 100090588560
    
)

select DISTINCT * from rm_latest

/*
select uprn, count(*) from rm_latest
group by 1
having count(*) >1
*/
  );
[0m14:16:58.691483 [debug] [Thread-1 (]: On model.rightmove_epc.dim_addressid: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_addressid"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE ADDRESS'

with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource,
    POSTCODE

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    where REMOVE_FROM_RM_MATCH = 0
    AND ADDRESSID IS NOT NULL

),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    WHERE ADDRESSID IS NOT NULL

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where addressid is not null
  );
[0m14:16:58.691698 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m14:16:58.691873 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m14:16:58.692072 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:16:59.197637 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:16:59.221493 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.dim_addressid (execute): 14:16:58.679429 => 14:16:59.221285
[0m14:16:59.221904 [debug] [Thread-1 (]: On model.rightmove_epc.dim_addressid: Close
[0m14:16:59.247935 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:16:59.250128 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.latest_rm_urn (execute): 14:16:58.687104 => 14:16:59.249963
[0m14:16:59.250452 [debug] [Thread-3 (]: On model.rightmove_epc.latest_rm_urn: Close
[0m14:16:59.253086 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:16:59.254997 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.latest_epc_urn (execute): 14:16:58.666845 => 14:16:59.254855
[0m14:16:59.255335 [debug] [Thread-2 (]: On model.rightmove_epc.latest_epc_urn: Close
[0m14:16:59.303362 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '08e4e21d-60a7-43a6-b2a4-b684cbe2a3b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b47af90>]}
[0m14:16:59.303928 [info ] [Thread-1 (]: 1 of 4 OK created sql view model dbt_melissa_rm_epc.dim_addressid .............. [[32mSUCCESS 1[0m in 0.69s]
[0m14:16:59.304404 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.dim_addressid
[0m14:16:59.331685 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '08e4e21d-60a7-43a6-b2a4-b684cbe2a3b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b1cbed0>]}
[0m14:16:59.332326 [info ] [Thread-3 (]: 3 of 4 OK created sql view model dbt_melissa_rm_epc.latest_rm_urn .............. [[32mSUCCESS 1[0m in 0.71s]
[0m14:16:59.332804 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.latest_rm_urn
[0m14:16:59.339133 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '08e4e21d-60a7-43a6-b2a4-b684cbe2a3b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b5cd410>]}
[0m14:16:59.339700 [info ] [Thread-2 (]: 2 of 4 OK created sql view model dbt_melissa_rm_epc.latest_epc_urn ............. [[32mSUCCESS 1[0m in 0.72s]
[0m14:16:59.340092 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.latest_epc_urn
[0m14:16:59.340615 [debug] [Thread-4 (]: Began running node model.rightmove_epc.dim_uprn
[0m14:16:59.341055 [info ] [Thread-4 (]: 4 of 4 START sql view model dbt_melissa_rm_epc.dim_uprn ........................ [RUN]
[0m14:16:59.341608 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_uprn'
[0m14:16:59.341857 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.dim_uprn
[0m14:16:59.344628 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.dim_uprn"
[0m14:16:59.345233 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_uprn (compile): 14:16:59.342004 => 14:16:59.345084
[0m14:16:59.345490 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.dim_uprn
[0m14:16:59.347802 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.dim_uprn"
[0m14:16:59.349032 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.dim_uprn"
[0m14:16:59.349324 [debug] [Thread-4 (]: On model.rightmove_epc.dim_uprn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_uprn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE UPRNS


with epc as (

    select distinct
    epc.uprn,
    epc.addressid,
    epc.ADDRESS,
    'EPC' AS datasource,
    epc.POSTCODE,
    multi.uprn as multi_uprn

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc
    left join ANALYTICS_DEV.dbt_melissa_rm_epc.epc_flats_count multi on epc.uprn = multi.uprn

    where epc.REMOVE_FROM_RM_MATCH = 0
    AND epc.UPRN IS NOT NULL
),

rightmove as (

 select distinct
    rm.uprn,
    rm.addressid,
    concat(rm.ADDRESS_1,',',rm.ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    rm.FULL_POSTCODE AS POSTCODE,
    multi.uprn as multi_uprn

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove rm
    left join ANALYTICS_DEV.dbt_melissa_rm_epc.false_listings_count multi on rm.uprn = multi.uprn
    WHERE UPRN IS NOT NULL


),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where uprn is not null
  );
[0m14:16:59.349579 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m14:16:59.882558 [debug] [Thread-4 (]: Snowflake adapter: Snowflake query id: 01b344f8-0103-9b8b-0000-719506378856
[0m14:16:59.882982 [debug] [Thread-4 (]: Snowflake adapter: Snowflake error: 002028 (42601): SQL compilation error:
ambiguous column name 'UPRN'
[0m14:16:59.883441 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_uprn (execute): 14:16:59.345634 => 14:16:59.883270
[0m14:16:59.883737 [debug] [Thread-4 (]: On model.rightmove_epc.dim_uprn: Close
[0m14:16:59.963937 [debug] [Thread-4 (]: Database Error in model dim_uprn (models/bridge/dim_uprn.sql)
  002028 (42601): SQL compilation error:
  ambiguous column name 'UPRN'
  compiled Code at target/run/rightmove_epc/models/bridge/dim_uprn.sql
[0m14:16:59.964563 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '08e4e21d-60a7-43a6-b2a4-b684cbe2a3b3', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b3b0790>]}
[0m14:16:59.965156 [error] [Thread-4 (]: 4 of 4 ERROR creating sql view model dbt_melissa_rm_epc.dim_uprn ............... [[31mERROR[0m in 0.62s]
[0m14:16:59.965728 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.dim_uprn
[0m14:16:59.967752 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:16:59.968134 [debug] [MainThread]: Connection 'model.rightmove_epc.dim_addressid' was properly closed.
[0m14:16:59.968395 [debug] [MainThread]: Connection 'model.rightmove_epc.latest_epc_urn' was properly closed.
[0m14:16:59.968631 [debug] [MainThread]: Connection 'model.rightmove_epc.latest_rm_urn' was properly closed.
[0m14:16:59.968860 [debug] [MainThread]: Connection 'model.rightmove_epc.dim_uprn' was properly closed.
[0m14:16:59.969150 [info ] [MainThread]: 
[0m14:16:59.969430 [info ] [MainThread]: Finished running 4 view models in 0 hours 0 minutes and 2.20 seconds (2.20s).
[0m14:16:59.970155 [debug] [MainThread]: Command end result
[0m14:16:59.979108 [info ] [MainThread]: 
[0m14:16:59.979479 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m14:16:59.979705 [info ] [MainThread]: 
[0m14:16:59.979921 [error] [MainThread]:   Database Error in model dim_uprn (models/bridge/dim_uprn.sql)
  002028 (42601): SQL compilation error:
  ambiguous column name 'UPRN'
  compiled Code at target/run/rightmove_epc/models/bridge/dim_uprn.sql
[0m14:16:59.980142 [info ] [MainThread]: 
[0m14:16:59.980368 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=1 SKIP=0 TOTAL=4
[0m14:16:59.981811 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 2.4901326, "process_user_time": 1.447587, "process_kernel_time": 0.163924, "process_mem_max_rss": "137396224", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:16:59.982231 [debug] [MainThread]: Command `dbt run` failed at 14:16:59.982142 after 2.49 seconds
[0m14:16:59.982520 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102ae2b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102ae2310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102ea6150>]}
[0m14:16:59.982782 [debug] [MainThread]: Flushing usage events
[0m14:18:08.293172 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c237e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a1c9710>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c25ec90>]}


============================== 14:18:08.296164 | 6c2266cc-421e-44d7-a36c-6c929900fb75 ==============================
[0m14:18:08.296164 [info ] [MainThread]: Running with dbt=1.7.10
[0m14:18:08.296526 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select models/bridge', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m14:18:08.482716 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '6c2266cc-421e-44d7-a36c-6c929900fb75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ce56b10>]}
[0m14:18:08.522543 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '6c2266cc-421e-44d7-a36c-6c929900fb75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ccbc290>]}
[0m14:18:08.524253 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m14:18:08.534405 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m14:18:08.558058 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:18:08.558354 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:18:08.562616 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '6c2266cc-421e-44d7-a36c-6c929900fb75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ce56890>]}
[0m14:18:08.570713 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '6c2266cc-421e-44d7-a36c-6c929900fb75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ced4d50>]}
[0m14:18:08.571007 [info ] [MainThread]: Found 19 models, 1 analysis, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m14:18:08.571231 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6c2266cc-421e-44d7-a36c-6c929900fb75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cce3490>]}
[0m14:18:08.572493 [info ] [MainThread]: 
[0m14:18:08.572939 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m14:18:08.573673 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m14:18:08.581685 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m14:18:08.581988 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m14:18:08.582170 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:18:09.037022 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 0.0 seconds
[0m14:18:09.039175 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m14:18:09.110248 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m14:18:09.116802 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m14:18:09.117110 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m14:18:09.117350 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:18:09.468331 [debug] [ThreadPool]: SQL status: SUCCESS 19 in 0.0 seconds
[0m14:18:09.470898 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m14:18:09.559504 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '6c2266cc-421e-44d7-a36c-6c929900fb75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c296a10>]}
[0m14:18:09.560540 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:18:09.560876 [info ] [MainThread]: 
[0m14:18:09.563435 [debug] [Thread-1 (]: Began running node model.rightmove_epc.dim_addressid
[0m14:18:09.563788 [debug] [Thread-2 (]: Began running node model.rightmove_epc.latest_epc_urn
[0m14:18:09.564167 [debug] [Thread-3 (]: Began running node model.rightmove_epc.latest_rm_urn
[0m14:18:09.564637 [info ] [Thread-1 (]: 1 of 4 START sql view model dbt_melissa_rm_epc.dim_addressid ................... [RUN]
[0m14:18:09.565156 [info ] [Thread-2 (]: 2 of 4 START sql view model dbt_melissa_rm_epc.latest_epc_urn .................. [RUN]
[0m14:18:09.565669 [info ] [Thread-3 (]: 3 of 4 START sql view model dbt_melissa_rm_epc.latest_rm_urn ................... [RUN]
[0m14:18:09.566354 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.dim_addressid)
[0m14:18:09.567098 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.latest_epc_urn'
[0m14:18:09.567790 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.rightmove_epc.latest_rm_urn'
[0m14:18:09.568165 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.dim_addressid
[0m14:18:09.568519 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.latest_epc_urn
[0m14:18:09.568801 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.latest_rm_urn
[0m14:18:09.610628 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.dim_addressid"
[0m14:18:09.612433 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.latest_epc_urn"
[0m14:18:09.613801 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.latest_rm_urn"
[0m14:18:09.614387 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.latest_epc_urn (compile): 14:18:09.610878 => 14:18:09.614257
[0m14:18:09.614650 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.dim_addressid (compile): 14:18:09.570667 => 14:18:09.614516
[0m14:18:09.614868 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.latest_rm_urn (compile): 14:18:09.612587 => 14:18:09.614765
[0m14:18:09.615159 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.latest_epc_urn
[0m14:18:09.615352 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.dim_addressid
[0m14:18:09.615532 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.latest_rm_urn
[0m14:18:09.630714 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.latest_epc_urn"
[0m14:18:09.632598 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.dim_addressid"
[0m14:18:09.634311 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.latest_rm_urn"
[0m14:18:09.635272 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.dim_addressid"
[0m14:18:09.635800 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.latest_epc_urn"
[0m14:18:09.636298 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.latest_rm_urn"
[0m14:18:09.636538 [debug] [Thread-1 (]: On model.rightmove_epc.dim_addressid: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_addressid"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE ADDRESS'

with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource,
    POSTCODE

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    where REMOVE_FROM_RM_MATCH = 0
    AND ADDRESSID IS NOT NULL

),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    WHERE ADDRESSID IS NOT NULL

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where addressid is not null
  );
[0m14:18:09.636799 [debug] [Thread-2 (]: On model.rightmove_epc.latest_epc_urn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.latest_epc_urn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn
  
   as (
    with epc_max_date as (

    select uprn as UPRN_EPC,
    MAX(LODGEMENT_DATE) AS MAX_LODGEMENT_DATE,
    from  ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    group by 1


),

latest_epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc
    inner join epc_max_date on epc.uprn = epc_max_date.UPRN_EPC
    where MAX_LODGEMENT_DATE = LODGEMENT_DATE
   -- and uprn = 200073066

)

select DISTINCT * from latest_epc


/*
select uprn, count(*) from latest_epc
group by 1
having count(*) >1
*/
  );
[0m14:18:09.637045 [debug] [Thread-3 (]: On model.rightmove_epc.latest_rm_urn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.latest_rm_urn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NOT NULL
),

change_date AS (
    SELECT 
        UPRN AS UPRN_CD, 
        MAX(CHANGE_DATE) AS MAX_CHANGE_DATE 
    FROM rm
    GROUP BY UPRN
),

rm_latest as (

    SELECT distinct * FROM rm
    LEFT JOIN change_date cd
    ON rm.UPRN = cd.UPRN_CD
    WHERE cd.MAX_CHANGE_DATE = rm.CHANGE_DATE 
 --  and UPRN = 100090588560
    
)

select DISTINCT * from rm_latest

/*
select uprn, count(*) from rm_latest
group by 1
having count(*) >1
*/
  );
[0m14:18:09.637257 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:18:09.637440 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m14:18:09.637618 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m14:18:10.392082 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:18:10.393520 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:18:10.394661 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:18:10.416655 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.latest_rm_urn (execute): 14:18:09.632761 => 14:18:10.416463
[0m14:18:10.418744 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.latest_epc_urn (execute): 14:18:09.615646 => 14:18:10.418601
[0m14:18:10.420555 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.dim_addressid (execute): 14:18:09.630894 => 14:18:10.420420
[0m14:18:10.420863 [debug] [Thread-3 (]: On model.rightmove_epc.latest_rm_urn: Close
[0m14:18:10.421140 [debug] [Thread-2 (]: On model.rightmove_epc.latest_epc_urn: Close
[0m14:18:10.421402 [debug] [Thread-1 (]: On model.rightmove_epc.dim_addressid: Close
[0m14:18:10.497980 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6c2266cc-421e-44d7-a36c-6c929900fb75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cff58d0>]}
[0m14:18:10.498783 [info ] [Thread-2 (]: 2 of 4 OK created sql view model dbt_melissa_rm_epc.latest_epc_urn ............. [[32mSUCCESS 1[0m in 0.93s]
[0m14:18:10.499347 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.latest_epc_urn
[0m14:18:10.515709 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6c2266cc-421e-44d7-a36c-6c929900fb75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10d189b50>]}
[0m14:18:10.516579 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6c2266cc-421e-44d7-a36c-6c929900fb75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ceb9950>]}
[0m14:18:10.517255 [info ] [Thread-3 (]: 3 of 4 OK created sql view model dbt_melissa_rm_epc.latest_rm_urn .............. [[32mSUCCESS 1[0m in 0.95s]
[0m14:18:10.517746 [info ] [Thread-1 (]: 1 of 4 OK created sql view model dbt_melissa_rm_epc.dim_addressid .............. [[32mSUCCESS 1[0m in 0.95s]
[0m14:18:10.518199 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.latest_rm_urn
[0m14:18:10.518549 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.dim_addressid
[0m14:18:10.519050 [debug] [Thread-4 (]: Began running node model.rightmove_epc.dim_uprn
[0m14:18:10.519541 [info ] [Thread-4 (]: 4 of 4 START sql view model dbt_melissa_rm_epc.dim_uprn ........................ [RUN]
[0m14:18:10.520160 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_uprn'
[0m14:18:10.520459 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.dim_uprn
[0m14:18:10.523105 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.dim_uprn"
[0m14:18:10.523763 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_uprn (compile): 14:18:10.520630 => 14:18:10.523610
[0m14:18:10.524034 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.dim_uprn
[0m14:18:10.526828 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.dim_uprn"
[0m14:18:10.527934 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.dim_uprn"
[0m14:18:10.528223 [debug] [Thread-4 (]: On model.rightmove_epc.dim_uprn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_uprn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE UPRNS


with epc as (

    select distinct
    epc.uprn,
    epc.addressid,
    epc.ADDRESS,
    'EPC' AS datasource,
    epc.POSTCODE,
    multi.uprn as multi_uprn

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc
    left join ANALYTICS_DEV.dbt_melissa_rm_epc.epc_flats_count multi on epc.uprn = multi.uprn

    where epc.REMOVE_FROM_RM_MATCH = 0
    AND epc.UPRN IS NOT NULL
),

rightmove as (

 select distinct
    rm.uprn,
    rm.addressid,
    concat(rm.ADDRESS_1,',',rm.ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    rm.FULL_POSTCODE AS POSTCODE,
    multi.uprn as multi_uprn

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove rm
    left join ANALYTICS_DEV.dbt_melissa_rm_epc.false_listings_count multi on rm.uprn = multi.uprn
    WHERE rm.UPRN IS NOT NULL


),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
  );
[0m14:18:10.528490 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m14:18:11.206405 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:18:11.210083 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_uprn (execute): 14:18:10.524188 => 14:18:11.209849
[0m14:18:11.210526 [debug] [Thread-4 (]: On model.rightmove_epc.dim_uprn: Close
[0m14:18:11.296272 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '6c2266cc-421e-44d7-a36c-6c929900fb75', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10cf73fd0>]}
[0m14:18:11.297061 [info ] [Thread-4 (]: 4 of 4 OK created sql view model dbt_melissa_rm_epc.dim_uprn ................... [[32mSUCCESS 1[0m in 0.78s]
[0m14:18:11.297695 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.dim_uprn
[0m14:18:11.299574 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:18:11.299989 [debug] [MainThread]: Connection 'model.rightmove_epc.dim_addressid' was properly closed.
[0m14:18:11.300286 [debug] [MainThread]: Connection 'model.rightmove_epc.latest_epc_urn' was properly closed.
[0m14:18:11.300532 [debug] [MainThread]: Connection 'model.rightmove_epc.latest_rm_urn' was properly closed.
[0m14:18:11.300774 [debug] [MainThread]: Connection 'model.rightmove_epc.dim_uprn' was properly closed.
[0m14:18:11.301077 [info ] [MainThread]: 
[0m14:18:11.301375 [info ] [MainThread]: Finished running 4 view models in 0 hours 0 minutes and 2.73 seconds (2.73s).
[0m14:18:11.302187 [debug] [MainThread]: Command end result
[0m14:18:11.312153 [info ] [MainThread]: 
[0m14:18:11.312530 [info ] [MainThread]: [32mCompleted successfully[0m
[0m14:18:11.312788 [info ] [MainThread]: 
[0m14:18:11.313046 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m14:18:11.315770 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.0519943, "process_user_time": 1.451036, "process_kernel_time": 0.184017, "process_mem_max_rss": "138199040", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:18:11.316249 [debug] [MainThread]: Command `dbt run` succeeded at 14:18:11.316153 after 3.05 seconds
[0m14:18:11.316545 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bbd3b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1055b2210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105706150>]}
[0m14:18:11.316826 [debug] [MainThread]: Flushing usage events
[0m14:18:14.665305 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11032c810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1103727d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110373350>]}


============================== 14:18:14.667840 | 20f72acd-8cc9-4972-8df3-07c21b43ab52 ==============================
[0m14:18:14.667840 [info ] [MainThread]: Running with dbt=1.7.10
[0m14:18:14.668216 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --select models/matching', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m14:18:14.835378 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '20f72acd-8cc9-4972-8df3-07c21b43ab52', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110314850>]}
[0m14:18:14.876809 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '20f72acd-8cc9-4972-8df3-07c21b43ab52', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110daff90>]}
[0m14:18:14.877418 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m14:18:14.887254 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m14:18:14.907050 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:18:14.907355 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:18:14.911347 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '20f72acd-8cc9-4972-8df3-07c21b43ab52', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110d1b150>]}
[0m14:18:14.918851 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '20f72acd-8cc9-4972-8df3-07c21b43ab52', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111212390>]}
[0m14:18:14.919149 [info ] [MainThread]: Found 19 models, 1 analysis, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m14:18:14.919367 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '20f72acd-8cc9-4972-8df3-07c21b43ab52', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111ddbf10>]}
[0m14:18:14.920669 [info ] [MainThread]: 
[0m14:18:14.921111 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m14:18:14.921927 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m14:18:14.929442 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m14:18:14.929715 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m14:18:14.929897 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:18:15.340844 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 0.0 seconds
[0m14:18:15.343710 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m14:18:15.427940 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m14:18:15.436244 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m14:18:15.436652 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m14:18:15.436955 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:18:15.800945 [debug] [ThreadPool]: SQL status: SUCCESS 19 in 0.0 seconds
[0m14:18:15.803958 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m14:18:15.885229 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '20f72acd-8cc9-4972-8df3-07c21b43ab52', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111ddbed0>]}
[0m14:18:15.886217 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:18:15.886605 [info ] [MainThread]: 
[0m14:18:15.889033 [debug] [Thread-1 (]: Began running node model.rightmove_epc.address_match
[0m14:18:15.889511 [debug] [Thread-2 (]: Began running node model.rightmove_epc.epc_flats_count
[0m14:18:15.890051 [info ] [Thread-1 (]: 1 of 6 START sql view model dbt_melissa_rm_epc.address_match ................... [RUN]
[0m14:18:15.890557 [debug] [Thread-3 (]: Began running node model.rightmove_epc.false_listings_count
[0m14:18:15.891092 [info ] [Thread-2 (]: 2 of 6 START sql view model dbt_melissa_rm_epc.epc_flats_count ................. [RUN]
[0m14:18:15.891830 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.address_match)
[0m14:18:15.892285 [info ] [Thread-3 (]: 3 of 6 START sql view model dbt_melissa_rm_epc.false_listings_count ............ [RUN]
[0m14:18:15.893196 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.epc_flats_count'
[0m14:18:15.893686 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.address_match
[0m14:18:15.894410 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.rightmove_epc.false_listings_count'
[0m14:18:15.894957 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.epc_flats_count
[0m14:18:15.936609 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.address_match"
[0m14:18:15.936926 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.false_listings_count
[0m14:18:15.938435 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.epc_flats_count"
[0m14:18:15.940048 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.false_listings_count"
[0m14:18:15.940556 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.epc_flats_count (compile): 14:18:15.937076 => 14:18:15.940432
[0m14:18:15.940800 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.false_listings_count (compile): 14:18:15.938648 => 14:18:15.940675
[0m14:18:15.941023 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.address_match (compile): 14:18:15.895311 => 14:18:15.940921
[0m14:18:15.941199 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.epc_flats_count
[0m14:18:15.941393 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.false_listings_count
[0m14:18:15.941575 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.address_match
[0m14:18:15.956365 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.epc_flats_count"
[0m14:18:15.958188 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.false_listings_count"
[0m14:18:15.959877 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.address_match"
[0m14:18:15.960604 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.epc_flats_count"
[0m14:18:15.961047 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.false_listings_count"
[0m14:18:15.961566 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.address_match"
[0m14:18:15.961761 [debug] [Thread-2 (]: On model.rightmove_epc.epc_flats_count: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.epc_flats_count"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.epc_flats_count
  
   as (
    with epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn

),

flat_epc as (

    select uprn,
    count(BUILDING_REFERENCE_NUMBER) as building_ref_count
    from epc
    group by 1
    having count(BUILDING_REFERENCE_NUMBER) >1

)

select * from flat_epc
  );
[0m14:18:15.961988 [debug] [Thread-3 (]: On model.rightmove_epc.false_listings_count: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.false_listings_count"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.false_listings_count
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn

),

false_rm as (

    select 
    uprn,
    count(LISTING_ID) listing_count
    from rm
    group by 1
    having count(LISTING_ID) >1

)

select * from false_rm
  );
[0m14:18:15.962207 [debug] [Thread-1 (]: On model.rightmove_epc.address_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.address_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NULL

),

epc_address as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
    where datasource = 'EPC'
)


SELECT rm.*,
CASE WHEN epc_address.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_address.ADDRESSID AS EPC_ADDRESSID,
epc_address.UPRN AS EPC_UPRN


FROM rm
LEFT JOIN epc_address
ON rm.addressid = epc_address.addressid
and rm.FULL_POSTCODE = epc_address.POSTCODE
  );
[0m14:18:15.962410 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m14:18:15.962584 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m14:18:15.962751 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:18:16.487332 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:18:16.501731 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.epc_flats_count (execute): 14:18:15.941691 => 14:18:16.501589
[0m14:18:16.502071 [debug] [Thread-2 (]: On model.rightmove_epc.epc_flats_count: Close
[0m14:18:16.503460 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:18:16.503901 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:18:16.505655 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.address_match (execute): 14:18:15.958352 => 14:18:16.505536
[0m14:18:16.507381 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.false_listings_count (execute): 14:18:15.956537 => 14:18:16.507216
[0m14:18:16.507825 [debug] [Thread-1 (]: On model.rightmove_epc.address_match: Close
[0m14:18:16.508304 [debug] [Thread-3 (]: On model.rightmove_epc.false_listings_count: Close
[0m14:18:16.584726 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '20f72acd-8cc9-4972-8df3-07c21b43ab52', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111e9e7d0>]}
[0m14:18:16.585435 [info ] [Thread-3 (]: 3 of 6 OK created sql view model dbt_melissa_rm_epc.false_listings_count ....... [[32mSUCCESS 1[0m in 0.69s]
[0m14:18:16.585987 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.false_listings_count
[0m14:18:16.589933 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '20f72acd-8cc9-4972-8df3-07c21b43ab52', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111e4f110>]}
[0m14:18:16.590501 [info ] [Thread-1 (]: 1 of 6 OK created sql view model dbt_melissa_rm_epc.address_match .............. [[32mSUCCESS 1[0m in 0.70s]
[0m14:18:16.591008 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.address_match
[0m14:18:16.596053 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '20f72acd-8cc9-4972-8df3-07c21b43ab52', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1112c64d0>]}
[0m14:18:16.596679 [info ] [Thread-2 (]: 2 of 6 OK created sql view model dbt_melissa_rm_epc.epc_flats_count ............ [[32mSUCCESS 1[0m in 0.70s]
[0m14:18:16.597252 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.epc_flats_count
[0m14:18:16.597949 [debug] [Thread-4 (]: Began running node model.rightmove_epc.no_uprn_match
[0m14:18:16.598742 [debug] [Thread-3 (]: Began running node model.rightmove_epc.uprn_match
[0m14:18:16.598434 [info ] [Thread-4 (]: 4 of 6 START sql view model dbt_melissa_rm_epc.no_uprn_match ................... [RUN]
[0m14:18:16.599197 [info ] [Thread-3 (]: 5 of 6 START sql view model dbt_melissa_rm_epc.uprn_match ...................... [RUN]
[0m14:18:16.599838 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.rightmove_epc.no_uprn_match'
[0m14:18:16.600330 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.false_listings_count, now model.rightmove_epc.uprn_match)
[0m14:18:16.600586 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.no_uprn_match
[0m14:18:16.600830 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.uprn_match
[0m14:18:16.603500 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.no_uprn_match"
[0m14:18:16.605802 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.uprn_match"
[0m14:18:16.606587 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.uprn_match (compile): 14:18:16.603720 => 14:18:16.606421
[0m14:18:16.606932 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.no_uprn_match (compile): 14:18:16.600983 => 14:18:16.606760
[0m14:18:16.607187 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.uprn_match
[0m14:18:16.607448 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.no_uprn_match
[0m14:18:16.609677 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.uprn_match"
[0m14:18:16.612814 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.no_uprn_match"
[0m14:18:16.614072 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.uprn_match"
[0m14:18:16.614460 [debug] [Thread-3 (]: On model.rightmove_epc.uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
  
   as (
    with rm_latest as (

    select rm.* from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn rm
    left join ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn multi
    where rm.UPRN IS NOT NULL
    and multi.uprn IS NULL 
),

epc_uprn as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
    where datasource = 'EPC'
    and multi_uprn is null
)


SELECT rm_latest.*,
CASE WHEN epc_uprn.UPRN is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_uprn.UPRN AS EPC_UPRN,
epc_uprn.ADDRESSID AS EPC_ADDRESSID


FROM rm_latest
LEFT JOIN epc_uprn
ON rm_latest.UPRN = epc_uprn.UPRN

WHERE MATCH_EPC = 'YES'
  );
[0m14:18:16.615237 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.no_uprn_match"
[0m14:18:16.615587 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m14:18:16.615988 [debug] [Thread-4 (]: On model.rightmove_epc.no_uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.no_uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.no_uprn_match
  
   as (
    with rm_latest as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn 
    where UPRN IS NOT NULL
),

epc_uprn as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
    where datasource = 'EPC'
)


SELECT rm_latest.*,
CASE WHEN epc_uprn.UPRN is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_uprn.UPRN AS EPC_UPRN,
epc_uprn.ADDRESSID AS EPC_ADDRESSID


FROM rm_latest
LEFT JOIN epc_uprn
ON rm_latest.UPRN = epc_uprn.UPRN

WHERE MATCH_EPC = 'NO'
  );
[0m14:18:16.617105 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m14:18:17.436503 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:18:17.438542 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.no_uprn_match (execute): 14:18:16.609846 => 14:18:17.438413
[0m14:18:17.438804 [debug] [Thread-4 (]: On model.rightmove_epc.no_uprn_match: Close
[0m14:18:17.501021 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:18:17.502724 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.uprn_match (execute): 14:18:16.607606 => 14:18:17.502607
[0m14:18:17.502993 [debug] [Thread-3 (]: On model.rightmove_epc.uprn_match: Close
[0m14:18:17.524415 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '20f72acd-8cc9-4972-8df3-07c21b43ab52', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111f9e0d0>]}
[0m14:18:17.524870 [info ] [Thread-4 (]: 4 of 6 OK created sql view model dbt_melissa_rm_epc.no_uprn_match .............. [[32mSUCCESS 1[0m in 0.92s]
[0m14:18:17.525196 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.no_uprn_match
[0m14:18:17.525550 [debug] [Thread-2 (]: Began running node model.rightmove_epc.uprn_address_match
[0m14:18:17.525789 [info ] [Thread-2 (]: 6 of 6 START sql view model dbt_melissa_rm_epc.uprn_address_match .............. [RUN]
[0m14:18:17.526198 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.epc_flats_count, now model.rightmove_epc.uprn_address_match)
[0m14:18:17.526412 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.uprn_address_match
[0m14:18:17.528707 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.uprn_address_match"
[0m14:18:17.529248 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.uprn_address_match (compile): 14:18:17.526537 => 14:18:17.529129
[0m14:18:17.529471 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.uprn_address_match
[0m14:18:17.531580 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.uprn_address_match"
[0m14:18:17.532797 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.uprn_address_match"
[0m14:18:17.533080 [debug] [Thread-2 (]: On model.rightmove_epc.uprn_address_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.uprn_address_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_address_match
  
   as (
    -- where uprn is not matched we try address.

with uprn as (

    select 
    up.LISTING_ID,
    CHANGE_DATE,
    up.ADDRESSID,
    up.ADDRESS_1,
    up.ADDRESS_2,
    FULL_POSTCODE,
    up.UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    BEDROOM,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
 -- need to sleect the same fields as address match
    CASE WHEN ad.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC,
    ad.ADDRESSID AS EPC_ADDRESSID,
    ad.UPRN AS EPC_UPRN

     from ANALYTICS_DEV.dbt_melissa_rm_epc.no_uprn_match up
    left join ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid ad on up.ADDRESSID = ad.ADDRESSID
    and up.FULL_POSTCODE = ad.POSTCODE
   
)

SELECT * FROM UPRN
  );
[0m14:18:17.533305 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m14:18:17.573771 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '20f72acd-8cc9-4972-8df3-07c21b43ab52', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111f01650>]}
[0m14:18:17.574207 [info ] [Thread-3 (]: 5 of 6 OK created sql view model dbt_melissa_rm_epc.uprn_match ................. [[32mSUCCESS 1[0m in 0.97s]
[0m14:18:17.574516 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.uprn_match
[0m14:18:18.377133 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:18:18.380112 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.uprn_address_match (execute): 14:18:17.529840 => 14:18:18.379906
[0m14:18:18.380529 [debug] [Thread-2 (]: On model.rightmove_epc.uprn_address_match: Close
[0m14:18:18.460093 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '20f72acd-8cc9-4972-8df3-07c21b43ab52', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112219110>]}
[0m14:18:18.460913 [info ] [Thread-2 (]: 6 of 6 OK created sql view model dbt_melissa_rm_epc.uprn_address_match ......... [[32mSUCCESS 1[0m in 0.93s]
[0m14:18:18.461538 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.uprn_address_match
[0m14:18:18.463623 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:18:18.464006 [debug] [MainThread]: Connection 'model.rightmove_epc.address_match' was properly closed.
[0m14:18:18.464277 [debug] [MainThread]: Connection 'model.rightmove_epc.uprn_address_match' was properly closed.
[0m14:18:18.464528 [debug] [MainThread]: Connection 'model.rightmove_epc.uprn_match' was properly closed.
[0m14:18:18.464767 [debug] [MainThread]: Connection 'model.rightmove_epc.no_uprn_match' was properly closed.
[0m14:18:18.465104 [info ] [MainThread]: 
[0m14:18:18.465402 [info ] [MainThread]: Finished running 6 view models in 0 hours 0 minutes and 3.54 seconds (3.54s).
[0m14:18:18.466408 [debug] [MainThread]: Command end result
[0m14:18:18.476126 [info ] [MainThread]: 
[0m14:18:18.476570 [info ] [MainThread]: [32mCompleted successfully[0m
[0m14:18:18.476931 [info ] [MainThread]: 
[0m14:18:18.477277 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=0 SKIP=0 TOTAL=6
[0m14:18:18.478991 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.8434975, "process_user_time": 1.509502, "process_kernel_time": 0.165656, "process_mem_max_rss": "137658368", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:18:18.479593 [debug] [MainThread]: Command `dbt run` succeeded at 14:18:18.479469 after 3.84 seconds
[0m14:18:18.479949 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107dd3250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107dd3090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102a7a210>]}
[0m14:18:18.480252 [debug] [MainThread]: Flushing usage events
[0m14:18:28.084357 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107b8f0d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107b81510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107b9ae10>]}


============================== 14:18:28.087172 | ec385841-1e8c-4c7d-9f88-4e4851d93fbd ==============================
[0m14:18:28.087172 [info ] [MainThread]: Running with dbt=1.7.10
[0m14:18:28.087548 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'profiles_dir': '/Users/melissabee/.dbt', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --select models/reports', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m14:18:28.275547 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ec385841-1e8c-4c7d-9f88-4e4851d93fbd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107b3d9d0>]}
[0m14:18:28.316192 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ec385841-1e8c-4c7d-9f88-4e4851d93fbd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1116bd550>]}
[0m14:18:28.317233 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m14:18:28.330271 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m14:18:28.357257 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:18:28.357555 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:18:28.361412 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ec385841-1e8c-4c7d-9f88-4e4851d93fbd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11169ce10>]}
[0m14:18:28.369063 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ec385841-1e8c-4c7d-9f88-4e4851d93fbd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1117fea90>]}
[0m14:18:28.369376 [info ] [MainThread]: Found 19 models, 1 analysis, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m14:18:28.369607 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ec385841-1e8c-4c7d-9f88-4e4851d93fbd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1117eb310>]}
[0m14:18:28.370951 [info ] [MainThread]: 
[0m14:18:28.371417 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m14:18:28.372141 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m14:18:28.380202 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m14:18:28.380510 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m14:18:28.380698 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:18:28.819143 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 0.0 seconds
[0m14:18:28.821822 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m14:18:28.913219 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m14:18:28.920494 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m14:18:28.920822 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m14:18:28.921083 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:18:29.329556 [debug] [ThreadPool]: SQL status: SUCCESS 19 in 0.0 seconds
[0m14:18:29.331315 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m14:18:29.408809 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ec385841-1e8c-4c7d-9f88-4e4851d93fbd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1117444d0>]}
[0m14:18:29.409945 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m14:18:29.410383 [info ] [MainThread]: 
[0m14:18:29.414347 [debug] [Thread-1 (]: Began running node model.rightmove_epc.epc_flats
[0m14:18:29.414882 [debug] [Thread-2 (]: Began running node model.rightmove_epc.false_listings
[0m14:18:29.415288 [debug] [Thread-3 (]: Began running node model.rightmove_epc.flats_report
[0m14:18:29.415673 [debug] [Thread-4 (]: Began running node model.rightmove_epc.houses_report
[0m14:18:29.416105 [info ] [Thread-1 (]: 1 of 7 START sql table model dbt_melissa_rm_epc.epc_flats ...................... [RUN]
[0m14:18:29.416578 [info ] [Thread-2 (]: 2 of 7 START sql table model dbt_melissa_rm_epc.false_listings ................. [RUN]
[0m14:18:29.417133 [info ] [Thread-3 (]: 3 of 7 START sql table model dbt_melissa_rm_epc.flats_report ................... [RUN]
[0m14:18:29.417765 [info ] [Thread-4 (]: 4 of 7 START sql table model dbt_melissa_rm_epc.houses_report .................. [RUN]
[0m14:18:29.418627 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.epc_flats)
[0m14:18:29.421041 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.false_listings'
[0m14:18:29.421660 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.rightmove_epc.flats_report'
[0m14:18:29.422227 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.rightmove_epc.houses_report'
[0m14:18:29.422546 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.epc_flats
[0m14:18:29.422840 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.false_listings
[0m14:18:29.423118 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.flats_report
[0m14:18:29.423391 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.houses_report
[0m14:18:29.464286 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.epc_flats"
[0m14:18:29.466179 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.false_listings"
[0m14:18:29.468180 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.flats_report"
[0m14:18:29.470567 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.houses_report"
[0m14:18:29.471653 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.false_listings (compile): 14:18:29.464528 => 14:18:29.471502
[0m14:18:29.471895 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.false_listings
[0m14:18:29.477828 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.flats_report (compile): 14:18:29.466403 => 14:18:29.477668
[0m14:18:29.488048 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.false_listings"
[0m14:18:29.488383 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.flats_report
[0m14:18:29.488650 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.epc_flats (compile): 14:18:29.423582 => 14:18:29.488524
[0m14:18:29.488854 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.houses_report (compile): 14:18:29.468387 => 14:18:29.488758
[0m14:18:29.490714 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.flats_report"
[0m14:18:29.490983 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.epc_flats
[0m14:18:29.491212 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.houses_report
[0m14:18:29.491733 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.false_listings"
[0m14:18:29.493381 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.epc_flats"
[0m14:18:29.494936 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.houses_report"
[0m14:18:29.495188 [debug] [Thread-2 (]: On model.rightmove_epc.false_listings: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.false_listings"} */
create or replace transient table ANALYTICS_DEV.dbt_melissa_rm_epc.false_listings
         as
        (with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn

),

false_rm as (

    select 
    uprn,
    count(LISTING_ID) listing_count
    from rm
    group by 1
    having count(LISTING_ID) >1

),

get_false as (

    select rm.*,
    listing_count

    from rm
    inner join false_rm
    on rm.uprn = false_rm.uprn

)

select * from get_false
order by uprn
        );
[0m14:18:29.496609 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.flats_report"
[0m14:18:29.496958 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m14:18:29.497283 [debug] [Thread-3 (]: On model.rightmove_epc.flats_report: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.flats_report"} */
create or replace transient table ANALYTICS_DEV.dbt_melissa_rm_epc.flats_report
         as
        (with house_addmatch as (

    select 
    distinct
    --count(LISTING_ID) as TOTAL_LISTINGS,
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN, -- NULL
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
 --   am.FLOOR_LEVEL as RM_FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    epc.ADDRESSID AS EPC_ADDRESSID,
    -- REMOVE_FROM_RM_MATCH,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

     from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc on am.EPC_ADDRESSID = epc.ADDRESSID
    and am.FULL_POSTCODE = epc.POSTCODE
    where MATCH_EPC = 'YES'
    and COMBINED_PROPERTY_TYPE in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')

),

house_uprnmatch as (

    select 
    distinct
    --count(LISTING_ID) as TOTAL_LISTINGS,
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN, -- NULL
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
  --  am.FLOOR_LEVEL as RM_FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    epc.ADDRESSID AS EPC_ADDRESSID,
    -- REMOVE_FROM_RM_MATCH,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

    

    from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn epc on am.EPC_UPRN = epc.UPRN

    where MATCH_EPC = 'YES'
   and COMBINED_PROPERTY_TYPE in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')
  -- AND RM_UPRN = 100030719363

)


select 'UPRN' as MATCH_TYPE, * from house_uprnmatch

union all

select 'ADDRESSID' as MATCH_TYPE, * from house_addmatch

/*
--THIS IS USED FOR A TEST
select RM_UPRN,COUNT(BUILDING_REFERENCE_NUMBER)
from house_uprnmatch
WHERE RM_UPRN IS NOT NULL
GROUP BY 1
HAVING COUNT(BUILDING_REFERENCE_NUMBER) >1
*/
        );
[0m14:18:29.497907 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.epc_flats"
[0m14:18:29.499334 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.houses_report"
[0m14:18:29.499733 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m14:18:29.500151 [debug] [Thread-1 (]: On model.rightmove_epc.epc_flats: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.epc_flats"} */
create or replace transient table ANALYTICS_DEV.dbt_melissa_rm_epc.epc_flats
         as
        (with epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn

),

flat_epc as (

    select uprn,
    count(BUILDING_REFERENCE_NUMBER) as building_ref_count
    from epc
    group by 1
    having count(BUILDING_REFERENCE_NUMBER) >1

),

match_flat_epc as (

    select epc.*,
    building_ref_count
    from epc
    inner join flat_epc on epc.uprn = flat_epc.uprn

)

select * from match_flat_epc
        );
[0m14:18:29.500495 [debug] [Thread-4 (]: On model.rightmove_epc.houses_report: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.houses_report"} */
create or replace transient table ANALYTICS_DEV.dbt_melissa_rm_epc.houses_report
         as
        (with house_addmatch as (

    select 
    distinct
    --count(LISTING_ID) as TOTAL_LISTINGS,
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN, -- NULL
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
 --   am.FLOOR_LEVEL as RM_FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    epc.ADDRESSID AS EPC_ADDRESSID,
    -- REMOVE_FROM_RM_MATCH,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

     from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc on am.EPC_ADDRESSID = epc.ADDRESSID
    and am.FULL_POSTCODE = epc.POSTCODE
    where MATCH_EPC = 'YES'
    and COMBINED_PROPERTY_TYPE not in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')

),

house_uprnmatch as (

    select 
    distinct
    --count(LISTING_ID) as TOTAL_LISTINGS,
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN, -- NULL
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
  --  am.FLOOR_LEVEL as RM_FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    epc.ADDRESSID AS EPC_ADDRESSID,
    -- REMOVE_FROM_RM_MATCH,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

    

    from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn epc on am.EPC_UPRN = epc.UPRN

    where MATCH_EPC = 'YES'
    and COMBINED_PROPERTY_TYPE not in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')
  -- AND RM_UPRN = 100030719363

)


select 'UPRN' as MATCH_TYPE, * from house_uprnmatch

union all

select 'ADDRESSID' as MATCH_TYPE, * from house_addmatch

/*
--THIS IS USED FOR A TEST
select RM_UPRN,COUNT(BUILDING_REFERENCE_NUMBER)
from house_uprnmatch
WHERE RM_UPRN IS NOT NULL
GROUP BY 1
HAVING COUNT(BUILDING_REFERENCE_NUMBER) >1
*/
        );
[0m14:18:29.501275 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:18:29.501546 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m14:20:56.281315 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 147.0 seconds
[0m14:20:56.308709 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.false_listings (execute): 14:18:29.472064 => 14:20:56.308451
[0m14:20:56.309210 [debug] [Thread-2 (]: On model.rightmove_epc.false_listings: Close
[0m14:20:56.387781 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ec385841-1e8c-4c7d-9f88-4e4851d93fbd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11168fe10>]}
[0m14:20:56.388687 [info ] [Thread-2 (]: 2 of 7 OK created sql table model dbt_melissa_rm_epc.false_listings ............ [[32mSUCCESS 1[0m in 146.97s]
[0m14:20:56.389212 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.false_listings
[0m14:20:56.389605 [debug] [Thread-2 (]: Began running node model.rightmove_epc.rm_all_matches
[0m14:20:56.390119 [info ] [Thread-2 (]: 5 of 7 START sql table model dbt_melissa_rm_epc.rm_all_matches ................. [RUN]
[0m14:20:56.390796 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.false_listings, now model.rightmove_epc.rm_all_matches)
[0m14:20:56.391136 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.rm_all_matches
[0m14:20:56.396601 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.rm_all_matches"
[0m14:20:56.398645 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.rm_all_matches (compile): 14:20:56.391332 => 14:20:56.398438
[0m14:20:56.398967 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.rm_all_matches
[0m14:20:56.401341 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.rm_all_matches"
[0m14:20:56.403093 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.rm_all_matches"
[0m14:20:56.403496 [debug] [Thread-2 (]: On model.rightmove_epc.rm_all_matches: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.rm_all_matches"} */
create or replace transient table ANALYTICS_DEV.dbt_melissa_rm_epc.rm_all_matches
         as
        (with addr as (

    select 
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN,
    EPC_ADDRESSID
    
    from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
    where MATCH_EPC = 'YES' 
),

uprn_addr as (

    select 
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN,
    EPC_ADDRESSID
    
    from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_address_match
    where MATCH_EPC = 'YES' 
),

uprn as (

    select 
    
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN::VARCHAR AS EPC_UPRN,
    EPC_ADDRESSID

    from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'YES'
),

final as (

select 'ADDRESS AND POSTCODE MATCH' AS MATCH_RESULT, * from addr
union all
select 'UPRN MATCH' AS MATCH_RESULT, * from uprn
union all
select 'MATCH ADDRESS NO MATCH TO EPC UPRN' AS MATCH_RESULT, * from uprn
)

select * from final
        );
[0m14:20:56.403841 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m14:21:27.034531 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 178.0 seconds
[0m14:21:27.044067 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.epc_flats (execute): 14:18:29.491913 => 14:21:27.043724
[0m14:21:27.044823 [debug] [Thread-1 (]: On model.rightmove_epc.epc_flats: Close
[0m14:21:27.218492 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ec385841-1e8c-4c7d-9f88-4e4851d93fbd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111b01650>]}
[0m14:21:27.219425 [info ] [Thread-1 (]: 1 of 7 OK created sql table model dbt_melissa_rm_epc.epc_flats ................. [[32mSUCCESS 1[0m in 177.80s]
[0m14:21:27.220133 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.epc_flats
[0m14:21:27.220604 [debug] [Thread-1 (]: Began running node model.rightmove_epc.rm_no_matches
[0m14:21:27.221195 [info ] [Thread-1 (]: 6 of 7 START sql table model dbt_melissa_rm_epc.rm_no_matches .................. [RUN]
[0m14:21:27.222037 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.epc_flats, now model.rightmove_epc.rm_no_matches)
[0m14:21:27.222466 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.rm_no_matches
[0m14:21:27.226519 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.rm_no_matches"
[0m14:21:27.228322 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.rm_no_matches (compile): 14:21:27.222721 => 14:21:27.228094
[0m14:21:27.228682 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.rm_no_matches
[0m14:21:27.231623 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.rm_no_matches"
[0m14:21:27.233716 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.rm_no_matches"
[0m14:21:27.234170 [debug] [Thread-1 (]: On model.rightmove_epc.rm_no_matches: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.rm_no_matches"} */
create or replace transient table ANALYTICS_DEV.dbt_melissa_rm_epc.rm_no_matches
         as
        (with addr as (

    select 
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    '' AS EPC_UPRN,
    EPC_ADDRESSID
    
    from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
    where MATCH_EPC = 'NO' 
),

uprn as (

    select 
    
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN::VARCHAR AS EPC_UPRN,
    EPC_ADDRESSID
    
     from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'NO'
),

uprn_address as (

        select 
    
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN::VARCHAR AS EPC_UPRN,
    EPC_ADDRESSID
    
     from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_address_match
    where MATCH_EPC = 'NO'
),

final as (

select 'NO ADDRESS MATCH' AS MATCH_RESULT, * from addr
union all
select 'NO UPRN MATCH' AS MATCH_RESULT, * from uprn
union select 'NO ADDRESS OR UPRN MATCH ' AS MATCH_RESULT, * from uprn

)

select * from final
        );
[0m14:21:27.234556 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:23:43.192356 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 136.0 seconds
[0m14:23:43.200356 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.rm_no_matches (execute): 14:21:27.228890 => 14:23:43.200006
[0m14:23:43.200965 [debug] [Thread-1 (]: On model.rightmove_epc.rm_no_matches: Close
[0m14:23:43.285261 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ec385841-1e8c-4c7d-9f88-4e4851d93fbd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111b58ed0>]}
[0m14:23:43.286310 [info ] [Thread-1 (]: 6 of 7 OK created sql table model dbt_melissa_rm_epc.rm_no_matches ............. [[32mSUCCESS 1[0m in 136.06s]
[0m14:23:43.286891 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.rm_no_matches
[0m14:27:02.832025 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 513.0 seconds
[0m14:27:02.835894 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.flats_report (execute): 14:18:29.489045 => 14:27:02.835588
[0m14:27:02.836437 [debug] [Thread-3 (]: On model.rightmove_epc.flats_report: Close
[0m14:27:02.953544 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ec385841-1e8c-4c7d-9f88-4e4851d93fbd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111b509d0>]}
[0m14:27:02.954452 [info ] [Thread-3 (]: 3 of 7 OK created sql table model dbt_melissa_rm_epc.flats_report .............. [[32mSUCCESS 1[0m in 513.53s]
[0m14:27:02.955183 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.flats_report
[0m14:27:17.306621 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 381.0 seconds
[0m14:27:17.311997 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.rm_all_matches (execute): 14:20:56.399132 => 14:27:17.311666
[0m14:27:17.312605 [debug] [Thread-2 (]: On model.rightmove_epc.rm_all_matches: Close
[0m14:27:17.450405 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ec385841-1e8c-4c7d-9f88-4e4851d93fbd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1116af310>]}
[0m14:27:17.451500 [info ] [Thread-2 (]: 5 of 7 OK created sql table model dbt_melissa_rm_epc.rm_all_matches ............ [[32mSUCCESS 1[0m in 381.06s]
[0m14:27:17.452212 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.rm_all_matches
[0m14:27:40.963195 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 551.0 seconds
[0m14:27:40.968483 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.houses_report (execute): 14:18:29.493559 => 14:27:40.968166
[0m14:27:40.969117 [debug] [Thread-4 (]: On model.rightmove_epc.houses_report: Close
[0m14:27:41.078702 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ec385841-1e8c-4c7d-9f88-4e4851d93fbd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100e4ad50>]}
[0m14:27:41.079961 [info ] [Thread-4 (]: 4 of 7 OK created sql table model dbt_melissa_rm_epc.houses_report ............. [[32mSUCCESS 1[0m in 551.66s]
[0m14:27:41.080745 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.houses_report
[0m14:27:41.082643 [debug] [Thread-1 (]: Began running node model.rightmove_epc.zero_bedrooms
[0m14:27:41.083303 [info ] [Thread-1 (]: 7 of 7 START sql table model dbt_melissa_rm_epc.zero_bedrooms .................. [RUN]
[0m14:27:41.084315 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.rm_no_matches, now model.rightmove_epc.zero_bedrooms)
[0m14:27:41.084802 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.zero_bedrooms
[0m14:27:41.091318 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.zero_bedrooms"
[0m14:27:41.092351 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.zero_bedrooms (compile): 14:27:41.085076 => 14:27:41.092128
[0m14:27:41.092703 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.zero_bedrooms
[0m14:27:41.095442 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.zero_bedrooms"
[0m14:27:41.096465 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.zero_bedrooms"
[0m14:27:41.096790 [debug] [Thread-1 (]: On model.rightmove_epc.zero_bedrooms: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.zero_bedrooms"} */
create or replace transient table ANALYTICS_DEV.dbt_melissa_rm_epc.zero_bedrooms
         as
        (with houses as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.houses_report
    where BEDROOM = 0
),

flats as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.flats_report
        where BEDROOM = 0

)

select * from flats
union all
select * from houses
        );
[0m14:27:41.097106 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:27:44.748072 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 4.0 seconds
[0m14:27:44.749703 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.zero_bedrooms (execute): 14:27:41.092894 => 14:27:44.749582
[0m14:27:44.749936 [debug] [Thread-1 (]: On model.rightmove_epc.zero_bedrooms: Close
[0m14:27:44.848697 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ec385841-1e8c-4c7d-9f88-4e4851d93fbd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111d19710>]}
[0m14:27:44.849143 [info ] [Thread-1 (]: 7 of 7 OK created sql table model dbt_melissa_rm_epc.zero_bedrooms ............. [[32mSUCCESS 1[0m in 3.76s]
[0m14:27:44.849474 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.zero_bedrooms
[0m14:27:44.850733 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:27:44.850932 [debug] [MainThread]: Connection 'model.rightmove_epc.zero_bedrooms' was properly closed.
[0m14:27:44.851080 [debug] [MainThread]: Connection 'model.rightmove_epc.rm_all_matches' was properly closed.
[0m14:27:44.851218 [debug] [MainThread]: Connection 'model.rightmove_epc.flats_report' was properly closed.
[0m14:27:44.851353 [debug] [MainThread]: Connection 'model.rightmove_epc.houses_report' was properly closed.
[0m14:27:44.851556 [info ] [MainThread]: 
[0m14:27:44.851759 [info ] [MainThread]: Finished running 7 table models in 0 hours 9 minutes and 16.48 seconds (556.48s).
[0m14:27:44.852449 [debug] [MainThread]: Command end result
[0m14:27:44.859129 [info ] [MainThread]: 
[0m14:27:44.859390 [info ] [MainThread]: [32mCompleted successfully[0m
[0m14:27:44.859565 [info ] [MainThread]: 
[0m14:27:44.859769 [info ] [MainThread]: Done. PASS=7 WARN=0 ERROR=0 SKIP=0 TOTAL=7
[0m14:27:44.861575 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 556.8093, "process_user_time": 1.733522, "process_kernel_time": 0.257288, "process_mem_max_rss": "134643712", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:27:44.862058 [debug] [MainThread]: Command `dbt run` succeeded at 14:27:44.861980 after 556.81 seconds
[0m14:27:44.862354 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107bc3490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10100e0d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100eba210>]}
[0m14:27:44.862576 [debug] [MainThread]: Flushing usage events
[0m14:45:50.864169 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109718210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109751fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10975e410>]}


============================== 14:45:50.867147 | 7c5f570c-e942-4e2d-b63c-2ca1e51535c6 ==============================
[0m14:45:50.867147 [info ] [MainThread]: Running with dbt=1.7.10
[0m14:45:50.867508 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt clean', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m14:45:50.914923 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7c5f570c-e942-4e2d-b63c-2ca1e51535c6', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10975ced0>]}
[0m14:45:50.924982 [debug] [MainThread]: Resource report: {"command_name": "clean", "command_success": true, "command_wall_clock_time": 0.091227874, "process_user_time": 0.951283, "process_kernel_time": 0.11705, "process_mem_max_rss": "102629376", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:45:50.925374 [debug] [MainThread]: Command `dbt clean` succeeded at 14:45:50.925295 after 0.09 seconds
[0m14:45:50.925598 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10975dfd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10975e250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f6cf10>]}
[0m14:45:50.925878 [debug] [MainThread]: Flushing usage events
[0m14:48:26.038049 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1139185d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11395e810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11395f390>]}


============================== 14:48:26.040871 | efd217f4-6e7d-4763-96b2-5cc68769e7cc ==============================
[0m14:48:26.040871 [info ] [MainThread]: Running with dbt=1.7.10
[0m14:48:26.041232 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --select models/bridge', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m14:48:26.230784 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'efd217f4-6e7d-4763-96b2-5cc68769e7cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113937950>]}
[0m14:48:26.270607 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'efd217f4-6e7d-4763-96b2-5cc68769e7cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11451a7d0>]}
[0m14:48:26.271550 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m14:48:26.282402 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m14:48:26.309077 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:48:26.309407 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:48:26.313369 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'efd217f4-6e7d-4763-96b2-5cc68769e7cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1146d1e90>]}
[0m14:48:26.320975 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'efd217f4-6e7d-4763-96b2-5cc68769e7cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114627e10>]}
[0m14:48:26.321293 [info ] [MainThread]: Found 19 models, 1 analysis, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m14:48:26.321523 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'efd217f4-6e7d-4763-96b2-5cc68769e7cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1145fb090>]}
[0m14:48:26.322750 [info ] [MainThread]: 
[0m14:48:26.323190 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m14:48:26.323892 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m14:48:26.331112 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m14:48:26.331376 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m14:48:26.331555 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:48:26.843291 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 1.0 seconds
[0m14:48:26.846036 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m14:48:26.942120 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m14:48:26.948485 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m14:48:26.948792 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m14:48:26.949004 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:48:27.275675 [debug] [ThreadPool]: SQL status: SUCCESS 19 in 0.0 seconds
[0m14:48:27.277072 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m14:48:27.364228 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'efd217f4-6e7d-4763-96b2-5cc68769e7cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1145df510>]}
[0m14:48:27.364816 [info ] [MainThread]: Concurrency: 8 threads (target='dev')
[0m14:48:27.365035 [info ] [MainThread]: 
[0m14:48:27.367754 [debug] [Thread-1 (]: Began running node model.rightmove_epc.dim_addressid
[0m14:48:27.368026 [debug] [Thread-2 (]: Began running node model.rightmove_epc.latest_epc_urn
[0m14:48:27.368258 [debug] [Thread-3 (]: Began running node model.rightmove_epc.latest_rm_urn
[0m14:48:27.368521 [info ] [Thread-1 (]: 1 of 6 START sql view model dbt_melissa_rm_epc.dim_addressid ................... [RUN]
[0m14:48:27.368835 [info ] [Thread-2 (]: 2 of 6 START sql view model dbt_melissa_rm_epc.latest_epc_urn .................. [RUN]
[0m14:48:27.369122 [info ] [Thread-3 (]: 3 of 6 START sql view model dbt_melissa_rm_epc.latest_rm_urn ................... [RUN]
[0m14:48:27.370664 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.dim_addressid)
[0m14:48:27.371044 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.latest_epc_urn'
[0m14:48:27.371405 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.rightmove_epc.latest_rm_urn'
[0m14:48:27.371628 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.dim_addressid
[0m14:48:27.371811 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.latest_epc_urn
[0m14:48:27.371984 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.latest_rm_urn
[0m14:48:27.411526 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.dim_addressid"
[0m14:48:27.413328 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.latest_epc_urn"
[0m14:48:27.414852 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.latest_rm_urn"
[0m14:48:27.416114 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.dim_addressid (compile): 14:48:27.372101 => 14:48:27.415939
[0m14:48:27.416468 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.latest_epc_urn (compile): 14:48:27.411783 => 14:48:27.416264
[0m14:48:27.416805 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.latest_rm_urn (compile): 14:48:27.413498 => 14:48:27.416615
[0m14:48:27.417142 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.dim_addressid
[0m14:48:27.417393 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.latest_epc_urn
[0m14:48:27.417628 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.latest_rm_urn
[0m14:48:27.434664 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.dim_addressid"
[0m14:48:27.436958 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.latest_epc_urn"
[0m14:48:27.439036 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.latest_rm_urn"
[0m14:48:27.440442 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.latest_epc_urn"
[0m14:48:27.441067 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.latest_rm_urn"
[0m14:48:27.441829 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.dim_addressid"
[0m14:48:27.442137 [debug] [Thread-2 (]: On model.rightmove_epc.latest_epc_urn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.latest_epc_urn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn
  
   as (
    with epc_max_date as (

    select uprn as UPRN_EPC,
    MAX(LODGEMENT_DATE) AS MAX_LODGEMENT_DATE,
    from  ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    group by 1


),

latest_epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc
    inner join epc_max_date on epc.uprn = epc_max_date.UPRN_EPC
    where MAX_LODGEMENT_DATE = LODGEMENT_DATE
   -- and uprn = 200073066

)

select DISTINCT * from latest_epc


/*
select uprn, count(*) from latest_epc
group by 1
having count(*) >1
*/
  );
[0m14:48:27.442443 [debug] [Thread-3 (]: On model.rightmove_epc.latest_rm_urn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.latest_rm_urn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NOT NULL
),

change_date AS (
    SELECT 
        UPRN AS UPRN_CD, 
        MAX(CHANGE_DATE) AS MAX_CHANGE_DATE 
    FROM rm
    GROUP BY UPRN
),

rm_latest as (

    SELECT distinct * FROM rm
    LEFT JOIN change_date cd
    ON rm.UPRN = cd.UPRN_CD
    WHERE cd.MAX_CHANGE_DATE = rm.CHANGE_DATE 
 --  and UPRN = 100090588560
    
)

select DISTINCT * from rm_latest

/*
select uprn, count(*) from rm_latest
group by 1
having count(*) >1
*/
  );
[0m14:48:27.442795 [debug] [Thread-1 (]: On model.rightmove_epc.dim_addressid: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_addressid"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE ADDRESS'

with epc as (

    select distinct
    epc..uprn,
    epc.addressid,
    epc.ADDRESS,
    'EPC' AS datasource,
    epc.POSTCODE
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc
    where epc.REMOVE_FROM_RM_MATCH = 0
    AND epc.ADDRESSID IS NOT NULL

),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    WHERE ADDRESSID IS NOT NULL

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where addressid is not null
  );
[0m14:48:27.443121 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m14:48:27.443365 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m14:48:27.443565 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:48:27.821958 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b34518-0103-9b63-0000-719506379596
[0m14:48:27.822376 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 9 at position 13 unexpected ','.
[0m14:48:27.822810 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.dim_addressid (execute): 14:48:27.417766 => 14:48:27.822653
[0m14:48:27.823100 [debug] [Thread-1 (]: On model.rightmove_epc.dim_addressid: Close
[0m14:48:27.914724 [debug] [Thread-1 (]: Database Error in model dim_addressid (models/bridge/dim_addressid.sql)
  001003 (42000): SQL compilation error:
  syntax error line 9 at position 13 unexpected ','.
  compiled Code at target/run/rightmove_epc/models/bridge/dim_addressid.sql
[0m14:48:27.915133 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'efd217f4-6e7d-4763-96b2-5cc68769e7cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114391050>]}
[0m14:48:27.915505 [error] [Thread-1 (]: 1 of 6 ERROR creating sql view model dbt_melissa_rm_epc.dim_addressid .......... [[31mERROR[0m in 0.55s]
[0m14:48:27.915919 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.dim_addressid
[0m14:48:27.961765 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:48:27.974654 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.latest_rm_urn (execute): 14:48:27.437189 => 14:48:27.974512
[0m14:48:27.974964 [debug] [Thread-3 (]: On model.rightmove_epc.latest_rm_urn: Close
[0m14:48:27.996798 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:48:27.999303 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.latest_epc_urn (execute): 14:48:27.434929 => 14:48:27.999164
[0m14:48:27.999578 [debug] [Thread-2 (]: On model.rightmove_epc.latest_epc_urn: Close
[0m14:48:28.078942 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'efd217f4-6e7d-4763-96b2-5cc68769e7cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11467d190>]}
[0m14:48:28.079430 [info ] [Thread-2 (]: 2 of 6 OK created sql view model dbt_melissa_rm_epc.latest_epc_urn ............. [[32mSUCCESS 1[0m in 0.71s]
[0m14:48:28.079773 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.latest_epc_urn
[0m14:48:28.080112 [debug] [Thread-5 (]: Began running node model.rightmove_epc.epc_flats_count
[0m14:48:28.080394 [info ] [Thread-5 (]: 4 of 6 START sql view model dbt_melissa_rm_epc.epc_flats_count ................. [RUN]
[0m14:48:28.080875 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.rightmove_epc.epc_flats_count'
[0m14:48:28.081166 [debug] [Thread-5 (]: Began compiling node model.rightmove_epc.epc_flats_count
[0m14:48:28.083075 [debug] [Thread-5 (]: Writing injected SQL for node "model.rightmove_epc.epc_flats_count"
[0m14:48:28.083661 [debug] [Thread-5 (]: Timing info for model.rightmove_epc.epc_flats_count (compile): 14:48:28.081463 => 14:48:28.083537
[0m14:48:28.083865 [debug] [Thread-5 (]: Began executing node model.rightmove_epc.epc_flats_count
[0m14:48:28.085966 [debug] [Thread-5 (]: Writing runtime sql for node "model.rightmove_epc.epc_flats_count"
[0m14:48:28.086584 [debug] [Thread-5 (]: Using snowflake connection "model.rightmove_epc.epc_flats_count"
[0m14:48:28.086806 [debug] [Thread-5 (]: On model.rightmove_epc.epc_flats_count: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.epc_flats_count"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.epc_flats_count
  
   as (
    with epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn

),

flat_epc as (

    select uprn,
    count(BUILDING_REFERENCE_NUMBER) as building_ref_count
    from epc
    group by 1
    having count(BUILDING_REFERENCE_NUMBER) >1

)

select * from flat_epc
  );
[0m14:48:28.087009 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m14:48:28.096892 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'efd217f4-6e7d-4763-96b2-5cc68769e7cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x115500c90>]}
[0m14:48:28.097438 [info ] [Thread-3 (]: 3 of 6 OK created sql view model dbt_melissa_rm_epc.latest_rm_urn .............. [[32mSUCCESS 1[0m in 0.73s]
[0m14:48:28.097795 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.latest_rm_urn
[0m14:48:28.098174 [debug] [Thread-7 (]: Began running node model.rightmove_epc.false_listings_count
[0m14:48:28.098422 [info ] [Thread-7 (]: 5 of 6 START sql view model dbt_melissa_rm_epc.false_listings_count ............ [RUN]
[0m14:48:28.098855 [debug] [Thread-7 (]: Acquiring new snowflake connection 'model.rightmove_epc.false_listings_count'
[0m14:48:28.099051 [debug] [Thread-7 (]: Began compiling node model.rightmove_epc.false_listings_count
[0m14:48:28.101923 [debug] [Thread-7 (]: Writing injected SQL for node "model.rightmove_epc.false_listings_count"
[0m14:48:28.103455 [debug] [Thread-7 (]: Timing info for model.rightmove_epc.false_listings_count (compile): 14:48:28.099169 => 14:48:28.103296
[0m14:48:28.103689 [debug] [Thread-7 (]: Began executing node model.rightmove_epc.false_listings_count
[0m14:48:28.105698 [debug] [Thread-7 (]: Writing runtime sql for node "model.rightmove_epc.false_listings_count"
[0m14:48:28.106571 [debug] [Thread-7 (]: Using snowflake connection "model.rightmove_epc.false_listings_count"
[0m14:48:28.106853 [debug] [Thread-7 (]: On model.rightmove_epc.false_listings_count: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.false_listings_count"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.false_listings_count
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn

),

false_rm as (

    select 
    uprn,
    count(LISTING_ID) listing_count
    from rm
    group by 1
    having count(LISTING_ID) >1

)

select * from false_rm
  );
[0m14:48:28.107166 [debug] [Thread-7 (]: Opening a new connection, currently in state init
[0m14:48:28.687647 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:48:28.688740 [debug] [Thread-7 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:48:28.691584 [debug] [Thread-5 (]: Timing info for model.rightmove_epc.epc_flats_count (execute): 14:48:28.083989 => 14:48:28.691384
[0m14:48:28.693852 [debug] [Thread-7 (]: Timing info for model.rightmove_epc.false_listings_count (execute): 14:48:28.103813 => 14:48:28.693680
[0m14:48:28.694180 [debug] [Thread-5 (]: On model.rightmove_epc.epc_flats_count: Close
[0m14:48:28.694481 [debug] [Thread-7 (]: On model.rightmove_epc.false_listings_count: Close
[0m14:48:28.780002 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'efd217f4-6e7d-4763-96b2-5cc68769e7cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11467df50>]}
[0m14:48:28.780690 [debug] [Thread-7 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'efd217f4-6e7d-4763-96b2-5cc68769e7cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114969410>]}
[0m14:48:28.781269 [info ] [Thread-5 (]: 4 of 6 OK created sql view model dbt_melissa_rm_epc.epc_flats_count ............ [[32mSUCCESS 1[0m in 0.70s]
[0m14:48:28.781812 [info ] [Thread-7 (]: 5 of 6 OK created sql view model dbt_melissa_rm_epc.false_listings_count ....... [[32mSUCCESS 1[0m in 0.68s]
[0m14:48:28.782323 [debug] [Thread-5 (]: Finished running node model.rightmove_epc.epc_flats_count
[0m14:48:28.782730 [debug] [Thread-7 (]: Finished running node model.rightmove_epc.false_listings_count
[0m14:48:28.783448 [debug] [Thread-4 (]: Began running node model.rightmove_epc.dim_uprn
[0m14:48:28.783842 [info ] [Thread-4 (]: 6 of 6 START sql view model dbt_melissa_rm_epc.dim_uprn ........................ [RUN]
[0m14:48:28.784408 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_uprn'
[0m14:48:28.784666 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.dim_uprn
[0m14:48:28.787606 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.dim_uprn"
[0m14:48:28.788291 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_uprn (compile): 14:48:28.784821 => 14:48:28.788140
[0m14:48:28.788565 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.dim_uprn
[0m14:48:28.790947 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.dim_uprn"
[0m14:48:28.792210 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.dim_uprn"
[0m14:48:28.792537 [debug] [Thread-4 (]: On model.rightmove_epc.dim_uprn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_uprn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE UPRNS


with epc as (

    select distinct
    epc.uprn,
    epc.addressid,
    epc.ADDRESS,
    'EPC' AS datasource,
    epc.POSTCODE,
    case when multi.uprn is null then NULL else 1 end as multi_uprn

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc
    left join ANALYTICS_DEV.dbt_melissa_rm_epc.epc_flats_count multi on epc.uprn = multi.uprn

    where epc.REMOVE_FROM_RM_MATCH = 0
    AND epc.UPRN IS NOT NULL
),

rightmove as (

 select distinct
    rm.uprn,
    rm.addressid,
    concat(rm.ADDRESS_1,',',rm.ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    rm.FULL_POSTCODE AS POSTCODE,
    multi.uprn as multi_uprn

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove rm
    left join ANALYTICS_DEV.dbt_melissa_rm_epc.false_listings_count multi on rm.uprn = multi.uprn
    WHERE rm.UPRN IS NOT NULL


),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
  );
[0m14:48:28.792806 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m14:48:29.506452 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:48:29.508940 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_uprn (execute): 14:48:28.788718 => 14:48:29.508766
[0m14:48:29.509274 [debug] [Thread-4 (]: On model.rightmove_epc.dim_uprn: Close
[0m14:48:29.578699 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'efd217f4-6e7d-4763-96b2-5cc68769e7cc', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114529d90>]}
[0m14:48:29.579396 [info ] [Thread-4 (]: 6 of 6 OK created sql view model dbt_melissa_rm_epc.dim_uprn ................... [[32mSUCCESS 1[0m in 0.79s]
[0m14:48:29.579846 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.dim_uprn
[0m14:48:29.581364 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:48:29.581673 [debug] [MainThread]: Connection 'model.rightmove_epc.dim_addressid' was properly closed.
[0m14:48:29.581894 [debug] [MainThread]: Connection 'model.rightmove_epc.latest_epc_urn' was properly closed.
[0m14:48:29.582122 [debug] [MainThread]: Connection 'model.rightmove_epc.latest_rm_urn' was properly closed.
[0m14:48:29.582308 [debug] [MainThread]: Connection 'model.rightmove_epc.epc_flats_count' was properly closed.
[0m14:48:29.582493 [debug] [MainThread]: Connection 'model.rightmove_epc.false_listings_count' was properly closed.
[0m14:48:29.582677 [debug] [MainThread]: Connection 'model.rightmove_epc.dim_uprn' was properly closed.
[0m14:48:29.582965 [info ] [MainThread]: 
[0m14:48:29.583199 [info ] [MainThread]: Finished running 6 view models in 0 hours 0 minutes and 3.26 seconds (3.26s).
[0m14:48:29.583996 [debug] [MainThread]: Command end result
[0m14:48:29.591913 [info ] [MainThread]: 
[0m14:48:29.592267 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m14:48:29.592482 [info ] [MainThread]: 
[0m14:48:29.592695 [error] [MainThread]:   Database Error in model dim_addressid (models/bridge/dim_addressid.sql)
  001003 (42000): SQL compilation error:
  syntax error line 9 at position 13 unexpected ','.
  compiled Code at target/run/rightmove_epc/models/bridge/dim_addressid.sql
[0m14:48:29.592910 [info ] [MainThread]: 
[0m14:48:29.593123 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=0 TOTAL=6
[0m14:48:29.596747 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 3.5887992, "process_user_time": 1.509302, "process_kernel_time": 0.200566, "process_mem_max_rss": "140099584", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:48:29.597120 [debug] [MainThread]: Command `dbt run` failed at 14:48:29.597046 after 3.59 seconds
[0m14:48:29.597378 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113952c50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104d9e0d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113902210>]}
[0m14:48:29.597616 [debug] [MainThread]: Flushing usage events
[0m14:49:03.160628 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107a18f90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107132c90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107a5ef90>]}


============================== 14:49:03.163914 | 995b0de0-51e3-410a-a95b-f575694fca0d ==============================
[0m14:49:03.163914 [info ] [MainThread]: Running with dbt=1.7.10
[0m14:49:03.164300 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --select models/bridge', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m14:49:03.362655 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '995b0de0-51e3-410a-a95b-f575694fca0d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1104598d0>]}
[0m14:49:03.405729 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '995b0de0-51e3-410a-a95b-f575694fca0d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110493750>]}
[0m14:49:03.406596 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m14:49:03.416786 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m14:49:03.437069 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:49:03.437411 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:49:03.441550 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '995b0de0-51e3-410a-a95b-f575694fca0d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1102f7450>]}
[0m14:49:03.449798 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '995b0de0-51e3-410a-a95b-f575694fca0d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1104cdb50>]}
[0m14:49:03.450140 [info ] [MainThread]: Found 19 models, 1 analysis, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m14:49:03.450370 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '995b0de0-51e3-410a-a95b-f575694fca0d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107a2c290>]}
[0m14:49:03.451652 [info ] [MainThread]: 
[0m14:49:03.452117 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m14:49:03.452921 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m14:49:03.460585 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m14:49:03.460872 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m14:49:03.461055 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:49:03.932278 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 0.0 seconds
[0m14:49:03.934084 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m14:49:04.013924 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m14:49:04.019872 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m14:49:04.020144 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m14:49:04.020357 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:49:04.418556 [debug] [ThreadPool]: SQL status: SUCCESS 19 in 0.0 seconds
[0m14:49:04.420133 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m14:49:04.497821 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '995b0de0-51e3-410a-a95b-f575694fca0d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1104cbe10>]}
[0m14:49:04.498481 [info ] [MainThread]: Concurrency: 8 threads (target='dev')
[0m14:49:04.498712 [info ] [MainThread]: 
[0m14:49:04.501258 [debug] [Thread-1 (]: Began running node model.rightmove_epc.dim_addressid
[0m14:49:04.501579 [info ] [Thread-1 (]: 1 of 6 START sql view model dbt_melissa_rm_epc.dim_addressid ................... [RUN]
[0m14:49:04.501847 [debug] [Thread-2 (]: Began running node model.rightmove_epc.latest_epc_urn
[0m14:49:04.502095 [debug] [Thread-3 (]: Began running node model.rightmove_epc.latest_rm_urn
[0m14:49:04.503451 [info ] [Thread-2 (]: 2 of 6 START sql view model dbt_melissa_rm_epc.latest_epc_urn .................. [RUN]
[0m14:49:04.503920 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.dim_addressid)
[0m14:49:04.504206 [info ] [Thread-3 (]: 3 of 6 START sql view model dbt_melissa_rm_epc.latest_rm_urn ................... [RUN]
[0m14:49:04.504687 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.latest_epc_urn'
[0m14:49:04.504923 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.dim_addressid
[0m14:49:04.505320 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.rightmove_epc.latest_rm_urn'
[0m14:49:04.505554 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.latest_epc_urn
[0m14:49:04.544206 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.dim_addressid"
[0m14:49:04.544538 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.latest_rm_urn
[0m14:49:04.546202 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.latest_epc_urn"
[0m14:49:04.547834 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.latest_rm_urn"
[0m14:49:04.548269 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.dim_addressid (compile): 14:49:04.505705 => 14:49:04.548133
[0m14:49:04.548499 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.dim_addressid
[0m14:49:04.555038 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.latest_epc_urn (compile): 14:49:04.544673 => 14:49:04.554893
[0m14:49:04.561634 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.latest_rm_urn (compile): 14:49:04.546409 => 14:49:04.561491
[0m14:49:04.564076 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.dim_addressid"
[0m14:49:04.564312 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.latest_epc_urn
[0m14:49:04.564538 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.latest_rm_urn
[0m14:49:04.566393 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.latest_epc_urn"
[0m14:49:04.568123 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.latest_rm_urn"
[0m14:49:04.568752 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.dim_addressid"
[0m14:49:04.569110 [debug] [Thread-1 (]: On model.rightmove_epc.dim_addressid: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_addressid"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE ADDRESS'

with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource,
    POSTCODE
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs 
    where REMOVE_FROM_RM_MATCH = 0
    AND ADDRESSID IS NOT NULL

),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    WHERE ADDRESSID IS NOT NULL

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where addressid is not null
  );
[0m14:49:04.569396 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:49:04.570227 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.latest_epc_urn"
[0m14:49:04.570911 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.latest_rm_urn"
[0m14:49:04.571341 [debug] [Thread-2 (]: On model.rightmove_epc.latest_epc_urn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.latest_epc_urn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn
  
   as (
    with epc_max_date as (

    select uprn as UPRN_EPC,
    MAX(LODGEMENT_DATE) AS MAX_LODGEMENT_DATE,
    from  ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    group by 1


),

latest_epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc
    inner join epc_max_date on epc.uprn = epc_max_date.UPRN_EPC
    where MAX_LODGEMENT_DATE = LODGEMENT_DATE
   -- and uprn = 200073066

)

select DISTINCT * from latest_epc


/*
select uprn, count(*) from latest_epc
group by 1
having count(*) >1
*/
  );
[0m14:49:04.571623 [debug] [Thread-3 (]: On model.rightmove_epc.latest_rm_urn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.latest_rm_urn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NOT NULL
),

change_date AS (
    SELECT 
        UPRN AS UPRN_CD, 
        MAX(CHANGE_DATE) AS MAX_CHANGE_DATE 
    FROM rm
    GROUP BY UPRN
),

rm_latest as (

    SELECT distinct * FROM rm
    LEFT JOIN change_date cd
    ON rm.UPRN = cd.UPRN_CD
    WHERE cd.MAX_CHANGE_DATE = rm.CHANGE_DATE 
 --  and UPRN = 100090588560
    
)

select DISTINCT * from rm_latest

/*
select uprn, count(*) from rm_latest
group by 1
having count(*) >1
*/
  );
[0m14:49:04.571855 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m14:49:04.572043 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m14:49:05.074502 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:49:05.086501 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.latest_rm_urn (execute): 14:49:04.566567 => 14:49:05.086372
[0m14:49:05.086751 [debug] [Thread-3 (]: On model.rightmove_epc.latest_rm_urn: Close
[0m14:49:05.100483 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:49:05.101999 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.latest_epc_urn (execute): 14:49:04.564721 => 14:49:05.101885
[0m14:49:05.102213 [debug] [Thread-2 (]: On model.rightmove_epc.latest_epc_urn: Close
[0m14:49:05.154426 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:49:05.156094 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.dim_addressid (execute): 14:49:04.548673 => 14:49:05.155974
[0m14:49:05.156318 [debug] [Thread-1 (]: On model.rightmove_epc.dim_addressid: Close
[0m14:49:05.163588 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '995b0de0-51e3-410a-a95b-f575694fca0d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110764450>]}
[0m14:49:05.163993 [info ] [Thread-3 (]: 3 of 6 OK created sql view model dbt_melissa_rm_epc.latest_rm_urn .............. [[32mSUCCESS 1[0m in 0.66s]
[0m14:49:05.164317 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.latest_rm_urn
[0m14:49:05.164655 [debug] [Thread-5 (]: Began running node model.rightmove_epc.false_listings_count
[0m14:49:05.164901 [info ] [Thread-5 (]: 4 of 6 START sql view model dbt_melissa_rm_epc.false_listings_count ............ [RUN]
[0m14:49:05.165304 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.rightmove_epc.false_listings_count'
[0m14:49:05.165492 [debug] [Thread-5 (]: Began compiling node model.rightmove_epc.false_listings_count
[0m14:49:05.167297 [debug] [Thread-5 (]: Writing injected SQL for node "model.rightmove_epc.false_listings_count"
[0m14:49:05.169060 [debug] [Thread-5 (]: Timing info for model.rightmove_epc.false_listings_count (compile): 14:49:05.165606 => 14:49:05.168881
[0m14:49:05.169319 [debug] [Thread-5 (]: Began executing node model.rightmove_epc.false_listings_count
[0m14:49:05.171291 [debug] [Thread-5 (]: Writing runtime sql for node "model.rightmove_epc.false_listings_count"
[0m14:49:05.172392 [debug] [Thread-5 (]: Using snowflake connection "model.rightmove_epc.false_listings_count"
[0m14:49:05.172623 [debug] [Thread-5 (]: On model.rightmove_epc.false_listings_count: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.false_listings_count"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.false_listings_count
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn

),

false_rm as (

    select 
    uprn,
    count(LISTING_ID) listing_count
    from rm
    group by 1
    having count(LISTING_ID) >1

)

select * from false_rm
  );
[0m14:49:05.172829 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m14:49:05.180974 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '995b0de0-51e3-410a-a95b-f575694fca0d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11059d850>]}
[0m14:49:05.181435 [info ] [Thread-2 (]: 2 of 6 OK created sql view model dbt_melissa_rm_epc.latest_epc_urn ............. [[32mSUCCESS 1[0m in 0.68s]
[0m14:49:05.182075 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.latest_epc_urn
[0m14:49:05.182588 [debug] [Thread-7 (]: Began running node model.rightmove_epc.epc_flats_count
[0m14:49:05.182858 [info ] [Thread-7 (]: 5 of 6 START sql view model dbt_melissa_rm_epc.epc_flats_count ................. [RUN]
[0m14:49:05.183326 [debug] [Thread-7 (]: Acquiring new snowflake connection 'model.rightmove_epc.epc_flats_count'
[0m14:49:05.183551 [debug] [Thread-7 (]: Began compiling node model.rightmove_epc.epc_flats_count
[0m14:49:05.186594 [debug] [Thread-7 (]: Writing injected SQL for node "model.rightmove_epc.epc_flats_count"
[0m14:49:05.187192 [debug] [Thread-7 (]: Timing info for model.rightmove_epc.epc_flats_count (compile): 14:49:05.183825 => 14:49:05.187068
[0m14:49:05.187398 [debug] [Thread-7 (]: Began executing node model.rightmove_epc.epc_flats_count
[0m14:49:05.189515 [debug] [Thread-7 (]: Writing runtime sql for node "model.rightmove_epc.epc_flats_count"
[0m14:49:05.191048 [debug] [Thread-7 (]: Using snowflake connection "model.rightmove_epc.epc_flats_count"
[0m14:49:05.191318 [debug] [Thread-7 (]: On model.rightmove_epc.epc_flats_count: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.epc_flats_count"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.epc_flats_count
  
   as (
    with epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn

),

flat_epc as (

    select uprn,
    count(BUILDING_REFERENCE_NUMBER) as building_ref_count
    from epc
    group by 1
    having count(BUILDING_REFERENCE_NUMBER) >1

)

select * from flat_epc
  );
[0m14:49:05.191638 [debug] [Thread-7 (]: Opening a new connection, currently in state init
[0m14:49:05.243999 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '995b0de0-51e3-410a-a95b-f575694fca0d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110949e90>]}
[0m14:49:05.244499 [info ] [Thread-1 (]: 1 of 6 OK created sql view model dbt_melissa_rm_epc.dim_addressid .............. [[32mSUCCESS 1[0m in 0.74s]
[0m14:49:05.244827 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.dim_addressid
[0m14:49:05.676937 [debug] [Thread-7 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m14:49:05.680256 [debug] [Thread-7 (]: Timing info for model.rightmove_epc.epc_flats_count (execute): 14:49:05.187517 => 14:49:05.680053
[0m14:49:05.680655 [debug] [Thread-7 (]: On model.rightmove_epc.epc_flats_count: Close
[0m14:49:05.691269 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:49:05.693713 [debug] [Thread-5 (]: Timing info for model.rightmove_epc.false_listings_count (execute): 14:49:05.169453 => 14:49:05.693557
[0m14:49:05.694037 [debug] [Thread-5 (]: On model.rightmove_epc.false_listings_count: Close
[0m14:49:05.762817 [debug] [Thread-7 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '995b0de0-51e3-410a-a95b-f575694fca0d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1109e9250>]}
[0m14:49:05.763398 [info ] [Thread-7 (]: 5 of 6 OK created sql view model dbt_melissa_rm_epc.epc_flats_count ............ [[32mSUCCESS 1[0m in 0.58s]
[0m14:49:05.763887 [debug] [Thread-7 (]: Finished running node model.rightmove_epc.epc_flats_count
[0m14:49:05.805299 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '995b0de0-51e3-410a-a95b-f575694fca0d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1109f8490>]}
[0m14:49:05.805915 [info ] [Thread-5 (]: 4 of 6 OK created sql view model dbt_melissa_rm_epc.false_listings_count ....... [[32mSUCCESS 1[0m in 0.64s]
[0m14:49:05.806333 [debug] [Thread-5 (]: Finished running node model.rightmove_epc.false_listings_count
[0m14:49:05.806809 [debug] [Thread-4 (]: Began running node model.rightmove_epc.dim_uprn
[0m14:49:05.807239 [info ] [Thread-4 (]: 6 of 6 START sql view model dbt_melissa_rm_epc.dim_uprn ........................ [RUN]
[0m14:49:05.807802 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_uprn'
[0m14:49:05.808032 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.dim_uprn
[0m14:49:05.810558 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.dim_uprn"
[0m14:49:05.811186 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_uprn (compile): 14:49:05.808166 => 14:49:05.811053
[0m14:49:05.811418 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.dim_uprn
[0m14:49:05.813504 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.dim_uprn"
[0m14:49:05.814656 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.dim_uprn"
[0m14:49:05.814916 [debug] [Thread-4 (]: On model.rightmove_epc.dim_uprn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_uprn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE UPRNS


with epc as (

    select distinct
    epc.uprn,
    epc.addressid,
    epc.ADDRESS,
    'EPC' AS datasource,
    epc.POSTCODE,
    case when multi.uprn is null then NULL else 1 end as multi_uprn

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc
    left join ANALYTICS_DEV.dbt_melissa_rm_epc.epc_flats_count multi on epc.uprn = multi.uprn

    where epc.REMOVE_FROM_RM_MATCH = 0
    AND epc.UPRN IS NOT NULL
),

rightmove as (

 select distinct
    rm.uprn,
    rm.addressid,
    concat(rm.ADDRESS_1,',',rm.ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    rm.FULL_POSTCODE AS POSTCODE,
    multi.uprn as multi_uprn

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove rm
    left join ANALYTICS_DEV.dbt_melissa_rm_epc.false_listings_count multi on rm.uprn = multi.uprn
    WHERE rm.UPRN IS NOT NULL


),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
  );
[0m14:49:05.815157 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m14:49:06.444518 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:49:06.446660 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_uprn (execute): 14:49:05.811553 => 14:49:06.446522
[0m14:49:06.446926 [debug] [Thread-4 (]: On model.rightmove_epc.dim_uprn: Close
[0m14:49:06.527632 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '995b0de0-51e3-410a-a95b-f575694fca0d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1105c7090>]}
[0m14:49:06.528177 [info ] [Thread-4 (]: 6 of 6 OK created sql view model dbt_melissa_rm_epc.dim_uprn ................... [[32mSUCCESS 1[0m in 0.72s]
[0m14:49:06.528558 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.dim_uprn
[0m14:49:06.529851 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:49:06.530065 [debug] [MainThread]: Connection 'model.rightmove_epc.dim_addressid' was properly closed.
[0m14:49:06.530253 [debug] [MainThread]: Connection 'model.rightmove_epc.latest_epc_urn' was properly closed.
[0m14:49:06.530426 [debug] [MainThread]: Connection 'model.rightmove_epc.latest_rm_urn' was properly closed.
[0m14:49:06.530591 [debug] [MainThread]: Connection 'model.rightmove_epc.false_listings_count' was properly closed.
[0m14:49:06.530756 [debug] [MainThread]: Connection 'model.rightmove_epc.epc_flats_count' was properly closed.
[0m14:49:06.530916 [debug] [MainThread]: Connection 'model.rightmove_epc.dim_uprn' was properly closed.
[0m14:49:06.531150 [info ] [MainThread]: 
[0m14:49:06.531361 [info ] [MainThread]: Finished running 6 view models in 0 hours 0 minutes and 3.08 seconds (3.08s).
[0m14:49:06.532056 [debug] [MainThread]: Command end result
[0m14:49:06.538341 [info ] [MainThread]: 
[0m14:49:06.538651 [info ] [MainThread]: [32mCompleted successfully[0m
[0m14:49:06.538846 [info ] [MainThread]: 
[0m14:49:06.539040 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=0 SKIP=0 TOTAL=6
[0m14:49:06.540869 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.4171088, "process_user_time": 1.491155, "process_kernel_time": 0.198584, "process_mem_max_rss": "136839168", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:49:06.541221 [debug] [MainThread]: Command `dbt run` succeeded at 14:49:06.541152 after 3.42 seconds
[0m14:49:06.541444 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107a87590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1072d3c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1015ba210>]}
[0m14:49:06.541669 [debug] [MainThread]: Flushing usage events
[0m14:53:22.690053 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109238a90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10927a6d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10927b210>]}


============================== 14:53:22.693130 | e8f4dd7a-e9ef-47d1-95f2-8c1da8c7f988 ==============================
[0m14:53:22.693130 [info ] [MainThread]: Running with dbt=1.7.10
[0m14:53:22.693500 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'profiles_dir': '/Users/melissabee/.dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select models/bridge', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m14:53:22.890248 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e8f4dd7a-e9ef-47d1-95f2-8c1da8c7f988', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109640a50>]}
[0m14:53:22.931120 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e8f4dd7a-e9ef-47d1-95f2-8c1da8c7f988', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1092a3910>]}
[0m14:53:22.931989 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m14:53:22.941982 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m14:53:22.961195 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:53:22.961475 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:53:22.965314 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e8f4dd7a-e9ef-47d1-95f2-8c1da8c7f988', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109bb9090>]}
[0m14:53:22.972886 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e8f4dd7a-e9ef-47d1-95f2-8c1da8c7f988', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109c90b10>]}
[0m14:53:22.973174 [info ] [MainThread]: Found 19 models, 1 analysis, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m14:53:22.973393 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e8f4dd7a-e9ef-47d1-95f2-8c1da8c7f988', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109278d90>]}
[0m14:53:22.974584 [info ] [MainThread]: 
[0m14:53:22.975017 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m14:53:22.975724 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m14:53:22.982874 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m14:53:22.983116 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m14:53:22.983290 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:53:23.550380 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 1.0 seconds
[0m14:53:23.553968 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m14:53:23.635753 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m14:53:23.644502 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m14:53:23.644910 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m14:53:23.645225 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:53:24.086615 [debug] [ThreadPool]: SQL status: SUCCESS 19 in 0.0 seconds
[0m14:53:24.088300 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m14:53:24.175313 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e8f4dd7a-e9ef-47d1-95f2-8c1da8c7f988', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109be6b10>]}
[0m14:53:24.176249 [info ] [MainThread]: Concurrency: 8 threads (target='dev')
[0m14:53:24.176622 [info ] [MainThread]: 
[0m14:53:24.180691 [debug] [Thread-1 (]: Began running node model.rightmove_epc.dim_addressid
[0m14:53:24.181132 [debug] [Thread-2 (]: Began running node model.rightmove_epc.latest_epc_urn
[0m14:53:24.181550 [debug] [Thread-3 (]: Began running node model.rightmove_epc.latest_rm_urn
[0m14:53:24.182071 [info ] [Thread-1 (]: 1 of 6 START sql view model dbt_melissa_rm_epc.dim_addressid ................... [RUN]
[0m14:53:24.182535 [info ] [Thread-2 (]: 2 of 6 START sql view model dbt_melissa_rm_epc.latest_epc_urn .................. [RUN]
[0m14:53:24.182947 [info ] [Thread-3 (]: 3 of 6 START sql view model dbt_melissa_rm_epc.latest_rm_urn ................... [RUN]
[0m14:53:24.185262 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.dim_addressid)
[0m14:53:24.185938 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.latest_epc_urn'
[0m14:53:24.186586 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.rightmove_epc.latest_rm_urn'
[0m14:53:24.186879 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.dim_addressid
[0m14:53:24.187142 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.latest_epc_urn
[0m14:53:24.187394 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.latest_rm_urn
[0m14:53:24.227078 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.dim_addressid"
[0m14:53:24.228827 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.latest_epc_urn"
[0m14:53:24.230468 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.latest_rm_urn"
[0m14:53:24.231223 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.dim_addressid (compile): 14:53:24.187558 => 14:53:24.231090
[0m14:53:24.231470 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.latest_epc_urn (compile): 14:53:24.227313 => 14:53:24.231353
[0m14:53:24.231684 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.dim_addressid
[0m14:53:24.231900 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.latest_rm_urn (compile): 14:53:24.228999 => 14:53:24.231798
[0m14:53:24.232089 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.latest_epc_urn
[0m14:53:24.247245 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.dim_addressid"
[0m14:53:24.247484 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.latest_rm_urn
[0m14:53:24.249329 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.latest_epc_urn"
[0m14:53:24.251186 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.latest_rm_urn"
[0m14:53:24.251958 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.dim_addressid"
[0m14:53:24.252285 [debug] [Thread-1 (]: On model.rightmove_epc.dim_addressid: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_addressid"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE ADDRESS'

with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource,
    POSTCODE
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs 
    where REMOVE_FROM_RM_MATCH = 0
    AND ADDRESSID IS NOT NULL

),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    WHERE ADDRESSID IS NOT NULL

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where addressid is not null
  );
[0m14:53:24.252601 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:53:24.253252 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.latest_rm_urn"
[0m14:53:24.253784 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.latest_epc_urn"
[0m14:53:24.254368 [debug] [Thread-3 (]: On model.rightmove_epc.latest_rm_urn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.latest_rm_urn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NOT NULL
),

change_date AS (
    SELECT 
        UPRN AS UPRN_CD, 
        MAX(CHANGE_DATE) AS MAX_CHANGE_DATE 
    FROM rm
    GROUP BY UPRN
),

rm_latest as (

    SELECT distinct * FROM rm
    LEFT JOIN change_date cd
    ON rm.UPRN = cd.UPRN_CD
    WHERE cd.MAX_CHANGE_DATE = rm.CHANGE_DATE 
 --  and UPRN = 100090588560
    
)

select DISTINCT * from rm_latest

/*
select uprn, count(*) from rm_latest
group by 1
having count(*) >1
*/
  );
[0m14:53:24.254855 [debug] [Thread-2 (]: On model.rightmove_epc.latest_epc_urn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.latest_epc_urn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn
  
   as (
    with epc_max_date as (

    select uprn as UPRN_EPC,
    MAX(LODGEMENT_DATE) AS MAX_LODGEMENT_DATE,
    from  ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    group by 1


),

latest_epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc
    inner join epc_max_date on epc.uprn = epc_max_date.UPRN_EPC
    where MAX_LODGEMENT_DATE = LODGEMENT_DATE
   -- and uprn = 200073066

)

select DISTINCT * from latest_epc


/*
select uprn, count(*) from latest_epc
group by 1
having count(*) >1
*/
  );
[0m14:53:24.255115 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m14:53:24.255316 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m14:53:24.734489 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m14:53:24.748530 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.latest_epc_urn (execute): 14:53:24.247648 => 14:53:24.748379
[0m14:53:24.748815 [debug] [Thread-2 (]: On model.rightmove_epc.latest_epc_urn: Close
[0m14:53:24.770430 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:53:24.772166 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.dim_addressid (execute): 14:53:24.232208 => 14:53:24.772036
[0m14:53:24.772413 [debug] [Thread-1 (]: On model.rightmove_epc.dim_addressid: Close
[0m14:53:24.840386 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e8f4dd7a-e9ef-47d1-95f2-8c1da8c7f988', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109e1bc10>]}
[0m14:53:24.840951 [info ] [Thread-2 (]: 2 of 6 OK created sql view model dbt_melissa_rm_epc.latest_epc_urn ............. [[32mSUCCESS 1[0m in 0.65s]
[0m14:53:24.841374 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.latest_epc_urn
[0m14:53:24.841843 [debug] [Thread-5 (]: Began running node model.rightmove_epc.epc_flats_count
[0m14:53:24.842209 [info ] [Thread-5 (]: 4 of 6 START sql view model dbt_melissa_rm_epc.epc_flats_count ................. [RUN]
[0m14:53:24.842798 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.rightmove_epc.epc_flats_count'
[0m14:53:24.843070 [debug] [Thread-5 (]: Began compiling node model.rightmove_epc.epc_flats_count
[0m14:53:24.845397 [debug] [Thread-5 (]: Writing injected SQL for node "model.rightmove_epc.epc_flats_count"
[0m14:53:24.846041 [debug] [Thread-5 (]: Timing info for model.rightmove_epc.epc_flats_count (compile): 14:53:24.843226 => 14:53:24.845886
[0m14:53:24.846302 [debug] [Thread-5 (]: Began executing node model.rightmove_epc.epc_flats_count
[0m14:53:24.848626 [debug] [Thread-5 (]: Writing runtime sql for node "model.rightmove_epc.epc_flats_count"
[0m14:53:24.849509 [debug] [Thread-5 (]: Using snowflake connection "model.rightmove_epc.epc_flats_count"
[0m14:53:24.849776 [debug] [Thread-5 (]: On model.rightmove_epc.epc_flats_count: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.epc_flats_count"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.epc_flats_count
  
   as (
    with epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn

),

flat_epc as (

    select uprn,
    count(BUILDING_REFERENCE_NUMBER) as building_ref_count
    from epc
    group by 1
    having count(BUILDING_REFERENCE_NUMBER) >1

)

select * from flat_epc
  );
[0m14:53:24.850022 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m14:53:24.855943 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e8f4dd7a-e9ef-47d1-95f2-8c1da8c7f988', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109e12b90>]}
[0m14:53:24.856419 [info ] [Thread-1 (]: 1 of 6 OK created sql view model dbt_melissa_rm_epc.dim_addressid .............. [[32mSUCCESS 1[0m in 0.67s]
[0m14:53:24.856771 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.dim_addressid
[0m14:53:24.870598 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:53:24.872342 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.latest_rm_urn (execute): 14:53:24.249544 => 14:53:24.872214
[0m14:53:24.872864 [debug] [Thread-3 (]: On model.rightmove_epc.latest_rm_urn: Close
[0m14:53:24.951305 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e8f4dd7a-e9ef-47d1-95f2-8c1da8c7f988', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109fd6510>]}
[0m14:53:24.952031 [info ] [Thread-3 (]: 3 of 6 OK created sql view model dbt_melissa_rm_epc.latest_rm_urn .............. [[32mSUCCESS 1[0m in 0.76s]
[0m14:53:24.952488 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.latest_rm_urn
[0m14:53:24.952913 [debug] [Thread-7 (]: Began running node model.rightmove_epc.false_listings_count
[0m14:53:24.953198 [info ] [Thread-7 (]: 5 of 6 START sql view model dbt_melissa_rm_epc.false_listings_count ............ [RUN]
[0m14:53:24.953637 [debug] [Thread-7 (]: Acquiring new snowflake connection 'model.rightmove_epc.false_listings_count'
[0m14:53:24.953835 [debug] [Thread-7 (]: Began compiling node model.rightmove_epc.false_listings_count
[0m14:53:24.956653 [debug] [Thread-7 (]: Writing injected SQL for node "model.rightmove_epc.false_listings_count"
[0m14:53:24.957247 [debug] [Thread-7 (]: Timing info for model.rightmove_epc.false_listings_count (compile): 14:53:24.953956 => 14:53:24.957122
[0m14:53:24.957458 [debug] [Thread-7 (]: Began executing node model.rightmove_epc.false_listings_count
[0m14:53:24.959318 [debug] [Thread-7 (]: Writing runtime sql for node "model.rightmove_epc.false_listings_count"
[0m14:53:24.959995 [debug] [Thread-7 (]: Using snowflake connection "model.rightmove_epc.false_listings_count"
[0m14:53:24.960206 [debug] [Thread-7 (]: On model.rightmove_epc.false_listings_count: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.false_listings_count"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.false_listings_count
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn

),

false_rm as (

    select 
    uprn,
    count(LISTING_ID) listing_count
    from rm
    group by 1
    having count(LISTING_ID) >1

)

select * from false_rm
  );
[0m14:53:24.960403 [debug] [Thread-7 (]: Opening a new connection, currently in state init
[0m14:53:25.340609 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m14:53:25.342785 [debug] [Thread-5 (]: Timing info for model.rightmove_epc.epc_flats_count (execute): 14:53:24.846458 => 14:53:25.342620
[0m14:53:25.343099 [debug] [Thread-5 (]: On model.rightmove_epc.epc_flats_count: Close
[0m14:53:25.415222 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e8f4dd7a-e9ef-47d1-95f2-8c1da8c7f988', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109e34310>]}
[0m14:53:25.415779 [info ] [Thread-5 (]: 4 of 6 OK created sql view model dbt_melissa_rm_epc.epc_flats_count ............ [[32mSUCCESS 1[0m in 0.57s]
[0m14:53:25.416195 [debug] [Thread-5 (]: Finished running node model.rightmove_epc.epc_flats_count
[0m14:53:25.423714 [debug] [Thread-7 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m14:53:25.425445 [debug] [Thread-7 (]: Timing info for model.rightmove_epc.false_listings_count (execute): 14:53:24.957583 => 14:53:25.425320
[0m14:53:25.425685 [debug] [Thread-7 (]: On model.rightmove_epc.false_listings_count: Close
[0m14:53:25.502191 [debug] [Thread-7 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e8f4dd7a-e9ef-47d1-95f2-8c1da8c7f988', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a21c150>]}
[0m14:53:25.502692 [info ] [Thread-7 (]: 5 of 6 OK created sql view model dbt_melissa_rm_epc.false_listings_count ....... [[32mSUCCESS 1[0m in 0.55s]
[0m14:53:25.503050 [debug] [Thread-7 (]: Finished running node model.rightmove_epc.false_listings_count
[0m14:53:25.503523 [debug] [Thread-4 (]: Began running node model.rightmove_epc.dim_uprn
[0m14:53:25.503768 [info ] [Thread-4 (]: 6 of 6 START sql view model dbt_melissa_rm_epc.dim_uprn ........................ [RUN]
[0m14:53:25.504207 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_uprn'
[0m14:53:25.504399 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.dim_uprn
[0m14:53:25.506656 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.dim_uprn"
[0m14:53:25.508120 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_uprn (compile): 14:53:25.504518 => 14:53:25.507905
[0m14:53:25.508396 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.dim_uprn
[0m14:53:25.510383 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.dim_uprn"
[0m14:53:25.511403 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.dim_uprn"
[0m14:53:25.511664 [debug] [Thread-4 (]: On model.rightmove_epc.dim_uprn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_uprn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE UPRNS


with epc as (

    select distinct
    epc.uprn,
    epc.addressid,
    epc.ADDRESS,
    'EPC' AS datasource,
    epc.POSTCODE,
    case when multi.uprn is null then NULL else 1 end as multi_uprn

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc
    left join ANALYTICS_DEV.dbt_melissa_rm_epc.epc_flats_count multi on epc.uprn = multi.uprn

    where epc.REMOVE_FROM_RM_MATCH = 0
    AND epc.UPRN IS NOT NULL
),

rightmove as (

 select distinct
    rm.uprn,
    rm.addressid,
    concat(rm.ADDRESS_1,',',rm.ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    rm.FULL_POSTCODE AS POSTCODE,
    multi.uprn as multi_uprn

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove rm
    left join ANALYTICS_DEV.dbt_melissa_rm_epc.false_listings_count multi on rm.uprn = multi.uprn
    WHERE rm.UPRN IS NOT NULL


),

final as (

    select * from epc
    union all
    select * from rightmove
)

select distinct * from final
  );
[0m14:53:25.511895 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m14:53:26.364286 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:53:26.367010 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_uprn (execute): 14:53:25.508533 => 14:53:26.366834
[0m14:53:26.367349 [debug] [Thread-4 (]: On model.rightmove_epc.dim_uprn: Close
[0m14:53:26.452833 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e8f4dd7a-e9ef-47d1-95f2-8c1da8c7f988', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10926f550>]}
[0m14:53:26.453489 [info ] [Thread-4 (]: 6 of 6 OK created sql view model dbt_melissa_rm_epc.dim_uprn ................... [[32mSUCCESS 1[0m in 0.95s]
[0m14:53:26.453973 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.dim_uprn
[0m14:53:26.455414 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:53:26.455649 [debug] [MainThread]: Connection 'model.rightmove_epc.dim_addressid' was properly closed.
[0m14:53:26.455845 [debug] [MainThread]: Connection 'model.rightmove_epc.latest_epc_urn' was properly closed.
[0m14:53:26.456032 [debug] [MainThread]: Connection 'model.rightmove_epc.latest_rm_urn' was properly closed.
[0m14:53:26.456213 [debug] [MainThread]: Connection 'model.rightmove_epc.epc_flats_count' was properly closed.
[0m14:53:26.456392 [debug] [MainThread]: Connection 'model.rightmove_epc.false_listings_count' was properly closed.
[0m14:53:26.456568 [debug] [MainThread]: Connection 'model.rightmove_epc.dim_uprn' was properly closed.
[0m14:53:26.456842 [info ] [MainThread]: 
[0m14:53:26.457087 [info ] [MainThread]: Finished running 6 view models in 0 hours 0 minutes and 3.48 seconds (3.48s).
[0m14:53:26.457856 [debug] [MainThread]: Command end result
[0m14:53:26.465428 [info ] [MainThread]: 
[0m14:53:26.465715 [info ] [MainThread]: [32mCompleted successfully[0m
[0m14:53:26.465912 [info ] [MainThread]: 
[0m14:53:26.466130 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=0 SKIP=0 TOTAL=6
[0m14:53:26.468190 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.8077903, "process_user_time": 1.49453, "process_kernel_time": 0.196523, "process_mem_max_rss": "137527296", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:53:26.468614 [debug] [MainThread]: Command `dbt run` succeeded at 14:53:26.468521 after 3.81 seconds
[0m14:53:26.468885 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10551e0d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1053ca210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107c2d950>]}
[0m14:53:26.469153 [debug] [MainThread]: Flushing usage events
[0m14:57:39.989091 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1093d0b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109426390>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109427090>]}


============================== 14:57:39.992297 | f641aeb4-6167-4c14-a371-524d14e4bddd ==============================
[0m14:57:39.992297 [info ] [MainThread]: Running with dbt=1.7.10
[0m14:57:39.992685 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt run --select models/bridge', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m14:57:40.195234 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f641aeb4-6167-4c14-a371-524d14e4bddd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10941b190>]}
[0m14:57:40.235330 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f641aeb4-6167-4c14-a371-524d14e4bddd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109470310>]}
[0m14:57:40.236017 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m14:57:40.247809 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m14:57:40.274570 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m14:57:40.274920 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m14:57:40.278987 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f641aeb4-6167-4c14-a371-524d14e4bddd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10940c790>]}
[0m14:57:40.287573 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f641aeb4-6167-4c14-a371-524d14e4bddd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109e1a190>]}
[0m14:57:40.287898 [info ] [MainThread]: Found 19 models, 1 analysis, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m14:57:40.288116 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f641aeb4-6167-4c14-a371-524d14e4bddd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109b67690>]}
[0m14:57:40.289382 [info ] [MainThread]: 
[0m14:57:40.289862 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m14:57:40.290652 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m14:57:40.298356 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m14:57:40.298724 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m14:57:40.298912 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m14:57:40.783069 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 0.0 seconds
[0m14:57:40.784677 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m14:57:40.864241 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m14:57:40.869707 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m14:57:40.869938 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m14:57:40.870123 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m14:57:41.211443 [debug] [ThreadPool]: SQL status: SUCCESS 19 in 0.0 seconds
[0m14:57:41.213724 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m14:57:41.309875 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f641aeb4-6167-4c14-a371-524d14e4bddd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109c05b90>]}
[0m14:57:41.310812 [info ] [MainThread]: Concurrency: 8 threads (target='dev')
[0m14:57:41.311163 [info ] [MainThread]: 
[0m14:57:41.314613 [debug] [Thread-1 (]: Began running node model.rightmove_epc.dim_addressid
[0m14:57:41.314951 [debug] [Thread-2 (]: Began running node model.rightmove_epc.latest_epc_urn
[0m14:57:41.315302 [debug] [Thread-3 (]: Began running node model.rightmove_epc.latest_rm_urn
[0m14:57:41.315649 [info ] [Thread-1 (]: 1 of 6 START sql view model dbt_melissa_rm_epc.dim_addressid ................... [RUN]
[0m14:57:41.316030 [info ] [Thread-2 (]: 2 of 6 START sql view model dbt_melissa_rm_epc.latest_epc_urn .................. [RUN]
[0m14:57:41.316385 [info ] [Thread-3 (]: 3 of 6 START sql view model dbt_melissa_rm_epc.latest_rm_urn ................... [RUN]
[0m14:57:41.318520 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.dim_addressid)
[0m14:57:41.319182 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.latest_epc_urn'
[0m14:57:41.319717 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.rightmove_epc.latest_rm_urn'
[0m14:57:41.320100 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.dim_addressid
[0m14:57:41.320477 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.latest_epc_urn
[0m14:57:41.320802 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.latest_rm_urn
[0m14:57:41.361368 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.dim_addressid"
[0m14:57:41.363401 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.latest_epc_urn"
[0m14:57:41.365081 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.latest_rm_urn"
[0m14:57:41.365842 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.latest_epc_urn (compile): 14:57:41.361701 => 14:57:41.365709
[0m14:57:41.366195 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.dim_addressid (compile): 14:57:41.321262 => 14:57:41.366009
[0m14:57:41.366488 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.latest_rm_urn (compile): 14:57:41.363624 => 14:57:41.366350
[0m14:57:41.366705 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.latest_epc_urn
[0m14:57:41.366922 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.dim_addressid
[0m14:57:41.367121 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.latest_rm_urn
[0m14:57:41.382793 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.latest_epc_urn"
[0m14:57:41.384798 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.dim_addressid"
[0m14:57:41.386607 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.latest_rm_urn"
[0m14:57:41.387551 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.latest_rm_urn"
[0m14:57:41.388092 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.latest_epc_urn"
[0m14:57:41.388806 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.dim_addressid"
[0m14:57:41.389020 [debug] [Thread-3 (]: On model.rightmove_epc.latest_rm_urn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.latest_rm_urn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NOT NULL
),

change_date AS (
    SELECT 
        UPRN AS UPRN_CD, 
        MAX(CHANGE_DATE) AS MAX_CHANGE_DATE 
    FROM rm
    GROUP BY UPRN
),

rm_latest as (

    SELECT distinct * FROM rm
    LEFT JOIN change_date cd
    ON rm.UPRN = cd.UPRN_CD
    WHERE cd.MAX_CHANGE_DATE = rm.CHANGE_DATE 
 --  and UPRN = 100090588560
    
)

select DISTINCT * from rm_latest

/*
select uprn, count(*) from rm_latest
group by 1
having count(*) >1
*/
  );
[0m14:57:41.389265 [debug] [Thread-2 (]: On model.rightmove_epc.latest_epc_urn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.latest_epc_urn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn
  
   as (
    with epc_max_date as (

    select uprn as UPRN_EPC,
    MAX(LODGEMENT_DATE) AS MAX_LODGEMENT_DATE,
    from  ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    group by 1


),

latest_epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc
    inner join epc_max_date on epc.uprn = epc_max_date.UPRN_EPC
    where MAX_LODGEMENT_DATE = LODGEMENT_DATE
   -- and uprn = 200073066

)

select DISTINCT * from latest_epc


/*
select uprn, count(*) from latest_epc
group by 1
having count(*) >1
*/
  );
[0m14:57:41.389524 [debug] [Thread-1 (]: On model.rightmove_epc.dim_addressid: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_addressid"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE ADDRESS'

with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource,
    POSTCODE
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs 
    where REMOVE_FROM_RM_MATCH = 0
    AND ADDRESSID IS NOT NULL

),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    WHERE ADDRESSID IS NOT NULL

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where addressid is not null
  );
[0m14:57:41.389754 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m14:57:41.389939 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m14:57:41.390120 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m14:57:42.026512 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:57:42.042621 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.latest_epc_urn (execute): 14:57:41.367251 => 14:57:42.042463
[0m14:57:42.043643 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:57:42.043926 [debug] [Thread-2 (]: On model.rightmove_epc.latest_epc_urn: Close
[0m14:57:42.044311 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:57:42.046090 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.latest_rm_urn (execute): 14:57:41.384990 => 14:57:42.045962
[0m14:57:42.048444 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.dim_addressid (execute): 14:57:41.383046 => 14:57:42.048307
[0m14:57:42.048971 [debug] [Thread-3 (]: On model.rightmove_epc.latest_rm_urn: Close
[0m14:57:42.049282 [debug] [Thread-1 (]: On model.rightmove_epc.dim_addressid: Close
[0m14:57:42.117949 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f641aeb4-6167-4c14-a371-524d14e4bddd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109f0fc10>]}
[0m14:57:42.118483 [info ] [Thread-3 (]: 3 of 6 OK created sql view model dbt_melissa_rm_epc.latest_rm_urn .............. [[32mSUCCESS 1[0m in 0.80s]
[0m14:57:42.118846 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.latest_rm_urn
[0m14:57:42.119198 [debug] [Thread-5 (]: Began running node model.rightmove_epc.false_listings_count
[0m14:57:42.119472 [info ] [Thread-5 (]: 4 of 6 START sql view model dbt_melissa_rm_epc.false_listings_count ............ [RUN]
[0m14:57:42.119921 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.rightmove_epc.false_listings_count'
[0m14:57:42.120124 [debug] [Thread-5 (]: Began compiling node model.rightmove_epc.false_listings_count
[0m14:57:42.121998 [debug] [Thread-5 (]: Writing injected SQL for node "model.rightmove_epc.false_listings_count"
[0m14:57:42.122535 [debug] [Thread-5 (]: Timing info for model.rightmove_epc.false_listings_count (compile): 14:57:42.120244 => 14:57:42.122419
[0m14:57:42.122732 [debug] [Thread-5 (]: Began executing node model.rightmove_epc.false_listings_count
[0m14:57:42.124553 [debug] [Thread-5 (]: Writing runtime sql for node "model.rightmove_epc.false_listings_count"
[0m14:57:42.125132 [debug] [Thread-5 (]: Using snowflake connection "model.rightmove_epc.false_listings_count"
[0m14:57:42.125351 [debug] [Thread-5 (]: On model.rightmove_epc.false_listings_count: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.false_listings_count"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.false_listings_count
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn

),

false_rm as (

    select 
    uprn,
    count(LISTING_ID) listing_count
    from rm
    group by 1
    having count(LISTING_ID) >1

)

select * from false_rm
  );
[0m14:57:42.125574 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m14:57:42.132363 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f641aeb4-6167-4c14-a371-524d14e4bddd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109f23a50>]}
[0m14:57:42.132760 [info ] [Thread-2 (]: 2 of 6 OK created sql view model dbt_melissa_rm_epc.latest_epc_urn ............. [[32mSUCCESS 1[0m in 0.81s]
[0m14:57:42.133262 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.latest_epc_urn
[0m14:57:42.133590 [debug] [Thread-7 (]: Began running node model.rightmove_epc.epc_flats_count
[0m14:57:42.133842 [info ] [Thread-7 (]: 5 of 6 START sql view model dbt_melissa_rm_epc.epc_flats_count ................. [RUN]
[0m14:57:42.134245 [debug] [Thread-7 (]: Acquiring new snowflake connection 'model.rightmove_epc.epc_flats_count'
[0m14:57:42.134646 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f641aeb4-6167-4c14-a371-524d14e4bddd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109bf9550>]}
[0m14:57:42.134911 [debug] [Thread-7 (]: Began compiling node model.rightmove_epc.epc_flats_count
[0m14:57:42.135268 [info ] [Thread-1 (]: 1 of 6 OK created sql view model dbt_melissa_rm_epc.dim_addressid .............. [[32mSUCCESS 1[0m in 0.82s]
[0m14:57:42.138172 [debug] [Thread-7 (]: Writing injected SQL for node "model.rightmove_epc.epc_flats_count"
[0m14:57:42.138634 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.dim_addressid
[0m14:57:42.139396 [debug] [Thread-7 (]: Timing info for model.rightmove_epc.epc_flats_count (compile): 14:57:42.135451 => 14:57:42.139244
[0m14:57:42.139605 [debug] [Thread-7 (]: Began executing node model.rightmove_epc.epc_flats_count
[0m14:57:42.141482 [debug] [Thread-7 (]: Writing runtime sql for node "model.rightmove_epc.epc_flats_count"
[0m14:57:42.142078 [debug] [Thread-7 (]: Using snowflake connection "model.rightmove_epc.epc_flats_count"
[0m14:57:42.142288 [debug] [Thread-7 (]: On model.rightmove_epc.epc_flats_count: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.epc_flats_count"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.epc_flats_count
  
   as (
    with epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn

),

flat_epc as (

    select uprn,
    count(BUILDING_REFERENCE_NUMBER) as building_ref_count
    from epc
    group by 1
    having count(BUILDING_REFERENCE_NUMBER) >1

)

select * from flat_epc
  );
[0m14:57:42.142481 [debug] [Thread-7 (]: Opening a new connection, currently in state init
[0m14:57:42.638427 [debug] [Thread-7 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m14:57:42.640864 [debug] [Thread-7 (]: Timing info for model.rightmove_epc.epc_flats_count (execute): 14:57:42.139732 => 14:57:42.640687
[0m14:57:42.641199 [debug] [Thread-7 (]: On model.rightmove_epc.epc_flats_count: Close
[0m14:57:42.651012 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:57:42.653042 [debug] [Thread-5 (]: Timing info for model.rightmove_epc.false_listings_count (execute): 14:57:42.122863 => 14:57:42.652866
[0m14:57:42.653357 [debug] [Thread-5 (]: On model.rightmove_epc.false_listings_count: Close
[0m14:57:42.719366 [debug] [Thread-7 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f641aeb4-6167-4c14-a371-524d14e4bddd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a24d450>]}
[0m14:57:42.720056 [info ] [Thread-7 (]: 5 of 6 OK created sql view model dbt_melissa_rm_epc.epc_flats_count ............ [[32mSUCCESS 1[0m in 0.59s]
[0m14:57:42.720623 [debug] [Thread-7 (]: Finished running node model.rightmove_epc.epc_flats_count
[0m14:57:42.746859 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f641aeb4-6167-4c14-a371-524d14e4bddd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109fece10>]}
[0m14:57:42.747507 [info ] [Thread-5 (]: 4 of 6 OK created sql view model dbt_melissa_rm_epc.false_listings_count ....... [[32mSUCCESS 1[0m in 0.63s]
[0m14:57:42.747934 [debug] [Thread-5 (]: Finished running node model.rightmove_epc.false_listings_count
[0m14:57:42.748455 [debug] [Thread-4 (]: Began running node model.rightmove_epc.dim_uprn
[0m14:57:42.748944 [info ] [Thread-4 (]: 6 of 6 START sql view model dbt_melissa_rm_epc.dim_uprn ........................ [RUN]
[0m14:57:42.749552 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_uprn'
[0m14:57:42.749825 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.dim_uprn
[0m14:57:42.752952 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.dim_uprn"
[0m14:57:42.754642 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_uprn (compile): 14:57:42.749997 => 14:57:42.754471
[0m14:57:42.754913 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.dim_uprn
[0m14:57:42.757105 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.dim_uprn"
[0m14:57:42.758656 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.dim_uprn"
[0m14:57:42.758950 [debug] [Thread-4 (]: On model.rightmove_epc.dim_uprn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_uprn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE UPRNS


with epc as (

    select distinct
    epc.uprn,
    epc.addressid,
    epc.ADDRESS,
    'EPC' AS datasource,
    epc.POSTCODE,
    case when multi.uprn is null then NULL else 1 end as multi_uprn

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc
    left join ANALYTICS_DEV.dbt_melissa_rm_epc.epc_flats_count multi on epc.uprn = multi.uprn

    where epc.REMOVE_FROM_RM_MATCH = 0
    AND epc.UPRN IS NOT NULL
),

rightmove as (

 select distinct
    rm.uprn,
    rm.addressid,
    concat(rm.ADDRESS_1,',',rm.ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    rm.FULL_POSTCODE AS POSTCODE,
    case when multi.uprn is null then NULL else 1 end as multi_uprn

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove rm
    left join ANALYTICS_DEV.dbt_melissa_rm_epc.false_listings_count multi on rm.uprn = multi.uprn
    WHERE rm.UPRN IS NOT NULL


),

final as (

    select * from epc
    union all
    select * from rightmove
)

select distinct * from final
  );
[0m14:57:42.759226 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m14:57:43.492979 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m14:57:43.494655 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_uprn (execute): 14:57:42.755057 => 14:57:43.494539
[0m14:57:43.494876 [debug] [Thread-4 (]: On model.rightmove_epc.dim_uprn: Close
[0m14:57:43.574633 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f641aeb4-6167-4c14-a371-524d14e4bddd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108cdced0>]}
[0m14:57:43.575154 [info ] [Thread-4 (]: 6 of 6 OK created sql view model dbt_melissa_rm_epc.dim_uprn ................... [[32mSUCCESS 1[0m in 0.83s]
[0m14:57:43.575530 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.dim_uprn
[0m14:57:43.576860 [debug] [MainThread]: Connection 'master' was properly closed.
[0m14:57:43.577097 [debug] [MainThread]: Connection 'model.rightmove_epc.dim_addressid' was properly closed.
[0m14:57:43.577279 [debug] [MainThread]: Connection 'model.rightmove_epc.latest_epc_urn' was properly closed.
[0m14:57:43.577450 [debug] [MainThread]: Connection 'model.rightmove_epc.latest_rm_urn' was properly closed.
[0m14:57:43.577600 [debug] [MainThread]: Connection 'model.rightmove_epc.false_listings_count' was properly closed.
[0m14:57:43.577749 [debug] [MainThread]: Connection 'model.rightmove_epc.epc_flats_count' was properly closed.
[0m14:57:43.577894 [debug] [MainThread]: Connection 'model.rightmove_epc.dim_uprn' was properly closed.
[0m14:57:43.578185 [info ] [MainThread]: 
[0m14:57:43.578378 [info ] [MainThread]: Finished running 6 view models in 0 hours 0 minutes and 3.29 seconds (3.29s).
[0m14:57:43.579012 [debug] [MainThread]: Command end result
[0m14:57:43.585540 [info ] [MainThread]: 
[0m14:57:43.585808 [info ] [MainThread]: [32mCompleted successfully[0m
[0m14:57:43.585993 [info ] [MainThread]: 
[0m14:57:43.586176 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=0 SKIP=0 TOTAL=6
[0m14:57:43.587919 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.6313872, "process_user_time": 1.484223, "process_kernel_time": 0.207956, "process_mem_max_rss": "135430144", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m14:57:43.588250 [debug] [MainThread]: Command `dbt run` succeeded at 14:57:43.588172 after 3.63 seconds
[0m14:57:43.588473 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1056ca0d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105576210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10558e350>]}
[0m14:57:43.588682 [debug] [MainThread]: Flushing usage events
[0m15:07:06.198052 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11243e210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11249a390>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11249af10>]}


============================== 15:07:06.201502 | fac27697-6f9a-454d-a20c-91795c47e89e ==============================
[0m15:07:06.201502 [info ] [MainThread]: Running with dbt=1.7.10
[0m15:07:06.201981 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'debug': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m15:07:06.403574 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fac27697-6f9a-454d-a20c-91795c47e89e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1124e4690>]}
[0m15:07:06.443655 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'fac27697-6f9a-454d-a20c-91795c47e89e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1148afdd0>]}
[0m15:07:06.444355 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m15:07:06.457516 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m15:07:06.492416 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:07:06.492745 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:07:06.496830 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'fac27697-6f9a-454d-a20c-91795c47e89e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1124ded90>]}
[0m15:07:06.505309 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'fac27697-6f9a-454d-a20c-91795c47e89e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11248f410>]}
[0m15:07:06.505615 [info ] [MainThread]: Found 19 models, 1 analysis, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m15:07:06.505832 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fac27697-6f9a-454d-a20c-91795c47e89e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1148eb490>]}
[0m15:07:06.507169 [info ] [MainThread]: 
[0m15:07:06.507619 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m15:07:06.508591 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m15:07:06.516475 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m15:07:06.516768 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m15:07:06.516950 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:07:06.953972 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 0.0 seconds
[0m15:07:06.955592 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m15:07:07.027828 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m15:07:07.032914 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m15:07:07.033164 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m15:07:07.033349 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:07:07.556624 [debug] [ThreadPool]: SQL status: SUCCESS 19 in 1.0 seconds
[0m15:07:07.558400 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m15:07:07.641476 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fac27697-6f9a-454d-a20c-91795c47e89e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114c117d0>]}
[0m15:07:07.642134 [info ] [MainThread]: Concurrency: 8 threads (target='dev')
[0m15:07:07.642380 [info ] [MainThread]: 
[0m15:07:07.645220 [debug] [Thread-1 (]: Began running node model.rightmove_epc.stg_epc_certs
[0m15:07:07.645505 [debug] [Thread-2 (]: Began running node model.rightmove_epc.stg_rightmove
[0m15:07:07.645833 [info ] [Thread-1 (]: 1 of 19 START sql view model dbt_melissa_rm_epc.stg_epc_certs .................. [RUN]
[0m15:07:07.646139 [info ] [Thread-2 (]: 2 of 19 START sql view model dbt_melissa_rm_epc.stg_rightmove .................. [RUN]
[0m15:07:07.646597 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.stg_epc_certs)
[0m15:07:07.648296 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.stg_rightmove'
[0m15:07:07.648545 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.stg_epc_certs
[0m15:07:07.648791 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.stg_rightmove
[0m15:07:07.685237 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.stg_epc_certs"
[0m15:07:07.687047 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.stg_rightmove"
[0m15:07:07.687719 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (compile): 15:07:07.685487 => 15:07:07.687594
[0m15:07:07.687958 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (compile): 15:07:07.648933 => 15:07:07.687839
[0m15:07:07.688165 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.stg_rightmove
[0m15:07:07.688360 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.stg_epc_certs
[0m15:07:07.703495 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.stg_rightmove"
[0m15:07:07.705395 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.stg_epc_certs"
[0m15:07:07.706455 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.stg_epc_certs"
[0m15:07:07.706727 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_epc_certs"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
  
   as (
    WITH epc_certs as (
    
    select 
    UPRN,
    LODGEMENT_DATE,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
   -- COUNTY,
    LOCAL_AUTHORITY as LOCAL_AUTHORITY_CODE,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    UPPER(CASE WHEN (UPPER(ADDRESS1) LIKE 'FLAT%' OR UPPER(ADDRESS1) LIKE 'UNIT%') or UPPER(ADDRESS1) LIKE 'ROOM%' 
    THEN TRIM(REPLACE(REPLACE(CONCAT(ADDRESS),','),' '))
    ELSE trim(replace(replace(ADDRESS1,' '),',')) END) AS ADDRESSID,
    CASE WHEN UPRN is null and addressid is null THEN 1 else 0 end as REMOVE_FROM_RM_MATCH,
    FLOOR_LEVEL,
    FLAT_TOP_STOREY,
    FLAT_STOREY_COUNT,
    PROPERTY_TYPE
 from  RAW.EPC_TEST_DATA.EPC_CERTIFICATES 

)

SELECT * FROM epc_certs
  );
[0m15:07:07.706964 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:07:07.707482 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.stg_rightmove"
[0m15:07:07.708353 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_rightmove"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
  
   as (
    with rm as (

    SELECT 
    LISTING_ID,
    CHANGE_DATE,
    UPPER(TRIM(replace(REPLACE(CONCAT(ADDRESS_1::VARCHAR,ADDRESS_2::VARCHAR),' '),','))) AS ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, 
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    BEDROOM,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
 --   STUDENTLET_FLAG,
    COMBINED_PROPERTY_TYPE
    -- property type
    FROM 
       ANALYTICS.RIGHTMOVE_PROD.CLEAN_RAW_RIGHTMOVE_DATA 

 
)

SELECT * FROM rm
  );
[0m15:07:07.708585 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m15:07:08.193506 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m15:07:08.211687 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (execute): 15:07:07.703707 => 15:07:08.211546
[0m15:07:08.212028 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: Close
[0m15:07:08.231370 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m15:07:08.233391 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (execute): 15:07:07.688473 => 15:07:08.233261
[0m15:07:08.233676 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: Close
[0m15:07:08.308839 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fac27697-6f9a-454d-a20c-91795c47e89e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11248e0d0>]}
[0m15:07:08.309527 [info ] [Thread-1 (]: 1 of 19 OK created sql view model dbt_melissa_rm_epc.stg_epc_certs ............. [[32mSUCCESS 1[0m in 0.66s]
[0m15:07:08.310037 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.stg_epc_certs
[0m15:07:08.310484 [debug] [Thread-4 (]: Began running node model.rightmove_epc.latest_epc_urn
[0m15:07:08.310811 [info ] [Thread-4 (]: 3 of 19 START sql view model dbt_melissa_rm_epc.latest_epc_urn ................. [RUN]
[0m15:07:08.311327 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.rightmove_epc.latest_epc_urn'
[0m15:07:08.311534 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.latest_epc_urn
[0m15:07:08.313841 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.latest_epc_urn"
[0m15:07:08.314482 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.latest_epc_urn (compile): 15:07:08.311719 => 15:07:08.314350
[0m15:07:08.314695 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.latest_epc_urn
[0m15:07:08.316691 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.latest_epc_urn"
[0m15:07:08.318072 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.latest_epc_urn"
[0m15:07:08.318394 [debug] [Thread-4 (]: On model.rightmove_epc.latest_epc_urn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.latest_epc_urn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn
  
   as (
    with epc_max_date as (

    select uprn as UPRN_EPC,
    MAX(LODGEMENT_DATE) AS MAX_LODGEMENT_DATE,
    from  ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    group by 1


),

latest_epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc
    inner join epc_max_date on epc.uprn = epc_max_date.UPRN_EPC
    where MAX_LODGEMENT_DATE = LODGEMENT_DATE
   -- and uprn = 200073066

)

select DISTINCT * from latest_epc


/*
select uprn, count(*) from latest_epc
group by 1
having count(*) >1
*/
  );
[0m15:07:08.318763 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m15:07:08.331952 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fac27697-6f9a-454d-a20c-91795c47e89e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1158df310>]}
[0m15:07:08.332575 [info ] [Thread-2 (]: 2 of 19 OK created sql view model dbt_melissa_rm_epc.stg_rightmove ............. [[32mSUCCESS 1[0m in 0.68s]
[0m15:07:08.332963 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.stg_rightmove
[0m15:07:08.333403 [debug] [Thread-6 (]: Began running node model.rightmove_epc.dim_addressid
[0m15:07:08.333733 [debug] [Thread-7 (]: Began running node model.rightmove_epc.latest_rm_urn
[0m15:07:08.334097 [info ] [Thread-6 (]: 4 of 19 START sql view model dbt_melissa_rm_epc.dim_addressid .................. [RUN]
[0m15:07:08.334415 [info ] [Thread-7 (]: 5 of 19 START sql view model dbt_melissa_rm_epc.latest_rm_urn .................. [RUN]
[0m15:07:08.334907 [debug] [Thread-6 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_addressid'
[0m15:07:08.335337 [debug] [Thread-7 (]: Acquiring new snowflake connection 'model.rightmove_epc.latest_rm_urn'
[0m15:07:08.335686 [debug] [Thread-6 (]: Began compiling node model.rightmove_epc.dim_addressid
[0m15:07:08.335983 [debug] [Thread-7 (]: Began compiling node model.rightmove_epc.latest_rm_urn
[0m15:07:08.338051 [debug] [Thread-6 (]: Writing injected SQL for node "model.rightmove_epc.dim_addressid"
[0m15:07:08.339933 [debug] [Thread-7 (]: Writing injected SQL for node "model.rightmove_epc.latest_rm_urn"
[0m15:07:08.341089 [debug] [Thread-6 (]: Timing info for model.rightmove_epc.dim_addressid (compile): 15:07:08.336177 => 15:07:08.340941
[0m15:07:08.341360 [debug] [Thread-6 (]: Began executing node model.rightmove_epc.dim_addressid
[0m15:07:08.341636 [debug] [Thread-7 (]: Timing info for model.rightmove_epc.latest_rm_urn (compile): 15:07:08.338282 => 15:07:08.341506
[0m15:07:08.343509 [debug] [Thread-6 (]: Writing runtime sql for node "model.rightmove_epc.dim_addressid"
[0m15:07:08.343745 [debug] [Thread-7 (]: Began executing node model.rightmove_epc.latest_rm_urn
[0m15:07:08.347016 [debug] [Thread-7 (]: Writing runtime sql for node "model.rightmove_epc.latest_rm_urn"
[0m15:07:08.347948 [debug] [Thread-6 (]: Using snowflake connection "model.rightmove_epc.dim_addressid"
[0m15:07:08.348250 [debug] [Thread-6 (]: On model.rightmove_epc.dim_addressid: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_addressid"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE ADDRESS'

with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource,
    POSTCODE
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs 
    where REMOVE_FROM_RM_MATCH = 0
    AND ADDRESSID IS NOT NULL

),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    WHERE ADDRESSID IS NOT NULL

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where addressid is not null
  );
[0m15:07:08.348476 [debug] [Thread-6 (]: Opening a new connection, currently in state init
[0m15:07:08.348991 [debug] [Thread-7 (]: Using snowflake connection "model.rightmove_epc.latest_rm_urn"
[0m15:07:08.349984 [debug] [Thread-7 (]: On model.rightmove_epc.latest_rm_urn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.latest_rm_urn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NOT NULL
),

change_date AS (
    SELECT 
        UPRN AS UPRN_CD, 
        MAX(CHANGE_DATE) AS MAX_CHANGE_DATE 
    FROM rm
    GROUP BY UPRN
),

rm_latest as (

    SELECT distinct * FROM rm
    LEFT JOIN change_date cd
    ON rm.UPRN = cd.UPRN_CD
    WHERE cd.MAX_CHANGE_DATE = rm.CHANGE_DATE 
 --  and UPRN = 100090588560
    
)

select DISTINCT * from rm_latest

/*
select uprn, count(*) from rm_latest
group by 1
having count(*) >1
*/
  );
[0m15:07:08.350238 [debug] [Thread-7 (]: Opening a new connection, currently in state init
[0m15:07:08.818732 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m15:07:08.823043 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.latest_epc_urn (execute): 15:07:08.314814 => 15:07:08.822734
[0m15:07:08.823675 [debug] [Thread-4 (]: On model.rightmove_epc.latest_epc_urn: Close
[0m15:07:08.859248 [debug] [Thread-6 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m15:07:08.861393 [debug] [Thread-6 (]: Timing info for model.rightmove_epc.dim_addressid (execute): 15:07:08.341761 => 15:07:08.861258
[0m15:07:08.861658 [debug] [Thread-6 (]: On model.rightmove_epc.dim_addressid: Close
[0m15:07:08.885604 [debug] [Thread-7 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m15:07:08.888489 [debug] [Thread-7 (]: Timing info for model.rightmove_epc.latest_rm_urn (execute): 15:07:08.343941 => 15:07:08.888283
[0m15:07:08.888911 [debug] [Thread-7 (]: On model.rightmove_epc.latest_rm_urn: Close
[0m15:07:08.892834 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fac27697-6f9a-454d-a20c-91795c47e89e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x115c00a90>]}
[0m15:07:08.893776 [info ] [Thread-4 (]: 3 of 19 OK created sql view model dbt_melissa_rm_epc.latest_epc_urn ............ [[32mSUCCESS 1[0m in 0.58s]
[0m15:07:08.894585 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.latest_epc_urn
[0m15:07:08.895432 [debug] [Thread-3 (]: Began running node model.rightmove_epc.epc_flats
[0m15:07:08.895916 [info ] [Thread-3 (]: 6 of 19 START sql table model dbt_melissa_rm_epc.epc_flats ..................... [RUN]
[0m15:07:08.896385 [debug] [Thread-1 (]: Began running node model.rightmove_epc.epc_flats_count
[0m15:07:08.897350 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.rightmove_epc.epc_flats'
[0m15:07:08.897842 [info ] [Thread-1 (]: 7 of 19 START sql view model dbt_melissa_rm_epc.epc_flats_count ................ [RUN]
[0m15:07:08.899011 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.epc_flats
[0m15:07:08.899736 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_epc_certs, now model.rightmove_epc.epc_flats_count)
[0m15:07:08.902528 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.epc_flats"
[0m15:07:08.903031 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.epc_flats_count
[0m15:07:08.906421 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.epc_flats_count"
[0m15:07:08.907286 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.epc_flats (compile): 15:07:08.900000 => 15:07:08.907074
[0m15:07:08.907627 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.epc_flats
[0m15:07:08.923126 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.epc_flats"
[0m15:07:08.923677 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.epc_flats_count (compile): 15:07:08.903718 => 15:07:08.923497
[0m15:07:08.923963 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.epc_flats_count
[0m15:07:08.926218 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.epc_flats_count"
[0m15:07:08.926987 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.epc_flats"
[0m15:07:08.927238 [debug] [Thread-3 (]: On model.rightmove_epc.epc_flats: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.epc_flats"} */
create or replace transient table ANALYTICS_DEV.dbt_melissa_rm_epc.epc_flats
         as
        (with epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn

),

flat_epc as (

    select uprn,
    count(BUILDING_REFERENCE_NUMBER) as building_ref_count
    from epc
    group by 1
    having count(BUILDING_REFERENCE_NUMBER) >1

),

match_flat_epc as (

    select epc.*,
    building_ref_count
    from epc
    inner join flat_epc on epc.uprn = flat_epc.uprn

)

select * from match_flat_epc
        );
[0m15:07:08.927488 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m15:07:08.928212 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.epc_flats_count"
[0m15:07:08.928681 [debug] [Thread-1 (]: On model.rightmove_epc.epc_flats_count: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.epc_flats_count"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.epc_flats_count
  
   as (
    with epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn

),

flat_epc as (

    select uprn,
    count(BUILDING_REFERENCE_NUMBER) as building_ref_count
    from epc
    group by 1
    having count(BUILDING_REFERENCE_NUMBER) >1

)

select * from flat_epc
  );
[0m15:07:08.929133 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:07:08.965024 [debug] [Thread-6 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fac27697-6f9a-454d-a20c-91795c47e89e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114c63450>]}
[0m15:07:08.965511 [info ] [Thread-6 (]: 4 of 19 OK created sql view model dbt_melissa_rm_epc.dim_addressid ............. [[32mSUCCESS 1[0m in 0.63s]
[0m15:07:08.965850 [debug] [Thread-6 (]: Finished running node model.rightmove_epc.dim_addressid
[0m15:07:08.966236 [debug] [Thread-2 (]: Began running node model.rightmove_epc.address_match
[0m15:07:08.966538 [info ] [Thread-2 (]: 8 of 19 START sql view model dbt_melissa_rm_epc.address_match .................. [RUN]
[0m15:07:08.966948 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_rightmove, now model.rightmove_epc.address_match)
[0m15:07:08.967155 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.address_match
[0m15:07:08.968899 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.address_match"
[0m15:07:08.969606 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.address_match (compile): 15:07:08.967277 => 15:07:08.969474
[0m15:07:08.969846 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.address_match
[0m15:07:08.972076 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.address_match"
[0m15:07:08.973065 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.address_match"
[0m15:07:08.973301 [debug] [Thread-2 (]: On model.rightmove_epc.address_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.address_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NULL

),



epc_address as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
    where datasource = 'EPC'
    
)


SELECT rm.*,
CASE WHEN epc_address.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_address.ADDRESSID AS EPC_ADDRESSID,
epc_address.UPRN AS EPC_UPRN


FROM rm
LEFT JOIN epc_address
ON rm.addressid = epc_address.addressid
and rm.FULL_POSTCODE = epc_address.POSTCODE
  );
[0m15:07:08.973510 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m15:07:09.030889 [debug] [Thread-7 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fac27697-6f9a-454d-a20c-91795c47e89e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x115c3d750>]}
[0m15:07:09.031603 [info ] [Thread-7 (]: 5 of 19 OK created sql view model dbt_melissa_rm_epc.latest_rm_urn ............. [[32mSUCCESS 1[0m in 0.70s]
[0m15:07:09.031990 [debug] [Thread-7 (]: Finished running node model.rightmove_epc.latest_rm_urn
[0m15:07:09.032344 [debug] [Thread-4 (]: Began running node model.rightmove_epc.false_listings
[0m15:07:09.032562 [debug] [Thread-5 (]: Began running node model.rightmove_epc.false_listings_count
[0m15:07:09.032789 [info ] [Thread-4 (]: 9 of 19 START sql table model dbt_melissa_rm_epc.false_listings ................ [RUN]
[0m15:07:09.033029 [info ] [Thread-5 (]: 10 of 19 START sql view model dbt_melissa_rm_epc.false_listings_count .......... [RUN]
[0m15:07:09.033391 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.latest_epc_urn, now model.rightmove_epc.false_listings)
[0m15:07:09.033756 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.rightmove_epc.false_listings_count'
[0m15:07:09.033945 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.false_listings
[0m15:07:09.034124 [debug] [Thread-5 (]: Began compiling node model.rightmove_epc.false_listings_count
[0m15:07:09.035855 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.false_listings"
[0m15:07:09.037286 [debug] [Thread-5 (]: Writing injected SQL for node "model.rightmove_epc.false_listings_count"
[0m15:07:09.037760 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.false_listings (compile): 15:07:09.034239 => 15:07:09.037643
[0m15:07:09.037985 [debug] [Thread-5 (]: Timing info for model.rightmove_epc.false_listings_count (compile): 15:07:09.035998 => 15:07:09.037870
[0m15:07:09.038182 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.false_listings
[0m15:07:09.038374 [debug] [Thread-5 (]: Began executing node model.rightmove_epc.false_listings_count
[0m15:07:09.040912 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.false_listings"
[0m15:07:09.042923 [debug] [Thread-5 (]: Writing runtime sql for node "model.rightmove_epc.false_listings_count"
[0m15:07:09.043733 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.false_listings"
[0m15:07:09.044168 [debug] [Thread-5 (]: Using snowflake connection "model.rightmove_epc.false_listings_count"
[0m15:07:09.044541 [debug] [Thread-4 (]: On model.rightmove_epc.false_listings: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.false_listings"} */
create or replace transient table ANALYTICS_DEV.dbt_melissa_rm_epc.false_listings
         as
        (with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn

),

false_rm as (

    select 
    uprn,
    count(LISTING_ID) listing_count
    from rm
    group by 1
    having count(LISTING_ID) >1

),

get_false as (

    select rm.*,
    listing_count

    from rm
    inner join false_rm
    on rm.uprn = false_rm.uprn

)

select * from get_false
order by uprn
        );
[0m15:07:09.044888 [debug] [Thread-5 (]: On model.rightmove_epc.false_listings_count: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.false_listings_count"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.false_listings_count
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn

),

false_rm as (

    select 
    uprn,
    count(LISTING_ID) listing_count
    from rm
    group by 1
    having count(LISTING_ID) >1

)

select * from false_rm
  );
[0m15:07:09.045112 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m15:07:09.045332 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m15:07:09.424815 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m15:07:09.429502 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.epc_flats_count (execute): 15:07:08.924118 => 15:07:09.429200
[0m15:07:09.430215 [debug] [Thread-1 (]: On model.rightmove_epc.epc_flats_count: Close
[0m15:07:09.481610 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m15:07:09.484682 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.address_match (execute): 15:07:08.969990 => 15:07:09.484440
[0m15:07:09.485111 [debug] [Thread-2 (]: On model.rightmove_epc.address_match: Close
[0m15:07:09.516585 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fac27697-6f9a-454d-a20c-91795c47e89e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x115c3a350>]}
[0m15:07:09.517538 [info ] [Thread-1 (]: 7 of 19 OK created sql view model dbt_melissa_rm_epc.epc_flats_count ........... [[32mSUCCESS 1[0m in 0.62s]
[0m15:07:09.518306 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.epc_flats_count
[0m15:07:09.570428 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m15:07:09.573644 [debug] [Thread-5 (]: Timing info for model.rightmove_epc.false_listings_count (execute): 15:07:09.041140 => 15:07:09.573405
[0m15:07:09.574509 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fac27697-6f9a-454d-a20c-91795c47e89e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114cac510>]}
[0m15:07:09.575043 [debug] [Thread-5 (]: On model.rightmove_epc.false_listings_count: Close
[0m15:07:09.575697 [info ] [Thread-2 (]: 8 of 19 OK created sql view model dbt_melissa_rm_epc.address_match ............. [[32mSUCCESS 1[0m in 0.61s]
[0m15:07:09.577527 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.address_match
[0m15:07:09.680664 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fac27697-6f9a-454d-a20c-91795c47e89e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1158aa550>]}
[0m15:07:09.681949 [info ] [Thread-5 (]: 10 of 19 OK created sql view model dbt_melissa_rm_epc.false_listings_count ..... [[32mSUCCESS 1[0m in 0.64s]
[0m15:07:09.682850 [debug] [Thread-5 (]: Finished running node model.rightmove_epc.false_listings_count
[0m15:07:09.686573 [debug] [Thread-8 (]: Began running node model.rightmove_epc.dim_uprn
[0m15:07:09.687043 [info ] [Thread-8 (]: 11 of 19 START sql view model dbt_melissa_rm_epc.dim_uprn ...................... [RUN]
[0m15:07:09.687698 [debug] [Thread-8 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_uprn'
[0m15:07:09.687973 [debug] [Thread-8 (]: Began compiling node model.rightmove_epc.dim_uprn
[0m15:07:09.691843 [debug] [Thread-8 (]: Writing injected SQL for node "model.rightmove_epc.dim_uprn"
[0m15:07:09.693051 [debug] [Thread-8 (]: Timing info for model.rightmove_epc.dim_uprn (compile): 15:07:09.688144 => 15:07:09.692755
[0m15:07:09.693448 [debug] [Thread-8 (]: Began executing node model.rightmove_epc.dim_uprn
[0m15:07:09.696775 [debug] [Thread-8 (]: Writing runtime sql for node "model.rightmove_epc.dim_uprn"
[0m15:07:09.698697 [debug] [Thread-8 (]: Using snowflake connection "model.rightmove_epc.dim_uprn"
[0m15:07:09.699236 [debug] [Thread-8 (]: On model.rightmove_epc.dim_uprn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_uprn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE UPRNS


with epc as (

    select distinct
    epc.uprn,
    epc.addressid,
    epc.ADDRESS,
    'EPC' AS datasource,
    epc.POSTCODE,
    case when multi.uprn is null then NULL else 1 end as multi_uprn

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc
    left join ANALYTICS_DEV.dbt_melissa_rm_epc.epc_flats_count multi on epc.uprn = multi.uprn

    where epc.REMOVE_FROM_RM_MATCH = 0
    AND epc.UPRN IS NOT NULL
),

rightmove as (

 select distinct
    rm.uprn,
    rm.addressid,
    concat(rm.ADDRESS_1,',',rm.ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    rm.FULL_POSTCODE AS POSTCODE,
    case when multi.uprn is null then NULL else 1 end as multi_uprn

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove rm
    left join ANALYTICS_DEV.dbt_melissa_rm_epc.false_listings_count multi on rm.uprn = multi.uprn
    WHERE rm.UPRN IS NOT NULL


),

final as (

    select * from epc
    union all
    select * from rightmove
)

select distinct * from final
  );
[0m15:07:09.699723 [debug] [Thread-8 (]: Opening a new connection, currently in state init
[0m15:07:10.335820 [debug] [Thread-8 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m15:07:10.340406 [debug] [Thread-8 (]: Timing info for model.rightmove_epc.dim_uprn (execute): 15:07:09.693658 => 15:07:10.340116
[0m15:07:10.341017 [debug] [Thread-8 (]: On model.rightmove_epc.dim_uprn: Close
[0m15:07:10.438646 [debug] [Thread-8 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fac27697-6f9a-454d-a20c-91795c47e89e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1158dc2d0>]}
[0m15:07:10.439610 [info ] [Thread-8 (]: 11 of 19 OK created sql view model dbt_melissa_rm_epc.dim_uprn ................. [[32mSUCCESS 1[0m in 0.75s]
[0m15:07:10.440386 [debug] [Thread-8 (]: Finished running node model.rightmove_epc.dim_uprn
[0m15:07:10.441211 [debug] [Thread-6 (]: Began running node model.rightmove_epc.no_uprn_match
[0m15:07:10.441772 [debug] [Thread-1 (]: Began running node model.rightmove_epc.uprn_match
[0m15:07:10.442334 [info ] [Thread-6 (]: 12 of 19 START sql view model dbt_melissa_rm_epc.no_uprn_match ................. [RUN]
[0m15:07:10.443003 [info ] [Thread-1 (]: 13 of 19 START sql view model dbt_melissa_rm_epc.uprn_match .................... [RUN]
[0m15:07:10.443971 [debug] [Thread-6 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.dim_addressid, now model.rightmove_epc.no_uprn_match)
[0m15:07:10.444795 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.epc_flats_count, now model.rightmove_epc.uprn_match)
[0m15:07:10.445292 [debug] [Thread-6 (]: Began compiling node model.rightmove_epc.no_uprn_match
[0m15:07:10.445746 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.uprn_match
[0m15:07:10.449629 [debug] [Thread-6 (]: Writing injected SQL for node "model.rightmove_epc.no_uprn_match"
[0m15:07:10.453183 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.uprn_match"
[0m15:07:10.454182 [debug] [Thread-6 (]: Timing info for model.rightmove_epc.no_uprn_match (compile): 15:07:10.446000 => 15:07:10.453977
[0m15:07:10.454598 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.uprn_match (compile): 15:07:10.450048 => 15:07:10.454385
[0m15:07:10.454943 [debug] [Thread-6 (]: Began executing node model.rightmove_epc.no_uprn_match
[0m15:07:10.455275 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.uprn_match
[0m15:07:10.458552 [debug] [Thread-6 (]: Writing runtime sql for node "model.rightmove_epc.no_uprn_match"
[0m15:07:10.461464 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.uprn_match"
[0m15:07:10.462548 [debug] [Thread-6 (]: Using snowflake connection "model.rightmove_epc.no_uprn_match"
[0m15:07:10.462909 [debug] [Thread-6 (]: On model.rightmove_epc.no_uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.no_uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.no_uprn_match
  
   as (
    with rm_latest as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn 
    where UPRN IS NOT NULL
),

epc_uprn as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
    where datasource = 'EPC'
)


SELECT rm_latest.*,
CASE WHEN epc_uprn.UPRN is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_uprn.UPRN AS EPC_UPRN,
epc_uprn.ADDRESSID AS EPC_ADDRESSID


FROM rm_latest
LEFT JOIN epc_uprn
ON rm_latest.UPRN = epc_uprn.UPRN

WHERE MATCH_EPC = 'NO'
  );
[0m15:07:10.463260 [debug] [Thread-6 (]: Opening a new connection, currently in state closed
[0m15:07:10.464744 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.uprn_match"
[0m15:07:10.465433 [debug] [Thread-1 (]: On model.rightmove_epc.uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
  
   as (
    with rm_latest as (

    select rm.*, multi.uprn AS multi_uprn
    from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn rm
    left join ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn multi on rm.uprn = multi.uprn
    where rm.UPRN IS NOT NULL
    and multi.datasource = 'RIGHTMOVE'
   and multi.multi_uprn IS NULL 
   
),

epc_uprn as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
    where datasource = 'EPC'
    and multi_uprn is null
)


SELECT rm_latest.*,
CASE WHEN epc_uprn.UPRN is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_uprn.UPRN AS EPC_UPRN,
epc_uprn.ADDRESSID AS EPC_ADDRESSID


FROM rm_latest
LEFT JOIN epc_uprn
ON rm_latest.UPRN = epc_uprn.UPRN

WHERE MATCH_EPC = 'YES'
  );
[0m15:07:10.465939 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:07:11.256837 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m15:07:11.259478 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.uprn_match (execute): 15:07:10.458788 => 15:07:11.259277
[0m15:07:11.259862 [debug] [Thread-1 (]: On model.rightmove_epc.uprn_match: Close
[0m15:07:11.524953 [debug] [Thread-6 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m15:07:11.526529 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fac27697-6f9a-454d-a20c-91795c47e89e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114d116d0>]}
[0m15:07:11.530648 [debug] [Thread-6 (]: Timing info for model.rightmove_epc.no_uprn_match (execute): 15:07:10.455476 => 15:07:11.530341
[0m15:07:11.531509 [info ] [Thread-1 (]: 13 of 19 OK created sql view model dbt_melissa_rm_epc.uprn_match ............... [[32mSUCCESS 1[0m in 1.08s]
[0m15:07:11.532121 [debug] [Thread-6 (]: On model.rightmove_epc.no_uprn_match: Close
[0m15:07:11.532893 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.uprn_match
[0m15:07:11.535563 [debug] [Thread-5 (]: Began running node model.rightmove_epc.flats_report
[0m15:07:11.536094 [debug] [Thread-7 (]: Began running node model.rightmove_epc.houses_report
[0m15:07:11.536755 [info ] [Thread-5 (]: 14 of 19 START sql table model dbt_melissa_rm_epc.flats_report ................. [RUN]
[0m15:07:11.537272 [info ] [Thread-7 (]: 15 of 19 START sql table model dbt_melissa_rm_epc.houses_report ................ [RUN]
[0m15:07:11.538078 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.false_listings_count, now model.rightmove_epc.flats_report)
[0m15:07:11.538805 [debug] [Thread-7 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.latest_rm_urn, now model.rightmove_epc.houses_report)
[0m15:07:11.539412 [debug] [Thread-5 (]: Began compiling node model.rightmove_epc.flats_report
[0m15:07:11.540068 [debug] [Thread-7 (]: Began compiling node model.rightmove_epc.houses_report
[0m15:07:11.545406 [debug] [Thread-5 (]: Writing injected SQL for node "model.rightmove_epc.flats_report"
[0m15:07:11.551637 [debug] [Thread-7 (]: Writing injected SQL for node "model.rightmove_epc.houses_report"
[0m15:07:11.552986 [debug] [Thread-7 (]: Timing info for model.rightmove_epc.houses_report (compile): 15:07:11.545908 => 15:07:11.552737
[0m15:07:11.553377 [debug] [Thread-5 (]: Timing info for model.rightmove_epc.flats_report (compile): 15:07:11.540536 => 15:07:11.553181
[0m15:07:11.553746 [debug] [Thread-7 (]: Began executing node model.rightmove_epc.houses_report
[0m15:07:11.554130 [debug] [Thread-5 (]: Began executing node model.rightmove_epc.flats_report
[0m15:07:11.556707 [debug] [Thread-7 (]: Writing runtime sql for node "model.rightmove_epc.houses_report"
[0m15:07:11.559530 [debug] [Thread-5 (]: Writing runtime sql for node "model.rightmove_epc.flats_report"
[0m15:07:11.561825 [debug] [Thread-7 (]: Using snowflake connection "model.rightmove_epc.houses_report"
[0m15:07:11.563510 [debug] [Thread-5 (]: Using snowflake connection "model.rightmove_epc.flats_report"
[0m15:07:11.563951 [debug] [Thread-7 (]: On model.rightmove_epc.houses_report: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.houses_report"} */
create or replace transient table ANALYTICS_DEV.dbt_melissa_rm_epc.houses_report
         as
        (with house_addmatch as (

    select 
    distinct
    --count(LISTING_ID) as TOTAL_LISTINGS,
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN, -- NULL
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
 --   am.FLOOR_LEVEL as RM_FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    epc.ADDRESSID AS EPC_ADDRESSID,
    -- REMOVE_FROM_RM_MATCH,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

     from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc on am.EPC_ADDRESSID = epc.ADDRESSID
    and am.FULL_POSTCODE = epc.POSTCODE
    where MATCH_EPC = 'YES'
    and COMBINED_PROPERTY_TYPE not in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')

),

house_uprnmatch as (

    select 
    distinct
    --count(LISTING_ID) as TOTAL_LISTINGS,
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN, -- NULL
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
  --  am.FLOOR_LEVEL as RM_FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    epc.ADDRESSID AS EPC_ADDRESSID,
    -- REMOVE_FROM_RM_MATCH,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

    

    from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn epc on am.EPC_UPRN = epc.UPRN

    where MATCH_EPC = 'YES'
    and COMBINED_PROPERTY_TYPE not in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')
  -- AND RM_UPRN = 100030719363

)


select 'UPRN' as MATCH_TYPE, * from house_uprnmatch

union all

select 'ADDRESSID' as MATCH_TYPE, * from house_addmatch

/*
--THIS IS USED FOR A TEST
select RM_UPRN,COUNT(BUILDING_REFERENCE_NUMBER)
from house_uprnmatch
WHERE RM_UPRN IS NOT NULL
GROUP BY 1
HAVING COUNT(BUILDING_REFERENCE_NUMBER) >1
*/
        );
[0m15:07:11.564436 [debug] [Thread-5 (]: On model.rightmove_epc.flats_report: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.flats_report"} */
create or replace transient table ANALYTICS_DEV.dbt_melissa_rm_epc.flats_report
         as
        (with house_addmatch as (

    select 
    distinct
    --count(LISTING_ID) as TOTAL_LISTINGS,
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN, -- NULL
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
 --   am.FLOOR_LEVEL as RM_FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    epc.ADDRESSID AS EPC_ADDRESSID,
    -- REMOVE_FROM_RM_MATCH,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

     from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc on am.EPC_ADDRESSID = epc.ADDRESSID
    and am.FULL_POSTCODE = epc.POSTCODE
    where MATCH_EPC = 'YES'
    and COMBINED_PROPERTY_TYPE in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')

),

house_uprnmatch as (

    select 
    distinct
    --count(LISTING_ID) as TOTAL_LISTINGS,
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN, -- NULL
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
  --  am.FLOOR_LEVEL as RM_FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    epc.ADDRESSID AS EPC_ADDRESSID,
    -- REMOVE_FROM_RM_MATCH,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

    

    from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn epc on am.EPC_UPRN = epc.UPRN

    where MATCH_EPC = 'YES'
   and COMBINED_PROPERTY_TYPE in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')
  -- AND RM_UPRN = 100030719363

)


select 'UPRN' as MATCH_TYPE, * from house_uprnmatch

union all

select 'ADDRESSID' as MATCH_TYPE, * from house_addmatch

/*
--THIS IS USED FOR A TEST
select RM_UPRN,COUNT(BUILDING_REFERENCE_NUMBER)
from house_uprnmatch
WHERE RM_UPRN IS NOT NULL
GROUP BY 1
HAVING COUNT(BUILDING_REFERENCE_NUMBER) >1
*/
        );
[0m15:07:11.564773 [debug] [Thread-7 (]: Opening a new connection, currently in state closed
[0m15:07:11.564997 [debug] [Thread-5 (]: Opening a new connection, currently in state closed
[0m15:07:11.627774 [debug] [Thread-6 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fac27697-6f9a-454d-a20c-91795c47e89e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x115ccc550>]}
[0m15:07:11.628443 [info ] [Thread-6 (]: 12 of 19 OK created sql view model dbt_melissa_rm_epc.no_uprn_match ............ [[32mSUCCESS 1[0m in 1.18s]
[0m15:07:11.628929 [debug] [Thread-6 (]: Finished running node model.rightmove_epc.no_uprn_match
[0m15:07:11.629375 [debug] [Thread-2 (]: Began running node model.rightmove_epc.uprn_address_match
[0m15:07:11.629720 [info ] [Thread-2 (]: 16 of 19 START sql view model dbt_melissa_rm_epc.uprn_address_match ............ [RUN]
[0m15:07:11.630255 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.address_match, now model.rightmove_epc.uprn_address_match)
[0m15:07:11.630543 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.uprn_address_match
[0m15:07:11.632893 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.uprn_address_match"
[0m15:07:11.633532 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.uprn_address_match (compile): 15:07:11.630717 => 15:07:11.633379
[0m15:07:11.633796 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.uprn_address_match
[0m15:07:11.636439 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.uprn_address_match"
[0m15:07:11.637889 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.uprn_address_match"
[0m15:07:11.638285 [debug] [Thread-2 (]: On model.rightmove_epc.uprn_address_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.uprn_address_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_address_match
  
   as (
    -- where uprn is not matched we try address.

with uprn as (

    select 
    up.LISTING_ID,
    CHANGE_DATE,
    up.ADDRESSID,
    up.ADDRESS_1,
    up.ADDRESS_2,
    FULL_POSTCODE,
    up.UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    BEDROOM,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
 -- need to sleect the same fields as address match
    CASE WHEN ad.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC,
    ad.ADDRESSID AS EPC_ADDRESSID,
    ad.UPRN AS EPC_UPRN

     from ANALYTICS_DEV.dbt_melissa_rm_epc.no_uprn_match up
    left join ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid ad on up.ADDRESSID = ad.ADDRESSID
    and up.FULL_POSTCODE = ad.POSTCODE
   
)

SELECT * FROM UPRN
  );
[0m15:07:11.638607 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m15:07:12.539676 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m15:07:12.543612 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.uprn_address_match (execute): 15:07:11.633949 => 15:07:12.543325
[0m15:07:12.544159 [debug] [Thread-2 (]: On model.rightmove_epc.uprn_address_match: Close
[0m15:07:12.649410 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fac27697-6f9a-454d-a20c-91795c47e89e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x115cc5650>]}
[0m15:07:12.650257 [info ] [Thread-2 (]: 16 of 19 OK created sql view model dbt_melissa_rm_epc.uprn_address_match ....... [[32mSUCCESS 1[0m in 1.02s]
[0m15:07:12.650903 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.uprn_address_match
[0m15:07:12.651960 [debug] [Thread-8 (]: Began running node model.rightmove_epc.rm_all_matches
[0m15:07:12.652853 [debug] [Thread-6 (]: Began running node model.rightmove_epc.rm_no_matches
[0m15:07:12.653918 [info ] [Thread-8 (]: 17 of 19 START sql table model dbt_melissa_rm_epc.rm_all_matches ............... [RUN]
[0m15:07:12.654534 [info ] [Thread-6 (]: 18 of 19 START sql table model dbt_melissa_rm_epc.rm_no_matches ................ [RUN]
[0m15:07:12.655547 [debug] [Thread-8 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.dim_uprn, now model.rightmove_epc.rm_all_matches)
[0m15:07:12.657410 [debug] [Thread-8 (]: Began compiling node model.rightmove_epc.rm_all_matches
[0m15:07:12.656511 [debug] [Thread-6 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.no_uprn_match, now model.rightmove_epc.rm_no_matches)
[0m15:07:12.664602 [debug] [Thread-8 (]: Writing injected SQL for node "model.rightmove_epc.rm_all_matches"
[0m15:07:12.665314 [debug] [Thread-6 (]: Began compiling node model.rightmove_epc.rm_no_matches
[0m15:07:12.670560 [debug] [Thread-6 (]: Writing injected SQL for node "model.rightmove_epc.rm_no_matches"
[0m15:07:12.672589 [debug] [Thread-8 (]: Timing info for model.rightmove_epc.rm_all_matches (compile): 15:07:12.657774 => 15:07:12.672200
[0m15:07:12.673193 [debug] [Thread-6 (]: Timing info for model.rightmove_epc.rm_no_matches (compile): 15:07:12.665986 => 15:07:12.672900
[0m15:07:12.673701 [debug] [Thread-8 (]: Began executing node model.rightmove_epc.rm_all_matches
[0m15:07:12.674198 [debug] [Thread-6 (]: Began executing node model.rightmove_epc.rm_no_matches
[0m15:07:12.677980 [debug] [Thread-8 (]: Writing runtime sql for node "model.rightmove_epc.rm_all_matches"
[0m15:07:12.681201 [debug] [Thread-6 (]: Writing runtime sql for node "model.rightmove_epc.rm_no_matches"
[0m15:07:12.683522 [debug] [Thread-8 (]: Using snowflake connection "model.rightmove_epc.rm_all_matches"
[0m15:07:12.685196 [debug] [Thread-6 (]: Using snowflake connection "model.rightmove_epc.rm_no_matches"
[0m15:07:12.685696 [debug] [Thread-8 (]: On model.rightmove_epc.rm_all_matches: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.rm_all_matches"} */
create or replace transient table ANALYTICS_DEV.dbt_melissa_rm_epc.rm_all_matches
         as
        (with addr as (

    select 
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN,
    EPC_ADDRESSID
    
    from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
    where MATCH_EPC = 'YES' 
),

uprn_addr as (

    select 
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN,
    EPC_ADDRESSID
    
    from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_address_match
    where MATCH_EPC = 'YES' 
),

uprn as (

    select 
    
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN::VARCHAR AS EPC_UPRN,
    EPC_ADDRESSID

    from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'YES'
),

final as (

select 'ADDRESS AND POSTCODE MATCH' AS MATCH_RESULT, * from addr
union all
select 'UPRN MATCH' AS MATCH_RESULT, * from uprn
union all
select 'MATCH ADDRESS NO MATCH TO EPC UPRN' AS MATCH_RESULT, * from uprn
)

select * from final
        );
[0m15:07:12.686346 [debug] [Thread-6 (]: On model.rightmove_epc.rm_no_matches: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.rm_no_matches"} */
create or replace transient table ANALYTICS_DEV.dbt_melissa_rm_epc.rm_no_matches
         as
        (with addr as (

    select 
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    '' AS EPC_UPRN,
    EPC_ADDRESSID
    
    from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
    where MATCH_EPC = 'NO' 
),

uprn as (

    select 
    
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN::VARCHAR AS EPC_UPRN,
    EPC_ADDRESSID
    
     from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'NO'
),

uprn_address as (

        select 
    
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN::VARCHAR AS EPC_UPRN,
    EPC_ADDRESSID
    
     from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_address_match
    where MATCH_EPC = 'NO'
),

final as (

select 'NO ADDRESS MATCH' AS MATCH_RESULT, * from addr
union all
select 'NO UPRN MATCH' AS MATCH_RESULT, * from uprn
union select 'NO ADDRESS OR UPRN MATCH ' AS MATCH_RESULT, * from uprn

)

select * from final
        );
[0m15:07:12.687119 [debug] [Thread-8 (]: Opening a new connection, currently in state closed
[0m15:07:12.687490 [debug] [Thread-6 (]: Opening a new connection, currently in state closed
[0m15:07:40.425191 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 31.0 seconds
[0m15:07:40.437748 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.false_listings (execute): 15:07:09.038490 => 15:07:40.437455
[0m15:07:40.438498 [debug] [Thread-4 (]: On model.rightmove_epc.false_listings: Close
[0m15:07:40.946473 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fac27697-6f9a-454d-a20c-91795c47e89e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1158e8b90>]}
[0m15:07:40.948480 [info ] [Thread-4 (]: 9 of 19 OK created sql table model dbt_melissa_rm_epc.false_listings ........... [[32mSUCCESS 1[0m in 31.91s]
[0m15:07:40.949996 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.false_listings
[0m15:07:56.515410 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 48.0 seconds
[0m15:07:56.520696 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.epc_flats (execute): 15:07:08.907819 => 15:07:56.520376
[0m15:07:56.521379 [debug] [Thread-3 (]: On model.rightmove_epc.epc_flats: Close
[0m15:07:56.647234 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fac27697-6f9a-454d-a20c-91795c47e89e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11498f090>]}
[0m15:07:56.648674 [info ] [Thread-3 (]: 6 of 19 OK created sql table model dbt_melissa_rm_epc.epc_flats ................ [[32mSUCCESS 1[0m in 47.75s]
[0m15:07:56.649646 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.epc_flats
[0m15:08:05.338583 [debug] [Thread-6 (]: SQL status: SUCCESS 1 in 53.0 seconds
[0m15:08:05.344709 [debug] [Thread-6 (]: Timing info for model.rightmove_epc.rm_no_matches (execute): 15:07:12.678326 => 15:08:05.344222
[0m15:08:05.347566 [debug] [Thread-6 (]: On model.rightmove_epc.rm_no_matches: Close
[0m15:08:05.467900 [debug] [Thread-6 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fac27697-6f9a-454d-a20c-91795c47e89e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x115cb9ad0>]}
[0m15:08:05.469173 [info ] [Thread-6 (]: 18 of 19 OK created sql table model dbt_melissa_rm_epc.rm_no_matches ........... [[32mSUCCESS 1[0m in 52.81s]
[0m15:08:05.470239 [debug] [Thread-6 (]: Finished running node model.rightmove_epc.rm_no_matches
[0m15:09:01.439315 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 110.0 seconds
[0m15:09:01.451945 [debug] [Thread-5 (]: Timing info for model.rightmove_epc.flats_report (execute): 15:07:11.557012 => 15:09:01.451339
[0m15:09:01.452820 [debug] [Thread-5 (]: On model.rightmove_epc.flats_report: Close
[0m15:09:01.586788 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fac27697-6f9a-454d-a20c-91795c47e89e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x115caff10>]}
[0m15:09:01.596406 [info ] [Thread-5 (]: 14 of 19 OK created sql table model dbt_melissa_rm_epc.flats_report ............ [[32mSUCCESS 1[0m in 110.05s]
[0m15:09:01.597501 [debug] [Thread-5 (]: Finished running node model.rightmove_epc.flats_report
[0m15:09:34.925255 [debug] [Thread-8 (]: SQL status: SUCCESS 1 in 142.0 seconds
[0m15:09:34.932314 [debug] [Thread-8 (]: Timing info for model.rightmove_epc.rm_all_matches (execute): 15:07:12.674484 => 15:09:34.931878
[0m15:09:34.933027 [debug] [Thread-8 (]: On model.rightmove_epc.rm_all_matches: Close
[0m15:09:35.028605 [debug] [Thread-8 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fac27697-6f9a-454d-a20c-91795c47e89e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x115cb9990>]}
[0m15:09:35.030013 [info ] [Thread-8 (]: 17 of 19 OK created sql table model dbt_melissa_rm_epc.rm_all_matches .......... [[32mSUCCESS 1[0m in 142.37s]
[0m15:09:35.030857 [debug] [Thread-8 (]: Finished running node model.rightmove_epc.rm_all_matches
[0m15:09:47.416899 [debug] [Thread-7 (]: SQL status: SUCCESS 1 in 156.0 seconds
[0m15:09:47.422700 [debug] [Thread-7 (]: Timing info for model.rightmove_epc.houses_report (execute): 15:07:11.554379 => 15:09:47.422337
[0m15:09:47.423342 [debug] [Thread-7 (]: On model.rightmove_epc.houses_report: Close
[0m15:09:47.566676 [debug] [Thread-7 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fac27697-6f9a-454d-a20c-91795c47e89e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114c12790>]}
[0m15:09:47.567765 [info ] [Thread-7 (]: 15 of 19 OK created sql table model dbt_melissa_rm_epc.houses_report ........... [[32mSUCCESS 1[0m in 156.03s]
[0m15:09:47.568536 [debug] [Thread-7 (]: Finished running node model.rightmove_epc.houses_report
[0m15:09:47.570872 [debug] [Thread-2 (]: Began running node model.rightmove_epc.zero_bedrooms
[0m15:09:47.571693 [info ] [Thread-2 (]: 19 of 19 START sql table model dbt_melissa_rm_epc.zero_bedrooms ................ [RUN]
[0m15:09:47.572920 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.uprn_address_match, now model.rightmove_epc.zero_bedrooms)
[0m15:09:47.573468 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.zero_bedrooms
[0m15:09:47.580218 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.zero_bedrooms"
[0m15:09:47.581532 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.zero_bedrooms (compile): 15:09:47.573806 => 15:09:47.581251
[0m15:09:47.581973 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.zero_bedrooms
[0m15:09:47.587254 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.zero_bedrooms"
[0m15:09:47.588529 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.zero_bedrooms"
[0m15:09:47.588899 [debug] [Thread-2 (]: On model.rightmove_epc.zero_bedrooms: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.zero_bedrooms"} */
create or replace transient table ANALYTICS_DEV.dbt_melissa_rm_epc.zero_bedrooms
         as
        (with houses as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.houses_report
    where BEDROOM = 0
),

flats as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.flats_report
        where BEDROOM = 0

)

select * from flats
union all
select * from houses
        );
[0m15:09:47.589260 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m15:09:49.977760 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m15:09:49.985118 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.zero_bedrooms (execute): 15:09:47.582214 => 15:09:49.984680
[0m15:09:49.986046 [debug] [Thread-2 (]: On model.rightmove_epc.zero_bedrooms: Close
[0m15:09:50.070461 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fac27697-6f9a-454d-a20c-91795c47e89e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114c63450>]}
[0m15:09:50.071872 [info ] [Thread-2 (]: 19 of 19 OK created sql table model dbt_melissa_rm_epc.zero_bedrooms ........... [[32mSUCCESS 1[0m in 2.50s]
[0m15:09:50.072906 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.zero_bedrooms
[0m15:09:50.076488 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:09:50.077001 [debug] [MainThread]: Connection 'model.rightmove_epc.uprn_match' was properly closed.
[0m15:09:50.077398 [debug] [MainThread]: Connection 'model.rightmove_epc.zero_bedrooms' was properly closed.
[0m15:09:50.077776 [debug] [MainThread]: Connection 'model.rightmove_epc.false_listings' was properly closed.
[0m15:09:50.078145 [debug] [MainThread]: Connection 'model.rightmove_epc.rm_no_matches' was properly closed.
[0m15:09:50.078505 [debug] [MainThread]: Connection 'model.rightmove_epc.houses_report' was properly closed.
[0m15:09:50.078944 [debug] [MainThread]: Connection 'model.rightmove_epc.epc_flats' was properly closed.
[0m15:09:50.079658 [debug] [MainThread]: Connection 'model.rightmove_epc.flats_report' was properly closed.
[0m15:09:50.080087 [debug] [MainThread]: Connection 'model.rightmove_epc.rm_all_matches' was properly closed.
[0m15:09:50.080904 [info ] [MainThread]: 
[0m15:09:50.081400 [info ] [MainThread]: Finished running 12 view models, 7 table models in 0 hours 2 minutes and 43.57 seconds (163.57s).
[0m15:09:50.084790 [debug] [MainThread]: Command end result
[0m15:09:50.098562 [info ] [MainThread]: 
[0m15:09:50.099013 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:09:50.099366 [info ] [MainThread]: 
[0m15:09:50.099711 [info ] [MainThread]: Done. PASS=19 WARN=0 ERROR=0 SKIP=0 TOTAL=19
[0m15:09:50.103855 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 163.93907, "process_user_time": 2.292711, "process_kernel_time": 0.31908, "process_mem_max_rss": "137510912", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m15:09:50.104710 [debug] [MainThread]: Command `dbt run` succeeded at 15:09:50.104574 after 163.94 seconds
[0m15:09:50.105155 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11249acd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11249a350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1055e5d90>]}
[0m15:09:50.105521 [debug] [MainThread]: Flushing usage events
[0m15:34:05.950131 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11cf18690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11cf61c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11cf63250>]}


============================== 15:34:05.953848 | 1c7e7893-a9a7-4ece-8be5-3f47bf98b032 ==============================
[0m15:34:05.953848 [info ] [MainThread]: Running with dbt=1.7.10
[0m15:34:05.954264 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt run --select models/staging', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m15:34:06.179132 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1c7e7893-a9a7-4ece-8be5-3f47bf98b032', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11d8f7d10>]}
[0m15:34:06.223683 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1c7e7893-a9a7-4ece-8be5-3f47bf98b032', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11dcb3b10>]}
[0m15:34:06.224506 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m15:34:06.235988 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m15:34:06.264821 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:34:06.265119 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:34:06.269007 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1c7e7893-a9a7-4ece-8be5-3f47bf98b032', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11dc40b10>]}
[0m15:34:06.278413 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1c7e7893-a9a7-4ece-8be5-3f47bf98b032', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11dcfed50>]}
[0m15:34:06.278787 [info ] [MainThread]: Found 19 models, 1 analysis, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m15:34:06.279076 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1c7e7893-a9a7-4ece-8be5-3f47bf98b032', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11dd24e50>]}
[0m15:34:06.280701 [info ] [MainThread]: 
[0m15:34:06.281257 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m15:34:06.282252 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m15:34:06.295736 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m15:34:06.296134 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m15:34:06.296326 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:34:06.778660 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 0.0 seconds
[0m15:34:06.781196 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m15:34:06.866089 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m15:34:06.872393 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m15:34:06.872764 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m15:34:06.873057 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:34:07.335260 [debug] [ThreadPool]: SQL status: SUCCESS 19 in 0.0 seconds
[0m15:34:07.337391 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m15:34:07.413758 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1c7e7893-a9a7-4ece-8be5-3f47bf98b032', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11ddc8c10>]}
[0m15:34:07.414440 [info ] [MainThread]: Concurrency: 8 threads (target='dev')
[0m15:34:07.414685 [info ] [MainThread]: 
[0m15:34:07.417191 [debug] [Thread-1 (]: Began running node model.rightmove_epc.stg_epc_certs
[0m15:34:07.417478 [debug] [Thread-2 (]: Began running node model.rightmove_epc.stg_rightmove
[0m15:34:07.417840 [info ] [Thread-1 (]: 1 of 2 START sql view model dbt_melissa_rm_epc.stg_epc_certs ................... [RUN]
[0m15:34:07.418206 [info ] [Thread-2 (]: 2 of 2 START sql view model dbt_melissa_rm_epc.stg_rightmove ................... [RUN]
[0m15:34:07.418761 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.stg_epc_certs)
[0m15:34:07.420561 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.stg_rightmove'
[0m15:34:07.420797 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.stg_epc_certs
[0m15:34:07.421109 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.stg_rightmove
[0m15:34:07.461306 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.stg_epc_certs"
[0m15:34:07.463201 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.stg_rightmove"
[0m15:34:07.464768 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (compile): 15:34:07.461575 => 15:34:07.464541
[0m15:34:07.465142 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (compile): 15:34:07.421335 => 15:34:07.464916
[0m15:34:07.465410 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.stg_rightmove
[0m15:34:07.465617 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.stg_epc_certs
[0m15:34:07.482362 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.stg_rightmove"
[0m15:34:07.484478 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.stg_epc_certs"
[0m15:34:07.485639 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.stg_rightmove"
[0m15:34:07.486388 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.stg_epc_certs"
[0m15:34:07.486713 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_rightmove"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
  
   as (
    with rm as (

    SELECT 
    LISTING_ID,
    CHANGE_DATE,
    UPPER(TRIM(replace(REPLACE(CONCAT(ADDRESS_1::VARCHAR,ADDRESS_2::VARCHAR),' '),','))) AS ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, 
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    BEDROOM,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
 --   STUDENTLET_FLAG,
    COMBINED_PROPERTY_TYPE,
    BRANCH_ID,
	 BRANCH_NAME,
    WEBSITE_URL,
	 COMPANY_NAME
    -- property type
    FROM 
       ANALYTICS.RIGHTMOVE_PROD.CLEAN_RAW_RIGHTMOVE_DATA 

 
)

SELECT * FROM rm
  );
[0m15:34:07.487029 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_epc_certs"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
  
   as (
    WITH epc_certs as (
    
    select 
    UPRN,
    LODGEMENT_DATE,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
   -- COUNTY,
    LOCAL_AUTHORITY as LOCAL_AUTHORITY_CODE,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    UPPER(CASE WHEN (UPPER(ADDRESS1) LIKE 'FLAT%' OR UPPER(ADDRESS1) LIKE 'UNIT%') or UPPER(ADDRESS1) LIKE 'ROOM%' 
    THEN TRIM(REPLACE(REPLACE(CONCAT(ADDRESS),','),' '))
    ELSE trim(replace(replace(ADDRESS1,' '),',')) END) AS ADDRESSID,
    CASE WHEN UPRN is null and addressid is null THEN 1 else 0 end as REMOVE_FROM_RM_MATCH,
    FLOOR_LEVEL,
    FLAT_TOP_STOREY,
    FLAT_STOREY_COUNT,
    PROPERTY_TYPE
 from  RAW.EPC_TEST_DATA.EPC_CERTIFICATES 

)

SELECT * FROM epc_certs
  );
[0m15:34:07.487306 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m15:34:07.487515 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:34:07.926280 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m15:34:07.937758 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m15:34:07.942674 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (execute): 15:34:07.465781 => 15:34:07.942509
[0m15:34:07.944513 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (execute): 15:34:07.482603 => 15:34:07.944378
[0m15:34:07.944801 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: Close
[0m15:34:07.945182 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: Close
[0m15:34:08.025145 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1c7e7893-a9a7-4ece-8be5-3f47bf98b032', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11dff0190>]}
[0m15:34:08.025683 [info ] [Thread-1 (]: 1 of 2 OK created sql view model dbt_melissa_rm_epc.stg_epc_certs .............. [[32mSUCCESS 1[0m in 0.61s]
[0m15:34:08.026057 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.stg_epc_certs
[0m15:34:08.029962 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1c7e7893-a9a7-4ece-8be5-3f47bf98b032', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11dcc6b10>]}
[0m15:34:08.030480 [info ] [Thread-2 (]: 2 of 2 OK created sql view model dbt_melissa_rm_epc.stg_rightmove .............. [[32mSUCCESS 1[0m in 0.61s]
[0m15:34:08.030886 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.stg_rightmove
[0m15:34:08.032153 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:34:08.032336 [debug] [MainThread]: Connection 'model.rightmove_epc.stg_epc_certs' was properly closed.
[0m15:34:08.032483 [debug] [MainThread]: Connection 'model.rightmove_epc.stg_rightmove' was properly closed.
[0m15:34:08.032664 [info ] [MainThread]: 
[0m15:34:08.032855 [info ] [MainThread]: Finished running 2 view models in 0 hours 0 minutes and 1.75 seconds (1.75s).
[0m15:34:08.033362 [debug] [MainThread]: Command end result
[0m15:34:08.039585 [info ] [MainThread]: 
[0m15:34:08.039943 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:34:08.040126 [info ] [MainThread]: 
[0m15:34:08.040313 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m15:34:08.042376 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 2.1275287, "process_user_time": 1.442902, "process_kernel_time": 0.210897, "process_mem_max_rss": "136445952", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m15:34:08.042803 [debug] [MainThread]: Command `dbt run` succeeded at 15:34:08.042726 after 2.13 seconds
[0m15:34:08.043041 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11c854190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11cf62c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104886210>]}
[0m15:34:08.043262 [debug] [MainThread]: Flushing usage events
[0m15:34:36.618803 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12ab55090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12ab9a810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12ab9b350>]}


============================== 15:34:36.622390 | 1239e749-85e1-4f5a-8050-2937b19a771a ==============================
[0m15:34:36.622390 [info ] [MainThread]: Running with dbt=1.7.10
[0m15:34:36.622903 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'profiles_dir': '/Users/melissabee/.dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt run --select models/bridge', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m15:34:36.833965 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1239e749-85e1-4f5a-8050-2937b19a771a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12ab8f490>]}
[0m15:34:36.876584 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1239e749-85e1-4f5a-8050-2937b19a771a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12bfbc190>]}
[0m15:34:36.877387 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m15:34:36.889966 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m15:34:36.919756 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:34:36.920092 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:34:36.924240 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1239e749-85e1-4f5a-8050-2937b19a771a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12c99d810>]}
[0m15:34:36.932917 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1239e749-85e1-4f5a-8050-2937b19a771a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12c953590>]}
[0m15:34:36.933300 [info ] [MainThread]: Found 19 models, 1 analysis, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m15:34:36.933526 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1239e749-85e1-4f5a-8050-2937b19a771a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12c9b0910>]}
[0m15:34:36.935017 [info ] [MainThread]: 
[0m15:34:36.935584 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m15:34:36.936436 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m15:34:36.944487 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m15:34:36.944809 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m15:34:36.944998 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:34:37.374048 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 0.0 seconds
[0m15:34:37.375996 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m15:34:37.461743 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m15:34:37.468225 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m15:34:37.468565 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m15:34:37.468793 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:34:37.780135 [debug] [ThreadPool]: SQL status: SUCCESS 19 in 0.0 seconds
[0m15:34:37.781487 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m15:34:37.870602 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1239e749-85e1-4f5a-8050-2937b19a771a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12c9caed0>]}
[0m15:34:37.871216 [info ] [MainThread]: Concurrency: 8 threads (target='dev')
[0m15:34:37.871527 [info ] [MainThread]: 
[0m15:34:37.874252 [debug] [Thread-1 (]: Began running node model.rightmove_epc.dim_addressid
[0m15:34:37.874515 [debug] [Thread-2 (]: Began running node model.rightmove_epc.latest_epc_urn
[0m15:34:37.874817 [debug] [Thread-3 (]: Began running node model.rightmove_epc.latest_rm_urn
[0m15:34:37.875151 [info ] [Thread-1 (]: 1 of 6 START sql view model dbt_melissa_rm_epc.dim_addressid ................... [RUN]
[0m15:34:37.875454 [info ] [Thread-2 (]: 2 of 6 START sql view model dbt_melissa_rm_epc.latest_epc_urn .................. [RUN]
[0m15:34:37.875698 [info ] [Thread-3 (]: 3 of 6 START sql view model dbt_melissa_rm_epc.latest_rm_urn ................... [RUN]
[0m15:34:37.877554 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.dim_addressid)
[0m15:34:37.878078 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.latest_epc_urn'
[0m15:34:37.878485 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.rightmove_epc.latest_rm_urn'
[0m15:34:37.878703 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.dim_addressid
[0m15:34:37.878897 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.latest_epc_urn
[0m15:34:37.879081 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.latest_rm_urn
[0m15:34:37.920749 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.dim_addressid"
[0m15:34:37.922726 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.latest_epc_urn"
[0m15:34:37.924281 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.latest_rm_urn"
[0m15:34:37.924994 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.dim_addressid (compile): 15:34:37.879308 => 15:34:37.924841
[0m15:34:37.925243 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.dim_addressid
[0m15:34:37.925481 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.latest_rm_urn (compile): 15:34:37.922936 => 15:34:37.925361
[0m15:34:37.925709 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.latest_epc_urn (compile): 15:34:37.921021 => 15:34:37.925604
[0m15:34:37.942206 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.dim_addressid"
[0m15:34:37.942565 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.latest_rm_urn
[0m15:34:37.942798 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.latest_epc_urn
[0m15:34:37.945206 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.latest_rm_urn"
[0m15:34:37.947284 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.latest_epc_urn"
[0m15:34:37.948174 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.dim_addressid"
[0m15:34:37.948575 [debug] [Thread-1 (]: On model.rightmove_epc.dim_addressid: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_addressid"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE ADDRESS'

with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource,
    POSTCODE
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs 
    where REMOVE_FROM_RM_MATCH = 0
    AND ADDRESSID IS NOT NULL

),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    WHERE ADDRESSID IS NOT NULL

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where addressid is not null
  );
[0m15:34:37.948854 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:34:37.950417 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.latest_epc_urn"
[0m15:34:37.951029 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.latest_rm_urn"
[0m15:34:37.951320 [debug] [Thread-2 (]: On model.rightmove_epc.latest_epc_urn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.latest_epc_urn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn
  
   as (
    with epc_max_date as (

    select uprn as UPRN_EPC,
    MAX(LODGEMENT_DATE) AS MAX_LODGEMENT_DATE,
    from  ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    group by 1


),

latest_epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc
    inner join epc_max_date on epc.uprn = epc_max_date.UPRN_EPC
    where MAX_LODGEMENT_DATE = LODGEMENT_DATE
   -- and uprn = 200073066

)

select DISTINCT * from latest_epc


/*
select uprn, count(*) from latest_epc
group by 1
having count(*) >1
*/
  );
[0m15:34:37.951592 [debug] [Thread-3 (]: On model.rightmove_epc.latest_rm_urn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.latest_rm_urn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NOT NULL
),

change_date AS (
    SELECT 
        UPRN AS UPRN_CD, 
        MAX(CHANGE_DATE) AS MAX_CHANGE_DATE 
    FROM rm
    GROUP BY UPRN
),

rm_latest as (

    SELECT distinct * FROM rm
    LEFT JOIN change_date cd
    ON rm.UPRN = cd.UPRN_CD
    WHERE cd.MAX_CHANGE_DATE = rm.CHANGE_DATE 
 --  and UPRN = 100090588560
    
)

select DISTINCT * from rm_latest

/*
select uprn, count(*) from rm_latest
group by 1
having count(*) >1
*/
  );
[0m15:34:37.951834 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m15:34:37.952032 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m15:34:38.488027 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m15:34:38.504757 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.latest_epc_urn (execute): 15:34:37.945441 => 15:34:38.504494
[0m15:34:38.505193 [debug] [Thread-2 (]: On model.rightmove_epc.latest_epc_urn: Close
[0m15:34:38.562635 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m15:34:38.564383 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.latest_rm_urn (execute): 15:34:37.942997 => 15:34:38.564257
[0m15:34:38.564608 [debug] [Thread-3 (]: On model.rightmove_epc.latest_rm_urn: Close
[0m15:34:38.583059 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m15:34:38.584747 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.dim_addressid (execute): 15:34:37.925818 => 15:34:38.584593
[0m15:34:38.585432 [debug] [Thread-1 (]: On model.rightmove_epc.dim_addressid: Close
[0m15:34:38.587549 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1239e749-85e1-4f5a-8050-2937b19a771a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12cc75e10>]}
[0m15:34:38.588026 [info ] [Thread-2 (]: 2 of 6 OK created sql view model dbt_melissa_rm_epc.latest_epc_urn ............. [[32mSUCCESS 1[0m in 0.71s]
[0m15:34:38.588370 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.latest_epc_urn
[0m15:34:38.588936 [debug] [Thread-5 (]: Began running node model.rightmove_epc.epc_flats_count
[0m15:34:38.589337 [info ] [Thread-5 (]: 4 of 6 START sql view model dbt_melissa_rm_epc.epc_flats_count ................. [RUN]
[0m15:34:38.589948 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.rightmove_epc.epc_flats_count'
[0m15:34:38.590195 [debug] [Thread-5 (]: Began compiling node model.rightmove_epc.epc_flats_count
[0m15:34:38.592115 [debug] [Thread-5 (]: Writing injected SQL for node "model.rightmove_epc.epc_flats_count"
[0m15:34:38.592893 [debug] [Thread-5 (]: Timing info for model.rightmove_epc.epc_flats_count (compile): 15:34:38.590355 => 15:34:38.592697
[0m15:34:38.593165 [debug] [Thread-5 (]: Began executing node model.rightmove_epc.epc_flats_count
[0m15:34:38.595303 [debug] [Thread-5 (]: Writing runtime sql for node "model.rightmove_epc.epc_flats_count"
[0m15:34:38.596674 [debug] [Thread-5 (]: Using snowflake connection "model.rightmove_epc.epc_flats_count"
[0m15:34:38.596931 [debug] [Thread-5 (]: On model.rightmove_epc.epc_flats_count: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.epc_flats_count"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.epc_flats_count
  
   as (
    with epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn

),

flat_epc as (

    select uprn,
    count(BUILDING_REFERENCE_NUMBER) as building_ref_count
    from epc
    group by 1
    having count(BUILDING_REFERENCE_NUMBER) >1

)

select * from flat_epc
  );
[0m15:34:38.597144 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m15:34:38.644563 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1239e749-85e1-4f5a-8050-2937b19a771a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12ccc0890>]}
[0m15:34:38.645070 [info ] [Thread-3 (]: 3 of 6 OK created sql view model dbt_melissa_rm_epc.latest_rm_urn .............. [[32mSUCCESS 1[0m in 0.77s]
[0m15:34:38.645402 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.latest_rm_urn
[0m15:34:38.645835 [debug] [Thread-7 (]: Began running node model.rightmove_epc.false_listings_count
[0m15:34:38.646203 [info ] [Thread-7 (]: 5 of 6 START sql view model dbt_melissa_rm_epc.false_listings_count ............ [RUN]
[0m15:34:38.646787 [debug] [Thread-7 (]: Acquiring new snowflake connection 'model.rightmove_epc.false_listings_count'
[0m15:34:38.647114 [debug] [Thread-7 (]: Began compiling node model.rightmove_epc.false_listings_count
[0m15:34:38.650195 [debug] [Thread-7 (]: Writing injected SQL for node "model.rightmove_epc.false_listings_count"
[0m15:34:38.650820 [debug] [Thread-7 (]: Timing info for model.rightmove_epc.false_listings_count (compile): 15:34:38.647285 => 15:34:38.650678
[0m15:34:38.651029 [debug] [Thread-7 (]: Began executing node model.rightmove_epc.false_listings_count
[0m15:34:38.653006 [debug] [Thread-7 (]: Writing runtime sql for node "model.rightmove_epc.false_listings_count"
[0m15:34:38.653740 [debug] [Thread-7 (]: Using snowflake connection "model.rightmove_epc.false_listings_count"
[0m15:34:38.653975 [debug] [Thread-7 (]: On model.rightmove_epc.false_listings_count: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.false_listings_count"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.false_listings_count
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn

),

false_rm as (

    select 
    uprn,
    count(LISTING_ID) listing_count
    from rm
    group by 1
    having count(LISTING_ID) >1

)

select * from false_rm
  );
[0m15:34:38.654181 [debug] [Thread-7 (]: Opening a new connection, currently in state init
[0m15:34:38.681546 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1239e749-85e1-4f5a-8050-2937b19a771a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12cc0d990>]}
[0m15:34:38.681987 [info ] [Thread-1 (]: 1 of 6 OK created sql view model dbt_melissa_rm_epc.dim_addressid .............. [[32mSUCCESS 1[0m in 0.81s]
[0m15:34:38.682297 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.dim_addressid
[0m15:34:39.103279 [debug] [Thread-7 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m15:34:39.109171 [debug] [Thread-7 (]: Timing info for model.rightmove_epc.false_listings_count (execute): 15:34:38.651145 => 15:34:39.109017
[0m15:34:39.109532 [debug] [Thread-7 (]: On model.rightmove_epc.false_listings_count: Close
[0m15:34:39.147097 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m15:34:39.149525 [debug] [Thread-5 (]: Timing info for model.rightmove_epc.epc_flats_count (execute): 15:34:38.593307 => 15:34:39.149384
[0m15:34:39.149863 [debug] [Thread-5 (]: On model.rightmove_epc.epc_flats_count: Close
[0m15:34:39.240366 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1239e749-85e1-4f5a-8050-2937b19a771a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12c906910>]}
[0m15:34:39.240947 [debug] [Thread-7 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1239e749-85e1-4f5a-8050-2937b19a771a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12cd668d0>]}
[0m15:34:39.241461 [info ] [Thread-5 (]: 4 of 6 OK created sql view model dbt_melissa_rm_epc.epc_flats_count ............ [[32mSUCCESS 1[0m in 0.65s]
[0m15:34:39.241826 [info ] [Thread-7 (]: 5 of 6 OK created sql view model dbt_melissa_rm_epc.false_listings_count ....... [[32mSUCCESS 1[0m in 0.59s]
[0m15:34:39.242296 [debug] [Thread-5 (]: Finished running node model.rightmove_epc.epc_flats_count
[0m15:34:39.242605 [debug] [Thread-7 (]: Finished running node model.rightmove_epc.false_listings_count
[0m15:34:39.243280 [debug] [Thread-4 (]: Began running node model.rightmove_epc.dim_uprn
[0m15:34:39.243709 [info ] [Thread-4 (]: 6 of 6 START sql view model dbt_melissa_rm_epc.dim_uprn ........................ [RUN]
[0m15:34:39.244172 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_uprn'
[0m15:34:39.244377 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.dim_uprn
[0m15:34:39.246807 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.dim_uprn"
[0m15:34:39.247360 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_uprn (compile): 15:34:39.244506 => 15:34:39.247240
[0m15:34:39.247566 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.dim_uprn
[0m15:34:39.249640 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.dim_uprn"
[0m15:34:39.250789 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.dim_uprn"
[0m15:34:39.251057 [debug] [Thread-4 (]: On model.rightmove_epc.dim_uprn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_uprn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE UPRNS


with epc as (

    select distinct
    epc.uprn,
    epc.addressid,
    epc.ADDRESS,
    'EPC' AS datasource,
    epc.POSTCODE,
    case when multi.uprn is null then NULL else 1 end as multi_uprn

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc
    left join ANALYTICS_DEV.dbt_melissa_rm_epc.epc_flats_count multi on epc.uprn = multi.uprn

    where epc.REMOVE_FROM_RM_MATCH = 0
    AND epc.UPRN IS NOT NULL
),

rightmove as (

 select distinct
    rm.uprn,
    rm.addressid,
    concat(rm.ADDRESS_1,',',rm.ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    rm.FULL_POSTCODE AS POSTCODE,
    case when multi.uprn is null then NULL else 1 end as multi_uprn

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove rm
    left join ANALYTICS_DEV.dbt_melissa_rm_epc.false_listings_count multi on rm.uprn = multi.uprn
    WHERE rm.UPRN IS NOT NULL


),

final as (

    select * from epc
    union all
    select * from rightmove
)

select distinct * from final
  );
[0m15:34:39.251292 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m15:34:40.040099 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m15:34:40.045466 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_uprn (execute): 15:34:39.247686 => 15:34:40.045336
[0m15:34:40.045713 [debug] [Thread-4 (]: On model.rightmove_epc.dim_uprn: Close
[0m15:34:40.430686 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1239e749-85e1-4f5a-8050-2937b19a771a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12ca5c4d0>]}
[0m15:34:40.431153 [info ] [Thread-4 (]: 6 of 6 OK created sql view model dbt_melissa_rm_epc.dim_uprn ................... [[32mSUCCESS 1[0m in 1.19s]
[0m15:34:40.431464 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.dim_uprn
[0m15:34:40.432810 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:34:40.433095 [debug] [MainThread]: Connection 'model.rightmove_epc.dim_addressid' was properly closed.
[0m15:34:40.433260 [debug] [MainThread]: Connection 'model.rightmove_epc.latest_epc_urn' was properly closed.
[0m15:34:40.433431 [debug] [MainThread]: Connection 'model.rightmove_epc.latest_rm_urn' was properly closed.
[0m15:34:40.433592 [debug] [MainThread]: Connection 'model.rightmove_epc.epc_flats_count' was properly closed.
[0m15:34:40.433730 [debug] [MainThread]: Connection 'model.rightmove_epc.false_listings_count' was properly closed.
[0m15:34:40.433868 [debug] [MainThread]: Connection 'model.rightmove_epc.dim_uprn' was properly closed.
[0m15:34:40.434150 [info ] [MainThread]: 
[0m15:34:40.434403 [info ] [MainThread]: Finished running 6 view models in 0 hours 0 minutes and 3.50 seconds (3.50s).
[0m15:34:40.435158 [debug] [MainThread]: Command end result
[0m15:34:40.440627 [info ] [MainThread]: 
[0m15:34:40.440904 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:34:40.441082 [info ] [MainThread]: 
[0m15:34:40.441273 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=0 SKIP=0 TOTAL=6
[0m15:34:40.442972 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.857806, "process_user_time": 1.61027, "process_kernel_time": 0.215002, "process_mem_max_rss": "137068544", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m15:34:40.443370 [debug] [MainThread]: Command `dbt run` succeeded at 15:34:40.443291 after 3.86 seconds
[0m15:34:40.443609 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1054f60d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1053a2210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x12804d950>]}
[0m15:34:40.443831 [debug] [MainThread]: Flushing usage events
[0m15:59:30.170808 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106aa4850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106aea4d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106aeb1d0>]}


============================== 15:59:30.173571 | f055b113-40f2-40b6-94d3-b65734554dec ==============================
[0m15:59:30.173571 [info ] [MainThread]: Running with dbt=1.7.10
[0m15:59:30.173907 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select models/bridge', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m15:59:30.350412 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f055b113-40f2-40b6-94d3-b65734554dec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106eb2b50>]}
[0m15:59:30.383625 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f055b113-40f2-40b6-94d3-b65734554dec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106b355d0>]}
[0m15:59:30.384268 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m15:59:30.393754 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m15:59:30.411913 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m15:59:30.412180 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m15:59:30.415545 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f055b113-40f2-40b6-94d3-b65734554dec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1072bea90>]}
[0m15:59:30.423318 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f055b113-40f2-40b6-94d3-b65734554dec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1075418d0>]}
[0m15:59:30.423563 [info ] [MainThread]: Found 19 models, 1 analysis, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m15:59:30.423751 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f055b113-40f2-40b6-94d3-b65734554dec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107717f50>]}
[0m15:59:30.424877 [info ] [MainThread]: 
[0m15:59:30.425259 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m15:59:30.425875 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m15:59:30.432508 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m15:59:30.432780 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m15:59:30.432942 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m15:59:31.057977 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 1.0 seconds
[0m15:59:31.060356 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m15:59:31.149122 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m15:59:31.156064 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m15:59:31.156400 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m15:59:31.156668 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m15:59:31.517863 [debug] [ThreadPool]: SQL status: SUCCESS 19 in 0.0 seconds
[0m15:59:31.519298 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m15:59:31.603287 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f055b113-40f2-40b6-94d3-b65734554dec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10745ee50>]}
[0m15:59:31.603855 [info ] [MainThread]: Concurrency: 8 threads (target='dev')
[0m15:59:31.604069 [info ] [MainThread]: 
[0m15:59:31.606723 [debug] [Thread-1 (]: Began running node model.rightmove_epc.dim_addressid
[0m15:59:31.606967 [debug] [Thread-2 (]: Began running node model.rightmove_epc.latest_epc_urn
[0m15:59:31.607260 [info ] [Thread-1 (]: 1 of 6 START sql view model dbt_melissa_rm_epc.dim_addressid ................... [RUN]
[0m15:59:31.607503 [debug] [Thread-3 (]: Began running node model.rightmove_epc.latest_rm_urn
[0m15:59:31.607740 [info ] [Thread-2 (]: 2 of 6 START sql view model dbt_melissa_rm_epc.latest_epc_urn .................. [RUN]
[0m15:59:31.609327 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.dim_addressid)
[0m15:59:31.609610 [info ] [Thread-3 (]: 3 of 6 START sql view model dbt_melissa_rm_epc.latest_rm_urn ................... [RUN]
[0m15:59:31.610120 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.latest_epc_urn'
[0m15:59:31.610386 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.dim_addressid
[0m15:59:31.610796 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.rightmove_epc.latest_rm_urn'
[0m15:59:31.611038 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.latest_epc_urn
[0m15:59:31.649935 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.dim_addressid"
[0m15:59:31.650210 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.latest_rm_urn
[0m15:59:31.651573 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.latest_epc_urn"
[0m15:59:31.652905 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.latest_rm_urn"
[0m15:59:31.653289 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.dim_addressid (compile): 15:59:31.611198 => 15:59:31.653180
[0m15:59:31.653466 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.dim_addressid
[0m15:59:31.665907 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.dim_addressid"
[0m15:59:31.666269 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.latest_epc_urn (compile): 15:59:31.650324 => 15:59:31.666157
[0m15:59:31.666450 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.latest_epc_urn
[0m15:59:31.667931 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.latest_epc_urn"
[0m15:59:31.668190 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.latest_rm_urn (compile): 15:59:31.651761 => 15:59:31.668085
[0m15:59:31.668360 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.latest_rm_urn
[0m15:59:31.669839 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.latest_rm_urn"
[0m15:59:31.670438 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.latest_epc_urn"
[0m15:59:31.671025 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.dim_addressid"
[0m15:59:31.671215 [debug] [Thread-2 (]: On model.rightmove_epc.latest_epc_urn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.latest_epc_urn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn
  
   as (
    with epc_max_date as (

    select uprn as UPRN_EPC,
    MAX(LODGEMENT_DATE) AS MAX_LODGEMENT_DATE,
    from  ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    group by 1


),

latest_epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc
    inner join epc_max_date on epc.uprn = epc_max_date.UPRN_EPC
    where MAX_LODGEMENT_DATE = LODGEMENT_DATE
   -- and uprn = 200073066

)

select DISTINCT * from latest_epc


/*
select uprn, count(*) from latest_epc
group by 1
having count(*) >1
*/
  );
[0m15:59:31.671661 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.latest_rm_urn"
[0m15:59:31.671861 [debug] [Thread-1 (]: On model.rightmove_epc.dim_addressid: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_addressid"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE ADDRESS'

with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource,
    POSTCODE
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs 
    where REMOVE_FROM_RM_MATCH = 0
    AND ADDRESSID IS NOT NULL

),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    WHERE ADDRESSID IS NOT NULL

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where addressid is not null
  );
[0m15:59:31.672062 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m15:59:31.672242 [debug] [Thread-3 (]: On model.rightmove_epc.latest_rm_urn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.latest_rm_urn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NOT NULL
),

change_date AS (
    SELECT 
        UPRN AS UPRN_CD, 
        MAX(CHANGE_DATE) AS MAX_CHANGE_DATE 
    FROM rm
    GROUP BY UPRN
),

rm_latest as (

    SELECT distinct * FROM rm
    LEFT JOIN change_date cd
    ON rm.UPRN = cd.UPRN_CD
    WHERE cd.MAX_CHANGE_DATE = rm.CHANGE_DATE 
 --  and UPRN = 100090588560
    
)

select DISTINCT * from rm_latest

/*
select uprn, count(*) from rm_latest
group by 1
having count(*) >1
*/
  );
[0m15:59:31.672414 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m15:59:31.672897 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m15:59:32.228396 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m15:59:32.242856 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.dim_addressid (execute): 15:59:31.653563 => 15:59:32.242704
[0m15:59:32.243572 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m15:59:32.243882 [debug] [Thread-1 (]: On model.rightmove_epc.dim_addressid: Close
[0m15:59:32.245531 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.latest_epc_urn (execute): 15:59:31.666557 => 15:59:32.245412
[0m15:59:32.246308 [debug] [Thread-2 (]: On model.rightmove_epc.latest_epc_urn: Close
[0m15:59:32.319270 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f055b113-40f2-40b6-94d3-b65734554dec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107683c10>]}
[0m15:59:32.319823 [info ] [Thread-2 (]: 2 of 6 OK created sql view model dbt_melissa_rm_epc.latest_epc_urn ............. [[32mSUCCESS 1[0m in 0.71s]
[0m15:59:32.320207 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.latest_epc_urn
[0m15:59:32.320615 [debug] [Thread-5 (]: Began running node model.rightmove_epc.epc_flats_count
[0m15:59:32.320893 [info ] [Thread-5 (]: 4 of 6 START sql view model dbt_melissa_rm_epc.epc_flats_count ................. [RUN]
[0m15:59:32.321366 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.rightmove_epc.epc_flats_count'
[0m15:59:32.321584 [debug] [Thread-5 (]: Began compiling node model.rightmove_epc.epc_flats_count
[0m15:59:32.323764 [debug] [Thread-5 (]: Writing injected SQL for node "model.rightmove_epc.epc_flats_count"
[0m15:59:32.324512 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m15:59:32.326331 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.latest_rm_urn (execute): 15:59:31.668474 => 15:59:32.326183
[0m15:59:32.326601 [debug] [Thread-3 (]: On model.rightmove_epc.latest_rm_urn: Close
[0m15:59:32.327470 [debug] [Thread-5 (]: Timing info for model.rightmove_epc.epc_flats_count (compile): 15:59:32.321725 => 15:59:32.327323
[0m15:59:32.327993 [debug] [Thread-5 (]: Began executing node model.rightmove_epc.epc_flats_count
[0m15:59:32.330290 [debug] [Thread-5 (]: Writing runtime sql for node "model.rightmove_epc.epc_flats_count"
[0m15:59:32.331381 [debug] [Thread-5 (]: Using snowflake connection "model.rightmove_epc.epc_flats_count"
[0m15:59:32.331754 [debug] [Thread-5 (]: On model.rightmove_epc.epc_flats_count: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.epc_flats_count"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.epc_flats_count
  
   as (
    with epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn

),

flat_epc as (

    select uprn,
    count(BUILDING_REFERENCE_NUMBER) as building_ref_count
    from epc
    group by 1
    having count(BUILDING_REFERENCE_NUMBER) >1

)

select * from flat_epc
  );
[0m15:59:32.332186 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m15:59:32.336400 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f055b113-40f2-40b6-94d3-b65734554dec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1075e5d50>]}
[0m15:59:32.336864 [info ] [Thread-1 (]: 1 of 6 OK created sql view model dbt_melissa_rm_epc.dim_addressid .............. [[32mSUCCESS 1[0m in 0.73s]
[0m15:59:32.337224 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.dim_addressid
[0m15:59:32.418102 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f055b113-40f2-40b6-94d3-b65734554dec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107834cd0>]}
[0m15:59:32.418675 [info ] [Thread-3 (]: 3 of 6 OK created sql view model dbt_melissa_rm_epc.latest_rm_urn .............. [[32mSUCCESS 1[0m in 0.81s]
[0m15:59:32.419067 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.latest_rm_urn
[0m15:59:32.419496 [debug] [Thread-7 (]: Began running node model.rightmove_epc.false_listings_count
[0m15:59:32.419858 [info ] [Thread-7 (]: 5 of 6 START sql view model dbt_melissa_rm_epc.false_listings_count ............ [RUN]
[0m15:59:32.420321 [debug] [Thread-7 (]: Acquiring new snowflake connection 'model.rightmove_epc.false_listings_count'
[0m15:59:32.420520 [debug] [Thread-7 (]: Began compiling node model.rightmove_epc.false_listings_count
[0m15:59:32.423371 [debug] [Thread-7 (]: Writing injected SQL for node "model.rightmove_epc.false_listings_count"
[0m15:59:32.423898 [debug] [Thread-7 (]: Timing info for model.rightmove_epc.false_listings_count (compile): 15:59:32.420629 => 15:59:32.423782
[0m15:59:32.424085 [debug] [Thread-7 (]: Began executing node model.rightmove_epc.false_listings_count
[0m15:59:32.425848 [debug] [Thread-7 (]: Writing runtime sql for node "model.rightmove_epc.false_listings_count"
[0m15:59:32.426461 [debug] [Thread-7 (]: Using snowflake connection "model.rightmove_epc.false_listings_count"
[0m15:59:32.426651 [debug] [Thread-7 (]: On model.rightmove_epc.false_listings_count: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.false_listings_count"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.false_listings_count
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn

),

false_rm as (

    select 
    uprn,
    count(LISTING_ID) listing_count
    from rm
    group by 1
    having count(LISTING_ID) >1

)

select * from false_rm
  );
[0m15:59:32.426835 [debug] [Thread-7 (]: Opening a new connection, currently in state init
[0m15:59:32.826760 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m15:59:32.828549 [debug] [Thread-5 (]: Timing info for model.rightmove_epc.epc_flats_count (execute): 15:59:32.328194 => 15:59:32.828420
[0m15:59:32.828787 [debug] [Thread-5 (]: On model.rightmove_epc.epc_flats_count: Close
[0m15:59:32.877248 [debug] [Thread-7 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m15:59:32.879009 [debug] [Thread-7 (]: Timing info for model.rightmove_epc.false_listings_count (execute): 15:59:32.424192 => 15:59:32.878880
[0m15:59:32.879257 [debug] [Thread-7 (]: On model.rightmove_epc.false_listings_count: Close
[0m15:59:32.918573 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f055b113-40f2-40b6-94d3-b65734554dec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107924550>]}
[0m15:59:32.919034 [info ] [Thread-5 (]: 4 of 6 OK created sql view model dbt_melissa_rm_epc.epc_flats_count ............ [[32mSUCCESS 1[0m in 0.60s]
[0m15:59:32.919395 [debug] [Thread-5 (]: Finished running node model.rightmove_epc.epc_flats_count
[0m15:59:32.969734 [debug] [Thread-7 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f055b113-40f2-40b6-94d3-b65734554dec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1076b0a90>]}
[0m15:59:32.970334 [info ] [Thread-7 (]: 5 of 6 OK created sql view model dbt_melissa_rm_epc.false_listings_count ....... [[32mSUCCESS 1[0m in 0.55s]
[0m15:59:32.970762 [debug] [Thread-7 (]: Finished running node model.rightmove_epc.false_listings_count
[0m15:59:32.971312 [debug] [Thread-4 (]: Began running node model.rightmove_epc.dim_uprn
[0m15:59:32.971970 [info ] [Thread-4 (]: 6 of 6 START sql view model dbt_melissa_rm_epc.dim_uprn ........................ [RUN]
[0m15:59:32.972671 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_uprn'
[0m15:59:32.972947 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.dim_uprn
[0m15:59:32.975787 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.dim_uprn"
[0m15:59:32.976455 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_uprn (compile): 15:59:32.973106 => 15:59:32.976312
[0m15:59:32.976702 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.dim_uprn
[0m15:59:32.979069 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.dim_uprn"
[0m15:59:32.980619 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.dim_uprn"
[0m15:59:32.980957 [debug] [Thread-4 (]: On model.rightmove_epc.dim_uprn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_uprn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE UPRNS


with epc as (

    select distinct
    epc.uprn,
    epc.addressid,
    epc.ADDRESS,
    'EPC' AS datasource,
    epc.POSTCODE,
    case when multi.uprn is null then NULL else 1 end as multi_uprn

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc
    left join ANALYTICS_DEV.dbt_melissa_rm_epc.epc_flats_count multi on epc.uprn = multi.uprn

    where epc.REMOVE_FROM_RM_MATCH = 0
    AND epc.UPRN IS NOT NULL
),

rightmove as (

 select distinct
    rm.uprn,
    rm.addressid,
    concat(rm.ADDRESS_1,',',rm.ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    rm.FULL_POSTCODE AS POSTCODE,
    case when multi.uprn is null then NULL else 1 end as multi_uprn

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove rm
    left join ANALYTICS_DEV.dbt_melissa_rm_epc.false_listings_count multi on rm.uprn = multi.uprn
    WHERE rm.UPRN IS NOT NULL


),

final as (

    select * from epc
    union all
    select * from rightmove
)

select distinct * from final
  );
[0m15:59:32.981241 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m15:59:33.693879 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m15:59:33.695636 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_uprn (execute): 15:59:32.976848 => 15:59:33.695515
[0m15:59:33.695870 [debug] [Thread-4 (]: On model.rightmove_epc.dim_uprn: Close
[0m15:59:33.771843 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f055b113-40f2-40b6-94d3-b65734554dec', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107824bd0>]}
[0m15:59:33.772389 [info ] [Thread-4 (]: 6 of 6 OK created sql view model dbt_melissa_rm_epc.dim_uprn ................... [[32mSUCCESS 1[0m in 0.80s]
[0m15:59:33.772772 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.dim_uprn
[0m15:59:33.774670 [debug] [MainThread]: Connection 'master' was properly closed.
[0m15:59:33.774931 [debug] [MainThread]: Connection 'model.rightmove_epc.dim_addressid' was properly closed.
[0m15:59:33.775131 [debug] [MainThread]: Connection 'model.rightmove_epc.latest_epc_urn' was properly closed.
[0m15:59:33.775313 [debug] [MainThread]: Connection 'model.rightmove_epc.latest_rm_urn' was properly closed.
[0m15:59:33.775488 [debug] [MainThread]: Connection 'model.rightmove_epc.epc_flats_count' was properly closed.
[0m15:59:33.775675 [debug] [MainThread]: Connection 'model.rightmove_epc.false_listings_count' was properly closed.
[0m15:59:33.775840 [debug] [MainThread]: Connection 'model.rightmove_epc.dim_uprn' was properly closed.
[0m15:59:33.776101 [info ] [MainThread]: 
[0m15:59:33.776319 [info ] [MainThread]: Finished running 6 view models in 0 hours 0 minutes and 3.35 seconds (3.35s).
[0m15:59:33.777014 [debug] [MainThread]: Command end result
[0m15:59:33.783746 [info ] [MainThread]: 
[0m15:59:33.784044 [info ] [MainThread]: [32mCompleted successfully[0m
[0m15:59:33.784233 [info ] [MainThread]: 
[0m15:59:33.784423 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=0 SKIP=0 TOTAL=6
[0m15:59:33.786199 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.6440465, "process_user_time": 1.300546, "process_kernel_time": 0.195979, "process_mem_max_rss": "137052160", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m15:59:33.786580 [debug] [MainThread]: Command `dbt run` succeeded at 15:59:33.786501 after 3.64 seconds
[0m15:59:33.786821 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102d8e0d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102c3a210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102c52350>]}
[0m15:59:33.787062 [debug] [MainThread]: Flushing usage events
[0m16:04:24.874092 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a218690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a25d650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a25f290>]}


============================== 16:04:24.877408 | 82c3ff08-0761-4f5e-8564-04f5f60b3909 ==============================
[0m16:04:24.877408 [info ] [MainThread]: Running with dbt=1.7.10
[0m16:04:24.877812 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'version_check': 'True', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select models/staging', 'static_parser': 'True', 'log_format': 'default', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m16:04:25.047000 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '82c3ff08-0761-4f5e-8564-04f5f60b3909', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ad67110>]}
[0m16:04:25.080229 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '82c3ff08-0761-4f5e-8564-04f5f60b3909', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a287d50>]}
[0m16:04:25.081662 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m16:04:25.091817 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m16:04:25.108644 [debug] [MainThread]: Partial parsing enabled: 2 files deleted, 2 files added, 3 files changed.
[0m16:04:25.109033 [debug] [MainThread]: Partial parsing: added file: rightmove_epc://models/bridge/rm_listings_count.sql
[0m16:04:25.109194 [debug] [MainThread]: Partial parsing: added file: rightmove_epc://models/reports/rm_listings.sql
[0m16:04:25.109335 [debug] [MainThread]: Partial parsing: deleted file: rightmove_epc://models/reports/false_listings.sql
[0m16:04:25.109658 [debug] [MainThread]: Partial parsing: deleted file: rightmove_epc://models/bridge/false_listings_count.sql
[0m16:04:25.109825 [debug] [MainThread]: Partial parsing: updated file: rightmove_epc://models/staging/stg_rightmove.sql
[0m16:04:25.109962 [debug] [MainThread]: Partial parsing: updated file: rightmove_epc://models/reports/flats_report.sql
[0m16:04:25.110096 [debug] [MainThread]: Partial parsing: updated file: rightmove_epc://models/bridge/dim_uprn.sql
[0m16:04:25.174495 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.rightmove_epc.dim_uprn' (models/bridge/dim_uprn.sql) depends on a node named 'false_listings_count' which was not found
[0m16:04:25.176993 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.3350376, "process_user_time": 1.024532, "process_kernel_time": 0.150201, "process_mem_max_rss": "127074304", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m16:04:25.177305 [debug] [MainThread]: Command `dbt run` failed at 16:04:25.177246 after 0.34 seconds
[0m16:04:25.177525 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a208710>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a25f150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10af4aed0>]}
[0m16:04:25.177730 [debug] [MainThread]: Flushing usage events
[0m16:04:44.925266 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107654190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10769a790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10769b310>]}


============================== 16:04:44.928205 | c7d73d52-a8cc-42ae-9c8f-797a8e27305e ==============================
[0m16:04:44.928205 [info ] [MainThread]: Running with dbt=1.7.10
[0m16:04:44.928546 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt run --select models/staging', 'send_anonymous_usage_stats': 'True'}
[0m16:04:45.095698 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c7d73d52-a8cc-42ae-9c8f-797a8e27305e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107699ed0>]}
[0m16:04:45.130877 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c7d73d52-a8cc-42ae-9c8f-797a8e27305e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1108aff90>]}
[0m16:04:45.131813 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m16:04:45.142529 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m16:04:45.160191 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m16:04:45.160480 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m16:04:45.163945 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c7d73d52-a8cc-42ae-9c8f-797a8e27305e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110b3d0d0>]}
[0m16:04:45.170779 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c7d73d52-a8cc-42ae-9c8f-797a8e27305e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110a2ea10>]}
[0m16:04:45.171036 [info ] [MainThread]: Found 19 models, 1 analysis, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m16:04:45.171237 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c7d73d52-a8cc-42ae-9c8f-797a8e27305e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10763c710>]}
[0m16:04:45.172313 [info ] [MainThread]: 
[0m16:04:45.172705 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m16:04:45.173380 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m16:04:45.180024 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m16:04:45.180288 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m16:04:45.180461 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:04:45.914712 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 1.0 seconds
[0m16:04:45.919131 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m16:04:46.014455 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m16:04:46.024113 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m16:04:46.024556 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m16:04:46.024876 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:04:47.075343 [debug] [ThreadPool]: SQL status: SUCCESS 19 in 1.0 seconds
[0m16:04:47.078471 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m16:04:47.195432 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c7d73d52-a8cc-42ae-9c8f-797a8e27305e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110a2ed90>]}
[0m16:04:47.196267 [info ] [MainThread]: Concurrency: 8 threads (target='dev')
[0m16:04:47.196584 [info ] [MainThread]: 
[0m16:04:47.199688 [debug] [Thread-1 (]: Began running node model.rightmove_epc.stg_epc_certs
[0m16:04:47.200035 [debug] [Thread-2 (]: Began running node model.rightmove_epc.stg_rightmove
[0m16:04:47.200455 [info ] [Thread-1 (]: 1 of 2 START sql view model dbt_melissa_rm_epc.stg_epc_certs ................... [RUN]
[0m16:04:47.200810 [info ] [Thread-2 (]: 2 of 2 START sql view model dbt_melissa_rm_epc.stg_rightmove ................... [RUN]
[0m16:04:47.201312 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.stg_epc_certs)
[0m16:04:47.203163 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.stg_rightmove'
[0m16:04:47.203433 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.stg_epc_certs
[0m16:04:47.203688 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.stg_rightmove
[0m16:04:47.240315 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.stg_epc_certs"
[0m16:04:47.241897 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.stg_rightmove"
[0m16:04:47.242819 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (compile): 16:04:47.203856 => 16:04:47.242685
[0m16:04:47.243050 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (compile): 16:04:47.240550 => 16:04:47.242950
[0m16:04:47.243226 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.stg_epc_certs
[0m16:04:47.243409 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.stg_rightmove
[0m16:04:47.256729 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.stg_epc_certs"
[0m16:04:47.258300 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.stg_rightmove"
[0m16:04:47.259113 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.stg_epc_certs"
[0m16:04:47.259617 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.stg_rightmove"
[0m16:04:47.259825 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_epc_certs"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
  
   as (
    WITH epc_certs as (
    
    select 
    UPRN,
    LODGEMENT_DATE,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
   -- COUNTY,
    LOCAL_AUTHORITY as LOCAL_AUTHORITY_CODE,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    UPPER(CASE WHEN (UPPER(ADDRESS1) LIKE 'FLAT%' OR UPPER(ADDRESS1) LIKE 'UNIT%') or UPPER(ADDRESS1) LIKE 'ROOM%' 
    THEN TRIM(REPLACE(REPLACE(CONCAT(ADDRESS),','),' '))
    ELSE trim(replace(replace(ADDRESS1,' '),',')) END) AS ADDRESSID,
    CASE WHEN UPRN is null and addressid is null THEN 1 else 0 end as REMOVE_FROM_RM_MATCH,
    FLOOR_LEVEL,
    FLAT_TOP_STOREY,
    FLAT_STOREY_COUNT,
    PROPERTY_TYPE
 from  RAW.EPC_TEST_DATA.EPC_CERTIFICATES 

)

SELECT * FROM epc_certs
  );
[0m16:04:47.260047 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_rightmove"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
  
   as (
    with rm as (

    SELECT 
    LISTING_ID, 
    CHANGE_DATE,
    UPPER(TRIM(replace(REPLACE(CONCAT(ADDRESS_1::VARCHAR,ADDRESS_2::VARCHAR),' '),','))) AS ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, 
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    BEDROOM,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    BRANCH_ID,
	 BRANCH_NAME,
    WEBSITE_URL,
	 COMPANY_NAME
    FROM 
       ANALYTICS.RIGHTMOVE_PROD.CLEAN_RAW_RIGHTMOVE_DATA 

 
)

SELECT * FROM rm
  );
[0m16:04:47.260231 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:04:47.260390 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m16:04:47.769693 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:04:47.788320 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stg_epc_certs (execute): 16:04:47.243517 => 16:04:47.788151
[0m16:04:47.788666 [debug] [Thread-1 (]: On model.rightmove_epc.stg_epc_certs: Close
[0m16:04:47.791672 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:04:47.793876 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_rightmove (execute): 16:04:47.256878 => 16:04:47.793715
[0m16:04:47.794551 [debug] [Thread-2 (]: On model.rightmove_epc.stg_rightmove: Close
[0m16:04:47.879845 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c7d73d52-a8cc-42ae-9c8f-797a8e27305e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110c66350>]}
[0m16:04:47.880673 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c7d73d52-a8cc-42ae-9c8f-797a8e27305e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110c98fd0>]}
[0m16:04:47.881372 [info ] [Thread-1 (]: 1 of 2 OK created sql view model dbt_melissa_rm_epc.stg_epc_certs .............. [[32mSUCCESS 1[0m in 0.68s]
[0m16:04:47.881849 [info ] [Thread-2 (]: 2 of 2 OK created sql view model dbt_melissa_rm_epc.stg_rightmove .............. [[32mSUCCESS 1[0m in 0.68s]
[0m16:04:47.882313 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.stg_epc_certs
[0m16:04:47.882716 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.stg_rightmove
[0m16:04:47.884325 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:04:47.884615 [debug] [MainThread]: Connection 'model.rightmove_epc.stg_epc_certs' was properly closed.
[0m16:04:47.884855 [debug] [MainThread]: Connection 'model.rightmove_epc.stg_rightmove' was properly closed.
[0m16:04:47.885134 [info ] [MainThread]: 
[0m16:04:47.885405 [info ] [MainThread]: Finished running 2 view models in 0 hours 0 minutes and 2.71 seconds (2.71s).
[0m16:04:47.885971 [debug] [MainThread]: Command end result
[0m16:04:47.893177 [info ] [MainThread]: 
[0m16:04:47.893512 [info ] [MainThread]: [32mCompleted successfully[0m
[0m16:04:47.893761 [info ] [MainThread]: 
[0m16:04:47.893992 [info ] [MainThread]: Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
[0m16:04:47.896077 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 2.9975586, "process_user_time": 1.21185, "process_kernel_time": 0.16223, "process_mem_max_rss": "136003584", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m16:04:47.896563 [debug] [MainThread]: Command `dbt run` succeeded at 16:04:47.896471 after 3.00 seconds
[0m16:04:47.896860 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1076c3110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1076c3410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1029fa210>]}
[0m16:04:47.897139 [debug] [MainThread]: Flushing usage events
[0m16:04:52.296640 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11118f050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11119a850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11119b3d0>]}


============================== 16:04:52.298931 | 24b71223-3f3e-47a0-8d40-98ce7278b236 ==============================
[0m16:04:52.298931 [info ] [MainThread]: Running with dbt=1.7.10
[0m16:04:52.299245 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'invocation_command': 'dbt run --select models/bridge', 'send_anonymous_usage_stats': 'True'}
[0m16:04:52.434388 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '24b71223-3f3e-47a0-8d40-98ce7278b236', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1115989d0>]}
[0m16:04:52.469688 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '24b71223-3f3e-47a0-8d40-98ce7278b236', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111af6e50>]}
[0m16:04:52.470314 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m16:04:52.480039 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m16:04:52.497416 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m16:04:52.497722 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m16:04:52.501260 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '24b71223-3f3e-47a0-8d40-98ce7278b236', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111155410>]}
[0m16:04:52.508030 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '24b71223-3f3e-47a0-8d40-98ce7278b236', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111f35f90>]}
[0m16:04:52.508327 [info ] [MainThread]: Found 19 models, 1 analysis, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m16:04:52.508526 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '24b71223-3f3e-47a0-8d40-98ce7278b236', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111ac8d50>]}
[0m16:04:52.509600 [info ] [MainThread]: 
[0m16:04:52.509995 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m16:04:52.510619 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m16:04:52.516804 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m16:04:52.517024 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m16:04:52.517185 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:04:53.278662 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 1.0 seconds
[0m16:04:53.281426 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m16:04:53.385935 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m16:04:53.394712 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m16:04:53.395102 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m16:04:53.395399 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:04:53.920568 [debug] [ThreadPool]: SQL status: SUCCESS 19 in 1.0 seconds
[0m16:04:53.924066 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m16:04:54.000786 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '24b71223-3f3e-47a0-8d40-98ce7278b236', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111e143d0>]}
[0m16:04:54.001631 [info ] [MainThread]: Concurrency: 8 threads (target='dev')
[0m16:04:54.001978 [info ] [MainThread]: 
[0m16:04:54.004264 [debug] [Thread-1 (]: Began running node model.rightmove_epc.dim_addressid
[0m16:04:54.004660 [debug] [Thread-2 (]: Began running node model.rightmove_epc.latest_epc_urn
[0m16:04:54.005084 [info ] [Thread-1 (]: 1 of 6 START sql view model dbt_melissa_rm_epc.dim_addressid ................... [RUN]
[0m16:04:54.005473 [debug] [Thread-3 (]: Began running node model.rightmove_epc.latest_rm_urn
[0m16:04:54.005878 [info ] [Thread-2 (]: 2 of 6 START sql view model dbt_melissa_rm_epc.latest_epc_urn .................. [RUN]
[0m16:04:54.008295 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.dim_addressid)
[0m16:04:54.008671 [info ] [Thread-3 (]: 3 of 6 START sql view model dbt_melissa_rm_epc.latest_rm_urn ................... [RUN]
[0m16:04:54.009303 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.latest_epc_urn'
[0m16:04:54.009642 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.dim_addressid
[0m16:04:54.010242 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.rightmove_epc.latest_rm_urn'
[0m16:04:54.010537 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.latest_epc_urn
[0m16:04:54.050493 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.dim_addressid"
[0m16:04:54.050831 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.latest_rm_urn
[0m16:04:54.052388 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.latest_epc_urn"
[0m16:04:54.053797 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.latest_rm_urn"
[0m16:04:54.054257 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.latest_epc_urn (compile): 16:04:54.050960 => 16:04:54.054107
[0m16:04:54.054526 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.latest_rm_urn (compile): 16:04:54.052592 => 16:04:54.054402
[0m16:04:54.054713 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.latest_epc_urn
[0m16:04:54.054899 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.dim_addressid (compile): 16:04:54.010723 => 16:04:54.054809
[0m16:04:54.055076 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.latest_rm_urn
[0m16:04:54.066813 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.dim_addressid
[0m16:04:54.068791 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.latest_epc_urn"
[0m16:04:54.070350 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.latest_rm_urn"
[0m16:04:54.071801 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.dim_addressid"
[0m16:04:54.072552 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.latest_epc_urn"
[0m16:04:54.073048 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.latest_rm_urn"
[0m16:04:54.073249 [debug] [Thread-2 (]: On model.rightmove_epc.latest_epc_urn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.latest_epc_urn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn
  
   as (
    with epc_max_date as (

    select uprn as UPRN_EPC,
    MAX(LODGEMENT_DATE) AS MAX_LODGEMENT_DATE,
    from  ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    group by 1


),

latest_epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc
    inner join epc_max_date on epc.uprn = epc_max_date.UPRN_EPC
    where MAX_LODGEMENT_DATE = LODGEMENT_DATE
   -- and uprn = 200073066

)

select DISTINCT * from latest_epc


/*
select uprn, count(*) from latest_epc
group by 1
having count(*) >1
*/
  );
[0m16:04:54.073838 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.dim_addressid"
[0m16:04:54.074037 [debug] [Thread-3 (]: On model.rightmove_epc.latest_rm_urn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.latest_rm_urn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NOT NULL
),

change_date AS (
    SELECT 
        UPRN AS UPRN_CD, 
        MAX(CHANGE_DATE) AS MAX_CHANGE_DATE 
    FROM rm
    GROUP BY UPRN
),

rm_latest as (

    SELECT distinct * FROM rm
    LEFT JOIN change_date cd
    ON rm.UPRN = cd.UPRN_CD
    WHERE cd.MAX_CHANGE_DATE = rm.CHANGE_DATE 
 --  and UPRN = 100090588560
    
)

select DISTINCT * from rm_latest

/*
select uprn, count(*) from rm_latest
group by 1
having count(*) >1
*/
  );
[0m16:04:54.074242 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m16:04:54.074442 [debug] [Thread-1 (]: On model.rightmove_epc.dim_addressid: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_addressid"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE ADDRESS'

with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource,
    POSTCODE
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs 
    where REMOVE_FROM_RM_MATCH = 0
    AND ADDRESSID IS NOT NULL

),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    WHERE ADDRESSID IS NOT NULL

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where addressid is not null
  );
[0m16:04:54.074624 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m16:04:54.075123 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:04:54.694295 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:04:54.713727 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.dim_addressid (execute): 16:04:54.070476 => 16:04:54.713555
[0m16:04:54.714097 [debug] [Thread-1 (]: On model.rightmove_epc.dim_addressid: Close
[0m16:04:54.715882 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:04:54.717764 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.latest_rm_urn (execute): 16:04:54.068961 => 16:04:54.717630
[0m16:04:54.718119 [debug] [Thread-3 (]: On model.rightmove_epc.latest_rm_urn: Close
[0m16:04:54.789188 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '24b71223-3f3e-47a0-8d40-98ce7278b236', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111f268d0>]}
[0m16:04:54.789795 [info ] [Thread-3 (]: 3 of 6 OK created sql view model dbt_melissa_rm_epc.latest_rm_urn .............. [[32mSUCCESS 1[0m in 0.78s]
[0m16:04:54.790234 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.latest_rm_urn
[0m16:04:54.790673 [debug] [Thread-5 (]: Began running node model.rightmove_epc.rm_listings_count
[0m16:04:54.790980 [info ] [Thread-5 (]: 4 of 6 START sql view model dbt_melissa_rm_epc.rm_listings_count ............... [RUN]
[0m16:04:54.791519 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.rightmove_epc.rm_listings_count'
[0m16:04:54.791813 [debug] [Thread-5 (]: Began compiling node model.rightmove_epc.rm_listings_count
[0m16:04:54.794454 [debug] [Thread-5 (]: Writing injected SQL for node "model.rightmove_epc.rm_listings_count"
[0m16:04:54.795185 [debug] [Thread-5 (]: Timing info for model.rightmove_epc.rm_listings_count (compile): 16:04:54.792243 => 16:04:54.795004
[0m16:04:54.795463 [debug] [Thread-5 (]: Began executing node model.rightmove_epc.rm_listings_count
[0m16:04:54.797753 [debug] [Thread-5 (]: Writing runtime sql for node "model.rightmove_epc.rm_listings_count"
[0m16:04:54.798367 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '24b71223-3f3e-47a0-8d40-98ce7278b236', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11223ab50>]}
[0m16:04:54.798833 [info ] [Thread-1 (]: 1 of 6 OK created sql view model dbt_melissa_rm_epc.dim_addressid .............. [[32mSUCCESS 1[0m in 0.79s]
[0m16:04:54.799265 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.dim_addressid
[0m16:04:54.799868 [debug] [Thread-5 (]: Using snowflake connection "model.rightmove_epc.rm_listings_count"
[0m16:04:54.800146 [debug] [Thread-5 (]: On model.rightmove_epc.rm_listings_count: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.rm_listings_count"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.rm_listings_count
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn

),

false_rm as (

    select 
    uprn,
    count(LISTING_ID) listing_count
    from rm
    group by 1
   -- having count(LISTING_ID) >1

)

select * from false_rm
  );
[0m16:04:54.800392 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m16:04:55.131790 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:04:55.135333 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.latest_epc_urn (execute): 16:04:54.055180 => 16:04:55.135091
[0m16:04:55.135780 [debug] [Thread-2 (]: On model.rightmove_epc.latest_epc_urn: Close
[0m16:04:55.220308 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '24b71223-3f3e-47a0-8d40-98ce7278b236', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11224ae90>]}
[0m16:04:55.221098 [info ] [Thread-2 (]: 2 of 6 OK created sql view model dbt_melissa_rm_epc.latest_epc_urn ............. [[32mSUCCESS 1[0m in 1.21s]
[0m16:04:55.221663 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.latest_epc_urn
[0m16:04:55.222253 [debug] [Thread-7 (]: Began running node model.rightmove_epc.epc_flats_count
[0m16:04:55.222723 [info ] [Thread-7 (]: 5 of 6 START sql view model dbt_melissa_rm_epc.epc_flats_count ................. [RUN]
[0m16:04:55.223456 [debug] [Thread-7 (]: Acquiring new snowflake connection 'model.rightmove_epc.epc_flats_count'
[0m16:04:55.223792 [debug] [Thread-7 (]: Began compiling node model.rightmove_epc.epc_flats_count
[0m16:04:55.228313 [debug] [Thread-7 (]: Writing injected SQL for node "model.rightmove_epc.epc_flats_count"
[0m16:04:55.230339 [debug] [Thread-7 (]: Timing info for model.rightmove_epc.epc_flats_count (compile): 16:04:55.224001 => 16:04:55.230141
[0m16:04:55.230661 [debug] [Thread-7 (]: Began executing node model.rightmove_epc.epc_flats_count
[0m16:04:55.233523 [debug] [Thread-7 (]: Writing runtime sql for node "model.rightmove_epc.epc_flats_count"
[0m16:04:55.234514 [debug] [Thread-7 (]: Using snowflake connection "model.rightmove_epc.epc_flats_count"
[0m16:04:55.234833 [debug] [Thread-7 (]: On model.rightmove_epc.epc_flats_count: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.epc_flats_count"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.epc_flats_count
  
   as (
    with epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn

),

flat_epc as (

    select uprn,
    count(BUILDING_REFERENCE_NUMBER) as building_ref_count
    from epc
    group by 1
    having count(BUILDING_REFERENCE_NUMBER) >1

)

select * from flat_epc
  );
[0m16:04:55.235094 [debug] [Thread-7 (]: Opening a new connection, currently in state init
[0m16:04:55.280273 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m16:04:55.282354 [debug] [Thread-5 (]: Timing info for model.rightmove_epc.rm_listings_count (execute): 16:04:54.795631 => 16:04:55.282203
[0m16:04:55.282649 [debug] [Thread-5 (]: On model.rightmove_epc.rm_listings_count: Close
[0m16:04:55.362936 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '24b71223-3f3e-47a0-8d40-98ce7278b236', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112257410>]}
[0m16:04:55.363599 [info ] [Thread-5 (]: 4 of 6 OK created sql view model dbt_melissa_rm_epc.rm_listings_count .......... [[32mSUCCESS 1[0m in 0.57s]
[0m16:04:55.364084 [debug] [Thread-5 (]: Finished running node model.rightmove_epc.rm_listings_count
[0m16:04:55.793707 [debug] [Thread-7 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:04:55.798520 [debug] [Thread-7 (]: Timing info for model.rightmove_epc.epc_flats_count (execute): 16:04:55.230837 => 16:04:55.798251
[0m16:04:55.799087 [debug] [Thread-7 (]: On model.rightmove_epc.epc_flats_count: Close
[0m16:04:55.887077 [debug] [Thread-7 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '24b71223-3f3e-47a0-8d40-98ce7278b236', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1122f8d50>]}
[0m16:04:55.887856 [info ] [Thread-7 (]: 5 of 6 OK created sql view model dbt_melissa_rm_epc.epc_flats_count ............ [[32mSUCCESS 1[0m in 0.66s]
[0m16:04:55.888474 [debug] [Thread-7 (]: Finished running node model.rightmove_epc.epc_flats_count
[0m16:04:55.889216 [debug] [Thread-4 (]: Began running node model.rightmove_epc.dim_uprn
[0m16:04:55.889807 [info ] [Thread-4 (]: 6 of 6 START sql view model dbt_melissa_rm_epc.dim_uprn ........................ [RUN]
[0m16:04:55.890611 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_uprn'
[0m16:04:55.890988 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.dim_uprn
[0m16:04:55.894867 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.dim_uprn"
[0m16:04:55.895723 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_uprn (compile): 16:04:55.891223 => 16:04:55.895528
[0m16:04:55.896068 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.dim_uprn
[0m16:04:55.899106 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.dim_uprn"
[0m16:04:55.900983 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.dim_uprn"
[0m16:04:55.901459 [debug] [Thread-4 (]: On model.rightmove_epc.dim_uprn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_uprn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE UPRNS


with epc as (

    select distinct
    epc.uprn,
    epc.addressid,
    epc.ADDRESS,
    'EPC' AS datasource,
    epc.POSTCODE,
    case when multi.uprn is null then NULL else 1 end as multi_uprn

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc
    left join ANALYTICS_DEV.dbt_melissa_rm_epc.epc_flats_count multi on epc.uprn = multi.uprn

    where epc.REMOVE_FROM_RM_MATCH = 0
    AND epc.UPRN IS NOT NULL
),

rightmove as (

 select distinct
    rm.uprn,
    rm.addressid,
    concat(rm.ADDRESS_1,',',rm.ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    rm.FULL_POSTCODE AS POSTCODE
    multi.uprn as LISTING_COUNT

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove rm
    left join ANALYTICS_DEV.dbt_melissa_rm_epc.rm_listings_count multi on rm.uprn = multi.uprn
    WHERE rm.UPRN IS NOT NULL


),

final as (

    select * from epc
    union all
    select * from rightmove
)

select distinct * from final
  );
[0m16:04:55.901831 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m16:04:56.289402 [debug] [Thread-4 (]: Snowflake adapter: Snowflake query id: 01b34564-0103-9bb0-0000-71950637b032
[0m16:04:56.289948 [debug] [Thread-4 (]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 32 at position 4 unexpected 'multi'.
syntax error line 39 at position 1 unexpected ','.
[0m16:04:56.290559 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_uprn (execute): 16:04:55.896268 => 16:04:56.290338
[0m16:04:56.290958 [debug] [Thread-4 (]: On model.rightmove_epc.dim_uprn: Close
[0m16:04:56.377422 [debug] [Thread-4 (]: Database Error in model dim_uprn (models/bridge/dim_uprn.sql)
  001003 (42000): SQL compilation error:
  syntax error line 32 at position 4 unexpected 'multi'.
  syntax error line 39 at position 1 unexpected ','.
  compiled Code at target/run/rightmove_epc/models/bridge/dim_uprn.sql
[0m16:04:56.377981 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '24b71223-3f3e-47a0-8d40-98ce7278b236', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113834850>]}
[0m16:04:56.378529 [error] [Thread-4 (]: 6 of 6 ERROR creating sql view model dbt_melissa_rm_epc.dim_uprn ............... [[31mERROR[0m in 0.49s]
[0m16:04:56.379069 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.dim_uprn
[0m16:04:56.380877 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:04:56.381202 [debug] [MainThread]: Connection 'model.rightmove_epc.dim_addressid' was properly closed.
[0m16:04:56.381463 [debug] [MainThread]: Connection 'model.rightmove_epc.latest_epc_urn' was properly closed.
[0m16:04:56.381709 [debug] [MainThread]: Connection 'model.rightmove_epc.latest_rm_urn' was properly closed.
[0m16:04:56.381942 [debug] [MainThread]: Connection 'model.rightmove_epc.rm_listings_count' was properly closed.
[0m16:04:56.382151 [debug] [MainThread]: Connection 'model.rightmove_epc.epc_flats_count' was properly closed.
[0m16:04:56.382354 [debug] [MainThread]: Connection 'model.rightmove_epc.dim_uprn' was properly closed.
[0m16:04:56.382648 [info ] [MainThread]: 
[0m16:04:56.382909 [info ] [MainThread]: Finished running 6 view models in 0 hours 0 minutes and 3.87 seconds (3.87s).
[0m16:04:56.383779 [debug] [MainThread]: Command end result
[0m16:04:56.391406 [info ] [MainThread]: 
[0m16:04:56.391781 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m16:04:56.392024 [info ] [MainThread]: 
[0m16:04:56.392254 [error] [MainThread]:   Database Error in model dim_uprn (models/bridge/dim_uprn.sql)
  001003 (42000): SQL compilation error:
  syntax error line 32 at position 4 unexpected 'multi'.
  syntax error line 39 at position 1 unexpected ','.
  compiled Code at target/run/rightmove_epc/models/bridge/dim_uprn.sql
[0m16:04:56.392493 [info ] [MainThread]: 
[0m16:04:56.392724 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=0 TOTAL=6
[0m16:04:56.393930 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 4.1227903, "process_user_time": 1.367916, "process_kernel_time": 0.154603, "process_mem_max_rss": "138313728", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m16:04:56.394311 [debug] [MainThread]: Command `dbt run` failed at 16:04:56.394226 after 4.12 seconds
[0m16:04:56.394601 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102992b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1111c0ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102a961d0>]}
[0m16:04:56.394869 [debug] [MainThread]: Flushing usage events
[0m16:05:08.643326 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10491cb50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10495dc10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10495f090>]}


============================== 16:05:08.645397 | a8e2299d-399b-4539-97b3-21dfb8e559fb ==============================
[0m16:05:08.645397 [info ] [MainThread]: Running with dbt=1.7.10
[0m16:05:08.645716 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --select models/matching', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m16:05:08.783516 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a8e2299d-399b-4539-97b3-21dfb8e559fb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1054090d0>]}
[0m16:05:08.819498 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a8e2299d-399b-4539-97b3-21dfb8e559fb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104996410>]}
[0m16:05:08.820061 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m16:05:08.828951 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m16:05:08.847524 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m16:05:08.847792 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m16:05:08.851174 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a8e2299d-399b-4539-97b3-21dfb8e559fb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1051cd410>]}
[0m16:05:08.857630 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a8e2299d-399b-4539-97b3-21dfb8e559fb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1055a3950>]}
[0m16:05:08.857908 [info ] [MainThread]: Found 19 models, 1 analysis, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m16:05:08.858100 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a8e2299d-399b-4539-97b3-21dfb8e559fb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105717d50>]}
[0m16:05:08.859174 [info ] [MainThread]: 
[0m16:05:08.859550 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m16:05:08.860232 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m16:05:08.866708 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m16:05:08.866980 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m16:05:08.867137 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:05:09.478520 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 1.0 seconds
[0m16:05:09.480182 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m16:05:09.571608 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m16:05:09.577568 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m16:05:09.577830 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m16:05:09.578040 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:05:09.969703 [debug] [ThreadPool]: SQL status: SUCCESS 20 in 0.0 seconds
[0m16:05:09.971359 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m16:05:10.059416 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a8e2299d-399b-4539-97b3-21dfb8e559fb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1054b2b50>]}
[0m16:05:10.060084 [info ] [MainThread]: Concurrency: 8 threads (target='dev')
[0m16:05:10.060343 [info ] [MainThread]: 
[0m16:05:10.062153 [debug] [Thread-1 (]: Began running node model.rightmove_epc.address_match
[0m16:05:10.062426 [debug] [Thread-2 (]: Began running node model.rightmove_epc.no_uprn_match
[0m16:05:10.062677 [debug] [Thread-3 (]: Began running node model.rightmove_epc.uprn_match
[0m16:05:10.062963 [info ] [Thread-1 (]: 1 of 4 START sql view model dbt_melissa_rm_epc.address_match ................... [RUN]
[0m16:05:10.063342 [info ] [Thread-2 (]: 2 of 4 START sql view model dbt_melissa_rm_epc.no_uprn_match ................... [RUN]
[0m16:05:10.065166 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.address_match)
[0m16:05:10.063672 [info ] [Thread-3 (]: 3 of 4 START sql view model dbt_melissa_rm_epc.uprn_match ...................... [RUN]
[0m16:05:10.065649 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.no_uprn_match'
[0m16:05:10.065893 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.address_match
[0m16:05:10.066295 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.rightmove_epc.uprn_match'
[0m16:05:10.066511 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.no_uprn_match
[0m16:05:10.102450 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.address_match"
[0m16:05:10.102741 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.uprn_match
[0m16:05:10.104186 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.no_uprn_match"
[0m16:05:10.105762 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.uprn_match"
[0m16:05:10.106461 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.address_match (compile): 16:05:10.066647 => 16:05:10.106324
[0m16:05:10.106691 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.no_uprn_match (compile): 16:05:10.102862 => 16:05:10.106592
[0m16:05:10.106853 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.address_match
[0m16:05:10.107026 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.uprn_match (compile): 16:05:10.104388 => 16:05:10.106939
[0m16:05:10.107196 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.no_uprn_match
[0m16:05:10.120063 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.uprn_match
[0m16:05:10.120358 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.address_match"
[0m16:05:10.121902 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.no_uprn_match"
[0m16:05:10.123316 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.uprn_match"
[0m16:05:10.124169 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.uprn_match"
[0m16:05:10.124387 [debug] [Thread-3 (]: On model.rightmove_epc.uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
  
   as (
    with rm_latest as (

    select rm.*, multi.uprn AS multi_uprn
    from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn rm
    left join ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn multi on rm.uprn = multi.uprn
    where rm.UPRN IS NOT NULL
    and multi.datasource = 'RIGHTMOVE'
   and multi.multi_uprn IS NULL 
   
),

epc_uprn as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
    where datasource = 'EPC'
    and multi_uprn is null
)


SELECT rm_latest.*,
CASE WHEN epc_uprn.UPRN is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_uprn.UPRN AS EPC_UPRN,
epc_uprn.ADDRESSID AS EPC_ADDRESSID


FROM rm_latest
LEFT JOIN epc_uprn
ON rm_latest.UPRN = epc_uprn.UPRN

WHERE MATCH_EPC = 'YES'
  );
[0m16:05:10.124583 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m16:05:10.125445 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.address_match"
[0m16:05:10.125635 [debug] [Thread-1 (]: On model.rightmove_epc.address_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.address_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NULL

),



epc_address as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
    where datasource = 'EPC'
    
)


SELECT rm.*,
CASE WHEN epc_address.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_address.ADDRESSID AS EPC_ADDRESSID,
epc_address.UPRN AS EPC_UPRN


FROM rm
LEFT JOIN epc_address
ON rm.addressid = epc_address.addressid
and rm.FULL_POSTCODE = epc_address.POSTCODE
  );
[0m16:05:10.125814 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:05:10.126265 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.no_uprn_match"
[0m16:05:10.127069 [debug] [Thread-2 (]: On model.rightmove_epc.no_uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.no_uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.no_uprn_match
  
   as (
    with rm_latest as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn 
    where UPRN IS NOT NULL
),

epc_uprn as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
    where datasource = 'EPC'
)


SELECT rm_latest.*,
CASE WHEN epc_uprn.UPRN is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_uprn.UPRN AS EPC_UPRN,
epc_uprn.ADDRESSID AS EPC_ADDRESSID


FROM rm_latest
LEFT JOIN epc_uprn
ON rm_latest.UPRN = epc_uprn.UPRN

WHERE MATCH_EPC = 'NO'
  );
[0m16:05:10.127312 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m16:05:10.743929 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:05:10.765282 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.address_match (execute): 16:05:10.107302 => 16:05:10.765092
[0m16:05:10.765652 [debug] [Thread-1 (]: On model.rightmove_epc.address_match: Close
[0m16:05:10.842875 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a8e2299d-399b-4539-97b3-21dfb8e559fb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1055e5250>]}
[0m16:05:10.843581 [info ] [Thread-1 (]: 1 of 4 OK created sql view model dbt_melissa_rm_epc.address_match .............. [[32mSUCCESS 1[0m in 0.78s]
[0m16:05:10.844131 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.address_match
[0m16:05:10.869237 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:05:10.871697 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.no_uprn_match (execute): 16:05:10.120504 => 16:05:10.871520
[0m16:05:10.872043 [debug] [Thread-2 (]: On model.rightmove_epc.no_uprn_match: Close
[0m16:05:10.960169 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a8e2299d-399b-4539-97b3-21dfb8e559fb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1058e3b10>]}
[0m16:05:10.960939 [info ] [Thread-2 (]: 2 of 4 OK created sql view model dbt_melissa_rm_epc.no_uprn_match .............. [[32mSUCCESS 1[0m in 0.89s]
[0m16:05:10.961511 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.no_uprn_match
[0m16:05:10.962122 [debug] [Thread-5 (]: Began running node model.rightmove_epc.uprn_address_match
[0m16:05:10.962606 [info ] [Thread-5 (]: 4 of 4 START sql view model dbt_melissa_rm_epc.uprn_address_match .............. [RUN]
[0m16:05:10.963260 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.rightmove_epc.uprn_address_match'
[0m16:05:10.963567 [debug] [Thread-5 (]: Began compiling node model.rightmove_epc.uprn_address_match
[0m16:05:10.966263 [debug] [Thread-5 (]: Writing injected SQL for node "model.rightmove_epc.uprn_address_match"
[0m16:05:10.967217 [debug] [Thread-5 (]: Timing info for model.rightmove_epc.uprn_address_match (compile): 16:05:10.963747 => 16:05:10.967035
[0m16:05:10.967522 [debug] [Thread-5 (]: Began executing node model.rightmove_epc.uprn_address_match
[0m16:05:10.970705 [debug] [Thread-5 (]: Writing runtime sql for node "model.rightmove_epc.uprn_address_match"
[0m16:05:10.972140 [debug] [Thread-5 (]: Using snowflake connection "model.rightmove_epc.uprn_address_match"
[0m16:05:10.972507 [debug] [Thread-5 (]: On model.rightmove_epc.uprn_address_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.uprn_address_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_address_match
  
   as (
    -- where uprn is not matched we try address.

with uprn as (

    select 
    up.LISTING_ID,
    CHANGE_DATE,
    up.ADDRESSID,
    up.ADDRESS_1,
    up.ADDRESS_2,
    FULL_POSTCODE,
    up.UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    BEDROOM,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
 -- need to sleect the same fields as address match
    CASE WHEN ad.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC,
    ad.ADDRESSID AS EPC_ADDRESSID,
    ad.UPRN AS EPC_UPRN

     from ANALYTICS_DEV.dbt_melissa_rm_epc.no_uprn_match up
    left join ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid ad on up.ADDRESSID = ad.ADDRESSID
    and up.FULL_POSTCODE = ad.POSTCODE
   
)

SELECT * FROM UPRN
  );
[0m16:05:10.972828 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m16:05:11.140369 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:05:11.142775 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.uprn_match (execute): 16:05:10.122022 => 16:05:11.142603
[0m16:05:11.143109 [debug] [Thread-3 (]: On model.rightmove_epc.uprn_match: Close
[0m16:05:11.329955 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a8e2299d-399b-4539-97b3-21dfb8e559fb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10523ba50>]}
[0m16:05:11.330663 [info ] [Thread-3 (]: 3 of 4 OK created sql view model dbt_melissa_rm_epc.uprn_match ................. [[32mSUCCESS 1[0m in 1.26s]
[0m16:05:11.331200 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.uprn_match
[0m16:05:12.367815 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:05:12.370583 [debug] [Thread-5 (]: Timing info for model.rightmove_epc.uprn_address_match (execute): 16:05:10.967698 => 16:05:12.370371
[0m16:05:12.370964 [debug] [Thread-5 (]: On model.rightmove_epc.uprn_address_match: Close
[0m16:05:12.463081 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a8e2299d-399b-4539-97b3-21dfb8e559fb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1057dad90>]}
[0m16:05:12.463758 [info ] [Thread-5 (]: 4 of 4 OK created sql view model dbt_melissa_rm_epc.uprn_address_match ......... [[32mSUCCESS 1[0m in 1.50s]
[0m16:05:12.464305 [debug] [Thread-5 (]: Finished running node model.rightmove_epc.uprn_address_match
[0m16:05:12.465854 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:05:12.466165 [debug] [MainThread]: Connection 'model.rightmove_epc.address_match' was properly closed.
[0m16:05:12.466410 [debug] [MainThread]: Connection 'model.rightmove_epc.no_uprn_match' was properly closed.
[0m16:05:12.466633 [debug] [MainThread]: Connection 'model.rightmove_epc.uprn_match' was properly closed.
[0m16:05:12.466848 [debug] [MainThread]: Connection 'model.rightmove_epc.uprn_address_match' was properly closed.
[0m16:05:12.467121 [info ] [MainThread]: 
[0m16:05:12.467384 [info ] [MainThread]: Finished running 4 view models in 0 hours 0 minutes and 3.61 seconds (3.61s).
[0m16:05:12.468103 [debug] [MainThread]: Command end result
[0m16:05:12.476974 [info ] [MainThread]: 
[0m16:05:12.477336 [info ] [MainThread]: [32mCompleted successfully[0m
[0m16:05:12.477565 [info ] [MainThread]: 
[0m16:05:12.477802 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m16:05:12.479720 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.8610735, "process_user_time": 1.24258, "process_kernel_time": 0.149517, "process_mem_max_rss": "137134080", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m16:05:12.480159 [debug] [MainThread]: Command `dbt run` succeeded at 16:05:12.480064 after 3.86 seconds
[0m16:05:12.480430 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100a2e090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1008da210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10313d950>]}
[0m16:05:12.480688 [debug] [MainThread]: Flushing usage events
[0m16:05:16.088244 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10910ffd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10911a5d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10911b210>]}


============================== 16:05:16.090413 | 0b9db9b3-4afa-49ab-828d-aeed162c6997 ==============================
[0m16:05:16.090413 [info ] [MainThread]: Running with dbt=1.7.10
[0m16:05:16.090732 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run --select models/bridge', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m16:05:16.225064 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '0b9db9b3-4afa-49ab-828d-aeed162c6997', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109abf190>]}
[0m16:05:16.260766 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '0b9db9b3-4afa-49ab-828d-aeed162c6997', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1090cca50>]}
[0m16:05:16.261388 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m16:05:16.270667 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m16:05:16.290705 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m16:05:16.290979 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m16:05:16.294601 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '0b9db9b3-4afa-49ab-828d-aeed162c6997', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109e09a50>]}
[0m16:05:16.301268 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '0b9db9b3-4afa-49ab-828d-aeed162c6997', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109cca210>]}
[0m16:05:16.301530 [info ] [MainThread]: Found 19 models, 1 analysis, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m16:05:16.301731 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0b9db9b3-4afa-49ab-828d-aeed162c6997', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109be65d0>]}
[0m16:05:16.302880 [info ] [MainThread]: 
[0m16:05:16.303272 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m16:05:16.303916 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m16:05:16.310303 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m16:05:16.310527 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m16:05:16.310671 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:05:16.654275 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 0.0 seconds
[0m16:05:16.656658 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m16:05:16.743056 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m16:05:16.750674 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m16:05:16.751009 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m16:05:16.751280 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:05:17.205393 [debug] [ThreadPool]: SQL status: SUCCESS 20 in 0.0 seconds
[0m16:05:17.209346 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m16:05:17.331255 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '0b9db9b3-4afa-49ab-828d-aeed162c6997', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109c18c50>]}
[0m16:05:17.332274 [info ] [MainThread]: Concurrency: 8 threads (target='dev')
[0m16:05:17.332638 [info ] [MainThread]: 
[0m16:05:17.334827 [debug] [Thread-1 (]: Began running node model.rightmove_epc.dim_addressid
[0m16:05:17.335172 [debug] [Thread-2 (]: Began running node model.rightmove_epc.latest_epc_urn
[0m16:05:17.335518 [debug] [Thread-3 (]: Began running node model.rightmove_epc.latest_rm_urn
[0m16:05:17.335918 [info ] [Thread-1 (]: 1 of 6 START sql view model dbt_melissa_rm_epc.dim_addressid ................... [RUN]
[0m16:05:17.336291 [info ] [Thread-2 (]: 2 of 6 START sql view model dbt_melissa_rm_epc.latest_epc_urn .................. [RUN]
[0m16:05:17.336639 [info ] [Thread-3 (]: 3 of 6 START sql view model dbt_melissa_rm_epc.latest_rm_urn ................... [RUN]
[0m16:05:17.338733 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.dim_addressid)
[0m16:05:17.339339 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.latest_epc_urn'
[0m16:05:17.339848 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.rightmove_epc.latest_rm_urn'
[0m16:05:17.340109 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.dim_addressid
[0m16:05:17.340356 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.latest_epc_urn
[0m16:05:17.340593 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.latest_rm_urn
[0m16:05:17.378689 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.dim_addressid"
[0m16:05:17.380323 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.latest_epc_urn"
[0m16:05:17.381656 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.latest_rm_urn"
[0m16:05:17.382218 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.latest_epc_urn (compile): 16:05:17.378938 => 16:05:17.382088
[0m16:05:17.382459 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.dim_addressid (compile): 16:05:17.340751 => 16:05:17.382340
[0m16:05:17.382631 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.latest_epc_urn
[0m16:05:17.382819 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.latest_rm_urn (compile): 16:05:17.380473 => 16:05:17.382731
[0m16:05:17.383005 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.dim_addressid
[0m16:05:17.396499 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.latest_epc_urn"
[0m16:05:17.396734 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.latest_rm_urn
[0m16:05:17.398328 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.dim_addressid"
[0m16:05:17.399897 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.latest_rm_urn"
[0m16:05:17.400573 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.latest_epc_urn"
[0m16:05:17.401107 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.dim_addressid"
[0m16:05:17.401415 [debug] [Thread-2 (]: On model.rightmove_epc.latest_epc_urn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.latest_epc_urn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn
  
   as (
    with epc_max_date as (

    select uprn as UPRN_EPC,
    MAX(LODGEMENT_DATE) AS MAX_LODGEMENT_DATE,
    from  ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    group by 1


),

latest_epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc
    inner join epc_max_date on epc.uprn = epc_max_date.UPRN_EPC
    where MAX_LODGEMENT_DATE = LODGEMENT_DATE
   -- and uprn = 200073066

)

select DISTINCT * from latest_epc


/*
select uprn, count(*) from latest_epc
group by 1
having count(*) >1
*/
  );
[0m16:05:17.401872 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.latest_rm_urn"
[0m16:05:17.402073 [debug] [Thread-1 (]: On model.rightmove_epc.dim_addressid: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_addressid"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE ADDRESS'

with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource,
    POSTCODE
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs 
    where REMOVE_FROM_RM_MATCH = 0
    AND ADDRESSID IS NOT NULL

),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    WHERE ADDRESSID IS NOT NULL

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where addressid is not null
  );
[0m16:05:17.402271 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m16:05:17.402453 [debug] [Thread-3 (]: On model.rightmove_epc.latest_rm_urn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.latest_rm_urn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NOT NULL
),

change_date AS (
    SELECT 
        UPRN AS UPRN_CD, 
        MAX(CHANGE_DATE) AS MAX_CHANGE_DATE 
    FROM rm
    GROUP BY UPRN
),

rm_latest as (

    SELECT distinct * FROM rm
    LEFT JOIN change_date cd
    ON rm.UPRN = cd.UPRN_CD
    WHERE cd.MAX_CHANGE_DATE = rm.CHANGE_DATE 
 --  and UPRN = 100090588560
    
)

select DISTINCT * from rm_latest

/*
select uprn, count(*) from rm_latest
group by 1
having count(*) >1
*/
  );
[0m16:05:17.402634 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:05:17.403111 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m16:05:17.999496 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:05:18.000501 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:05:18.021240 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.latest_rm_urn (execute): 16:05:17.398508 => 16:05:18.021057
[0m16:05:18.021803 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:05:18.023602 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.latest_epc_urn (execute): 16:05:17.383120 => 16:05:18.023460
[0m16:05:18.023912 [debug] [Thread-3 (]: On model.rightmove_epc.latest_rm_urn: Close
[0m16:05:18.025647 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.dim_addressid (execute): 16:05:17.396867 => 16:05:18.025509
[0m16:05:18.025918 [debug] [Thread-2 (]: On model.rightmove_epc.latest_epc_urn: Close
[0m16:05:18.026870 [debug] [Thread-1 (]: On model.rightmove_epc.dim_addressid: Close
[0m16:05:18.169375 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0b9db9b3-4afa-49ab-828d-aeed162c6997', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a06b950>]}
[0m16:05:18.170067 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0b9db9b3-4afa-49ab-828d-aeed162c6997', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a068bd0>]}
[0m16:05:18.170660 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0b9db9b3-4afa-49ab-828d-aeed162c6997', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109c18c50>]}
[0m16:05:18.171176 [info ] [Thread-2 (]: 2 of 6 OK created sql view model dbt_melissa_rm_epc.latest_epc_urn ............. [[32mSUCCESS 1[0m in 0.83s]
[0m16:05:18.171575 [info ] [Thread-1 (]: 1 of 6 OK created sql view model dbt_melissa_rm_epc.dim_addressid .............. [[32mSUCCESS 1[0m in 0.83s]
[0m16:05:18.172007 [info ] [Thread-3 (]: 3 of 6 OK created sql view model dbt_melissa_rm_epc.latest_rm_urn .............. [[32mSUCCESS 1[0m in 0.83s]
[0m16:05:18.172446 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.latest_epc_urn
[0m16:05:18.172802 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.dim_addressid
[0m16:05:18.173137 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.latest_rm_urn
[0m16:05:18.173618 [debug] [Thread-1 (]: Began running node model.rightmove_epc.epc_flats_count
[0m16:05:18.174083 [debug] [Thread-6 (]: Began running node model.rightmove_epc.rm_listings_count
[0m16:05:18.174368 [info ] [Thread-1 (]: 4 of 6 START sql view model dbt_melissa_rm_epc.epc_flats_count ................. [RUN]
[0m16:05:18.174705 [info ] [Thread-6 (]: 5 of 6 START sql view model dbt_melissa_rm_epc.rm_listings_count ............... [RUN]
[0m16:05:18.175190 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.dim_addressid, now model.rightmove_epc.epc_flats_count)
[0m16:05:18.175676 [debug] [Thread-6 (]: Acquiring new snowflake connection 'model.rightmove_epc.rm_listings_count'
[0m16:05:18.175937 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.epc_flats_count
[0m16:05:18.176176 [debug] [Thread-6 (]: Began compiling node model.rightmove_epc.rm_listings_count
[0m16:05:18.178341 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.epc_flats_count"
[0m16:05:18.180570 [debug] [Thread-6 (]: Writing injected SQL for node "model.rightmove_epc.rm_listings_count"
[0m16:05:18.181303 [debug] [Thread-6 (]: Timing info for model.rightmove_epc.rm_listings_count (compile): 16:05:18.178600 => 16:05:18.181124
[0m16:05:18.181629 [debug] [Thread-6 (]: Began executing node model.rightmove_epc.rm_listings_count
[0m16:05:18.181967 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.epc_flats_count (compile): 16:05:18.176346 => 16:05:18.181821
[0m16:05:18.185370 [debug] [Thread-6 (]: Writing runtime sql for node "model.rightmove_epc.rm_listings_count"
[0m16:05:18.185683 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.epc_flats_count
[0m16:05:18.187700 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.epc_flats_count"
[0m16:05:18.188317 [debug] [Thread-6 (]: Using snowflake connection "model.rightmove_epc.rm_listings_count"
[0m16:05:18.188781 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.epc_flats_count"
[0m16:05:18.189040 [debug] [Thread-6 (]: On model.rightmove_epc.rm_listings_count: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.rm_listings_count"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.rm_listings_count
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn

),

false_rm as (

    select 
    uprn,
    count(LISTING_ID) listing_count
    from rm
    group by 1
   -- having count(LISTING_ID) >1

)

select * from false_rm
  );
[0m16:05:18.189299 [debug] [Thread-1 (]: On model.rightmove_epc.epc_flats_count: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.epc_flats_count"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.epc_flats_count
  
   as (
    with epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn

),

flat_epc as (

    select uprn,
    count(BUILDING_REFERENCE_NUMBER) as building_ref_count
    from epc
    group by 1
    having count(BUILDING_REFERENCE_NUMBER) >1

)

select * from flat_epc
  );
[0m16:05:18.189527 [debug] [Thread-6 (]: Opening a new connection, currently in state init
[0m16:05:18.189726 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:05:18.887352 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:05:18.889155 [debug] [Thread-6 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:05:18.892411 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.epc_flats_count (execute): 16:05:18.185898 => 16:05:18.892190
[0m16:05:18.894811 [debug] [Thread-6 (]: Timing info for model.rightmove_epc.rm_listings_count (execute): 16:05:18.182095 => 16:05:18.894624
[0m16:05:18.895234 [debug] [Thread-1 (]: On model.rightmove_epc.epc_flats_count: Close
[0m16:05:18.895591 [debug] [Thread-6 (]: On model.rightmove_epc.rm_listings_count: Close
[0m16:05:18.990031 [debug] [Thread-6 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0b9db9b3-4afa-49ab-828d-aeed162c6997', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ae1c7d0>]}
[0m16:05:18.991486 [info ] [Thread-6 (]: 5 of 6 OK created sql view model dbt_melissa_rm_epc.rm_listings_count .......... [[32mSUCCESS 1[0m in 0.81s]
[0m16:05:18.992464 [debug] [Thread-6 (]: Finished running node model.rightmove_epc.rm_listings_count
[0m16:05:18.994256 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0b9db9b3-4afa-49ab-828d-aeed162c6997', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a068bd0>]}
[0m16:05:18.994978 [info ] [Thread-1 (]: 4 of 6 OK created sql view model dbt_melissa_rm_epc.epc_flats_count ............ [[32mSUCCESS 1[0m in 0.82s]
[0m16:05:18.995522 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.epc_flats_count
[0m16:05:18.996350 [debug] [Thread-8 (]: Began running node model.rightmove_epc.dim_uprn
[0m16:05:18.996870 [info ] [Thread-8 (]: 6 of 6 START sql view model dbt_melissa_rm_epc.dim_uprn ........................ [RUN]
[0m16:05:18.997607 [debug] [Thread-8 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_uprn'
[0m16:05:18.997952 [debug] [Thread-8 (]: Began compiling node model.rightmove_epc.dim_uprn
[0m16:05:19.001730 [debug] [Thread-8 (]: Writing injected SQL for node "model.rightmove_epc.dim_uprn"
[0m16:05:19.002451 [debug] [Thread-8 (]: Timing info for model.rightmove_epc.dim_uprn (compile): 16:05:18.998165 => 16:05:19.002276
[0m16:05:19.002752 [debug] [Thread-8 (]: Began executing node model.rightmove_epc.dim_uprn
[0m16:05:19.005564 [debug] [Thread-8 (]: Writing runtime sql for node "model.rightmove_epc.dim_uprn"
[0m16:05:19.007249 [debug] [Thread-8 (]: Using snowflake connection "model.rightmove_epc.dim_uprn"
[0m16:05:19.007787 [debug] [Thread-8 (]: On model.rightmove_epc.dim_uprn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_uprn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE UPRNS


with epc as (

    select distinct
    epc.uprn,
    epc.addressid,
    epc.ADDRESS,
    'EPC' AS datasource,
    epc.POSTCODE,
    case when multi.uprn is null then NULL else 1 end as multi_uprn

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc
    left join ANALYTICS_DEV.dbt_melissa_rm_epc.epc_flats_count multi on epc.uprn = multi.uprn

    where epc.REMOVE_FROM_RM_MATCH = 0
    AND epc.UPRN IS NOT NULL
),

rightmove as (

 select distinct
    rm.uprn,
    rm.addressid,
    concat(rm.ADDRESS_1,',',rm.ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    rm.FULL_POSTCODE AS POSTCODE
    multi.uprn as LISTING_COUNT

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove rm
    left join ANALYTICS_DEV.dbt_melissa_rm_epc.rm_listings_count multi on rm.uprn = multi.uprn
    WHERE rm.UPRN IS NOT NULL


),

final as (

    select * from epc
    union all
    select * from rightmove
)

select distinct * from final
  );
[0m16:05:19.008155 [debug] [Thread-8 (]: Opening a new connection, currently in state init
[0m16:05:19.369331 [debug] [Thread-8 (]: Snowflake adapter: Snowflake query id: 01b34565-0103-9bb0-0000-71950637b03a
[0m16:05:19.369884 [debug] [Thread-8 (]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 32 at position 4 unexpected 'multi'.
syntax error line 39 at position 1 unexpected ','.
[0m16:05:19.370528 [debug] [Thread-8 (]: Timing info for model.rightmove_epc.dim_uprn (execute): 16:05:19.002933 => 16:05:19.370293
[0m16:05:19.370961 [debug] [Thread-8 (]: On model.rightmove_epc.dim_uprn: Close
[0m16:05:19.490745 [debug] [Thread-8 (]: Database Error in model dim_uprn (models/bridge/dim_uprn.sql)
  001003 (42000): SQL compilation error:
  syntax error line 32 at position 4 unexpected 'multi'.
  syntax error line 39 at position 1 unexpected ','.
  compiled Code at target/run/rightmove_epc/models/bridge/dim_uprn.sql
[0m16:05:19.491151 [debug] [Thread-8 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '0b9db9b3-4afa-49ab-828d-aeed162c6997', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a064c50>]}
[0m16:05:19.491518 [error] [Thread-8 (]: 6 of 6 ERROR creating sql view model dbt_melissa_rm_epc.dim_uprn ............... [[31mERROR[0m in 0.49s]
[0m16:05:19.491863 [debug] [Thread-8 (]: Finished running node model.rightmove_epc.dim_uprn
[0m16:05:19.493028 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:05:19.493217 [debug] [MainThread]: Connection 'model.rightmove_epc.epc_flats_count' was properly closed.
[0m16:05:19.493375 [debug] [MainThread]: Connection 'model.rightmove_epc.latest_epc_urn' was properly closed.
[0m16:05:19.493524 [debug] [MainThread]: Connection 'model.rightmove_epc.latest_rm_urn' was properly closed.
[0m16:05:19.493669 [debug] [MainThread]: Connection 'model.rightmove_epc.rm_listings_count' was properly closed.
[0m16:05:19.493813 [debug] [MainThread]: Connection 'model.rightmove_epc.dim_uprn' was properly closed.
[0m16:05:19.494019 [info ] [MainThread]: 
[0m16:05:19.494204 [info ] [MainThread]: Finished running 6 view models in 0 hours 0 minutes and 3.19 seconds (3.19s).
[0m16:05:19.494841 [debug] [MainThread]: Command end result
[0m16:05:19.500384 [info ] [MainThread]: 
[0m16:05:19.500671 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m16:05:19.500849 [info ] [MainThread]: 
[0m16:05:19.501029 [error] [MainThread]:   Database Error in model dim_uprn (models/bridge/dim_uprn.sql)
  001003 (42000): SQL compilation error:
  syntax error line 32 at position 4 unexpected 'multi'.
  syntax error line 39 at position 1 unexpected ','.
  compiled Code at target/run/rightmove_epc/models/bridge/dim_uprn.sql
[0m16:05:19.501213 [info ] [MainThread]: 
[0m16:05:19.501397 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=0 TOTAL=6
[0m16:05:19.502469 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 3.4401357, "process_user_time": 1.347584, "process_kernel_time": 0.156355, "process_mem_max_rss": "137117696", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m16:05:19.502910 [debug] [MainThread]: Command `dbt run` failed at 16:05:19.502770 after 3.44 seconds
[0m16:05:19.503228 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1053be0d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105282b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105282310>]}
[0m16:05:19.503472 [debug] [MainThread]: Flushing usage events
[0m16:06:03.846937 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107b18e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107b5ead0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107b5f610>]}


============================== 16:06:03.849966 | 911c44f8-0140-43c2-98f5-2e2719131ddd ==============================
[0m16:06:03.849966 [info ] [MainThread]: Running with dbt=1.7.10
[0m16:06:03.850347 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'debug': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --select models/bridge', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m16:06:04.024483 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '911c44f8-0140-43c2-98f5-2e2719131ddd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108607110>]}
[0m16:06:04.062881 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '911c44f8-0140-43c2-98f5-2e2719131ddd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10849cc50>]}
[0m16:06:04.063935 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m16:06:04.073953 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m16:06:04.091853 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m16:06:04.092108 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m16:06:04.095343 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '911c44f8-0140-43c2-98f5-2e2719131ddd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1086ab890>]}
[0m16:06:04.102984 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '911c44f8-0140-43c2-98f5-2e2719131ddd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10872bfd0>]}
[0m16:06:04.103312 [info ] [MainThread]: Found 19 models, 1 analysis, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m16:06:04.103517 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '911c44f8-0140-43c2-98f5-2e2719131ddd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108602190>]}
[0m16:06:04.104665 [info ] [MainThread]: 
[0m16:06:04.105116 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m16:06:04.105805 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m16:06:04.112871 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m16:06:04.113171 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m16:06:04.113332 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:06:04.645916 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 1.0 seconds
[0m16:06:04.648094 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m16:06:04.823851 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m16:06:04.828675 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m16:06:04.828937 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m16:06:04.829113 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:06:05.321991 [debug] [ThreadPool]: SQL status: SUCCESS 20 in 0.0 seconds
[0m16:06:05.324413 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m16:06:05.415695 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '911c44f8-0140-43c2-98f5-2e2719131ddd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1086e3810>]}
[0m16:06:05.416871 [info ] [MainThread]: Concurrency: 8 threads (target='dev')
[0m16:06:05.417329 [info ] [MainThread]: 
[0m16:06:05.421295 [debug] [Thread-1 (]: Began running node model.rightmove_epc.dim_addressid
[0m16:06:05.421712 [debug] [Thread-2 (]: Began running node model.rightmove_epc.latest_epc_urn
[0m16:06:05.422102 [debug] [Thread-3 (]: Began running node model.rightmove_epc.latest_rm_urn
[0m16:06:05.422565 [info ] [Thread-1 (]: 1 of 6 START sql view model dbt_melissa_rm_epc.dim_addressid ................... [RUN]
[0m16:06:05.423134 [info ] [Thread-2 (]: 2 of 6 START sql view model dbt_melissa_rm_epc.latest_epc_urn .................. [RUN]
[0m16:06:05.423658 [info ] [Thread-3 (]: 3 of 6 START sql view model dbt_melissa_rm_epc.latest_rm_urn ................... [RUN]
[0m16:06:05.426261 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.dim_addressid)
[0m16:06:05.427168 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.latest_epc_urn'
[0m16:06:05.427932 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.rightmove_epc.latest_rm_urn'
[0m16:06:05.428374 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.dim_addressid
[0m16:06:05.428870 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.latest_epc_urn
[0m16:06:05.429256 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.latest_rm_urn
[0m16:06:05.469041 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.dim_addressid"
[0m16:06:05.470754 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.latest_epc_urn"
[0m16:06:05.472195 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.latest_rm_urn"
[0m16:06:05.472754 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.latest_epc_urn (compile): 16:06:05.469272 => 16:06:05.472639
[0m16:06:05.472977 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.latest_epc_urn
[0m16:06:05.478644 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.latest_rm_urn (compile): 16:06:05.470910 => 16:06:05.478517
[0m16:06:05.478914 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.dim_addressid (compile): 16:06:05.429484 => 16:06:05.478780
[0m16:06:05.479095 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.latest_rm_urn
[0m16:06:05.487369 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.latest_epc_urn"
[0m16:06:05.487605 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.dim_addressid
[0m16:06:05.489154 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.latest_rm_urn"
[0m16:06:05.490734 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.dim_addressid"
[0m16:06:05.491539 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.latest_rm_urn"
[0m16:06:05.492008 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.latest_epc_urn"
[0m16:06:05.492625 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.dim_addressid"
[0m16:06:05.492811 [debug] [Thread-3 (]: On model.rightmove_epc.latest_rm_urn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.latest_rm_urn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NOT NULL
),

change_date AS (
    SELECT 
        UPRN AS UPRN_CD, 
        MAX(CHANGE_DATE) AS MAX_CHANGE_DATE 
    FROM rm
    GROUP BY UPRN
),

rm_latest as (

    SELECT distinct * FROM rm
    LEFT JOIN change_date cd
    ON rm.UPRN = cd.UPRN_CD
    WHERE cd.MAX_CHANGE_DATE = rm.CHANGE_DATE 
 --  and UPRN = 100090588560
    
)

select DISTINCT * from rm_latest

/*
select uprn, count(*) from rm_latest
group by 1
having count(*) >1
*/
  );
[0m16:06:05.493036 [debug] [Thread-2 (]: On model.rightmove_epc.latest_epc_urn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.latest_epc_urn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn
  
   as (
    with epc_max_date as (

    select uprn as UPRN_EPC,
    MAX(LODGEMENT_DATE) AS MAX_LODGEMENT_DATE,
    from  ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    group by 1


),

latest_epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc
    inner join epc_max_date on epc.uprn = epc_max_date.UPRN_EPC
    where MAX_LODGEMENT_DATE = LODGEMENT_DATE
   -- and uprn = 200073066

)

select DISTINCT * from latest_epc


/*
select uprn, count(*) from latest_epc
group by 1
having count(*) >1
*/
  );
[0m16:06:05.493257 [debug] [Thread-1 (]: On model.rightmove_epc.dim_addressid: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_addressid"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE ADDRESS'

with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource,
    POSTCODE
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs 
    where REMOVE_FROM_RM_MATCH = 0
    AND ADDRESSID IS NOT NULL

),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    WHERE ADDRESSID IS NOT NULL

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where addressid is not null
  );
[0m16:06:05.493451 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m16:06:05.493606 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m16:06:05.493755 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:06:05.977158 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m16:06:05.995336 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.latest_epc_urn (execute): 16:06:05.473085 => 16:06:05.995171
[0m16:06:05.995683 [debug] [Thread-2 (]: On model.rightmove_epc.latest_epc_urn: Close
[0m16:06:06.011720 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:06:06.013617 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.dim_addressid (execute): 16:06:05.489336 => 16:06:06.013475
[0m16:06:06.013889 [debug] [Thread-1 (]: On model.rightmove_epc.dim_addressid: Close
[0m16:06:06.078755 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '911c44f8-0140-43c2-98f5-2e2719131ddd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108987e10>]}
[0m16:06:06.079361 [info ] [Thread-2 (]: 2 of 6 OK created sql view model dbt_melissa_rm_epc.latest_epc_urn ............. [[32mSUCCESS 1[0m in 0.65s]
[0m16:06:06.079787 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.latest_epc_urn
[0m16:06:06.080253 [debug] [Thread-5 (]: Began running node model.rightmove_epc.epc_flats_count
[0m16:06:06.080619 [info ] [Thread-5 (]: 4 of 6 START sql view model dbt_melissa_rm_epc.epc_flats_count ................. [RUN]
[0m16:06:06.081190 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.rightmove_epc.epc_flats_count'
[0m16:06:06.081489 [debug] [Thread-5 (]: Began compiling node model.rightmove_epc.epc_flats_count
[0m16:06:06.083831 [debug] [Thread-5 (]: Writing injected SQL for node "model.rightmove_epc.epc_flats_count"
[0m16:06:06.084464 [debug] [Thread-5 (]: Timing info for model.rightmove_epc.epc_flats_count (compile): 16:06:06.081647 => 16:06:06.084315
[0m16:06:06.084710 [debug] [Thread-5 (]: Began executing node model.rightmove_epc.epc_flats_count
[0m16:06:06.086915 [debug] [Thread-5 (]: Writing runtime sql for node "model.rightmove_epc.epc_flats_count"
[0m16:06:06.087687 [debug] [Thread-5 (]: Using snowflake connection "model.rightmove_epc.epc_flats_count"
[0m16:06:06.087949 [debug] [Thread-5 (]: On model.rightmove_epc.epc_flats_count: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.epc_flats_count"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.epc_flats_count
  
   as (
    with epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn

),

flat_epc as (

    select uprn,
    count(BUILDING_REFERENCE_NUMBER) as building_ref_count
    from epc
    group by 1
    having count(BUILDING_REFERENCE_NUMBER) >1

)

select * from flat_epc
  );
[0m16:06:06.088186 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m16:06:06.097838 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '911c44f8-0140-43c2-98f5-2e2719131ddd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1087e2210>]}
[0m16:06:06.098267 [info ] [Thread-1 (]: 1 of 6 OK created sql view model dbt_melissa_rm_epc.dim_addressid .............. [[32mSUCCESS 1[0m in 0.67s]
[0m16:06:06.098640 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.dim_addressid
[0m16:06:06.485612 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:06:06.488328 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.latest_rm_urn (execute): 16:06:05.487723 => 16:06:06.488129
[0m16:06:06.488719 [debug] [Thread-3 (]: On model.rightmove_epc.latest_rm_urn: Close
[0m16:06:06.590566 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '911c44f8-0140-43c2-98f5-2e2719131ddd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1085b3f90>]}
[0m16:06:06.591277 [info ] [Thread-3 (]: 3 of 6 OK created sql view model dbt_melissa_rm_epc.latest_rm_urn .............. [[32mSUCCESS 1[0m in 1.16s]
[0m16:06:06.591812 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.latest_rm_urn
[0m16:06:06.592304 [debug] [Thread-7 (]: Began running node model.rightmove_epc.rm_listings_count
[0m16:06:06.592669 [info ] [Thread-7 (]: 5 of 6 START sql view model dbt_melissa_rm_epc.rm_listings_count ............... [RUN]
[0m16:06:06.593273 [debug] [Thread-7 (]: Acquiring new snowflake connection 'model.rightmove_epc.rm_listings_count'
[0m16:06:06.593578 [debug] [Thread-7 (]: Began compiling node model.rightmove_epc.rm_listings_count
[0m16:06:06.597601 [debug] [Thread-7 (]: Writing injected SQL for node "model.rightmove_epc.rm_listings_count"
[0m16:06:06.598323 [debug] [Thread-7 (]: Timing info for model.rightmove_epc.rm_listings_count (compile): 16:06:06.593776 => 16:06:06.598143
[0m16:06:06.598630 [debug] [Thread-7 (]: Began executing node model.rightmove_epc.rm_listings_count
[0m16:06:06.601219 [debug] [Thread-7 (]: Writing runtime sql for node "model.rightmove_epc.rm_listings_count"
[0m16:06:06.602124 [debug] [Thread-7 (]: Using snowflake connection "model.rightmove_epc.rm_listings_count"
[0m16:06:06.602424 [debug] [Thread-7 (]: On model.rightmove_epc.rm_listings_count: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.rm_listings_count"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.rm_listings_count
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn

),

false_rm as (

    select 
    uprn,
    count(LISTING_ID) listing_count
    from rm
    group by 1
   -- having count(LISTING_ID) >1

)

select * from false_rm
  );
[0m16:06:06.602689 [debug] [Thread-7 (]: Opening a new connection, currently in state init
[0m16:06:06.649696 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:06:06.651534 [debug] [Thread-5 (]: Timing info for model.rightmove_epc.epc_flats_count (execute): 16:06:06.084852 => 16:06:06.651395
[0m16:06:06.651794 [debug] [Thread-5 (]: On model.rightmove_epc.epc_flats_count: Close
[0m16:06:06.746852 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '911c44f8-0140-43c2-98f5-2e2719131ddd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1089af550>]}
[0m16:06:06.747488 [info ] [Thread-5 (]: 4 of 6 OK created sql view model dbt_melissa_rm_epc.epc_flats_count ............ [[32mSUCCESS 1[0m in 0.67s]
[0m16:06:06.747948 [debug] [Thread-5 (]: Finished running node model.rightmove_epc.epc_flats_count
[0m16:06:07.371742 [debug] [Thread-7 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:06:07.375463 [debug] [Thread-7 (]: Timing info for model.rightmove_epc.rm_listings_count (execute): 16:06:06.598806 => 16:06:07.375229
[0m16:06:07.375919 [debug] [Thread-7 (]: On model.rightmove_epc.rm_listings_count: Close
[0m16:06:08.617369 [debug] [Thread-7 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '911c44f8-0140-43c2-98f5-2e2719131ddd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1089ad350>]}
[0m16:06:08.618423 [info ] [Thread-7 (]: 5 of 6 OK created sql view model dbt_melissa_rm_epc.rm_listings_count .......... [[32mSUCCESS 1[0m in 2.02s]
[0m16:06:08.619195 [debug] [Thread-7 (]: Finished running node model.rightmove_epc.rm_listings_count
[0m16:06:08.620196 [debug] [Thread-4 (]: Began running node model.rightmove_epc.dim_uprn
[0m16:06:08.620928 [info ] [Thread-4 (]: 6 of 6 START sql view model dbt_melissa_rm_epc.dim_uprn ........................ [RUN]
[0m16:06:08.621919 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_uprn'
[0m16:06:08.622311 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.dim_uprn
[0m16:06:08.626804 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.dim_uprn"
[0m16:06:08.628678 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_uprn (compile): 16:06:08.622550 => 16:06:08.628465
[0m16:06:08.629027 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.dim_uprn
[0m16:06:08.632346 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.dim_uprn"
[0m16:06:08.634073 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.dim_uprn"
[0m16:06:08.634471 [debug] [Thread-4 (]: On model.rightmove_epc.dim_uprn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_uprn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE UPRNS


with epc as (

    select distinct
    epc.uprn,
    epc.addressid,
    epc.ADDRESS,
    'EPC' AS datasource,
    epc.POSTCODE,
    multi.uprn as LISTING_COUNT

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc
    left join ANALYTICS_DEV.dbt_melissa_rm_epc.epc_flats_count multi on epc.uprn = multi.uprn

    where epc.REMOVE_FROM_RM_MATCH = 0
    AND epc.UPRN IS NOT NULL
),

rightmove as (

 select distinct
    rm.uprn,
    rm.addressid,
    concat(rm.ADDRESS_1,',',rm.ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    rm.FULL_POSTCODE AS POSTCODE
    multi.uprn as LISTING_COUNT

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove rm
    left join ANALYTICS_DEV.dbt_melissa_rm_epc.rm_listings_count multi on rm.uprn = multi.uprn
    WHERE rm.UPRN IS NOT NULL


),

final as (

    select * from epc
    union all
    select * from rightmove
)

select distinct * from final
  );
[0m16:06:08.634809 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m16:06:08.950283 [debug] [Thread-4 (]: Snowflake adapter: Snowflake query id: 01b34566-0103-9bb0-0000-71950637b03e
[0m16:06:08.950888 [debug] [Thread-4 (]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 32 at position 4 unexpected 'multi'.
syntax error line 39 at position 1 unexpected ','.
[0m16:06:08.951540 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.dim_uprn (execute): 16:06:08.629232 => 16:06:08.951312
[0m16:06:08.951974 [debug] [Thread-4 (]: On model.rightmove_epc.dim_uprn: Close
[0m16:06:09.062402 [debug] [Thread-4 (]: Database Error in model dim_uprn (models/bridge/dim_uprn.sql)
  001003 (42000): SQL compilation error:
  syntax error line 32 at position 4 unexpected 'multi'.
  syntax error line 39 at position 1 unexpected ','.
  compiled Code at target/run/rightmove_epc/models/bridge/dim_uprn.sql
[0m16:06:09.063136 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '911c44f8-0140-43c2-98f5-2e2719131ddd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10871b7d0>]}
[0m16:06:09.063834 [error] [Thread-4 (]: 6 of 6 ERROR creating sql view model dbt_melissa_rm_epc.dim_uprn ............... [[31mERROR[0m in 0.44s]
[0m16:06:09.064488 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.dim_uprn
[0m16:06:09.066915 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:06:09.067283 [debug] [MainThread]: Connection 'model.rightmove_epc.dim_addressid' was properly closed.
[0m16:06:09.067569 [debug] [MainThread]: Connection 'model.rightmove_epc.latest_epc_urn' was properly closed.
[0m16:06:09.067828 [debug] [MainThread]: Connection 'model.rightmove_epc.latest_rm_urn' was properly closed.
[0m16:06:09.068086 [debug] [MainThread]: Connection 'model.rightmove_epc.epc_flats_count' was properly closed.
[0m16:06:09.068337 [debug] [MainThread]: Connection 'model.rightmove_epc.rm_listings_count' was properly closed.
[0m16:06:09.068582 [debug] [MainThread]: Connection 'model.rightmove_epc.dim_uprn' was properly closed.
[0m16:06:09.068934 [info ] [MainThread]: 
[0m16:06:09.069255 [info ] [MainThread]: Finished running 6 view models in 0 hours 0 minutes and 4.96 seconds (4.96s).
[0m16:06:09.070290 [debug] [MainThread]: Command end result
[0m16:06:09.078908 [info ] [MainThread]: 
[0m16:06:09.079320 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m16:06:09.079574 [info ] [MainThread]: 
[0m16:06:09.079847 [error] [MainThread]:   Database Error in model dim_uprn (models/bridge/dim_uprn.sql)
  001003 (42000): SQL compilation error:
  syntax error line 32 at position 4 unexpected 'multi'.
  syntax error line 39 at position 1 unexpected ','.
  compiled Code at target/run/rightmove_epc/models/bridge/dim_uprn.sql
[0m16:06:09.080119 [info ] [MainThread]: 
[0m16:06:09.080375 [info ] [MainThread]: Done. PASS=5 WARN=0 ERROR=1 SKIP=0 TOTAL=6
[0m16:06:09.081918 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 5.2619834, "process_user_time": 1.381435, "process_kernel_time": 0.179127, "process_mem_max_rss": "138854400", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m16:06:09.082405 [debug] [MainThread]: Command `dbt run` failed at 16:06:09.082276 after 5.26 seconds
[0m16:06:09.082733 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1028d2b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1073f1ad0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108993490>]}
[0m16:06:09.083020 [debug] [MainThread]: Flushing usage events
[0m16:10:15.439129 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107b19e90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107b5dc10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107b5edd0>]}


============================== 16:10:15.442139 | 7ca18230-2337-4e23-b6f9-81bdec22af15 ==============================
[0m16:10:15.442139 [info ] [MainThread]: Running with dbt=1.7.10
[0m16:10:15.442479 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'debug': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run --select models/bridge', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m16:10:15.607274 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7ca18230-2337-4e23-b6f9-81bdec22af15', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11057d250>]}
[0m16:10:15.642361 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7ca18230-2337-4e23-b6f9-81bdec22af15', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1102cad50>]}
[0m16:10:15.644039 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m16:10:15.652896 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m16:10:15.669305 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m16:10:15.669556 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m16:10:15.672891 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7ca18230-2337-4e23-b6f9-81bdec22af15', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11029c810>]}
[0m16:10:15.679503 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7ca18230-2337-4e23-b6f9-81bdec22af15', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1105c9ed0>]}
[0m16:10:15.679758 [info ] [MainThread]: Found 19 models, 1 analysis, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m16:10:15.679948 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7ca18230-2337-4e23-b6f9-81bdec22af15', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1105fc090>]}
[0m16:10:15.681019 [info ] [MainThread]: 
[0m16:10:15.681404 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m16:10:15.682008 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m16:10:15.688303 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m16:10:15.688527 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m16:10:15.688673 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:10:16.088329 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 0.0 seconds
[0m16:10:16.090465 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m16:10:16.227109 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m16:10:16.235500 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m16:10:16.235886 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m16:10:16.236168 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:10:16.581725 [debug] [ThreadPool]: SQL status: SUCCESS 20 in 0.0 seconds
[0m16:10:16.583800 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m16:10:16.670200 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7ca18230-2337-4e23-b6f9-81bdec22af15', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107b94390>]}
[0m16:10:16.670973 [info ] [MainThread]: Concurrency: 8 threads (target='dev')
[0m16:10:16.671261 [info ] [MainThread]: 
[0m16:10:16.674452 [debug] [Thread-1 (]: Began running node model.rightmove_epc.dim_addressid
[0m16:10:16.674806 [debug] [Thread-2 (]: Began running node model.rightmove_epc.dim_uprn
[0m16:10:16.675125 [debug] [Thread-3 (]: Began running node model.rightmove_epc.latest_epc_urn
[0m16:10:16.676679 [debug] [Thread-4 (]: Began running node model.rightmove_epc.latest_rm_urn
[0m16:10:16.675487 [info ] [Thread-1 (]: 1 of 6 START sql view model dbt_melissa_rm_epc.dim_addressid ................... [RUN]
[0m16:10:16.677375 [info ] [Thread-2 (]: 2 of 6 START sql view model dbt_melissa_rm_epc.dim_uprn ........................ [RUN]
[0m16:10:16.677711 [info ] [Thread-3 (]: 3 of 6 START sql view model dbt_melissa_rm_epc.latest_epc_urn .................. [RUN]
[0m16:10:16.678117 [info ] [Thread-4 (]: 4 of 6 START sql view model dbt_melissa_rm_epc.latest_rm_urn ................... [RUN]
[0m16:10:16.678714 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.dim_addressid)
[0m16:10:16.679230 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_uprn'
[0m16:10:16.679738 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.rightmove_epc.latest_epc_urn'
[0m16:10:16.680209 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.rightmove_epc.latest_rm_urn'
[0m16:10:16.680472 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.dim_addressid
[0m16:10:16.680725 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.dim_uprn
[0m16:10:16.680957 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.latest_epc_urn
[0m16:10:16.681190 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.latest_rm_urn
[0m16:10:16.730991 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.dim_addressid"
[0m16:10:16.732193 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.dim_uprn"
[0m16:10:16.733794 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.latest_epc_urn"
[0m16:10:16.735249 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.latest_rm_urn"
[0m16:10:16.736232 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.dim_uprn (compile): 16:10:16.731269 => 16:10:16.736029
[0m16:10:16.736545 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.dim_addressid (compile): 16:10:16.681348 => 16:10:16.736408
[0m16:10:16.736738 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.dim_uprn
[0m16:10:16.737003 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.dim_addressid
[0m16:10:16.737253 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.latest_epc_urn (compile): 16:10:16.732369 => 16:10:16.737132
[0m16:10:16.737480 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.latest_rm_urn (compile): 16:10:16.733979 => 16:10:16.737383
[0m16:10:16.752229 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.dim_uprn"
[0m16:10:16.754273 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.dim_addressid"
[0m16:10:16.754579 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.latest_epc_urn
[0m16:10:16.754802 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.latest_rm_urn
[0m16:10:16.756560 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.latest_epc_urn"
[0m16:10:16.758070 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.latest_rm_urn"
[0m16:10:16.758810 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.dim_addressid"
[0m16:10:16.759525 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.dim_uprn"
[0m16:10:16.759745 [debug] [Thread-1 (]: On model.rightmove_epc.dim_addressid: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_addressid"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE ADDRESS'

with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource,
    POSTCODE
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs 
    where REMOVE_FROM_RM_MATCH = 0
    AND ADDRESSID IS NOT NULL

),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    WHERE ADDRESSID IS NOT NULL

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where addressid is not null
  );
[0m16:10:16.760262 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.latest_epc_urn"
[0m16:10:16.760468 [debug] [Thread-2 (]: On model.rightmove_epc.dim_uprn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_uprn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE UPRNS


with epc as (

   select distinct
    epc.uprn,
    epc.addressid,
    epc.ADDRESS,
    'EPC' AS datasource,
    epc.POSTCODE,
    case when multi.uprn is null then NULL else 1 end as MULTI_UPRN

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc
    left join ANALYTICS_DEV.dbt_melissa_rm_epc.epc_flats_count multi on epc.uprn = multi.uprn

    where epc.REMOVE_FROM_RM_MATCH = 0
    AND epc.UPRN IS NOT NULL
    
),

rightmove as (

 select distinct
    rm.uprn,
    rm.addressid,
    concat(rm.ADDRESS_1,',',rm.ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    rm.FULL_POSTCODE AS POSTCODE,
    multi.LISTING_COUNT AS MULTI_UPRN

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove rm
    left join ANALYTICS_DEV.dbt_melissa_rm_epc.false_listings_count multi on rm.uprn = multi.uprn
    WHERE rm.UPRN IS NOT NULL


),

final as (

    select * from epc
    union all
    select * from rightmove
)

select distinct * from final
  );
[0m16:10:16.760932 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.latest_rm_urn"
[0m16:10:16.761121 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:10:16.761320 [debug] [Thread-3 (]: On model.rightmove_epc.latest_epc_urn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.latest_epc_urn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn
  
   as (
    with epc_max_date as (

    select uprn as UPRN_EPC,
    MAX(LODGEMENT_DATE) AS MAX_LODGEMENT_DATE,
    from  ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    group by 1


),

latest_epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc
    inner join epc_max_date on epc.uprn = epc_max_date.UPRN_EPC
    where MAX_LODGEMENT_DATE = LODGEMENT_DATE
   -- and uprn = 200073066

)

select DISTINCT * from latest_epc


/*
select uprn, count(*) from latest_epc
group by 1
having count(*) >1
*/
  );
[0m16:10:16.761504 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m16:10:16.761692 [debug] [Thread-4 (]: On model.rightmove_epc.latest_rm_urn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.latest_rm_urn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NOT NULL
),

change_date AS (
    SELECT 
        UPRN AS UPRN_CD, 
        MAX(CHANGE_DATE) AS MAX_CHANGE_DATE 
    FROM rm
    GROUP BY UPRN
),

rm_latest as (

    SELECT distinct * FROM rm
    LEFT JOIN change_date cd
    ON rm.UPRN = cd.UPRN_CD
    WHERE cd.MAX_CHANGE_DATE = rm.CHANGE_DATE 
 --  and UPRN = 100090588560
    
)

select DISTINCT * from rm_latest

/*
select uprn, count(*) from rm_latest
group by 1
having count(*) >1
*/
  );
[0m16:10:16.762219 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m16:10:16.763024 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m16:10:17.267129 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:10:17.290508 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.latest_rm_urn (execute): 16:10:16.756721 => 16:10:17.290316
[0m16:10:17.290915 [debug] [Thread-4 (]: On model.rightmove_epc.latest_rm_urn: Close
[0m16:10:17.329503 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:10:17.332396 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.latest_epc_urn (execute): 16:10:16.755034 => 16:10:17.332189
[0m16:10:17.332877 [debug] [Thread-3 (]: On model.rightmove_epc.latest_epc_urn: Close
[0m16:10:17.384079 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7ca18230-2337-4e23-b6f9-81bdec22af15', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110a39710>]}
[0m16:10:17.384743 [info ] [Thread-4 (]: 4 of 6 OK created sql view model dbt_melissa_rm_epc.latest_rm_urn .............. [[32mSUCCESS 1[0m in 0.70s]
[0m16:10:17.385258 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.latest_rm_urn
[0m16:10:17.385777 [debug] [Thread-6 (]: Began running node model.rightmove_epc.rm_listings_count
[0m16:10:17.386192 [info ] [Thread-6 (]: 5 of 6 START sql view model dbt_melissa_rm_epc.rm_listings_count ............... [RUN]
[0m16:10:17.386848 [debug] [Thread-6 (]: Acquiring new snowflake connection 'model.rightmove_epc.rm_listings_count'
[0m16:10:17.387147 [debug] [Thread-6 (]: Began compiling node model.rightmove_epc.rm_listings_count
[0m16:10:17.391211 [debug] [Thread-6 (]: Writing injected SQL for node "model.rightmove_epc.rm_listings_count"
[0m16:10:17.392065 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:10:17.394107 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.dim_addressid (execute): 16:10:16.752473 => 16:10:17.393949
[0m16:10:17.394512 [debug] [Thread-1 (]: On model.rightmove_epc.dim_addressid: Close
[0m16:10:17.395645 [debug] [Thread-6 (]: Timing info for model.rightmove_epc.rm_listings_count (compile): 16:10:17.387324 => 16:10:17.395482
[0m16:10:17.396310 [debug] [Thread-6 (]: Began executing node model.rightmove_epc.rm_listings_count
[0m16:10:17.398840 [debug] [Thread-6 (]: Writing runtime sql for node "model.rightmove_epc.rm_listings_count"
[0m16:10:17.399994 [debug] [Thread-6 (]: Using snowflake connection "model.rightmove_epc.rm_listings_count"
[0m16:10:17.400292 [debug] [Thread-6 (]: On model.rightmove_epc.rm_listings_count: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.rm_listings_count"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.rm_listings_count
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn

),

false_rm as (

    select 
    uprn,
    count(LISTING_ID) listing_count
    from rm
    group by 1
   -- having count(LISTING_ID) >1

)

select * from false_rm
  );
[0m16:10:17.400615 [debug] [Thread-6 (]: Opening a new connection, currently in state init
[0m16:10:17.417419 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:10:17.418011 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7ca18230-2337-4e23-b6f9-81bdec22af15', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110af86d0>]}
[0m16:10:17.419843 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.dim_uprn (execute): 16:10:16.737582 => 16:10:17.419699
[0m16:10:17.420246 [info ] [Thread-3 (]: 3 of 6 OK created sql view model dbt_melissa_rm_epc.latest_epc_urn ............. [[32mSUCCESS 1[0m in 0.74s]
[0m16:10:17.420534 [debug] [Thread-2 (]: On model.rightmove_epc.dim_uprn: Close
[0m16:10:17.420863 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.latest_epc_urn
[0m16:10:17.422426 [debug] [Thread-8 (]: Began running node model.rightmove_epc.epc_flats_count
[0m16:10:17.422736 [info ] [Thread-8 (]: 6 of 6 START sql view model dbt_melissa_rm_epc.epc_flats_count ................. [RUN]
[0m16:10:17.423226 [debug] [Thread-8 (]: Acquiring new snowflake connection 'model.rightmove_epc.epc_flats_count'
[0m16:10:17.423454 [debug] [Thread-8 (]: Began compiling node model.rightmove_epc.epc_flats_count
[0m16:10:17.425526 [debug] [Thread-8 (]: Writing injected SQL for node "model.rightmove_epc.epc_flats_count"
[0m16:10:17.426252 [debug] [Thread-8 (]: Timing info for model.rightmove_epc.epc_flats_count (compile): 16:10:17.423591 => 16:10:17.426106
[0m16:10:17.426571 [debug] [Thread-8 (]: Began executing node model.rightmove_epc.epc_flats_count
[0m16:10:17.428696 [debug] [Thread-8 (]: Writing runtime sql for node "model.rightmove_epc.epc_flats_count"
[0m16:10:17.430040 [debug] [Thread-8 (]: Using snowflake connection "model.rightmove_epc.epc_flats_count"
[0m16:10:17.430349 [debug] [Thread-8 (]: On model.rightmove_epc.epc_flats_count: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.epc_flats_count"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.epc_flats_count
  
   as (
    with epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn

),

flat_epc as (

    select uprn,
    count(BUILDING_REFERENCE_NUMBER) as building_ref_count
    from epc
    group by 1
    having count(BUILDING_REFERENCE_NUMBER) >1

)

select * from flat_epc
  );
[0m16:10:17.430580 [debug] [Thread-8 (]: Opening a new connection, currently in state init
[0m16:10:17.478103 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7ca18230-2337-4e23-b6f9-81bdec22af15', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107b37090>]}
[0m16:10:17.478534 [info ] [Thread-1 (]: 1 of 6 OK created sql view model dbt_melissa_rm_epc.dim_addressid .............. [[32mSUCCESS 1[0m in 0.80s]
[0m16:10:17.478855 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.dim_addressid
[0m16:10:17.528833 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7ca18230-2337-4e23-b6f9-81bdec22af15', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110d16110>]}
[0m16:10:17.529315 [info ] [Thread-2 (]: 2 of 6 OK created sql view model dbt_melissa_rm_epc.dim_uprn ................... [[32mSUCCESS 1[0m in 0.85s]
[0m16:10:17.529638 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.dim_uprn
[0m16:10:18.081343 [debug] [Thread-6 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:10:18.082903 [debug] [Thread-8 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:10:18.087008 [debug] [Thread-6 (]: Timing info for model.rightmove_epc.rm_listings_count (execute): 16:10:17.396582 => 16:10:18.086702
[0m16:10:18.089865 [debug] [Thread-8 (]: Timing info for model.rightmove_epc.epc_flats_count (execute): 16:10:17.426815 => 16:10:18.089651
[0m16:10:18.090317 [debug] [Thread-6 (]: On model.rightmove_epc.rm_listings_count: Close
[0m16:10:18.090724 [debug] [Thread-8 (]: On model.rightmove_epc.epc_flats_count: Close
[0m16:10:18.176248 [debug] [Thread-6 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7ca18230-2337-4e23-b6f9-81bdec22af15', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110878990>]}
[0m16:10:18.177023 [info ] [Thread-6 (]: 5 of 6 OK created sql view model dbt_melissa_rm_epc.rm_listings_count .......... [[32mSUCCESS 1[0m in 0.79s]
[0m16:10:18.177712 [debug] [Thread-6 (]: Finished running node model.rightmove_epc.rm_listings_count
[0m16:10:18.209750 [debug] [Thread-8 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7ca18230-2337-4e23-b6f9-81bdec22af15', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1106c2650>]}
[0m16:10:18.210367 [info ] [Thread-8 (]: 6 of 6 OK created sql view model dbt_melissa_rm_epc.epc_flats_count ............ [[32mSUCCESS 1[0m in 0.79s]
[0m16:10:18.210854 [debug] [Thread-8 (]: Finished running node model.rightmove_epc.epc_flats_count
[0m16:10:18.212730 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:10:18.213035 [debug] [MainThread]: Connection 'model.rightmove_epc.dim_addressid' was properly closed.
[0m16:10:18.213269 [debug] [MainThread]: Connection 'model.rightmove_epc.dim_uprn' was properly closed.
[0m16:10:18.213484 [debug] [MainThread]: Connection 'model.rightmove_epc.latest_epc_urn' was properly closed.
[0m16:10:18.213695 [debug] [MainThread]: Connection 'model.rightmove_epc.latest_rm_urn' was properly closed.
[0m16:10:18.213901 [debug] [MainThread]: Connection 'model.rightmove_epc.rm_listings_count' was properly closed.
[0m16:10:18.214102 [debug] [MainThread]: Connection 'model.rightmove_epc.epc_flats_count' was properly closed.
[0m16:10:18.214382 [info ] [MainThread]: 
[0m16:10:18.214640 [info ] [MainThread]: Finished running 6 view models in 0 hours 0 minutes and 2.53 seconds (2.53s).
[0m16:10:18.215481 [debug] [MainThread]: Command end result
[0m16:10:18.222831 [info ] [MainThread]: 
[0m16:10:18.223195 [info ] [MainThread]: [32mCompleted successfully[0m
[0m16:10:18.223418 [info ] [MainThread]: 
[0m16:10:18.223639 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=0 SKIP=0 TOTAL=6
[0m16:10:18.225586 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 2.8139074, "process_user_time": 1.351699, "process_kernel_time": 0.172148, "process_mem_max_rss": "139608064", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m16:10:18.226009 [debug] [MainThread]: Command `dbt run` succeeded at 16:10:18.225925 after 2.81 seconds
[0m16:10:18.226266 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103456090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103302210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106616e10>]}
[0m16:10:18.226511 [debug] [MainThread]: Flushing usage events
[0m16:10:26.258401 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112452a10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111cd3790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11245f050>]}


============================== 16:10:26.261193 | ad45d457-cf4a-4981-9050-8515e8c74f05 ==============================
[0m16:10:26.261193 [info ] [MainThread]: Running with dbt=1.7.10
[0m16:10:26.261534 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'profiles_dir': '/Users/melissabee/.dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'invocation_command': 'dbt run --select models/MATCHING', 'send_anonymous_usage_stats': 'True'}
[0m16:10:26.424603 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ad45d457-cf4a-4981-9050-8515e8c74f05', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1124a8150>]}
[0m16:10:26.459335 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ad45d457-cf4a-4981-9050-8515e8c74f05', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111af1ad0>]}
[0m16:10:26.459973 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m16:10:26.469982 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m16:10:26.493309 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m16:10:26.493569 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m16:10:26.496814 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ad45d457-cf4a-4981-9050-8515e8c74f05', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x115283a50>]}
[0m16:10:26.503057 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ad45d457-cf4a-4981-9050-8515e8c74f05', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1151c7450>]}
[0m16:10:26.503309 [info ] [MainThread]: Found 19 models, 1 analysis, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m16:10:26.503500 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ad45d457-cf4a-4981-9050-8515e8c74f05', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1146ea850>]}
[0m16:10:26.504076 [warn ] [MainThread]: The selection criterion 'models/MATCHING' does not match any nodes
[0m16:10:26.504618 [info ] [MainThread]: 
[0m16:10:26.504776 [warn ] [MainThread]: Nothing to do. Try checking your model configs and model specification args
[0m16:10:26.505017 [debug] [MainThread]: Command end result
[0m16:10:26.509736 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.28250661, "process_user_time": 0.951448, "process_kernel_time": 0.128224, "process_mem_max_rss": "123060224", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m16:10:26.510092 [debug] [MainThread]: Command `dbt run` succeeded at 16:10:26.510026 after 0.28 seconds
[0m16:10:26.510318 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112487710>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112487510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102d1e210>]}
[0m16:10:26.510506 [debug] [MainThread]: Flushing usage events
[0m16:10:32.932301 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104ca4410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104cea690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104ceb210>]}


============================== 16:10:32.934476 | a3efbd14-d659-4bad-89cc-ae5acd8ee23d ==============================
[0m16:10:32.934476 [info ] [MainThread]: Running with dbt=1.7.10
[0m16:10:32.934793 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'profiles_dir': '/Users/melissabee/.dbt', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --select models/matching', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m16:10:33.070644 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a3efbd14-d659-4bad-89cc-ae5acd8ee23d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104c8d890>]}
[0m16:10:33.104091 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a3efbd14-d659-4bad-89cc-ae5acd8ee23d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1054f4e50>]}
[0m16:10:33.104637 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m16:10:33.114214 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m16:10:33.134268 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m16:10:33.134560 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m16:10:33.138101 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a3efbd14-d659-4bad-89cc-ae5acd8ee23d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105773850>]}
[0m16:10:33.145054 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a3efbd14-d659-4bad-89cc-ae5acd8ee23d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105692bd0>]}
[0m16:10:33.145361 [info ] [MainThread]: Found 19 models, 1 analysis, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m16:10:33.145562 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a3efbd14-d659-4bad-89cc-ae5acd8ee23d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1054e15d0>]}
[0m16:10:33.146707 [info ] [MainThread]: 
[0m16:10:33.147136 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m16:10:33.147821 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m16:10:33.154409 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m16:10:33.154651 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m16:10:33.154823 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:10:33.642514 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 0.0 seconds
[0m16:10:33.644977 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m16:10:33.721468 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m16:10:33.729330 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m16:10:33.729671 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m16:10:33.729930 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:10:34.150109 [debug] [ThreadPool]: SQL status: SUCCESS 20 in 0.0 seconds
[0m16:10:34.153098 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m16:10:34.256877 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a3efbd14-d659-4bad-89cc-ae5acd8ee23d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1056b64d0>]}
[0m16:10:34.257756 [info ] [MainThread]: Concurrency: 8 threads (target='dev')
[0m16:10:34.258109 [info ] [MainThread]: 
[0m16:10:34.262022 [debug] [Thread-1 (]: Began running node model.rightmove_epc.address_match
[0m16:10:34.262487 [debug] [Thread-2 (]: Began running node model.rightmove_epc.no_uprn_match
[0m16:10:34.262871 [debug] [Thread-3 (]: Began running node model.rightmove_epc.uprn_match
[0m16:10:34.263458 [info ] [Thread-1 (]: 1 of 4 START sql view model dbt_melissa_rm_epc.address_match ................... [RUN]
[0m16:10:34.264052 [info ] [Thread-2 (]: 2 of 4 START sql view model dbt_melissa_rm_epc.no_uprn_match ................... [RUN]
[0m16:10:34.266766 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.address_match)
[0m16:10:34.264602 [info ] [Thread-3 (]: 3 of 4 START sql view model dbt_melissa_rm_epc.uprn_match ...................... [RUN]
[0m16:10:34.267525 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.no_uprn_match'
[0m16:10:34.267878 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.address_match
[0m16:10:34.268467 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.rightmove_epc.uprn_match'
[0m16:10:34.268890 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.no_uprn_match
[0m16:10:34.308352 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.address_match"
[0m16:10:34.308655 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.uprn_match
[0m16:10:34.310151 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.no_uprn_match"
[0m16:10:34.311835 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.uprn_match"
[0m16:10:34.312248 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.address_match (compile): 16:10:34.269186 => 16:10:34.312109
[0m16:10:34.312462 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.address_match
[0m16:10:34.325986 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.address_match"
[0m16:10:34.326278 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.no_uprn_match (compile): 16:10:34.308778 => 16:10:34.326152
[0m16:10:34.326515 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.uprn_match (compile): 16:10:34.310355 => 16:10:34.326406
[0m16:10:34.326720 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.no_uprn_match
[0m16:10:34.326902 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.uprn_match
[0m16:10:34.328493 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.no_uprn_match"
[0m16:10:34.328974 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.address_match"
[0m16:10:34.330452 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.uprn_match"
[0m16:10:34.330706 [debug] [Thread-1 (]: On model.rightmove_epc.address_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.address_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NULL

),



epc_address as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
    where datasource = 'EPC'
    
)


SELECT rm.*,
CASE WHEN epc_address.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_address.ADDRESSID AS EPC_ADDRESSID,
epc_address.UPRN AS EPC_UPRN


FROM rm
LEFT JOIN epc_address
ON rm.addressid = epc_address.addressid
and rm.FULL_POSTCODE = epc_address.POSTCODE
  );
[0m16:10:34.331246 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.no_uprn_match"
[0m16:10:34.331409 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:10:34.331612 [debug] [Thread-2 (]: On model.rightmove_epc.no_uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.no_uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.no_uprn_match
  
   as (
    with rm_latest as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn 
    where UPRN IS NOT NULL
),

epc_uprn as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
    where datasource = 'EPC'
)


SELECT rm_latest.*,
CASE WHEN epc_uprn.UPRN is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_uprn.UPRN AS EPC_UPRN,
epc_uprn.ADDRESSID AS EPC_ADDRESSID


FROM rm_latest
LEFT JOIN epc_uprn
ON rm_latest.UPRN = epc_uprn.UPRN

WHERE MATCH_EPC = 'NO'
  );
[0m16:10:34.332230 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.uprn_match"
[0m16:10:34.332730 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m16:10:34.333126 [debug] [Thread-3 (]: On model.rightmove_epc.uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
  
   as (
    with rm_latest as (

    select rm.*, multi.uprn AS multi_uprn
    from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn rm
    left join ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn multi on rm.uprn = multi.uprn
    where rm.UPRN IS NOT NULL
    and multi.datasource = 'RIGHTMOVE'
   and multi.multi_uprn IS NULL 
   
),

epc_uprn as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
    where datasource = 'EPC'
    and multi_uprn is null
)


SELECT rm_latest.*,
CASE WHEN epc_uprn.UPRN is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_uprn.UPRN AS EPC_UPRN,
epc_uprn.ADDRESSID AS EPC_ADDRESSID


FROM rm_latest
LEFT JOIN epc_uprn
ON rm_latest.UPRN = epc_uprn.UPRN

WHERE MATCH_EPC = 'YES'
  );
[0m16:10:34.333581 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m16:10:34.949321 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:10:34.966904 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.address_match (execute): 16:10:34.312587 => 16:10:34.966735
[0m16:10:34.967234 [debug] [Thread-1 (]: On model.rightmove_epc.address_match: Close
[0m16:10:35.032248 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:10:35.034508 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.no_uprn_match (execute): 16:10:34.327030 => 16:10:35.034336
[0m16:10:35.034825 [debug] [Thread-2 (]: On model.rightmove_epc.no_uprn_match: Close
[0m16:10:35.078762 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a3efbd14-d659-4bad-89cc-ae5acd8ee23d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1059ec4d0>]}
[0m16:10:35.080188 [info ] [Thread-1 (]: 1 of 4 OK created sql view model dbt_melissa_rm_epc.address_match .............. [[32mSUCCESS 1[0m in 0.81s]
[0m16:10:35.084049 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.address_match
[0m16:10:35.152193 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a3efbd14-d659-4bad-89cc-ae5acd8ee23d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105a4c090>]}
[0m16:10:35.152914 [info ] [Thread-2 (]: 2 of 4 OK created sql view model dbt_melissa_rm_epc.no_uprn_match .............. [[32mSUCCESS 1[0m in 0.88s]
[0m16:10:35.153470 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.no_uprn_match
[0m16:10:35.154019 [debug] [Thread-5 (]: Began running node model.rightmove_epc.uprn_address_match
[0m16:10:35.154492 [info ] [Thread-5 (]: 4 of 4 START sql view model dbt_melissa_rm_epc.uprn_address_match .............. [RUN]
[0m16:10:35.155273 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.rightmove_epc.uprn_address_match'
[0m16:10:35.155636 [debug] [Thread-5 (]: Began compiling node model.rightmove_epc.uprn_address_match
[0m16:10:35.158628 [debug] [Thread-5 (]: Writing injected SQL for node "model.rightmove_epc.uprn_address_match"
[0m16:10:35.159368 [debug] [Thread-5 (]: Timing info for model.rightmove_epc.uprn_address_match (compile): 16:10:35.155848 => 16:10:35.159182
[0m16:10:35.159679 [debug] [Thread-5 (]: Began executing node model.rightmove_epc.uprn_address_match
[0m16:10:35.162945 [debug] [Thread-5 (]: Writing runtime sql for node "model.rightmove_epc.uprn_address_match"
[0m16:10:35.164414 [debug] [Thread-5 (]: Using snowflake connection "model.rightmove_epc.uprn_address_match"
[0m16:10:35.164791 [debug] [Thread-5 (]: On model.rightmove_epc.uprn_address_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.uprn_address_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_address_match
  
   as (
    -- where uprn is not matched we try address.

with uprn as (

    select 
    up.LISTING_ID,
    CHANGE_DATE,
    up.ADDRESSID,
    up.ADDRESS_1,
    up.ADDRESS_2,
    FULL_POSTCODE,
    up.UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    BEDROOM,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
 -- need to sleect the same fields as address match
    CASE WHEN ad.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC,
    ad.ADDRESSID AS EPC_ADDRESSID,
    ad.UPRN AS EPC_UPRN

     from ANALYTICS_DEV.dbt_melissa_rm_epc.no_uprn_match up
    left join ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid ad on up.ADDRESSID = ad.ADDRESSID
    and up.FULL_POSTCODE = ad.POSTCODE
   
)

SELECT * FROM UPRN
  );
[0m16:10:35.165103 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m16:10:35.415306 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:10:35.418092 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.uprn_match (execute): 16:10:34.329095 => 16:10:35.417892
[0m16:10:35.418603 [debug] [Thread-3 (]: On model.rightmove_epc.uprn_match: Close
[0m16:10:35.514984 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a3efbd14-d659-4bad-89cc-ae5acd8ee23d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1059d8750>]}
[0m16:10:35.515931 [info ] [Thread-3 (]: 3 of 4 OK created sql view model dbt_melissa_rm_epc.uprn_match ................. [[32mSUCCESS 1[0m in 1.25s]
[0m16:10:35.516593 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.uprn_match
[0m16:10:36.107235 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:10:36.111949 [debug] [Thread-5 (]: Timing info for model.rightmove_epc.uprn_address_match (execute): 16:10:35.159862 => 16:10:36.111660
[0m16:10:36.112491 [debug] [Thread-5 (]: On model.rightmove_epc.uprn_address_match: Close
[0m16:10:36.204719 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a3efbd14-d659-4bad-89cc-ae5acd8ee23d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1059e1050>]}
[0m16:10:36.205501 [info ] [Thread-5 (]: 4 of 4 OK created sql view model dbt_melissa_rm_epc.uprn_address_match ......... [[32mSUCCESS 1[0m in 1.05s]
[0m16:10:36.206154 [debug] [Thread-5 (]: Finished running node model.rightmove_epc.uprn_address_match
[0m16:10:36.208153 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:10:36.208502 [debug] [MainThread]: Connection 'model.rightmove_epc.address_match' was properly closed.
[0m16:10:36.208803 [debug] [MainThread]: Connection 'model.rightmove_epc.no_uprn_match' was properly closed.
[0m16:10:36.209081 [debug] [MainThread]: Connection 'model.rightmove_epc.uprn_match' was properly closed.
[0m16:10:36.209354 [debug] [MainThread]: Connection 'model.rightmove_epc.uprn_address_match' was properly closed.
[0m16:10:36.209660 [info ] [MainThread]: 
[0m16:10:36.209963 [info ] [MainThread]: Finished running 4 view models in 0 hours 0 minutes and 3.06 seconds (3.06s).
[0m16:10:36.210773 [debug] [MainThread]: Command end result
[0m16:10:36.221106 [info ] [MainThread]: 
[0m16:10:36.221516 [info ] [MainThread]: [32mCompleted successfully[0m
[0m16:10:36.221784 [info ] [MainThread]: 
[0m16:10:36.222055 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m16:10:36.223383 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.3167915, "process_user_time": 1.276063, "process_kernel_time": 0.146366, "process_mem_max_rss": "137953280", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m16:10:36.223769 [debug] [MainThread]: Command `dbt run` succeeded at 16:10:36.223682 after 3.32 seconds
[0m16:10:36.224042 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104d13390>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104d131d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100e3a210>]}
[0m16:10:36.224313 [debug] [MainThread]: Flushing usage events
[0m16:13:52.615767 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106d0b0d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106cc0a50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106d16ed0>]}


============================== 16:13:52.618793 | a9e9259e-5ec2-46b8-9fa1-cfe52289273f ==============================
[0m16:13:52.618793 [info ] [MainThread]: Running with dbt=1.7.10
[0m16:13:52.619138 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'debug': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --select models/matching', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m16:13:52.788250 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a9e9259e-5ec2-46b8-9fa1-cfe52289273f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106d0b190>]}
[0m16:13:52.823154 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a9e9259e-5ec2-46b8-9fa1-cfe52289273f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106cb8750>]}
[0m16:13:52.824211 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m16:13:52.833900 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m16:13:52.858234 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m16:13:52.858492 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m16:13:52.861762 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a9e9259e-5ec2-46b8-9fa1-cfe52289273f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107876050>]}
[0m16:13:52.868542 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a9e9259e-5ec2-46b8-9fa1-cfe52289273f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1077cfd10>]}
[0m16:13:52.868804 [info ] [MainThread]: Found 19 models, 1 analysis, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m16:13:52.869002 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a9e9259e-5ec2-46b8-9fa1-cfe52289273f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10771ea10>]}
[0m16:13:52.870161 [info ] [MainThread]: 
[0m16:13:52.870549 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m16:13:52.871126 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m16:13:52.877905 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m16:13:52.878169 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m16:13:52.878327 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:13:53.361809 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 0.0 seconds
[0m16:13:53.364198 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m16:13:53.449726 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m16:13:53.457049 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m16:13:53.457370 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m16:13:53.457637 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:13:53.782892 [debug] [ThreadPool]: SQL status: SUCCESS 20 in 0.0 seconds
[0m16:13:53.785696 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m16:13:53.872383 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a9e9259e-5ec2-46b8-9fa1-cfe52289273f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106d4c190>]}
[0m16:13:53.873213 [info ] [MainThread]: Concurrency: 8 threads (target='dev')
[0m16:13:53.873553 [info ] [MainThread]: 
[0m16:13:53.876609 [debug] [Thread-1 (]: Began running node model.rightmove_epc.address_match
[0m16:13:53.876941 [debug] [Thread-2 (]: Began running node model.rightmove_epc.no_uprn_match
[0m16:13:53.877269 [debug] [Thread-3 (]: Began running node model.rightmove_epc.uprn_match
[0m16:13:53.877622 [info ] [Thread-1 (]: 1 of 4 START sql view model dbt_melissa_rm_epc.address_match ................... [RUN]
[0m16:13:53.878016 [info ] [Thread-2 (]: 2 of 4 START sql view model dbt_melissa_rm_epc.no_uprn_match ................... [RUN]
[0m16:13:53.880704 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.address_match)
[0m16:13:53.878405 [info ] [Thread-3 (]: 3 of 4 START sql view model dbt_melissa_rm_epc.uprn_match ...................... [RUN]
[0m16:13:53.881432 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.no_uprn_match'
[0m16:13:53.881763 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.address_match
[0m16:13:53.882306 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.rightmove_epc.uprn_match'
[0m16:13:53.882557 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.no_uprn_match
[0m16:13:53.920539 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.address_match"
[0m16:13:53.920891 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.uprn_match
[0m16:13:53.922391 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.no_uprn_match"
[0m16:13:53.924045 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.uprn_match"
[0m16:13:53.924484 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.address_match (compile): 16:13:53.882735 => 16:13:53.924334
[0m16:13:53.924843 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.address_match
[0m16:13:53.925112 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.no_uprn_match (compile): 16:13:53.921021 => 16:13:53.925004
[0m16:13:53.931964 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.uprn_match (compile): 16:13:53.922580 => 16:13:53.931798
[0m16:13:53.939308 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.address_match"
[0m16:13:53.939580 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.no_uprn_match
[0m16:13:53.939758 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.uprn_match
[0m16:13:53.941517 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.no_uprn_match"
[0m16:13:53.943001 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.uprn_match"
[0m16:13:53.943674 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.address_match"
[0m16:13:53.943888 [debug] [Thread-1 (]: On model.rightmove_epc.address_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.address_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NULL

),



epc_address as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
    where datasource = 'EPC'
    
)


SELECT rm.*,
CASE WHEN epc_address.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_address.ADDRESSID AS EPC_ADDRESSID,
epc_address.UPRN AS EPC_UPRN


FROM rm
LEFT JOIN epc_address
ON rm.addressid = epc_address.addressid
and rm.FULL_POSTCODE = epc_address.POSTCODE
  );
[0m16:13:53.944096 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:13:53.944968 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.no_uprn_match"
[0m16:13:53.945266 [debug] [Thread-2 (]: On model.rightmove_epc.no_uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.no_uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.no_uprn_match
  
   as (
    with rm_latest as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn 
    where UPRN IS NOT NULL
),

epc_uprn as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
    where datasource = 'EPC'
)


SELECT rm_latest.*,
CASE WHEN epc_uprn.UPRN is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_uprn.UPRN AS EPC_UPRN,
epc_uprn.ADDRESSID AS EPC_ADDRESSID


FROM rm_latest
LEFT JOIN epc_uprn
ON rm_latest.UPRN = epc_uprn.UPRN

WHERE MATCH_EPC = 'NO'
  );
[0m16:13:53.945446 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m16:13:53.946391 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.uprn_match"
[0m16:13:53.946793 [debug] [Thread-3 (]: On model.rightmove_epc.uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
  
   as (
    with rm_latest as (

    select rm.*, multi.uprn AS multi_uprn
    from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn rm
    left join ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn multi on rm.uprn = multi.uprn
    where rm.UPRN IS NOT NULL
    and multi.datasource = 'RIGHTMOVE'
   and multi.multi_uprn IS NULL 
   
),

epc_uprn as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
    where datasource = 'EPC'
    and multi_uprn is null
)


SELECT rm_latest.*,
CASE WHEN epc_uprn.UPRN is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_uprn.UPRN AS EPC_UPRN,
epc_uprn.ADDRESSID AS EPC_ADDRESSID


FROM rm_latest
LEFT JOIN epc_uprn
ON rm_latest.UPRN = epc_uprn.UPRN

--WHERE MATCH_EPC = 'YES'
  );
[0m16:13:53.947006 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m16:13:54.629814 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:13:54.645998 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.address_match (execute): 16:13:53.925252 => 16:13:54.645844
[0m16:13:54.646332 [debug] [Thread-1 (]: On model.rightmove_epc.address_match: Close
[0m16:13:54.657773 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:13:54.659758 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.no_uprn_match (execute): 16:13:53.939958 => 16:13:54.659607
[0m16:13:54.660032 [debug] [Thread-2 (]: On model.rightmove_epc.no_uprn_match: Close
[0m16:13:54.721164 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:13:54.723281 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.uprn_match (execute): 16:13:53.941674 => 16:13:54.723105
[0m16:13:54.723615 [debug] [Thread-3 (]: On model.rightmove_epc.uprn_match: Close
[0m16:13:54.804857 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a9e9259e-5ec2-46b8-9fa1-cfe52289273f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107877c10>]}
[0m16:13:54.805612 [info ] [Thread-1 (]: 1 of 4 OK created sql view model dbt_melissa_rm_epc.address_match .............. [[32mSUCCESS 1[0m in 0.92s]
[0m16:13:54.806176 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.address_match
[0m16:13:54.817606 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a9e9259e-5ec2-46b8-9fa1-cfe52289273f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10425c590>]}
[0m16:13:54.818376 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a9e9259e-5ec2-46b8-9fa1-cfe52289273f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1074bfb90>]}
[0m16:13:54.818893 [info ] [Thread-3 (]: 3 of 4 OK created sql view model dbt_melissa_rm_epc.uprn_match ................. [[32mSUCCESS 1[0m in 0.94s]
[0m16:13:54.819460 [info ] [Thread-2 (]: 2 of 4 OK created sql view model dbt_melissa_rm_epc.no_uprn_match .............. [[32mSUCCESS 1[0m in 0.94s]
[0m16:13:54.819999 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.uprn_match
[0m16:13:54.820441 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.no_uprn_match
[0m16:13:54.821159 [debug] [Thread-5 (]: Began running node model.rightmove_epc.uprn_address_match
[0m16:13:54.821543 [info ] [Thread-5 (]: 4 of 4 START sql view model dbt_melissa_rm_epc.uprn_address_match .............. [RUN]
[0m16:13:54.822147 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.rightmove_epc.uprn_address_match'
[0m16:13:54.822432 [debug] [Thread-5 (]: Began compiling node model.rightmove_epc.uprn_address_match
[0m16:13:54.824747 [debug] [Thread-5 (]: Writing injected SQL for node "model.rightmove_epc.uprn_address_match"
[0m16:13:54.825596 [debug] [Thread-5 (]: Timing info for model.rightmove_epc.uprn_address_match (compile): 16:13:54.822591 => 16:13:54.825442
[0m16:13:54.825867 [debug] [Thread-5 (]: Began executing node model.rightmove_epc.uprn_address_match
[0m16:13:54.828770 [debug] [Thread-5 (]: Writing runtime sql for node "model.rightmove_epc.uprn_address_match"
[0m16:13:54.829908 [debug] [Thread-5 (]: Using snowflake connection "model.rightmove_epc.uprn_address_match"
[0m16:13:54.830228 [debug] [Thread-5 (]: On model.rightmove_epc.uprn_address_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.uprn_address_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_address_match
  
   as (
    -- where uprn is not matched we try address.

with uprn as (

    select 
    up.LISTING_ID,
    CHANGE_DATE,
    up.ADDRESSID,
    up.ADDRESS_1,
    up.ADDRESS_2,
    FULL_POSTCODE,
    up.UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    BEDROOM,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
 -- need to sleect the same fields as address match
    CASE WHEN ad.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC,
    ad.ADDRESSID AS EPC_ADDRESSID,
    ad.UPRN AS EPC_UPRN

     from ANALYTICS_DEV.dbt_melissa_rm_epc.no_uprn_match up
    left join ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid ad on up.ADDRESSID = ad.ADDRESSID
    and up.FULL_POSTCODE = ad.POSTCODE
   
)

SELECT * FROM UPRN
  );
[0m16:13:54.830531 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m16:13:55.641026 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:13:55.644891 [debug] [Thread-5 (]: Timing info for model.rightmove_epc.uprn_address_match (execute): 16:13:54.826028 => 16:13:55.644598
[0m16:13:55.645429 [debug] [Thread-5 (]: On model.rightmove_epc.uprn_address_match: Close
[0m16:13:55.729700 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a9e9259e-5ec2-46b8-9fa1-cfe52289273f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1077e88d0>]}
[0m16:13:55.730548 [info ] [Thread-5 (]: 4 of 4 OK created sql view model dbt_melissa_rm_epc.uprn_address_match ......... [[32mSUCCESS 1[0m in 0.91s]
[0m16:13:55.731133 [debug] [Thread-5 (]: Finished running node model.rightmove_epc.uprn_address_match
[0m16:13:55.732890 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:13:55.733182 [debug] [MainThread]: Connection 'model.rightmove_epc.address_match' was properly closed.
[0m16:13:55.733432 [debug] [MainThread]: Connection 'model.rightmove_epc.no_uprn_match' was properly closed.
[0m16:13:55.733669 [debug] [MainThread]: Connection 'model.rightmove_epc.uprn_match' was properly closed.
[0m16:13:55.733911 [debug] [MainThread]: Connection 'model.rightmove_epc.uprn_address_match' was properly closed.
[0m16:13:55.734209 [info ] [MainThread]: 
[0m16:13:55.734507 [info ] [MainThread]: Finished running 4 view models in 0 hours 0 minutes and 2.86 seconds (2.86s).
[0m16:13:55.735306 [debug] [MainThread]: Command end result
[0m16:13:55.745011 [info ] [MainThread]: 
[0m16:13:55.745376 [info ] [MainThread]: [32mCompleted successfully[0m
[0m16:13:55.745610 [info ] [MainThread]: 
[0m16:13:55.745850 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=0 SKIP=0 TOTAL=4
[0m16:13:55.747763 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 3.1592638, "process_user_time": 1.267478, "process_kernel_time": 0.178836, "process_mem_max_rss": "134217728", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m16:13:55.748168 [debug] [MainThread]: Command `dbt run` succeeded at 16:13:55.748081 after 3.16 seconds
[0m16:13:55.748447 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106d3efd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102e66210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102fba150>]}
[0m16:13:55.748711 [debug] [MainThread]: Flushing usage events
[0m16:31:59.919269 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107f18d50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107f5e850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107f5f3d0>]}


============================== 16:31:59.922359 | 20434d0a-a84a-4d71-8351-e3e0d3e07afa ==============================
[0m16:31:59.922359 [info ] [MainThread]: Running with dbt=1.7.10
[0m16:31:59.922695 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'profiles_dir': '/Users/melissabee/.dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select models/matching', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m16:32:00.097322 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '20434d0a-a84a-4d71-8351-e3e0d3e07afa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x118ba0050>]}
[0m16:32:00.133872 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '20434d0a-a84a-4d71-8351-e3e0d3e07afa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1188aff90>]}
[0m16:32:00.135009 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m16:32:00.144871 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m16:32:00.169577 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m16:32:00.170019 [debug] [MainThread]: Partial parsing: updated file: rightmove_epc://models/reports/flats_report.sql
[0m16:32:00.225262 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.rightmove_epc.flats_report' (models/reports/flats_report.sql) depends on a node named 'uprn_match_flat' which was not found
[0m16:32:00.227948 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.33903965, "process_user_time": 1.032203, "process_kernel_time": 0.148316, "process_mem_max_rss": "123961344", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m16:32:00.228390 [debug] [MainThread]: Command `dbt run` failed at 16:32:00.228315 after 0.34 seconds
[0m16:32:00.228674 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102d7eb50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x118e95fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107f87290>]}
[0m16:32:00.229032 [debug] [MainThread]: Flushing usage events
[0m16:34:06.881924 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114418150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114461c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114462f90>]}


============================== 16:34:06.884552 | a3c6b57a-adec-49d2-884d-d860077a47b4 ==============================
[0m16:34:06.884552 [info ] [MainThread]: Running with dbt=1.7.10
[0m16:34:06.884872 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'profiles_dir': '/Users/melissabee/.dbt', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m16:34:07.051284 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a3c6b57a-adec-49d2-884d-d860077a47b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114d9c750>]}
[0m16:34:07.085995 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a3c6b57a-adec-49d2-884d-d860077a47b4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114460390>]}
[0m16:34:07.087610 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m16:34:07.096772 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m16:34:07.113295 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m16:34:07.113681 [debug] [MainThread]: Partial parsing: updated file: rightmove_epc://models/reports/flats_report.sql
[0m16:34:07.164097 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.rightmove_epc.flats_report' (models/reports/flats_report.sql) depends on a node named 'uprn_match_flat' which was not found
[0m16:34:07.166696 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.3123242, "process_user_time": 0.986486, "process_kernel_time": 0.128621, "process_mem_max_rss": "124878848", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m16:34:07.167033 [debug] [MainThread]: Command `dbt run` failed at 16:34:07.166966 after 0.31 seconds
[0m16:34:07.167275 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114456710>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104cee110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104e29cd0>]}
[0m16:34:07.167501 [debug] [MainThread]: Flushing usage events
[0m16:34:37.043210 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105a18b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105a18b10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105a5ed10>]}


============================== 16:34:37.046216 | 01df47d8-f19e-4e86-a6fa-9b2b9ef0d871 ==============================
[0m16:34:37.046216 [info ] [MainThread]: Running with dbt=1.7.10
[0m16:34:37.046570 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'warn_error': 'None', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run --select models/matching', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m16:34:37.214389 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '01df47d8-f19e-4e86-a6fa-9b2b9ef0d871', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105aa8290>]}
[0m16:34:37.249317 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '01df47d8-f19e-4e86-a6fa-9b2b9ef0d871', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105a006d0>]}
[0m16:34:37.250157 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m16:34:37.259431 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m16:34:37.276386 [debug] [MainThread]: Partial parsing enabled: 1 files deleted, 0 files added, 0 files changed.
[0m16:34:37.276810 [debug] [MainThread]: Partial parsing: deleted file: rightmove_epc://models/reports/flats_report.sql
[0m16:34:37.329713 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.rightmove_epc.zero_bedrooms' (models/reports/zero_bedrooms.sql) depends on a node named 'flats_report' which was not found
[0m16:34:37.332464 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.3171425, "process_user_time": 0.991845, "process_kernel_time": 0.140135, "process_mem_max_rss": "124715008", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m16:34:37.332786 [debug] [MainThread]: Command `dbt run` failed at 16:34:37.332719 after 0.32 seconds
[0m16:34:37.333013 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10083eb50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105a872d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106af2e90>]}
[0m16:34:37.333225 [debug] [MainThread]: Flushing usage events
[0m16:34:55.054174 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105b1aa90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105b5e250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105b5edd0>]}


============================== 16:34:55.056167 | da168182-c2c1-45b4-b386-4c64726aa436 ==============================
[0m16:34:55.056167 [info ] [MainThread]: Running with dbt=1.7.10
[0m16:34:55.056483 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'fail_fast': 'False', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --select models/matching', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m16:34:55.190005 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'da168182-c2c1-45b4-b386-4c64726aa436', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1065e5a90>]}
[0m16:34:55.224874 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'da168182-c2c1-45b4-b386-4c64726aa436', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105b10610>]}
[0m16:34:55.225507 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m16:34:55.234603 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m16:34:55.252862 [debug] [MainThread]: Partial parsing enabled: 2 files deleted, 0 files added, 0 files changed.
[0m16:34:55.253229 [debug] [MainThread]: Partial parsing: deleted file: rightmove_epc://models/reports/zero_bedrooms.sql
[0m16:34:55.253384 [debug] [MainThread]: Partial parsing: deleted file: rightmove_epc://models/reports/flats_report.sql
[0m16:34:55.260502 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'da168182-c2c1-45b4-b386-4c64726aa436', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106664590>]}
[0m16:34:55.267531 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'da168182-c2c1-45b4-b386-4c64726aa436', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1069add10>]}
[0m16:34:55.267856 [info ] [MainThread]: Found 18 models, 1 analysis, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m16:34:55.268070 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'da168182-c2c1-45b4-b386-4c64726aa436', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106439010>]}
[0m16:34:55.269247 [info ] [MainThread]: 
[0m16:34:55.269700 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m16:34:55.270310 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m16:34:55.276412 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m16:34:55.276623 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m16:34:55.276768 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:34:55.791026 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 1.0 seconds
[0m16:34:55.794050 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m16:34:55.893579 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m16:34:55.935165 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m16:34:55.935449 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m16:34:55.935625 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:34:56.373154 [debug] [ThreadPool]: SQL status: SUCCESS 20 in 0.0 seconds
[0m16:34:56.375313 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m16:34:56.458786 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'da168182-c2c1-45b4-b386-4c64726aa436', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106883810>]}
[0m16:34:56.459719 [info ] [MainThread]: Concurrency: 8 threads (target='dev')
[0m16:34:56.460105 [info ] [MainThread]: 
[0m16:34:56.463489 [debug] [Thread-1 (]: Began running node model.rightmove_epc.address_match
[0m16:34:56.463948 [debug] [Thread-2 (]: Began running node model.rightmove_epc.no_uprn_match
[0m16:34:56.464378 [debug] [Thread-3 (]: Began running node model.rightmove_epc.uprn_match
[0m16:34:56.464779 [info ] [Thread-1 (]: 1 of 5 START sql view model dbt_melissa_rm_epc.address_match ................... [RUN]
[0m16:34:56.465159 [debug] [Thread-4 (]: Began running node model.rightmove_epc.uprn_match _flat
[0m16:34:56.465603 [info ] [Thread-2 (]: 2 of 5 START sql view model dbt_melissa_rm_epc.no_uprn_match ................... [RUN]
[0m16:34:56.466037 [info ] [Thread-3 (]: 3 of 5 START sql view model dbt_melissa_rm_epc.uprn_match ...................... [RUN]
[0m16:34:56.466715 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.address_match)
[0m16:34:56.467122 [info ] [Thread-4 (]: 4 of 5 START sql view model dbt_melissa_rm_epc.uprn_match _flat ................ [RUN]
[0m16:34:56.467812 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.no_uprn_match'
[0m16:34:56.468435 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.rightmove_epc.uprn_match'
[0m16:34:56.471103 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.address_match
[0m16:34:56.472010 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.rightmove_epc.uprn_match _flat'
[0m16:34:56.472482 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.no_uprn_match
[0m16:34:56.472871 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.uprn_match
[0m16:34:56.479456 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.address_match"
[0m16:34:56.479869 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.uprn_match _flat
[0m16:34:56.482104 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.no_uprn_match"
[0m16:34:56.484516 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.uprn_match"
[0m16:34:56.487238 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.uprn_match _flat"
[0m16:34:56.487913 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.address_match (compile): 16:34:56.473443 => 16:34:56.487736
[0m16:34:56.488256 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.address_match
[0m16:34:56.488535 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.no_uprn_match (compile): 16:34:56.480069 => 16:34:56.488399
[0m16:34:56.488787 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.uprn_match (compile): 16:34:56.482344 => 16:34:56.488658
[0m16:34:56.499966 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.uprn_match _flat (compile): 16:34:56.484873 => 16:34:56.499784
[0m16:34:56.506108 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.address_match"
[0m16:34:56.506364 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.no_uprn_match
[0m16:34:56.506606 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.uprn_match
[0m16:34:56.506827 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.uprn_match _flat
[0m16:34:56.508817 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.no_uprn_match"
[0m16:34:56.510775 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.uprn_match"
[0m16:34:56.513360 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.uprn_match _flat"
[0m16:34:56.513927 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.address_match"
[0m16:34:56.514362 [debug] [Thread-1 (]: On model.rightmove_epc.address_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.address_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NULL

),



epc_address as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
    where datasource = 'EPC'
    
)


SELECT rm.*,
CASE WHEN epc_address.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_address.ADDRESSID AS EPC_ADDRESSID,
epc_address.UPRN AS EPC_UPRN


FROM rm
LEFT JOIN epc_address
ON rm.addressid = epc_address.addressid
and rm.FULL_POSTCODE = epc_address.POSTCODE
  );
[0m16:34:56.514923 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.no_uprn_match"
[0m16:34:56.515551 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.uprn_match"
[0m16:34:56.515737 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:34:56.516304 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.uprn_match _flat"
[0m16:34:56.516509 [debug] [Thread-2 (]: On model.rightmove_epc.no_uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.no_uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.no_uprn_match
  
   as (
    with rm_latest as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn 
    where UPRN IS NOT NULL
),

epc_uprn as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
    where datasource = 'EPC'
)


SELECT rm_latest.*,
CASE WHEN epc_uprn.UPRN is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_uprn.UPRN AS EPC_UPRN,
epc_uprn.ADDRESSID AS EPC_ADDRESSID


FROM rm_latest
LEFT JOIN epc_uprn
ON rm_latest.UPRN = epc_uprn.UPRN

WHERE MATCH_EPC = 'NO'
  );
[0m16:34:56.516749 [debug] [Thread-3 (]: On model.rightmove_epc.uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
  
   as (
    with rm_latest as (

    select rm.*,
    multi.uprn AS multi_uprn
    from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn rm
    left join ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn multi on rm.uprn = multi.uprn
    where rm.UPRN IS NOT NULL
    and multi.datasource = 'RIGHTMOVE'
   
),

epc_uprn as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
    where datasource = 'EPC'
    and multi_uprn is null  -- we do not use UPRN to match addresses with multiple URNs as they are flats and could fall into House report
)


SELECT rm_latest.*,
CASE WHEN epc_uprn.UPRN is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_uprn.UPRN AS EPC_UPRN,
epc_uprn.ADDRESSID AS EPC_ADDRESSID


FROM rm_latest
LEFT JOIN epc_uprn
ON rm_latest.UPRN = epc_uprn.UPRN

--WHERE MATCH_EPC = 'YES'
  );
[0m16:34:56.517361 [debug] [Thread-4 (]: On model.rightmove_epc.uprn_match _flat: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.uprn_match _flat"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match _flat
  
   as (
    with rm_latest as (

    select rm.*,
    multi.uprn AS multi_uprn
    from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn rm
    left join ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn multi on rm.uprn = multi.uprn
    where rm.UPRN IS NOT NULL
    and multi.datasource = 'RIGHTMOVE'
   
),

epc_uprn as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
    where datasource = 'EPC'
    and multi_uprn is not null  -- we do not use UPRN to match addresses with multiple URNs as they are flats and could fall into House report
)


SELECT rm_latest.*,
CASE WHEN epc_uprn.UPRN is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_uprn.UPRN AS EPC_UPRN,
epc_uprn.ADDRESSID AS EPC_ADDRESSID


FROM rm_latest
LEFT JOIN epc_uprn
ON rm_latest.UPRN = epc_uprn.UPRN

--WHERE MATCH_EPC = 'YES'
  );
[0m16:34:56.517755 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m16:34:56.517950 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m16:34:56.518130 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m16:34:56.909239 [debug] [Thread-4 (]: Snowflake adapter: Snowflake query id: 01b34582-0103-9b63-0000-719506379aee
[0m16:34:56.909650 [debug] [Thread-4 (]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 3 at position 3 unexpected 'as'.
[0m16:34:56.910089 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.uprn_match _flat (execute): 16:34:56.510932 => 16:34:56.909935
[0m16:34:56.910359 [debug] [Thread-4 (]: On model.rightmove_epc.uprn_match _flat: Close
[0m16:34:57.020392 [debug] [Thread-4 (]: Database Error in model uprn_match _flat (models/matching/uprn_match _flat.sql)
  001003 (42000): SQL compilation error:
  syntax error line 3 at position 3 unexpected 'as'.
  compiled Code at target/run/rightmove_epc/models/matching/uprn_match _flat.sql
[0m16:34:57.020895 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'da168182-c2c1-45b4-b386-4c64726aa436', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10695b610>]}
[0m16:34:57.021412 [error] [Thread-4 (]: 4 of 5 ERROR creating sql view model dbt_melissa_rm_epc.uprn_match _flat ....... [[31mERROR[0m in 0.55s]
[0m16:34:57.021894 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.uprn_match _flat
[0m16:34:57.039179 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:34:57.054220 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.address_match (execute): 16:34:56.488958 => 16:34:57.054067
[0m16:34:57.054520 [debug] [Thread-1 (]: On model.rightmove_epc.address_match: Close
[0m16:34:57.158555 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'da168182-c2c1-45b4-b386-4c64726aa436', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1068ab710>]}
[0m16:34:57.159189 [info ] [Thread-1 (]: 1 of 5 OK created sql view model dbt_melissa_rm_epc.address_match .............. [[32mSUCCESS 1[0m in 0.69s]
[0m16:34:57.159685 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.address_match
[0m16:34:57.244595 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:34:57.247331 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.no_uprn_match (execute): 16:34:56.506999 => 16:34:57.247132
[0m16:34:57.247712 [debug] [Thread-2 (]: On model.rightmove_epc.no_uprn_match: Close
[0m16:34:57.337540 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'da168182-c2c1-45b4-b386-4c64726aa436', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106439690>]}
[0m16:34:57.338221 [info ] [Thread-2 (]: 2 of 5 OK created sql view model dbt_melissa_rm_epc.no_uprn_match .............. [[32mSUCCESS 1[0m in 0.87s]
[0m16:34:57.338758 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.no_uprn_match
[0m16:34:57.339326 [debug] [Thread-6 (]: Began running node model.rightmove_epc.uprn_address_match
[0m16:34:57.339737 [info ] [Thread-6 (]: 5 of 5 START sql view model dbt_melissa_rm_epc.uprn_address_match .............. [RUN]
[0m16:34:57.340378 [debug] [Thread-6 (]: Acquiring new snowflake connection 'model.rightmove_epc.uprn_address_match'
[0m16:34:57.340676 [debug] [Thread-6 (]: Began compiling node model.rightmove_epc.uprn_address_match
[0m16:34:57.343250 [debug] [Thread-6 (]: Writing injected SQL for node "model.rightmove_epc.uprn_address_match"
[0m16:34:57.343989 [debug] [Thread-6 (]: Timing info for model.rightmove_epc.uprn_address_match (compile): 16:34:57.340856 => 16:34:57.343787
[0m16:34:57.344311 [debug] [Thread-6 (]: Began executing node model.rightmove_epc.uprn_address_match
[0m16:34:57.347474 [debug] [Thread-6 (]: Writing runtime sql for node "model.rightmove_epc.uprn_address_match"
[0m16:34:57.348714 [debug] [Thread-6 (]: Using snowflake connection "model.rightmove_epc.uprn_address_match"
[0m16:34:57.349113 [debug] [Thread-6 (]: On model.rightmove_epc.uprn_address_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.uprn_address_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_address_match
  
   as (
    -- where uprn is not matched we try address.

with uprn as (

    select 
    up.LISTING_ID,
    CHANGE_DATE,
    up.ADDRESSID,
    up.ADDRESS_1,
    up.ADDRESS_2,
    FULL_POSTCODE,
    up.UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    BEDROOM,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
 -- need to sleect the same fields as address match
    CASE WHEN ad.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC,
    ad.ADDRESSID AS EPC_ADDRESSID,
    ad.UPRN AS EPC_UPRN

     from ANALYTICS_DEV.dbt_melissa_rm_epc.no_uprn_match up
    left join ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid ad on up.ADDRESSID = ad.ADDRESSID
    and up.FULL_POSTCODE = ad.POSTCODE
   
)

SELECT * FROM UPRN
  );
[0m16:34:57.349425 [debug] [Thread-6 (]: Opening a new connection, currently in state init
[0m16:34:57.415189 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:34:57.417012 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.uprn_match (execute): 16:34:56.508974 => 16:34:57.416884
[0m16:34:57.417257 [debug] [Thread-3 (]: On model.rightmove_epc.uprn_match: Close
[0m16:34:57.508396 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'da168182-c2c1-45b4-b386-4c64726aa436', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1069c5ad0>]}
[0m16:34:57.509069 [info ] [Thread-3 (]: 3 of 5 OK created sql view model dbt_melissa_rm_epc.uprn_match ................. [[32mSUCCESS 1[0m in 1.04s]
[0m16:34:57.509561 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.uprn_match
[0m16:34:58.187174 [debug] [Thread-6 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:34:58.189867 [debug] [Thread-6 (]: Timing info for model.rightmove_epc.uprn_address_match (execute): 16:34:57.344487 => 16:34:58.189667
[0m16:34:58.190248 [debug] [Thread-6 (]: On model.rightmove_epc.uprn_address_match: Close
[0m16:34:58.262582 [debug] [Thread-6 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'da168182-c2c1-45b4-b386-4c64726aa436', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1065e7850>]}
[0m16:34:58.263272 [info ] [Thread-6 (]: 5 of 5 OK created sql view model dbt_melissa_rm_epc.uprn_address_match ......... [[32mSUCCESS 1[0m in 0.92s]
[0m16:34:58.263809 [debug] [Thread-6 (]: Finished running node model.rightmove_epc.uprn_address_match
[0m16:34:58.265546 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:34:58.265858 [debug] [MainThread]: Connection 'model.rightmove_epc.address_match' was properly closed.
[0m16:34:58.266095 [debug] [MainThread]: Connection 'model.rightmove_epc.no_uprn_match' was properly closed.
[0m16:34:58.266310 [debug] [MainThread]: Connection 'model.rightmove_epc.uprn_match' was properly closed.
[0m16:34:58.266521 [debug] [MainThread]: Connection 'model.rightmove_epc.uprn_match _flat' was properly closed.
[0m16:34:58.266730 [debug] [MainThread]: Connection 'model.rightmove_epc.uprn_address_match' was properly closed.
[0m16:34:58.267000 [info ] [MainThread]: 
[0m16:34:58.267264 [info ] [MainThread]: Finished running 5 view models in 0 hours 0 minutes and 3.00 seconds (3.00s).
[0m16:34:58.268055 [debug] [MainThread]: Command end result
[0m16:34:58.275069 [info ] [MainThread]: 
[0m16:34:58.275374 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m16:34:58.275602 [info ] [MainThread]: 
[0m16:34:58.275821 [error] [MainThread]:   Database Error in model uprn_match _flat (models/matching/uprn_match _flat.sql)
  001003 (42000): SQL compilation error:
  syntax error line 3 at position 3 unexpected 'as'.
  compiled Code at target/run/rightmove_epc/models/matching/uprn_match _flat.sql
[0m16:34:58.276044 [info ] [MainThread]: 
[0m16:34:58.276270 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=1 SKIP=0 TOTAL=5
[0m16:34:58.278079 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 3.2482007, "process_user_time": 1.29243, "process_kernel_time": 0.157854, "process_mem_max_rss": "138215424", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m16:34:58.278449 [debug] [MainThread]: Command `dbt run` failed at 16:34:58.278367 after 3.25 seconds
[0m16:34:58.278727 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105b5cc10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100a22b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106b3c0d0>]}
[0m16:34:58.278970 [debug] [MainThread]: Flushing usage events
[0m16:35:33.300451 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110a18190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110a5db10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110a5e790>]}


============================== 16:35:33.302600 | e9fa7c99-dd52-4c2b-b895-e21e1821a157 ==============================
[0m16:35:33.302600 [info ] [MainThread]: Running with dbt=1.7.10
[0m16:35:33.302929 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'fail_fast': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt clean', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m16:35:33.341011 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e9fa7c99-dd52-4c2b-b895-e21e1821a157', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107ef3c50>]}
[0m16:35:33.348870 [debug] [MainThread]: Resource report: {"command_name": "clean", "command_success": true, "command_wall_clock_time": 0.07450084, "process_user_time": 0.797638, "process_kernel_time": 0.087352, "process_mem_max_rss": "103546880", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m16:35:33.349252 [debug] [MainThread]: Command `dbt clean` succeeded at 16:35:33.349179 after 0.07 seconds
[0m16:35:33.349455 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103652110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110a53210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x103754f10>]}
[0m16:35:33.349660 [debug] [MainThread]: Flushing usage events
[0m16:36:01.268936 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112c54090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112c99c50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112c9a7d0>]}


============================== 16:36:01.271545 | 32ae0a01-7e7e-47e8-b9c9-e670fec5ba1f ==============================
[0m16:36:01.271545 [info ] [MainThread]: Running with dbt=1.7.10
[0m16:36:01.271870 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt clean', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m16:36:01.312582 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '32ae0a01-7e7e-47e8-b9c9-e670fec5ba1f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112d14350>]}
[0m16:36:01.315205 [debug] [MainThread]: Resource report: {"command_name": "clean", "command_success": true, "command_wall_clock_time": 0.07238579, "process_user_time": 0.803304, "process_kernel_time": 0.10016, "process_mem_max_rss": "103088128", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m16:36:01.315527 [debug] [MainThread]: Command `dbt clean` succeeded at 16:36:01.315465 after 0.07 seconds
[0m16:36:01.315726 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112c99f10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112c8e950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10499e190>]}
[0m16:36:01.315909 [debug] [MainThread]: Flushing usage events
[0m16:36:05.898137 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109b18710>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109b5e610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109b5f190>]}


============================== 16:36:05.900331 | 859e69bd-530b-4eba-87cd-d76fc68562d2 ==============================
[0m16:36:05.900331 [info ] [MainThread]: Running with dbt=1.7.10
[0m16:36:05.900647 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'profiles_dir': '/Users/melissabee/.dbt', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'invocation_command': 'dbt run', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m16:36:06.068193 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '859e69bd-530b-4eba-87cd-d76fc68562d2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a591e90>]}
[0m16:36:06.104291 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '859e69bd-530b-4eba-87cd-d76fc68562d2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109b94350>]}
[0m16:36:06.105317 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m16:36:06.115013 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m16:36:06.115582 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m16:36:06.115809 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '859e69bd-530b-4eba-87cd-d76fc68562d2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a6cba10>]}
[0m16:36:06.576298 [error] [MainThread]: Encountered an error:
Compilation Error
  Model 'model.rightmove_epc.flats_report' (models/reports/flats_report.sql) depends on a node named 'uprn_match_flat' which was not found
[0m16:36:06.577369 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 0.704115, "process_user_time": 1.363234, "process_kernel_time": 0.12248, "process_mem_max_rss": "127107072", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m16:36:06.577662 [debug] [MainThread]: Command `dbt run` failed at 16:36:06.577598 after 0.70 seconds
[0m16:36:06.577873 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105b290d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b4a0c90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102b08f10>]}
[0m16:36:06.578065 [debug] [MainThread]: Flushing usage events
[0m16:36:32.992848 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1075189d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10755e850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10755f3d0>]}


============================== 16:36:32.995809 | 108ac86d-fde0-4eed-b9ed-02c24e1b5e34 ==============================
[0m16:36:32.995809 [info ] [MainThread]: Running with dbt=1.7.10
[0m16:36:32.996162 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'introspect': 'True', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m16:36:33.160975 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '108ac86d-fde0-4eed-b9ed-02c24e1b5e34', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107537510>]}
[0m16:36:33.197573 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '108ac86d-fde0-4eed-b9ed-02c24e1b5e34', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107537510>]}
[0m16:36:33.198482 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m16:36:33.207584 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m16:36:33.242673 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m16:36:33.242960 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m16:36:33.246522 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '108ac86d-fde0-4eed-b9ed-02c24e1b5e34', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107544490>]}
[0m16:36:33.254528 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '108ac86d-fde0-4eed-b9ed-02c24e1b5e34', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108019f50>]}
[0m16:36:33.254872 [info ] [MainThread]: Found 20 models, 1 analysis, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m16:36:33.255087 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '108ac86d-fde0-4eed-b9ed-02c24e1b5e34', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108283810>]}
[0m16:36:33.256366 [info ] [MainThread]: 
[0m16:36:33.256807 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m16:36:33.257773 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m16:36:33.264825 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m16:36:33.265098 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m16:36:33.265259 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:36:33.759641 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 0.0 seconds
[0m16:36:33.763476 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m16:36:33.862980 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m16:36:33.870725 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m16:36:33.871120 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m16:36:33.871360 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:36:34.311319 [debug] [ThreadPool]: SQL status: SUCCESS 20 in 0.0 seconds
[0m16:36:34.313417 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m16:36:34.427728 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '108ac86d-fde0-4eed-b9ed-02c24e1b5e34', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108260b90>]}
[0m16:36:34.428471 [info ] [MainThread]: Concurrency: 8 threads (target='dev')
[0m16:36:34.428720 [info ] [MainThread]: 
[0m16:36:34.431542 [debug] [Thread-1 (]: Began running node model.rightmove_epc.dim_uprn
[0m16:36:34.431847 [debug] [Thread-2 (]: Began running node model.rightmove_epc.stg_epc_certs
[0m16:36:34.432155 [info ] [Thread-1 (]: 1 of 20 START sql view model dbt_melissa_rm_epc.dim_uprn ....................... [RUN]
[0m16:36:34.432458 [debug] [Thread-3 (]: Began running node model.rightmove_epc.stg_rightmove
[0m16:36:34.432782 [info ] [Thread-2 (]: 2 of 20 START sql view model dbt_melissa_rm_epc.stg_epc_certs .................. [RUN]
[0m16:36:34.434641 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.dim_uprn)
[0m16:36:34.435017 [info ] [Thread-3 (]: 3 of 20 START sql view model dbt_melissa_rm_epc.stg_rightmove .................. [RUN]
[0m16:36:34.435676 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.stg_epc_certs'
[0m16:36:34.435997 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.dim_uprn
[0m16:36:34.436526 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.rightmove_epc.stg_rightmove'
[0m16:36:34.436805 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.stg_epc_certs
[0m16:36:34.472768 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.dim_uprn"
[0m16:36:34.473132 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.stg_rightmove
[0m16:36:34.474825 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.stg_epc_certs"
[0m16:36:34.476575 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.stg_rightmove"
[0m16:36:34.477459 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.dim_uprn (compile): 16:36:34.436950 => 16:36:34.477328
[0m16:36:34.477687 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.stg_rightmove (compile): 16:36:34.475142 => 16:36:34.477594
[0m16:36:34.477859 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_epc_certs (compile): 16:36:34.473279 => 16:36:34.477778
[0m16:36:34.478014 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.dim_uprn
[0m16:36:34.478188 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.stg_rightmove
[0m16:36:34.478350 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.stg_epc_certs
[0m16:36:34.495314 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.stg_rightmove"
[0m16:36:34.496729 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.dim_uprn"
[0m16:36:34.498315 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.stg_epc_certs"
[0m16:36:34.499513 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.dim_uprn"
[0m16:36:34.499817 [debug] [Thread-1 (]: On model.rightmove_epc.dim_uprn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_uprn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE UPRNS


with epc as (

   select distinct
    epc.uprn,
    epc.addressid,
    epc.ADDRESS,
    'EPC' AS datasource,
    epc.POSTCODE,
    case when multi.uprn is null then NULL else 1 end as MULTI_UPRN

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc
    left join ANALYTICS_DEV.dbt_melissa_rm_epc.epc_flats_count multi on epc.uprn = multi.uprn

    where epc.REMOVE_FROM_RM_MATCH = 0
    AND epc.UPRN IS NOT NULL
    
),

rightmove as (

 select distinct
    rm.uprn,
    rm.addressid,
    concat(rm.ADDRESS_1,',',rm.ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    rm.FULL_POSTCODE AS POSTCODE,
    multi.LISTING_COUNT AS MULTI_UPRN

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove rm
    left join ANALYTICS_DEV.dbt_melissa_rm_epc.false_listings_count multi on rm.uprn = multi.uprn
    WHERE rm.UPRN IS NOT NULL


),

final as (

    select * from epc
    union all
    select * from rightmove
)

select distinct * from final
  );
[0m16:36:34.500374 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.stg_rightmove"
[0m16:36:34.500959 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.stg_epc_certs"
[0m16:36:34.501164 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:36:34.501374 [debug] [Thread-3 (]: On model.rightmove_epc.stg_rightmove: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_rightmove"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
  
   as (
    with rm as (

    SELECT 
    LISTING_ID, 
    CHANGE_DATE,
    UPPER(TRIM(replace(REPLACE(CONCAT(ADDRESS_1::VARCHAR,ADDRESS_2::VARCHAR),' '),','))) AS ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, 
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    BEDROOM,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    BRANCH_ID,
	 BRANCH_NAME,
    WEBSITE_URL,
	 COMPANY_NAME
    FROM 
       ANALYTICS.RIGHTMOVE_PROD.CLEAN_RAW_RIGHTMOVE_DATA 

 
)

SELECT * FROM rm
  );
[0m16:36:34.501629 [debug] [Thread-2 (]: On model.rightmove_epc.stg_epc_certs: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_epc_certs"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
  
   as (
    WITH epc_certs as (
    
    select 
    UPRN,
    LODGEMENT_DATE,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
   -- COUNTY,
    LOCAL_AUTHORITY as LOCAL_AUTHORITY_CODE,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    UPPER(CASE WHEN (UPPER(ADDRESS1) LIKE 'FLAT%' OR UPPER(ADDRESS1) LIKE 'UNIT%') or UPPER(ADDRESS1) LIKE 'ROOM%' 
    THEN TRIM(REPLACE(REPLACE(CONCAT(ADDRESS),','),' '))
    ELSE trim(replace(replace(ADDRESS1,' '),',')) END) AS ADDRESSID,
    CASE WHEN UPRN is null and addressid is null THEN 1 else 0 end as REMOVE_FROM_RM_MATCH,
    FLOOR_LEVEL,
    FLAT_TOP_STOREY,
    FLAT_STOREY_COUNT,
    PROPERTY_TYPE
 from  RAW.EPC_TEST_DATA.EPC_CERTIFICATES 

)

SELECT * FROM epc_certs
  );
[0m16:36:34.502210 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m16:36:34.502581 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m16:36:35.006951 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:36:35.022506 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_epc_certs (execute): 16:36:34.496900 => 16:36:35.022353
[0m16:36:35.022833 [debug] [Thread-2 (]: On model.rightmove_epc.stg_epc_certs: Close
[0m16:36:35.117307 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '108ac86d-fde0-4eed-b9ed-02c24e1b5e34', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108392e10>]}
[0m16:36:35.117893 [info ] [Thread-2 (]: 2 of 20 OK created sql view model dbt_melissa_rm_epc.stg_epc_certs ............. [[32mSUCCESS 1[0m in 0.68s]
[0m16:36:35.118250 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.stg_epc_certs
[0m16:36:35.118614 [debug] [Thread-5 (]: Began running node model.rightmove_epc.latest_epc_urn
[0m16:36:35.118910 [info ] [Thread-5 (]: 4 of 20 START sql view model dbt_melissa_rm_epc.latest_epc_urn ................. [RUN]
[0m16:36:35.119415 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.rightmove_epc.latest_epc_urn'
[0m16:36:35.119642 [debug] [Thread-5 (]: Began compiling node model.rightmove_epc.latest_epc_urn
[0m16:36:35.121639 [debug] [Thread-5 (]: Writing injected SQL for node "model.rightmove_epc.latest_epc_urn"
[0m16:36:35.122172 [debug] [Thread-5 (]: Timing info for model.rightmove_epc.latest_epc_urn (compile): 16:36:35.119781 => 16:36:35.122060
[0m16:36:35.122362 [debug] [Thread-5 (]: Began executing node model.rightmove_epc.latest_epc_urn
[0m16:36:35.124206 [debug] [Thread-5 (]: Writing runtime sql for node "model.rightmove_epc.latest_epc_urn"
[0m16:36:35.124921 [debug] [Thread-5 (]: Using snowflake connection "model.rightmove_epc.latest_epc_urn"
[0m16:36:35.125148 [debug] [Thread-5 (]: On model.rightmove_epc.latest_epc_urn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.latest_epc_urn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn
  
   as (
    with epc_max_date as (

    select uprn as UPRN_EPC,
    MAX(LODGEMENT_DATE) AS MAX_LODGEMENT_DATE,
    from  ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    group by 1


),

latest_epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc
    inner join epc_max_date on epc.uprn = epc_max_date.UPRN_EPC
    where MAX_LODGEMENT_DATE = LODGEMENT_DATE
   -- and uprn = 200073066

)

select DISTINCT * from latest_epc


/*
select uprn, count(*) from latest_epc
group by 1
having count(*) >1
*/
  );
[0m16:36:35.125354 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m16:36:35.234090 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:36:35.235870 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.stg_rightmove (execute): 16:36:34.490809 => 16:36:35.235736
[0m16:36:35.236108 [debug] [Thread-3 (]: On model.rightmove_epc.stg_rightmove: Close
[0m16:36:35.239721 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:36:35.241170 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.dim_uprn (execute): 16:36:34.478457 => 16:36:35.241053
[0m16:36:35.241406 [debug] [Thread-1 (]: On model.rightmove_epc.dim_uprn: Close
[0m16:36:35.314178 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '108ac86d-fde0-4eed-b9ed-02c24e1b5e34', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10837c190>]}
[0m16:36:35.314673 [info ] [Thread-3 (]: 3 of 20 OK created sql view model dbt_melissa_rm_epc.stg_rightmove ............. [[32mSUCCESS 1[0m in 0.88s]
[0m16:36:35.315013 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.stg_rightmove
[0m16:36:35.315396 [debug] [Thread-7 (]: Began running node model.rightmove_epc.dim_addressid
[0m16:36:35.315633 [debug] [Thread-8 (]: Began running node model.rightmove_epc.latest_rm_urn
[0m16:36:35.315877 [info ] [Thread-7 (]: 5 of 20 START sql view model dbt_melissa_rm_epc.dim_addressid .................. [RUN]
[0m16:36:35.316131 [info ] [Thread-8 (]: 6 of 20 START sql view model dbt_melissa_rm_epc.latest_rm_urn .................. [RUN]
[0m16:36:35.316577 [debug] [Thread-7 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_addressid'
[0m16:36:35.316971 [debug] [Thread-8 (]: Acquiring new snowflake connection 'model.rightmove_epc.latest_rm_urn'
[0m16:36:35.317173 [debug] [Thread-7 (]: Began compiling node model.rightmove_epc.dim_addressid
[0m16:36:35.317360 [debug] [Thread-8 (]: Began compiling node model.rightmove_epc.latest_rm_urn
[0m16:36:35.319476 [debug] [Thread-7 (]: Writing injected SQL for node "model.rightmove_epc.dim_addressid"
[0m16:36:35.321063 [debug] [Thread-8 (]: Writing injected SQL for node "model.rightmove_epc.latest_rm_urn"
[0m16:36:35.321695 [debug] [Thread-8 (]: Timing info for model.rightmove_epc.latest_rm_urn (compile): 16:36:35.319624 => 16:36:35.321543
[0m16:36:35.321963 [debug] [Thread-7 (]: Timing info for model.rightmove_epc.dim_addressid (compile): 16:36:35.317481 => 16:36:35.321834
[0m16:36:35.322150 [debug] [Thread-8 (]: Began executing node model.rightmove_epc.latest_rm_urn
[0m16:36:35.322342 [debug] [Thread-7 (]: Began executing node model.rightmove_epc.dim_addressid
[0m16:36:35.324141 [debug] [Thread-8 (]: Writing runtime sql for node "model.rightmove_epc.latest_rm_urn"
[0m16:36:35.325846 [debug] [Thread-7 (]: Writing runtime sql for node "model.rightmove_epc.dim_addressid"
[0m16:36:35.326609 [debug] [Thread-8 (]: Using snowflake connection "model.rightmove_epc.latest_rm_urn"
[0m16:36:35.327249 [debug] [Thread-7 (]: Using snowflake connection "model.rightmove_epc.dim_addressid"
[0m16:36:35.327460 [debug] [Thread-8 (]: On model.rightmove_epc.latest_rm_urn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.latest_rm_urn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NOT NULL
),

change_date AS (
    SELECT 
        UPRN AS UPRN_CD, 
        MAX(CHANGE_DATE) AS MAX_CHANGE_DATE 
    FROM rm
    GROUP BY UPRN
),

rm_latest as (

    SELECT distinct * FROM rm
    LEFT JOIN change_date cd
    ON rm.UPRN = cd.UPRN_CD
    WHERE cd.MAX_CHANGE_DATE = rm.CHANGE_DATE 
 --  and UPRN = 100090588560
    
)

select DISTINCT * from rm_latest

/*
select uprn, count(*) from rm_latest
group by 1
having count(*) >1
*/
  );
[0m16:36:35.327706 [debug] [Thread-7 (]: On model.rightmove_epc.dim_addressid: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_addressid"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE ADDRESS'

with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource,
    POSTCODE
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs 
    where REMOVE_FROM_RM_MATCH = 0
    AND ADDRESSID IS NOT NULL

),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    WHERE ADDRESSID IS NOT NULL

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where addressid is not null
  );
[0m16:36:35.327919 [debug] [Thread-8 (]: Opening a new connection, currently in state init
[0m16:36:35.328095 [debug] [Thread-7 (]: Opening a new connection, currently in state init
[0m16:36:35.332975 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '108ac86d-fde0-4eed-b9ed-02c24e1b5e34', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1084fd290>]}
[0m16:36:35.333542 [info ] [Thread-1 (]: 1 of 20 OK created sql view model dbt_melissa_rm_epc.dim_uprn .................. [[32mSUCCESS 1[0m in 0.90s]
[0m16:36:35.333938 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.dim_uprn
[0m16:36:35.618508 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m16:36:35.621693 [debug] [Thread-5 (]: Timing info for model.rightmove_epc.latest_epc_urn (execute): 16:36:35.122494 => 16:36:35.621457
[0m16:36:35.622155 [debug] [Thread-5 (]: On model.rightmove_epc.latest_epc_urn: Close
[0m16:36:35.733687 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '108ac86d-fde0-4eed-b9ed-02c24e1b5e34', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1084fed50>]}
[0m16:36:35.734428 [info ] [Thread-5 (]: 4 of 20 OK created sql view model dbt_melissa_rm_epc.latest_epc_urn ............ [[32mSUCCESS 1[0m in 0.61s]
[0m16:36:35.735066 [debug] [Thread-5 (]: Finished running node model.rightmove_epc.latest_epc_urn
[0m16:36:35.735825 [debug] [Thread-2 (]: Began running node model.rightmove_epc.epc_flats
[0m16:36:35.736321 [debug] [Thread-6 (]: Began running node model.rightmove_epc.epc_flats_count
[0m16:36:35.736879 [info ] [Thread-2 (]: 7 of 20 START sql table model dbt_melissa_rm_epc.epc_flats ..................... [RUN]
[0m16:36:35.737454 [info ] [Thread-6 (]: 8 of 20 START sql view model dbt_melissa_rm_epc.epc_flats_count ................ [RUN]
[0m16:36:35.738259 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_epc_certs, now model.rightmove_epc.epc_flats)
[0m16:36:35.739021 [debug] [Thread-6 (]: Acquiring new snowflake connection 'model.rightmove_epc.epc_flats_count'
[0m16:36:35.739385 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.epc_flats
[0m16:36:35.739719 [debug] [Thread-6 (]: Began compiling node model.rightmove_epc.epc_flats_count
[0m16:36:35.742591 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.epc_flats"
[0m16:36:35.744700 [debug] [Thread-6 (]: Writing injected SQL for node "model.rightmove_epc.epc_flats_count"
[0m16:36:35.745763 [debug] [Thread-6 (]: Timing info for model.rightmove_epc.epc_flats_count (compile): 16:36:35.742815 => 16:36:35.745506
[0m16:36:35.746178 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.epc_flats (compile): 16:36:35.739934 => 16:36:35.745988
[0m16:36:35.746495 [debug] [Thread-6 (]: Began executing node model.rightmove_epc.epc_flats_count
[0m16:36:35.746811 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.epc_flats
[0m16:36:35.749808 [debug] [Thread-6 (]: Writing runtime sql for node "model.rightmove_epc.epc_flats_count"
[0m16:36:35.764121 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.epc_flats"
[0m16:36:35.764936 [debug] [Thread-6 (]: Using snowflake connection "model.rightmove_epc.epc_flats_count"
[0m16:36:35.765212 [debug] [Thread-6 (]: On model.rightmove_epc.epc_flats_count: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.epc_flats_count"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.epc_flats_count
  
   as (
    with epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn

),

flat_epc as (

    select uprn,
    count(BUILDING_REFERENCE_NUMBER) as building_ref_count
    from epc
    group by 1
    having count(BUILDING_REFERENCE_NUMBER) >1

)

select * from flat_epc
  );
[0m16:36:35.765448 [debug] [Thread-6 (]: Opening a new connection, currently in state init
[0m16:36:35.766407 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.epc_flats"
[0m16:36:35.766697 [debug] [Thread-2 (]: On model.rightmove_epc.epc_flats: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.epc_flats"} */
create or replace transient table ANALYTICS_DEV.dbt_melissa_rm_epc.epc_flats
         as
        (with epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn

),

flat_epc as (

    select uprn,
    count(BUILDING_REFERENCE_NUMBER) as building_ref_count
    from epc
    group by 1
    having count(BUILDING_REFERENCE_NUMBER) >1

),

match_flat_epc as (

    select epc.*,
    building_ref_count
    from epc
    inner join flat_epc on epc.uprn = flat_epc.uprn

)

select * from match_flat_epc
        );
[0m16:36:35.767172 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m16:36:35.806839 [debug] [Thread-8 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m16:36:35.808618 [debug] [Thread-8 (]: Timing info for model.rightmove_epc.latest_rm_urn (execute): 16:36:35.322455 => 16:36:35.808490
[0m16:36:35.808882 [debug] [Thread-8 (]: On model.rightmove_epc.latest_rm_urn: Close
[0m16:36:35.884350 [debug] [Thread-8 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '108ac86d-fde0-4eed-b9ed-02c24e1b5e34', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109970ad0>]}
[0m16:36:35.884861 [info ] [Thread-8 (]: 6 of 20 OK created sql view model dbt_melissa_rm_epc.latest_rm_urn ............. [[32mSUCCESS 1[0m in 0.57s]
[0m16:36:35.885251 [debug] [Thread-8 (]: Finished running node model.rightmove_epc.latest_rm_urn
[0m16:36:35.885658 [debug] [Thread-4 (]: Began running node model.rightmove_epc.no_uprn_match
[0m16:36:35.885901 [debug] [Thread-1 (]: Began running node model.rightmove_epc.rm_listings
[0m16:36:35.886139 [debug] [Thread-5 (]: Began running node model.rightmove_epc.rm_listings_count
[0m16:36:35.886365 [info ] [Thread-4 (]: 9 of 20 START sql view model dbt_melissa_rm_epc.no_uprn_match .................. [RUN]
[0m16:36:35.886594 [debug] [Thread-3 (]: Began running node model.rightmove_epc.uprn_match
[0m16:36:35.886808 [debug] [Thread-8 (]: Began running node model.rightmove_epc.uprn_match_flat
[0m16:36:35.887062 [info ] [Thread-1 (]: 10 of 20 START sql table model dbt_melissa_rm_epc.rm_listings .................. [RUN]
[0m16:36:35.887335 [info ] [Thread-5 (]: 11 of 20 START sql view model dbt_melissa_rm_epc.rm_listings_count ............. [RUN]
[0m16:36:35.887798 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.rightmove_epc.no_uprn_match'
[0m16:36:35.888039 [info ] [Thread-3 (]: 12 of 20 START sql view model dbt_melissa_rm_epc.uprn_match .................... [RUN]
[0m16:36:35.888347 [info ] [Thread-8 (]: 13 of 20 START sql view model dbt_melissa_rm_epc.uprn_match_flat ............... [RUN]
[0m16:36:35.888773 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.dim_uprn, now model.rightmove_epc.rm_listings)
[0m16:36:35.889128 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.latest_epc_urn, now model.rightmove_epc.rm_listings_count)
[0m16:36:35.889338 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.no_uprn_match
[0m16:36:35.889674 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_rightmove, now model.rightmove_epc.uprn_match)
[0m16:36:35.890002 [debug] [Thread-8 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.latest_rm_urn, now model.rightmove_epc.uprn_match_flat)
[0m16:36:35.890196 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.rm_listings
[0m16:36:35.890383 [debug] [Thread-5 (]: Began compiling node model.rightmove_epc.rm_listings_count
[0m16:36:35.892502 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.no_uprn_match"
[0m16:36:35.892761 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.uprn_match
[0m16:36:35.892972 [debug] [Thread-8 (]: Began compiling node model.rightmove_epc.uprn_match_flat
[0m16:36:35.895850 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.rm_listings"
[0m16:36:35.897530 [debug] [Thread-5 (]: Writing injected SQL for node "model.rightmove_epc.rm_listings_count"
[0m16:36:35.899231 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.uprn_match"
[0m16:36:35.901012 [debug] [Thread-8 (]: Writing injected SQL for node "model.rightmove_epc.uprn_match_flat"
[0m16:36:35.901671 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.no_uprn_match (compile): 16:36:35.890510 => 16:36:35.901476
[0m16:36:35.902003 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.rm_listings (compile): 16:36:35.893100 => 16:36:35.901829
[0m16:36:35.902241 [debug] [Thread-5 (]: Timing info for model.rightmove_epc.rm_listings_count (compile): 16:36:35.896060 => 16:36:35.902138
[0m16:36:35.902495 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.no_uprn_match
[0m16:36:35.902733 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.uprn_match (compile): 16:36:35.897768 => 16:36:35.902623
[0m16:36:35.902967 [debug] [Thread-8 (]: Timing info for model.rightmove_epc.uprn_match_flat (compile): 16:36:35.899405 => 16:36:35.902848
[0m16:36:35.903148 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.rm_listings
[0m16:36:35.903342 [debug] [Thread-5 (]: Began executing node model.rightmove_epc.rm_listings_count
[0m16:36:35.905353 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.no_uprn_match"
[0m16:36:35.905561 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.uprn_match
[0m16:36:35.905758 [debug] [Thread-8 (]: Began executing node model.rightmove_epc.uprn_match_flat
[0m16:36:35.907361 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.rm_listings"
[0m16:36:35.907760 [debug] [Thread-7 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:36:35.909395 [debug] [Thread-5 (]: Writing runtime sql for node "model.rightmove_epc.rm_listings_count"
[0m16:36:35.911073 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.uprn_match"
[0m16:36:35.912681 [debug] [Thread-8 (]: Writing runtime sql for node "model.rightmove_epc.uprn_match_flat"
[0m16:36:35.913416 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.no_uprn_match"
[0m16:36:35.914743 [debug] [Thread-7 (]: Timing info for model.rightmove_epc.dim_addressid (execute): 16:36:35.324276 => 16:36:35.914624
[0m16:36:35.915364 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.rm_listings"
[0m16:36:35.915879 [debug] [Thread-5 (]: Using snowflake connection "model.rightmove_epc.rm_listings_count"
[0m16:36:35.916457 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.uprn_match"
[0m16:36:35.916658 [debug] [Thread-4 (]: On model.rightmove_epc.no_uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.no_uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.no_uprn_match
  
   as (
    with rm_latest as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn 
    where UPRN IS NOT NULL
),

epc_uprn as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
    where datasource = 'EPC'
)


SELECT rm_latest.*,
CASE WHEN epc_uprn.UPRN is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_uprn.UPRN AS EPC_UPRN,
epc_uprn.ADDRESSID AS EPC_ADDRESSID


FROM rm_latest
LEFT JOIN epc_uprn
ON rm_latest.UPRN = epc_uprn.UPRN

WHERE MATCH_EPC = 'NO'
  );
[0m16:36:35.916875 [debug] [Thread-7 (]: On model.rightmove_epc.dim_addressid: Close
[0m16:36:35.917435 [debug] [Thread-8 (]: Using snowflake connection "model.rightmove_epc.uprn_match_flat"
[0m16:36:35.917637 [debug] [Thread-1 (]: On model.rightmove_epc.rm_listings: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.rm_listings"} */
create or replace transient table ANALYTICS_DEV.dbt_melissa_rm_epc.rm_listings
         as
        (with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn
   --- where uprn = 100013137

),

false_rm as (

    select 
    uprn,
    count(LISTING_ID) listing_count
    from rm
    group by 1
    having count(LISTING_ID) >1

)

select * from false_rm

get_false as (

    select rm.*,
    listing_count

    from rm
    inner join false_rm
    on rm.uprn = false_rm.uprn

)

select * from get_false
order by uprn
        );
[0m16:36:35.917854 [debug] [Thread-5 (]: On model.rightmove_epc.rm_listings_count: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.rm_listings_count"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.rm_listings_count
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn

),

false_rm as (

    select 
    uprn,
    count(LISTING_ID) listing_count
    from rm
    group by 1
   -- having count(LISTING_ID) >1

)

select * from false_rm
  );
[0m16:36:35.918078 [debug] [Thread-3 (]: On model.rightmove_epc.uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
  
   as (
    with rm_latest as (

    select rm.*,
    multi.uprn AS multi_uprn
    from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn rm
    left join ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn multi on rm.uprn = multi.uprn
    where rm.UPRN IS NOT NULL
    and multi.datasource = 'RIGHTMOVE'
   
),

epc_uprn as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
    where datasource = 'EPC'
    and multi_uprn is null  -- we do not use UPRN to match addresses with multiple URNs as they are flats and could fall into House report
)


SELECT rm_latest.*,
CASE WHEN epc_uprn.UPRN is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_uprn.UPRN AS EPC_UPRN,
epc_uprn.ADDRESSID AS EPC_ADDRESSID


FROM rm_latest
LEFT JOIN epc_uprn
ON rm_latest.UPRN = epc_uprn.UPRN

--WHERE MATCH_EPC = 'YES'
  );
[0m16:36:35.918284 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m16:36:35.918918 [debug] [Thread-8 (]: On model.rightmove_epc.uprn_match_flat: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.uprn_match_flat"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match_flat
  
   as (
    with rm_latest as (

    select rm.*,
    multi.uprn AS multi_uprn
    from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn rm
    left join ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn multi on rm.uprn = multi.uprn
    where rm.UPRN IS NOT NULL
    and multi.datasource = 'RIGHTMOVE'
   
),

epc_uprn as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
    where datasource = 'EPC'
    and multi_uprn is not null  -- we do not use UPRN to match addresses with multiple URNs as they are flats and could fall into House report
)


SELECT rm_latest.*,
CASE WHEN epc_uprn.UPRN is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_uprn.UPRN AS EPC_UPRN,
epc_uprn.ADDRESSID AS EPC_ADDRESSID


FROM rm_latest
LEFT JOIN epc_uprn
ON rm_latest.UPRN = epc_uprn.UPRN

--WHERE MATCH_EPC = 'YES'
  );
[0m16:36:35.919304 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:36:35.919503 [debug] [Thread-5 (]: Opening a new connection, currently in state closed
[0m16:36:35.919678 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m16:36:35.920137 [debug] [Thread-8 (]: Opening a new connection, currently in state closed
[0m16:36:36.010532 [debug] [Thread-7 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '108ac86d-fde0-4eed-b9ed-02c24e1b5e34', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10992b290>]}
[0m16:36:36.010983 [info ] [Thread-7 (]: 5 of 20 OK created sql view model dbt_melissa_rm_epc.dim_addressid ............. [[32mSUCCESS 1[0m in 0.69s]
[0m16:36:36.011303 [debug] [Thread-7 (]: Finished running node model.rightmove_epc.dim_addressid
[0m16:36:36.011659 [debug] [Thread-7 (]: Began running node model.rightmove_epc.address_match
[0m16:36:36.011921 [info ] [Thread-7 (]: 14 of 20 START sql view model dbt_melissa_rm_epc.address_match ................. [RUN]
[0m16:36:36.012303 [debug] [Thread-7 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.dim_addressid, now model.rightmove_epc.address_match)
[0m16:36:36.012500 [debug] [Thread-7 (]: Began compiling node model.rightmove_epc.address_match
[0m16:36:36.014398 [debug] [Thread-7 (]: Writing injected SQL for node "model.rightmove_epc.address_match"
[0m16:36:36.017808 [debug] [Thread-7 (]: Timing info for model.rightmove_epc.address_match (compile): 16:36:36.012620 => 16:36:36.017649
[0m16:36:36.018053 [debug] [Thread-7 (]: Began executing node model.rightmove_epc.address_match
[0m16:36:36.020999 [debug] [Thread-7 (]: Writing runtime sql for node "model.rightmove_epc.address_match"
[0m16:36:36.021847 [debug] [Thread-7 (]: Using snowflake connection "model.rightmove_epc.address_match"
[0m16:36:36.022067 [debug] [Thread-7 (]: On model.rightmove_epc.address_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.address_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NULL

),



epc_address as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
    where datasource = 'EPC'
    
)


SELECT rm.*,
CASE WHEN epc_address.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_address.ADDRESSID AS EPC_ADDRESSID,
epc_address.UPRN AS EPC_UPRN


FROM rm
LEFT JOIN epc_address
ON rm.addressid = epc_address.addressid
and rm.FULL_POSTCODE = epc_address.POSTCODE
  );
[0m16:36:36.022338 [debug] [Thread-7 (]: Opening a new connection, currently in state closed
[0m16:36:36.273541 [debug] [Thread-6 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:36:36.275748 [debug] [Thread-6 (]: Timing info for model.rightmove_epc.epc_flats_count (execute): 16:36:35.746995 => 16:36:36.275580
[0m16:36:36.276067 [debug] [Thread-6 (]: On model.rightmove_epc.epc_flats_count: Close
[0m16:36:36.278208 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b34584-0103-9b8b-0000-719506378e16
[0m16:36:36.278578 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 23 at position 10 unexpected 'as'.
syntax error line 28 at position 4 unexpected 'from'.
syntax error line 34 at position 0 unexpected 'select'.
[0m16:36:36.279110 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.rm_listings (execute): 16:36:35.906062 => 16:36:36.278978
[0m16:36:36.279420 [debug] [Thread-1 (]: On model.rightmove_epc.rm_listings: Close
[0m16:36:36.358018 [debug] [Thread-1 (]: Database Error in model rm_listings (models/reports/rm_listings.sql)
  001003 (42000): SQL compilation error:
  syntax error line 23 at position 10 unexpected 'as'.
  syntax error line 28 at position 4 unexpected 'from'.
  syntax error line 34 at position 0 unexpected 'select'.
  compiled Code at target/run/rightmove_epc/models/reports/rm_listings.sql
[0m16:36:36.358661 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '108ac86d-fde0-4eed-b9ed-02c24e1b5e34', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1082b3890>]}
[0m16:36:36.359105 [error] [Thread-1 (]: 10 of 20 ERROR creating sql table model dbt_melissa_rm_epc.rm_listings ......... [[31mERROR[0m in 0.47s]
[0m16:36:36.359584 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.rm_listings
[0m16:36:36.360981 [debug] [Thread-6 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '108ac86d-fde0-4eed-b9ed-02c24e1b5e34', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10993b290>]}
[0m16:36:36.361362 [info ] [Thread-6 (]: 8 of 20 OK created sql view model dbt_melissa_rm_epc.epc_flats_count ........... [[32mSUCCESS 1[0m in 0.62s]
[0m16:36:36.361718 [debug] [Thread-6 (]: Finished running node model.rightmove_epc.epc_flats_count
[0m16:36:36.572133 [debug] [Thread-7 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:36:36.574910 [debug] [Thread-7 (]: Timing info for model.rightmove_epc.address_match (execute): 16:36:36.018182 => 16:36:36.574707
[0m16:36:36.575280 [debug] [Thread-7 (]: On model.rightmove_epc.address_match: Close
[0m16:36:36.638232 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:36:36.641778 [debug] [Thread-5 (]: Timing info for model.rightmove_epc.rm_listings_count (execute): 16:36:35.907885 => 16:36:36.641505
[0m16:36:36.642206 [debug] [Thread-5 (]: On model.rightmove_epc.rm_listings_count: Close
[0m16:36:36.653109 [debug] [Thread-7 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '108ac86d-fde0-4eed-b9ed-02c24e1b5e34', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1084fe050>]}
[0m16:36:36.653737 [info ] [Thread-7 (]: 14 of 20 OK created sql view model dbt_melissa_rm_epc.address_match ............ [[32mSUCCESS 1[0m in 0.64s]
[0m16:36:36.654220 [debug] [Thread-7 (]: Finished running node model.rightmove_epc.address_match
[0m16:36:36.679039 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:36:36.681544 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.no_uprn_match (execute): 16:36:35.903461 => 16:36:36.681362
[0m16:36:36.681866 [debug] [Thread-4 (]: On model.rightmove_epc.no_uprn_match: Close
[0m16:36:36.731245 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '108ac86d-fde0-4eed-b9ed-02c24e1b5e34', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109c0b3d0>]}
[0m16:36:36.731923 [info ] [Thread-5 (]: 11 of 20 OK created sql view model dbt_melissa_rm_epc.rm_listings_count ........ [[32mSUCCESS 1[0m in 0.84s]
[0m16:36:36.732457 [debug] [Thread-5 (]: Finished running node model.rightmove_epc.rm_listings_count
[0m16:36:36.756910 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '108ac86d-fde0-4eed-b9ed-02c24e1b5e34', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108042350>]}
[0m16:36:36.757489 [info ] [Thread-4 (]: 9 of 20 OK created sql view model dbt_melissa_rm_epc.no_uprn_match ............. [[32mSUCCESS 1[0m in 0.87s]
[0m16:36:36.757917 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.no_uprn_match
[0m16:36:36.758317 [debug] [Thread-1 (]: Began running node model.rightmove_epc.uprn_address_match
[0m16:36:36.758671 [info ] [Thread-1 (]: 15 of 20 START sql view model dbt_melissa_rm_epc.uprn_address_match ............ [RUN]
[0m16:36:36.759203 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.rm_listings, now model.rightmove_epc.uprn_address_match)
[0m16:36:36.759476 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.uprn_address_match
[0m16:36:36.761672 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.uprn_address_match"
[0m16:36:36.762288 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.uprn_address_match (compile): 16:36:36.759643 => 16:36:36.762150
[0m16:36:36.762520 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.uprn_address_match
[0m16:36:36.765705 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.uprn_address_match"
[0m16:36:36.766813 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.uprn_address_match"
[0m16:36:36.767111 [debug] [Thread-1 (]: On model.rightmove_epc.uprn_address_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.uprn_address_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_address_match
  
   as (
    -- where uprn is not matched we try address.

with uprn as (

    select 
    up.LISTING_ID,
    CHANGE_DATE,
    up.ADDRESSID,
    up.ADDRESS_1,
    up.ADDRESS_2,
    FULL_POSTCODE,
    up.UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    BEDROOM,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
 -- need to sleect the same fields as address match
    CASE WHEN ad.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC,
    ad.ADDRESSID AS EPC_ADDRESSID,
    ad.UPRN AS EPC_UPRN

     from ANALYTICS_DEV.dbt_melissa_rm_epc.no_uprn_match up
    left join ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid ad on up.ADDRESSID = ad.ADDRESSID
    and up.FULL_POSTCODE = ad.POSTCODE
   
)

SELECT * FROM UPRN
  );
[0m16:36:36.767371 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:36:36.901500 [debug] [Thread-8 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:36:36.903413 [debug] [Thread-8 (]: Timing info for model.rightmove_epc.uprn_match_flat (execute): 16:36:35.911231 => 16:36:36.903258
[0m16:36:36.903709 [debug] [Thread-8 (]: On model.rightmove_epc.uprn_match_flat: Close
[0m16:36:36.948262 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:36:36.950430 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.uprn_match (execute): 16:36:35.909589 => 16:36:36.950271
[0m16:36:36.950922 [debug] [Thread-3 (]: On model.rightmove_epc.uprn_match: Close
[0m16:36:37.001610 [debug] [Thread-8 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '108ac86d-fde0-4eed-b9ed-02c24e1b5e34', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109922010>]}
[0m16:36:37.002188 [info ] [Thread-8 (]: 13 of 20 OK created sql view model dbt_melissa_rm_epc.uprn_match_flat .......... [[32mSUCCESS 1[0m in 1.11s]
[0m16:36:37.002641 [debug] [Thread-8 (]: Finished running node model.rightmove_epc.uprn_match_flat
[0m16:36:37.029085 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '108ac86d-fde0-4eed-b9ed-02c24e1b5e34', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109920a10>]}
[0m16:36:37.029683 [info ] [Thread-3 (]: 12 of 20 OK created sql view model dbt_melissa_rm_epc.uprn_match ............... [[32mSUCCESS 1[0m in 1.14s]
[0m16:36:37.030144 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.uprn_match
[0m16:36:37.030659 [debug] [Thread-7 (]: Began running node model.rightmove_epc.flats_report
[0m16:36:37.030996 [debug] [Thread-5 (]: Began running node model.rightmove_epc.houses_report
[0m16:36:37.031338 [info ] [Thread-7 (]: 16 of 20 START sql table model dbt_melissa_rm_epc.flats_report ................. [RUN]
[0m16:36:37.031745 [info ] [Thread-5 (]: 17 of 20 START sql table model dbt_melissa_rm_epc.houses_report ................ [RUN]
[0m16:36:37.032359 [debug] [Thread-7 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.address_match, now model.rightmove_epc.flats_report)
[0m16:36:37.032828 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.rm_listings_count, now model.rightmove_epc.houses_report)
[0m16:36:37.033102 [debug] [Thread-7 (]: Began compiling node model.rightmove_epc.flats_report
[0m16:36:37.033349 [debug] [Thread-5 (]: Began compiling node model.rightmove_epc.houses_report
[0m16:36:37.036937 [debug] [Thread-7 (]: Writing injected SQL for node "model.rightmove_epc.flats_report"
[0m16:36:37.039525 [debug] [Thread-5 (]: Writing injected SQL for node "model.rightmove_epc.houses_report"
[0m16:36:37.040252 [debug] [Thread-5 (]: Timing info for model.rightmove_epc.houses_report (compile): 16:36:37.037180 => 16:36:37.040102
[0m16:36:37.040529 [debug] [Thread-7 (]: Timing info for model.rightmove_epc.flats_report (compile): 16:36:37.033509 => 16:36:37.040392
[0m16:36:37.040770 [debug] [Thread-5 (]: Began executing node model.rightmove_epc.houses_report
[0m16:36:37.040989 [debug] [Thread-7 (]: Began executing node model.rightmove_epc.flats_report
[0m16:36:37.042929 [debug] [Thread-5 (]: Writing runtime sql for node "model.rightmove_epc.houses_report"
[0m16:36:37.044896 [debug] [Thread-7 (]: Writing runtime sql for node "model.rightmove_epc.flats_report"
[0m16:36:37.046690 [debug] [Thread-5 (]: Using snowflake connection "model.rightmove_epc.houses_report"
[0m16:36:37.047084 [debug] [Thread-5 (]: On model.rightmove_epc.houses_report: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.houses_report"} */
create or replace transient table ANALYTICS_DEV.dbt_melissa_rm_epc.houses_report
         as
        (with house_addmatch as (

    select 
    distinct
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN,
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    epc.ADDRESSID AS EPC_ADDRESSID,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

     from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc on am.EPC_ADDRESSID = epc.ADDRESSID
    and am.FULL_POSTCODE = epc.POSTCODE
    where MATCH_EPC = 'YES'
    and COMBINED_PROPERTY_TYPE not in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')

),

house_uprnmatch as (

    select 
    distinct
    --count(LISTING_ID) as TOTAL_LISTINGS,
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN, -- NULL
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
  --  am.FLOOR_LEVEL as RM_FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    epc.ADDRESSID AS EPC_ADDRESSID,
    -- REMOVE_FROM_RM_MATCH,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

    

    from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn epc on am.EPC_UPRN = epc.UPRN

    where MATCH_EPC = 'YES'
    and COMBINED_PROPERTY_TYPE not in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')
  -- AND RM_UPRN = 100030719363

)


select 'UPRN' as MATCH_TYPE, * from house_uprnmatch

union all

select 'ADDRESSID' as MATCH_TYPE, * from house_addmatch

/*
--THIS IS USED FOR A TEST
select RM_UPRN,COUNT(BUILDING_REFERENCE_NUMBER)
from house_uprnmatch
WHERE RM_UPRN IS NOT NULL
GROUP BY 1
HAVING COUNT(BUILDING_REFERENCE_NUMBER) >1
*/
        );
[0m16:36:37.049150 [debug] [Thread-7 (]: Using snowflake connection "model.rightmove_epc.flats_report"
[0m16:36:37.049354 [debug] [Thread-5 (]: Opening a new connection, currently in state closed
[0m16:36:37.049711 [debug] [Thread-7 (]: On model.rightmove_epc.flats_report: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.flats_report"} */
create or replace transient table ANALYTICS_DEV.dbt_melissa_rm_epc.flats_report
         as
        (with flat_addmatch as (

    select 
    distinct
    --count(LISTING_ID) as TOTAL_LISTINGS,
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN, -- NULL
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
 --   am.FLOOR_LEVEL as RM_FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    epc.ADDRESSID AS EPC_ADDRESSID,
    -- REMOVE_FROM_RM_MATCH,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

     from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc on am.EPC_ADDRESSID = epc.ADDRESSID
    and am.FULL_POSTCODE = epc.POSTCODE
    where MATCH_EPC = 'YES'
    and COMBINED_PROPERTY_TYPE in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')

),

flat_uprnmatch as (

    select 
    distinct
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN,
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    BUILDING_REFERENCE_NUMBER, 
    epc.ADDRESSID AS EPC_ADDRESSID,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

    

    from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn epc on am.EPC_UPRN = epc.UPRN

    where MATCH_EPC = 'YES'
   and COMBINED_PROPERTY_TYPE in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')
  -- AND RM_UPRN = 100030719363

),

flat_uprnmultimatch as (

    select 
    distinct
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN,
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    BUILDING_REFERENCE_NUMBER, 
    epc.ADDRESSID AS EPC_ADDRESSID,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

    

    from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match_flat am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn epc on am.EPC_UPRN = epc.UPRN

    where MATCH_EPC = 'YES'
   and COMBINED_PROPERTY_TYPE not in ('HOUSE / FLAT SHARE','FLAT / APARTMENT') -- this checks to ensure that houses listed on RightMove are included and matched to EPC as flats
  -- AND RM_UPRN = 100030719363

)



select 'UPRN' as MATCH_TYPE, * from flat_uprnmatch

union all

select 'ADDRESSID' as MATCH_TYPE, * from flat_addmatch

union all

select 'MULTIUPRN_EPC' as MATCH_TYPE, * from flat_uprnmultimatch

/*
--THIS IS USED FOR A TEST
select RM_UPRN,COUNT(BUILDING_REFERENCE_NUMBER)
from house_uprnmatch
WHERE RM_UPRN IS NOT NULL
GROUP BY 1
HAVING COUNT(BUILDING_REFERENCE_NUMBER) >1
*/
        );
[0m16:36:37.050460 [debug] [Thread-7 (]: Opening a new connection, currently in state closed
[0m16:36:37.778734 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:36:37.780266 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.uprn_address_match (execute): 16:36:36.762656 => 16:36:37.780160
[0m16:36:37.780463 [debug] [Thread-1 (]: On model.rightmove_epc.uprn_address_match: Close
[0m16:36:37.867016 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '108ac86d-fde0-4eed-b9ed-02c24e1b5e34', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1083ac7d0>]}
[0m16:36:37.867543 [info ] [Thread-1 (]: 15 of 20 OK created sql view model dbt_melissa_rm_epc.uprn_address_match ....... [[32mSUCCESS 1[0m in 1.11s]
[0m16:36:37.867923 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.uprn_address_match
[0m16:36:37.868316 [debug] [Thread-6 (]: Began running node model.rightmove_epc.rm_all_matches
[0m16:36:37.868571 [debug] [Thread-8 (]: Began running node model.rightmove_epc.rm_no_matches
[0m16:36:37.868821 [info ] [Thread-6 (]: 18 of 20 START sql table model dbt_melissa_rm_epc.rm_all_matches ............... [RUN]
[0m16:36:37.869082 [info ] [Thread-8 (]: 19 of 20 START sql table model dbt_melissa_rm_epc.rm_no_matches ................ [RUN]
[0m16:36:37.869479 [debug] [Thread-6 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.epc_flats_count, now model.rightmove_epc.rm_all_matches)
[0m16:36:37.869836 [debug] [Thread-8 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.uprn_match_flat, now model.rightmove_epc.rm_no_matches)
[0m16:36:37.870051 [debug] [Thread-6 (]: Began compiling node model.rightmove_epc.rm_all_matches
[0m16:36:37.870241 [debug] [Thread-8 (]: Began compiling node model.rightmove_epc.rm_no_matches
[0m16:36:37.872500 [debug] [Thread-6 (]: Writing injected SQL for node "model.rightmove_epc.rm_all_matches"
[0m16:36:37.874397 [debug] [Thread-8 (]: Writing injected SQL for node "model.rightmove_epc.rm_no_matches"
[0m16:36:37.875050 [debug] [Thread-8 (]: Timing info for model.rightmove_epc.rm_no_matches (compile): 16:36:37.872659 => 16:36:37.874889
[0m16:36:37.875333 [debug] [Thread-6 (]: Timing info for model.rightmove_epc.rm_all_matches (compile): 16:36:37.870361 => 16:36:37.875203
[0m16:36:37.875534 [debug] [Thread-8 (]: Began executing node model.rightmove_epc.rm_no_matches
[0m16:36:37.875758 [debug] [Thread-6 (]: Began executing node model.rightmove_epc.rm_all_matches
[0m16:36:37.878790 [debug] [Thread-8 (]: Writing runtime sql for node "model.rightmove_epc.rm_no_matches"
[0m16:36:37.880381 [debug] [Thread-6 (]: Writing runtime sql for node "model.rightmove_epc.rm_all_matches"
[0m16:36:37.881566 [debug] [Thread-8 (]: Using snowflake connection "model.rightmove_epc.rm_no_matches"
[0m16:36:37.882463 [debug] [Thread-6 (]: Using snowflake connection "model.rightmove_epc.rm_all_matches"
[0m16:36:37.882752 [debug] [Thread-8 (]: On model.rightmove_epc.rm_no_matches: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.rm_no_matches"} */
create or replace transient table ANALYTICS_DEV.dbt_melissa_rm_epc.rm_no_matches
         as
        (with addr as (

    select 
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN,
    EPC_ADDRESSID
    
    from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
    where MATCH_EPC = 'NO' 
),

uprn as (

    select 
    
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN::VARCHAR AS EPC_UPRN,
    EPC_ADDRESSID
    
     from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'NO'
),

uprn_address as (

        select 
    
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN::VARCHAR AS EPC_UPRN,
    EPC_ADDRESSID
    
     from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_address_match
    where MATCH_EPC = 'NO'
),

final as (

select 'NO ADDRESS MATCH' AS MATCH_RESULT, * from addr
union all
select 'NO UPRN MATCH' AS MATCH_RESULT, * from uprn
union select 'NO ADDRESS OR UPRN MATCH' AS MATCH_RESULT, * from uprn

)

select * from final
        );
[0m16:36:37.883071 [debug] [Thread-6 (]: On model.rightmove_epc.rm_all_matches: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.rm_all_matches"} */
create or replace transient table ANALYTICS_DEV.dbt_melissa_rm_epc.rm_all_matches
         as
        (with addr as (

    select 
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN,
    EPC_ADDRESSID
    
    from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
    where MATCH_EPC = 'YES' 
),

uprn_addr as (

    select 
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN,
    EPC_ADDRESSID
    
    from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_address_match
    where MATCH_EPC = 'YES' 
),

uprn as (

    select 
    
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN::VARCHAR AS EPC_UPRN,
    EPC_ADDRESSID

    from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'YES'
),

final as (

select 'ADDRESS AND POSTCODE MATCH' AS MATCH_RESULT, * from addr
union all
select 'UPRN MATCH' AS MATCH_RESULT, * from uprn
union all
select 'MATCH ADDRESS NO MATCH TO EPC UPRN' AS MATCH_RESULT, * from uprn
)

select * from final
        );
[0m16:36:37.883309 [debug] [Thread-8 (]: Opening a new connection, currently in state closed
[0m16:36:37.883499 [debug] [Thread-6 (]: Opening a new connection, currently in state closed
[0m16:37:23.247718 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 47.0 seconds
[0m16:37:23.250973 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.epc_flats (execute): 16:36:35.750016 => 16:37:23.250810
[0m16:37:23.251271 [debug] [Thread-2 (]: On model.rightmove_epc.epc_flats: Close
[0m16:37:23.330470 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '108ac86d-fde0-4eed-b9ed-02c24e1b5e34', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1085f9310>]}
[0m16:37:23.331153 [info ] [Thread-2 (]: 7 of 20 OK created sql table model dbt_melissa_rm_epc.epc_flats ................ [[32mSUCCESS 1[0m in 47.59s]
[0m16:37:23.331617 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.epc_flats
[0m16:39:28.601717 [debug] [Thread-8 (]: SQL status: SUCCESS 1 in 171.0 seconds
[0m16:39:28.605148 [debug] [Thread-8 (]: Timing info for model.rightmove_epc.rm_no_matches (execute): 16:36:37.875890 => 16:39:28.604973
[0m16:39:28.605527 [debug] [Thread-8 (]: On model.rightmove_epc.rm_no_matches: Close
[0m16:39:28.711899 [debug] [Thread-8 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '108ac86d-fde0-4eed-b9ed-02c24e1b5e34', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1099dc050>]}
[0m16:39:28.712489 [info ] [Thread-8 (]: 19 of 20 OK created sql table model dbt_melissa_rm_epc.rm_no_matches ........... [[32mSUCCESS 1[0m in 170.84s]
[0m16:39:28.712929 [debug] [Thread-8 (]: Finished running node model.rightmove_epc.rm_no_matches
[0m16:40:04.773449 [debug] [Thread-6 (]: SQL status: SUCCESS 1 in 207.0 seconds
[0m16:40:04.776572 [debug] [Thread-6 (]: Timing info for model.rightmove_epc.rm_all_matches (execute): 16:36:37.878969 => 16:40:04.776336
[0m16:40:04.777017 [debug] [Thread-6 (]: On model.rightmove_epc.rm_all_matches: Close
[0m16:40:04.906745 [debug] [Thread-6 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '108ac86d-fde0-4eed-b9ed-02c24e1b5e34', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10853ac10>]}
[0m16:40:04.907707 [info ] [Thread-6 (]: 18 of 20 OK created sql table model dbt_melissa_rm_epc.rm_all_matches .......... [[32mSUCCESS 1[0m in 207.04s]
[0m16:40:04.908411 [debug] [Thread-6 (]: Finished running node model.rightmove_epc.rm_all_matches
[0m16:40:20.404432 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 223.0 seconds
[0m16:40:20.406833 [debug] [Thread-5 (]: Timing info for model.rightmove_epc.houses_report (execute): 16:36:37.041125 => 16:40:20.406658
[0m16:40:20.407171 [debug] [Thread-5 (]: On model.rightmove_epc.houses_report: Close
[0m16:40:20.513389 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '108ac86d-fde0-4eed-b9ed-02c24e1b5e34', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10f357e90>]}
[0m16:40:20.514100 [info ] [Thread-5 (]: 17 of 20 OK created sql table model dbt_melissa_rm_epc.houses_report ........... [[32mSUCCESS 1[0m in 223.48s]
[0m16:40:20.514645 [debug] [Thread-5 (]: Finished running node model.rightmove_epc.houses_report
[0m16:40:30.628778 [debug] [Thread-7 (]: SQL status: SUCCESS 1 in 234.0 seconds
[0m16:40:30.630698 [debug] [Thread-7 (]: Timing info for model.rightmove_epc.flats_report (execute): 16:36:37.043099 => 16:40:30.630558
[0m16:40:30.630963 [debug] [Thread-7 (]: On model.rightmove_epc.flats_report: Close
[0m16:40:30.755373 [debug] [Thread-7 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '108ac86d-fde0-4eed-b9ed-02c24e1b5e34', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10853a710>]}
[0m16:40:30.755935 [info ] [Thread-7 (]: 16 of 20 OK created sql table model dbt_melissa_rm_epc.flats_report ............ [[32mSUCCESS 1[0m in 233.72s]
[0m16:40:30.756312 [debug] [Thread-7 (]: Finished running node model.rightmove_epc.flats_report
[0m16:40:30.756783 [debug] [Thread-4 (]: Began running node model.rightmove_epc.zero_bedrooms
[0m16:40:30.757175 [info ] [Thread-4 (]: 20 of 20 START sql table model dbt_melissa_rm_epc.zero_bedrooms ................ [RUN]
[0m16:40:30.757726 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.no_uprn_match, now model.rightmove_epc.zero_bedrooms)
[0m16:40:30.757993 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.zero_bedrooms
[0m16:40:30.760711 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.zero_bedrooms"
[0m16:40:30.761278 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.zero_bedrooms (compile): 16:40:30.758150 => 16:40:30.761152
[0m16:40:30.761495 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.zero_bedrooms
[0m16:40:30.763312 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.zero_bedrooms"
[0m16:40:30.764006 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.zero_bedrooms"
[0m16:40:30.764253 [debug] [Thread-4 (]: On model.rightmove_epc.zero_bedrooms: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.zero_bedrooms"} */
create or replace transient table ANALYTICS_DEV.dbt_melissa_rm_epc.zero_bedrooms
         as
        (with houses as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.houses_report
    where BEDROOM = 0
),

flats as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.flats_report
        where BEDROOM = 0

)

select * from flats
union all
select * from houses
        );
[0m16:40:30.764477 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m16:40:33.245536 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m16:40:33.247544 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.zero_bedrooms (execute): 16:40:30.761619 => 16:40:33.247399
[0m16:40:33.247811 [debug] [Thread-4 (]: On model.rightmove_epc.zero_bedrooms: Close
[0m16:40:33.323933 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '108ac86d-fde0-4eed-b9ed-02c24e1b5e34', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1099d76d0>]}
[0m16:40:33.324513 [info ] [Thread-4 (]: 20 of 20 OK created sql table model dbt_melissa_rm_epc.zero_bedrooms ........... [[32mSUCCESS 1[0m in 2.57s]
[0m16:40:33.324904 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.zero_bedrooms
[0m16:40:33.326525 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:40:33.326784 [debug] [MainThread]: Connection 'model.rightmove_epc.uprn_address_match' was properly closed.
[0m16:40:33.326970 [debug] [MainThread]: Connection 'model.rightmove_epc.epc_flats' was properly closed.
[0m16:40:33.327316 [debug] [MainThread]: Connection 'model.rightmove_epc.uprn_match' was properly closed.
[0m16:40:33.327555 [debug] [MainThread]: Connection 'model.rightmove_epc.houses_report' was properly closed.
[0m16:40:33.327740 [debug] [MainThread]: Connection 'model.rightmove_epc.flats_report' was properly closed.
[0m16:40:33.327913 [debug] [MainThread]: Connection 'model.rightmove_epc.rm_no_matches' was properly closed.
[0m16:40:33.328086 [debug] [MainThread]: Connection 'model.rightmove_epc.rm_all_matches' was properly closed.
[0m16:40:33.328253 [debug] [MainThread]: Connection 'model.rightmove_epc.zero_bedrooms' was properly closed.
[0m16:40:33.328527 [info ] [MainThread]: 
[0m16:40:33.328753 [info ] [MainThread]: Finished running 13 view models, 7 table models in 0 hours 4 minutes and 0.07 seconds (240.07s).
[0m16:40:33.330211 [debug] [MainThread]: Command end result
[0m16:40:33.337465 [info ] [MainThread]: 
[0m16:40:33.337902 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m16:40:33.338138 [info ] [MainThread]: 
[0m16:40:33.338338 [error] [MainThread]:   Database Error in model rm_listings (models/reports/rm_listings.sql)
  001003 (42000): SQL compilation error:
  syntax error line 23 at position 10 unexpected 'as'.
  syntax error line 28 at position 4 unexpected 'from'.
  syntax error line 34 at position 0 unexpected 'select'.
  compiled Code at target/run/rightmove_epc/models/reports/rm_listings.sql
[0m16:40:33.338547 [info ] [MainThread]: 
[0m16:40:33.338728 [info ] [MainThread]: Done. PASS=19 WARN=0 ERROR=1 SKIP=0 TOTAL=20
[0m16:40:33.340202 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 240.38144, "process_user_time": 1.841654, "process_kernel_time": 0.217018, "process_mem_max_rss": "145539072", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m16:40:33.340672 [debug] [MainThread]: Command `dbt run` failed at 16:40:33.340583 after 240.38 seconds
[0m16:40:33.340925 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107508710>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100a0a110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100b0e250>]}
[0m16:40:33.341140 [debug] [MainThread]: Flushing usage events
[0m16:47:56.775882 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107c541d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107c81510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107c9ac50>]}


============================== 16:47:56.778721 | 2a615db8-b571-4b2b-83c7-4e5c1a9b5cf9 ==============================
[0m16:47:56.778721 [info ] [MainThread]: Running with dbt=1.7.10
[0m16:47:56.779069 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m16:47:56.959455 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2a615db8-b571-4b2b-83c7-4e5c1a9b5cf9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107ce4610>]}
[0m16:47:56.996474 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2a615db8-b571-4b2b-83c7-4e5c1a9b5cf9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10882b4d0>]}
[0m16:47:56.997205 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m16:47:57.007160 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m16:47:57.033771 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m16:47:57.034059 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m16:47:57.037488 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2a615db8-b571-4b2b-83c7-4e5c1a9b5cf9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108ba5850>]}
[0m16:47:57.043930 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2a615db8-b571-4b2b-83c7-4e5c1a9b5cf9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108a9fb10>]}
[0m16:47:57.044166 [info ] [MainThread]: Found 20 models, 1 analysis, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m16:47:57.044355 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2a615db8-b571-4b2b-83c7-4e5c1a9b5cf9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1086eca50>]}
[0m16:47:57.045585 [info ] [MainThread]: 
[0m16:47:57.045988 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m16:47:57.046787 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m16:47:57.053221 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m16:47:57.053457 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m16:47:57.053610 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:47:57.584378 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 1.0 seconds
[0m16:47:57.588770 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m16:47:57.679984 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m16:47:57.689341 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m16:47:57.689790 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m16:47:57.690101 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:47:58.112025 [debug] [ThreadPool]: SQL status: SUCCESS 21 in 0.0 seconds
[0m16:47:58.114344 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m16:47:58.201093 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2a615db8-b571-4b2b-83c7-4e5c1a9b5cf9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106fb66d0>]}
[0m16:47:58.201819 [info ] [MainThread]: Concurrency: 8 threads (target='dev')
[0m16:47:58.202092 [info ] [MainThread]: 
[0m16:47:58.204700 [debug] [Thread-1 (]: Began running node model.rightmove_epc.dim_uprn
[0m16:47:58.204985 [debug] [Thread-2 (]: Began running node model.rightmove_epc.stg_epc_certs
[0m16:47:58.205309 [debug] [Thread-3 (]: Began running node model.rightmove_epc.stg_rightmove
[0m16:47:58.205756 [info ] [Thread-1 (]: 1 of 20 START sql view model dbt_melissa_rm_epc.dim_uprn ....................... [RUN]
[0m16:47:58.206140 [info ] [Thread-2 (]: 2 of 20 START sql view model dbt_melissa_rm_epc.stg_epc_certs .................. [RUN]
[0m16:47:58.207699 [info ] [Thread-3 (]: 3 of 20 START sql view model dbt_melissa_rm_epc.stg_rightmove .................. [RUN]
[0m16:47:58.208396 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.dim_uprn)
[0m16:47:58.209038 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.stg_epc_certs'
[0m16:47:58.209601 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.rightmove_epc.stg_rightmove'
[0m16:47:58.209886 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.dim_uprn
[0m16:47:58.210141 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.stg_epc_certs
[0m16:47:58.210403 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.stg_rightmove
[0m16:47:58.245826 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.dim_uprn"
[0m16:47:58.247493 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.stg_epc_certs"
[0m16:47:58.248824 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.stg_rightmove"
[0m16:47:58.249289 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.dim_uprn (compile): 16:47:58.210584 => 16:47:58.249182
[0m16:47:58.249508 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_epc_certs (compile): 16:47:58.246058 => 16:47:58.249387
[0m16:47:58.249695 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.dim_uprn
[0m16:47:58.249872 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.stg_epc_certs
[0m16:47:58.250042 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.stg_rightmove (compile): 16:47:58.247636 => 16:47:58.249958
[0m16:47:58.262879 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.dim_uprn"
[0m16:47:58.264381 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.stg_epc_certs"
[0m16:47:58.264595 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.stg_rightmove
[0m16:47:58.266213 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.stg_rightmove"
[0m16:47:58.267057 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.dim_uprn"
[0m16:47:58.267273 [debug] [Thread-1 (]: On model.rightmove_epc.dim_uprn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_uprn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE UPRNS


with epc as (

   select distinct
    epc.uprn,
    epc.addressid,
    epc.ADDRESS,
    'EPC' AS datasource,
    epc.POSTCODE,
    case when multi.uprn is null then NULL else 1 end as MULTI_UPRN

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc
    left join ANALYTICS_DEV.dbt_melissa_rm_epc.epc_flats_count multi on epc.uprn = multi.uprn

    where epc.REMOVE_FROM_RM_MATCH = 0
    AND epc.UPRN IS NOT NULL
    
),

rightmove as (

 select distinct
    rm.uprn,
    rm.addressid,
    concat(rm.ADDRESS_1,',',rm.ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    rm.FULL_POSTCODE AS POSTCODE,
    multi.LISTING_COUNT AS MULTI_UPRN

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove rm
    left join ANALYTICS_DEV.dbt_melissa_rm_epc.false_listings_count multi on rm.uprn = multi.uprn
    WHERE rm.UPRN IS NOT NULL


),

final as (

    select * from epc
    union all
    select * from rightmove
)

select distinct * from final
  );
[0m16:47:58.267523 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:47:58.268084 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.stg_epc_certs"
[0m16:47:58.268540 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.stg_rightmove"
[0m16:47:58.269082 [debug] [Thread-2 (]: On model.rightmove_epc.stg_epc_certs: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_epc_certs"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
  
   as (
    WITH epc_certs as (
    
    select 
    UPRN,
    LODGEMENT_DATE,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
   -- COUNTY,
    LOCAL_AUTHORITY as LOCAL_AUTHORITY_CODE,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    UPPER(CASE WHEN (UPPER(ADDRESS1) LIKE 'FLAT%' OR UPPER(ADDRESS1) LIKE 'UNIT%') or UPPER(ADDRESS1) LIKE 'ROOM%' 
    THEN TRIM(REPLACE(REPLACE(CONCAT(ADDRESS),','),' '))
    ELSE trim(replace(replace(ADDRESS1,' '),',')) END) AS ADDRESSID,
    CASE WHEN UPRN is null and addressid is null THEN 1 else 0 end as REMOVE_FROM_RM_MATCH,
    FLOOR_LEVEL,
    FLAT_TOP_STOREY,
    FLAT_STOREY_COUNT,
    PROPERTY_TYPE
 from  RAW.EPC_TEST_DATA.EPC_CERTIFICATES 

)

SELECT * FROM epc_certs
  );
[0m16:47:58.269482 [debug] [Thread-3 (]: On model.rightmove_epc.stg_rightmove: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_rightmove"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
  
   as (
    with rm as (

    SELECT 
    LISTING_ID, 
    CHANGE_DATE,
    UPPER(TRIM(replace(REPLACE(CONCAT(ADDRESS_1::VARCHAR,ADDRESS_2::VARCHAR),' '),','))) AS ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, 
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    BEDROOM,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    BRANCH_ID,
	 BRANCH_NAME,
    WEBSITE_URL,
	 COMPANY_NAME
    FROM 
       ANALYTICS.RIGHTMOVE_PROD.CLEAN_RAW_RIGHTMOVE_DATA 

 
)

SELECT * FROM rm
  );
[0m16:47:58.269699 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m16:47:58.269875 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m16:47:58.725594 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m16:47:58.739578 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stg_epc_certs (execute): 16:47:58.263004 => 16:47:58.739432
[0m16:47:58.739880 [debug] [Thread-2 (]: On model.rightmove_epc.stg_epc_certs: Close
[0m16:47:58.804324 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:47:58.806529 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.stg_rightmove (execute): 16:47:58.264846 => 16:47:58.806364
[0m16:47:58.806867 [debug] [Thread-3 (]: On model.rightmove_epc.stg_rightmove: Close
[0m16:47:58.818883 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2a615db8-b571-4b2b-83c7-4e5c1a9b5cf9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107350d50>]}
[0m16:47:58.819389 [info ] [Thread-2 (]: 2 of 20 OK created sql view model dbt_melissa_rm_epc.stg_epc_certs ............. [[32mSUCCESS 1[0m in 0.61s]
[0m16:47:58.819820 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.stg_epc_certs
[0m16:47:58.820349 [debug] [Thread-5 (]: Began running node model.rightmove_epc.latest_epc_urn
[0m16:47:58.820730 [info ] [Thread-5 (]: 4 of 20 START sql view model dbt_melissa_rm_epc.latest_epc_urn ................. [RUN]
[0m16:47:58.821307 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.rightmove_epc.latest_epc_urn'
[0m16:47:58.821555 [debug] [Thread-5 (]: Began compiling node model.rightmove_epc.latest_epc_urn
[0m16:47:58.823961 [debug] [Thread-5 (]: Writing injected SQL for node "model.rightmove_epc.latest_epc_urn"
[0m16:47:58.825528 [debug] [Thread-5 (]: Timing info for model.rightmove_epc.latest_epc_urn (compile): 16:47:58.821707 => 16:47:58.825364
[0m16:47:58.825794 [debug] [Thread-5 (]: Began executing node model.rightmove_epc.latest_epc_urn
[0m16:47:58.828003 [debug] [Thread-5 (]: Writing runtime sql for node "model.rightmove_epc.latest_epc_urn"
[0m16:47:58.828953 [debug] [Thread-5 (]: Using snowflake connection "model.rightmove_epc.latest_epc_urn"
[0m16:47:58.829250 [debug] [Thread-5 (]: On model.rightmove_epc.latest_epc_urn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.latest_epc_urn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn
  
   as (
    with epc_max_date as (

    select uprn as UPRN_EPC,
    MAX(LODGEMENT_DATE) AS MAX_LODGEMENT_DATE,
    from  ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    group by 1


),

latest_epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc
    inner join epc_max_date on epc.uprn = epc_max_date.UPRN_EPC
    where MAX_LODGEMENT_DATE = LODGEMENT_DATE
   -- and uprn = 200073066

)

select DISTINCT * from latest_epc


/*
select uprn, count(*) from latest_epc
group by 1
having count(*) >1
*/
  );
[0m16:47:58.829491 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m16:47:58.891223 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2a615db8-b571-4b2b-83c7-4e5c1a9b5cf9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108cf07d0>]}
[0m16:47:58.891733 [info ] [Thread-3 (]: 3 of 20 OK created sql view model dbt_melissa_rm_epc.stg_rightmove ............. [[32mSUCCESS 1[0m in 0.68s]
[0m16:47:58.892086 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.stg_rightmove
[0m16:47:58.892456 [debug] [Thread-7 (]: Began running node model.rightmove_epc.dim_addressid
[0m16:47:58.892691 [debug] [Thread-8 (]: Began running node model.rightmove_epc.latest_rm_urn
[0m16:47:58.892926 [info ] [Thread-7 (]: 5 of 20 START sql view model dbt_melissa_rm_epc.dim_addressid .................. [RUN]
[0m16:47:58.893169 [info ] [Thread-8 (]: 6 of 20 START sql view model dbt_melissa_rm_epc.latest_rm_urn .................. [RUN]
[0m16:47:58.893578 [debug] [Thread-7 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_addressid'
[0m16:47:58.893906 [debug] [Thread-8 (]: Acquiring new snowflake connection 'model.rightmove_epc.latest_rm_urn'
[0m16:47:58.894082 [debug] [Thread-7 (]: Began compiling node model.rightmove_epc.dim_addressid
[0m16:47:58.894244 [debug] [Thread-8 (]: Began compiling node model.rightmove_epc.latest_rm_urn
[0m16:47:58.896927 [debug] [Thread-7 (]: Writing injected SQL for node "model.rightmove_epc.dim_addressid"
[0m16:47:58.898265 [debug] [Thread-8 (]: Writing injected SQL for node "model.rightmove_epc.latest_rm_urn"
[0m16:47:58.898843 [debug] [Thread-7 (]: Timing info for model.rightmove_epc.dim_addressid (compile): 16:47:58.894349 => 16:47:58.898730
[0m16:47:58.899040 [debug] [Thread-7 (]: Began executing node model.rightmove_epc.dim_addressid
[0m16:47:58.899272 [debug] [Thread-8 (]: Timing info for model.rightmove_epc.latest_rm_urn (compile): 16:47:58.897071 => 16:47:58.899153
[0m16:47:58.901074 [debug] [Thread-7 (]: Writing runtime sql for node "model.rightmove_epc.dim_addressid"
[0m16:47:58.901337 [debug] [Thread-8 (]: Began executing node model.rightmove_epc.latest_rm_urn
[0m16:47:58.903293 [debug] [Thread-8 (]: Writing runtime sql for node "model.rightmove_epc.latest_rm_urn"
[0m16:47:58.904060 [debug] [Thread-7 (]: Using snowflake connection "model.rightmove_epc.dim_addressid"
[0m16:47:58.904286 [debug] [Thread-7 (]: On model.rightmove_epc.dim_addressid: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_addressid"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE ADDRESS'

with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource,
    POSTCODE
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs 
    where REMOVE_FROM_RM_MATCH = 0
    AND ADDRESSID IS NOT NULL

),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    WHERE ADDRESSID IS NOT NULL

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where addressid is not null
  );
[0m16:47:58.904781 [debug] [Thread-8 (]: Using snowflake connection "model.rightmove_epc.latest_rm_urn"
[0m16:47:58.904989 [debug] [Thread-7 (]: Opening a new connection, currently in state init
[0m16:47:58.905190 [debug] [Thread-8 (]: On model.rightmove_epc.latest_rm_urn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.latest_rm_urn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NOT NULL
),

change_date AS (
    SELECT 
        UPRN AS UPRN_CD, 
        MAX(CHANGE_DATE) AS MAX_CHANGE_DATE 
    FROM rm
    GROUP BY UPRN
),

rm_latest as (

    SELECT distinct * FROM rm
    LEFT JOIN change_date cd
    ON rm.UPRN = cd.UPRN_CD
    WHERE cd.MAX_CHANGE_DATE = rm.CHANGE_DATE 
 --  and UPRN = 100090588560
    
)

select DISTINCT * from rm_latest

/*
select uprn, count(*) from rm_latest
group by 1
having count(*) >1
*/
  );
[0m16:47:58.905745 [debug] [Thread-8 (]: Opening a new connection, currently in state init
[0m16:47:58.932357 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:47:58.933845 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.dim_uprn (execute): 16:47:58.250143 => 16:47:58.933743
[0m16:47:58.934054 [debug] [Thread-1 (]: On model.rightmove_epc.dim_uprn: Close
[0m16:47:59.022575 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2a615db8-b571-4b2b-83c7-4e5c1a9b5cf9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108a10890>]}
[0m16:47:59.023022 [info ] [Thread-1 (]: 1 of 20 OK created sql view model dbt_melissa_rm_epc.dim_uprn .................. [[32mSUCCESS 1[0m in 0.81s]
[0m16:47:59.023315 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.dim_uprn
[0m16:47:59.311097 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m16:47:59.312813 [debug] [Thread-5 (]: Timing info for model.rightmove_epc.latest_epc_urn (execute): 16:47:58.825936 => 16:47:59.312697
[0m16:47:59.313039 [debug] [Thread-5 (]: On model.rightmove_epc.latest_epc_urn: Close
[0m16:47:59.390348 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2a615db8-b571-4b2b-83c7-4e5c1a9b5cf9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108cf0490>]}
[0m16:47:59.390835 [info ] [Thread-5 (]: 4 of 20 OK created sql view model dbt_melissa_rm_epc.latest_epc_urn ............ [[32mSUCCESS 1[0m in 0.57s]
[0m16:47:59.391184 [debug] [Thread-5 (]: Finished running node model.rightmove_epc.latest_epc_urn
[0m16:47:59.391567 [debug] [Thread-2 (]: Began running node model.rightmove_epc.epc_flats
[0m16:47:59.391821 [debug] [Thread-6 (]: Began running node model.rightmove_epc.epc_flats_count
[0m16:47:59.392093 [info ] [Thread-2 (]: 7 of 20 START sql table model dbt_melissa_rm_epc.epc_flats ..................... [RUN]
[0m16:47:59.392364 [info ] [Thread-6 (]: 8 of 20 START sql view model dbt_melissa_rm_epc.epc_flats_count ................ [RUN]
[0m16:47:59.392786 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_epc_certs, now model.rightmove_epc.epc_flats)
[0m16:47:59.393270 [debug] [Thread-6 (]: Acquiring new snowflake connection 'model.rightmove_epc.epc_flats_count'
[0m16:47:59.393520 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.epc_flats
[0m16:47:59.393729 [debug] [Thread-6 (]: Began compiling node model.rightmove_epc.epc_flats_count
[0m16:47:59.395732 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.epc_flats"
[0m16:47:59.397201 [debug] [Thread-6 (]: Writing injected SQL for node "model.rightmove_epc.epc_flats_count"
[0m16:47:59.397772 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.epc_flats (compile): 16:47:59.393897 => 16:47:59.397661
[0m16:47:59.398004 [debug] [Thread-6 (]: Timing info for model.rightmove_epc.epc_flats_count (compile): 16:47:59.395872 => 16:47:59.397885
[0m16:47:59.398173 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.epc_flats
[0m16:47:59.398349 [debug] [Thread-6 (]: Began executing node model.rightmove_epc.epc_flats_count
[0m16:47:59.408643 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.epc_flats"
[0m16:47:59.410503 [debug] [Thread-6 (]: Writing runtime sql for node "model.rightmove_epc.epc_flats_count"
[0m16:47:59.411256 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.epc_flats"
[0m16:47:59.411653 [debug] [Thread-6 (]: Using snowflake connection "model.rightmove_epc.epc_flats_count"
[0m16:47:59.411843 [debug] [Thread-2 (]: On model.rightmove_epc.epc_flats: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.epc_flats"} */
create or replace transient table ANALYTICS_DEV.dbt_melissa_rm_epc.epc_flats
         as
        (with epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn

),

flat_epc as (

    select uprn,
    count(BUILDING_REFERENCE_NUMBER) as building_ref_count
    from epc
    group by 1
    having count(BUILDING_REFERENCE_NUMBER) >1

),

match_flat_epc as (

    select epc.*,
    building_ref_count
    from epc
    inner join flat_epc on epc.uprn = flat_epc.uprn

)

select * from match_flat_epc
        );
[0m16:47:59.412060 [debug] [Thread-6 (]: On model.rightmove_epc.epc_flats_count: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.epc_flats_count"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.epc_flats_count
  
   as (
    with epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn

),

flat_epc as (

    select uprn,
    count(BUILDING_REFERENCE_NUMBER) as building_ref_count
    from epc
    group by 1
    having count(BUILDING_REFERENCE_NUMBER) >1

)

select * from flat_epc
  );
[0m16:47:59.412243 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m16:47:59.412415 [debug] [Thread-6 (]: Opening a new connection, currently in state init
[0m16:47:59.436989 [debug] [Thread-7 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:47:59.438452 [debug] [Thread-7 (]: Timing info for model.rightmove_epc.dim_addressid (execute): 16:47:58.899426 => 16:47:59.438348
[0m16:47:59.438645 [debug] [Thread-7 (]: On model.rightmove_epc.dim_addressid: Close
[0m16:47:59.460533 [debug] [Thread-8 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:47:59.462277 [debug] [Thread-8 (]: Timing info for model.rightmove_epc.latest_rm_urn (execute): 16:47:58.901559 => 16:47:59.462175
[0m16:47:59.462497 [debug] [Thread-8 (]: On model.rightmove_epc.latest_rm_urn: Close
[0m16:47:59.543048 [debug] [Thread-7 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2a615db8-b571-4b2b-83c7-4e5c1a9b5cf9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108cf30d0>]}
[0m16:47:59.543516 [info ] [Thread-7 (]: 5 of 20 OK created sql view model dbt_melissa_rm_epc.dim_addressid ............. [[32mSUCCESS 1[0m in 0.65s]
[0m16:47:59.543821 [debug] [Thread-7 (]: Finished running node model.rightmove_epc.dim_addressid
[0m16:47:59.544163 [debug] [Thread-4 (]: Began running node model.rightmove_epc.address_match
[0m16:47:59.544412 [info ] [Thread-4 (]: 9 of 20 START sql view model dbt_melissa_rm_epc.address_match .................. [RUN]
[0m16:47:59.544806 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.rightmove_epc.address_match'
[0m16:47:59.544990 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.address_match
[0m16:47:59.546992 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.address_match"
[0m16:47:59.547741 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.address_match (compile): 16:47:59.545122 => 16:47:59.547568
[0m16:47:59.548038 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.address_match
[0m16:47:59.551479 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.address_match"
[0m16:47:59.552809 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.address_match"
[0m16:47:59.553266 [debug] [Thread-8 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2a615db8-b571-4b2b-83c7-4e5c1a9b5cf9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1086938d0>]}
[0m16:47:59.553530 [debug] [Thread-4 (]: On model.rightmove_epc.address_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.address_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NULL

),



epc_address as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
    where datasource = 'EPC'
    
)


SELECT rm.*,
CASE WHEN epc_address.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_address.ADDRESSID AS EPC_ADDRESSID,
epc_address.UPRN AS EPC_UPRN


FROM rm
LEFT JOIN epc_address
ON rm.addressid = epc_address.addressid
and rm.FULL_POSTCODE = epc_address.POSTCODE
  );
[0m16:47:59.553865 [info ] [Thread-8 (]: 6 of 20 OK created sql view model dbt_melissa_rm_epc.latest_rm_urn ............. [[32mSUCCESS 1[0m in 0.66s]
[0m16:47:59.554072 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m16:47:59.554325 [debug] [Thread-8 (]: Finished running node model.rightmove_epc.latest_rm_urn
[0m16:47:59.555400 [debug] [Thread-5 (]: Began running node model.rightmove_epc.no_uprn_match
[0m16:47:59.555665 [debug] [Thread-3 (]: Began running node model.rightmove_epc.rm_listings
[0m16:47:59.556165 [debug] [Thread-7 (]: Began running node model.rightmove_epc.rm_listings_count
[0m16:47:59.556429 [debug] [Thread-1 (]: Began running node model.rightmove_epc.uprn_match
[0m16:47:59.555980 [info ] [Thread-5 (]: 10 of 20 START sql view model dbt_melissa_rm_epc.no_uprn_match ................. [RUN]
[0m16:47:59.556743 [debug] [Thread-8 (]: Began running node model.rightmove_epc.uprn_match_flat
[0m16:47:59.557277 [info ] [Thread-3 (]: 11 of 20 START sql table model dbt_melissa_rm_epc.rm_listings .................. [RUN]
[0m16:47:59.557561 [info ] [Thread-7 (]: 12 of 20 START sql view model dbt_melissa_rm_epc.rm_listings_count ............. [RUN]
[0m16:47:59.557800 [info ] [Thread-1 (]: 13 of 20 START sql view model dbt_melissa_rm_epc.uprn_match .................... [RUN]
[0m16:47:59.558185 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.latest_epc_urn, now model.rightmove_epc.no_uprn_match)
[0m16:47:59.558426 [info ] [Thread-8 (]: 14 of 20 START sql view model dbt_melissa_rm_epc.uprn_match_flat ............... [RUN]
[0m16:47:59.558775 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_rightmove, now model.rightmove_epc.rm_listings)
[0m16:47:59.559063 [debug] [Thread-7 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.dim_addressid, now model.rightmove_epc.rm_listings_count)
[0m16:47:59.559353 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.dim_uprn, now model.rightmove_epc.uprn_match)
[0m16:47:59.559542 [debug] [Thread-5 (]: Began compiling node model.rightmove_epc.no_uprn_match
[0m16:47:59.559815 [debug] [Thread-8 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.latest_rm_urn, now model.rightmove_epc.uprn_match_flat)
[0m16:47:59.559993 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.rm_listings
[0m16:47:59.560163 [debug] [Thread-7 (]: Began compiling node model.rightmove_epc.rm_listings_count
[0m16:47:59.560325 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.uprn_match
[0m16:47:59.562020 [debug] [Thread-5 (]: Writing injected SQL for node "model.rightmove_epc.no_uprn_match"
[0m16:47:59.562209 [debug] [Thread-8 (]: Began compiling node model.rightmove_epc.uprn_match_flat
[0m16:47:59.563569 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.rm_listings"
[0m16:47:59.565209 [debug] [Thread-7 (]: Writing injected SQL for node "model.rightmove_epc.rm_listings_count"
[0m16:47:59.567035 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.uprn_match"
[0m16:47:59.568933 [debug] [Thread-8 (]: Writing injected SQL for node "model.rightmove_epc.uprn_match_flat"
[0m16:47:59.569444 [debug] [Thread-5 (]: Timing info for model.rightmove_epc.no_uprn_match (compile): 16:47:59.560426 => 16:47:59.569310
[0m16:47:59.569779 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.rm_listings (compile): 16:47:59.562315 => 16:47:59.569617
[0m16:47:59.570099 [debug] [Thread-7 (]: Timing info for model.rightmove_epc.rm_listings_count (compile): 16:47:59.563775 => 16:47:59.569991
[0m16:47:59.570291 [debug] [Thread-5 (]: Began executing node model.rightmove_epc.no_uprn_match
[0m16:47:59.570500 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.uprn_match (compile): 16:47:59.565453 => 16:47:59.570413
[0m16:47:59.570708 [debug] [Thread-8 (]: Timing info for model.rightmove_epc.uprn_match_flat (compile): 16:47:59.567340 => 16:47:59.570618
[0m16:47:59.570877 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.rm_listings
[0m16:47:59.571092 [debug] [Thread-7 (]: Began executing node model.rightmove_epc.rm_listings_count
[0m16:47:59.573022 [debug] [Thread-5 (]: Writing runtime sql for node "model.rightmove_epc.no_uprn_match"
[0m16:47:59.573294 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.uprn_match
[0m16:47:59.573486 [debug] [Thread-8 (]: Began executing node model.rightmove_epc.uprn_match_flat
[0m16:47:59.574909 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.rm_listings"
[0m16:47:59.576378 [debug] [Thread-7 (]: Writing runtime sql for node "model.rightmove_epc.rm_listings_count"
[0m16:47:59.578075 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.uprn_match"
[0m16:47:59.579834 [debug] [Thread-8 (]: Writing runtime sql for node "model.rightmove_epc.uprn_match_flat"
[0m16:47:59.580444 [debug] [Thread-5 (]: Using snowflake connection "model.rightmove_epc.no_uprn_match"
[0m16:47:59.581338 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.rm_listings"
[0m16:47:59.581766 [debug] [Thread-5 (]: On model.rightmove_epc.no_uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.no_uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.no_uprn_match
  
   as (
    with rm_latest as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn 
    where UPRN IS NOT NULL
),

epc_uprn as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
    where datasource = 'EPC'
)


SELECT rm_latest.*,
CASE WHEN epc_uprn.UPRN is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_uprn.UPRN AS EPC_UPRN,
epc_uprn.ADDRESSID AS EPC_ADDRESSID


FROM rm_latest
LEFT JOIN epc_uprn
ON rm_latest.UPRN = epc_uprn.UPRN

WHERE MATCH_EPC = 'NO'
  );
[0m16:47:59.582133 [debug] [Thread-7 (]: Using snowflake connection "model.rightmove_epc.rm_listings_count"
[0m16:47:59.582336 [debug] [Thread-3 (]: On model.rightmove_epc.rm_listings: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.rm_listings"} */
create or replace transient table ANALYTICS_DEV.dbt_melissa_rm_epc.rm_listings
         as
        (with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn
   --- where uprn = 100013137

),

false_rm as (

    select 
    uprn,
    count(LISTING_ID) listing_count
    from rm
    group by 1
--having count(LISTING_ID) >1

)

select * from false_rm

get_false as (

    select rm.*,
    listing_count

    from rm
    inner join false_rm
    on rm.uprn = false_rm.uprn

)

select * from get_false
order by uprn
        );
[0m16:47:59.582997 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.uprn_match"
[0m16:47:59.583223 [debug] [Thread-5 (]: Opening a new connection, currently in state closed
[0m16:47:59.583818 [debug] [Thread-8 (]: Using snowflake connection "model.rightmove_epc.uprn_match_flat"
[0m16:47:59.584047 [debug] [Thread-7 (]: On model.rightmove_epc.rm_listings_count: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.rm_listings_count"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.rm_listings_count
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn

),

false_rm as (

    select 
    uprn,
    count(LISTING_ID) listing_count
    from rm
    group by 1
   -- having count(LISTING_ID) >1

)

select * from false_rm
  );
[0m16:47:59.584239 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m16:47:59.584444 [debug] [Thread-1 (]: On model.rightmove_epc.uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
  
   as (
    with rm_latest as (

    select rm.*,
    multi.uprn AS multi_uprn
    from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn rm
    left join ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn multi on rm.uprn = multi.uprn
    where rm.UPRN IS NOT NULL
    and multi.datasource = 'RIGHTMOVE'
   
),

epc_uprn as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
    where datasource = 'EPC'
    and multi_uprn is null  -- we do not use UPRN to match addresses with multiple URNs as they are flats and could fall into House report
)


SELECT rm_latest.*,
CASE WHEN epc_uprn.UPRN is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_uprn.UPRN AS EPC_UPRN,
epc_uprn.ADDRESSID AS EPC_ADDRESSID


FROM rm_latest
LEFT JOIN epc_uprn
ON rm_latest.UPRN = epc_uprn.UPRN

--WHERE MATCH_EPC = 'YES'
  );
[0m16:47:59.585054 [debug] [Thread-8 (]: On model.rightmove_epc.uprn_match_flat: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.uprn_match_flat"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match_flat
  
   as (
    with rm_latest as (

    select rm.*,
    multi.uprn AS multi_uprn
    from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn rm
    left join ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn multi on rm.uprn = multi.uprn
    where rm.UPRN IS NOT NULL
    and multi.datasource = 'RIGHTMOVE'
   
),

epc_uprn as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
    where datasource = 'EPC'
    and multi_uprn is not null  -- we do not use UPRN to match addresses with multiple URNs as they are flats and could fall into House report
)


SELECT rm_latest.*,
CASE WHEN epc_uprn.UPRN is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_uprn.UPRN AS EPC_UPRN,
epc_uprn.ADDRESSID AS EPC_ADDRESSID


FROM rm_latest
LEFT JOIN epc_uprn
ON rm_latest.UPRN = epc_uprn.UPRN

--WHERE MATCH_EPC = 'YES'
  );
[0m16:47:59.585461 [debug] [Thread-7 (]: Opening a new connection, currently in state closed
[0m16:47:59.585882 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:47:59.586191 [debug] [Thread-8 (]: Opening a new connection, currently in state closed
[0m16:47:59.915109 [debug] [Thread-6 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:47:59.917460 [debug] [Thread-6 (]: Timing info for model.rightmove_epc.epc_flats_count (execute): 16:47:59.408854 => 16:47:59.917314
[0m16:47:59.917962 [debug] [Thread-3 (]: Snowflake adapter: Snowflake query id: 01b3458f-0103-9b63-0000-719506379b0e
[0m16:47:59.918237 [debug] [Thread-6 (]: On model.rightmove_epc.epc_flats_count: Close
[0m16:47:59.918526 [debug] [Thread-3 (]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 23 at position 10 unexpected 'as'.
syntax error line 28 at position 4 unexpected 'from'.
syntax error line 34 at position 0 unexpected 'select'.
[0m16:47:59.919492 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.rm_listings (execute): 16:47:59.573608 => 16:47:59.919353
[0m16:47:59.919968 [debug] [Thread-3 (]: On model.rightmove_epc.rm_listings: Close
[0m16:48:00.020374 [debug] [Thread-6 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2a615db8-b571-4b2b-83c7-4e5c1a9b5cf9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1086ef950>]}
[0m16:48:00.020933 [info ] [Thread-6 (]: 8 of 20 OK created sql view model dbt_melissa_rm_epc.epc_flats_count ........... [[32mSUCCESS 1[0m in 0.63s]
[0m16:48:00.021394 [debug] [Thread-6 (]: Finished running node model.rightmove_epc.epc_flats_count
[0m16:48:00.023503 [debug] [Thread-3 (]: Database Error in model rm_listings (models/reports/rm_listings.sql)
  001003 (42000): SQL compilation error:
  syntax error line 23 at position 10 unexpected 'as'.
  syntax error line 28 at position 4 unexpected 'from'.
  syntax error line 34 at position 0 unexpected 'select'.
  compiled Code at target/run/rightmove_epc/models/reports/rm_listings.sql
[0m16:48:00.023812 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2a615db8-b571-4b2b-83c7-4e5c1a9b5cf9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108d00550>]}
[0m16:48:00.024125 [error] [Thread-3 (]: 11 of 20 ERROR creating sql table model dbt_melissa_rm_epc.rm_listings ......... [[31mERROR[0m in 0.47s]
[0m16:48:00.024425 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.rm_listings
[0m16:48:00.028133 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 0.0 seconds
[0m16:48:00.029665 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.address_match (execute): 16:47:59.548223 => 16:48:00.029559
[0m16:48:00.029870 [debug] [Thread-4 (]: On model.rightmove_epc.address_match: Close
[0m16:48:00.111159 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2a615db8-b571-4b2b-83c7-4e5c1a9b5cf9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108861250>]}
[0m16:48:00.111650 [info ] [Thread-4 (]: 9 of 20 OK created sql view model dbt_melissa_rm_epc.address_match ............. [[32mSUCCESS 1[0m in 0.57s]
[0m16:48:00.112217 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.address_match
[0m16:48:00.172280 [debug] [Thread-7 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:48:00.174081 [debug] [Thread-7 (]: Timing info for model.rightmove_epc.rm_listings_count (execute): 16:47:59.575052 => 16:48:00.173951
[0m16:48:00.174337 [debug] [Thread-7 (]: On model.rightmove_epc.rm_listings_count: Close
[0m16:48:00.258641 [debug] [Thread-7 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2a615db8-b571-4b2b-83c7-4e5c1a9b5cf9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10aacc490>]}
[0m16:48:00.259309 [info ] [Thread-7 (]: 12 of 20 OK created sql view model dbt_melissa_rm_epc.rm_listings_count ........ [[32mSUCCESS 1[0m in 0.70s]
[0m16:48:00.259737 [debug] [Thread-7 (]: Finished running node model.rightmove_epc.rm_listings_count
[0m16:48:00.319204 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:48:00.321151 [debug] [Thread-5 (]: Timing info for model.rightmove_epc.no_uprn_match (execute): 16:47:59.571248 => 16:48:00.321012
[0m16:48:00.321417 [debug] [Thread-5 (]: On model.rightmove_epc.no_uprn_match: Close
[0m16:48:00.339827 [debug] [Thread-8 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:48:00.341965 [debug] [Thread-8 (]: Timing info for model.rightmove_epc.uprn_match_flat (execute): 16:47:59.578264 => 16:48:00.341818
[0m16:48:00.342257 [debug] [Thread-8 (]: On model.rightmove_epc.uprn_match_flat: Close
[0m16:48:00.376926 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:48:00.378925 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.uprn_match (execute): 16:47:59.576581 => 16:48:00.378779
[0m16:48:00.379232 [debug] [Thread-1 (]: On model.rightmove_epc.uprn_match: Close
[0m16:48:00.421672 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2a615db8-b571-4b2b-83c7-4e5c1a9b5cf9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ad0ab50>]}
[0m16:48:00.422195 [info ] [Thread-5 (]: 10 of 20 OK created sql view model dbt_melissa_rm_epc.no_uprn_match ............ [[32mSUCCESS 1[0m in 0.86s]
[0m16:48:00.422550 [debug] [Thread-5 (]: Finished running node model.rightmove_epc.no_uprn_match
[0m16:48:00.423007 [debug] [Thread-6 (]: Began running node model.rightmove_epc.uprn_address_match
[0m16:48:00.423393 [info ] [Thread-6 (]: 15 of 20 START sql view model dbt_melissa_rm_epc.uprn_address_match ............ [RUN]
[0m16:48:00.423889 [debug] [Thread-6 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.epc_flats_count, now model.rightmove_epc.uprn_address_match)
[0m16:48:00.424128 [debug] [Thread-6 (]: Began compiling node model.rightmove_epc.uprn_address_match
[0m16:48:00.426787 [debug] [Thread-6 (]: Writing injected SQL for node "model.rightmove_epc.uprn_address_match"
[0m16:48:00.427594 [debug] [Thread-6 (]: Timing info for model.rightmove_epc.uprn_address_match (compile): 16:48:00.424261 => 16:48:00.427428
[0m16:48:00.427837 [debug] [Thread-6 (]: Began executing node model.rightmove_epc.uprn_address_match
[0m16:48:00.429840 [debug] [Thread-6 (]: Writing runtime sql for node "model.rightmove_epc.uprn_address_match"
[0m16:48:00.430766 [debug] [Thread-6 (]: Using snowflake connection "model.rightmove_epc.uprn_address_match"
[0m16:48:00.431010 [debug] [Thread-6 (]: On model.rightmove_epc.uprn_address_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.uprn_address_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_address_match
  
   as (
    -- where uprn is not matched we try address.

with uprn as (

    select 
    up.LISTING_ID,
    CHANGE_DATE,
    up.ADDRESSID,
    up.ADDRESS_1,
    up.ADDRESS_2,
    FULL_POSTCODE,
    up.UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    BEDROOM,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
 -- need to sleect the same fields as address match
    CASE WHEN ad.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC,
    ad.ADDRESSID AS EPC_ADDRESSID,
    ad.UPRN AS EPC_UPRN

     from ANALYTICS_DEV.dbt_melissa_rm_epc.no_uprn_match up
    left join ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid ad on up.ADDRESSID = ad.ADDRESSID
    and up.FULL_POSTCODE = ad.POSTCODE
   
)

SELECT * FROM UPRN
  );
[0m16:48:00.431235 [debug] [Thread-6 (]: Opening a new connection, currently in state closed
[0m16:48:00.438960 [debug] [Thread-8 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2a615db8-b571-4b2b-83c7-4e5c1a9b5cf9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10aaa1e50>]}
[0m16:48:00.439439 [info ] [Thread-8 (]: 14 of 20 OK created sql view model dbt_melissa_rm_epc.uprn_match_flat .......... [[32mSUCCESS 1[0m in 0.88s]
[0m16:48:00.439779 [debug] [Thread-8 (]: Finished running node model.rightmove_epc.uprn_match_flat
[0m16:48:00.449830 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2a615db8-b571-4b2b-83c7-4e5c1a9b5cf9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107c4f6d0>]}
[0m16:48:00.450302 [info ] [Thread-1 (]: 13 of 20 OK created sql view model dbt_melissa_rm_epc.uprn_match ............... [[32mSUCCESS 1[0m in 0.89s]
[0m16:48:00.450617 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.uprn_match
[0m16:48:00.451007 [debug] [Thread-4 (]: Began running node model.rightmove_epc.flats_report
[0m16:48:00.451308 [debug] [Thread-7 (]: Began running node model.rightmove_epc.houses_report
[0m16:48:00.451633 [info ] [Thread-4 (]: 16 of 20 START sql table model dbt_melissa_rm_epc.flats_report ................. [RUN]
[0m16:48:00.451917 [info ] [Thread-7 (]: 17 of 20 START sql table model dbt_melissa_rm_epc.houses_report ................ [RUN]
[0m16:48:00.452373 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.address_match, now model.rightmove_epc.flats_report)
[0m16:48:00.452772 [debug] [Thread-7 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.rm_listings_count, now model.rightmove_epc.houses_report)
[0m16:48:00.452994 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.flats_report
[0m16:48:00.453185 [debug] [Thread-7 (]: Began compiling node model.rightmove_epc.houses_report
[0m16:48:00.455591 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.flats_report"
[0m16:48:00.457366 [debug] [Thread-7 (]: Writing injected SQL for node "model.rightmove_epc.houses_report"
[0m16:48:00.457927 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.flats_report (compile): 16:48:00.453305 => 16:48:00.457759
[0m16:48:00.458202 [debug] [Thread-7 (]: Timing info for model.rightmove_epc.houses_report (compile): 16:48:00.455763 => 16:48:00.458067
[0m16:48:00.458399 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.flats_report
[0m16:48:00.458606 [debug] [Thread-7 (]: Began executing node model.rightmove_epc.houses_report
[0m16:48:00.460248 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.flats_report"
[0m16:48:00.461778 [debug] [Thread-7 (]: Writing runtime sql for node "model.rightmove_epc.houses_report"
[0m16:48:00.463989 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.flats_report"
[0m16:48:00.465213 [debug] [Thread-7 (]: Using snowflake connection "model.rightmove_epc.houses_report"
[0m16:48:00.465582 [debug] [Thread-4 (]: On model.rightmove_epc.flats_report: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.flats_report"} */
create or replace transient table ANALYTICS_DEV.dbt_melissa_rm_epc.flats_report
         as
        (with flat_addmatch as (

    select 
    distinct
    --count(LISTING_ID) as TOTAL_LISTINGS,
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN, -- NULL
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
 --   am.FLOOR_LEVEL as RM_FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    epc.ADDRESSID AS EPC_ADDRESSID,
    -- REMOVE_FROM_RM_MATCH,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

     from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc on am.EPC_ADDRESSID = epc.ADDRESSID
    and am.FULL_POSTCODE = epc.POSTCODE
    where MATCH_EPC = 'YES'
    and COMBINED_PROPERTY_TYPE in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')

),

flat_uprnmatch as (

    select 
    distinct
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN,
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    BUILDING_REFERENCE_NUMBER, 
    epc.ADDRESSID AS EPC_ADDRESSID,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

    

    from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn epc on am.EPC_UPRN = epc.UPRN

    where MATCH_EPC = 'YES'
   and COMBINED_PROPERTY_TYPE in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')
  -- AND RM_UPRN = 100030719363

),

flat_uprnmultimatch as (

    select 
    distinct
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN,
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    BUILDING_REFERENCE_NUMBER, 
    epc.ADDRESSID AS EPC_ADDRESSID,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

    

    from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match_flat am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn epc on am.EPC_UPRN = epc.UPRN

    where MATCH_EPC = 'YES'
   and COMBINED_PROPERTY_TYPE not in ('HOUSE / FLAT SHARE','FLAT / APARTMENT') -- this checks to ensure that houses listed on RightMove are included and matched to EPC as flats
  -- AND RM_UPRN = 100030719363

)



select 'UPRN' as MATCH_TYPE, * from flat_uprnmatch

union all

select 'ADDRESSID' as MATCH_TYPE, * from flat_addmatch

union all

select 'MULTIUPRN_EPC' as MATCH_TYPE, * from flat_uprnmultimatch

/*
--THIS IS USED FOR A TEST
select RM_UPRN,COUNT(BUILDING_REFERENCE_NUMBER)
from house_uprnmatch
WHERE RM_UPRN IS NOT NULL
GROUP BY 1
HAVING COUNT(BUILDING_REFERENCE_NUMBER) >1
*/
        );
[0m16:48:00.465943 [debug] [Thread-7 (]: On model.rightmove_epc.houses_report: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.houses_report"} */
create or replace transient table ANALYTICS_DEV.dbt_melissa_rm_epc.houses_report
         as
        (with house_addmatch as (

    select 
    distinct
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN,
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    epc.ADDRESSID AS EPC_ADDRESSID,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

     from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc on am.EPC_ADDRESSID = epc.ADDRESSID
    and am.FULL_POSTCODE = epc.POSTCODE
    where MATCH_EPC = 'YES'
    and COMBINED_PROPERTY_TYPE not in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')

),

house_uprnmatch as (

    select 
    distinct
    --count(LISTING_ID) as TOTAL_LISTINGS,
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN, -- NULL
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
  --  am.FLOOR_LEVEL as RM_FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    epc.ADDRESSID AS EPC_ADDRESSID,
    -- REMOVE_FROM_RM_MATCH,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

    

    from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn epc on am.EPC_UPRN = epc.UPRN

    where MATCH_EPC = 'YES'
    and COMBINED_PROPERTY_TYPE not in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')
  -- AND RM_UPRN = 100030719363

),

final as (

select 'UPRN' as MATCH_TYPE, * from house_uprnmatch

union all

select 'ADDRESSID' as MATCH_TYPE, * from house_addmatch

)

select * from final


/*
--THIS IS USED FOR A TEST
select RM_UPRN,COUNT(BUILDING_REFERENCE_NUMBER)
from house_uprnmatch
WHERE RM_UPRN IS NOT NULL
GROUP BY 1
HAVING COUNT(BUILDING_REFERENCE_NUMBER) >1
*/
        );
[0m16:48:00.466211 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m16:48:00.466393 [debug] [Thread-7 (]: Opening a new connection, currently in state closed
[0m16:48:01.203646 [debug] [Thread-6 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m16:48:01.206447 [debug] [Thread-6 (]: Timing info for model.rightmove_epc.uprn_address_match (execute): 16:48:00.427964 => 16:48:01.206259
[0m16:48:01.206793 [debug] [Thread-6 (]: On model.rightmove_epc.uprn_address_match: Close
[0m16:48:01.285519 [debug] [Thread-6 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2a615db8-b571-4b2b-83c7-4e5c1a9b5cf9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107c8fe50>]}
[0m16:48:01.285933 [info ] [Thread-6 (]: 15 of 20 OK created sql view model dbt_melissa_rm_epc.uprn_address_match ....... [[32mSUCCESS 1[0m in 0.86s]
[0m16:48:01.286208 [debug] [Thread-6 (]: Finished running node model.rightmove_epc.uprn_address_match
[0m16:48:01.286581 [debug] [Thread-3 (]: Began running node model.rightmove_epc.rm_all_matches
[0m16:48:01.286907 [info ] [Thread-3 (]: 18 of 20 START sql table model dbt_melissa_rm_epc.rm_all_matches ............... [RUN]
[0m16:48:01.287144 [debug] [Thread-8 (]: Began running node model.rightmove_epc.rm_no_matches
[0m16:48:01.287530 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.rm_listings, now model.rightmove_epc.rm_all_matches)
[0m16:48:01.287757 [info ] [Thread-8 (]: 19 of 20 START sql table model dbt_melissa_rm_epc.rm_no_matches ................ [RUN]
[0m16:48:01.287961 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.rm_all_matches
[0m16:48:01.288256 [debug] [Thread-8 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.uprn_match_flat, now model.rightmove_epc.rm_no_matches)
[0m16:48:01.290251 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.rm_all_matches"
[0m16:48:01.290443 [debug] [Thread-8 (]: Began compiling node model.rightmove_epc.rm_no_matches
[0m16:48:01.292049 [debug] [Thread-8 (]: Writing injected SQL for node "model.rightmove_epc.rm_no_matches"
[0m16:48:01.292477 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.rm_all_matches (compile): 16:48:01.288368 => 16:48:01.292373
[0m16:48:01.292715 [debug] [Thread-8 (]: Timing info for model.rightmove_epc.rm_no_matches (compile): 16:48:01.290602 => 16:48:01.292585
[0m16:48:01.292900 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.rm_all_matches
[0m16:48:01.293115 [debug] [Thread-8 (]: Began executing node model.rightmove_epc.rm_no_matches
[0m16:48:01.295837 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.rm_all_matches"
[0m16:48:01.297284 [debug] [Thread-8 (]: Writing runtime sql for node "model.rightmove_epc.rm_no_matches"
[0m16:48:01.298400 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.rm_all_matches"
[0m16:48:01.299240 [debug] [Thread-8 (]: Using snowflake connection "model.rightmove_epc.rm_no_matches"
[0m16:48:01.299495 [debug] [Thread-3 (]: On model.rightmove_epc.rm_all_matches: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.rm_all_matches"} */
create or replace transient table ANALYTICS_DEV.dbt_melissa_rm_epc.rm_all_matches
         as
        (with addr as (

    select 
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN,
    EPC_ADDRESSID
    
    from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
    where MATCH_EPC = 'YES' 
),

uprn_addr as (

    select 
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN,
    EPC_ADDRESSID
    
    from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_address_match
    where MATCH_EPC = 'YES' 
),

uprn as (

    select 
    
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN::VARCHAR AS EPC_UPRN,
    EPC_ADDRESSID

    from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'YES'
),

final as (

select 'ADDRESS AND POSTCODE MATCH' AS MATCH_RESULT, * from addr
union all
select 'UPRN MATCH' AS MATCH_RESULT, * from uprn
union all
select 'MATCH ADDRESS NO MATCH TO EPC UPRN' AS MATCH_RESULT, * from uprn
)

select * from final
        );
[0m16:48:01.299834 [debug] [Thread-8 (]: On model.rightmove_epc.rm_no_matches: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.rm_no_matches"} */
create or replace transient table ANALYTICS_DEV.dbt_melissa_rm_epc.rm_no_matches
         as
        (with addr as (

    select 
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN,
    EPC_ADDRESSID
    
    from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
    where MATCH_EPC = 'NO' 
),

uprn as (

    select 
    
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN::VARCHAR AS EPC_UPRN,
    EPC_ADDRESSID
    
     from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'NO'
),

uprn_address as (

        select 
    
    LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN::VARCHAR AS EPC_UPRN,
    EPC_ADDRESSID
    
     from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_address_match
    where MATCH_EPC = 'NO'
),

final as (

select 'NO ADDRESS MATCH' AS MATCH_RESULT, * from addr
union all
select 'NO UPRN MATCH' AS MATCH_RESULT, * from uprn
union select 'NO ADDRESS OR UPRN MATCH' AS MATCH_RESULT, * from uprn

)

select * from final
        );
[0m16:48:01.300076 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m16:48:01.300263 [debug] [Thread-8 (]: Opening a new connection, currently in state closed
[0m16:48:17.799939 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 18.0 seconds
[0m16:48:17.802999 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.epc_flats (execute): 16:47:59.398453 => 16:48:17.802859
[0m16:48:17.803262 [debug] [Thread-2 (]: On model.rightmove_epc.epc_flats: Close
[0m16:48:17.893992 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2a615db8-b571-4b2b-83c7-4e5c1a9b5cf9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107350d50>]}
[0m16:48:17.894533 [info ] [Thread-2 (]: 7 of 20 OK created sql table model dbt_melissa_rm_epc.epc_flats ................ [[32mSUCCESS 1[0m in 18.50s]
[0m16:48:17.894924 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.epc_flats
[0m16:50:22.028724 [debug] [Thread-8 (]: SQL status: SUCCESS 1 in 141.0 seconds
[0m16:50:22.031594 [debug] [Thread-8 (]: Timing info for model.rightmove_epc.rm_no_matches (execute): 16:48:01.296022 => 16:50:22.031468
[0m16:50:22.031853 [debug] [Thread-8 (]: On model.rightmove_epc.rm_no_matches: Close
[0m16:50:22.181927 [debug] [Thread-8 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2a615db8-b571-4b2b-83c7-4e5c1a9b5cf9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108ba7bd0>]}
[0m16:50:22.182468 [info ] [Thread-8 (]: 19 of 20 OK created sql table model dbt_melissa_rm_epc.rm_no_matches ........... [[32mSUCCESS 1[0m in 140.89s]
[0m16:50:22.182820 [debug] [Thread-8 (]: Finished running node model.rightmove_epc.rm_no_matches
[0m16:51:09.188558 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 188.0 seconds
[0m16:51:09.191809 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.rm_all_matches (execute): 16:48:01.293225 => 16:51:09.191654
[0m16:51:09.192104 [debug] [Thread-3 (]: On model.rightmove_epc.rm_all_matches: Close
[0m16:51:09.285395 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2a615db8-b571-4b2b-83c7-4e5c1a9b5cf9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10aac0990>]}
[0m16:51:09.286096 [info ] [Thread-3 (]: 18 of 20 OK created sql table model dbt_melissa_rm_epc.rm_all_matches .......... [[32mSUCCESS 1[0m in 188.00s]
[0m16:51:09.286655 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.rm_all_matches
[0m16:51:30.175690 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 210.0 seconds
[0m16:51:30.177590 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.flats_report (execute): 16:48:00.458771 => 16:51:30.177461
[0m16:51:30.177827 [debug] [Thread-4 (]: On model.rightmove_epc.flats_report: Close
[0m16:51:30.319815 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2a615db8-b571-4b2b-83c7-4e5c1a9b5cf9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108a9ffd0>]}
[0m16:51:30.320350 [info ] [Thread-4 (]: 16 of 20 OK created sql table model dbt_melissa_rm_epc.flats_report ............ [[32mSUCCESS 1[0m in 209.87s]
[0m16:51:30.320725 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.flats_report
[0m16:51:30.490903 [debug] [Thread-7 (]: SQL status: SUCCESS 1 in 210.0 seconds
[0m16:51:30.492413 [debug] [Thread-7 (]: Timing info for model.rightmove_epc.houses_report (execute): 16:48:00.460438 => 16:51:30.492315
[0m16:51:30.492605 [debug] [Thread-7 (]: On model.rightmove_epc.houses_report: Close
[0m16:51:30.571875 [debug] [Thread-7 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2a615db8-b571-4b2b-83c7-4e5c1a9b5cf9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10b93fa10>]}
[0m16:51:30.572321 [info ] [Thread-7 (]: 17 of 20 OK created sql table model dbt_melissa_rm_epc.houses_report ........... [[32mSUCCESS 1[0m in 210.12s]
[0m16:51:30.572591 [debug] [Thread-7 (]: Finished running node model.rightmove_epc.houses_report
[0m16:51:30.573026 [debug] [Thread-5 (]: Began running node model.rightmove_epc.zero_bedrooms
[0m16:51:30.573450 [info ] [Thread-5 (]: 20 of 20 START sql table model dbt_melissa_rm_epc.zero_bedrooms ................ [RUN]
[0m16:51:30.573949 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.no_uprn_match, now model.rightmove_epc.zero_bedrooms)
[0m16:51:30.574169 [debug] [Thread-5 (]: Began compiling node model.rightmove_epc.zero_bedrooms
[0m16:51:30.576477 [debug] [Thread-5 (]: Writing injected SQL for node "model.rightmove_epc.zero_bedrooms"
[0m16:51:30.578035 [debug] [Thread-5 (]: Timing info for model.rightmove_epc.zero_bedrooms (compile): 16:51:30.574304 => 16:51:30.577849
[0m16:51:30.578271 [debug] [Thread-5 (]: Began executing node model.rightmove_epc.zero_bedrooms
[0m16:51:30.579907 [debug] [Thread-5 (]: Writing runtime sql for node "model.rightmove_epc.zero_bedrooms"
[0m16:51:30.580760 [debug] [Thread-5 (]: Using snowflake connection "model.rightmove_epc.zero_bedrooms"
[0m16:51:30.581027 [debug] [Thread-5 (]: On model.rightmove_epc.zero_bedrooms: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.zero_bedrooms"} */
create or replace transient table ANALYTICS_DEV.dbt_melissa_rm_epc.zero_bedrooms
         as
        (with houses as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.houses_report
    where BEDROOM = 0
),

flats as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.flats_report
        where BEDROOM = 0

)

select * from flats
union all
select * from houses
        );
[0m16:51:30.581224 [debug] [Thread-5 (]: Opening a new connection, currently in state closed
[0m16:51:32.658095 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m16:51:32.659804 [debug] [Thread-5 (]: Timing info for model.rightmove_epc.zero_bedrooms (execute): 16:51:30.578384 => 16:51:32.659692
[0m16:51:32.660035 [debug] [Thread-5 (]: On model.rightmove_epc.zero_bedrooms: Close
[0m16:51:32.751778 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2a615db8-b571-4b2b-83c7-4e5c1a9b5cf9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10aa6a950>]}
[0m16:51:32.752272 [info ] [Thread-5 (]: 20 of 20 OK created sql table model dbt_melissa_rm_epc.zero_bedrooms ........... [[32mSUCCESS 1[0m in 2.18s]
[0m16:51:32.752602 [debug] [Thread-5 (]: Finished running node model.rightmove_epc.zero_bedrooms
[0m16:51:32.753927 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:51:32.754157 [debug] [MainThread]: Connection 'model.rightmove_epc.uprn_match' was properly closed.
[0m16:51:32.754318 [debug] [MainThread]: Connection 'model.rightmove_epc.epc_flats' was properly closed.
[0m16:51:32.754463 [debug] [MainThread]: Connection 'model.rightmove_epc.rm_all_matches' was properly closed.
[0m16:51:32.754608 [debug] [MainThread]: Connection 'model.rightmove_epc.zero_bedrooms' was properly closed.
[0m16:51:32.754746 [debug] [MainThread]: Connection 'model.rightmove_epc.houses_report' was properly closed.
[0m16:51:32.754881 [debug] [MainThread]: Connection 'model.rightmove_epc.rm_no_matches' was properly closed.
[0m16:51:32.755015 [debug] [MainThread]: Connection 'model.rightmove_epc.uprn_address_match' was properly closed.
[0m16:51:32.755148 [debug] [MainThread]: Connection 'model.rightmove_epc.flats_report' was properly closed.
[0m16:51:32.755366 [info ] [MainThread]: 
[0m16:51:32.755586 [info ] [MainThread]: Finished running 13 view models, 7 table models in 0 hours 3 minutes and 35.71 seconds (215.71s).
[0m16:51:32.756869 [debug] [MainThread]: Command end result
[0m16:51:32.763092 [info ] [MainThread]: 
[0m16:51:32.763378 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m16:51:32.763541 [info ] [MainThread]: 
[0m16:51:32.763703 [error] [MainThread]:   Database Error in model rm_listings (models/reports/rm_listings.sql)
  001003 (42000): SQL compilation error:
  syntax error line 23 at position 10 unexpected 'as'.
  syntax error line 28 at position 4 unexpected 'from'.
  syntax error line 34 at position 0 unexpected 'select'.
  compiled Code at target/run/rightmove_epc/models/reports/rm_listings.sql
[0m16:51:32.763877 [info ] [MainThread]: 
[0m16:51:32.764035 [info ] [MainThread]: Done. PASS=19 WARN=0 ERROR=1 SKIP=0 TOTAL=20
[0m16:51:32.765816 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 216.01917, "process_user_time": 1.816445, "process_kernel_time": 0.242, "process_mem_max_rss": "143638528", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m16:51:32.766094 [debug] [MainThread]: Command `dbt run` failed at 16:51:32.766034 after 216.02 seconds
[0m16:51:32.766298 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107cc3610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x101012110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107c3fdd0>]}
[0m16:51:32.766487 [debug] [MainThread]: Flushing usage events
[0m16:53:18.367356 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106518810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10655e490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10655f010>]}


============================== 16:53:18.370337 | 8973af18-6000-47a4-84e2-092d6f60ff3a ==============================
[0m16:53:18.370337 [info ] [MainThread]: Running with dbt=1.7.10
[0m16:53:18.370689 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run --select models/reports/rm_listings.sql', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'send_anonymous_usage_stats': 'True'}
[0m16:53:18.552540 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8973af18-6000-47a4-84e2-092d6f60ff3a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106587690>]}
[0m16:53:18.586620 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8973af18-6000-47a4-84e2-092d6f60ff3a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1065187d0>]}
[0m16:53:18.587673 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m16:53:18.598236 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m16:53:18.623295 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m16:53:18.623574 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m16:53:18.627008 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8973af18-6000-47a4-84e2-092d6f60ff3a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1072ab850>]}
[0m16:53:18.633770 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8973af18-6000-47a4-84e2-092d6f60ff3a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10731fb90>]}
[0m16:53:18.634024 [info ] [MainThread]: Found 21 models, 1 analysis, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m16:53:18.634215 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8973af18-6000-47a4-84e2-092d6f60ff3a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1074a7f10>]}
[0m16:53:18.635246 [info ] [MainThread]: 
[0m16:53:18.635629 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m16:53:18.636160 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m16:53:18.642692 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m16:53:18.642910 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m16:53:18.643055 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m16:53:19.135460 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 0.0 seconds
[0m16:53:19.137678 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m16:53:19.217085 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m16:53:19.226220 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m16:53:19.226679 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m16:53:19.227003 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m16:53:19.531066 [debug] [ThreadPool]: SQL status: SUCCESS 21 in 0.0 seconds
[0m16:53:19.534663 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m16:53:19.625421 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8973af18-6000-47a4-84e2-092d6f60ff3a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107409e90>]}
[0m16:53:19.626465 [info ] [MainThread]: Concurrency: 8 threads (target='dev')
[0m16:53:19.626888 [info ] [MainThread]: 
[0m16:53:19.630758 [debug] [Thread-1 (]: Began running node model.rightmove_epc.rm_listings
[0m16:53:19.631251 [info ] [Thread-1 (]: 1 of 1 START sql table model dbt_melissa_rm_epc.rm_listings .................... [RUN]
[0m16:53:19.631911 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.rm_listings)
[0m16:53:19.632294 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.rm_listings
[0m16:53:19.640317 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.rm_listings"
[0m16:53:19.641803 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.rm_listings (compile): 16:53:19.632508 => 16:53:19.641595
[0m16:53:19.642130 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.rm_listings
[0m16:53:19.691062 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.rm_listings"
[0m16:53:19.691912 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.rm_listings"
[0m16:53:19.692128 [debug] [Thread-1 (]: On model.rightmove_epc.rm_listings: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.rm_listings"} */
create or replace transient table ANALYTICS_DEV.dbt_melissa_rm_epc.rm_listings
         as
        (WITH rm AS (
    SELECT * FROM ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn
    -- WHERE UPRN = 100013137 -- This line is commented out, but could be used to filter the dataset.
),
false_rm AS (
    SELECT 
        UPRN,
        COUNT(LISTING_ID) AS listing_count
    FROM rm
    GROUP BY UPRN
    -- HAVING COUNT(LISTING_ID) > 1 -- This is commented out but would filter to only UPRNs with more than one listing.
),
get_false AS (
    SELECT 
        rm.*,
        listing_count
    FROM rm
    INNER JOIN false_rm ON rm.UPRN = false_rm.UPRN
)
SELECT * FROM get_false
        );
[0m16:53:19.692323 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m16:53:36.645220 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 17.0 seconds
[0m16:53:36.669379 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.rm_listings (execute): 16:53:19.642309 => 16:53:36.669142
[0m16:53:36.669864 [debug] [Thread-1 (]: On model.rightmove_epc.rm_listings: Close
[0m16:53:36.810666 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8973af18-6000-47a4-84e2-092d6f60ff3a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10655eb50>]}
[0m16:53:36.811874 [info ] [Thread-1 (]: 1 of 1 OK created sql table model dbt_melissa_rm_epc.rm_listings ............... [[32mSUCCESS 1[0m in 17.18s]
[0m16:53:36.812805 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.rm_listings
[0m16:53:36.815552 [debug] [MainThread]: Connection 'master' was properly closed.
[0m16:53:36.816066 [debug] [MainThread]: Connection 'model.rightmove_epc.rm_listings' was properly closed.
[0m16:53:36.816523 [info ] [MainThread]: 
[0m16:53:36.816990 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 18.18 seconds (18.18s).
[0m16:53:36.818262 [debug] [MainThread]: Command end result
[0m16:53:36.830769 [info ] [MainThread]: 
[0m16:53:36.831310 [info ] [MainThread]: [32mCompleted successfully[0m
[0m16:53:36.831671 [info ] [MainThread]: 
[0m16:53:36.832051 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m16:53:36.834601 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 18.496397, "process_user_time": 1.188007, "process_kernel_time": 0.17272, "process_mem_max_rss": "131579904", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m16:53:36.835586 [debug] [MainThread]: Command `dbt run` succeeded at 16:53:36.835316 after 18.50 seconds
[0m16:53:36.836093 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106587090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10652c390>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100b22150>]}
[0m16:53:36.836546 [debug] [MainThread]: Flushing usage events
[0m18:46:14.500347 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112e00d10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112e5e890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112e5f410>]}


============================== 18:46:14.503911 | 56b24c46-2646-4504-bfa9-f7701f82c915 ==============================
[0m18:46:14.503911 [info ] [MainThread]: Running with dbt=1.7.10
[0m18:46:14.504325 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'debug': 'False', 'fail_fast': 'False', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'warn_error': 'None', 'version_check': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt run --select models/reports', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m18:46:14.710135 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '56b24c46-2646-4504-bfa9-f7701f82c915', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112e878d0>]}
[0m18:46:14.751939 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '56b24c46-2646-4504-bfa9-f7701f82c915', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1139f6b50>]}
[0m18:46:14.752670 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m18:46:14.763525 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m18:46:14.794911 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m18:46:14.795207 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m18:46:14.799155 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '56b24c46-2646-4504-bfa9-f7701f82c915', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113c88510>]}
[0m18:46:14.808434 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '56b24c46-2646-4504-bfa9-f7701f82c915', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113b5bc90>]}
[0m18:46:14.808742 [info ] [MainThread]: Found 22 models, 1 analysis, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m18:46:14.808962 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '56b24c46-2646-4504-bfa9-f7701f82c915', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112e94e10>]}
[0m18:46:14.810296 [info ] [MainThread]: 
[0m18:46:14.810738 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m18:46:14.811476 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m18:46:14.818935 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m18:46:14.819393 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m18:46:14.819605 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:46:15.621089 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 1.0 seconds
[0m18:46:15.623891 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m18:46:15.771320 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m18:46:15.779372 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m18:46:15.779770 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m18:46:15.780040 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:46:16.392303 [debug] [ThreadPool]: SQL status: SUCCESS 22 in 1.0 seconds
[0m18:46:16.394440 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m18:46:16.550061 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '56b24c46-2646-4504-bfa9-f7701f82c915', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112e5ced0>]}
[0m18:46:16.551164 [info ] [MainThread]: Concurrency: 8 threads (target='dev')
[0m18:46:16.551571 [info ] [MainThread]: 
[0m18:46:16.555082 [debug] [Thread-1 (]: Began running node model.rightmove_epc.epc_flats
[0m18:46:16.555615 [debug] [Thread-2 (]: Began running node model.rightmove_epc.epc_remove
[0m18:46:16.558085 [info ] [Thread-1 (]: 1 of 8 START sql table model dbt_melissa_rm_epc.epc_flats ...................... [RUN]
[0m18:46:16.559032 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.epc_flats)
[0m18:46:16.559477 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.epc_flats
[0m18:46:16.559826 [debug] [Thread-5 (]: Began running node model.rightmove_epc.rm_all_matches
[0m18:46:16.603045 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.epc_flats"
[0m18:46:16.603417 [info ] [Thread-2 (]: 2 of 8 START sql table model dbt_melissa_rm_epc.epc_remove ..................... [RUN]
[0m18:46:16.603858 [debug] [Thread-3 (]: Began running node model.rightmove_epc.flats_report
[0m18:46:16.604323 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.epc_remove'
[0m18:46:16.604587 [info ] [Thread-5 (]: 5 of 8 START sql table model dbt_melissa_rm_epc.rm_all_matches ................. [RUN]
[0m18:46:16.604821 [debug] [Thread-6 (]: Began running node model.rightmove_epc.rm_listings
[0m18:46:16.604992 [debug] [Thread-7 (]: Began running node model.rightmove_epc.rm_no_matches
[0m18:46:16.605155 [debug] [Thread-4 (]: Began running node model.rightmove_epc.houses_report
[0m18:46:16.605393 [info ] [Thread-3 (]: 3 of 8 START sql table model dbt_melissa_rm_epc.flats_report ................... [RUN]
[0m18:46:16.605646 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.epc_remove
[0m18:46:16.605895 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.epc_flats (compile): 18:46:16.560077 => 18:46:16.605780
[0m18:46:16.606275 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.rightmove_epc.rm_all_matches'
[0m18:46:16.606513 [info ] [Thread-6 (]: 6 of 8 START sql table model dbt_melissa_rm_epc.rm_listings .................... [RUN]
[0m18:46:16.606758 [info ] [Thread-7 (]: 7 of 8 START sql table model dbt_melissa_rm_epc.rm_no_matches .................. [RUN]
[0m18:46:16.606991 [info ] [Thread-4 (]: 4 of 8 START sql table model dbt_melissa_rm_epc.houses_report .................. [RUN]
[0m18:46:16.607389 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.rightmove_epc.flats_report'
[0m18:46:16.609123 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.epc_remove"
[0m18:46:16.609364 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.epc_flats
[0m18:46:16.609561 [debug] [Thread-5 (]: Began compiling node model.rightmove_epc.rm_all_matches
[0m18:46:16.609959 [debug] [Thread-6 (]: Acquiring new snowflake connection 'model.rightmove_epc.rm_listings'
[0m18:46:16.610347 [debug] [Thread-7 (]: Acquiring new snowflake connection 'model.rightmove_epc.rm_no_matches'
[0m18:46:16.610705 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.rightmove_epc.houses_report'
[0m18:46:16.610905 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.flats_report
[0m18:46:16.627190 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.epc_flats"
[0m18:46:16.629236 [debug] [Thread-5 (]: Writing injected SQL for node "model.rightmove_epc.rm_all_matches"
[0m18:46:16.629483 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.epc_remove (compile): 18:46:16.607519 => 18:46:16.629366
[0m18:46:16.629695 [debug] [Thread-6 (]: Began compiling node model.rightmove_epc.rm_listings
[0m18:46:16.629921 [debug] [Thread-7 (]: Began compiling node model.rightmove_epc.rm_no_matches
[0m18:46:16.630178 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.houses_report
[0m18:46:16.632448 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.flats_report"
[0m18:46:16.632810 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.epc_remove
[0m18:46:16.634298 [debug] [Thread-6 (]: Writing injected SQL for node "model.rightmove_epc.rm_listings"
[0m18:46:16.636113 [debug] [Thread-7 (]: Writing injected SQL for node "model.rightmove_epc.rm_no_matches"
[0m18:46:16.636667 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.epc_flats"
[0m18:46:16.636891 [debug] [Thread-5 (]: Timing info for model.rightmove_epc.rm_all_matches (compile): 18:46:16.627501 => 18:46:16.636785
[0m18:46:16.638823 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.houses_report"
[0m18:46:16.640508 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.epc_remove"
[0m18:46:16.640873 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.flats_report (compile): 18:46:16.630342 => 18:46:16.640752
[0m18:46:16.641121 [debug] [Thread-1 (]: On model.rightmove_epc.epc_flats: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.epc_flats"} */
create or replace transient table ANALYTICS_DEV.dbt_melissa_rm_epc.epc_flats
         as
        (with epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn

),

flat_epc as (

    select uprn,
    count(BUILDING_REFERENCE_NUMBER) as building_ref_count
    from epc
    group by 1
    having count(BUILDING_REFERENCE_NUMBER) >1

),

match_flat_epc as (

    select epc.*,
    building_ref_count
    from epc
    inner join flat_epc on epc.uprn = flat_epc.uprn

)

select * from match_flat_epc
        );
[0m18:46:16.641384 [debug] [Thread-5 (]: Began executing node model.rightmove_epc.rm_all_matches
[0m18:46:16.641623 [debug] [Thread-7 (]: Timing info for model.rightmove_epc.rm_no_matches (compile): 18:46:16.634501 => 18:46:16.641497
[0m18:46:16.641956 [debug] [Thread-6 (]: Timing info for model.rightmove_epc.rm_listings (compile): 18:46:16.632961 => 18:46:16.641854
[0m18:46:16.642179 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.flats_report
[0m18:46:16.642378 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:46:16.643072 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.epc_remove"
[0m18:46:16.643277 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.houses_report (compile): 18:46:16.637022 => 18:46:16.643178
[0m18:46:16.644858 [debug] [Thread-5 (]: Writing runtime sql for node "model.rightmove_epc.rm_all_matches"
[0m18:46:16.645076 [debug] [Thread-7 (]: Began executing node model.rightmove_epc.rm_no_matches
[0m18:46:16.645274 [debug] [Thread-6 (]: Began executing node model.rightmove_epc.rm_listings
[0m18:46:16.646777 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.flats_report"
[0m18:46:16.648227 [debug] [Thread-2 (]: On model.rightmove_epc.epc_remove: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.epc_remove"} */
create or replace transient table ANALYTICS_DEV.dbt_melissa_rm_epc.epc_remove
         as
        (WITH epc_certs as (
    
    select 
    UPRN,
    LODGEMENT_DATE,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
   -- COUNTY,
    LOCAL_AUTHORITY as LOCAL_AUTHORITY_CODE,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    UPPER(CASE WHEN (UPPER(ADDRESS1) LIKE 'FLAT%' OR UPPER(ADDRESS1) LIKE 'UNIT%') or UPPER(ADDRESS1) LIKE 'ROOM%' 
    THEN TRIM(REPLACE(REPLACE(CONCAT(ADDRESS),','),' '))
    ELSE trim(replace(replace(ADDRESS1,' '),',')) END) AS ADDRESSID,
    CASE WHEN UPRN is null and addressid is null THEN 1 else 0 end as REMOVE_FROM_RM_MATCH,
    FLOOR_LEVEL,
    FLAT_TOP_STOREY,
    FLAT_STOREY_COUNT,
    PROPERTY_TYPE
 from  RAW.EPC_TEST_DATA.EPC_CERTIFICATES 

)

SELECT * FROM epc_certs
where REMOVE_FROM_RM_MATCH = 1
        );
[0m18:46:16.648692 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.houses_report
[0m18:46:16.650373 [debug] [Thread-7 (]: Writing runtime sql for node "model.rightmove_epc.rm_no_matches"
[0m18:46:16.651947 [debug] [Thread-6 (]: Writing runtime sql for node "model.rightmove_epc.rm_listings"
[0m18:46:16.652874 [debug] [Thread-5 (]: Using snowflake connection "model.rightmove_epc.rm_all_matches"
[0m18:46:16.653130 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m18:46:16.654631 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.houses_report"
[0m18:46:16.656394 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.flats_report"
[0m18:46:16.656760 [debug] [Thread-5 (]: On model.rightmove_epc.rm_all_matches: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.rm_all_matches"} */
create or replace transient table ANALYTICS_DEV.dbt_melissa_rm_epc.rm_all_matches
         as
        (with addr as (

    select distinct
  --  LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN,
    EPC_ADDRESSID
    
    from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
    where MATCH_EPC = 'YES' 
),

uprn_addr as (

    select 
    distinct
  --  LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN,
    EPC_ADDRESSID
    
    from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_address_match
    where MATCH_EPC = 'YES' 
),

uprn as (

    select 
    distinct
  --  LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN::VARCHAR AS EPC_UPRN,
    EPC_ADDRESSID

    from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'YES'
),

final as (

select 'ADDRESS AND POSTCODE MATCH' AS MATCH_RESULT, * from addr
union all
select 'UPRN MATCH' AS MATCH_RESULT, * from uprn
union all
select 'MATCH ADDRESS NO MATCH TO EPC UPRN' AS MATCH_RESULT, * from uprn
)

select * from final
        );
[0m18:46:16.658287 [debug] [Thread-7 (]: Using snowflake connection "model.rightmove_epc.rm_no_matches"
[0m18:46:16.658733 [debug] [Thread-6 (]: Using snowflake connection "model.rightmove_epc.rm_listings"
[0m18:46:16.659088 [debug] [Thread-3 (]: On model.rightmove_epc.flats_report: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.flats_report"} */
create or replace transient table ANALYTICS_DEV.dbt_melissa_rm_epc.flats_report
         as
        (with flat_addmatch as (

    select 
    distinct
    --count(LISTING_ID) as TOTAL_LISTINGS,
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN, -- NULL
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
 --   am.FLOOR_LEVEL as RM_FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    epc.ADDRESSID AS EPC_ADDRESSID,
    -- REMOVE_FROM_RM_MATCH,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

     from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc on am.EPC_ADDRESSID = epc.ADDRESSID
    and am.FULL_POSTCODE = epc.POSTCODE
    where MATCH_EPC = 'YES'
    and COMBINED_PROPERTY_TYPE in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')

),

flat_uprnmatch as (

    select 
    distinct
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN,
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    BUILDING_REFERENCE_NUMBER, 
    epc.ADDRESSID AS EPC_ADDRESSID,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

    

    from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn epc on am.EPC_UPRN = epc.UPRN

    where MATCH_EPC = 'YES'
   and COMBINED_PROPERTY_TYPE in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')
  -- AND RM_UPRN = 100030719363

),

flat_uprnmultimatch as (

    select 
    distinct
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN,
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    BUILDING_REFERENCE_NUMBER, 
    epc.ADDRESSID AS EPC_ADDRESSID,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

    

    from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match_flat am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn epc on am.EPC_UPRN = epc.UPRN

    where MATCH_EPC = 'YES'
   and COMBINED_PROPERTY_TYPE not in ('HOUSE / FLAT SHARE','FLAT / APARTMENT') -- this checks to ensure that houses listed on RightMove are included and matched to EPC as flats
  -- AND RM_UPRN = 100030719363

)



select 'UPRN' as MATCH_TYPE, * from flat_uprnmatch

union all

select 'ADDRESSID' as MATCH_TYPE, * from flat_addmatch

union all

select 'MULTIUPRN_EPC' as MATCH_TYPE, * from flat_uprnmultimatch

/*
--THIS IS USED FOR A TEST
select RM_UPRN,COUNT(BUILDING_REFERENCE_NUMBER)
from house_uprnmatch
WHERE RM_UPRN IS NOT NULL
GROUP BY 1
HAVING COUNT(BUILDING_REFERENCE_NUMBER) >1
*/
        );
[0m18:46:16.659441 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m18:46:16.660687 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.houses_report"
[0m18:46:16.660946 [debug] [Thread-7 (]: On model.rightmove_epc.rm_no_matches: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.rm_no_matches"} */
create or replace transient table ANALYTICS_DEV.dbt_melissa_rm_epc.rm_no_matches
         as
        (with addr as (

    select distinct
   -- LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN,
    EPC_ADDRESSID
    
    from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
    where MATCH_EPC = 'NO' 
),

uprn as (

    select distinct
    
  --  LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN::VARCHAR AS EPC_UPRN,
    EPC_ADDRESSID
    
     from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'NO'
),

uprn_address as (

        select 
    distinct
  --  LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN::VARCHAR AS EPC_UPRN,
    EPC_ADDRESSID
    
     from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_address_match
    where MATCH_EPC = 'NO'
),

final as (

select 'NO ADDRESS MATCH' AS MATCH_RESULT, * from addr
union all
select 'NO UPRN MATCH' AS MATCH_RESULT, * from uprn
union select 'NO ADDRESS OR UPRN MATCH' AS MATCH_RESULT, * from uprn

)

select * from final
        );
[0m18:46:16.661226 [debug] [Thread-6 (]: On model.rightmove_epc.rm_listings: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.rm_listings"} */
create or replace transient table ANALYTICS_DEV.dbt_melissa_rm_epc.rm_listings
         as
        (WITH rm AS (
    SELECT * FROM ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn
    -- WHERE UPRN = 100013137 -- This line is commented out, but could be used to filter the dataset.
),
false_rm AS (
    SELECT 
        UPRN,
        COUNT(LISTING_ID) AS listing_count
    FROM rm
    GROUP BY UPRN
    -- HAVING COUNT(LISTING_ID) > 1 -- This is commented out but would filter to only UPRNs with more than one listing.
),
get_false AS (
    SELECT 
        rm.*,
        listing_count
    FROM rm
    INNER JOIN false_rm ON rm.UPRN = false_rm.UPRN
)
SELECT * FROM get_false
        );
[0m18:46:16.661441 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m18:46:16.661969 [debug] [Thread-4 (]: On model.rightmove_epc.houses_report: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.houses_report"} */
create or replace transient table ANALYTICS_DEV.dbt_melissa_rm_epc.houses_report
         as
        (with house_addmatch as (

    select 
    distinct
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN,
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    epc.ADDRESSID AS EPC_ADDRESSID,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

     from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc on am.EPC_ADDRESSID = epc.ADDRESSID
    and am.FULL_POSTCODE = epc.POSTCODE
    where MATCH_EPC = 'YES'
    and COMBINED_PROPERTY_TYPE not in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')

),

house_uprnmatch as (

    select 
    distinct
    --count(LISTING_ID) as TOTAL_LISTINGS,
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN, -- NULL
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
  --  am.FLOOR_LEVEL as RM_FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    epc.ADDRESSID AS EPC_ADDRESSID,
    -- REMOVE_FROM_RM_MATCH,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

    

    from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn epc on am.EPC_UPRN = epc.UPRN

    where MATCH_EPC = 'YES'
    and COMBINED_PROPERTY_TYPE not in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')
  -- AND RM_UPRN = 100030719363

),

final as (

select 'UPRN' as MATCH_TYPE, * from house_uprnmatch

union all

select 'ADDRESSID' as MATCH_TYPE, * from house_addmatch

)

select * from final


/*
--THIS IS USED FOR A TEST
select RM_UPRN,COUNT(BUILDING_REFERENCE_NUMBER)
from house_uprnmatch
WHERE RM_UPRN IS NOT NULL
GROUP BY 1
HAVING COUNT(BUILDING_REFERENCE_NUMBER) >1
*/
        );
[0m18:46:16.662433 [debug] [Thread-7 (]: Opening a new connection, currently in state init
[0m18:46:16.662647 [debug] [Thread-6 (]: Opening a new connection, currently in state init
[0m18:46:16.663078 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m18:46:21.933139 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 5.0 seconds
[0m18:46:21.952159 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.epc_remove (execute): 18:46:16.639023 => 18:46:21.951952
[0m18:46:21.952534 [debug] [Thread-2 (]: On model.rightmove_epc.epc_remove: Close
[0m18:46:22.122351 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '56b24c46-2646-4504-bfa9-f7701f82c915', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1139ec5d0>]}
[0m18:46:22.123093 [info ] [Thread-2 (]: 2 of 8 OK created sql table model dbt_melissa_rm_epc.epc_remove ................ [[32mSUCCESS 1[0m in 5.52s]
[0m18:46:22.123633 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.epc_remove
[0m18:47:12.595255 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 56.0 seconds
[0m18:47:12.600839 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.epc_flats (execute): 18:46:16.611103 => 18:47:12.600629
[0m18:47:12.601229 [debug] [Thread-1 (]: On model.rightmove_epc.epc_flats: Close
[0m18:47:12.750931 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '56b24c46-2646-4504-bfa9-f7701f82c915', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113e15090>]}
[0m18:47:12.752092 [info ] [Thread-1 (]: 1 of 8 OK created sql table model dbt_melissa_rm_epc.epc_flats ................. [[32mSUCCESS 1[0m in 56.19s]
[0m18:47:12.752832 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.epc_flats
[0m18:47:30.022148 [debug] [Thread-6 (]: SQL status: SUCCESS 1 in 73.0 seconds
[0m18:47:30.026471 [debug] [Thread-6 (]: Timing info for model.rightmove_epc.rm_listings (execute): 18:46:16.650536 => 18:47:30.026250
[0m18:47:30.027059 [debug] [Thread-6 (]: On model.rightmove_epc.rm_listings: Close
[0m18:47:30.223060 [debug] [Thread-6 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '56b24c46-2646-4504-bfa9-f7701f82c915', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113abc5d0>]}
[0m18:47:30.224387 [info ] [Thread-6 (]: 6 of 8 OK created sql table model dbt_melissa_rm_epc.rm_listings ............... [[32mSUCCESS 1[0m in 73.61s]
[0m18:47:30.225239 [debug] [Thread-6 (]: Finished running node model.rightmove_epc.rm_listings
[0m18:49:02.184392 [debug] [Thread-7 (]: SQL status: SUCCESS 1 in 166.0 seconds
[0m18:49:02.188783 [debug] [Thread-7 (]: Timing info for model.rightmove_epc.rm_no_matches (execute): 18:46:16.648912 => 18:49:02.188558
[0m18:49:02.189335 [debug] [Thread-7 (]: On model.rightmove_epc.rm_no_matches: Close
[0m18:49:02.394665 [debug] [Thread-7 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '56b24c46-2646-4504-bfa9-f7701f82c915', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11399c090>]}
[0m18:49:02.395726 [info ] [Thread-7 (]: 7 of 8 OK created sql table model dbt_melissa_rm_epc.rm_no_matches ............. [[32mSUCCESS 1[0m in 165.78s]
[0m18:49:02.396426 [debug] [Thread-7 (]: Finished running node model.rightmove_epc.rm_no_matches
[0m18:49:41.811234 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 205.0 seconds
[0m18:49:41.816341 [debug] [Thread-5 (]: Timing info for model.rightmove_epc.rm_all_matches (execute): 18:46:16.643381 => 18:49:41.816040
[0m18:49:41.816831 [debug] [Thread-5 (]: On model.rightmove_epc.rm_all_matches: Close
[0m18:49:41.986456 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '56b24c46-2646-4504-bfa9-f7701f82c915', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113d12390>]}
[0m18:49:41.987262 [info ] [Thread-5 (]: 5 of 8 OK created sql table model dbt_melissa_rm_epc.rm_all_matches ............ [[32mSUCCESS 1[0m in 205.38s]
[0m18:49:41.987899 [debug] [Thread-5 (]: Finished running node model.rightmove_epc.rm_all_matches
[0m18:49:53.457799 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 217.0 seconds
[0m18:49:53.462803 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.flats_report (execute): 18:46:16.645397 => 18:49:53.462562
[0m18:49:53.463251 [debug] [Thread-3 (]: On model.rightmove_epc.flats_report: Close
[0m18:49:53.607840 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '56b24c46-2646-4504-bfa9-f7701f82c915', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1139f5210>]}
[0m18:49:53.608448 [info ] [Thread-3 (]: 3 of 8 OK created sql table model dbt_melissa_rm_epc.flats_report .............. [[32mSUCCESS 1[0m in 217.00s]
[0m18:49:53.608916 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.flats_report
[0m18:49:54.519479 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 218.0 seconds
[0m18:49:54.524939 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.houses_report (execute): 18:46:16.653290 => 18:49:54.524634
[0m18:49:54.525587 [debug] [Thread-4 (]: On model.rightmove_epc.houses_report: Close
[0m18:49:54.691067 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '56b24c46-2646-4504-bfa9-f7701f82c915', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1139f52d0>]}
[0m18:49:54.691552 [info ] [Thread-4 (]: 4 of 8 OK created sql table model dbt_melissa_rm_epc.houses_report ............. [[32mSUCCESS 1[0m in 218.08s]
[0m18:49:54.691916 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.houses_report
[0m18:49:54.692451 [debug] [Thread-8 (]: Began running node model.rightmove_epc.zero_bedrooms
[0m18:49:54.692707 [info ] [Thread-8 (]: 8 of 8 START sql table model dbt_melissa_rm_epc.zero_bedrooms .................. [RUN]
[0m18:49:54.693137 [debug] [Thread-8 (]: Acquiring new snowflake connection 'model.rightmove_epc.zero_bedrooms'
[0m18:49:54.693330 [debug] [Thread-8 (]: Began compiling node model.rightmove_epc.zero_bedrooms
[0m18:49:54.695941 [debug] [Thread-8 (]: Writing injected SQL for node "model.rightmove_epc.zero_bedrooms"
[0m18:49:54.698503 [debug] [Thread-8 (]: Timing info for model.rightmove_epc.zero_bedrooms (compile): 18:49:54.693455 => 18:49:54.698327
[0m18:49:54.698744 [debug] [Thread-8 (]: Began executing node model.rightmove_epc.zero_bedrooms
[0m18:49:54.700565 [debug] [Thread-8 (]: Writing runtime sql for node "model.rightmove_epc.zero_bedrooms"
[0m18:49:54.701688 [debug] [Thread-8 (]: Using snowflake connection "model.rightmove_epc.zero_bedrooms"
[0m18:49:54.701941 [debug] [Thread-8 (]: On model.rightmove_epc.zero_bedrooms: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.zero_bedrooms"} */
create or replace transient table ANALYTICS_DEV.dbt_melissa_rm_epc.zero_bedrooms
         as
        (with houses as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.houses_report
    where BEDROOM = 0
),

flats as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.flats_report
        where BEDROOM = 0

)

select * from flats
union all
select * from houses
        );
[0m18:49:54.702148 [debug] [Thread-8 (]: Opening a new connection, currently in state init
[0m18:49:57.085815 [debug] [Thread-8 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m18:49:57.088502 [debug] [Thread-8 (]: Timing info for model.rightmove_epc.zero_bedrooms (execute): 18:49:54.698869 => 18:49:57.088300
[0m18:49:57.088875 [debug] [Thread-8 (]: On model.rightmove_epc.zero_bedrooms: Close
[0m18:49:57.226844 [debug] [Thread-8 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '56b24c46-2646-4504-bfa9-f7701f82c915', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113aa69d0>]}
[0m18:49:57.227813 [info ] [Thread-8 (]: 8 of 8 OK created sql table model dbt_melissa_rm_epc.zero_bedrooms ............. [[32mSUCCESS 1[0m in 2.53s]
[0m18:49:57.228597 [debug] [Thread-8 (]: Finished running node model.rightmove_epc.zero_bedrooms
[0m18:49:57.230738 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:49:57.231157 [debug] [MainThread]: Connection 'model.rightmove_epc.epc_flats' was properly closed.
[0m18:49:57.231480 [debug] [MainThread]: Connection 'model.rightmove_epc.epc_remove' was properly closed.
[0m18:49:57.231777 [debug] [MainThread]: Connection 'model.rightmove_epc.rm_all_matches' was properly closed.
[0m18:49:57.232058 [debug] [MainThread]: Connection 'model.rightmove_epc.flats_report' was properly closed.
[0m18:49:57.232338 [debug] [MainThread]: Connection 'model.rightmove_epc.rm_listings' was properly closed.
[0m18:49:57.232612 [debug] [MainThread]: Connection 'model.rightmove_epc.rm_no_matches' was properly closed.
[0m18:49:57.232892 [debug] [MainThread]: Connection 'model.rightmove_epc.houses_report' was properly closed.
[0m18:49:57.233167 [debug] [MainThread]: Connection 'model.rightmove_epc.zero_bedrooms' was properly closed.
[0m18:49:57.233541 [info ] [MainThread]: 
[0m18:49:57.233894 [info ] [MainThread]: Finished running 8 table models in 0 hours 3 minutes and 42.42 seconds (222.42s).
[0m18:49:57.235368 [debug] [MainThread]: Command end result
[0m18:49:57.247872 [info ] [MainThread]: 
[0m18:49:57.248414 [info ] [MainThread]: [32mCompleted successfully[0m
[0m18:49:57.248860 [info ] [MainThread]: 
[0m18:49:57.249158 [info ] [MainThread]: Done. PASS=8 WARN=0 ERROR=0 SKIP=0 TOTAL=8
[0m18:49:57.253509 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 222.78912, "process_user_time": 1.691357, "process_kernel_time": 0.233349, "process_mem_max_rss": "139444224", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m18:49:57.254084 [debug] [MainThread]: Command `dbt run` succeeded at 18:49:57.253978 after 222.79 seconds
[0m18:49:57.254406 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1127d3910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104bca210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104d1e010>]}
[0m18:49:57.254709 [debug] [MainThread]: Flushing usage events
[0m18:55:22.540420 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105818ad0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10585d650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10585f410>]}


============================== 18:55:22.543467 | 3911c8ca-5df8-4c0f-a7b5-9b90671ba7cb ==============================
[0m18:55:22.543467 [info ] [MainThread]: Running with dbt=1.7.10
[0m18:55:22.543840 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'version_check': 'True', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'static_parser': 'True', 'introspect': 'True', 'invocation_command': 'dbt run --select models/reports', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m18:55:22.741491 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '3911c8ca-5df8-4c0f-a7b5-9b90671ba7cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1063e2190>]}
[0m18:55:22.782336 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '3911c8ca-5df8-4c0f-a7b5-9b90671ba7cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10585ded0>]}
[0m18:55:22.783022 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m18:55:22.793328 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m18:55:22.825714 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m18:55:22.826123 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m18:55:22.830296 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '3911c8ca-5df8-4c0f-a7b5-9b90671ba7cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106689750>]}
[0m18:55:22.839931 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '3911c8ca-5df8-4c0f-a7b5-9b90671ba7cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10662bf50>]}
[0m18:55:22.840267 [info ] [MainThread]: Found 22 models, 1 analysis, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m18:55:22.840507 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3911c8ca-5df8-4c0f-a7b5-9b90671ba7cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1051d3cd0>]}
[0m18:55:22.841974 [info ] [MainThread]: 
[0m18:55:22.842472 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m18:55:22.843388 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m18:55:22.851002 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m18:55:22.851269 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m18:55:22.851450 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m18:55:23.431638 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 1.0 seconds
[0m18:55:23.434371 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m18:55:23.611034 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m18:55:23.618257 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m18:55:23.618587 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m18:55:23.618846 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m18:55:24.212892 [debug] [ThreadPool]: SQL status: SUCCESS 23 in 1.0 seconds
[0m18:55:24.214429 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m18:55:24.441955 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '3911c8ca-5df8-4c0f-a7b5-9b90671ba7cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10659e5d0>]}
[0m18:55:24.442865 [info ] [MainThread]: Concurrency: 8 threads (target='dev')
[0m18:55:24.443221 [info ] [MainThread]: 
[0m18:55:24.446976 [debug] [Thread-1 (]: Began running node model.rightmove_epc.epc_flats
[0m18:55:24.448652 [debug] [Thread-3 (]: Began running node model.rightmove_epc.flats_report
[0m18:55:24.447317 [debug] [Thread-2 (]: Began running node model.rightmove_epc.epc_remove
[0m18:55:24.449303 [debug] [Thread-4 (]: Began running node model.rightmove_epc.houses_report
[0m18:55:24.449664 [info ] [Thread-1 (]: 1 of 8 START sql table model dbt_melissa_rm_epc.epc_flats ...................... [RUN]
[0m18:55:24.450046 [debug] [Thread-5 (]: Began running node model.rightmove_epc.rm_all_matches
[0m18:55:24.450467 [info ] [Thread-3 (]: 3 of 8 START sql table model dbt_melissa_rm_epc.flats_report ................... [RUN]
[0m18:55:24.450864 [debug] [Thread-6 (]: Began running node model.rightmove_epc.rm_listings
[0m18:55:24.451218 [debug] [Thread-7 (]: Began running node model.rightmove_epc.rm_no_matches
[0m18:55:24.451543 [info ] [Thread-2 (]: 2 of 8 START sql table model dbt_melissa_rm_epc.epc_remove ..................... [RUN]
[0m18:55:24.451927 [info ] [Thread-4 (]: 4 of 8 START sql table model dbt_melissa_rm_epc.houses_report .................. [RUN]
[0m18:55:24.452523 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.epc_flats)
[0m18:55:24.452924 [info ] [Thread-5 (]: 5 of 8 START sql table model dbt_melissa_rm_epc.rm_all_matches ................. [RUN]
[0m18:55:24.453489 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.rightmove_epc.flats_report'
[0m18:55:24.453799 [info ] [Thread-6 (]: 6 of 8 START sql table model dbt_melissa_rm_epc.rm_listings .................... [RUN]
[0m18:55:24.454106 [info ] [Thread-7 (]: 7 of 8 START sql table model dbt_melissa_rm_epc.rm_no_matches .................. [RUN]
[0m18:55:24.454788 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.epc_remove'
[0m18:55:24.455440 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.rightmove_epc.houses_report'
[0m18:55:24.455744 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.epc_flats
[0m18:55:24.456308 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.rightmove_epc.rm_all_matches'
[0m18:55:24.456580 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.flats_report
[0m18:55:24.457059 [debug] [Thread-6 (]: Acquiring new snowflake connection 'model.rightmove_epc.rm_listings'
[0m18:55:24.457535 [debug] [Thread-7 (]: Acquiring new snowflake connection 'model.rightmove_epc.rm_no_matches'
[0m18:55:24.457806 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.epc_remove
[0m18:55:24.458205 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.houses_report
[0m18:55:24.497576 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.epc_flats"
[0m18:55:24.497921 [debug] [Thread-5 (]: Began compiling node model.rightmove_epc.rm_all_matches
[0m18:55:24.500285 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.flats_report"
[0m18:55:24.500556 [debug] [Thread-6 (]: Began compiling node model.rightmove_epc.rm_listings
[0m18:55:24.500747 [debug] [Thread-7 (]: Began compiling node model.rightmove_epc.rm_no_matches
[0m18:55:24.502394 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.epc_remove"
[0m18:55:24.504415 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.houses_report"
[0m18:55:24.506577 [debug] [Thread-5 (]: Writing injected SQL for node "model.rightmove_epc.rm_all_matches"
[0m18:55:24.508384 [debug] [Thread-6 (]: Writing injected SQL for node "model.rightmove_epc.rm_listings"
[0m18:55:24.508632 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.epc_flats (compile): 18:55:24.458462 => 18:55:24.508518
[0m18:55:24.510516 [debug] [Thread-7 (]: Writing injected SQL for node "model.rightmove_epc.rm_no_matches"
[0m18:55:24.510862 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.flats_report (compile): 18:55:24.498068 => 18:55:24.510676
[0m18:55:24.511577 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.epc_flats
[0m18:55:24.511875 [debug] [Thread-5 (]: Timing info for model.rightmove_epc.rm_all_matches (compile): 18:55:24.504757 => 18:55:24.511708
[0m18:55:24.512207 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.epc_remove (compile): 18:55:24.500867 => 18:55:24.512089
[0m18:55:24.512426 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.houses_report (compile): 18:55:24.502543 => 18:55:24.512327
[0m18:55:24.512619 [debug] [Thread-6 (]: Timing info for model.rightmove_epc.rm_listings (compile): 18:55:24.506963 => 18:55:24.512528
[0m18:55:24.512839 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.flats_report
[0m18:55:24.524530 [debug] [Thread-7 (]: Timing info for model.rightmove_epc.rm_no_matches (compile): 18:55:24.508829 => 18:55:24.524397
[0m18:55:24.528536 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.epc_flats"
[0m18:55:24.528798 [debug] [Thread-5 (]: Began executing node model.rightmove_epc.rm_all_matches
[0m18:55:24.529003 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.epc_remove
[0m18:55:24.529191 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.houses_report
[0m18:55:24.529382 [debug] [Thread-6 (]: Began executing node model.rightmove_epc.rm_listings
[0m18:55:24.531010 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.flats_report"
[0m18:55:24.531219 [debug] [Thread-7 (]: Began executing node model.rightmove_epc.rm_no_matches
[0m18:55:24.532872 [debug] [Thread-5 (]: Writing runtime sql for node "model.rightmove_epc.rm_all_matches"
[0m18:55:24.534414 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.epc_remove"
[0m18:55:24.534945 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.epc_flats"
[0m18:55:24.537319 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.houses_report"
[0m18:55:24.538840 [debug] [Thread-6 (]: Writing runtime sql for node "model.rightmove_epc.rm_listings"
[0m18:55:24.540380 [debug] [Thread-7 (]: Writing runtime sql for node "model.rightmove_epc.rm_no_matches"
[0m18:55:24.542267 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.flats_report"
[0m18:55:24.542573 [debug] [Thread-1 (]: On model.rightmove_epc.epc_flats: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.epc_flats"} */
create or replace transient table ANALYTICS_DEV.dbt_melissa_rm_epc.epc_flats
         as
        (with epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn

),

flat_epc as (

    select uprn,
    count(BUILDING_REFERENCE_NUMBER) as building_ref_count
    from epc
    group by 1
    having count(BUILDING_REFERENCE_NUMBER) >1

),

match_flat_epc as (

    select epc.*,
    building_ref_count
    from epc
    inner join flat_epc on epc.uprn = flat_epc.uprn

)

select * from match_flat_epc
        );
[0m18:55:24.543524 [debug] [Thread-5 (]: Using snowflake connection "model.rightmove_epc.rm_all_matches"
[0m18:55:24.544262 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.epc_remove"
[0m18:55:24.545633 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.houses_report"
[0m18:55:24.546161 [debug] [Thread-6 (]: Using snowflake connection "model.rightmove_epc.rm_listings"
[0m18:55:24.546516 [debug] [Thread-3 (]: On model.rightmove_epc.flats_report: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.flats_report"} */
create or replace transient table ANALYTICS_DEV.dbt_melissa_rm_epc.flats_report
         as
        (with flat_addmatch as (

    select 
    distinct
    --count(LISTING_ID) as TOTAL_LISTINGS,
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN, -- NULL
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
 --   am.FLOOR_LEVEL as RM_FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    epc.ADDRESSID AS EPC_ADDRESSID,
    -- REMOVE_FROM_RM_MATCH,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

     from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc on am.EPC_ADDRESSID = epc.ADDRESSID
    and am.FULL_POSTCODE = epc.POSTCODE
    where MATCH_EPC = 'YES'
    and COMBINED_PROPERTY_TYPE in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')

),

flat_uprnmatch as (

    select 
    distinct
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN,
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    BUILDING_REFERENCE_NUMBER, 
    epc.ADDRESSID AS EPC_ADDRESSID,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

    

    from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn epc on am.EPC_UPRN = epc.UPRN

    where MATCH_EPC = 'YES'
   and COMBINED_PROPERTY_TYPE in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')
  -- AND RM_UPRN = 100030719363

),

flat_uprnmultimatch as (

    select 
    distinct
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN,
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    BUILDING_REFERENCE_NUMBER, 
    epc.ADDRESSID AS EPC_ADDRESSID,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

    

    from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match_flat am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn epc on am.EPC_UPRN = epc.UPRN

    where MATCH_EPC = 'YES'
   and COMBINED_PROPERTY_TYPE not in ('HOUSE / FLAT SHARE','FLAT / APARTMENT') -- this checks to ensure that houses listed on RightMove are included and matched to EPC as flats
  -- AND RM_UPRN = 100030719363

),

matches as (




select 'UPRN' as MATCH_TYPE, * from flat_uprnmatch

union all

select 'ADDRESSID' as MATCH_TYPE, * from flat_addmatch

union all

select 'MULTIUPRN_EPC' as MATCH_TYPE, * from flat_uprnmultimatch
)

select distinct * from matches 
/*
--THIS IS USED FOR A TEST
select RM_UPRN,COUNT(BUILDING_REFERENCE_NUMBER)
from house_uprnmatch
WHERE RM_UPRN IS NOT NULL
GROUP BY 1
HAVING COUNT(BUILDING_REFERENCE_NUMBER) >1
*/
        );
[0m18:55:24.547536 [debug] [Thread-7 (]: Using snowflake connection "model.rightmove_epc.rm_no_matches"
[0m18:55:24.547726 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m18:55:24.547979 [debug] [Thread-5 (]: On model.rightmove_epc.rm_all_matches: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.rm_all_matches"} */
create or replace transient table ANALYTICS_DEV.dbt_melissa_rm_epc.rm_all_matches
         as
        (with addr as (

    select distinct
  --  LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN,
    EPC_ADDRESSID
    
    from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
    where MATCH_EPC = 'YES' 
),

uprn_addr as (

    select 
    distinct
  --  LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN,
    EPC_ADDRESSID
    
    from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_address_match
    where MATCH_EPC = 'YES' 
),

uprn as (

    select 
    distinct
  --  LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN::VARCHAR AS EPC_UPRN,
    EPC_ADDRESSID

    from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'YES'
),

final as (

select 'ADDRESS AND POSTCODE MATCH' AS MATCH_RESULT, * from addr
union all
select 'UPRN MATCH' AS MATCH_RESULT, * from uprn
union all
select 'MATCH ADDRESS NO MATCH TO EPC UPRN' AS MATCH_RESULT, * from uprn
)

select distinct * from final
        );
[0m18:55:24.548257 [debug] [Thread-2 (]: On model.rightmove_epc.epc_remove: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.epc_remove"} */
create or replace transient table ANALYTICS_DEV.dbt_melissa_rm_epc.epc_remove
         as
        (WITH epc_certs as (
    
    select 
    UPRN,
    LODGEMENT_DATE,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
   -- COUNTY,
    LOCAL_AUTHORITY as LOCAL_AUTHORITY_CODE,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    UPPER(CASE WHEN (UPPER(ADDRESS1) LIKE 'FLAT%' OR UPPER(ADDRESS1) LIKE 'UNIT%') or UPPER(ADDRESS1) LIKE 'ROOM%' 
    THEN TRIM(REPLACE(REPLACE(CONCAT(ADDRESS),','),' '))
    ELSE trim(replace(replace(ADDRESS1,' '),',')) END) AS ADDRESSID,
    CASE WHEN UPRN is null and addressid is null THEN 1 else 0 end as REMOVE_FROM_RM_MATCH,
    FLOOR_LEVEL,
    FLAT_TOP_STOREY,
    FLAT_STOREY_COUNT,
    PROPERTY_TYPE
 from  RAW.EPC_TEST_DATA.EPC_CERTIFICATES 

)

SELECT * FROM epc_certs
where REMOVE_FROM_RM_MATCH = 1
        );
[0m18:55:24.548579 [debug] [Thread-4 (]: On model.rightmove_epc.houses_report: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.houses_report"} */
create or replace transient table ANALYTICS_DEV.dbt_melissa_rm_epc.houses_report
         as
        (with house_addmatch as (

    select 
    distinct
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN,
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    epc.ADDRESSID AS EPC_ADDRESSID,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

     from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc on am.EPC_ADDRESSID = epc.ADDRESSID
    and am.FULL_POSTCODE = epc.POSTCODE
    where MATCH_EPC = 'YES'
    and COMBINED_PROPERTY_TYPE not in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')

),

house_uprnmatch as (

    select 
    distinct
    --count(LISTING_ID) as TOTAL_LISTINGS,
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN, -- NULL
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
  --  am.FLOOR_LEVEL as RM_FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    epc.ADDRESSID AS EPC_ADDRESSID,
    -- REMOVE_FROM_RM_MATCH,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

    

    from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn epc on am.EPC_UPRN = epc.UPRN

    where MATCH_EPC = 'YES'
    and COMBINED_PROPERTY_TYPE not in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')
  -- AND RM_UPRN = 100030719363

),

final as (

select 'UPRN' as MATCH_TYPE, * from house_uprnmatch

union all

select 'ADDRESSID' as MATCH_TYPE, * from house_addmatch

)

select distinct * from final


/*
--THIS IS USED FOR A TEST
select RM_UPRN,COUNT(BUILDING_REFERENCE_NUMBER)
from house_uprnmatch
WHERE RM_UPRN IS NOT NULL
GROUP BY 1
HAVING COUNT(BUILDING_REFERENCE_NUMBER) >1
*/
        );
[0m18:55:24.548885 [debug] [Thread-6 (]: On model.rightmove_epc.rm_listings: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.rm_listings"} */
create or replace transient table ANALYTICS_DEV.dbt_melissa_rm_epc.rm_listings
         as
        (WITH rm AS (
    SELECT * FROM ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn
    -- WHERE UPRN = 100013137 -- This line is commented out, but could be used to filter the dataset.
),
false_rm AS (
    SELECT 
        UPRN,
        COUNT(LISTING_ID) AS listing_count
    FROM rm
    GROUP BY UPRN
    -- HAVING COUNT(LISTING_ID) > 1 -- This is commented out but would filter to only UPRNs with more than one listing.
),
get_false AS (
    SELECT 
        rm.*,
        listing_count
    FROM rm
    INNER JOIN false_rm ON rm.UPRN = false_rm.UPRN
)
SELECT * FROM get_false
        );
[0m18:55:24.549097 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m18:55:24.549337 [debug] [Thread-7 (]: On model.rightmove_epc.rm_no_matches: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.rm_no_matches"} */
create or replace transient table ANALYTICS_DEV.dbt_melissa_rm_epc.rm_no_matches
         as
        (with addr as (

    select distinct
   -- LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN,
    EPC_ADDRESSID
    
    from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
    where MATCH_EPC = 'NO' 
),

uprn as (

    select distinct
    
  --  LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN::VARCHAR AS EPC_UPRN,
    EPC_ADDRESSID
    
     from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'NO'
),

uprn_address as (

        select 
    distinct
  --  LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN::VARCHAR AS EPC_UPRN,
    EPC_ADDRESSID
    
     from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_address_match
    where MATCH_EPC = 'NO'
),

final as (

select 'NO ADDRESS MATCH' AS MATCH_RESULT, * from addr
union all
select 'NO UPRN MATCH' AS MATCH_RESULT, * from uprn
union select 'NO ADDRESS OR UPRN MATCH' AS MATCH_RESULT, * from uprn

)

select distinct * from final
        );
[0m18:55:24.549962 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m18:55:24.550360 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m18:55:24.550580 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m18:55:24.550777 [debug] [Thread-6 (]: Opening a new connection, currently in state init
[0m18:55:24.551219 [debug] [Thread-7 (]: Opening a new connection, currently in state init
[0m18:55:26.101223 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m18:55:26.117533 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.epc_remove (execute): 18:55:24.533037 => 18:55:26.117363
[0m18:55:26.117824 [debug] [Thread-2 (]: On model.rightmove_epc.epc_remove: Close
[0m18:55:26.255308 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3911c8ca-5df8-4c0f-a7b5-9b90671ba7cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1063ae050>]}
[0m18:55:26.256124 [info ] [Thread-2 (]: 2 of 8 OK created sql table model dbt_melissa_rm_epc.epc_remove ................ [[32mSUCCESS 1[0m in 1.80s]
[0m18:55:26.256683 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.epc_remove
[0m18:56:19.213656 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 55.0 seconds
[0m18:56:19.217529 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.epc_flats (execute): 18:55:24.512981 => 18:56:19.217325
[0m18:56:19.217914 [debug] [Thread-1 (]: On model.rightmove_epc.epc_flats: Close
[0m18:56:19.381226 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3911c8ca-5df8-4c0f-a7b5-9b90671ba7cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10696ba10>]}
[0m18:56:19.382240 [info ] [Thread-1 (]: 1 of 8 OK created sql table model dbt_melissa_rm_epc.epc_flats ................. [[32mSUCCESS 1[0m in 54.93s]
[0m18:56:19.383039 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.epc_flats
[0m18:56:34.960833 [debug] [Thread-6 (]: SQL status: SUCCESS 1 in 70.0 seconds
[0m18:56:34.964529 [debug] [Thread-6 (]: Timing info for model.rightmove_epc.rm_listings (execute): 18:55:24.537458 => 18:56:34.964296
[0m18:56:34.964977 [debug] [Thread-6 (]: On model.rightmove_epc.rm_listings: Close
[0m18:56:35.189852 [debug] [Thread-6 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3911c8ca-5df8-4c0f-a7b5-9b90671ba7cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104f50c90>]}
[0m18:56:35.190910 [info ] [Thread-6 (]: 6 of 8 OK created sql table model dbt_melissa_rm_epc.rm_listings ............... [[32mSUCCESS 1[0m in 70.73s]
[0m18:56:35.191719 [debug] [Thread-6 (]: Finished running node model.rightmove_epc.rm_listings
[0m18:58:10.765067 [debug] [Thread-7 (]: SQL status: SUCCESS 1 in 166.0 seconds
[0m18:58:10.770299 [debug] [Thread-7 (]: Timing info for model.rightmove_epc.rm_no_matches (execute): 18:55:24.539015 => 18:58:10.769995
[0m18:58:10.770827 [debug] [Thread-7 (]: On model.rightmove_epc.rm_no_matches: Close
[0m18:58:10.979523 [debug] [Thread-7 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3911c8ca-5df8-4c0f-a7b5-9b90671ba7cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1067abed0>]}
[0m18:58:10.980243 [info ] [Thread-7 (]: 7 of 8 OK created sql table model dbt_melissa_rm_epc.rm_no_matches ............. [[32mSUCCESS 1[0m in 166.52s]
[0m18:58:10.980781 [debug] [Thread-7 (]: Finished running node model.rightmove_epc.rm_no_matches
[0m18:58:56.613579 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 212.0 seconds
[0m18:58:56.617510 [debug] [Thread-5 (]: Timing info for model.rightmove_epc.rm_all_matches (execute): 18:55:24.531398 => 18:58:56.617299
[0m18:58:56.617908 [debug] [Thread-5 (]: On model.rightmove_epc.rm_all_matches: Close
[0m18:58:56.896417 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3911c8ca-5df8-4c0f-a7b5-9b90671ba7cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106990610>]}
[0m18:58:56.897143 [info ] [Thread-5 (]: 5 of 8 OK created sql table model dbt_melissa_rm_epc.rm_all_matches ............ [[32mSUCCESS 1[0m in 212.44s]
[0m18:58:56.901404 [debug] [Thread-5 (]: Finished running node model.rightmove_epc.rm_all_matches
[0m18:59:04.442378 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 220.0 seconds
[0m18:59:04.444262 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.flats_report (execute): 18:55:24.529496 => 18:59:04.444132
[0m18:59:04.444529 [debug] [Thread-3 (]: On model.rightmove_epc.flats_report: Close
[0m18:59:04.598814 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3911c8ca-5df8-4c0f-a7b5-9b90671ba7cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102a08e10>]}
[0m18:59:04.599280 [info ] [Thread-3 (]: 3 of 8 OK created sql table model dbt_melissa_rm_epc.flats_report .............. [[32mSUCCESS 1[0m in 220.15s]
[0m18:59:04.599616 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.flats_report
[0m18:59:07.980799 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 223.0 seconds
[0m18:59:07.985041 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.houses_report (execute): 18:55:24.535076 => 18:59:07.984728
[0m18:59:07.985548 [debug] [Thread-4 (]: On model.rightmove_epc.houses_report: Close
[0m18:59:08.164150 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3911c8ca-5df8-4c0f-a7b5-9b90671ba7cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x106551190>]}
[0m18:59:08.165096 [info ] [Thread-4 (]: 4 of 8 OK created sql table model dbt_melissa_rm_epc.houses_report ............. [[32mSUCCESS 1[0m in 223.71s]
[0m18:59:08.165799 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.houses_report
[0m18:59:08.166823 [debug] [Thread-8 (]: Began running node model.rightmove_epc.zero_bedrooms
[0m18:59:08.167398 [info ] [Thread-8 (]: 8 of 8 START sql table model dbt_melissa_rm_epc.zero_bedrooms .................. [RUN]
[0m18:59:08.168276 [debug] [Thread-8 (]: Acquiring new snowflake connection 'model.rightmove_epc.zero_bedrooms'
[0m18:59:08.168622 [debug] [Thread-8 (]: Began compiling node model.rightmove_epc.zero_bedrooms
[0m18:59:08.173164 [debug] [Thread-8 (]: Writing injected SQL for node "model.rightmove_epc.zero_bedrooms"
[0m18:59:08.175706 [debug] [Thread-8 (]: Timing info for model.rightmove_epc.zero_bedrooms (compile): 18:59:08.168834 => 18:59:08.175511
[0m18:59:08.176029 [debug] [Thread-8 (]: Began executing node model.rightmove_epc.zero_bedrooms
[0m18:59:08.178742 [debug] [Thread-8 (]: Writing runtime sql for node "model.rightmove_epc.zero_bedrooms"
[0m18:59:08.179794 [debug] [Thread-8 (]: Using snowflake connection "model.rightmove_epc.zero_bedrooms"
[0m18:59:08.180126 [debug] [Thread-8 (]: On model.rightmove_epc.zero_bedrooms: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.zero_bedrooms"} */
create or replace transient table ANALYTICS_DEV.dbt_melissa_rm_epc.zero_bedrooms
         as
        (with houses as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.houses_report
    where BEDROOM = 0
),

flats as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.flats_report
        where BEDROOM = 0

)

select * from flats
union all
select * from houses
        );
[0m18:59:08.180434 [debug] [Thread-8 (]: Opening a new connection, currently in state init
[0m18:59:10.632792 [debug] [Thread-8 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m18:59:10.634850 [debug] [Thread-8 (]: Timing info for model.rightmove_epc.zero_bedrooms (execute): 18:59:08.176213 => 18:59:10.634706
[0m18:59:10.635123 [debug] [Thread-8 (]: On model.rightmove_epc.zero_bedrooms: Close
[0m18:59:10.805201 [debug] [Thread-8 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '3911c8ca-5df8-4c0f-a7b5-9b90671ba7cb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1064a7bd0>]}
[0m18:59:10.805754 [info ] [Thread-8 (]: 8 of 8 OK created sql table model dbt_melissa_rm_epc.zero_bedrooms ............. [[32mSUCCESS 1[0m in 2.64s]
[0m18:59:10.806151 [debug] [Thread-8 (]: Finished running node model.rightmove_epc.zero_bedrooms
[0m18:59:10.807473 [debug] [MainThread]: Connection 'master' was properly closed.
[0m18:59:10.807720 [debug] [MainThread]: Connection 'model.rightmove_epc.epc_flats' was properly closed.
[0m18:59:10.807912 [debug] [MainThread]: Connection 'model.rightmove_epc.flats_report' was properly closed.
[0m18:59:10.808089 [debug] [MainThread]: Connection 'model.rightmove_epc.epc_remove' was properly closed.
[0m18:59:10.808262 [debug] [MainThread]: Connection 'model.rightmove_epc.houses_report' was properly closed.
[0m18:59:10.808430 [debug] [MainThread]: Connection 'model.rightmove_epc.rm_all_matches' was properly closed.
[0m18:59:10.808597 [debug] [MainThread]: Connection 'model.rightmove_epc.rm_listings' was properly closed.
[0m18:59:10.808744 [debug] [MainThread]: Connection 'model.rightmove_epc.rm_no_matches' was properly closed.
[0m18:59:10.808887 [debug] [MainThread]: Connection 'model.rightmove_epc.zero_bedrooms' was properly closed.
[0m18:59:10.809089 [info ] [MainThread]: 
[0m18:59:10.809279 [info ] [MainThread]: Finished running 8 table models in 0 hours 3 minutes and 47.97 seconds (227.97s).
[0m18:59:10.810016 [debug] [MainThread]: Command end result
[0m18:59:10.817336 [info ] [MainThread]: 
[0m18:59:10.817598 [info ] [MainThread]: [32mCompleted successfully[0m
[0m18:59:10.817790 [info ] [MainThread]: 
[0m18:59:10.817988 [info ] [MainThread]: Done. PASS=8 WARN=0 ERROR=0 SKIP=0 TOTAL=8
[0m18:59:10.819985 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 228.31085, "process_user_time": 1.654521, "process_kernel_time": 0.2132, "process_mem_max_rss": "138723328", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m18:59:10.820302 [debug] [MainThread]: Command `dbt run` succeeded at 18:59:10.820230 after 228.31 seconds
[0m18:59:10.820524 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105852f90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10414d950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10158a210>]}
[0m18:59:10.820725 [debug] [MainThread]: Flushing usage events
[0m19:01:19.561158 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e53a10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e01f10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e5ea50>]}


============================== 19:01:19.564171 | b3ade8fb-9cc8-4ef4-81e8-1b31b99d8232 ==============================
[0m19:01:19.564171 [info ] [MainThread]: Running with dbt=1.7.10
[0m19:01:19.564554 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'debug': 'False', 'version_check': 'True', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'warn_error': 'None', 'fail_fast': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'introspect': 'True', 'invocation_command': 'dbt run --select models/reports/rm_no_matches.sql', 'static_parser': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m19:01:19.755492 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b3ade8fb-9cc8-4ef4-81e8-1b31b99d8232', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e87310>]}
[0m19:01:19.796544 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b3ade8fb-9cc8-4ef4-81e8-1b31b99d8232', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e53190>]}
[0m19:01:19.797264 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m19:01:19.807676 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m19:01:19.835025 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:01:19.835356 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:01:19.839465 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b3ade8fb-9cc8-4ef4-81e8-1b31b99d8232', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x121c27150>]}
[0m19:01:19.847370 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b3ade8fb-9cc8-4ef4-81e8-1b31b99d8232', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x121cb3b10>]}
[0m19:01:19.847667 [info ] [MainThread]: Found 22 models, 1 analysis, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m19:01:19.847886 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b3ade8fb-9cc8-4ef4-81e8-1b31b99d8232', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x121e33ed0>]}
[0m19:01:19.849118 [info ] [MainThread]: 
[0m19:01:19.849561 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m19:01:19.850156 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m19:01:19.857771 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m19:01:19.858111 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m19:01:19.858310 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:01:20.652381 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 1.0 seconds
[0m19:01:20.655754 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m19:01:20.829202 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m19:01:20.836640 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m19:01:20.836974 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m19:01:20.837242 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:01:21.397921 [debug] [ThreadPool]: SQL status: SUCCESS 23 in 1.0 seconds
[0m19:01:21.400910 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m19:01:21.559980 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b3ade8fb-9cc8-4ef4-81e8-1b31b99d8232', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1218193d0>]}
[0m19:01:21.560776 [info ] [MainThread]: Concurrency: 8 threads (target='dev')
[0m19:01:21.561069 [info ] [MainThread]: 
[0m19:01:21.564219 [debug] [Thread-1 (]: Began running node model.rightmove_epc.rm_no_matches
[0m19:01:21.564631 [info ] [Thread-1 (]: 1 of 1 START sql table model dbt_melissa_rm_epc.rm_no_matches .................. [RUN]
[0m19:01:21.565189 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.rm_no_matches)
[0m19:01:21.565490 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.rm_no_matches
[0m19:01:21.572486 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.rm_no_matches"
[0m19:01:21.573376 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.rm_no_matches (compile): 19:01:21.565671 => 19:01:21.573036
[0m19:01:21.573730 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.rm_no_matches
[0m19:01:21.622089 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.rm_no_matches"
[0m19:01:21.623451 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.rm_no_matches"
[0m19:01:21.623730 [debug] [Thread-1 (]: On model.rightmove_epc.rm_no_matches: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.rm_no_matches"} */
create or replace transient table ANALYTICS_DEV.dbt_melissa_rm_epc.rm_no_matches
         as
        (with addr as (

    select distinct
   -- LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN,
    EPC_ADDRESSID
    
    from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
    where MATCH_EPC = 'NO' 
),

uprn as (

    select distinct
    
  --  LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN::VARCHAR AS EPC_UPRN,
    EPC_ADDRESSID
    
     from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'NO'
),

uprn_address as (

        select 
    distinct
  --  LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN::VARCHAR AS EPC_UPRN,
    EPC_ADDRESSID
    
     from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_address_match
    where MATCH_EPC = 'NO'
),

final as (

select 'NO ADDRESS MATCH' AS MATCH_RESULT, * from addr
union all
select 'NO UPRN MATCH' AS MATCH_RESULT, * from uprn
union select 'NO ADDRESS OR UPRN MATCH' AS MATCH_RESULT, * from uprn_addr

)

select distinct * from final
        );
[0m19:01:21.623984 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:01:23.053624 [debug] [Thread-1 (]: Snowflake adapter: Snowflake query id: 01b34615-0103-9bc6-0000-71950637d782
[0m19:01:23.054064 [debug] [Thread-1 (]: Snowflake adapter: Snowflake error: 002003 (42S02): SQL compilation error:
Object 'UPRN_ADDR' does not exist or not authorized.
[0m19:01:23.054528 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.rm_no_matches (execute): 19:01:21.573904 => 19:01:23.054351
[0m19:01:23.054852 [debug] [Thread-1 (]: On model.rightmove_epc.rm_no_matches: Close
[0m19:01:23.236546 [debug] [Thread-1 (]: Database Error in model rm_no_matches (models/reports/rm_no_matches.sql)
  002003 (42S02): SQL compilation error:
  Object 'UPRN_ADDR' does not exist or not authorized.
  compiled Code at target/run/rightmove_epc/models/reports/rm_no_matches.sql
[0m19:01:23.237134 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b3ade8fb-9cc8-4ef4-81e8-1b31b99d8232', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1218f5b10>]}
[0m19:01:23.237723 [error] [Thread-1 (]: 1 of 1 ERROR creating sql table model dbt_melissa_rm_epc.rm_no_matches ......... [[31mERROR[0m in 1.67s]
[0m19:01:23.238275 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.rm_no_matches
[0m19:01:23.239957 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:01:23.240260 [debug] [MainThread]: Connection 'model.rightmove_epc.rm_no_matches' was properly closed.
[0m19:01:23.240548 [info ] [MainThread]: 
[0m19:01:23.240820 [info ] [MainThread]: Finished running 1 table model in 0 hours 0 minutes and 3.39 seconds (3.39s).
[0m19:01:23.241281 [debug] [MainThread]: Command end result
[0m19:01:23.249042 [info ] [MainThread]: 
[0m19:01:23.249357 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m19:01:23.249571 [info ] [MainThread]: 
[0m19:01:23.249789 [error] [MainThread]:   Database Error in model rm_no_matches (models/reports/rm_no_matches.sql)
  002003 (42S02): SQL compilation error:
  Object 'UPRN_ADDR' does not exist or not authorized.
  compiled Code at target/run/rightmove_epc/models/reports/rm_no_matches.sql
[0m19:01:23.250002 [info ] [MainThread]: 
[0m19:01:23.250223 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=1 SKIP=0 TOTAL=1
[0m19:01:23.252143 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 3.722526, "process_user_time": 1.33817, "process_kernel_time": 0.178283, "process_mem_max_rss": "135249920", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m19:01:23.252640 [debug] [MainThread]: Command `dbt run` failed at 19:01:23.252543 after 3.72 seconds
[0m19:01:23.252945 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e87110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102b36ad0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107e5e590>]}
[0m19:01:23.253228 [debug] [MainThread]: Flushing usage events
[0m19:02:04.725541 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ba54090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ba8e8d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ba9b3d0>]}


============================== 19:02:04.728497 | 4026f51c-fd4e-435e-a9a2-b3cb14316c97 ==============================
[0m19:02:04.728497 [info ] [MainThread]: Running with dbt=1.7.10
[0m19:02:04.728899 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'invocation_command': 'dbt run --select models/reports/rm_no_matches.sql', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m19:02:04.917595 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4026f51c-fd4e-435e-a9a2-b3cb14316c97', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c0078d0>]}
[0m19:02:04.957114 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4026f51c-fd4e-435e-a9a2-b3cb14316c97', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c591f50>]}
[0m19:02:04.958576 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m19:02:04.969355 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m19:02:04.988835 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:02:04.989150 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:02:04.993154 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4026f51c-fd4e-435e-a9a2-b3cb14316c97', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c718a50>]}
[0m19:02:05.001218 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4026f51c-fd4e-435e-a9a2-b3cb14316c97', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c827e10>]}
[0m19:02:05.001567 [info ] [MainThread]: Found 22 models, 1 analysis, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m19:02:05.001793 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4026f51c-fd4e-435e-a9a2-b3cb14316c97', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ba736d0>]}
[0m19:02:05.003028 [info ] [MainThread]: 
[0m19:02:05.003475 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m19:02:05.004096 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m19:02:05.011745 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m19:02:05.012007 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m19:02:05.012196 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:02:05.692077 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 1.0 seconds
[0m19:02:05.694442 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m19:02:05.869520 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m19:02:05.879398 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m19:02:05.880047 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m19:02:05.880374 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:02:06.457364 [debug] [ThreadPool]: SQL status: SUCCESS 23 in 1.0 seconds
[0m19:02:06.459224 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m19:02:06.625181 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4026f51c-fd4e-435e-a9a2-b3cb14316c97', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bae5650>]}
[0m19:02:06.626207 [info ] [MainThread]: Concurrency: 8 threads (target='dev')
[0m19:02:06.626533 [info ] [MainThread]: 
[0m19:02:06.629819 [debug] [Thread-1 (]: Began running node model.rightmove_epc.rm_no_matches
[0m19:02:06.630247 [info ] [Thread-1 (]: 1 of 1 START sql table model dbt_melissa_rm_epc.rm_no_matches .................. [RUN]
[0m19:02:06.630824 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.rm_no_matches)
[0m19:02:06.631128 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.rm_no_matches
[0m19:02:06.639355 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.rm_no_matches"
[0m19:02:06.640114 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.rm_no_matches (compile): 19:02:06.631312 => 19:02:06.639921
[0m19:02:06.640395 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.rm_no_matches
[0m19:02:06.689046 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.rm_no_matches"
[0m19:02:06.690378 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.rm_no_matches"
[0m19:02:06.690663 [debug] [Thread-1 (]: On model.rightmove_epc.rm_no_matches: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.rm_no_matches"} */
create or replace transient table ANALYTICS_DEV.dbt_melissa_rm_epc.rm_no_matches
         as
        (with addr as (

    select distinct
   -- LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN,
    EPC_ADDRESSID
    
    from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
    where MATCH_EPC = 'NO' 
),

uprn as (

    select distinct
    
  --  LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN::VARCHAR AS EPC_UPRN,
    EPC_ADDRESSID
    
     from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'NO'
),

uprn_address as (

        select 
    distinct
  --  LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN::VARCHAR AS EPC_UPRN,
    EPC_ADDRESSID
    
     from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_address_match
    where MATCH_EPC = 'NO'
),

final as (

select 'NO ADDRESS MATCH' AS MATCH_RESULT, * from addr
union all
select 'NO UPRN MATCH' AS MATCH_RESULT, * from uprn
union select 'NO ADDRESS OR UPRN MATCH' AS MATCH_RESULT, * from uprn_address

)

select distinct * from final
        );
[0m19:02:06.690922 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:03:16.623142 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 70.0 seconds
[0m19:03:16.647647 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.rm_no_matches (execute): 19:02:06.640550 => 19:03:16.647430
[0m19:03:16.648072 [debug] [Thread-1 (]: On model.rightmove_epc.rm_no_matches: Close
[0m19:03:16.942597 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4026f51c-fd4e-435e-a9a2-b3cb14316c97', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10c833a10>]}
[0m19:03:16.943874 [info ] [Thread-1 (]: 1 of 1 OK created sql table model dbt_melissa_rm_epc.rm_no_matches ............. [[32mSUCCESS 1[0m in 70.31s]
[0m19:03:16.944730 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.rm_no_matches
[0m19:03:16.947773 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:03:16.948283 [debug] [MainThread]: Connection 'model.rightmove_epc.rm_no_matches' was properly closed.
[0m19:03:16.948694 [info ] [MainThread]: 
[0m19:03:16.949097 [info ] [MainThread]: Finished running 1 table model in 0 hours 1 minutes and 11.95 seconds (71.95s).
[0m19:03:16.949804 [debug] [MainThread]: Command end result
[0m19:03:16.961686 [info ] [MainThread]: 
[0m19:03:16.962123 [info ] [MainThread]: [32mCompleted successfully[0m
[0m19:03:16.962400 [info ] [MainThread]: 
[0m19:03:16.962690 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m19:03:16.964746 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 72.269325, "process_user_time": 1.378702, "process_kernel_time": 0.182481, "process_mem_max_rss": "133201920", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m19:03:16.965224 [debug] [MainThread]: Command `dbt run` succeeded at 19:03:16.965118 after 72.27 seconds
[0m19:03:16.965548 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bac3f90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10bac3210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10ca90b50>]}
[0m19:03:16.965855 [debug] [MainThread]: Flushing usage events
[0m19:03:33.161905 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105154d50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10513df10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10519ae10>]}


============================== 19:03:33.164990 | 4abae7f3-1b89-4448-9099-e418e01c6f5e ==============================
[0m19:03:33.164990 [info ] [MainThread]: Running with dbt=1.7.10
[0m19:03:33.165360 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'version_check': 'True', 'fail_fast': 'False', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'introspect': 'True', 'invocation_command': 'dbt run --select models/reports/rm_all_matches.sql', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m19:03:33.366014 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4abae7f3-1b89-4448-9099-e418e01c6f5e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105cf7d10>]}
[0m19:03:33.407966 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4abae7f3-1b89-4448-9099-e418e01c6f5e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105d2be50>]}
[0m19:03:33.408858 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m19:03:33.419795 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m19:03:33.451583 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:03:33.451900 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:03:33.455946 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4abae7f3-1b89-4448-9099-e418e01c6f5e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104b541d0>]}
[0m19:03:33.463867 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4abae7f3-1b89-4448-9099-e418e01c6f5e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105e27cd0>]}
[0m19:03:33.464168 [info ] [MainThread]: Found 22 models, 1 analysis, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m19:03:33.464390 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4abae7f3-1b89-4448-9099-e418e01c6f5e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105cf7d10>]}
[0m19:03:33.465592 [info ] [MainThread]: 
[0m19:03:33.466037 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m19:03:33.466678 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m19:03:33.474128 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m19:03:33.474463 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m19:03:33.474646 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:03:34.204847 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 1.0 seconds
[0m19:03:34.209083 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m19:03:34.373322 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m19:03:34.381294 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m19:03:34.381635 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m19:03:34.381903 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:03:34.972435 [debug] [ThreadPool]: SQL status: SUCCESS 23 in 1.0 seconds
[0m19:03:34.974124 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m19:03:35.157411 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4abae7f3-1b89-4448-9099-e418e01c6f5e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105ce8c10>]}
[0m19:03:35.158635 [info ] [MainThread]: Concurrency: 8 threads (target='dev')
[0m19:03:35.159076 [info ] [MainThread]: 
[0m19:03:35.163383 [debug] [Thread-1 (]: Began running node model.rightmove_epc.rm_all_matches
[0m19:03:35.163929 [info ] [Thread-1 (]: 1 of 1 START sql table model dbt_melissa_rm_epc.rm_all_matches ................. [RUN]
[0m19:03:35.164655 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.rm_all_matches)
[0m19:03:35.165022 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.rm_all_matches
[0m19:03:35.174422 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.rm_all_matches"
[0m19:03:35.175596 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.rm_all_matches (compile): 19:03:35.165257 => 19:03:35.175370
[0m19:03:35.175898 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.rm_all_matches
[0m19:03:35.226962 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.rm_all_matches"
[0m19:03:35.228312 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.rm_all_matches"
[0m19:03:35.228589 [debug] [Thread-1 (]: On model.rightmove_epc.rm_all_matches: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.rm_all_matches"} */
create or replace transient table ANALYTICS_DEV.dbt_melissa_rm_epc.rm_all_matches
         as
        (with addr as (

    select distinct
  --  LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN,
    EPC_ADDRESSID
    
    from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
    where MATCH_EPC = 'YES' 
),

uprn_addr as (

    select 
    distinct
  --  LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN,
    EPC_ADDRESSID
    
    from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_address_match
    where MATCH_EPC = 'YES' 
),

uprn as (

    select 
    distinct
  --  LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN::VARCHAR AS EPC_UPRN,
    EPC_ADDRESSID

    from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'YES'
),

final as (

select 'ADDRESS AND POSTCODE MATCH' AS MATCH_RESULT, * from addr
union all
select 'UPRN MATCH' AS MATCH_RESULT, * from uprn
union all
select 'MATCH ADDRESS NO MATCH TO EPC UPRN' AS MATCH_RESULT, * from uprn_addr
)

select distinct * from final
        );
[0m19:03:35.228843 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:04:58.820514 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 84.0 seconds
[0m19:04:58.838757 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.rm_all_matches (execute): 19:03:35.176066 => 19:04:58.838581
[0m19:04:58.839119 [debug] [Thread-1 (]: On model.rightmove_epc.rm_all_matches: Close
[0m19:04:59.027242 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4abae7f3-1b89-4448-9099-e418e01c6f5e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105dddb50>]}
[0m19:04:59.027827 [info ] [Thread-1 (]: 1 of 1 OK created sql table model dbt_melissa_rm_epc.rm_all_matches ............ [[32mSUCCESS 1[0m in 83.86s]
[0m19:04:59.028204 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.rm_all_matches
[0m19:04:59.029788 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:04:59.030143 [debug] [MainThread]: Connection 'model.rightmove_epc.rm_all_matches' was properly closed.
[0m19:04:59.030375 [info ] [MainThread]: 
[0m19:04:59.030570 [info ] [MainThread]: Finished running 1 table model in 0 hours 1 minutes and 25.56 seconds (85.56s).
[0m19:04:59.030918 [debug] [MainThread]: Command end result
[0m19:04:59.037541 [info ] [MainThread]: 
[0m19:04:59.037791 [info ] [MainThread]: [32mCompleted successfully[0m
[0m19:04:59.037957 [info ] [MainThread]: 
[0m19:04:59.038135 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m19:04:59.040141 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 85.91193, "process_user_time": 1.366366, "process_kernel_time": 0.196012, "process_mem_max_rss": "133283840", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m19:04:59.040565 [debug] [MainThread]: Command `dbt run` succeeded at 19:04:59.040489 after 85.91 seconds
[0m19:04:59.040798 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100cb2150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x105d1ae50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100e05fd0>]}
[0m19:04:59.041020 [debug] [MainThread]: Flushing usage events
[0m19:10:13.537052 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114e549d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114e9a550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114e9b190>]}


============================== 19:10:13.539898 | c8642864-bc92-4f9f-8b63-5fcfc10a9b3d ==============================
[0m19:10:13.539898 [info ] [MainThread]: Running with dbt=1.7.10
[0m19:10:13.540251 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'fail_fast': 'False', 'warn_error': 'None', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'log_format': 'default', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select models/reports/flats_report.sql', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m19:10:13.731653 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c8642864-bc92-4f9f-8b63-5fcfc10a9b3d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1159a38d0>]}
[0m19:10:13.772632 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c8642864-bc92-4f9f-8b63-5fcfc10a9b3d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114ec34d0>]}
[0m19:10:13.773327 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m19:10:13.784067 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m19:10:13.810767 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:10:13.811066 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:10:13.814957 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c8642864-bc92-4f9f-8b63-5fcfc10a9b3d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x115ca7550>]}
[0m19:10:13.822805 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c8642864-bc92-4f9f-8b63-5fcfc10a9b3d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x115bb3dd0>]}
[0m19:10:13.823087 [info ] [MainThread]: Found 22 models, 1 analysis, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m19:10:13.823305 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c8642864-bc92-4f9f-8b63-5fcfc10a9b3d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11581b450>]}
[0m19:10:13.824467 [info ] [MainThread]: 
[0m19:10:13.824900 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m19:10:13.825523 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m19:10:13.832907 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m19:10:13.833211 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m19:10:13.833390 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:10:14.505015 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 1.0 seconds
[0m19:10:14.507261 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m19:10:14.677782 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m19:10:14.687071 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m19:10:14.687448 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m19:10:14.687759 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:10:15.276156 [debug] [ThreadPool]: SQL status: SUCCESS 23 in 1.0 seconds
[0m19:10:15.277884 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m19:10:15.437079 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c8642864-bc92-4f9f-8b63-5fcfc10a9b3d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x115b69f10>]}
[0m19:10:15.437863 [info ] [MainThread]: Concurrency: 8 threads (target='dev')
[0m19:10:15.438178 [info ] [MainThread]: 
[0m19:10:15.440635 [debug] [Thread-1 (]: Began running node model.rightmove_epc.flats_report
[0m19:10:15.441089 [info ] [Thread-1 (]: 1 of 1 START sql table model dbt_melissa_rm_epc.flats_report ................... [RUN]
[0m19:10:15.441684 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.flats_report)
[0m19:10:15.442043 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.flats_report
[0m19:10:15.484287 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.flats_report"
[0m19:10:15.485948 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.flats_report (compile): 19:10:15.442228 => 19:10:15.485806
[0m19:10:15.486171 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.flats_report
[0m19:10:15.501177 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.flats_report"
[0m19:10:15.503156 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.flats_report"
[0m19:10:15.503492 [debug] [Thread-1 (]: On model.rightmove_epc.flats_report: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.flats_report"} */
create or replace transient table ANALYTICS_DEV.dbt_melissa_rm_epc.flats_report
         as
        (with flat_addmatch as (

    select 
    distinct
    --count(LISTING_ID) as TOTAL_LISTINGS,
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN, -- NULL
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
 --   am.FLOOR_LEVEL as RM_FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    epc.ADDRESSID AS EPC_ADDRESSID,
    -- REMOVE_FROM_RM_MATCH,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

     from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc on am.EPC_ADDRESSID = epc.ADDRESSID
    and am.FULL_POSTCODE = epc.POSTCODE
    where MATCH_EPC = 'YES'
    and COMBINED_PROPERTY_TYPE in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')

),

flat_uprnmatch as (

    select 
    distinct
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN,
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    BUILDING_REFERENCE_NUMBER, 
    epc.ADDRESSID AS EPC_ADDRESSID,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

    

    from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn epc on am.EPC_UPRN = epc.UPRN

    where MATCH_EPC = 'YES'
   and COMBINED_PROPERTY_TYPE in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')
  -- AND RM_UPRN = 100030719363

),

flat_uprnmultimatch as (

    select 
    distinct
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN,
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    BUILDING_REFERENCE_NUMBER, 
    epc.ADDRESSID AS EPC_ADDRESSID,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

    

    from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match_flat am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn epc on am.EPC_UPRN = epc.UPRN

    where MATCH_EPC = 'YES'
   and COMBINED_PROPERTY_TYPE not in ('HOUSE / FLAT SHARE','FLAT / APARTMENT') -- this checks to ensure that houses listed on RightMove are included and matched to EPC as flats
  -- AND RM_UPRN = 100030719363

),

matches as (




select * from flat_uprnmatch

union all

select * from flat_addmatch

union all

select * from flat_uprnmultimatch
)

select distinct *  from matches 
/*
--THIS IS USED FOR A TEST
select RM_UPRN,COUNT(BUILDING_REFERENCE_NUMBER)
from house_uprnmatch
WHERE RM_UPRN IS NOT NULL
GROUP BY 1
HAVING COUNT(BUILDING_REFERENCE_NUMBER) >1
*/
        );
[0m19:10:15.503809 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:11:23.465496 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 68.0 seconds
[0m19:11:23.486454 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.flats_report (execute): 19:10:15.486292 => 19:11:23.486274
[0m19:11:23.486844 [debug] [Thread-1 (]: On model.rightmove_epc.flats_report: Close
[0m19:11:23.680634 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c8642864-bc92-4f9f-8b63-5fcfc10a9b3d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x115bf1690>]}
[0m19:11:23.681937 [info ] [Thread-1 (]: 1 of 1 OK created sql table model dbt_melissa_rm_epc.flats_report .............. [[32mSUCCESS 1[0m in 68.24s]
[0m19:11:23.682814 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.flats_report
[0m19:11:23.685773 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:11:23.686164 [debug] [MainThread]: Connection 'model.rightmove_epc.flats_report' was properly closed.
[0m19:11:23.686553 [info ] [MainThread]: 
[0m19:11:23.686936 [info ] [MainThread]: Finished running 1 table model in 0 hours 1 minutes and 9.86 seconds (69.86s).
[0m19:11:23.687653 [debug] [MainThread]: Command end result
[0m19:11:23.698758 [info ] [MainThread]: 
[0m19:11:23.699200 [info ] [MainThread]: [32mCompleted successfully[0m
[0m19:11:23.699429 [info ] [MainThread]: 
[0m19:11:23.699657 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m19:11:23.701781 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 70.19507, "process_user_time": 1.352118, "process_kernel_time": 0.16885, "process_mem_max_rss": "134430720", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m19:11:23.702206 [debug] [MainThread]: Command `dbt run` succeeded at 19:11:23.702115 after 70.20 seconds
[0m19:11:23.702477 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114e9b050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x114947fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104b6a150>]}
[0m19:11:23.702733 [debug] [MainThread]: Flushing usage events
[0m19:11:50.061462 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107070f50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10709a910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10709b490>]}


============================== 19:11:50.064543 | 1b6111a2-a059-4d45-a969-63ece8c14725 ==============================
[0m19:11:50.064543 [info ] [MainThread]: Running with dbt=1.7.10
[0m19:11:50.064915 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'version_check': 'True', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select models/reports/houses_report.sql', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m19:11:50.272820 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1b6111a2-a059-4d45-a969-63ece8c14725', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110cded90>]}
[0m19:11:50.313660 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1b6111a2-a059-4d45-a969-63ece8c14725', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1070690d0>]}
[0m19:11:50.314511 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m19:11:50.324674 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m19:11:50.345617 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:11:50.345946 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:11:50.350053 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1b6111a2-a059-4d45-a969-63ece8c14725', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110f30a10>]}
[0m19:11:50.358258 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1b6111a2-a059-4d45-a969-63ece8c14725', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110b9ca50>]}
[0m19:11:50.358622 [info ] [MainThread]: Found 22 models, 1 analysis, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m19:11:50.358849 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1b6111a2-a059-4d45-a969-63ece8c14725', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110f24690>]}
[0m19:11:50.360160 [info ] [MainThread]: 
[0m19:11:50.360641 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m19:11:50.361240 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m19:11:50.368968 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m19:11:50.369255 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m19:11:50.369437 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:11:51.085530 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 1.0 seconds
[0m19:11:51.088382 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m19:11:51.239115 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m19:11:51.246717 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m19:11:51.247092 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m19:11:51.247367 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:11:51.817653 [debug] [ThreadPool]: SQL status: SUCCESS 23 in 1.0 seconds
[0m19:11:51.820619 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m19:11:51.984357 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1b6111a2-a059-4d45-a969-63ece8c14725', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110fc7150>]}
[0m19:11:51.985127 [info ] [MainThread]: Concurrency: 8 threads (target='dev')
[0m19:11:51.985430 [info ] [MainThread]: 
[0m19:11:51.988570 [debug] [Thread-1 (]: Began running node model.rightmove_epc.houses_report
[0m19:11:51.988943 [info ] [Thread-1 (]: 1 of 1 START sql table model dbt_melissa_rm_epc.houses_report .................. [RUN]
[0m19:11:51.989452 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.houses_report)
[0m19:11:51.989718 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.houses_report
[0m19:11:52.029053 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.houses_report"
[0m19:11:52.029885 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.houses_report (compile): 19:11:51.989885 => 19:11:52.029750
[0m19:11:52.030096 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.houses_report
[0m19:11:52.044959 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.houses_report"
[0m19:11:52.046478 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.houses_report"
[0m19:11:52.046777 [debug] [Thread-1 (]: On model.rightmove_epc.houses_report: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.houses_report"} */
create or replace transient table ANALYTICS_DEV.dbt_melissa_rm_epc.houses_report
         as
        (with house_addmatch as (

    select 
    distinct
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN,
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    epc.ADDRESSID AS EPC_ADDRESSID,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

     from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc on am.EPC_ADDRESSID = epc.ADDRESSID
    and am.FULL_POSTCODE = epc.POSTCODE
    where MATCH_EPC = 'YES'
    and COMBINED_PROPERTY_TYPE not in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')

),

house_uprnmatch as (

    select 
    distinct
    --count(LISTING_ID) as TOTAL_LISTINGS,
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN, -- NULL
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
  --  am.FLOOR_LEVEL as RM_FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    epc.ADDRESSID AS EPC_ADDRESSID,
    -- REMOVE_FROM_RM_MATCH,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

    

    from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn epc on am.EPC_UPRN = epc.UPRN

    where MATCH_EPC = 'YES'
    and COMBINED_PROPERTY_TYPE not in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')
  -- AND RM_UPRN = 100030719363

),

final as (

select * from house_uprnmatch

union all

select * from house_addmatch

)

select distinct * from final


/*
--THIS IS USED FOR A TEST
select RM_UPRN,COUNT(BUILDING_REFERENCE_NUMBER)
from house_uprnmatch
WHERE RM_UPRN IS NOT NULL
GROUP BY 1
HAVING COUNT(BUILDING_REFERENCE_NUMBER) >1
*/
        );
[0m19:11:52.047051 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:13:01.334296 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 69.0 seconds
[0m19:13:01.351128 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.houses_report (execute): 19:11:52.030215 => 19:13:01.350946
[0m19:13:01.351473 [debug] [Thread-1 (]: On model.rightmove_epc.houses_report: Close
[0m19:13:01.554284 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1b6111a2-a059-4d45-a969-63ece8c14725', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110fe3710>]}
[0m19:13:01.555012 [info ] [Thread-1 (]: 1 of 1 OK created sql table model dbt_melissa_rm_epc.houses_report ............. [[32mSUCCESS 1[0m in 69.56s]
[0m19:13:01.555516 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.houses_report
[0m19:13:01.557366 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:13:01.557672 [debug] [MainThread]: Connection 'model.rightmove_epc.houses_report' was properly closed.
[0m19:13:01.557939 [info ] [MainThread]: 
[0m19:13:01.558215 [info ] [MainThread]: Finished running 1 table model in 0 hours 1 minutes and 11.20 seconds (71.20s).
[0m19:13:01.558700 [debug] [MainThread]: Command end result
[0m19:13:01.566536 [info ] [MainThread]: 
[0m19:13:01.567073 [info ] [MainThread]: [32mCompleted successfully[0m
[0m19:13:01.567351 [info ] [MainThread]: 
[0m19:13:01.567605 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m19:13:01.569683 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 71.54016, "process_user_time": 1.346055, "process_kernel_time": 0.182997, "process_mem_max_rss": "131629056", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m19:13:01.570153 [debug] [MainThread]: Command `dbt run` succeeded at 19:13:01.570055 after 71.54 seconds
[0m19:13:01.570428 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1070c3f90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1070c34d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100d56150>]}
[0m19:13:01.570684 [debug] [MainThread]: Flushing usage events
[0m19:29:17.159676 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109318b90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10935e810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10935f350>]}


============================== 19:29:17.162642 | 05cb7f4b-dedc-441a-bb6f-4a61aa099efe ==============================
[0m19:29:17.162642 [info ] [MainThread]: Running with dbt=1.7.10
[0m19:29:17.163009 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'write_json': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'version_check': 'True', 'warn_error': 'None', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'fail_fast': 'False', 'debug': 'False', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select models/stats', 'log_format': 'default', 'introspect': 'True', 'target_path': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m19:29:17.362101 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '05cb7f4b-dedc-441a-bb6f-4a61aa099efe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108c54050>]}
[0m19:29:17.401961 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '05cb7f4b-dedc-441a-bb6f-4a61aa099efe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1093a8290>]}
[0m19:29:17.402565 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m19:29:17.413122 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m19:29:17.447659 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:29:17.447984 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:29:17.452071 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '05cb7f4b-dedc-441a-bb6f-4a61aa099efe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a1bd0d0>]}
[0m19:29:17.461835 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '05cb7f4b-dedc-441a-bb6f-4a61aa099efe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109eefb50>]}
[0m19:29:17.462126 [info ] [MainThread]: Found 24 models, 1 analysis, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m19:29:17.462347 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '05cb7f4b-dedc-441a-bb6f-4a61aa099efe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1093c2bd0>]}
[0m19:29:17.463582 [info ] [MainThread]: 
[0m19:29:17.464037 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m19:29:17.464720 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m19:29:17.472302 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m19:29:17.472640 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m19:29:17.472841 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:29:18.119581 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 1.0 seconds
[0m19:29:18.122412 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m19:29:18.279596 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m19:29:18.286969 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m19:29:18.287285 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m19:29:18.287517 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:29:18.863809 [debug] [ThreadPool]: SQL status: SUCCESS 23 in 1.0 seconds
[0m19:29:18.865313 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m19:29:19.021530 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '05cb7f4b-dedc-441a-bb6f-4a61aa099efe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1097b11d0>]}
[0m19:29:19.022390 [info ] [MainThread]: Concurrency: 8 threads (target='dev')
[0m19:29:19.022713 [info ] [MainThread]: 
[0m19:29:19.025998 [debug] [Thread-1 (]: Began running node model.rightmove_epc.stats_matches
[0m19:29:19.026304 [debug] [Thread-2 (]: Began running node model.rightmove_epc.stats_property_totals
[0m19:29:19.027909 [info ] [Thread-1 (]: 1 of 3 START sql view model dbt_melissa_rm_epc.stats_matches ................... [RUN]
[0m19:29:19.026598 [debug] [Thread-3 (]: Began running node model.rightmove_epc.stats_staging_totals
[0m19:29:19.028771 [info ] [Thread-2 (]: 2 of 3 START sql view model dbt_melissa_rm_epc.stats_property_totals ........... [RUN]
[0m19:29:19.029405 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.stats_matches)
[0m19:29:19.029746 [info ] [Thread-3 (]: 3 of 3 START sql view model dbt_melissa_rm_epc.stats_staging_totals ............ [RUN]
[0m19:29:19.030268 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.stats_property_totals'
[0m19:29:19.030569 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.stats_matches
[0m19:29:19.031071 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.rightmove_epc.stats_staging_totals'
[0m19:29:19.031319 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.stats_property_totals
[0m19:29:19.071349 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.stats_matches"
[0m19:29:19.071673 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.stats_staging_totals
[0m19:29:19.073299 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.stats_property_totals"
[0m19:29:19.075083 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.stats_staging_totals"
[0m19:29:19.075634 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stats_matches (compile): 19:29:19.031487 => 19:29:19.075491
[0m19:29:19.075912 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.stats_staging_totals (compile): 19:29:19.073524 => 19:29:19.075804
[0m19:29:19.076109 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.stats_matches
[0m19:29:19.076313 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stats_property_totals (compile): 19:29:19.071811 => 19:29:19.076212
[0m19:29:19.076503 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.stats_staging_totals
[0m19:29:19.092567 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.stats_matches"
[0m19:29:19.092887 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.stats_property_totals
[0m19:29:19.094903 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.stats_staging_totals"
[0m19:29:19.096830 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.stats_property_totals"
[0m19:29:19.097955 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.stats_staging_totals"
[0m19:29:19.098531 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.stats_property_totals"
[0m19:29:19.099231 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.stats_matches"
[0m19:29:19.099500 [debug] [Thread-3 (]: On model.rightmove_epc.stats_staging_totals: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stats_staging_totals"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stats_staging_totals
  
   as (
    with total_epc as (

    select 
    'EPC' as SOURCE,
    count(*) as total_records,
    count(BUILDING_REFERENCE_NUMBER) as total_uid,
    count(UPRN) as total_uprn,
    count(distinct UPRN) as unique_uprn,
    count(addressid) as total_addressid,
    count(distinct addressid) as unique_addressid,
    count(distinct UPRN) + count(distinct addressid) unique_address_uprn


    
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
),

total_rm as (
    
    select 
    'RIGHTMOVE' as SOURCE,
    count(*) as total_records,
    count(LISTING_ID) as total_uid,
    count(UPRN) as total_uprn,
    count(distinct UPRN) as unique_uprn,
    count(addressid) as total_addressid,
    count(distinct addressid) as unique_addressid,
    count(distinct UPRN) + count(distinct addressid) unique_address_uprn


    
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove

)

select * from total_epc
union all
select * from total_rm
  );
[0m19:29:19.099819 [debug] [Thread-2 (]: On model.rightmove_epc.stats_property_totals: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stats_property_totals"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stats_property_totals
  
   as (
    with houses as (

    select 
    'flat' source,
    count(*) count
    from ANALYTICS_DEV.dbt_melissa_rm_epc.houses_report

),

flats as (

    select 
    'house' source,
    count(*) count
    from ANALYTICS_DEV.dbt_melissa_rm_epc.flats_report

)

select * from houses
union all
select * from flats
  );
[0m19:29:19.100077 [debug] [Thread-1 (]: On model.rightmove_epc.stats_matches: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stats_matches"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stats_matches
  
   as (
    WITH matches AS (
    SELECT 
        MATCH_RESULT,
        COUNT(*) AS count,
        COUNT(DISTINCT addressid) AS count_distinct_address,
        COUNT(addressid) AS count_address,
        COUNT(DISTINCT uprn) AS count_distinct_uprn,
        COUNT(uprn) AS count_uprn
    FROM ANALYTICS_DEV.dbt_melissa_rm_epc.rm_all_matches -- Replace with your actual table name or reference
    GROUP BY MATCH_RESULT

),
no_matches AS (
    SELECT 
        MATCH_RESULT,
        COUNT(*) AS count,
        COUNT(DISTINCT addressid) AS count_distinct_address,
        COUNT(addressid) AS count_address, -- This is redundant as it's the same as COUNT(*)
        COUNT(DISTINCT uprn) AS count_distinct_uprn,
        COUNT(uprn) AS count_uprn
    FROM ANALYTICS_DEV.dbt_melissa_rm_epc.rm_no_matches -- Replace with your actual table name or reference
    GROUP BY MATCH_RESULT
)

SELECT * FROM matches
UNION ALL
SELECT * FROM no_matches
  );
[0m19:29:19.100387 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m19:29:19.100633 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m19:29:19.100839 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:29:19.753182 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m19:29:19.770245 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.stats_matches (execute): 19:29:19.076617 => 19:29:19.770078
[0m19:29:19.771040 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m19:29:19.771338 [debug] [Thread-1 (]: On model.rightmove_epc.stats_matches: Close
[0m19:29:19.773013 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.stats_property_totals (execute): 19:29:19.095138 => 19:29:19.772866
[0m19:29:19.773961 [debug] [Thread-2 (]: On model.rightmove_epc.stats_property_totals: Close
[0m19:29:19.832017 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m19:29:19.833916 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.stats_staging_totals (execute): 19:29:19.093064 => 19:29:19.833760
[0m19:29:19.834210 [debug] [Thread-3 (]: On model.rightmove_epc.stats_staging_totals: Close
[0m19:29:19.916708 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '05cb7f4b-dedc-441a-bb6f-4a61aa099efe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109353450>]}
[0m19:29:19.917582 [info ] [Thread-2 (]: 2 of 3 OK created sql view model dbt_melissa_rm_epc.stats_property_totals ...... [[32mSUCCESS 1[0m in 0.89s]
[0m19:29:19.918192 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.stats_property_totals
[0m19:29:19.933309 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '05cb7f4b-dedc-441a-bb6f-4a61aa099efe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a0dee10>]}
[0m19:29:19.933972 [info ] [Thread-1 (]: 1 of 3 OK created sql view model dbt_melissa_rm_epc.stats_matches .............. [[32mSUCCESS 1[0m in 0.90s]
[0m19:29:19.934513 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.stats_matches
[0m19:29:19.973426 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '05cb7f4b-dedc-441a-bb6f-4a61aa099efe', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10a1bd2d0>]}
[0m19:29:19.974061 [info ] [Thread-3 (]: 3 of 3 OK created sql view model dbt_melissa_rm_epc.stats_staging_totals ....... [[32mSUCCESS 1[0m in 0.94s]
[0m19:29:19.974489 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.stats_staging_totals
[0m19:29:19.975985 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:29:19.976313 [debug] [MainThread]: Connection 'model.rightmove_epc.stats_matches' was properly closed.
[0m19:29:19.976525 [debug] [MainThread]: Connection 'model.rightmove_epc.stats_property_totals' was properly closed.
[0m19:29:19.976726 [debug] [MainThread]: Connection 'model.rightmove_epc.stats_staging_totals' was properly closed.
[0m19:29:19.976983 [info ] [MainThread]: 
[0m19:29:19.977218 [info ] [MainThread]: Finished running 3 view models in 0 hours 0 minutes and 2.51 seconds (2.51s).
[0m19:29:19.977791 [debug] [MainThread]: Command end result
[0m19:29:19.986485 [info ] [MainThread]: 
[0m19:29:19.986870 [info ] [MainThread]: [32mCompleted successfully[0m
[0m19:29:19.987150 [info ] [MainThread]: 
[0m19:29:19.987437 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
[0m19:29:19.989561 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 2.8612728, "process_user_time": 1.395762, "process_kernel_time": 0.186747, "process_mem_max_rss": "137150464", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m19:29:19.989962 [debug] [MainThread]: Command `dbt run` succeeded at 19:29:19.989871 after 2.86 seconds
[0m19:29:19.990206 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108cd3ad0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x104eb6210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10500a0d0>]}
[0m19:29:19.990446 [debug] [MainThread]: Flushing usage events
[0m07:52:20.024456 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111952ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11195c850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11195f010>]}


============================== 07:52:20.027334 | b3cc50e4-66a6-4767-8034-6ad44051a107 ==============================
[0m07:52:20.027334 [info ] [MainThread]: Running with dbt=1.7.10
[0m07:52:20.027713 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'debug': 'False', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'version_check': 'True', 'profiles_dir': '/Users/melissabee/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m07:52:20.231363 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b3cc50e4-66a6-4767-8034-6ad44051a107', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1123e58d0>]}
[0m07:52:20.273011 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b3cc50e4-66a6-4767-8034-6ad44051a107', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111987310>]}
[0m07:52:20.273748 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m07:52:20.284092 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m07:52:20.312071 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m07:52:20.312348 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m07:52:20.316313 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b3cc50e4-66a6-4767-8034-6ad44051a107', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112610dd0>]}
[0m07:52:20.324970 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b3cc50e4-66a6-4767-8034-6ad44051a107', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11249fb90>]}
[0m07:52:20.325267 [info ] [MainThread]: Found 24 models, 1 analysis, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m07:52:20.325485 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b3cc50e4-66a6-4767-8034-6ad44051a107', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1124042d0>]}
[0m07:52:20.326914 [info ] [MainThread]: 
[0m07:52:20.327383 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m07:52:20.328378 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m07:52:20.335790 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m07:52:20.336108 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m07:52:20.336290 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:52:21.066642 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 1.0 seconds
[0m07:52:21.070694 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m07:52:21.340391 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m07:52:21.348041 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m07:52:21.348363 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m07:52:21.348625 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:52:21.809871 [debug] [ThreadPool]: SQL status: SUCCESS 26 in 0.0 seconds
[0m07:52:21.812476 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m07:52:21.961480 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b3cc50e4-66a6-4767-8034-6ad44051a107', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112557990>]}
[0m07:52:21.962386 [info ] [MainThread]: Concurrency: 8 threads (target='dev')
[0m07:52:21.962719 [info ] [MainThread]: 
[0m07:52:21.967899 [debug] [Thread-1 (]: Began running node model.rightmove_epc.dim_uprn
[0m07:52:21.968226 [debug] [Thread-2 (]: Began running node model.rightmove_epc.epc_remove
[0m07:52:22.003866 [debug] [Thread-4 (]: Began running node model.rightmove_epc.stg_rightmove
[0m07:52:22.004351 [debug] [Thread-3 (]: Began running node model.rightmove_epc.stg_epc_certs
[0m07:52:22.003588 [info ] [Thread-1 (]: 1 of 24 START sql view model dbt_melissa_rm_epc.dim_uprn ....................... [RUN]
[0m07:52:22.004690 [info ] [Thread-2 (]: 2 of 24 START sql table model dbt_melissa_rm_epc.epc_remove .................... [RUN]
[0m07:52:22.004935 [info ] [Thread-4 (]: 4 of 24 START sql view model dbt_melissa_rm_epc.stg_rightmove .................. [RUN]
[0m07:52:22.005173 [info ] [Thread-3 (]: 3 of 24 START sql view model dbt_melissa_rm_epc.stg_epc_certs .................. [RUN]
[0m07:52:22.005605 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.dim_uprn)
[0m07:52:22.005976 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.epc_remove'
[0m07:52:22.006333 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.rightmove_epc.stg_rightmove'
[0m07:52:22.006676 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.rightmove_epc.stg_epc_certs'
[0m07:52:22.006860 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.dim_uprn
[0m07:52:22.007037 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.epc_remove
[0m07:52:22.007208 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.stg_rightmove
[0m07:52:22.007377 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.stg_epc_certs
[0m07:52:22.010716 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.dim_uprn"
[0m07:52:22.012420 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.epc_remove"
[0m07:52:22.013912 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.stg_rightmove"
[0m07:52:22.015656 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.stg_epc_certs"
[0m07:52:22.016808 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.dim_uprn (compile): 07:52:22.007498 => 07:52:22.016648
[0m07:52:22.017073 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.dim_uprn
[0m07:52:22.017383 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.stg_rightmove (compile): 07:52:22.012570 => 07:52:22.017255
[0m07:52:22.023775 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.stg_epc_certs (compile): 07:52:22.014079 => 07:52:22.023560
[0m07:52:22.029315 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.epc_remove (compile): 07:52:22.010886 => 07:52:22.029149
[0m07:52:22.034206 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.dim_uprn"
[0m07:52:22.034487 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.stg_rightmove
[0m07:52:22.034699 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.stg_epc_certs
[0m07:52:22.034888 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.epc_remove
[0m07:52:22.037003 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.stg_rightmove"
[0m07:52:22.038796 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.stg_epc_certs"
[0m07:52:22.039674 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.dim_uprn"
[0m07:52:22.050665 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.epc_remove"
[0m07:52:22.051111 [debug] [Thread-1 (]: On model.rightmove_epc.dim_uprn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_uprn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE UPRNS


with epc as (

   select distinct
    epc.uprn,
    epc.addressid,
    epc.ADDRESS,
    'EPC' AS datasource,
    epc.POSTCODE,
    case when multi.uprn is null then NULL else 1 end as MULTI_UPRN

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc
    left join ANALYTICS_DEV.dbt_melissa_rm_epc.epc_flats_count multi on epc.uprn = multi.uprn

    where epc.REMOVE_FROM_RM_MATCH = 0
    AND epc.UPRN IS NOT NULL
    
),

rightmove as (

 select distinct
    rm.uprn,
    rm.addressid,
    concat(rm.ADDRESS_1,',',rm.ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    rm.FULL_POSTCODE AS POSTCODE,
    multi.LISTING_COUNT AS MULTI_UPRN

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove rm
    left join ANALYTICS_DEV.dbt_melissa_rm_epc.false_listings_count multi on rm.uprn = multi.uprn
    WHERE rm.UPRN IS NOT NULL


),

final as (

    select * from epc
    union all
    select * from rightmove
)

select distinct * from final
  );
[0m07:52:22.051941 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.stg_epc_certs"
[0m07:52:22.052171 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:52:22.052803 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.stg_rightmove"
[0m07:52:22.053471 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.epc_remove"
[0m07:52:22.053684 [debug] [Thread-3 (]: On model.rightmove_epc.stg_epc_certs: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_epc_certs"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
  
   as (
    WITH epc_certs as (
    
    select 
    UPRN,
    LODGEMENT_DATE,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
   -- COUNTY,
    LOCAL_AUTHORITY as LOCAL_AUTHORITY_CODE,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    UPPER(CASE WHEN (UPPER(ADDRESS1) LIKE 'FLAT%' OR UPPER(ADDRESS1) LIKE 'UNIT%') or UPPER(ADDRESS1) LIKE 'ROOM%' 
    THEN TRIM(REPLACE(REPLACE(CONCAT(ADDRESS),','),' '))
    ELSE trim(replace(replace(ADDRESS1,' '),',')) END) AS ADDRESSID,
    CASE WHEN UPRN is null and addressid is null THEN 1 else 0 end as REMOVE_FROM_RM_MATCH,
    FLOOR_LEVEL,
    FLAT_TOP_STOREY,
    FLAT_STOREY_COUNT,
    PROPERTY_TYPE
 from  RAW.EPC_TEST_DATA.EPC_CERTIFICATES 

)

SELECT * FROM epc_certs
where REMOVE_FROM_RM_MATCH = 0
  );
[0m07:52:22.054324 [debug] [Thread-4 (]: On model.rightmove_epc.stg_rightmove: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_rightmove"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
  
   as (
    with rm as (

    SELECT 
    LISTING_ID, 
    CHANGE_DATE,
    UPPER(TRIM(replace(REPLACE(CONCAT(ADDRESS_1::VARCHAR,ADDRESS_2::VARCHAR),' '),','))) AS ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, 
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    BEDROOM,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    BRANCH_ID,
	 BRANCH_NAME,
    WEBSITE_URL,
	 COMPANY_NAME
    FROM 
       ANALYTICS.RIGHTMOVE_PROD.CLEAN_RAW_RIGHTMOVE_DATA 

 
)

SELECT * FROM rm
  );
[0m07:52:22.054776 [debug] [Thread-2 (]: On model.rightmove_epc.epc_remove: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.epc_remove"} */
create or replace transient table ANALYTICS_DEV.dbt_melissa_rm_epc.epc_remove
         as
        (WITH epc_certs as (
    
    select 
    UPRN,
    LODGEMENT_DATE,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
   -- COUNTY,
    LOCAL_AUTHORITY as LOCAL_AUTHORITY_CODE,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    UPPER(CASE WHEN (UPPER(ADDRESS1) LIKE 'FLAT%' OR UPPER(ADDRESS1) LIKE 'UNIT%') or UPPER(ADDRESS1) LIKE 'ROOM%' 
    THEN TRIM(REPLACE(REPLACE(CONCAT(ADDRESS),','),' '))
    ELSE trim(replace(replace(ADDRESS1,' '),',')) END) AS ADDRESSID,
    CASE WHEN UPRN is null and addressid is null THEN 1 else 0 end as REMOVE_FROM_RM_MATCH,
    FLOOR_LEVEL,
    FLAT_TOP_STOREY,
    FLAT_STOREY_COUNT,
    PROPERTY_TYPE
 from  RAW.EPC_TEST_DATA.EPC_CERTIFICATES 

)

SELECT * FROM epc_certs
where REMOVE_FROM_RM_MATCH = 1
        );
[0m07:52:22.055033 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m07:52:22.055231 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m07:52:22.055419 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m07:52:22.723064 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m07:52:22.744829 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.stg_rightmove (execute): 07:52:22.035094 => 07:52:22.744635
[0m07:52:22.745192 [debug] [Thread-4 (]: On model.rightmove_epc.stg_rightmove: Close
[0m07:52:22.846525 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m07:52:22.849605 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.stg_epc_certs (execute): 07:52:22.037197 => 07:52:22.849367
[0m07:52:22.850052 [debug] [Thread-3 (]: On model.rightmove_epc.stg_epc_certs: Close
[0m07:52:22.897514 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b3cc50e4-66a6-4767-8034-6ad44051a107', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x110286ed0>]}
[0m07:52:22.898233 [info ] [Thread-4 (]: 4 of 24 OK created sql view model dbt_melissa_rm_epc.stg_rightmove ............. [[32mSUCCESS 1[0m in 0.89s]
[0m07:52:22.898777 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.stg_rightmove
[0m07:52:22.899317 [debug] [Thread-6 (]: Began running node model.rightmove_epc.latest_rm_urn
[0m07:52:22.899725 [info ] [Thread-6 (]: 5 of 24 START sql view model dbt_melissa_rm_epc.latest_rm_urn .................. [RUN]
[0m07:52:22.900402 [debug] [Thread-6 (]: Acquiring new snowflake connection 'model.rightmove_epc.latest_rm_urn'
[0m07:52:22.900678 [debug] [Thread-6 (]: Began compiling node model.rightmove_epc.latest_rm_urn
[0m07:52:22.903282 [debug] [Thread-6 (]: Writing injected SQL for node "model.rightmove_epc.latest_rm_urn"
[0m07:52:22.904843 [debug] [Thread-6 (]: Timing info for model.rightmove_epc.latest_rm_urn (compile): 07:52:22.900847 => 07:52:22.904660
[0m07:52:22.905147 [debug] [Thread-6 (]: Began executing node model.rightmove_epc.latest_rm_urn
[0m07:52:22.907995 [debug] [Thread-6 (]: Writing runtime sql for node "model.rightmove_epc.latest_rm_urn"
[0m07:52:22.909005 [debug] [Thread-6 (]: Using snowflake connection "model.rightmove_epc.latest_rm_urn"
[0m07:52:22.909313 [debug] [Thread-6 (]: On model.rightmove_epc.latest_rm_urn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.latest_rm_urn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NOT NULL
),

change_date AS (
    SELECT 
        UPRN AS UPRN_CD, 
        MAX(CHANGE_DATE) AS MAX_CHANGE_DATE 
    FROM rm
    GROUP BY UPRN
),

rm_latest as (

    SELECT distinct * FROM rm
    LEFT JOIN change_date cd
    ON rm.UPRN = cd.UPRN_CD
    WHERE cd.MAX_CHANGE_DATE = rm.CHANGE_DATE 
 --  and UPRN = 100090588560
    
)

select DISTINCT * from rm_latest

/*
select uprn, count(*) from rm_latest
group by 1
having count(*) >1
*/
  );
[0m07:52:22.909597 [debug] [Thread-6 (]: Opening a new connection, currently in state init
[0m07:52:22.985431 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b3cc50e4-66a6-4767-8034-6ad44051a107', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1126b3a10>]}
[0m07:52:22.985943 [info ] [Thread-3 (]: 3 of 24 OK created sql view model dbt_melissa_rm_epc.stg_epc_certs ............. [[32mSUCCESS 1[0m in 0.98s]
[0m07:52:22.986325 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.stg_epc_certs
[0m07:52:22.986740 [debug] [Thread-8 (]: Began running node model.rightmove_epc.dim_addressid
[0m07:52:22.987014 [debug] [Thread-5 (]: Began running node model.rightmove_epc.latest_epc_urn
[0m07:52:22.987294 [debug] [Thread-4 (]: Began running node model.rightmove_epc.stats_staging_totals
[0m07:52:22.987548 [info ] [Thread-8 (]: 6 of 24 START sql view model dbt_melissa_rm_epc.dim_addressid .................. [RUN]
[0m07:52:22.987839 [info ] [Thread-5 (]: 7 of 24 START sql view model dbt_melissa_rm_epc.latest_epc_urn ................. [RUN]
[0m07:52:22.988119 [info ] [Thread-4 (]: 8 of 24 START sql view model dbt_melissa_rm_epc.stats_staging_totals ........... [RUN]
[0m07:52:22.988585 [debug] [Thread-8 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_addressid'
[0m07:52:22.989005 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.rightmove_epc.latest_epc_urn'
[0m07:52:22.989375 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_rightmove, now model.rightmove_epc.stats_staging_totals)
[0m07:52:22.989602 [debug] [Thread-8 (]: Began compiling node model.rightmove_epc.dim_addressid
[0m07:52:22.989817 [debug] [Thread-5 (]: Began compiling node model.rightmove_epc.latest_epc_urn
[0m07:52:22.990023 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.stats_staging_totals
[0m07:52:22.992182 [debug] [Thread-8 (]: Writing injected SQL for node "model.rightmove_epc.dim_addressid"
[0m07:52:22.993957 [debug] [Thread-5 (]: Writing injected SQL for node "model.rightmove_epc.latest_epc_urn"
[0m07:52:22.995926 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.stats_staging_totals"
[0m07:52:22.997398 [debug] [Thread-8 (]: Timing info for model.rightmove_epc.dim_addressid (compile): 07:52:22.990154 => 07:52:22.997227
[0m07:52:22.997702 [debug] [Thread-5 (]: Timing info for model.rightmove_epc.latest_epc_urn (compile): 07:52:22.992343 => 07:52:22.997557
[0m07:52:22.997924 [debug] [Thread-8 (]: Began executing node model.rightmove_epc.dim_addressid
[0m07:52:22.998153 [debug] [Thread-5 (]: Began executing node model.rightmove_epc.latest_epc_urn
[0m07:52:23.000423 [debug] [Thread-8 (]: Writing runtime sql for node "model.rightmove_epc.dim_addressid"
[0m07:52:23.000701 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.stats_staging_totals (compile): 07:52:22.994154 => 07:52:23.000578
[0m07:52:23.002479 [debug] [Thread-5 (]: Writing runtime sql for node "model.rightmove_epc.latest_epc_urn"
[0m07:52:23.002750 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.stats_staging_totals
[0m07:52:23.003438 [debug] [Thread-8 (]: Using snowflake connection "model.rightmove_epc.dim_addressid"
[0m07:52:23.005254 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.stats_staging_totals"
[0m07:52:23.005523 [debug] [Thread-8 (]: On model.rightmove_epc.dim_addressid: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_addressid"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE ADDRESS'

with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource,
    POSTCODE
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs 
    AND ADDRESSID IS NOT NULL

),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    WHERE ADDRESSID IS NOT NULL

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where addressid is not null
  );
[0m07:52:23.006069 [debug] [Thread-5 (]: Using snowflake connection "model.rightmove_epc.latest_epc_urn"
[0m07:52:23.006339 [debug] [Thread-8 (]: Opening a new connection, currently in state init
[0m07:52:23.006577 [debug] [Thread-5 (]: On model.rightmove_epc.latest_epc_urn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.latest_epc_urn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn
  
   as (
    with epc_max_date as (

    select uprn as UPRN_EPC,
    MAX(LODGEMENT_DATE) AS MAX_LODGEMENT_DATE,
    from  ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    group by 1


),

latest_epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc
    inner join epc_max_date on epc.uprn = epc_max_date.UPRN_EPC
    where MAX_LODGEMENT_DATE = LODGEMENT_DATE
   -- and uprn = 200073066

)

select DISTINCT * from latest_epc


/*
select uprn, count(*) from latest_epc
group by 1
having count(*) >1
*/
  );
[0m07:52:23.007324 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m07:52:23.008056 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.stats_staging_totals"
[0m07:52:23.008942 [debug] [Thread-4 (]: On model.rightmove_epc.stats_staging_totals: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stats_staging_totals"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stats_staging_totals
  
   as (
    with total_epc as (

    select 
    'EPC' as SOURCE,
    count(*) as total_records,
    count(BUILDING_REFERENCE_NUMBER) as total_uid,
    count(UPRN) as total_uprn,
    count(distinct UPRN) as unique_uprn,
    count(addressid) as total_addressid,
    count(distinct addressid) as unique_addressid,
    count(distinct UPRN) + count(distinct addressid) unique_address_uprn


    
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
),

total_rm as (
    
    select 
    'RIGHTMOVE' as SOURCE,
    count(*) as total_records,
    count(LISTING_ID) as total_uid,
    count(UPRN) as total_uprn,
    count(distinct UPRN) as unique_uprn,
    count(addressid) as total_addressid,
    count(distinct addressid) as unique_addressid,
    count(distinct UPRN) + count(distinct addressid) unique_address_uprn


    
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove

)

select * from total_epc
union all
select * from total_rm
  );
[0m07:52:23.009192 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m07:52:23.244964 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m07:52:23.247083 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.dim_uprn (execute): 07:52:22.017550 => 07:52:23.246928
[0m07:52:23.247385 [debug] [Thread-1 (]: On model.rightmove_epc.dim_uprn: Close
[0m07:52:23.384041 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b3cc50e4-66a6-4767-8034-6ad44051a107', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1122ae650>]}
[0m07:52:23.384667 [info ] [Thread-1 (]: 1 of 24 OK created sql view model dbt_melissa_rm_epc.dim_uprn .................. [[32mSUCCESS 1[0m in 1.38s]
[0m07:52:23.385138 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.dim_uprn
[0m07:52:23.475746 [debug] [Thread-8 (]: Snowflake adapter: Snowflake query id: 01b34918-0103-9bad-0000-71950638bcfe
[0m07:52:23.476249 [debug] [Thread-8 (]: Snowflake adapter: Snowflake error: 001003 (42000): SQL compilation error:
syntax error line 15 at position 4 unexpected 'AND'.
[0m07:52:23.476793 [debug] [Thread-8 (]: Timing info for model.rightmove_epc.dim_addressid (execute): 07:52:22.998333 => 07:52:23.476597
[0m07:52:23.477166 [debug] [Thread-8 (]: On model.rightmove_epc.dim_addressid: Close
[0m07:52:23.552095 [debug] [Thread-6 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m07:52:23.555331 [debug] [Thread-6 (]: Timing info for model.rightmove_epc.latest_rm_urn (execute): 07:52:22.905332 => 07:52:23.555098
[0m07:52:23.555781 [debug] [Thread-6 (]: On model.rightmove_epc.latest_rm_urn: Close
[0m07:52:23.621666 [debug] [Thread-8 (]: Database Error in model dim_addressid (models/bridge/dim_addressid.sql)
  001003 (42000): SQL compilation error:
  syntax error line 15 at position 4 unexpected 'AND'.
  compiled Code at target/run/rightmove_epc/models/bridge/dim_addressid.sql
[0m07:52:23.622265 [debug] [Thread-8 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b3cc50e4-66a6-4767-8034-6ad44051a107', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112555150>]}
[0m07:52:23.622763 [error] [Thread-8 (]: 6 of 24 ERROR creating sql view model dbt_melissa_rm_epc.dim_addressid ......... [[31mERROR[0m in 0.63s]
[0m07:52:23.623366 [debug] [Thread-8 (]: Finished running node model.rightmove_epc.dim_addressid
[0m07:52:23.623893 [debug] [Thread-3 (]: Began running node model.rightmove_epc.address_match
[0m07:52:23.624251 [info ] [Thread-3 (]: 9 of 24 SKIP relation dbt_melissa_rm_epc.address_match ......................... [[33mSKIP[0m]
[0m07:52:23.624607 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.address_match
[0m07:52:23.672287 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m07:52:23.674750 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.stats_staging_totals (execute): 07:52:23.003550 => 07:52:23.674571
[0m07:52:23.675089 [debug] [Thread-4 (]: On model.rightmove_epc.stats_staging_totals: Close
[0m07:52:23.687862 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m07:52:23.689930 [debug] [Thread-5 (]: Timing info for model.rightmove_epc.latest_epc_urn (execute): 07:52:23.000855 => 07:52:23.689777
[0m07:52:23.690228 [debug] [Thread-5 (]: On model.rightmove_epc.latest_epc_urn: Close
[0m07:52:23.705774 [debug] [Thread-6 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b3cc50e4-66a6-4767-8034-6ad44051a107', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1124cb9d0>]}
[0m07:52:23.706260 [info ] [Thread-6 (]: 5 of 24 OK created sql view model dbt_melissa_rm_epc.latest_rm_urn ............. [[32mSUCCESS 1[0m in 0.81s]
[0m07:52:23.706698 [debug] [Thread-6 (]: Finished running node model.rightmove_epc.latest_rm_urn
[0m07:52:23.707177 [debug] [Thread-1 (]: Began running node model.rightmove_epc.no_uprn_match
[0m07:52:23.707501 [debug] [Thread-8 (]: Began running node model.rightmove_epc.rm_listings
[0m07:52:23.707783 [info ] [Thread-1 (]: 10 of 24 START sql view model dbt_melissa_rm_epc.no_uprn_match ................. [RUN]
[0m07:52:23.708093 [debug] [Thread-7 (]: Began running node model.rightmove_epc.rm_listings_count
[0m07:52:23.708329 [debug] [Thread-3 (]: Began running node model.rightmove_epc.uprn_match
[0m07:52:23.708572 [info ] [Thread-8 (]: 11 of 24 START sql table model dbt_melissa_rm_epc.rm_listings .................. [RUN]
[0m07:52:23.708823 [debug] [Thread-6 (]: Began running node model.rightmove_epc.uprn_match_flat
[0m07:52:23.709233 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.dim_uprn, now model.rightmove_epc.no_uprn_match)
[0m07:52:23.709501 [info ] [Thread-7 (]: 12 of 24 START sql view model dbt_melissa_rm_epc.rm_listings_count ............. [RUN]
[0m07:52:23.709775 [info ] [Thread-3 (]: 13 of 24 START sql view model dbt_melissa_rm_epc.uprn_match .................... [RUN]
[0m07:52:23.710188 [debug] [Thread-8 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.dim_addressid, now model.rightmove_epc.rm_listings)
[0m07:52:23.710465 [info ] [Thread-6 (]: 14 of 24 START sql view model dbt_melissa_rm_epc.uprn_match_flat ............... [RUN]
[0m07:52:23.710702 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.no_uprn_match
[0m07:52:23.711134 [debug] [Thread-7 (]: Acquiring new snowflake connection 'model.rightmove_epc.rm_listings_count'
[0m07:52:23.711513 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_epc_certs, now model.rightmove_epc.uprn_match)
[0m07:52:23.711735 [debug] [Thread-8 (]: Began compiling node model.rightmove_epc.rm_listings
[0m07:52:23.712101 [debug] [Thread-6 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.latest_rm_urn, now model.rightmove_epc.uprn_match_flat)
[0m07:52:23.713695 [debug] [Thread-7 (]: Began compiling node model.rightmove_epc.rm_listings_count
[0m07:52:23.713983 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.uprn_match
[0m07:52:23.716924 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.no_uprn_match"
[0m07:52:23.718821 [debug] [Thread-8 (]: Writing injected SQL for node "model.rightmove_epc.rm_listings"
[0m07:52:23.719083 [debug] [Thread-6 (]: Began compiling node model.rightmove_epc.uprn_match_flat
[0m07:52:23.720648 [debug] [Thread-7 (]: Writing injected SQL for node "model.rightmove_epc.rm_listings_count"
[0m07:52:23.722537 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.uprn_match"
[0m07:52:23.724719 [debug] [Thread-6 (]: Writing injected SQL for node "model.rightmove_epc.uprn_match_flat"
[0m07:52:23.725207 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.no_uprn_match (compile): 07:52:23.712250 => 07:52:23.725063
[0m07:52:23.725633 [debug] [Thread-8 (]: Timing info for model.rightmove_epc.rm_listings (compile): 07:52:23.717201 => 07:52:23.725473
[0m07:52:23.725884 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.no_uprn_match
[0m07:52:23.726112 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.uprn_match (compile): 07:52:23.720813 => 07:52:23.726008
[0m07:52:23.726379 [debug] [Thread-7 (]: Timing info for model.rightmove_epc.rm_listings_count (compile): 07:52:23.719235 => 07:52:23.726247
[0m07:52:23.726559 [debug] [Thread-8 (]: Began executing node model.rightmove_epc.rm_listings
[0m07:52:23.726872 [debug] [Thread-6 (]: Timing info for model.rightmove_epc.uprn_match_flat (compile): 07:52:23.722888 => 07:52:23.726661
[0m07:52:23.728772 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.no_uprn_match"
[0m07:52:23.729005 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.uprn_match
[0m07:52:23.729227 [debug] [Thread-7 (]: Began executing node model.rightmove_epc.rm_listings_count
[0m07:52:23.730945 [debug] [Thread-8 (]: Writing runtime sql for node "model.rightmove_epc.rm_listings"
[0m07:52:23.731223 [debug] [Thread-6 (]: Began executing node model.rightmove_epc.uprn_match_flat
[0m07:52:23.733128 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.uprn_match"
[0m07:52:23.734982 [debug] [Thread-7 (]: Writing runtime sql for node "model.rightmove_epc.rm_listings_count"
[0m07:52:23.735669 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.no_uprn_match"
[0m07:52:23.737543 [debug] [Thread-6 (]: Writing runtime sql for node "model.rightmove_epc.uprn_match_flat"
[0m07:52:23.738176 [debug] [Thread-8 (]: Using snowflake connection "model.rightmove_epc.rm_listings"
[0m07:52:23.738478 [debug] [Thread-1 (]: On model.rightmove_epc.no_uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.no_uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.no_uprn_match
  
   as (
    with rm_latest as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn 
    where UPRN IS NOT NULL
),

epc_uprn as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
    where datasource = 'EPC'
)


SELECT rm_latest.*,
CASE WHEN epc_uprn.UPRN is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_uprn.UPRN AS EPC_UPRN,
epc_uprn.ADDRESSID AS EPC_ADDRESSID


FROM rm_latest
LEFT JOIN epc_uprn
ON rm_latest.UPRN = epc_uprn.UPRN

WHERE MATCH_EPC = 'NO'
  );
[0m07:52:23.739119 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.uprn_match"
[0m07:52:23.739429 [debug] [Thread-8 (]: On model.rightmove_epc.rm_listings: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.rm_listings"} */
create or replace transient table ANALYTICS_DEV.dbt_melissa_rm_epc.rm_listings
         as
        (WITH rm AS (
    SELECT * FROM ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn
    -- WHERE UPRN = 100013137 -- This line is commented out, but could be used to filter the dataset.
),
false_rm AS (
    SELECT 
        UPRN,
        COUNT(LISTING_ID) AS listing_count
    FROM rm
    GROUP BY UPRN
    -- HAVING COUNT(LISTING_ID) > 1 -- This is commented out but would filter to only UPRNs with more than one listing.
),
get_false AS (
    SELECT 
        rm.*,
        listing_count
    FROM rm
    INNER JOIN false_rm ON rm.UPRN = false_rm.UPRN
)
SELECT * FROM get_false
        );
[0m07:52:23.739849 [debug] [Thread-7 (]: Using snowflake connection "model.rightmove_epc.rm_listings_count"
[0m07:52:23.740102 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:52:23.740706 [debug] [Thread-6 (]: Using snowflake connection "model.rightmove_epc.uprn_match_flat"
[0m07:52:23.740953 [debug] [Thread-3 (]: On model.rightmove_epc.uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
  
   as (
    with rm_latest as (

    select rm.*,
    multi.uprn AS multi_uprn
    from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn rm
    left join ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn multi on rm.uprn = multi.uprn
    where rm.UPRN IS NOT NULL
    and multi.datasource = 'RIGHTMOVE'
   
),

epc_uprn as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
    where datasource = 'EPC'
    and multi_uprn is null  -- we do not use UPRN to match addresses with multiple URNs as they are flats and could fall into House report
)


SELECT rm_latest.*,
CASE WHEN epc_uprn.UPRN is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_uprn.UPRN AS EPC_UPRN,
epc_uprn.ADDRESSID AS EPC_ADDRESSID


FROM rm_latest
LEFT JOIN epc_uprn
ON rm_latest.UPRN = epc_uprn.UPRN

--WHERE MATCH_EPC = 'YES'
  );
[0m07:52:23.741715 [debug] [Thread-8 (]: Opening a new connection, currently in state closed
[0m07:52:23.741975 [debug] [Thread-7 (]: On model.rightmove_epc.rm_listings_count: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.rm_listings_count"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.rm_listings_count
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn

),

false_rm as (

    select 
    uprn,
    count(LISTING_ID) listing_count
    from rm
    group by 1
   -- having count(LISTING_ID) >1

)

select * from false_rm
  );
[0m07:52:23.742594 [debug] [Thread-6 (]: On model.rightmove_epc.uprn_match_flat: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.uprn_match_flat"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match_flat
  
   as (
    with rm_latest as (

    select rm.*,
    multi.uprn AS multi_uprn
    from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn rm
    left join ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn multi on rm.uprn = multi.uprn
    where rm.UPRN IS NOT NULL
    and multi.datasource = 'RIGHTMOVE'
   
),

epc_uprn as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
    where datasource = 'EPC'
    and multi_uprn is not null  -- we do not use UPRN to match addresses with multiple URNs as they are flats and could fall into House report
)


SELECT rm_latest.*,
CASE WHEN epc_uprn.UPRN is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_uprn.UPRN AS EPC_UPRN,
epc_uprn.ADDRESSID AS EPC_ADDRESSID


FROM rm_latest
LEFT JOIN epc_uprn
ON rm_latest.UPRN = epc_uprn.UPRN

--WHERE MATCH_EPC = 'YES'
  );
[0m07:52:23.743100 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m07:52:23.744295 [debug] [Thread-7 (]: Opening a new connection, currently in state init
[0m07:52:23.744777 [debug] [Thread-6 (]: Opening a new connection, currently in state closed
[0m07:52:23.831128 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b3cc50e4-66a6-4767-8034-6ad44051a107', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11229f290>]}
[0m07:52:23.831600 [info ] [Thread-5 (]: 7 of 24 OK created sql view model dbt_melissa_rm_epc.latest_epc_urn ............ [[32mSUCCESS 1[0m in 0.84s]
[0m07:52:23.831925 [debug] [Thread-5 (]: Finished running node model.rightmove_epc.latest_epc_urn
[0m07:52:23.832275 [debug] [Thread-5 (]: Began running node model.rightmove_epc.epc_flats
[0m07:52:23.832746 [info ] [Thread-5 (]: 15 of 24 START sql table model dbt_melissa_rm_epc.epc_flats .................... [RUN]
[0m07:52:23.833142 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.latest_epc_urn, now model.rightmove_epc.epc_flats)
[0m07:52:23.833381 [debug] [Thread-5 (]: Began compiling node model.rightmove_epc.epc_flats
[0m07:52:23.835053 [debug] [Thread-5 (]: Writing injected SQL for node "model.rightmove_epc.epc_flats"
[0m07:52:23.835486 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b3cc50e4-66a6-4767-8034-6ad44051a107', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1125e4d50>]}
[0m07:52:23.835841 [info ] [Thread-4 (]: 8 of 24 OK created sql view model dbt_melissa_rm_epc.stats_staging_totals ...... [[32mSUCCESS 1[0m in 0.85s]
[0m07:52:23.836182 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.stats_staging_totals
[0m07:52:23.836436 [debug] [Thread-4 (]: Began running node model.rightmove_epc.epc_flats_count
[0m07:52:23.836686 [info ] [Thread-4 (]: 16 of 24 START sql view model dbt_melissa_rm_epc.epc_flats_count ............... [RUN]
[0m07:52:23.837102 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stats_staging_totals, now model.rightmove_epc.epc_flats_count)
[0m07:52:23.837403 [debug] [Thread-5 (]: Timing info for model.rightmove_epc.epc_flats (compile): 07:52:23.833524 => 07:52:23.837286
[0m07:52:23.837586 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.epc_flats_count
[0m07:52:23.837781 [debug] [Thread-5 (]: Began executing node model.rightmove_epc.epc_flats
[0m07:52:23.840448 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.epc_flats_count"
[0m07:52:23.842174 [debug] [Thread-5 (]: Writing runtime sql for node "model.rightmove_epc.epc_flats"
[0m07:52:23.842968 [debug] [Thread-5 (]: Using snowflake connection "model.rightmove_epc.epc_flats"
[0m07:52:23.843215 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.epc_flats_count (compile): 07:52:23.837903 => 07:52:23.843089
[0m07:52:23.843444 [debug] [Thread-5 (]: On model.rightmove_epc.epc_flats: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.epc_flats"} */
create or replace transient table ANALYTICS_DEV.dbt_melissa_rm_epc.epc_flats
         as
        (with epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn

),

flat_epc as (

    select uprn,
    count(BUILDING_REFERENCE_NUMBER) as building_ref_count
    from epc
    group by 1
    having count(BUILDING_REFERENCE_NUMBER) >1

),

match_flat_epc as (

    select epc.*,
    building_ref_count
    from epc
    inner join flat_epc on epc.uprn = flat_epc.uprn

)

select * from match_flat_epc
        );
[0m07:52:23.843677 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.epc_flats_count
[0m07:52:23.843866 [debug] [Thread-5 (]: Opening a new connection, currently in state closed
[0m07:52:23.845759 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.epc_flats_count"
[0m07:52:23.847068 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.epc_flats_count"
[0m07:52:23.847325 [debug] [Thread-4 (]: On model.rightmove_epc.epc_flats_count: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.epc_flats_count"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.epc_flats_count
  
   as (
    with epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn

),

flat_epc as (

    select uprn,
    count(BUILDING_REFERENCE_NUMBER) as building_ref_count
    from epc
    group by 1
    having count(BUILDING_REFERENCE_NUMBER) >1

)

select * from flat_epc
  );
[0m07:52:23.847524 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m07:52:24.157682 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 2.0 seconds
[0m07:52:24.160060 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.epc_remove (execute): 07:52:22.039817 => 07:52:24.159877
[0m07:52:24.160392 [debug] [Thread-2 (]: On model.rightmove_epc.epc_remove: Close
[0m07:52:24.302598 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b3cc50e4-66a6-4767-8034-6ad44051a107', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112571c50>]}
[0m07:52:24.303483 [info ] [Thread-2 (]: 2 of 24 OK created sql table model dbt_melissa_rm_epc.epc_remove ............... [[32mSUCCESS 1[0m in 2.30s]
[0m07:52:24.304146 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.epc_remove
[0m07:52:24.382128 [debug] [Thread-7 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m07:52:24.385816 [debug] [Thread-7 (]: Timing info for model.rightmove_epc.rm_listings_count (execute): 07:52:23.733315 => 07:52:24.385573
[0m07:52:24.386274 [debug] [Thread-7 (]: On model.rightmove_epc.rm_listings_count: Close
[0m07:52:24.424955 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m07:52:24.427193 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.epc_flats_count (execute): 07:52:23.843984 => 07:52:24.427028
[0m07:52:24.427529 [debug] [Thread-4 (]: On model.rightmove_epc.epc_flats_count: Close
[0m07:52:24.495048 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m07:52:24.497927 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.no_uprn_match (execute): 07:52:23.726999 => 07:52:24.497690
[0m07:52:24.498345 [debug] [Thread-1 (]: On model.rightmove_epc.no_uprn_match: Close
[0m07:52:24.519808 [debug] [Thread-7 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b3cc50e4-66a6-4767-8034-6ad44051a107', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1137dee90>]}
[0m07:52:24.520508 [info ] [Thread-7 (]: 12 of 24 OK created sql view model dbt_melissa_rm_epc.rm_listings_count ........ [[32mSUCCESS 1[0m in 0.81s]
[0m07:52:24.521065 [debug] [Thread-7 (]: Finished running node model.rightmove_epc.rm_listings_count
[0m07:52:24.573982 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b3cc50e4-66a6-4767-8034-6ad44051a107', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1123b2e90>]}
[0m07:52:24.574616 [info ] [Thread-4 (]: 16 of 24 OK created sql view model dbt_melissa_rm_epc.epc_flats_count .......... [[32mSUCCESS 1[0m in 0.74s]
[0m07:52:24.575091 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.epc_flats_count
[0m07:52:24.620883 [debug] [Thread-6 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m07:52:24.623253 [debug] [Thread-6 (]: Timing info for model.rightmove_epc.uprn_match_flat (execute): 07:52:23.735799 => 07:52:24.623080
[0m07:52:24.623594 [debug] [Thread-6 (]: On model.rightmove_epc.uprn_match_flat: Close
[0m07:52:24.661965 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b3cc50e4-66a6-4767-8034-6ad44051a107', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x113791810>]}
[0m07:52:24.662651 [info ] [Thread-1 (]: 10 of 24 OK created sql view model dbt_melissa_rm_epc.no_uprn_match ............ [[32mSUCCESS 1[0m in 0.95s]
[0m07:52:24.663183 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.no_uprn_match
[0m07:52:24.663701 [debug] [Thread-2 (]: Began running node model.rightmove_epc.uprn_address_match
[0m07:52:24.664058 [info ] [Thread-2 (]: 17 of 24 SKIP relation dbt_melissa_rm_epc.uprn_address_match ................... [[33mSKIP[0m]
[0m07:52:24.664391 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.uprn_address_match
[0m07:52:24.754183 [debug] [Thread-6 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b3cc50e4-66a6-4767-8034-6ad44051a107', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112609f90>]}
[0m07:52:24.754884 [info ] [Thread-6 (]: 14 of 24 OK created sql view model dbt_melissa_rm_epc.uprn_match_flat .......... [[32mSUCCESS 1[0m in 1.04s]
[0m07:52:24.755414 [debug] [Thread-6 (]: Finished running node model.rightmove_epc.uprn_match_flat
[0m07:52:24.809120 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m07:52:24.812345 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.uprn_match (execute): 07:52:23.731413 => 07:52:24.812112
[0m07:52:24.812789 [debug] [Thread-3 (]: On model.rightmove_epc.uprn_match: Close
[0m07:52:24.963757 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b3cc50e4-66a6-4767-8034-6ad44051a107', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x11372a390>]}
[0m07:52:24.964563 [info ] [Thread-3 (]: 13 of 24 OK created sql view model dbt_melissa_rm_epc.uprn_match ............... [[32mSUCCESS 1[0m in 1.25s]
[0m07:52:24.965188 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.uprn_match
[0m07:52:24.965791 [debug] [Thread-4 (]: Began running node model.rightmove_epc.flats_report
[0m07:52:24.966177 [debug] [Thread-1 (]: Began running node model.rightmove_epc.houses_report
[0m07:52:24.966563 [debug] [Thread-7 (]: Began running node model.rightmove_epc.rm_all_matches
[0m07:52:24.966889 [info ] [Thread-4 (]: 18 of 24 SKIP relation dbt_melissa_rm_epc.flats_report ......................... [[33mSKIP[0m]
[0m07:52:24.967375 [info ] [Thread-1 (]: 19 of 24 SKIP relation dbt_melissa_rm_epc.houses_report ........................ [[33mSKIP[0m]
[0m07:52:24.967795 [debug] [Thread-2 (]: Began running node model.rightmove_epc.rm_no_matches
[0m07:52:24.968144 [info ] [Thread-7 (]: 20 of 24 SKIP relation dbt_melissa_rm_epc.rm_all_matches ....................... [[33mSKIP[0m]
[0m07:52:24.968514 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.flats_report
[0m07:52:24.968845 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.houses_report
[0m07:52:24.969184 [info ] [Thread-2 (]: 21 of 24 SKIP relation dbt_melissa_rm_epc.rm_no_matches ........................ [[33mSKIP[0m]
[0m07:52:24.969588 [debug] [Thread-7 (]: Finished running node model.rightmove_epc.rm_all_matches
[0m07:52:24.970222 [debug] [Thread-3 (]: Began running node model.rightmove_epc.stats_property_totals
[0m07:52:24.970565 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.rm_no_matches
[0m07:52:24.970875 [debug] [Thread-6 (]: Began running node model.rightmove_epc.zero_bedrooms
[0m07:52:24.971345 [info ] [Thread-3 (]: 22 of 24 SKIP relation dbt_melissa_rm_epc.stats_property_totals ................ [[33mSKIP[0m]
[0m07:52:24.971905 [debug] [Thread-1 (]: Began running node model.rightmove_epc.stats_matches
[0m07:52:24.972340 [info ] [Thread-6 (]: 23 of 24 SKIP relation dbt_melissa_rm_epc.zero_bedrooms ........................ [[33mSKIP[0m]
[0m07:52:24.972835 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.stats_property_totals
[0m07:52:24.973244 [info ] [Thread-1 (]: 24 of 24 SKIP relation dbt_melissa_rm_epc.stats_matches ........................ [[33mSKIP[0m]
[0m07:52:24.973623 [debug] [Thread-6 (]: Finished running node model.rightmove_epc.zero_bedrooms
[0m07:52:24.974021 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.stats_matches
[0m07:52:46.984624 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 23.0 seconds
[0m07:52:46.988220 [debug] [Thread-5 (]: Timing info for model.rightmove_epc.epc_flats (execute): 07:52:23.840648 => 07:52:46.988032
[0m07:52:46.988559 [debug] [Thread-5 (]: On model.rightmove_epc.epc_flats: Close
[0m07:52:47.180805 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b3cc50e4-66a6-4767-8034-6ad44051a107', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x112400b90>]}
[0m07:52:47.181575 [info ] [Thread-5 (]: 15 of 24 OK created sql table model dbt_melissa_rm_epc.epc_flats ............... [[32mSUCCESS 1[0m in 23.35s]
[0m07:52:47.182124 [debug] [Thread-5 (]: Finished running node model.rightmove_epc.epc_flats
[0m07:52:50.194261 [debug] [Thread-8 (]: SQL status: SUCCESS 1 in 26.0 seconds
[0m07:52:50.196543 [debug] [Thread-8 (]: Timing info for model.rightmove_epc.rm_listings (execute): 07:52:23.729367 => 07:52:50.196372
[0m07:52:50.196860 [debug] [Thread-8 (]: On model.rightmove_epc.rm_listings: Close
[0m07:52:50.347426 [debug] [Thread-8 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b3cc50e4-66a6-4767-8034-6ad44051a107', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1122cab10>]}
[0m07:52:50.348271 [info ] [Thread-8 (]: 11 of 24 OK created sql table model dbt_melissa_rm_epc.rm_listings ............. [[32mSUCCESS 1[0m in 26.64s]
[0m07:52:50.348881 [debug] [Thread-8 (]: Finished running node model.rightmove_epc.rm_listings
[0m07:52:50.351005 [debug] [MainThread]: Connection 'master' was properly closed.
[0m07:52:50.351389 [debug] [MainThread]: Connection 'model.rightmove_epc.no_uprn_match' was properly closed.
[0m07:52:50.351648 [debug] [MainThread]: Connection 'model.rightmove_epc.epc_remove' was properly closed.
[0m07:52:50.351879 [debug] [MainThread]: Connection 'model.rightmove_epc.epc_flats_count' was properly closed.
[0m07:52:50.352106 [debug] [MainThread]: Connection 'model.rightmove_epc.uprn_match' was properly closed.
[0m07:52:50.352324 [debug] [MainThread]: Connection 'model.rightmove_epc.uprn_match_flat' was properly closed.
[0m07:52:50.352541 [debug] [MainThread]: Connection 'model.rightmove_epc.rm_listings' was properly closed.
[0m07:52:50.352758 [debug] [MainThread]: Connection 'model.rightmove_epc.epc_flats' was properly closed.
[0m07:52:50.352974 [debug] [MainThread]: Connection 'model.rightmove_epc.rm_listings_count' was properly closed.
[0m07:52:50.353288 [info ] [MainThread]: 
[0m07:52:50.353568 [info ] [MainThread]: Finished running 16 view models, 8 table models in 0 hours 0 minutes and 30.03 seconds (30.03s).
[0m07:52:50.355527 [debug] [MainThread]: Command end result
[0m07:52:50.365453 [info ] [MainThread]: 
[0m07:52:50.365841 [info ] [MainThread]: [31mCompleted with 1 error and 0 warnings:[0m
[0m07:52:50.366075 [info ] [MainThread]: 
[0m07:52:50.366308 [error] [MainThread]:   Database Error in model dim_addressid (models/bridge/dim_addressid.sql)
  001003 (42000): SQL compilation error:
  syntax error line 15 at position 4 unexpected 'AND'.
  compiled Code at target/run/rightmove_epc/models/bridge/dim_addressid.sql
[0m07:52:50.366529 [info ] [MainThread]: 
[0m07:52:50.366738 [info ] [MainThread]: Done. PASS=14 WARN=0 ERROR=1 SKIP=9 TOTAL=24
[0m07:52:50.368844 [debug] [MainThread]: Resource report: {"command_name": "run", "command_wall_clock_time": 30.376757, "process_user_time": 1.889574, "process_kernel_time": 0.227763, "process_mem_max_rss": "145768448", "command_success": false, "process_in_blocks": "0", "process_out_blocks": "0"}
[0m07:52:50.369260 [debug] [MainThread]: Command `dbt run` failed at 07:52:50.369166 after 30.38 seconds
[0m07:52:50.369554 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x111987390>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102b82110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x102c86250>]}
[0m07:52:50.369822 [debug] [MainThread]: Flushing usage events
[0m07:52:57.998758 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107952c50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10795dc10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10795f050>]}


============================== 07:52:58.001047 | 49d3f53d-5e4a-4382-bf67-24ffbb9b5e88 ==============================
[0m07:52:58.001047 [info ] [MainThread]: Running with dbt=1.7.10
[0m07:52:58.001424 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'version_check': 'True', 'debug': 'False', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'fail_fast': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run', 'log_format': 'default', 'static_parser': 'True', 'target_path': 'None', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m07:52:58.183324 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '49d3f53d-5e4a-4382-bf67-24ffbb9b5e88', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10795c210>]}
[0m07:52:58.224214 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '49d3f53d-5e4a-4382-bf67-24ffbb9b5e88', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107994b50>]}
[0m07:52:58.225129 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m07:52:58.235631 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m07:52:58.255389 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m07:52:58.255708 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m07:52:58.259955 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '49d3f53d-5e4a-4382-bf67-24ffbb9b5e88', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1079a00d0>]}
[0m07:52:58.268419 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '49d3f53d-5e4a-4382-bf67-24ffbb9b5e88', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1081bf110>]}
[0m07:52:58.268776 [info ] [MainThread]: Found 24 models, 1 analysis, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m07:52:58.268998 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '49d3f53d-5e4a-4382-bf67-24ffbb9b5e88', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1082e7810>]}
[0m07:52:58.270498 [info ] [MainThread]: 
[0m07:52:58.270955 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m07:52:58.272056 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m07:52:58.279772 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m07:52:58.280104 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m07:52:58.280289 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m07:52:58.967253 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 1.0 seconds
[0m07:52:58.969851 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m07:52:59.143637 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m07:52:59.154595 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m07:52:59.155061 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m07:52:59.155383 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m07:52:59.710513 [debug] [ThreadPool]: SQL status: SUCCESS 26 in 1.0 seconds
[0m07:52:59.712712 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m07:52:59.860644 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '49d3f53d-5e4a-4382-bf67-24ffbb9b5e88', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10819cb10>]}
[0m07:52:59.861704 [info ] [MainThread]: Concurrency: 8 threads (target='dev')
[0m07:52:59.862084 [info ] [MainThread]: 
[0m07:52:59.865329 [debug] [Thread-1 (]: Began running node model.rightmove_epc.dim_uprn
[0m07:52:59.865806 [debug] [Thread-2 (]: Began running node model.rightmove_epc.epc_remove
[0m07:52:59.908042 [debug] [Thread-4 (]: Began running node model.rightmove_epc.stg_rightmove
[0m07:52:59.908563 [debug] [Thread-3 (]: Began running node model.rightmove_epc.stg_epc_certs
[0m07:52:59.907761 [info ] [Thread-1 (]: 1 of 24 START sql view model dbt_melissa_rm_epc.dim_uprn ....................... [RUN]
[0m07:52:59.908890 [info ] [Thread-2 (]: 2 of 24 START sql table model dbt_melissa_rm_epc.epc_remove .................... [RUN]
[0m07:52:59.909131 [info ] [Thread-4 (]: 4 of 24 START sql view model dbt_melissa_rm_epc.stg_rightmove .................. [RUN]
[0m07:52:59.909356 [info ] [Thread-3 (]: 3 of 24 START sql view model dbt_melissa_rm_epc.stg_epc_certs .................. [RUN]
[0m07:52:59.909780 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.dim_uprn)
[0m07:52:59.910199 [debug] [Thread-2 (]: Acquiring new snowflake connection 'model.rightmove_epc.epc_remove'
[0m07:52:59.910645 [debug] [Thread-4 (]: Acquiring new snowflake connection 'model.rightmove_epc.stg_rightmove'
[0m07:52:59.910983 [debug] [Thread-3 (]: Acquiring new snowflake connection 'model.rightmove_epc.stg_epc_certs'
[0m07:52:59.911168 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.dim_uprn
[0m07:52:59.911344 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.epc_remove
[0m07:52:59.911548 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.stg_rightmove
[0m07:52:59.911744 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.stg_epc_certs
[0m07:52:59.915391 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.dim_uprn"
[0m07:52:59.917293 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.epc_remove"
[0m07:52:59.918960 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.stg_rightmove"
[0m07:52:59.920636 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.stg_epc_certs"
[0m07:52:59.921388 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.dim_uprn (compile): 07:52:59.911876 => 07:52:59.921243
[0m07:52:59.921660 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.stg_rightmove (compile): 07:52:59.917495 => 07:52:59.921518
[0m07:52:59.921869 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.epc_remove (compile): 07:52:59.915627 => 07:52:59.921771
[0m07:52:59.922094 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.stg_epc_certs (compile): 07:52:59.919151 => 07:52:59.921982
[0m07:52:59.922277 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.dim_uprn
[0m07:52:59.922470 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.stg_rightmove
[0m07:52:59.922648 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.epc_remove
[0m07:52:59.922826 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.stg_epc_certs
[0m07:52:59.938557 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.dim_uprn"
[0m07:52:59.940441 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.stg_rightmove"
[0m07:52:59.951280 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.epc_remove"
[0m07:52:59.953059 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.stg_epc_certs"
[0m07:52:59.954182 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.dim_uprn"
[0m07:52:59.954772 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.stg_rightmove"
[0m07:52:59.955083 [debug] [Thread-1 (]: On model.rightmove_epc.dim_uprn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_uprn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE UPRNS


with epc as (

   select distinct
    epc.uprn,
    epc.addressid,
    epc.ADDRESS,
    'EPC' AS datasource,
    epc.POSTCODE,
    case when multi.uprn is null then NULL else 1 end as MULTI_UPRN

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc
    left join ANALYTICS_DEV.dbt_melissa_rm_epc.epc_flats_count multi on epc.uprn = multi.uprn

    where epc.REMOVE_FROM_RM_MATCH = 0
    AND epc.UPRN IS NOT NULL
    
),

rightmove as (

 select distinct
    rm.uprn,
    rm.addressid,
    concat(rm.ADDRESS_1,',',rm.ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    rm.FULL_POSTCODE AS POSTCODE,
    multi.LISTING_COUNT AS MULTI_UPRN

    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove rm
    left join ANALYTICS_DEV.dbt_melissa_rm_epc.false_listings_count multi on rm.uprn = multi.uprn
    WHERE rm.UPRN IS NOT NULL


),

final as (

    select * from epc
    union all
    select * from rightmove
)

select distinct * from final
  );
[0m07:52:59.955770 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.stg_epc_certs"
[0m07:52:59.956426 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.epc_remove"
[0m07:52:59.956653 [debug] [Thread-4 (]: On model.rightmove_epc.stg_rightmove: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_rightmove"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
  
   as (
    with rm as (

    SELECT 
    LISTING_ID, 
    CHANGE_DATE,
    UPPER(TRIM(replace(REPLACE(CONCAT(ADDRESS_1::VARCHAR,ADDRESS_2::VARCHAR),' '),','))) AS ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, 
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    BEDROOM,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    BRANCH_ID,
	 BRANCH_NAME,
    WEBSITE_URL,
	 COMPANY_NAME
    FROM 
       ANALYTICS.RIGHTMOVE_PROD.CLEAN_RAW_RIGHTMOVE_DATA 

 
)

SELECT * FROM rm
  );
[0m07:52:59.956882 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:52:59.957109 [debug] [Thread-3 (]: On model.rightmove_epc.stg_epc_certs: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stg_epc_certs"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
  
   as (
    WITH epc_certs as (
    
    select 
    UPRN,
    LODGEMENT_DATE,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
   -- COUNTY,
    LOCAL_AUTHORITY as LOCAL_AUTHORITY_CODE,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    UPPER(CASE WHEN (UPPER(ADDRESS1) LIKE 'FLAT%' OR UPPER(ADDRESS1) LIKE 'UNIT%') or UPPER(ADDRESS1) LIKE 'ROOM%' 
    THEN TRIM(REPLACE(REPLACE(CONCAT(ADDRESS),','),' '))
    ELSE trim(replace(replace(ADDRESS1,' '),',')) END) AS ADDRESSID,
    CASE WHEN UPRN is null and addressid is null THEN 1 else 0 end as REMOVE_FROM_RM_MATCH,
    FLOOR_LEVEL,
    FLAT_TOP_STOREY,
    FLAT_STOREY_COUNT,
    PROPERTY_TYPE
 from  RAW.EPC_TEST_DATA.EPC_CERTIFICATES 

)

SELECT * FROM epc_certs
where REMOVE_FROM_RM_MATCH = 0
  );
[0m07:52:59.957367 [debug] [Thread-2 (]: On model.rightmove_epc.epc_remove: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.epc_remove"} */
create or replace transient table ANALYTICS_DEV.dbt_melissa_rm_epc.epc_remove
         as
        (WITH epc_certs as (
    
    select 
    UPRN,
    LODGEMENT_DATE,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
   -- COUNTY,
    LOCAL_AUTHORITY as LOCAL_AUTHORITY_CODE,
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    UPPER(CASE WHEN (UPPER(ADDRESS1) LIKE 'FLAT%' OR UPPER(ADDRESS1) LIKE 'UNIT%') or UPPER(ADDRESS1) LIKE 'ROOM%' 
    THEN TRIM(REPLACE(REPLACE(CONCAT(ADDRESS),','),' '))
    ELSE trim(replace(replace(ADDRESS1,' '),',')) END) AS ADDRESSID,
    CASE WHEN UPRN is null and addressid is null THEN 1 else 0 end as REMOVE_FROM_RM_MATCH,
    FLOOR_LEVEL,
    FLAT_TOP_STOREY,
    FLAT_STOREY_COUNT,
    PROPERTY_TYPE
 from  RAW.EPC_TEST_DATA.EPC_CERTIFICATES 

)

SELECT * FROM epc_certs
where REMOVE_FROM_RM_MATCH = 1
        );
[0m07:52:59.957587 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m07:52:59.958166 [debug] [Thread-3 (]: Opening a new connection, currently in state init
[0m07:52:59.958545 [debug] [Thread-2 (]: Opening a new connection, currently in state init
[0m07:53:00.629949 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m07:53:00.646093 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.stg_rightmove (execute): 07:52:59.938730 => 07:53:00.645942
[0m07:53:00.646385 [debug] [Thread-4 (]: On model.rightmove_epc.stg_rightmove: Close
[0m07:53:00.786283 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '49d3f53d-5e4a-4382-bf67-24ffbb9b5e88', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108c30890>]}
[0m07:53:00.787191 [info ] [Thread-4 (]: 4 of 24 OK created sql view model dbt_melissa_rm_epc.stg_rightmove ............. [[32mSUCCESS 1[0m in 0.88s]
[0m07:53:00.787845 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.stg_rightmove
[0m07:53:00.788501 [debug] [Thread-6 (]: Began running node model.rightmove_epc.latest_rm_urn
[0m07:53:00.788971 [info ] [Thread-6 (]: 5 of 24 START sql view model dbt_melissa_rm_epc.latest_rm_urn .................. [RUN]
[0m07:53:00.789727 [debug] [Thread-6 (]: Acquiring new snowflake connection 'model.rightmove_epc.latest_rm_urn'
[0m07:53:00.790076 [debug] [Thread-6 (]: Began compiling node model.rightmove_epc.latest_rm_urn
[0m07:53:00.792882 [debug] [Thread-6 (]: Writing injected SQL for node "model.rightmove_epc.latest_rm_urn"
[0m07:53:00.793677 [debug] [Thread-6 (]: Timing info for model.rightmove_epc.latest_rm_urn (compile): 07:53:00.790281 => 07:53:00.793475
[0m07:53:00.794016 [debug] [Thread-6 (]: Began executing node model.rightmove_epc.latest_rm_urn
[0m07:53:00.797126 [debug] [Thread-6 (]: Writing runtime sql for node "model.rightmove_epc.latest_rm_urn"
[0m07:53:00.798232 [debug] [Thread-6 (]: Using snowflake connection "model.rightmove_epc.latest_rm_urn"
[0m07:53:00.798583 [debug] [Thread-6 (]: On model.rightmove_epc.latest_rm_urn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.latest_rm_urn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NOT NULL
),

change_date AS (
    SELECT 
        UPRN AS UPRN_CD, 
        MAX(CHANGE_DATE) AS MAX_CHANGE_DATE 
    FROM rm
    GROUP BY UPRN
),

rm_latest as (

    SELECT distinct * FROM rm
    LEFT JOIN change_date cd
    ON rm.UPRN = cd.UPRN_CD
    WHERE cd.MAX_CHANGE_DATE = rm.CHANGE_DATE 
 --  and UPRN = 100090588560
    
)

select DISTINCT * from rm_latest

/*
select uprn, count(*) from rm_latest
group by 1
having count(*) >1
*/
  );
[0m07:53:00.798896 [debug] [Thread-6 (]: Opening a new connection, currently in state init
[0m07:53:00.810329 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m07:53:00.812501 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.stg_epc_certs (execute): 07:52:59.951449 => 07:53:00.812326
[0m07:53:00.812830 [debug] [Thread-3 (]: On model.rightmove_epc.stg_epc_certs: Close
[0m07:53:00.848840 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m07:53:00.850958 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.dim_uprn (execute): 07:52:59.922940 => 07:53:00.850791
[0m07:53:00.851248 [debug] [Thread-1 (]: On model.rightmove_epc.dim_uprn: Close
[0m07:53:00.959227 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '49d3f53d-5e4a-4382-bf67-24ffbb9b5e88', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108527d10>]}
[0m07:53:00.959785 [info ] [Thread-3 (]: 3 of 24 OK created sql view model dbt_melissa_rm_epc.stg_epc_certs ............. [[32mSUCCESS 1[0m in 1.05s]
[0m07:53:00.960262 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.stg_epc_certs
[0m07:53:00.960788 [debug] [Thread-8 (]: Began running node model.rightmove_epc.dim_addressid
[0m07:53:00.961122 [debug] [Thread-5 (]: Began running node model.rightmove_epc.latest_epc_urn
[0m07:53:00.961406 [debug] [Thread-4 (]: Began running node model.rightmove_epc.stats_staging_totals
[0m07:53:00.961706 [info ] [Thread-8 (]: 6 of 24 START sql view model dbt_melissa_rm_epc.dim_addressid .................. [RUN]
[0m07:53:00.962048 [info ] [Thread-5 (]: 7 of 24 START sql view model dbt_melissa_rm_epc.latest_epc_urn ................. [RUN]
[0m07:53:00.962367 [info ] [Thread-4 (]: 8 of 24 START sql view model dbt_melissa_rm_epc.stats_staging_totals ........... [RUN]
[0m07:53:00.962872 [debug] [Thread-8 (]: Acquiring new snowflake connection 'model.rightmove_epc.dim_addressid'
[0m07:53:00.963307 [debug] [Thread-5 (]: Acquiring new snowflake connection 'model.rightmove_epc.latest_epc_urn'
[0m07:53:00.963689 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_rightmove, now model.rightmove_epc.stats_staging_totals)
[0m07:53:00.963920 [debug] [Thread-8 (]: Began compiling node model.rightmove_epc.dim_addressid
[0m07:53:00.964137 [debug] [Thread-5 (]: Began compiling node model.rightmove_epc.latest_epc_urn
[0m07:53:00.964347 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.stats_staging_totals
[0m07:53:00.966763 [debug] [Thread-8 (]: Writing injected SQL for node "model.rightmove_epc.dim_addressid"
[0m07:53:00.968669 [debug] [Thread-5 (]: Writing injected SQL for node "model.rightmove_epc.latest_epc_urn"
[0m07:53:00.970653 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.stats_staging_totals"
[0m07:53:00.972264 [debug] [Thread-5 (]: Timing info for model.rightmove_epc.latest_epc_urn (compile): 07:53:00.966947 => 07:53:00.972106
[0m07:53:00.972526 [debug] [Thread-8 (]: Timing info for model.rightmove_epc.dim_addressid (compile): 07:53:00.964483 => 07:53:00.972398
[0m07:53:00.972769 [debug] [Thread-5 (]: Began executing node model.rightmove_epc.latest_epc_urn
[0m07:53:00.973012 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.stats_staging_totals (compile): 07:53:00.968838 => 07:53:00.972891
[0m07:53:00.973229 [debug] [Thread-8 (]: Began executing node model.rightmove_epc.dim_addressid
[0m07:53:00.975300 [debug] [Thread-5 (]: Writing runtime sql for node "model.rightmove_epc.latest_epc_urn"
[0m07:53:00.975537 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.stats_staging_totals
[0m07:53:00.977366 [debug] [Thread-8 (]: Writing runtime sql for node "model.rightmove_epc.dim_addressid"
[0m07:53:00.979490 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.stats_staging_totals"
[0m07:53:00.980283 [debug] [Thread-5 (]: Using snowflake connection "model.rightmove_epc.latest_epc_urn"
[0m07:53:00.980994 [debug] [Thread-8 (]: Using snowflake connection "model.rightmove_epc.dim_addressid"
[0m07:53:00.981211 [debug] [Thread-5 (]: On model.rightmove_epc.latest_epc_urn: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.latest_epc_urn"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn
  
   as (
    with epc_max_date as (

    select uprn as UPRN_EPC,
    MAX(LODGEMENT_DATE) AS MAX_LODGEMENT_DATE,
    from  ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
    group by 1


),

latest_epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc
    inner join epc_max_date on epc.uprn = epc_max_date.UPRN_EPC
    where MAX_LODGEMENT_DATE = LODGEMENT_DATE
   -- and uprn = 200073066

)

select DISTINCT * from latest_epc


/*
select uprn, count(*) from latest_epc
group by 1
having count(*) >1
*/
  );
[0m07:53:00.981985 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.stats_staging_totals"
[0m07:53:00.982189 [debug] [Thread-8 (]: On model.rightmove_epc.dim_addressid: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.dim_addressid"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
  
   as (
    -- WE DO NOT INCLUDE LISTING / BUILDING REF AS THIS WILL CREATE DUPLICATE ADDRESS'

with epc as (

    select distinct
    uprn,
    addressid,
    ADDRESS,
    'EPC' AS datasource,
    POSTCODE
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs 
    where ADDRESSID IS NOT NULL

),

rightmove as (

 select distinct
    uprn,
    addressid,
    concat(ADDRESS_1,',',ADDRESS_2) as ADDRESS,
    'RIGHTMOVE' AS datasource,
    FULL_POSTCODE AS POSTCODE
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    WHERE ADDRESSID IS NOT NULL

),

final as (

    select * from epc
    union all
    select * from rightmove
)

select * from final
where addressid is not null
  );
[0m07:53:00.982412 [debug] [Thread-5 (]: Opening a new connection, currently in state init
[0m07:53:00.982664 [debug] [Thread-4 (]: On model.rightmove_epc.stats_staging_totals: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stats_staging_totals"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stats_staging_totals
  
   as (
    with total_epc as (

    select 
    'EPC' as SOURCE,
    count(*) as total_records,
    count(BUILDING_REFERENCE_NUMBER) as total_uid,
    count(UPRN) as total_uprn,
    count(distinct UPRN) as unique_uprn,
    count(addressid) as total_addressid,
    count(distinct addressid) as unique_addressid,
    count(distinct UPRN) + count(distinct addressid) unique_address_uprn


    
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs
),

total_rm as (
    
    select 
    'RIGHTMOVE' as SOURCE,
    count(*) as total_records,
    count(LISTING_ID) as total_uid,
    count(UPRN) as total_uprn,
    count(distinct UPRN) as unique_uprn,
    count(addressid) as total_addressid,
    count(distinct addressid) as unique_addressid,
    count(distinct UPRN) + count(distinct addressid) unique_address_uprn


    
    from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove

)

select * from total_epc
union all
select * from total_rm
  );
[0m07:53:00.982892 [debug] [Thread-8 (]: Opening a new connection, currently in state init
[0m07:53:00.983695 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m07:53:01.017193 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '49d3f53d-5e4a-4382-bf67-24ffbb9b5e88', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1081397d0>]}
[0m07:53:01.017654 [info ] [Thread-1 (]: 1 of 24 OK created sql view model dbt_melissa_rm_epc.dim_uprn .................. [[32mSUCCESS 1[0m in 1.11s]
[0m07:53:01.018025 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.dim_uprn
[0m07:53:01.488299 [debug] [Thread-6 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m07:53:01.491492 [debug] [Thread-6 (]: Timing info for model.rightmove_epc.latest_rm_urn (execute): 07:53:00.794198 => 07:53:01.491257
[0m07:53:01.491932 [debug] [Thread-6 (]: On model.rightmove_epc.latest_rm_urn: Close
[0m07:53:01.598417 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m07:53:01.601428 [debug] [Thread-5 (]: Timing info for model.rightmove_epc.latest_epc_urn (execute): 07:53:00.973360 => 07:53:01.601195
[0m07:53:01.601881 [debug] [Thread-5 (]: On model.rightmove_epc.latest_epc_urn: Close
[0m07:53:01.649967 [debug] [Thread-6 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '49d3f53d-5e4a-4382-bf67-24ffbb9b5e88', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108551c10>]}
[0m07:53:01.650661 [info ] [Thread-6 (]: 5 of 24 OK created sql view model dbt_melissa_rm_epc.latest_rm_urn ............. [[32mSUCCESS 1[0m in 0.86s]
[0m07:53:01.651237 [debug] [Thread-6 (]: Finished running node model.rightmove_epc.latest_rm_urn
[0m07:53:01.652016 [debug] [Thread-3 (]: Began running node model.rightmove_epc.no_uprn_match
[0m07:53:01.652481 [debug] [Thread-7 (]: Began running node model.rightmove_epc.rm_listings
[0m07:53:01.652933 [debug] [Thread-1 (]: Began running node model.rightmove_epc.rm_listings_count
[0m07:53:01.653261 [debug] [Thread-6 (]: Began running node model.rightmove_epc.uprn_match
[0m07:53:01.653661 [info ] [Thread-3 (]: 9 of 24 START sql view model dbt_melissa_rm_epc.no_uprn_match .................. [RUN]
[0m07:53:01.654108 [info ] [Thread-7 (]: 10 of 24 START sql table model dbt_melissa_rm_epc.rm_listings .................. [RUN]
[0m07:53:01.654515 [info ] [Thread-1 (]: 11 of 24 START sql view model dbt_melissa_rm_epc.rm_listings_count ............. [RUN]
[0m07:53:01.654963 [info ] [Thread-6 (]: 12 of 24 START sql view model dbt_melissa_rm_epc.uprn_match .................... [RUN]
[0m07:53:01.655622 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stg_epc_certs, now model.rightmove_epc.no_uprn_match)
[0m07:53:01.656262 [debug] [Thread-7 (]: Acquiring new snowflake connection 'model.rightmove_epc.rm_listings'
[0m07:53:01.656817 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.dim_uprn, now model.rightmove_epc.rm_listings_count)
[0m07:53:01.657336 [debug] [Thread-6 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.latest_rm_urn, now model.rightmove_epc.uprn_match)
[0m07:53:01.657639 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.no_uprn_match
[0m07:53:01.657918 [debug] [Thread-7 (]: Began compiling node model.rightmove_epc.rm_listings
[0m07:53:01.658183 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.rm_listings_count
[0m07:53:01.658446 [debug] [Thread-6 (]: Began compiling node model.rightmove_epc.uprn_match
[0m07:53:01.663126 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.no_uprn_match"
[0m07:53:01.665316 [debug] [Thread-7 (]: Writing injected SQL for node "model.rightmove_epc.rm_listings"
[0m07:53:01.667239 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.rm_listings_count"
[0m07:53:01.669368 [debug] [Thread-6 (]: Writing injected SQL for node "model.rightmove_epc.uprn_match"
[0m07:53:01.670173 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.no_uprn_match (compile): 07:53:01.658615 => 07:53:01.669982
[0m07:53:01.670500 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.no_uprn_match
[0m07:53:01.670793 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.rm_listings_count (compile): 07:53:01.665536 => 07:53:01.670648
[0m07:53:01.671096 [debug] [Thread-6 (]: Timing info for model.rightmove_epc.uprn_match (compile): 07:53:01.667453 => 07:53:01.670932
[0m07:53:01.671352 [debug] [Thread-7 (]: Timing info for model.rightmove_epc.rm_listings (compile): 07:53:01.663398 => 07:53:01.671233
[0m07:53:01.673596 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.no_uprn_match"
[0m07:53:01.674236 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.rm_listings_count
[0m07:53:01.674768 [debug] [Thread-6 (]: Began executing node model.rightmove_epc.uprn_match
[0m07:53:01.675054 [debug] [Thread-7 (]: Began executing node model.rightmove_epc.rm_listings
[0m07:53:01.677279 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.rm_listings_count"
[0m07:53:01.679490 [debug] [Thread-6 (]: Writing runtime sql for node "model.rightmove_epc.uprn_match"
[0m07:53:01.680266 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.no_uprn_match"
[0m07:53:01.682278 [debug] [Thread-7 (]: Writing runtime sql for node "model.rightmove_epc.rm_listings"
[0m07:53:01.682743 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m07:53:01.683256 [debug] [Thread-3 (]: On model.rightmove_epc.no_uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.no_uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.no_uprn_match
  
   as (
    with rm_latest as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn 
    where UPRN IS NOT NULL
),

epc_uprn as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
    where datasource = 'EPC'
)


SELECT rm_latest.*,
CASE WHEN epc_uprn.UPRN is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_uprn.UPRN AS EPC_UPRN,
epc_uprn.ADDRESSID AS EPC_ADDRESSID


FROM rm_latest
LEFT JOIN epc_uprn
ON rm_latest.UPRN = epc_uprn.UPRN

WHERE MATCH_EPC = 'NO'
  );
[0m07:53:01.683819 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.rm_listings_count"
[0m07:53:01.684486 [debug] [Thread-6 (]: Using snowflake connection "model.rightmove_epc.uprn_match"
[0m07:53:01.686156 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.stats_staging_totals (execute): 07:53:00.977581 => 07:53:01.686035
[0m07:53:01.686402 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m07:53:01.686898 [debug] [Thread-7 (]: Using snowflake connection "model.rightmove_epc.rm_listings"
[0m07:53:01.687136 [debug] [Thread-1 (]: On model.rightmove_epc.rm_listings_count: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.rm_listings_count"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.rm_listings_count
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn

),

false_rm as (

    select 
    uprn,
    count(LISTING_ID) listing_count
    from rm
    group by 1
   -- having count(LISTING_ID) >1

)

select * from false_rm
  );
[0m07:53:01.687408 [debug] [Thread-6 (]: On model.rightmove_epc.uprn_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.uprn_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
  
   as (
    with rm_latest as (

    select rm.*,
    multi.uprn AS multi_uprn
    from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn rm
    left join ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn multi on rm.uprn = multi.uprn
    where rm.UPRN IS NOT NULL
    and multi.datasource = 'RIGHTMOVE'
   
),

epc_uprn as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
    where datasource = 'EPC'
    and multi_uprn is null  -- we do not use UPRN to match addresses with multiple URNs as they are flats and could fall into House report
)


SELECT rm_latest.*,
CASE WHEN epc_uprn.UPRN is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_uprn.UPRN AS EPC_UPRN,
epc_uprn.ADDRESSID AS EPC_ADDRESSID


FROM rm_latest
LEFT JOIN epc_uprn
ON rm_latest.UPRN = epc_uprn.UPRN

--WHERE MATCH_EPC = 'YES'
  );
[0m07:53:01.687668 [debug] [Thread-4 (]: On model.rightmove_epc.stats_staging_totals: Close
[0m07:53:01.688259 [debug] [Thread-7 (]: On model.rightmove_epc.rm_listings: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.rm_listings"} */
create or replace transient table ANALYTICS_DEV.dbt_melissa_rm_epc.rm_listings
         as
        (WITH rm AS (
    SELECT * FROM ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn
    -- WHERE UPRN = 100013137 -- This line is commented out, but could be used to filter the dataset.
),
false_rm AS (
    SELECT 
        UPRN,
        COUNT(LISTING_ID) AS listing_count
    FROM rm
    GROUP BY UPRN
    -- HAVING COUNT(LISTING_ID) > 1 -- This is commented out but would filter to only UPRNs with more than one listing.
),
get_false AS (
    SELECT 
        rm.*,
        listing_count
    FROM rm
    INNER JOIN false_rm ON rm.UPRN = false_rm.UPRN
)
SELECT * FROM get_false
        );
[0m07:53:01.688682 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:53:01.688894 [debug] [Thread-6 (]: Opening a new connection, currently in state closed
[0m07:53:01.689552 [debug] [Thread-7 (]: Opening a new connection, currently in state init
[0m07:53:01.691782 [debug] [Thread-8 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m07:53:01.693705 [debug] [Thread-8 (]: Timing info for model.rightmove_epc.dim_addressid (execute): 07:53:00.975671 => 07:53:01.693579
[0m07:53:01.694123 [debug] [Thread-8 (]: On model.rightmove_epc.dim_addressid: Close
[0m07:53:01.757334 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '49d3f53d-5e4a-4382-bf67-24ffbb9b5e88', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108c22f50>]}
[0m07:53:01.757778 [info ] [Thread-5 (]: 7 of 24 OK created sql view model dbt_melissa_rm_epc.latest_epc_urn ............ [[32mSUCCESS 1[0m in 0.79s]
[0m07:53:01.758109 [debug] [Thread-5 (]: Finished running node model.rightmove_epc.latest_epc_urn
[0m07:53:01.758341 [debug] [Thread-5 (]: Began running node model.rightmove_epc.uprn_match_flat
[0m07:53:01.758614 [info ] [Thread-5 (]: 13 of 24 START sql view model dbt_melissa_rm_epc.uprn_match_flat ............... [RUN]
[0m07:53:01.759023 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.latest_epc_urn, now model.rightmove_epc.uprn_match_flat)
[0m07:53:01.759223 [debug] [Thread-5 (]: Began compiling node model.rightmove_epc.uprn_match_flat
[0m07:53:01.761243 [debug] [Thread-5 (]: Writing injected SQL for node "model.rightmove_epc.uprn_match_flat"
[0m07:53:01.761752 [debug] [Thread-5 (]: Timing info for model.rightmove_epc.uprn_match_flat (compile): 07:53:01.759338 => 07:53:01.761644
[0m07:53:01.761940 [debug] [Thread-5 (]: Began executing node model.rightmove_epc.uprn_match_flat
[0m07:53:01.763749 [debug] [Thread-5 (]: Writing runtime sql for node "model.rightmove_epc.uprn_match_flat"
[0m07:53:01.764621 [debug] [Thread-5 (]: Using snowflake connection "model.rightmove_epc.uprn_match_flat"
[0m07:53:01.764898 [debug] [Thread-5 (]: On model.rightmove_epc.uprn_match_flat: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.uprn_match_flat"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match_flat
  
   as (
    with rm_latest as (

    select rm.*,
    multi.uprn AS multi_uprn
    from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_rm_urn rm
    left join ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn multi on rm.uprn = multi.uprn
    where rm.UPRN IS NOT NULL
    and multi.datasource = 'RIGHTMOVE'
   
),

epc_uprn as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_uprn
    where datasource = 'EPC'
    and multi_uprn is not null  -- we do not use UPRN to match addresses with multiple URNs as they are flats and could fall into House report
)


SELECT rm_latest.*,
CASE WHEN epc_uprn.UPRN is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_uprn.UPRN AS EPC_UPRN,
epc_uprn.ADDRESSID AS EPC_ADDRESSID


FROM rm_latest
LEFT JOIN epc_uprn
ON rm_latest.UPRN = epc_uprn.UPRN

--WHERE MATCH_EPC = 'YES'
  );
[0m07:53:01.765128 [debug] [Thread-5 (]: Opening a new connection, currently in state closed
[0m07:53:01.826809 [debug] [Thread-8 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '49d3f53d-5e4a-4382-bf67-24ffbb9b5e88', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108c31350>]}
[0m07:53:01.827248 [info ] [Thread-8 (]: 6 of 24 OK created sql view model dbt_melissa_rm_epc.dim_addressid ............. [[32mSUCCESS 1[0m in 0.86s]
[0m07:53:01.827564 [debug] [Thread-8 (]: Finished running node model.rightmove_epc.dim_addressid
[0m07:53:01.827835 [debug] [Thread-8 (]: Began running node model.rightmove_epc.epc_flats
[0m07:53:01.828199 [info ] [Thread-8 (]: 14 of 24 START sql table model dbt_melissa_rm_epc.epc_flats .................... [RUN]
[0m07:53:01.828580 [debug] [Thread-8 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.dim_addressid, now model.rightmove_epc.epc_flats)
[0m07:53:01.828785 [debug] [Thread-8 (]: Began compiling node model.rightmove_epc.epc_flats
[0m07:53:01.831758 [debug] [Thread-8 (]: Writing injected SQL for node "model.rightmove_epc.epc_flats"
[0m07:53:01.832687 [debug] [Thread-8 (]: Timing info for model.rightmove_epc.epc_flats (compile): 07:53:01.829134 => 07:53:01.832546
[0m07:53:01.832931 [debug] [Thread-8 (]: Began executing node model.rightmove_epc.epc_flats
[0m07:53:01.833404 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '49d3f53d-5e4a-4382-bf67-24ffbb9b5e88', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108964d50>]}
[0m07:53:01.835137 [debug] [Thread-8 (]: Writing runtime sql for node "model.rightmove_epc.epc_flats"
[0m07:53:01.835524 [info ] [Thread-4 (]: 8 of 24 OK created sql view model dbt_melissa_rm_epc.stats_staging_totals ...... [[32mSUCCESS 1[0m in 0.87s]
[0m07:53:01.836060 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.stats_staging_totals
[0m07:53:01.836362 [debug] [Thread-4 (]: Began running node model.rightmove_epc.epc_flats_count
[0m07:53:01.837196 [debug] [Thread-8 (]: Using snowflake connection "model.rightmove_epc.epc_flats"
[0m07:53:01.836657 [info ] [Thread-4 (]: 15 of 24 START sql view model dbt_melissa_rm_epc.epc_flats_count ............... [RUN]
[0m07:53:01.837493 [debug] [Thread-8 (]: On model.rightmove_epc.epc_flats: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.epc_flats"} */
create or replace transient table ANALYTICS_DEV.dbt_melissa_rm_epc.epc_flats
         as
        (with epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn

),

flat_epc as (

    select uprn,
    count(BUILDING_REFERENCE_NUMBER) as building_ref_count
    from epc
    group by 1
    having count(BUILDING_REFERENCE_NUMBER) >1

),

match_flat_epc as (

    select epc.*,
    building_ref_count
    from epc
    inner join flat_epc on epc.uprn = flat_epc.uprn

)

select * from match_flat_epc
        );
[0m07:53:01.837900 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.stats_staging_totals, now model.rightmove_epc.epc_flats_count)
[0m07:53:01.838113 [debug] [Thread-8 (]: Opening a new connection, currently in state closed
[0m07:53:01.838306 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.epc_flats_count
[0m07:53:01.840372 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.epc_flats_count"
[0m07:53:01.841305 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.epc_flats_count (compile): 07:53:01.838786 => 07:53:01.841187
[0m07:53:01.841494 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.epc_flats_count
[0m07:53:01.843291 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.epc_flats_count"
[0m07:53:01.844203 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.epc_flats_count"
[0m07:53:01.844414 [debug] [Thread-4 (]: On model.rightmove_epc.epc_flats_count: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.epc_flats_count"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.epc_flats_count
  
   as (
    with epc as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn

),

flat_epc as (

    select uprn,
    count(BUILDING_REFERENCE_NUMBER) as building_ref_count
    from epc
    group by 1
    having count(BUILDING_REFERENCE_NUMBER) >1

)

select * from flat_epc
  );
[0m07:53:01.844619 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m07:53:02.321189 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m07:53:02.324536 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.rm_listings_count (execute): 07:53:01.675284 => 07:53:02.324284
[0m07:53:02.325002 [debug] [Thread-1 (]: On model.rightmove_epc.rm_listings_count: Close
[0m07:53:02.480190 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '49d3f53d-5e4a-4382-bf67-24ffbb9b5e88', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108958ad0>]}
[0m07:53:02.481169 [info ] [Thread-1 (]: 11 of 24 OK created sql view model dbt_melissa_rm_epc.rm_listings_count ........ [[32mSUCCESS 1[0m in 0.82s]
[0m07:53:02.481784 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.rm_listings_count
[0m07:53:02.482211 [debug] [Thread-1 (]: Began running node model.rightmove_epc.address_match
[0m07:53:02.482989 [info ] [Thread-1 (]: 16 of 24 START sql view model dbt_melissa_rm_epc.address_match ................. [RUN]
[0m07:53:02.483891 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.rm_listings_count, now model.rightmove_epc.address_match)
[0m07:53:02.484302 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.address_match
[0m07:53:02.487841 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.address_match"
[0m07:53:02.488818 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.address_match (compile): 07:53:02.484640 => 07:53:02.488558
[0m07:53:02.489191 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.address_match
[0m07:53:02.492168 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.address_match"
[0m07:53:02.493604 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.address_match"
[0m07:53:02.494022 [debug] [Thread-1 (]: On model.rightmove_epc.address_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.address_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
  
   as (
    with rm as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.stg_rightmove
    where UPRN IS NULL

),



epc_address as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid
    where datasource = 'EPC'
    
)


SELECT rm.*,
CASE WHEN epc_address.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC,
epc_address.ADDRESSID AS EPC_ADDRESSID,
epc_address.UPRN AS EPC_UPRN


FROM rm
LEFT JOIN epc_address
ON rm.addressid = epc_address.addressid
and rm.FULL_POSTCODE = epc_address.POSTCODE
  );
[0m07:53:02.494318 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:53:02.530833 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m07:53:02.533049 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.no_uprn_match (execute): 07:53:01.671477 => 07:53:02.532914
[0m07:53:02.533450 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 3.0 seconds
[0m07:53:02.533680 [debug] [Thread-3 (]: On model.rightmove_epc.no_uprn_match: Close
[0m07:53:02.535128 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.epc_remove (execute): 07:52:59.940609 => 07:53:02.535012
[0m07:53:02.535983 [debug] [Thread-2 (]: On model.rightmove_epc.epc_remove: Close
[0m07:53:02.634537 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m07:53:02.636448 [debug] [Thread-5 (]: Timing info for model.rightmove_epc.uprn_match_flat (execute): 07:53:01.762063 => 07:53:02.636311
[0m07:53:02.636889 [debug] [Thread-5 (]: On model.rightmove_epc.uprn_match_flat: Close
[0m07:53:02.637915 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m07:53:02.639669 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.epc_flats_count (execute): 07:53:01.841605 => 07:53:02.639557
[0m07:53:02.639930 [debug] [Thread-4 (]: On model.rightmove_epc.epc_flats_count: Close
[0m07:53:02.693174 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '49d3f53d-5e4a-4382-bf67-24ffbb9b5e88', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108c0d490>]}
[0m07:53:02.693911 [info ] [Thread-3 (]: 9 of 24 OK created sql view model dbt_melissa_rm_epc.no_uprn_match ............. [[32mSUCCESS 1[0m in 1.04s]
[0m07:53:02.694308 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.no_uprn_match
[0m07:53:02.694689 [debug] [Thread-3 (]: Began running node model.rightmove_epc.uprn_address_match
[0m07:53:02.694970 [info ] [Thread-3 (]: 17 of 24 START sql view model dbt_melissa_rm_epc.uprn_address_match ............ [RUN]
[0m07:53:02.695397 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.no_uprn_match, now model.rightmove_epc.uprn_address_match)
[0m07:53:02.695863 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '49d3f53d-5e4a-4382-bf67-24ffbb9b5e88', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108139550>]}
[0m07:53:02.696128 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.uprn_address_match
[0m07:53:02.696462 [info ] [Thread-2 (]: 2 of 24 OK created sql table model dbt_melissa_rm_epc.epc_remove ............... [[32mSUCCESS 1[0m in 2.79s]
[0m07:53:02.698570 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.uprn_address_match"
[0m07:53:02.698887 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.epc_remove
[0m07:53:02.699412 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.uprn_address_match (compile): 07:53:02.696643 => 07:53:02.699291
[0m07:53:02.699625 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.uprn_address_match
[0m07:53:02.701953 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.uprn_address_match"
[0m07:53:02.703629 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.uprn_address_match"
[0m07:53:02.703910 [debug] [Thread-3 (]: On model.rightmove_epc.uprn_address_match: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.uprn_address_match"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_address_match
  
   as (
    -- where uprn is not matched we try address.

with uprn as (

    select 
    up.LISTING_ID,
    CHANGE_DATE,
    up.ADDRESSID,
    up.ADDRESS_1,
    up.ADDRESS_2,
    FULL_POSTCODE,
    up.UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    BEDROOM,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
 -- need to sleect the same fields as address match
    CASE WHEN ad.ADDRESSID is null then 'NO' ELSE 'YES' end as MATCH_EPC,
    ad.ADDRESSID AS EPC_ADDRESSID,
    ad.UPRN AS EPC_UPRN

     from ANALYTICS_DEV.dbt_melissa_rm_epc.no_uprn_match up
    left join ANALYTICS_DEV.dbt_melissa_rm_epc.dim_addressid ad on up.ADDRESSID = ad.ADDRESSID
    and up.FULL_POSTCODE = ad.POSTCODE
   
)

SELECT * FROM UPRN
  );
[0m07:53:02.704525 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m07:53:02.783051 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '49d3f53d-5e4a-4382-bf67-24ffbb9b5e88', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1088cb810>]}
[0m07:53:02.783543 [info ] [Thread-4 (]: 15 of 24 OK created sql view model dbt_melissa_rm_epc.epc_flats_count .......... [[32mSUCCESS 1[0m in 0.95s]
[0m07:53:02.783892 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.epc_flats_count
[0m07:53:02.787922 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '49d3f53d-5e4a-4382-bf67-24ffbb9b5e88', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108c9f510>]}
[0m07:53:02.789396 [info ] [Thread-5 (]: 13 of 24 OK created sql view model dbt_melissa_rm_epc.uprn_match_flat .......... [[32mSUCCESS 1[0m in 1.03s]
[0m07:53:02.789862 [debug] [Thread-5 (]: Finished running node model.rightmove_epc.uprn_match_flat
[0m07:53:02.813482 [debug] [Thread-6 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m07:53:02.815269 [debug] [Thread-6 (]: Timing info for model.rightmove_epc.uprn_match (execute): 07:53:01.677563 => 07:53:02.815138
[0m07:53:02.815512 [debug] [Thread-6 (]: On model.rightmove_epc.uprn_match: Close
[0m07:53:02.953735 [debug] [Thread-6 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '49d3f53d-5e4a-4382-bf67-24ffbb9b5e88', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1085648d0>]}
[0m07:53:02.954394 [info ] [Thread-6 (]: 12 of 24 OK created sql view model dbt_melissa_rm_epc.uprn_match ............... [[32mSUCCESS 1[0m in 1.30s]
[0m07:53:02.954871 [debug] [Thread-6 (]: Finished running node model.rightmove_epc.uprn_match
[0m07:53:03.127379 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m07:53:03.129780 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.address_match (execute): 07:53:02.489394 => 07:53:03.129609
[0m07:53:03.130107 [debug] [Thread-1 (]: On model.rightmove_epc.address_match: Close
[0m07:53:03.276286 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '49d3f53d-5e4a-4382-bf67-24ffbb9b5e88', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108963b90>]}
[0m07:53:03.276768 [info ] [Thread-1 (]: 16 of 24 OK created sql view model dbt_melissa_rm_epc.address_match ............ [[32mSUCCESS 1[0m in 0.79s]
[0m07:53:03.277090 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.address_match
[0m07:53:03.277439 [debug] [Thread-2 (]: Began running node model.rightmove_epc.flats_report
[0m07:53:03.277678 [debug] [Thread-4 (]: Began running node model.rightmove_epc.houses_report
[0m07:53:03.277888 [info ] [Thread-2 (]: 18 of 24 START sql table model dbt_melissa_rm_epc.flats_report ................. [RUN]
[0m07:53:03.278122 [info ] [Thread-4 (]: 19 of 24 START sql table model dbt_melissa_rm_epc.houses_report ................ [RUN]
[0m07:53:03.278473 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.epc_remove, now model.rightmove_epc.flats_report)
[0m07:53:03.278794 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.epc_flats_count, now model.rightmove_epc.houses_report)
[0m07:53:03.278982 [debug] [Thread-2 (]: Began compiling node model.rightmove_epc.flats_report
[0m07:53:03.279156 [debug] [Thread-4 (]: Began compiling node model.rightmove_epc.houses_report
[0m07:53:03.281884 [debug] [Thread-2 (]: Writing injected SQL for node "model.rightmove_epc.flats_report"
[0m07:53:03.283763 [debug] [Thread-4 (]: Writing injected SQL for node "model.rightmove_epc.houses_report"
[0m07:53:03.284320 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.flats_report (compile): 07:53:03.279270 => 07:53:03.284196
[0m07:53:03.284522 [debug] [Thread-2 (]: Began executing node model.rightmove_epc.flats_report
[0m07:53:03.287600 [debug] [Thread-2 (]: Writing runtime sql for node "model.rightmove_epc.flats_report"
[0m07:53:03.288041 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.houses_report (compile): 07:53:03.282040 => 07:53:03.287898
[0m07:53:03.288355 [debug] [Thread-4 (]: Began executing node model.rightmove_epc.houses_report
[0m07:53:03.290222 [debug] [Thread-2 (]: Using snowflake connection "model.rightmove_epc.flats_report"
[0m07:53:03.291720 [debug] [Thread-4 (]: Writing runtime sql for node "model.rightmove_epc.houses_report"
[0m07:53:03.292059 [debug] [Thread-2 (]: On model.rightmove_epc.flats_report: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.flats_report"} */
create or replace transient table ANALYTICS_DEV.dbt_melissa_rm_epc.flats_report
         as
        (with flat_addmatch as (

    select 
    distinct
    --count(LISTING_ID) as TOTAL_LISTINGS,
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN, -- NULL
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
 --   am.FLOOR_LEVEL as RM_FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    epc.ADDRESSID AS EPC_ADDRESSID,
    -- REMOVE_FROM_RM_MATCH,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

     from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc on am.EPC_ADDRESSID = epc.ADDRESSID
    and am.FULL_POSTCODE = epc.POSTCODE
    where MATCH_EPC = 'YES'
    and COMBINED_PROPERTY_TYPE in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')

),

flat_uprnmatch as (

    select 
    distinct
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN,
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    BUILDING_REFERENCE_NUMBER, 
    epc.ADDRESSID AS EPC_ADDRESSID,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

    

    from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn epc on am.EPC_UPRN = epc.UPRN

    where MATCH_EPC = 'YES'
   and COMBINED_PROPERTY_TYPE in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')
  -- AND RM_UPRN = 100030719363

),

flat_uprnmultimatch as (

    select 
    distinct
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN,
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    BUILDING_REFERENCE_NUMBER, 
    epc.ADDRESSID AS EPC_ADDRESSID,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

    

    from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match_flat am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn epc on am.EPC_UPRN = epc.UPRN

    where MATCH_EPC = 'YES'
   and COMBINED_PROPERTY_TYPE not in ('HOUSE / FLAT SHARE','FLAT / APARTMENT') -- this checks to ensure that houses listed on RightMove are included and matched to EPC as flats
  -- AND RM_UPRN = 100030719363

),

matches as (




select * from flat_uprnmatch

union all

select * from flat_addmatch

union all

select * from flat_uprnmultimatch
)

select distinct *  from matches 
/*
--THIS IS USED FOR A TEST
select RM_UPRN,COUNT(BUILDING_REFERENCE_NUMBER)
from house_uprnmatch
WHERE RM_UPRN IS NOT NULL
GROUP BY 1
HAVING COUNT(BUILDING_REFERENCE_NUMBER) >1
*/
        );
[0m07:53:03.292428 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m07:53:03.294032 [debug] [Thread-4 (]: Using snowflake connection "model.rightmove_epc.houses_report"
[0m07:53:03.294532 [debug] [Thread-4 (]: On model.rightmove_epc.houses_report: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.houses_report"} */
create or replace transient table ANALYTICS_DEV.dbt_melissa_rm_epc.houses_report
         as
        (with house_addmatch as (

    select 
    distinct
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN,
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    epc.ADDRESSID AS EPC_ADDRESSID,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

     from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc on am.EPC_ADDRESSID = epc.ADDRESSID
    and am.FULL_POSTCODE = epc.POSTCODE
    where MATCH_EPC = 'YES'
    and COMBINED_PROPERTY_TYPE not in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')

),

house_uprnmatch as (

    select 
    distinct
    --count(LISTING_ID) as TOTAL_LISTINGS,
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN, -- NULL
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
  --  am.FLOOR_LEVEL as RM_FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    epc.ADDRESSID AS EPC_ADDRESSID,
    -- REMOVE_FROM_RM_MATCH,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

    

    from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn epc on am.EPC_UPRN = epc.UPRN

    where MATCH_EPC = 'YES'
    and COMBINED_PROPERTY_TYPE not in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')
  -- AND RM_UPRN = 100030719363

),

final as (

select * from house_uprnmatch

union all

select * from house_addmatch

)

select distinct * from final


/*
--THIS IS USED FOR A TEST
select RM_UPRN,COUNT(BUILDING_REFERENCE_NUMBER)
from house_uprnmatch
WHERE RM_UPRN IS NOT NULL
GROUP BY 1
HAVING COUNT(BUILDING_REFERENCE_NUMBER) >1
*/
        );
[0m07:53:03.294931 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m07:53:03.773556 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m07:53:03.775880 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.uprn_address_match (execute): 07:53:02.699751 => 07:53:03.775704
[0m07:53:03.776204 [debug] [Thread-3 (]: On model.rightmove_epc.uprn_address_match: Close
[0m07:53:03.916278 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '49d3f53d-5e4a-4382-bf67-24ffbb9b5e88', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x118176450>]}
[0m07:53:03.917538 [info ] [Thread-3 (]: 17 of 24 OK created sql view model dbt_melissa_rm_epc.uprn_address_match ....... [[32mSUCCESS 1[0m in 1.22s]
[0m07:53:03.918351 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.uprn_address_match
[0m07:53:03.919288 [debug] [Thread-6 (]: Began running node model.rightmove_epc.rm_all_matches
[0m07:53:03.919846 [debug] [Thread-1 (]: Began running node model.rightmove_epc.rm_no_matches
[0m07:53:03.920291 [info ] [Thread-6 (]: 20 of 24 START sql table model dbt_melissa_rm_epc.rm_all_matches ............... [RUN]
[0m07:53:03.920804 [info ] [Thread-1 (]: 21 of 24 START sql table model dbt_melissa_rm_epc.rm_no_matches ................ [RUN]
[0m07:53:03.921654 [debug] [Thread-6 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.uprn_match, now model.rightmove_epc.rm_all_matches)
[0m07:53:03.922425 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.address_match, now model.rightmove_epc.rm_no_matches)
[0m07:53:03.922890 [debug] [Thread-6 (]: Began compiling node model.rightmove_epc.rm_all_matches
[0m07:53:03.923640 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.rm_no_matches
[0m07:53:03.928195 [debug] [Thread-6 (]: Writing injected SQL for node "model.rightmove_epc.rm_all_matches"
[0m07:53:03.931834 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.rm_no_matches"
[0m07:53:03.933736 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.rm_no_matches (compile): 07:53:03.928558 => 07:53:03.933491
[0m07:53:03.934108 [debug] [Thread-6 (]: Timing info for model.rightmove_epc.rm_all_matches (compile): 07:53:03.924128 => 07:53:03.933930
[0m07:53:03.934445 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.rm_no_matches
[0m07:53:03.934766 [debug] [Thread-6 (]: Began executing node model.rightmove_epc.rm_all_matches
[0m07:53:03.937328 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.rm_no_matches"
[0m07:53:03.939984 [debug] [Thread-6 (]: Writing runtime sql for node "model.rightmove_epc.rm_all_matches"
[0m07:53:03.941677 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.rm_no_matches"
[0m07:53:03.942974 [debug] [Thread-6 (]: Using snowflake connection "model.rightmove_epc.rm_all_matches"
[0m07:53:03.943318 [debug] [Thread-1 (]: On model.rightmove_epc.rm_no_matches: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.rm_no_matches"} */
create or replace transient table ANALYTICS_DEV.dbt_melissa_rm_epc.rm_no_matches
         as
        (with addr as (

    select distinct
   -- LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN,
    EPC_ADDRESSID
    
    from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
    where MATCH_EPC = 'NO' 
),

uprn as (

    select distinct
    
  --  LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN::VARCHAR AS EPC_UPRN,
    EPC_ADDRESSID
    
     from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'NO'
),

uprn_address as (

        select 
    distinct
  --  LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN::VARCHAR AS EPC_UPRN,
    EPC_ADDRESSID
    
     from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_address_match
    where MATCH_EPC = 'NO'
),

final as (

select 'NO ADDRESS MATCH' AS MATCH_RESULT, * from addr
union all
select 'NO UPRN MATCH' AS MATCH_RESULT, * from uprn
union select 'NO ADDRESS OR UPRN MATCH' AS MATCH_RESULT, * from uprn_address

)

select distinct * from final
        );
[0m07:53:03.943740 [debug] [Thread-6 (]: On model.rightmove_epc.rm_all_matches: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.rm_all_matches"} */
create or replace transient table ANALYTICS_DEV.dbt_melissa_rm_epc.rm_all_matches
         as
        (with addr as (

    select distinct
  --  LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN,
    EPC_ADDRESSID
    
    from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match
    where MATCH_EPC = 'YES' 
),

uprn_addr as (

    select 
    distinct
  --  LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN,
    EPC_ADDRESSID
    
    from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_address_match
    where MATCH_EPC = 'YES' 
),

uprn as (

    select 
    distinct
  --  LISTING_ID,
    ADDRESSID, 
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE, --- DOESNT LOOK CORRECT
    UPRN,
    LOCAL_AUTHORITY_CODE,
    LOCAL_AUTHORITY,
    GOV_REGION_CODE,
    FLOOR_AREA,
    FLOOR_LEVEL,
    EPC_UPRN::VARCHAR AS EPC_UPRN,
    EPC_ADDRESSID

    from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match
    where MATCH_EPC = 'YES'
),

final as (

select 'ADDRESS AND POSTCODE MATCH' AS MATCH_RESULT, * from addr
union all
select 'UPRN MATCH' AS MATCH_RESULT, * from uprn
union all
select 'MATCH ADDRESS NO MATCH TO EPC UPRN' AS MATCH_RESULT, * from uprn_addr
)

select distinct * from final
        );
[0m07:53:03.944076 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m07:53:03.944330 [debug] [Thread-6 (]: Opening a new connection, currently in state closed
[0m07:53:52.391447 [debug] [Thread-8 (]: SQL status: SUCCESS 1 in 51.0 seconds
[0m07:53:52.394371 [debug] [Thread-8 (]: Timing info for model.rightmove_epc.epc_flats (execute): 07:53:01.833539 => 07:53:52.394238
[0m07:53:52.394624 [debug] [Thread-8 (]: On model.rightmove_epc.epc_flats: Close
[0m07:53:52.550478 [debug] [Thread-8 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '49d3f53d-5e4a-4382-bf67-24ffbb9b5e88', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108cb0b90>]}
[0m07:53:52.551072 [info ] [Thread-8 (]: 14 of 24 OK created sql table model dbt_melissa_rm_epc.epc_flats ............... [[32mSUCCESS 1[0m in 50.72s]
[0m07:53:52.551457 [debug] [Thread-8 (]: Finished running node model.rightmove_epc.epc_flats
[0m07:54:07.962585 [debug] [Thread-7 (]: SQL status: SUCCESS 1 in 66.0 seconds
[0m07:54:07.965738 [debug] [Thread-7 (]: Timing info for model.rightmove_epc.rm_listings (execute): 07:53:01.680660 => 07:54:07.965562
[0m07:54:07.966074 [debug] [Thread-7 (]: On model.rightmove_epc.rm_listings: Close
[0m07:54:08.145974 [debug] [Thread-7 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '49d3f53d-5e4a-4382-bf67-24ffbb9b5e88', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108966c10>]}
[0m07:54:08.147034 [info ] [Thread-7 (]: 10 of 24 OK created sql table model dbt_melissa_rm_epc.rm_listings ............. [[32mSUCCESS 1[0m in 66.49s]
[0m07:54:08.147836 [debug] [Thread-7 (]: Finished running node model.rightmove_epc.rm_listings
[0m07:57:12.955324 [debug] [Thread-2 (]: SQL status: SUCCESS 1 in 250.0 seconds
[0m07:57:12.969126 [debug] [Thread-2 (]: Timing info for model.rightmove_epc.flats_report (execute): 07:53:03.284651 => 07:57:12.968257
[0m07:57:12.969958 [debug] [Thread-2 (]: On model.rightmove_epc.flats_report: Close
[0m07:57:13.200038 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '49d3f53d-5e4a-4382-bf67-24ffbb9b5e88', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1085f31d0>]}
[0m07:57:13.202135 [info ] [Thread-2 (]: 18 of 24 OK created sql table model dbt_melissa_rm_epc.flats_report ............ [[32mSUCCESS 1[0m in 249.92s]
[0m07:57:13.203080 [debug] [Thread-2 (]: Finished running node model.rightmove_epc.flats_report
[0m07:57:15.844906 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 252.0 seconds
[0m07:57:15.853499 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.rm_no_matches (execute): 07:53:03.934959 => 07:57:15.852952
[0m07:57:15.854342 [debug] [Thread-1 (]: On model.rightmove_epc.rm_no_matches: Close
[0m07:57:16.013345 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '49d3f53d-5e4a-4382-bf67-24ffbb9b5e88', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x118187c50>]}
[0m07:57:16.014227 [info ] [Thread-1 (]: 21 of 24 OK created sql table model dbt_melissa_rm_epc.rm_no_matches ........... [[32mSUCCESS 1[0m in 252.09s]
[0m07:57:16.014686 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.rm_no_matches
[0m07:57:16.442749 [debug] [Thread-4 (]: SQL status: SUCCESS 1 in 253.0 seconds
[0m07:57:16.446763 [debug] [Thread-4 (]: Timing info for model.rightmove_epc.houses_report (execute): 07:53:03.290342 => 07:57:16.446445
[0m07:57:16.447354 [debug] [Thread-4 (]: On model.rightmove_epc.houses_report: Close
[0m07:57:16.676229 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '49d3f53d-5e4a-4382-bf67-24ffbb9b5e88', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108cdf6d0>]}
[0m07:57:16.676951 [info ] [Thread-4 (]: 19 of 24 OK created sql table model dbt_melissa_rm_epc.houses_report ........... [[32mSUCCESS 1[0m in 253.40s]
[0m07:57:16.677504 [debug] [Thread-4 (]: Finished running node model.rightmove_epc.houses_report
[0m07:57:16.678289 [debug] [Thread-3 (]: Began running node model.rightmove_epc.stats_property_totals
[0m07:57:16.678693 [debug] [Thread-5 (]: Began running node model.rightmove_epc.zero_bedrooms
[0m07:57:16.679121 [info ] [Thread-3 (]: 22 of 24 START sql view model dbt_melissa_rm_epc.stats_property_totals ......... [RUN]
[0m07:57:16.679621 [info ] [Thread-5 (]: 23 of 24 START sql table model dbt_melissa_rm_epc.zero_bedrooms ................ [RUN]
[0m07:57:16.680421 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.uprn_address_match, now model.rightmove_epc.stats_property_totals)
[0m07:57:16.681101 [debug] [Thread-5 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.uprn_match_flat, now model.rightmove_epc.zero_bedrooms)
[0m07:57:16.681512 [debug] [Thread-3 (]: Began compiling node model.rightmove_epc.stats_property_totals
[0m07:57:16.681900 [debug] [Thread-5 (]: Began compiling node model.rightmove_epc.zero_bedrooms
[0m07:57:16.690173 [debug] [Thread-3 (]: Writing injected SQL for node "model.rightmove_epc.stats_property_totals"
[0m07:57:16.694114 [debug] [Thread-5 (]: Writing injected SQL for node "model.rightmove_epc.zero_bedrooms"
[0m07:57:16.698043 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.stats_property_totals (compile): 07:57:16.682147 => 07:57:16.697671
[0m07:57:16.698642 [debug] [Thread-3 (]: Began executing node model.rightmove_epc.stats_property_totals
[0m07:57:16.703067 [debug] [Thread-3 (]: Writing runtime sql for node "model.rightmove_epc.stats_property_totals"
[0m07:57:16.703836 [debug] [Thread-5 (]: Timing info for model.rightmove_epc.zero_bedrooms (compile): 07:57:16.690522 => 07:57:16.703469
[0m07:57:16.704355 [debug] [Thread-5 (]: Began executing node model.rightmove_epc.zero_bedrooms
[0m07:57:16.709552 [debug] [Thread-5 (]: Writing runtime sql for node "model.rightmove_epc.zero_bedrooms"
[0m07:57:16.710614 [debug] [Thread-3 (]: Using snowflake connection "model.rightmove_epc.stats_property_totals"
[0m07:57:16.711424 [debug] [Thread-3 (]: On model.rightmove_epc.stats_property_totals: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stats_property_totals"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stats_property_totals
  
   as (
    with houses as (

    select 
    'flat' source,
    count(*) count
    from ANALYTICS_DEV.dbt_melissa_rm_epc.houses_report

),

flats as (

    select 
    'house' source,
    count(*) count
    from ANALYTICS_DEV.dbt_melissa_rm_epc.flats_report

)

select * from houses
union all
select * from flats
  );
[0m07:57:16.711957 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m07:57:16.712849 [debug] [Thread-5 (]: Using snowflake connection "model.rightmove_epc.zero_bedrooms"
[0m07:57:16.714869 [debug] [Thread-5 (]: On model.rightmove_epc.zero_bedrooms: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.zero_bedrooms"} */
create or replace transient table ANALYTICS_DEV.dbt_melissa_rm_epc.zero_bedrooms
         as
        (with houses as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.houses_report
    where BEDROOM = 0
),

flats as (

    select * from ANALYTICS_DEV.dbt_melissa_rm_epc.flats_report
        where BEDROOM = 0

)

select * from flats
union all
select * from houses
        );
[0m07:57:16.715382 [debug] [Thread-5 (]: Opening a new connection, currently in state closed
[0m07:57:17.476525 [debug] [Thread-3 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m07:57:17.481052 [debug] [Thread-3 (]: Timing info for model.rightmove_epc.stats_property_totals (execute): 07:57:16.698997 => 07:57:17.480819
[0m07:57:17.481573 [debug] [Thread-3 (]: On model.rightmove_epc.stats_property_totals: Close
[0m07:57:17.652947 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '49d3f53d-5e4a-4382-bf67-24ffbb9b5e88', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108ccc390>]}
[0m07:57:17.655564 [info ] [Thread-3 (]: 22 of 24 OK created sql view model dbt_melissa_rm_epc.stats_property_totals .... [[32mSUCCESS 1[0m in 0.97s]
[0m07:57:17.657261 [debug] [Thread-3 (]: Finished running node model.rightmove_epc.stats_property_totals
[0m07:57:19.507090 [debug] [Thread-5 (]: SQL status: SUCCESS 1 in 3.0 seconds
[0m07:57:19.510247 [debug] [Thread-5 (]: Timing info for model.rightmove_epc.zero_bedrooms (execute): 07:57:16.704659 => 07:57:19.510043
[0m07:57:19.510636 [debug] [Thread-5 (]: On model.rightmove_epc.zero_bedrooms: Close
[0m07:57:19.653806 [debug] [Thread-5 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '49d3f53d-5e4a-4382-bf67-24ffbb9b5e88', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108c23ed0>]}
[0m07:57:19.654601 [info ] [Thread-5 (]: 23 of 24 OK created sql table model dbt_melissa_rm_epc.zero_bedrooms ........... [[32mSUCCESS 1[0m in 2.97s]
[0m07:57:19.655285 [debug] [Thread-5 (]: Finished running node model.rightmove_epc.zero_bedrooms
[0m07:57:30.663398 [debug] [Thread-6 (]: SQL status: SUCCESS 1 in 267.0 seconds
[0m07:57:30.670734 [debug] [Thread-6 (]: Timing info for model.rightmove_epc.rm_all_matches (execute): 07:53:03.937685 => 07:57:30.670346
[0m07:57:30.671918 [debug] [Thread-6 (]: On model.rightmove_epc.rm_all_matches: Close
[0m07:57:30.852060 [debug] [Thread-6 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '49d3f53d-5e4a-4382-bf67-24ffbb9b5e88', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108c3e1d0>]}
[0m07:57:31.555837 [info ] [Thread-6 (]: 20 of 24 OK created sql table model dbt_melissa_rm_epc.rm_all_matches .......... [[32mSUCCESS 1[0m in 266.93s]
[0m07:57:31.556732 [debug] [Thread-6 (]: Finished running node model.rightmove_epc.rm_all_matches
[0m07:57:31.557811 [debug] [Thread-7 (]: Began running node model.rightmove_epc.stats_matches
[0m07:57:31.558524 [info ] [Thread-7 (]: 24 of 24 START sql view model dbt_melissa_rm_epc.stats_matches ................. [RUN]
[0m07:57:31.559436 [debug] [Thread-7 (]: Re-using an available connection from the pool (formerly model.rightmove_epc.rm_listings, now model.rightmove_epc.stats_matches)
[0m07:57:31.559880 [debug] [Thread-7 (]: Began compiling node model.rightmove_epc.stats_matches
[0m07:57:31.563348 [debug] [Thread-7 (]: Writing injected SQL for node "model.rightmove_epc.stats_matches"
[0m07:57:31.564198 [debug] [Thread-7 (]: Timing info for model.rightmove_epc.stats_matches (compile): 07:57:31.560138 => 07:57:31.563995
[0m07:57:31.564761 [debug] [Thread-7 (]: Began executing node model.rightmove_epc.stats_matches
[0m07:57:31.569983 [debug] [Thread-7 (]: Writing runtime sql for node "model.rightmove_epc.stats_matches"
[0m07:57:31.573396 [debug] [Thread-7 (]: Using snowflake connection "model.rightmove_epc.stats_matches"
[0m07:57:31.574204 [debug] [Thread-7 (]: On model.rightmove_epc.stats_matches: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.stats_matches"} */
create or replace   view ANALYTICS_DEV.dbt_melissa_rm_epc.stats_matches
  
   as (
    WITH matches AS (
    SELECT 
        MATCH_RESULT,
        COUNT(*) AS count,
        COUNT(DISTINCT addressid) AS count_distinct_address,
        COUNT(addressid) AS count_address,
        COUNT(DISTINCT uprn) AS count_distinct_uprn,
        COUNT(uprn) AS count_uprn
    FROM ANALYTICS_DEV.dbt_melissa_rm_epc.rm_all_matches -- Replace with your actual table name or reference
    GROUP BY MATCH_RESULT

),
no_matches AS (
    SELECT 
        MATCH_RESULT,
        COUNT(*) AS count,
        COUNT(DISTINCT addressid) AS count_distinct_address,
        COUNT(addressid) AS count_address, -- This is redundant as it's the same as COUNT(*)
        COUNT(DISTINCT uprn) AS count_distinct_uprn,
        COUNT(uprn) AS count_uprn
    FROM ANALYTICS_DEV.dbt_melissa_rm_epc.rm_no_matches -- Replace with your actual table name or reference
    GROUP BY MATCH_RESULT
)

SELECT 'match' result, *  FROM matches
UNION ALL
SELECT 'no match' result,* FROM no_matches
order by result
  );
[0m07:57:31.574569 [debug] [Thread-7 (]: Opening a new connection, currently in state closed
[0m07:57:32.328598 [debug] [Thread-7 (]: SQL status: SUCCESS 1 in 1.0 seconds
[0m07:57:32.346500 [debug] [Thread-7 (]: Timing info for model.rightmove_epc.stats_matches (execute): 07:57:31.565604 => 07:57:32.346221
[0m07:57:32.347115 [debug] [Thread-7 (]: On model.rightmove_epc.stats_matches: Close
[0m07:57:32.495174 [debug] [Thread-7 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '49d3f53d-5e4a-4382-bf67-24ffbb9b5e88', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10879a7d0>]}
[0m07:57:32.496155 [info ] [Thread-7 (]: 24 of 24 OK created sql view model dbt_melissa_rm_epc.stats_matches ............ [[32mSUCCESS 1[0m in 0.94s]
[0m07:57:32.496939 [debug] [Thread-7 (]: Finished running node model.rightmove_epc.stats_matches
[0m07:57:32.501219 [debug] [MainThread]: Connection 'master' was properly closed.
[0m07:57:32.501996 [debug] [MainThread]: Connection 'model.rightmove_epc.rm_no_matches' was properly closed.
[0m07:57:32.502465 [debug] [MainThread]: Connection 'model.rightmove_epc.flats_report' was properly closed.
[0m07:57:32.502916 [debug] [MainThread]: Connection 'model.rightmove_epc.houses_report' was properly closed.
[0m07:57:32.503876 [debug] [MainThread]: Connection 'model.rightmove_epc.stats_property_totals' was properly closed.
[0m07:57:32.504393 [debug] [MainThread]: Connection 'model.rightmove_epc.rm_all_matches' was properly closed.
[0m07:57:32.504966 [debug] [MainThread]: Connection 'model.rightmove_epc.epc_flats' was properly closed.
[0m07:57:32.505606 [debug] [MainThread]: Connection 'model.rightmove_epc.zero_bedrooms' was properly closed.
[0m07:57:32.506044 [debug] [MainThread]: Connection 'model.rightmove_epc.stats_matches' was properly closed.
[0m07:57:32.506668 [info ] [MainThread]: 
[0m07:57:32.507155 [info ] [MainThread]: Finished running 16 view models, 8 table models in 0 hours 4 minutes and 34.24 seconds (274.24s).
[0m07:57:32.511202 [debug] [MainThread]: Command end result
[0m07:57:32.527050 [info ] [MainThread]: 
[0m07:57:32.527558 [info ] [MainThread]: [32mCompleted successfully[0m
[0m07:57:32.527914 [info ] [MainThread]: 
[0m07:57:32.528266 [info ] [MainThread]: Done. PASS=24 WARN=0 ERROR=0 SKIP=0 TOTAL=24
[0m07:57:32.531224 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 274.43512, "process_user_time": 2.466498, "process_kernel_time": 0.303634, "process_mem_max_rss": "145293312", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m07:57:32.531860 [debug] [MainThread]: Command `dbt run` succeeded at 07:57:32.531741 after 274.44 seconds
[0m07:57:32.532287 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100d0a110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100e45cd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x100cf2710>]}
[0m07:57:32.532634 [debug] [MainThread]: Flushing usage events
[0m08:07:08.237740 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10833e290>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10839a690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10839b2d0>]}


============================== 08:07:08.240845 | bde75549-7a13-4743-8d9c-926dd9626561 ==============================
[0m08:07:08.240845 [info ] [MainThread]: Running with dbt=1.7.10
[0m08:07:08.241219 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'write_json': 'True', 'partial_parse': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/Users/melissabee/.dbt', 'fail_fast': 'False', 'version_check': 'True', 'log_path': '/Users/melissabee/Documents/GitHub/client-loh-floor-area/rightmove_epc/logs', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptions(include=[], exclude=[])', 'invocation_command': 'dbt run --select models/reports/flats_report.sql', 'static_parser': 'True', 'introspect': 'True', 'target_path': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True'}
[0m08:07:08.452659 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'bde75549-7a13-4743-8d9c-926dd9626561', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10907bc50>]}
[0m08:07:08.493353 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'bde75549-7a13-4743-8d9c-926dd9626561', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x108faff50>]}
[0m08:07:08.493961 [info ] [MainThread]: Registered adapter: snowflake=1.7.2
[0m08:07:08.504676 [debug] [MainThread]: checksum: b88efa780424265bbbd676e971356ada6a7ea9debd0a80a519a6d2707465340d, vars: {}, profile: , target: , version: 1.7.10
[0m08:07:08.536927 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m08:07:08.537229 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m08:07:08.541249 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'bde75549-7a13-4743-8d9c-926dd9626561', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109299010>]}
[0m08:07:08.550985 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'bde75549-7a13-4743-8d9c-926dd9626561', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109124cd0>]}
[0m08:07:08.551348 [info ] [MainThread]: Found 24 models, 1 analysis, 2 sources, 0 exposures, 0 metrics, 430 macros, 0 groups, 0 semantic models
[0m08:07:08.551581 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bde75549-7a13-4743-8d9c-926dd9626561', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10908b8d0>]}
[0m08:07:08.552836 [info ] [MainThread]: 
[0m08:07:08.553299 [debug] [MainThread]: Acquiring new snowflake connection 'master'
[0m08:07:08.553970 [debug] [ThreadPool]: Acquiring new snowflake connection 'list_ANALYTICS_DEV'
[0m08:07:08.561674 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV"
[0m08:07:08.561975 [debug] [ThreadPool]: On list_ANALYTICS_DEV: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV"} */
show terse schemas in database ANALYTICS_DEV
    limit 10000
[0m08:07:08.562169 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m08:07:09.209016 [debug] [ThreadPool]: SQL status: SUCCESS 46 in 1.0 seconds
[0m08:07:09.211795 [debug] [ThreadPool]: On list_ANALYTICS_DEV: Close
[0m08:07:09.356357 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV, now list_ANALYTICS_DEV_dbt_melissa_rm_epc)
[0m08:07:09.367140 [debug] [ThreadPool]: Using snowflake connection "list_ANALYTICS_DEV_dbt_melissa_rm_epc"
[0m08:07:09.367641 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "connection_name": "list_ANALYTICS_DEV_dbt_melissa_rm_epc"} */
show terse objects in ANALYTICS_DEV.dbt_melissa_rm_epc limit 10000
[0m08:07:09.367970 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m08:07:09.960150 [debug] [ThreadPool]: SQL status: SUCCESS 26 in 1.0 seconds
[0m08:07:09.962360 [debug] [ThreadPool]: On list_ANALYTICS_DEV_dbt_melissa_rm_epc: Close
[0m08:07:10.148180 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bde75549-7a13-4743-8d9c-926dd9626561', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x10902c710>]}
[0m08:07:10.148991 [info ] [MainThread]: Concurrency: 8 threads (target='dev')
[0m08:07:10.149299 [info ] [MainThread]: 
[0m08:07:10.151718 [debug] [Thread-1 (]: Began running node model.rightmove_epc.flats_report
[0m08:07:10.152150 [info ] [Thread-1 (]: 1 of 1 START sql table model dbt_melissa_rm_epc.flats_report ................... [RUN]
[0m08:07:10.152713 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_ANALYTICS_DEV_dbt_melissa_rm_epc, now model.rightmove_epc.flats_report)
[0m08:07:10.153018 [debug] [Thread-1 (]: Began compiling node model.rightmove_epc.flats_report
[0m08:07:10.194328 [debug] [Thread-1 (]: Writing injected SQL for node "model.rightmove_epc.flats_report"
[0m08:07:10.195564 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.flats_report (compile): 08:07:10.153211 => 08:07:10.195429
[0m08:07:10.195790 [debug] [Thread-1 (]: Began executing node model.rightmove_epc.flats_report
[0m08:07:10.211654 [debug] [Thread-1 (]: Writing runtime sql for node "model.rightmove_epc.flats_report"
[0m08:07:10.213748 [debug] [Thread-1 (]: Using snowflake connection "model.rightmove_epc.flats_report"
[0m08:07:10.214096 [debug] [Thread-1 (]: On model.rightmove_epc.flats_report: /* {"app": "dbt", "dbt_version": "1.7.10", "profile_name": "rightmove_epc", "target_name": "dev", "node_id": "model.rightmove_epc.flats_report"} */
create or replace transient table ANALYTICS_DEV.dbt_melissa_rm_epc.flats_report
         as
        (with flat_addmatch as (

    select 
    distinct
    --count(LISTING_ID) as TOTAL_LISTINGS,
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN, -- NULL
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
 --   am.FLOOR_LEVEL as RM_FLOOR_LEVEL,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    BUILDING_REFERENCE_NUMBER, -- EPC UID
    epc.ADDRESSID AS EPC_ADDRESSID,
    -- REMOVE_FROM_RM_MATCH,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

     from ANALYTICS_DEV.dbt_melissa_rm_epc.address_match am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.stg_epc_certs epc on am.EPC_ADDRESSID = epc.ADDRESSID
    and am.FULL_POSTCODE = epc.POSTCODE
    where MATCH_EPC = 'YES'
    and COMBINED_PROPERTY_TYPE in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')

),

flat_uprnmatch as (

    select 
    distinct
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN,
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    BUILDING_REFERENCE_NUMBER, 
    epc.ADDRESSID AS EPC_ADDRESSID,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

    

    from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn epc on am.EPC_UPRN = epc.UPRN

    where MATCH_EPC = 'YES'
   and COMBINED_PROPERTY_TYPE in ('HOUSE / FLAT SHARE','FLAT / APARTMENT')
  -- AND RM_UPRN = 100030719363

),

flat_uprnmultimatch as (

    select 
    distinct
    am.ADDRESSID as RM_ADDRESSID,
    ADDRESS_1,
    ADDRESS_2,
    FULL_POSTCODE,
    am.UPRN AS RM_UPRN,
    am.LOCAL_AUTHORITY_CODE,
    GOV_REGION_CODE,
    FLOOR_AREA,
    BEDROOM,
    PROPERTY_TYPE_1,
    PROPERTY_TYPE_2,
    COMBINED_PROPERTY_TYPE,
    epc.UPRN as EPC_UPRN,
    UPRN_SOURCE,
    TOTAL_FLOOR_AREA, 
    ADDRESS, 
    ADDRESS1, 
    ADDRESS2, 
    ADDRESS3, 
    POSTCODE, 
    BUILDING_REFERENCE_NUMBER, 
    epc.ADDRESSID AS EPC_ADDRESSID,
    epc.FLOOR_LEVEL,
    epc.FLAT_TOP_STOREY,
    epc.FLAT_STOREY_COUNT,
    epc.PROPERTY_TYPE

    

    from ANALYTICS_DEV.dbt_melissa_rm_epc.uprn_match_flat am
    inner join ANALYTICS_DEV.dbt_melissa_rm_epc.latest_epc_urn epc on am.EPC_UPRN = epc.UPRN

    where MATCH_EPC = 'YES'
   --and COMBINED_PROPERTY_TYPE not in ('HOUSE / FLAT SHARE','FLAT / APARTMENT') -- this checks to ensure that houses listed on RightMove are included and matched to EPC as flats and removes dupes as this filter has already been applied
  -- AND RM_UPRN = 100030719363

),

matches as (




select * from flat_uprnmatch

union all

select * from flat_addmatch

union all

select * from flat_uprnmultimatch
)

select distinct *  from matches 
/*
--THIS IS USED FOR A TEST
select RM_UPRN,COUNT(BUILDING_REFERENCE_NUMBER)
from house_uprnmatch
WHERE RM_UPRN IS NOT NULL
GROUP BY 1
HAVING COUNT(BUILDING_REFERENCE_NUMBER) >1
*/
        );
[0m08:07:10.214411 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m08:08:24.050699 [debug] [Thread-1 (]: SQL status: SUCCESS 1 in 74.0 seconds
[0m08:08:24.071881 [debug] [Thread-1 (]: Timing info for model.rightmove_epc.flats_report (execute): 08:07:10.195918 => 08:08:24.071705
[0m08:08:24.072260 [debug] [Thread-1 (]: On model.rightmove_epc.flats_report: Close
[0m08:08:24.264943 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'bde75549-7a13-4743-8d9c-926dd9626561', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x109113490>]}
[0m08:08:24.266011 [info ] [Thread-1 (]: 1 of 1 OK created sql table model dbt_melissa_rm_epc.flats_report .............. [[32mSUCCESS 1[0m in 74.11s]
[0m08:08:24.266722 [debug] [Thread-1 (]: Finished running node model.rightmove_epc.flats_report
[0m08:08:24.269684 [debug] [MainThread]: Connection 'master' was properly closed.
[0m08:08:24.270075 [debug] [MainThread]: Connection 'model.rightmove_epc.flats_report' was properly closed.
[0m08:08:24.270408 [info ] [MainThread]: 
[0m08:08:24.270740 [info ] [MainThread]: Finished running 1 table model in 0 hours 1 minutes and 15.72 seconds (75.72s).
[0m08:08:24.271316 [debug] [MainThread]: Command end result
[0m08:08:24.284910 [info ] [MainThread]: 
[0m08:08:24.285298 [info ] [MainThread]: [32mCompleted successfully[0m
[0m08:08:24.285544 [info ] [MainThread]: 
[0m08:08:24.285793 [info ] [MainThread]: Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
[0m08:08:24.287990 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 76.08361, "process_user_time": 1.362412, "process_kernel_time": 0.205908, "process_mem_max_rss": "135331840", "process_in_blocks": "0", "process_out_blocks": "0"}
[0m08:08:24.288388 [debug] [MainThread]: Command `dbt run` succeeded at 08:08:24.288299 after 76.08 seconds
[0m08:08:24.288665 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x107dd37d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x1013c5f10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0x101272150>]}
[0m08:08:24.288947 [debug] [MainThread]: Flushing usage events
